net/mlx5e: Pass q_counter indentifier as parameter to rq_param builders

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-326.el8
commit-author Tariq Toukan <tariqt@nvidia.com>
commit 6debae2a9d1179e54abd9f45afe39ed196ffc225
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-326.el8/6debae2a.failed

Pass q_counter idintifier, instead of reading it from mlx5e_priv
parameter.
This is a step towards removing the mlx5e_priv parameter from all
params function and logic in the next patches of the series.

	Signed-off-by: Tariq Toukan <tariqt@nvidia.com>
	Reviewed-by: Aya Levin <ayal@nvidia.com>
	Signed-off-by: Saeed Mahameed <saeedm@nvidia.com>
(cherry picked from commit 6debae2a9d1179e54abd9f45afe39ed196ffc225)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/mellanox/mlx5/core/en/trap.c
#	drivers/net/ethernet/mellanox/mlx5/core/en_main.c
diff --cc drivers/net/ethernet/mellanox/mlx5/core/en_main.c
index d0de4151238f,6aae2bce32f3..000000000000
--- a/drivers/net/ethernet/mellanox/mlx5/core/en_main.c
+++ b/drivers/net/ethernet/mellanox/mlx5/core/en_main.c
@@@ -2151,8 -2218,8 +2152,13 @@@ void mlx5e_build_rq_param(struct mlx5e_
  	MLX5_SET(wq, wq, end_padding_mode, MLX5_WQ_END_PAD_MODE_ALIGN);
  	MLX5_SET(wq, wq, log_wq_stride,
  		 mlx5e_get_rqwq_log_stride(params->rq_wq_type, ndsegs));
++<<<<<<< HEAD
 +	MLX5_SET(wq, wq, pd,               mdev->mlx5e_res.pdn);
 +	MLX5_SET(rqc, rqc, counter_set_id, priv->q_counter);
++=======
+ 	MLX5_SET(wq, wq, pd,               mdev->mlx5e_res.hw_objs.pdn);
+ 	MLX5_SET(rqc, rqc, counter_set_id, q_counter);
++>>>>>>> 6debae2a9d11 (net/mlx5e: Pass q_counter indentifier as parameter to rq_param builders)
  	MLX5_SET(rqc, rqc, vsd,            params->vlan_strip_disable);
  	MLX5_SET(rqc, rqc, scatter_fcs,    params->scatter_fcs_en);
  
@@@ -2170,9 -2238,9 +2177,9 @@@ static void mlx5e_build_drop_rq_param(s
  	MLX5_SET(wq, wq, wq_type, MLX5_WQ_TYPE_CYCLIC);
  	MLX5_SET(wq, wq, log_wq_stride,
  		 mlx5e_get_rqwq_log_stride(MLX5_WQ_TYPE_CYCLIC, 1));
- 	MLX5_SET(rqc, rqc, counter_set_id, priv->drop_rq_q_counter);
+ 	MLX5_SET(rqc, rqc, counter_set_id, q_counter);
  
 -	param->wq.buf_numa_node = dev_to_node(mlx5_core_dma_dev(mdev));
 +	param->wq.buf_numa_node = dev_to_node(mdev->device);
  }
  
  void mlx5e_build_sq_param_common(struct mlx5e_priv *priv,
@@@ -3263,9 -3379,9 +3271,9 @@@ int mlx5e_open_drop_rq(struct mlx5e_pri
  	struct mlx5e_cq *cq = &drop_rq->cq;
  	int err;
  
- 	mlx5e_build_drop_rq_param(priv, &rq_param);
+ 	mlx5e_build_drop_rq_param(priv, priv->drop_rq_q_counter, &rq_param);
  
 -	err = mlx5e_alloc_drop_cq(priv, cq, &cq_param);
 +	err = mlx5e_alloc_drop_cq(mdev, cq, &cq_param);
  	if (err)
  		return err;
  
* Unmerged path drivers/net/ethernet/mellanox/mlx5/core/en/trap.c
diff --git a/drivers/net/ethernet/mellanox/mlx5/core/en/params.h b/drivers/net/ethernet/mellanox/mlx5/core/en/params.h
index 187007ad3349..2b1bac9477dd 100644
--- a/drivers/net/ethernet/mellanox/mlx5/core/en/params.h
+++ b/drivers/net/ethernet/mellanox/mlx5/core/en/params.h
@@ -105,6 +105,7 @@ u16 mlx5e_get_rq_headroom(struct mlx5_core_dev *mdev,
 void mlx5e_build_rq_param(struct mlx5e_priv *priv,
 			  struct mlx5e_params *params,
 			  struct mlx5e_xsk_param *xsk,
+			  u16 q_counter,
 			  struct mlx5e_rq_param *param);
 void mlx5e_build_sq_param_common(struct mlx5e_priv *priv,
 				 struct mlx5e_sq_param *param);
* Unmerged path drivers/net/ethernet/mellanox/mlx5/core/en/trap.c
diff --git a/drivers/net/ethernet/mellanox/mlx5/core/en/xsk/setup.c b/drivers/net/ethernet/mellanox/mlx5/core/en/xsk/setup.c
index f95905fc4979..9a5a27f12475 100644
--- a/drivers/net/ethernet/mellanox/mlx5/core/en/xsk/setup.c
+++ b/drivers/net/ethernet/mellanox/mlx5/core/en/xsk/setup.c
@@ -40,7 +40,7 @@ static void mlx5e_build_xsk_cparam(struct mlx5e_priv *priv,
 				   struct mlx5e_xsk_param *xsk,
 				   struct mlx5e_channel_param *cparam)
 {
-	mlx5e_build_rq_param(priv, params, xsk, &cparam->rq);
+	mlx5e_build_rq_param(priv, params, xsk, priv->q_counter, &cparam->rq);
 	mlx5e_build_xdpsq_param(priv, params, &cparam->xdp_sq);
 }
 
* Unmerged path drivers/net/ethernet/mellanox/mlx5/core/en_main.c
