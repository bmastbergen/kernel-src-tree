drm/i915/adl_s: Add display WAs for ADL-S

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-326.el8
commit-author Aditya Swarup <aditya.swarup@intel.com>
commit ea27113ea90cb1f689e5b5234ebf6323e838efff
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-326.el8/ea27113e.failed

- Extend permanent driver WA Wa_1409767108, Wa_14010685332
  and Wa_14011294188 to adl-s.
- Extend permanent driver WA Wa_1606054188 to adl-s.
- Add Wa_14011765242 for adl-s A0 stepping.

	Cc: Jani Nikula <jani.nikula@intel.com>
	Cc: Ville Syrjälä <ville.syrjala@linux.intel.com>
	Cc: Imre Deak <imre.deak@intel.com>
	Cc: Matt Roper <matthew.d.roper@intel.com>
	Cc: Lucas De Marchi <lucas.demarchi@intel.com>
	Signed-off-by: Aditya Swarup <aditya.swarup@intel.com>
	Reviewed-by: José Roberto de Souza <jose.souza@intel.com>
	Signed-off-by: José Roberto de Souza <jose.souza@intel.com>
Link: https://patchwork.freedesktop.org/patch/msgid/20210129182945.217078-8-aditya.swarup@intel.com
(cherry picked from commit ea27113ea90cb1f689e5b5234ebf6323e838efff)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/gpu/drm/i915/display/intel_display_power.c
diff --cc drivers/gpu/drm/i915/display/intel_display_power.c
index 612e28814ad9,139d5aef2fa5..000000000000
--- a/drivers/gpu/drm/i915/display/intel_display_power.c
+++ b/drivers/gpu/drm/i915/display/intel_display_power.c
@@@ -5264,8 -5339,10 +5264,15 @@@ static void tgl_bw_buddy_init(struct dr
  	unsigned long abox_mask = INTEL_INFO(dev_priv)->abox_mask;
  	int config, i;
  
++<<<<<<< HEAD
 +	if (IS_TGL_REVID(dev_priv, TGL_REVID_A0, TGL_REVID_B0))
 +		/* Wa_1409767108: tgl */
++=======
+ 	if (IS_ALDERLAKE_S(dev_priv) ||
+ 	    IS_DG1_REVID(dev_priv, DG1_REVID_A0, DG1_REVID_A0) ||
+ 	    IS_TGL_DISP_STEPPING(dev_priv, STEP_A0, STEP_B0))
+ 		/* Wa_1409767108:tgl,dg1,adl-s */
++>>>>>>> ea27113ea90c (drm/i915/adl_s: Add display WAs for ADL-S)
  		table = wa_1409767108_buddy_page_masks;
  	else
  		table = tgl_buddy_page_masks;
@@@ -5303,6 -5380,12 +5310,15 @@@ static void icl_display_core_init(struc
  
  	gen9_set_dc_state(dev_priv, DC_STATE_DISABLE);
  
++<<<<<<< HEAD
++=======
+ 	/* Wa_14011294188:ehl,jsl,tgl,rkl,adl-s */
+ 	if (INTEL_PCH_TYPE(dev_priv) >= PCH_JSP &&
+ 	    INTEL_PCH_TYPE(dev_priv) < PCH_DG1)
+ 		intel_de_rmw(dev_priv, SOUTH_DSPCLK_GATE_D, 0,
+ 			     PCH_DPMGUNIT_CLOCK_GATE_DISABLE);
+ 
++>>>>>>> ea27113ea90c (drm/i915/adl_s: Add display WAs for ADL-S)
  	/* 1. Enable PCH reset handshake. */
  	intel_pch_reset_handshake(dev_priv, !HAS_PCH_NOP(dev_priv));
  
* Unmerged path drivers/gpu/drm/i915/display/intel_display_power.c
diff --git a/drivers/gpu/drm/i915/display/intel_sprite.c b/drivers/gpu/drm/i915/display/intel_sprite.c
index 18adae9a6fa2..fab575a24456 100644
--- a/drivers/gpu/drm/i915/display/intel_sprite.c
+++ b/drivers/gpu/drm/i915/display/intel_sprite.c
@@ -2182,8 +2182,8 @@ static int skl_plane_check_fb(const struct intel_crtc_state *crtc_state,
 		return -EINVAL;
 	}
 
-	/* Wa_1606054188:tgl */
-	if (IS_TIGERLAKE(dev_priv) &&
+	/* Wa_1606054188:tgl,adl-s */
+	if ((IS_ALDERLAKE_S(dev_priv) || IS_TIGERLAKE(dev_priv)) &&
 	    plane_state->ckey.flags & I915_SET_COLORKEY_SOURCE &&
 	    intel_format_is_p01x(fb->format->format)) {
 		drm_dbg_kms(&dev_priv->drm,
diff --git a/drivers/gpu/drm/i915/intel_device_info.c b/drivers/gpu/drm/i915/intel_device_info.c
index 9fd850d9747f..d10440578298 100644
--- a/drivers/gpu/drm/i915/intel_device_info.c
+++ b/drivers/gpu/drm/i915/intel_device_info.c
@@ -373,7 +373,11 @@ void intel_device_info_runtime_init(struct drm_i915_private *dev_priv)
 	struct intel_runtime_info *runtime = RUNTIME_INFO(dev_priv);
 	enum pipe pipe;
 
-	if (INTEL_GEN(dev_priv) >= 10) {
+	/* Wa_14011765242: adl-s A0 */
+	if (IS_ADLS_DISP_STEPPING(dev_priv, STEP_A0, STEP_A0))
+		for_each_pipe(dev_priv, pipe)
+			runtime->num_scalers[pipe] = 0;
+	else if (INTEL_GEN(dev_priv) >= 10) {
 		for_each_pipe(dev_priv, pipe)
 			runtime->num_scalers[pipe] = 2;
 	} else if (IS_GEN(dev_priv, 9)) {
