mm/hmm: cleanup the hmm_vma_walk_hugetlb_entry stub

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-326.el8
commit-author Christoph Hellwig <hch@lst.de>
commit 251bbe59b7a6362f4c417aa8af281d44f9edfa0e
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-326.el8/251bbe59.failed

Stub out the whole function and assign NULL to the .hugetlb_entry method
if CONFIG_HUGETLB_PAGE is not set, as the method won't ever be called in
that case.

Link: https://lore.kernel.org/r/20190806160554.14046-13-hch@lst.de
	Signed-off-by: Christoph Hellwig <hch@lst.de>
	Reviewed-by: Jason Gunthorpe <jgg@mellanox.com>
	Signed-off-by: Jason Gunthorpe <jgg@mellanox.com>
(cherry picked from commit 251bbe59b7a6362f4c417aa8af281d44f9edfa0e)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	mm/hmm.c
diff --cc mm/hmm.c
index f3a944f2b312,ef553e664061..000000000000
--- a/mm/hmm.c
+++ b/mm/hmm.c
@@@ -802,23 -753,33 +802,28 @@@ static int hmm_vma_walk_pud(pud_t *pudp
  			hmm_vma_walk->pgmap = NULL;
  		}
  		hmm_vma_walk->last = end;
 -		return 0;
 +		goto out_unlock;
  	}
  
 -	split_huge_pud(walk->vma, pudp, addr);
 -	if (pud_none(*pudp))
 -		goto again;
 -
 -	pmdp = pmd_offset(pudp, addr);
 -	do {
 -		next = pmd_addr_end(addr, end);
 -		ret = hmm_vma_walk_pmd(pmdp, addr, next, walk);
 -		if (ret)
 -			return ret;
 -	} while (pmdp++, addr = next, addr != end);
 +	/* Ask for the PUD to be split */
 +	walk->action = ACTION_SUBTREE;
  
 -	return 0;
 +out_unlock:
 +	spin_unlock(ptl);
 +	return ret;
  }
 -#else
 -#define hmm_vma_walk_pud	NULL
 -#endif
  
+ #ifdef CONFIG_HUGETLB_PAGE
  static int hmm_vma_walk_hugetlb_entry(pte_t *pte, unsigned long hmask,
  				      unsigned long start, unsigned long end,
  				      struct mm_walk *walk)
  {
++<<<<<<< HEAD
 +#ifdef CONFIG_HUGETLB_PAGE
 +	unsigned long addr = start, i, pfn, mask, size, pfn_inc;
++=======
+ 	unsigned long addr = start, i, pfn;
++>>>>>>> 251bbe59b7a6 (mm/hmm: cleanup the hmm_vma_walk_hugetlb_entry stub)
  	struct hmm_vma_walk *hmm_vma_walk = walk->private;
  	struct hmm_range *range = hmm_vma_walk->range;
  	struct vm_area_struct *vma = walk->vma;
* Unmerged path mm/hmm.c
