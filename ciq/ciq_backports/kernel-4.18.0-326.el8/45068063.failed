xfs: fix incorrect root dquot corruption error when switching group/project quota types

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-326.el8
commit-author Darrick J. Wong <djwong@kernel.org>
commit 45068063efb7dd0a8d115c106aa05d9ab0946257
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-326.el8/45068063.failed

While writing up a regression test for broken behavior when a chprojid
request fails, I noticed that we were logging corruption notices about
the root dquot of the group/project quota file at mount time when
testing V4 filesystems.

In commit afeda6000b0c, I was trying to improve ondisk dquot validation
by making sure that when we load an ondisk dquot into memory on behalf
of an incore dquot, the dquot id and type matches.  Unfortunately, I
forgot that V4 filesystems only have two quota files, and can switch
that file between group and project quota types at mount time.  When we
perform that switch, we'll try to load the default quota limits from the
root dquot prior to running quotacheck and log a corruption error when
the types don't match.

This is inconsequential because quotacheck will reset the second quota
file as part of doing the switch, but we shouldn't leave scary messages
in the kernel log.

Fixes: afeda6000b0c ("xfs: validate ondisk/incore dquot flags")
	Signed-off-by: Darrick J. Wong <djwong@kernel.org>
	Reviewed-by: Brian Foster <bfoster@redhat.com>
	Reviewed-by: Chandan Babu R <chandanrlinux@gmail.com>
(cherry picked from commit 45068063efb7dd0a8d115c106aa05d9ab0946257)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	fs/xfs/xfs_dquot.c
diff --cc fs/xfs/xfs_dquot.c
index a16b354dd09b,bd8379b98374..000000000000
--- a/fs/xfs/xfs_dquot.c
+++ b/fs/xfs/xfs_dquot.c
@@@ -526,8 -554,7 +562,12 @@@ xfs_dquot_from_disk
  	 * Ensure that we got the type and ID we were looking for.
  	 * Everything else was checked by the dquot buffer verifier.
  	 */
++<<<<<<< HEAD
 +	if ((ddqp->d_flags & XFS_DQTYPE_REC_MASK) != dqp->dq_flags ||
 +	    be32_to_cpu(ddqp->d_id) != dqp->q_id) {
++=======
+ 	if (!xfs_dquot_check_type(dqp, ddqp)) {
++>>>>>>> 45068063efb7 (xfs: fix incorrect root dquot corruption error when switching group/project quota types)
  		xfs_alert_tag(bp->b_mount, XFS_PTAG_VERIFIER_ERROR,
  			  "Metadata corruption detected at %pS, quota %u",
  			  __this_address, dqp->q_id);
* Unmerged path fs/xfs/xfs_dquot.c
