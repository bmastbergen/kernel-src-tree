drm/i915/adl_s: Add adl-s ddc pin mapping

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-326.el8
commit-author Aditya Swarup <aditya.swarup@intel.com>
commit 7dc1f92f27f8d7046ff4bd4cb113b1f522b175e8
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-326.el8/7dc1f92f.failed

ADL-S requires TC pins to set up ddc for Combo PHY B, C, D and E.
Combo PHY A still uses the old ddc pin mapping.

From VBT, ddc pin info suggests the following mapping:
VBT 			               DRIVER
DDI B->ddc_pin=2 should translate to PORT_D->0x9
DDI C->ddc_pin=3 should translate to PORT_E->0xa
DDI D->ddc_pin=4 should translate to PORT_F->0xb
DDI E->ddc_pin=5 should translate to PORT_G->0xc

Adding pin map to facilitate this translation as we cannot use existing
icl ddc pin map due to conflict with DDI B and DDI C info.

Bspec:20124

v2: Replace IS_ALDERLAKE_S() with HAS_PCH_ADP() as the pin map pairing
depends on the PCH being used rather than the platform.(mdroper)

v3:
- Modify adls_port_to_ddc_pin() to make PHY_A the special case for
  check, else return pin mapping based on correct arithmetic with phy
  offset. Remove redundant platform checks and use HAS_PCH_ADP() instead
  of IS_ALDERLAKE_S() in intel_hdmi_ddc_pin().(mdroper)

	Cc: Jani Nikula <jani.nikula@intel.com>
	Cc: Ville Syrjälä <ville.syrjala@linux.intel.com>
	Cc: Imre Deak <imre.deak@intel.com>
	Cc: Matt Roper <matthew.d.roper@intel.com>
	Cc: Lucas De Marchi <lucas.demarchi@intel.com>
	Signed-off-by: Aditya Swarup <aditya.swarup@intel.com>
	Reviewed-by: Lucas De Marchi <lucas.demarchi@intel.com>
	Signed-off-by: Lucas De Marchi <lucas.demarchi@intel.com>
Link: https://patchwork.freedesktop.org/patch/msgid/20210125140753.347998-9-aditya.swarup@intel.com
(cherry picked from commit 7dc1f92f27f8d7046ff4bd4cb113b1f522b175e8)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/gpu/drm/i915/display/intel_bios.c
#	drivers/gpu/drm/i915/display/intel_hdmi.c
diff --cc drivers/gpu/drm/i915/display/intel_bios.c
index 91ccc327af09,e575e584e6d5..000000000000
--- a/drivers/gpu/drm/i915/display/intel_bios.c
+++ b/drivers/gpu/drm/i915/display/intel_bios.c
@@@ -1609,7 -1643,12 +1617,16 @@@ static u8 map_ddc_pin(struct drm_i915_p
  	const u8 *ddc_pin_map;
  	int n_entries;
  
++<<<<<<< HEAD
 +	if (IS_ROCKETLAKE(dev_priv) && INTEL_PCH_TYPE(dev_priv) == PCH_TGP) {
++=======
+ 	if (HAS_PCH_ADP(dev_priv)) {
+ 		ddc_pin_map = adls_ddc_pin_map;
+ 		n_entries = ARRAY_SIZE(adls_ddc_pin_map);
+ 	} else if (INTEL_PCH_TYPE(dev_priv) >= PCH_DG1) {
+ 		return vbt_pin;
+ 	} else if (IS_ROCKETLAKE(dev_priv) && INTEL_PCH_TYPE(dev_priv) == PCH_TGP) {
++>>>>>>> 7dc1f92f27f8 (drm/i915/adl_s: Add adl-s ddc pin mapping)
  		ddc_pin_map = rkl_pch_tgp_ddc_pin_map;
  		n_entries = ARRAY_SIZE(rkl_pch_tgp_ddc_pin_map);
  	} else if (INTEL_PCH_TYPE(dev_priv) >= PCH_ICP) {
diff --cc drivers/gpu/drm/i915/display/intel_hdmi.c
index de2ce5632b94,0fe9094a0d2a..000000000000
--- a/drivers/gpu/drm/i915/display/intel_hdmi.c
+++ b/drivers/gpu/drm/i915/display/intel_hdmi.c
@@@ -3110,6 -3130,27 +3110,30 @@@ static u8 rkl_port_to_ddc_pin(struct dr
  	return GMBUS_PIN_1_BXT + phy;
  }
  
++<<<<<<< HEAD
++=======
+ static u8 dg1_port_to_ddc_pin(struct drm_i915_private *dev_priv, enum port port)
+ {
+ 	return intel_port_to_phy(dev_priv, port) + 1;
+ }
+ 
+ static u8 adls_port_to_ddc_pin(struct drm_i915_private *dev_priv, enum port port)
+ {
+ 	enum phy phy = intel_port_to_phy(dev_priv, port);
+ 
+ 	WARN_ON(port == PORT_B || port == PORT_C);
+ 
+ 	/*
+ 	 * Pin mapping for ADL-S requires TC pins for all combo phy outputs
+ 	 * except first combo output.
+ 	 */
+ 	if (phy == PHY_A)
+ 		return GMBUS_PIN_1_BXT;
+ 
+ 	return GMBUS_PIN_9_TC1_ICP + phy - PHY_B;
+ }
+ 
++>>>>>>> 7dc1f92f27f8 (drm/i915/adl_s: Add adl-s ddc pin mapping)
  static u8 g4x_port_to_ddc_pin(struct drm_i915_private *dev_priv,
  			      enum port port)
  {
@@@ -3147,7 -3188,11 +3171,15 @@@ static u8 intel_hdmi_ddc_pin(struct int
  		return ddc_pin;
  	}
  
++<<<<<<< HEAD
 +	if (IS_ROCKETLAKE(dev_priv))
++=======
+ 	if (HAS_PCH_ADP(dev_priv))
+ 		ddc_pin = adls_port_to_ddc_pin(dev_priv, port);
+ 	else if (INTEL_PCH_TYPE(dev_priv) >= PCH_DG1)
+ 		ddc_pin = dg1_port_to_ddc_pin(dev_priv, port);
+ 	else if (IS_ROCKETLAKE(dev_priv))
++>>>>>>> 7dc1f92f27f8 (drm/i915/adl_s: Add adl-s ddc pin mapping)
  		ddc_pin = rkl_port_to_ddc_pin(dev_priv, port);
  	else if (HAS_PCH_MCC(dev_priv))
  		ddc_pin = mcc_port_to_ddc_pin(dev_priv, port);
* Unmerged path drivers/gpu/drm/i915/display/intel_bios.c
* Unmerged path drivers/gpu/drm/i915/display/intel_hdmi.c
diff --git a/drivers/gpu/drm/i915/display/intel_vbt_defs.h b/drivers/gpu/drm/i915/display/intel_vbt_defs.h
index 40196043c23d..7f712de9758e 100644
--- a/drivers/gpu/drm/i915/display/intel_vbt_defs.h
+++ b/drivers/gpu/drm/i915/display/intel_vbt_defs.h
@@ -323,6 +323,10 @@ enum vbt_gmbus_ddi {
 	ICL_DDC_BUS_PORT_4,
 	TGL_DDC_BUS_PORT_5,
 	TGL_DDC_BUS_PORT_6,
+	ADLS_DDC_BUS_PORT_TC1 = 0x2,
+	ADLS_DDC_BUS_PORT_TC2,
+	ADLS_DDC_BUS_PORT_TC3,
+	ADLS_DDC_BUS_PORT_TC4
 };
 
 #define DP_AUX_A 0x40
