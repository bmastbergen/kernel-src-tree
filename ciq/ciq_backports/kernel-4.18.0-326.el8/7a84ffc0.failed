s390/boot: add build-id to decompressor

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-326.el8
commit-author Philipp Rudo <prudo@linux.ibm.com>
commit 7a84ffc0471f0ff59f9ae10807a77bd666e24fd0
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-326.el8/7a84ffc0.failed

More and more functionality from the early boot phase gets carried over
to the decompressor. With this the complexity of the code and thus the
chance to introduce bugs increases. In order to be able to debug these
early boot bugs the distributions have to package the decompressors
vmlinux together with the other debuginfos. However for that the
distributions require the vmlinux to contain a build-id.

Per default the section containing the build-id is placed first in the
section table. So make sure to move it behind the .text section
otherwise the image would be unbootable.

	Signed-off-by: Philipp Rudo <prudo@linux.ibm.com>
	Signed-off-by: Heiko Carstens <hca@linux.ibm.com>
(cherry picked from commit 7a84ffc0471f0ff59f9ae10807a77bd666e24fd0)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/s390/boot/compressed/Makefile
diff --cc arch/s390/boot/compressed/Makefile
index b1bdd15e3429,de18dab518bb..000000000000
--- a/arch/s390/boot/compressed/Makefile
+++ b/arch/s390/boot/compressed/Makefile
@@@ -20,11 -21,28 +20,16 @@@ KBUILD_CFLAGS := $(KBUILD_CFLAGS_DECOMP
  OBJCOPYFLAGS :=
  
  OBJECTS := $(addprefix $(obj)/,$(obj-y))
 -OBJECTS_ALL := $(addprefix $(obj)/,$(obj-all))
  
++<<<<<<< HEAD
 +LDFLAGS_vmlinux := --oformat $(LD_BFD) -e startup -T
 +$(obj)/vmlinux: $(obj)/vmlinux.lds $(objtree)/arch/s390/boot/startup.a $(OBJECTS) FORCE
++=======
+ LDFLAGS_vmlinux := --oformat $(LD_BFD) -e startup --build-id=sha1 -T
+ $(obj)/vmlinux: $(obj)/vmlinux.lds $(objtree)/arch/s390/boot/startup.a $(OBJECTS_ALL) FORCE
++>>>>>>> 7a84ffc0471f (s390/boot: add build-id to decompressor)
  	$(call if_changed,ld)
  
 -LDFLAGS_vmlinux.syms := --oformat $(LD_BFD) -e startup -T
 -$(obj)/vmlinux.syms: $(obj)/vmlinux.lds $(objtree)/arch/s390/boot/startup.a $(OBJECTS) FORCE
 -	$(call if_changed,ld)
 -
 -quiet_cmd_dumpsyms = DUMPSYMS $<
 -define cmd_dumpsyms
 -	$(NM) -n -S --format=bsd "$<" | $(PERL) -ne '/(\w+)\s+(\w+)\s+[tT]\s+(\w+)/ and printf "%x %x %s\0",hex $$1,hex $$2,$$3' > "$@"
 -endef
 -
 -$(obj)/syms.bin: $(obj)/vmlinux.syms FORCE
 -	$(call if_changed,dumpsyms)
 -
 -OBJCOPYFLAGS_syms.o := -I binary -O elf64-s390 -B s390:64-bit --rename-section .data=.decompressor.syms
 -$(obj)/syms.o: $(obj)/syms.bin FORCE
 -	$(call if_changed,objcopy)
 -
  OBJCOPYFLAGS_info.bin := -O binary --only-section=.vmlinux.info --set-section-flags .vmlinux.info=load
  $(obj)/info.bin: vmlinux FORCE
  	$(call if_changed,objcopy)
* Unmerged path arch/s390/boot/compressed/Makefile
diff --git a/arch/s390/boot/compressed/vmlinux.lds.S b/arch/s390/boot/compressed/vmlinux.lds.S
index 112b8d9f1e4c..5042469c301b 100644
--- a/arch/s390/boot/compressed/vmlinux.lds.S
+++ b/arch/s390/boot/compressed/vmlinux.lds.S
@@ -27,6 +27,7 @@ SECTIONS
 		*(.rodata.*)
 		_erodata = . ;
 	}
+	NOTES
 	.data :	{
 		_data = . ;
 		*(.data)
