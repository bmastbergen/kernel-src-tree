ASoC: codecs/jz4770: Add DAPM widget to set HP out to cap-less mode

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-326.el8
commit-author Paul Cercueil <paul@crapouillou.net>
commit e648e3f1165354f04a4deed1f41152a287b68d59
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-326.el8/e648e3f1.failed

Cap-less mode is useful e.g. if the headphones are used as an antenna
for a FM radio, so that the signal is not altered. For everything else,
we want the cap-couple mode.

	Signed-off-by: Paul Cercueil <paul@crapouillou.net>
Link: https://lore.kernel.org/r/20201207125338.119397-5-paul@crapouillou.net
	Signed-off-by: Mark Brown <broonie@kernel.org>
(cherry picked from commit e648e3f1165354f04a4deed1f41152a287b68d59)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	sound/soc/codecs/jz4770.c
diff --cc sound/soc/codecs/jz4770.c
index 332b8cbb8293,c9fe7f72bfcb..000000000000
--- a/sound/soc/codecs/jz4770.c
+++ b/sound/soc/codecs/jz4770.c
@@@ -624,31 -624,27 +627,36 @@@ static void jz4770_codec_codec_init_reg
  			   REG_IMR_GDO_MASK);
  
  	/* 12M oscillator */
 -	regmap_clear_bits(regmap, JZ4770_CODEC_REG_CCR, REG_CCR_CRYSTAL_MASK);
 +	regmap_update_bits(regmap, JZ4770_CODEC_REG_CCR,
 +			   REG_CCR_CRYSTAL_MASK, 0);
  
  	/* 0: 16ohm/220uF, 1: 10kohm/1uF */
 -	regmap_clear_bits(regmap, JZ4770_CODEC_REG_CR_HP, REG_CR_HP_LOAD);
 +	regmap_update_bits(regmap, JZ4770_CODEC_REG_CR_HP,
 +			   REG_CR_HP_LOAD, 0);
  
  	/* disable automatic gain */
 -	regmap_clear_bits(regmap, JZ4770_CODEC_REG_AGC1, REG_AGC1_EN);
 +	regmap_update_bits(regmap, JZ4770_CODEC_REG_AGC1, REG_AGC1_EN, 0);
  
  	/* Disable DAC lrswap */
 -	regmap_set_bits(regmap, JZ4770_CODEC_REG_CR_DAC, REG_CR_DAC_LRSWAP);
 +	regmap_update_bits(regmap, JZ4770_CODEC_REG_CR_DAC,
 +			   REG_CR_DAC_LRSWAP, REG_CR_DAC_LRSWAP);
  
  	/* Independent L/R DAC gain control */
 -	regmap_clear_bits(regmap, JZ4770_CODEC_REG_GCR_DACL,
 -			  REG_GCR_DACL_RLGOD);
 +	regmap_update_bits(regmap, JZ4770_CODEC_REG_GCR_DACL,
 +			   REG_GCR_DACL_RLGOD, 0);
  
  	/* Disable ADC lrswap */
 -	regmap_set_bits(regmap, JZ4770_CODEC_REG_CR_ADC, REG_CR_ADC_LRSWAP);
 +	regmap_update_bits(regmap, JZ4770_CODEC_REG_CR_ADC,
 +			   REG_CR_ADC_LRSWAP, REG_CR_ADC_LRSWAP);
  
  	/* default to cap-less mode(0) */
++<<<<<<< HEAD
 +	regmap_update_bits(regmap, JZ4770_CODEC_REG_CR_HP,
 +			   REG_CR_HP_SB_HPCM, 0);
++=======
+ 	regmap_clear_bits(regmap, JZ4770_CODEC_REG_CR_HP,
+ 			  BIT(REG_CR_HP_SB_HPCM_OFFSET));
++>>>>>>> e648e3f11653 (ASoC: codecs/jz4770: Add DAPM widget to set HP out to cap-less mode)
  
  	/* Send collected updates. */
  	regcache_cache_only(regmap, false);
* Unmerged path sound/soc/codecs/jz4770.c
