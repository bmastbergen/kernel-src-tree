drm/i915/adl_s: Add GT and CTX WAs for ADL-S

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-326.el8
commit-author Aditya Swarup <aditya.swarup@intel.com>
commit 4043277ad18fc7cb9a79d0d043063fb5f42a6f06
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-326.el8/4043277a.failed

- Extend Wa_1606931601 and Wa_1409804808 to ADL-S.
- Extend Wa_14010919138 and Wa_14010229206 to ADL-S (Madhumitha)
- Extend Wa_22010271021 to ADLS (cyokoyam)

v2:
- Extend Wa_1409804808 and remove unnecessary branching/redundant
  adls workaround placeholder functions.
- Split WAs properly based on previous platforms and applicable ADLS
  WA.

	Cc: Jani Nikula <jani.nikula@intel.com>
	Cc: Ville Syrjälä <ville.syrjala@linux.intel.com>
	Cc: Imre Deak <imre.deak@intel.com>
	Cc: Matt Roper <matthew.d.roper@intel.com>
	Cc: Lucas De Marchi <lucas.demarchi@intel.com>
	Signed-off-by: Madhumitha Tolakanahalli Pradeep <madhumitha.tolakanahalli.pradeep@intel.com>
	Signed-off-by: Aditya Swarup <aditya.swarup@intel.com>
	Reviewed-by: Matt Roper <matthew.d.roper@intel.com>
	Signed-off-by: José Roberto de Souza <jose.souza@intel.com>
Link: https://patchwork.freedesktop.org/patch/msgid/20210129182945.217078-9-aditya.swarup@intel.com
(cherry picked from commit 4043277ad18fc7cb9a79d0d043063fb5f42a6f06)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/gpu/drm/i915/gt/intel_workarounds.c
diff --cc drivers/gpu/drm/i915/gt/intel_workarounds.c
index 9cc4a89424f5,53f7838bd3c4..000000000000
--- a/drivers/gpu/drm/i915/gt/intel_workarounds.c
+++ b/drivers/gpu/drm/i915/gt/intel_workarounds.c
@@@ -653,7 -728,10 +653,14 @@@ __intel_engine_init_ctx_wa(struct intel
  
  	wa_init_start(wal, name, engine->name);
  
++<<<<<<< HEAD
 +	if (IS_ROCKETLAKE(i915) || IS_TIGERLAKE(i915))
++=======
+ 	if (IS_DG1(i915))
+ 		dg1_ctx_workarounds_init(engine, wal);
+ 	else if (IS_ALDERLAKE_S(i915) || IS_ROCKETLAKE(i915) ||
+ 		 IS_TIGERLAKE(i915))
++>>>>>>> 4043277ad18f (drm/i915/adl_s: Add GT and CTX WAs for ADL-S)
  		tgl_ctx_workarounds_init(engine, wal);
  	else if (IS_GEN(i915, 12))
  		gen12_ctx_workarounds_init(engine, wal);
@@@ -1658,35 -1640,47 +1665,72 @@@ rcs_engine_wa_init(struct intel_engine_
  		wa_write_or(wal,
  			    GEN7_SARCHKMD,
  			    GEN7_DISABLE_SAMPLER_PREFETCH);
 +
 +		/* Wa_1408615072:tgl */
 +		wa_write_or(wal, UNSLICE_UNIT_LEVEL_CLKGATE2,
 +			    VSUNIT_CLKGATE_DIS_TGL);
  	}
  
++<<<<<<< HEAD
 +	if (IS_ROCKETLAKE(i915) || IS_TIGERLAKE(i915)) {
 +		/* Wa_1606931601:tgl,rkl */
 +		wa_masked_en(wal, GEN7_ROW_CHICKEN2, GEN12_DISABLE_EARLY_READ);
 +
 +		/* Wa_1409804808:tgl,rkl */
++=======
+ 	if (IS_ALDERLAKE_S(i915) || IS_DG1(i915) ||
+ 	    IS_ROCKETLAKE(i915) || IS_TIGERLAKE(i915)) {
+ 		/* Wa_1606931601:tgl,rkl,dg1,adl-s */
+ 		wa_masked_en(wal, GEN7_ROW_CHICKEN2, GEN12_DISABLE_EARLY_READ);
+ 
+ 		/*
+ 		 * Wa_1407928979:tgl A*
+ 		 * Wa_18011464164:tgl[B0+],dg1[B0+]
+ 		 * Wa_22010931296:tgl[B0+],dg1[B0+]
+ 		 * Wa_14010919138:rkl,dg1,adl-s
+ 		 */
+ 		wa_write_or(wal, GEN7_FF_THREAD_MODE,
+ 			    GEN12_FF_TESSELATION_DOP_GATE_DISABLE);
+ 
+ 		/*
+ 		 * Wa_1606700617:tgl,dg1
+ 		 * Wa_22010271021:tgl,rkl,dg1, adl-s
+ 		 */
+ 		wa_masked_en(wal,
+ 			     GEN9_CS_DEBUG_MODE1,
+ 			     FF_DOP_CLOCK_GATE_DISABLE);
+ 	}
+ 
+ 	if (IS_ALDERLAKE_S(i915) || IS_DG1_REVID(i915, DG1_REVID_A0, DG1_REVID_A0) ||
+ 	    IS_ROCKETLAKE(i915) || IS_TIGERLAKE(i915)) {
+ 		/* Wa_1409804808:tgl,rkl,dg1[a0],adl-s */
++>>>>>>> 4043277ad18f (drm/i915/adl_s: Add GT and CTX WAs for ADL-S)
  		wa_masked_en(wal, GEN7_ROW_CHICKEN2,
  			     GEN12_PUSH_CONST_DEREF_HOLD_DIS);
  
  		/*
  		 * Wa_1409085225:tgl
++<<<<<<< HEAD
 +		 * Wa_14010229206:tgl,rkl
++=======
+ 		 * Wa_14010229206:tgl,rkl,dg1[a0],adl-s
++>>>>>>> 4043277ad18f (drm/i915/adl_s: Add GT and CTX WAs for ADL-S)
  		 */
  		wa_masked_en(wal, GEN9_ROW_CHICKEN4, GEN12_DISABLE_TDL_PUSH);
+ 	}
+ 
  
+ 	if (IS_DG1_REVID(i915, DG1_REVID_A0, DG1_REVID_A0) ||
+ 	    IS_ROCKETLAKE(i915) || IS_TIGERLAKE(i915)) {
 +		/*
 +		 * Wa_1407928979:tgl A*
 +		 * Wa_18011464164:tgl B0+
 +		 * Wa_22010931296:tgl B0+
 +		 * Wa_14010919138:rkl
 +		 */
 +		wa_write_or(wal, GEN7_FF_THREAD_MODE,
 +			    GEN12_FF_TESSELATION_DOP_GATE_DISABLE);
 +
  		/*
  		 * Wa_1607030317:tgl
  		 * Wa_1607186500:tgl
@@@ -1698,16 -1695,15 +1742,23 @@@
  			     GEN6_RC_SLEEP_PSMI_CONTROL,
  			     GEN12_WAIT_FOR_EVENT_POWER_DOWN_DISABLE |
  			     GEN8_RC_SEMA_IDLE_MSG_DISABLE);
 +
 +		/*
 +		 * Wa_1606700617:tgl
 +		 * Wa_22010271021:tgl,rkl
 +		 */
 +		wa_masked_en(wal,
 +			     GEN9_CS_DEBUG_MODE1,
 +			     FF_DOP_CLOCK_GATE_DISABLE);
  	}
  
+ 	if (IS_DG1(i915) || IS_ROCKETLAKE(i915) || IS_TIGERLAKE(i915)) {
+ 		/* Wa_1406941453:tgl,rkl,dg1 */
+ 		wa_masked_en(wal,
+ 			     GEN10_SAMPLER_MODE,
+ 			     ENABLE_SMALLPL);
+ 	}
+ 
  	if (IS_GEN(i915, 11)) {
  		/* This is not an Wa. Enable for better image quality */
  		wa_masked_en(wal,
* Unmerged path drivers/gpu/drm/i915/gt/intel_workarounds.c
