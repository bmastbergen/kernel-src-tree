net/mlx5e: Add listener to trap event

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-326.el8
commit-author Aya Levin <ayal@nvidia.com>
commit 70038b73e40e2ce6bc4c8f25bbf0747b7a07a61f
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-326.el8/70038b73.failed

Add support for listening to blocking events in the ETH driver. Listen
on trap event. If received, call mlx5e_handle_trap_event() which:
1) Verifies if driver needs open/close trap-RQ with respect to the
active traps count.
2) Inspects trap id and its action (trap/drop) and add/remove the flow
steering rule accordingly.
Otherwise, return an error.

	Signed-off-by: Aya Levin <ayal@nvidia.com>
	Reviewed-by: Tariq Toukan <tariqt@nvidia.com>
	Signed-off-by: Tariq Toukan <tariqt@nvidia.com>
	Signed-off-by: Saeed Mahameed <saeedm@nvidia.com>
	Signed-off-by: Jakub Kicinski <kuba@kernel.org>
(cherry picked from commit 70038b73e40e2ce6bc4c8f25bbf0747b7a07a61f)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/mellanox/mlx5/core/en.h
#	drivers/net/ethernet/mellanox/mlx5/core/en_main.c
diff --cc drivers/net/ethernet/mellanox/mlx5/core/en.h
index 2e6376372a67,39f389cc40fc..000000000000
--- a/drivers/net/ethernet/mellanox/mlx5/core/en.h
+++ b/drivers/net/ethernet/mellanox/mlx5/core/en.h
@@@ -814,6 -859,8 +814,11 @@@ struct mlx5e_priv 
  	u16                        q_counter;
  	u16                        drop_rq_q_counter;
  	struct notifier_block      events_nb;
++<<<<<<< HEAD
++=======
+ 	struct notifier_block      blocking_events_nb;
+ 	int                        num_tc_x_num_ch;
++>>>>>>> 70038b73e40e (net/mlx5e: Add listener to trap event)
  
  	struct udp_tunnel_nic_info nic_info;
  #ifdef CONFIG_MLX5_CORE_EN_DCB
diff --cc drivers/net/ethernet/mellanox/mlx5/core/en_main.c
index 4b7d83e6ef25,3252919ec7bf..000000000000
--- a/drivers/net/ethernet/mellanox/mlx5/core/en_main.c
+++ b/drivers/net/ethernet/mellanox/mlx5/core/en_main.c
@@@ -64,7 -64,9 +64,13 @@@
  #include "en/hv_vhca_stats.h"
  #include "en/devlink.h"
  #include "lib/mlx5.h"
++<<<<<<< HEAD
 +#include "fpga/ipsec.h"
++=======
+ #include "en/ptp.h"
+ #include "qos.h"
+ #include "en/trap.h"
++>>>>>>> 70038b73e40e (net/mlx5e: Add listener to trap event)
  
  bool mlx5e_check_fragmented_striding_rq_cap(struct mlx5_core_dev *mdev)
  {
* Unmerged path drivers/net/ethernet/mellanox/mlx5/core/en.h
* Unmerged path drivers/net/ethernet/mellanox/mlx5/core/en_main.c
