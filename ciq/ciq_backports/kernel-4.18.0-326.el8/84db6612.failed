net/mlx5e: Move set vxlan nic info to profile init

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-326.el8
commit-author Roi Dayan <roid@nvidia.com>
commit 84db6612471416984685d37ab35ad30dffc28179
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-326.el8/84db6612.failed

Since its profile dependent let's init the vxlan info
as part of profile initialization.

	Signed-off-by: Roi Dayan <roid@nvidia.com>
	Signed-off-by: Saeed Mahameed <saeedm@nvidia.com>
(cherry picked from commit 84db6612471416984685d37ab35ad30dffc28179)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/mellanox/mlx5/core/en_main.c
#	drivers/net/ethernet/mellanox/mlx5/core/en_rep.c
diff --cc drivers/net/ethernet/mellanox/mlx5/core/en_main.c
index 4b7d83e6ef25,b9d2cb6f178d..000000000000
--- a/drivers/net/ethernet/mellanox/mlx5/core/en_main.c
+++ b/drivers/net/ethernet/mellanox/mlx5/core/en_main.c
@@@ -5048,20 -5221,13 +5046,25 @@@ void mlx5e_destroy_q_counters(struct ml
  }
  
  static int mlx5e_nic_init(struct mlx5_core_dev *mdev,
 -			  struct net_device *netdev)
 +			  struct net_device *netdev,
 +			  const struct mlx5e_profile *profile,
 +			  void *ppriv)
  {
  	struct mlx5e_priv *priv = netdev_priv(netdev);
 +	struct mlx5e_rss_params *rss = &priv->rss_params;
  	int err;
  
++<<<<<<< HEAD
 +	err = mlx5e_netdev_init(netdev, priv, mdev, profile, ppriv);
 +	if (err)
 +		return err;
 +
 +	mlx5e_build_nic_params(priv, &priv->xsk, rss, &priv->channels.params,
 +			       netdev->mtu);
++=======
+ 	mlx5e_build_nic_params(priv, &priv->xsk, netdev->mtu);
+ 	mlx5e_vxlan_set_netdev_info(priv);
++>>>>>>> 84db66124714 (net/mlx5e: Move set vxlan nic info to profile init)
  
  	mlx5e_timestamp_init(priv);
  
diff --cc drivers/net/ethernet/mellanox/mlx5/core/en_rep.c
index 18a3e93dfbd1,45669a1db426..000000000000
--- a/drivers/net/ethernet/mellanox/mlx5/core/en_rep.c
+++ b/drivers/net/ethernet/mellanox/mlx5/core/en_rep.c
@@@ -712,13 -713,10 +712,16 @@@ static void mlx5e_build_rep_params(stru
  	mlx5e_build_rss_params(&priv->rss_params, params->num_channels);
  }
  
 -static void mlx5e_build_rep_netdev(struct net_device *netdev,
 -				   struct mlx5_core_dev *mdev,
 -				   struct mlx5_eswitch_rep *rep)
 +static void mlx5e_build_rep_netdev(struct net_device *netdev)
  {
++<<<<<<< HEAD
 +	struct mlx5e_priv *priv = netdev_priv(netdev);
 +	struct mlx5e_rep_priv *rpriv = priv->ppriv;
 +	struct mlx5_eswitch_rep *rep = rpriv->rep;
 +	struct mlx5_core_dev *mdev = priv->mdev;
 +
++=======
++>>>>>>> 84db66124714 (net/mlx5e: Move set vxlan nic info to profile init)
  	SET_NETDEV_DEV(netdev, mdev->device);
  	if (rep->vport == MLX5_VPORT_UPLINK) {
  		netdev->netdev_ops = &mlx5e_netdev_ops_uplink_rep;
@@@ -778,9 -764,17 +780,18 @@@ static int mlx5e_init_rep(struct mlx5_c
  	return 0;
  }
  
+ static int mlx5e_init_ul_rep(struct mlx5_core_dev *mdev,
+ 			     struct net_device *netdev)
+ {
+ 	struct mlx5e_priv *priv = netdev_priv(netdev);
+ 
+ 	mlx5e_vxlan_set_netdev_info(priv);
+ 	return mlx5e_init_rep(mdev, netdev);
+ }
+ 
  static void mlx5e_cleanup_rep(struct mlx5e_priv *priv)
  {
 +	mlx5e_netdev_cleanup(priv->netdev, priv);
  }
  
  static int mlx5e_create_rep_ttc_table(struct mlx5e_priv *priv)
* Unmerged path drivers/net/ethernet/mellanox/mlx5/core/en_main.c
* Unmerged path drivers/net/ethernet/mellanox/mlx5/core/en_rep.c
