proc: use down_read_killable mmap_sem for /proc/pid/pagemap

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-326.el8
commit-author Konstantin Khlebnikov <khlebnikov@yandex-team.ru>
commit ad80b932c57d85fd6377f97f359b025baf179a87
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-326.el8/ad80b932.failed

Do not remain stuck forever if something goes wrong.  Using a killable
lock permits cleanup of stuck tasks and simplifies investigation.

Link: http://lkml.kernel.org/r/156007493638.3335.4872164955523928492.stgit@buzz
	Signed-off-by: Konstantin Khlebnikov <khlebnikov@yandex-team.ru>
	Reviewed-by: Roman Gushchin <guro@fb.com>
	Reviewed-by: Cyrill Gorcunov <gorcunov@gmail.com>
	Reviewed-by: Kirill Tkhai <ktkhai@virtuozzo.com>
	Acked-by: Michal Hocko <mhocko@suse.com>
	Cc: Alexey Dobriyan <adobriyan@gmail.com>
	Cc: Al Viro <viro@zeniv.linux.org.uk>
	Cc: Matthew Wilcox <willy@infradead.org>
	Cc: Michal Koutn√Ω <mkoutny@suse.com>
	Cc: Oleg Nesterov <oleg@redhat.com>
	Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
	Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
(cherry picked from commit ad80b932c57d85fd6377f97f359b025baf179a87)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	fs/proc/task_mmu.c
diff --cc fs/proc/task_mmu.c
index 906504b7b4de,78bed6adc62d..000000000000
--- a/fs/proc/task_mmu.c
+++ b/fs/proc/task_mmu.c
@@@ -1552,8 -1547,10 +1552,15 @@@ static ssize_t pagemap_read(struct fil
  		/* overflow ? */
  		if (end < start_vaddr || end > end_vaddr)
  			end = end_vaddr;
++<<<<<<< HEAD
 +		down_read(&mm->mmap_sem);
 +		ret = walk_page_range(mm, start_vaddr, end, &pagemap_ops, &pm);
++=======
+ 		ret = down_read_killable(&mm->mmap_sem);
+ 		if (ret)
+ 			goto out_free;
+ 		ret = walk_page_range(start_vaddr, end, &pagemap_walk);
++>>>>>>> ad80b932c57d (proc: use down_read_killable mmap_sem for /proc/pid/pagemap)
  		up_read(&mm->mmap_sem);
  		start_vaddr = end;
  
* Unmerged path fs/proc/task_mmu.c
