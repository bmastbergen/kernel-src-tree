netfilter: nft_exthdr: Support SCTP chunks

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-326.el8
commit-author Phil Sutter <phil@nwl.cc>
commit 133dc203d77dff617d9c4673973ef3859be2c476
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-326.el8/133dc203.failed

Chunks are SCTP header extensions similar in implementation to IPv6
extension headers or TCP options. Reusing exthdr expression to find and
extract field values from them is therefore pretty straightforward.

For now, this supports extracting data from chunks at a fixed offset
(and length) only - chunks themselves are an extensible data structure;
in order to make all fields available, a nested extension search is
needed.

	Signed-off-by: Phil Sutter <phil@nwl.cc>
	Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
(cherry picked from commit 133dc203d77dff617d9c4673973ef3859be2c476)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	include/uapi/linux/netfilter/nf_tables.h
#	net/netfilter/nft_exthdr.c
diff --cc include/uapi/linux/netfilter/nf_tables.h
index ecb2dda142e9,19715e2679d1..000000000000
--- a/include/uapi/linux/netfilter/nf_tables.h
+++ b/include/uapi/linux/netfilter/nf_tables.h
@@@ -754,10 -812,14 +754,20 @@@ enum nft_exthdr_flags 
   *
   * @NFT_EXTHDR_OP_IPV6: match against ipv6 extension headers
   * @NFT_EXTHDR_OP_TCP: match against tcp options
++<<<<<<< HEAD
++=======
+  * @NFT_EXTHDR_OP_IPV4: match against ipv4 options
+  * @NFT_EXTHDR_OP_SCTP: match against sctp chunks
++>>>>>>> 133dc203d77d (netfilter: nft_exthdr: Support SCTP chunks)
   */
  enum nft_exthdr_op {
  	NFT_EXTHDR_OP_IPV6,
  	NFT_EXTHDR_OP_TCPOPT,
++<<<<<<< HEAD
++=======
+ 	NFT_EXTHDR_OP_IPV4,
+ 	NFT_EXTHDR_OP_SCTP,
++>>>>>>> 133dc203d77d (netfilter: nft_exthdr: Support SCTP chunks)
  	__NFT_EXTHDR_OP_MAX
  };
  #define NFT_EXTHDR_OP_MAX	(__NFT_EXTHDR_OP_MAX - 1)
diff --cc net/netfilter/nft_exthdr.c
index 79d8531d95a7,4d0b8e1c40c0..000000000000
--- a/net/netfilter/nft_exthdr.c
+++ b/net/netfilter/nft_exthdr.c
@@@ -400,6 -570,16 +447,19 @@@ nft_exthdr_select_ops(const struct nft_
  		if (tb[NFTA_EXTHDR_DREG])
  			return &nft_exthdr_ipv6_ops;
  		break;
++<<<<<<< HEAD
++=======
+ 	case NFT_EXTHDR_OP_IPV4:
+ 		if (ctx->family != NFPROTO_IPV6) {
+ 			if (tb[NFTA_EXTHDR_DREG])
+ 				return &nft_exthdr_ipv4_ops;
+ 		}
+ 		break;
+ 	case NFT_EXTHDR_OP_SCTP:
+ 		if (tb[NFTA_EXTHDR_DREG])
+ 			return &nft_exthdr_sctp_ops;
+ 		break;
++>>>>>>> 133dc203d77d (netfilter: nft_exthdr: Support SCTP chunks)
  	}
  
  	return ERR_PTR(-EOPNOTSUPP);
* Unmerged path include/uapi/linux/netfilter/nf_tables.h
* Unmerged path net/netfilter/nft_exthdr.c
