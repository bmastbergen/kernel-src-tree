ALSA: usb-audio: Fix Pioneer DJM devices URB_CONTROL request direction to set samplerate

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-326.el8
commit-author Nicolas MURE <nicolas.mure2019@gmail.com>
commit 2c9119001dcb1dc7027257c5d8960d30f5ba58be
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-326.el8/2c911900.failed

This commit only contains the fix about the `URB_CONTROL` request
direction to set the samplerate of Pioneer DJM devices (`URB_CONTROL out`).

Fixes: 3b85f5fc75d5 ("ALSA: usb-audio: Add DJM450 to Pioneer format quirk")
	Signed-off-by: Nicolas MURE <nicolas.mure2019@gmail.com>
Link: https://lore.kernel.org/r/20210301142927.14552-1-nicolas.mure2019@gmail.com
	Signed-off-by: Takashi Iwai <tiwai@suse.de>
(cherry picked from commit 2c9119001dcb1dc7027257c5d8960d30f5ba58be)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	sound/usb/quirks.c
diff --cc sound/usb/quirks.c
index 581db82b9cb7,737b2729c0d3..000000000000
--- a/sound/usb/quirks.c
+++ b/sound/usb/quirks.c
@@@ -1485,27 -1470,20 +1485,32 @@@ static void set_format_emu_quirk(struc
  	subs->pkt_offset_adj = (emu_samplerate_id >= EMU_QUIRK_SR_176400HZ) ? 4 : 0;
  }
  
 -static int pioneer_djm_set_format_quirk(struct snd_usb_substream *subs,
 -					u16 windex)
 +
 +/*
 + * Pioneer DJ DJM-900NXS2
 + * Device needs to know the sample rate each time substream is started
 + */
 +static int pioneer_djm_set_format_quirk(struct snd_usb_substream *subs)
  {
 -	unsigned int cur_rate = subs->data_endpoint->cur_rate;
 +
 +	/* Convert sample rate value to little endian */
  	u8 sr[3];
 -	// Convert to little endian
 -	sr[0] = cur_rate & 0xff;
 -	sr[1] = (cur_rate >> 8) & 0xff;
 -	sr[2] = (cur_rate >> 16) & 0xff;
 +
 +	sr[0] = subs->cur_rate & 0xff;
 +	sr[1] = (subs->cur_rate >> 8) & 0xff;
 +	sr[2] = (subs->cur_rate >> 16) & 0xff;
 +
 +	/* Configure device */
  	usb_set_interface(subs->dev, 0, 1);
 -	// we should derive windex from fmt-sync_ep but it's not set
  	snd_usb_ctl_msg(subs->stream->chip->dev,
++<<<<<<< HEAD
 +		usb_rcvctrlpipe(subs->stream->chip->dev, 0),
 +		0x01, 0x22, 0x0100, 0x0082, &sr, 0x0003);
 +
++=======
+ 		usb_sndctrlpipe(subs->stream->chip->dev, 0),
+ 		0x01, 0x22, 0x0100, windex, &sr, 0x0003);
++>>>>>>> 2c9119001dcb (ALSA: usb-audio: Fix Pioneer DJM devices URB_CONTROL request direction to set samplerate)
  	return 0;
  }
  
* Unmerged path sound/usb/quirks.c
