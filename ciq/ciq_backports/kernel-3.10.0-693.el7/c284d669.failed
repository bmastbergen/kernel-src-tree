perf tools: Move parse_nsec_time to time-utils.c

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
commit-author David Ahern <dsa@cumulusnetworks.com>
commit c284d669a20d408b70ce0dc9b2d995971f5fe0c7
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/c284d669.failed

Code move only; no functional change intended.

Committer notes:

Fix the build on Ubuntu 16.04 x86-64 cross-compiling to S/390, with this
set of auto-detected features:

  ...                         dwarf: [ on  ]
  ...            dwarf_getlocations: [ on  ]
  ...                         glibc: [ on  ]
  ...                          gtk2: [ OFF ]
  ...                      libaudit: [ OFF ]
  ...                        libbfd: [ OFF ]
  ...                        libelf: [ on  ]
  ...                       libnuma: [ OFF ]
  ...        numa_num_possible_cpus: [ OFF ]
  ...                       libperl: [ OFF ]
  ...                     libpython: [ OFF ]
  ...                      libslang: [ OFF ]
  ...                     libcrypto: [ OFF ]
  ...                     libunwind: [ OFF ]
  ...            libdw-dwarf-unwind: [ on  ]
  ...                          zlib: [ on  ]
  ...                          lzma: [ OFF ]
  ...                     get_cpuid: [ OFF ]
  ...                           bpf: [ on  ]

Where it was failing with:

    CC       /tmp/build/perf/util/time-utils.o
  util/time-utils.c: In function 'parse_nsec_time':
  util/time-utils.c:17:13: error: implicit declaration of function 'strtoul' [-Werror=implicit-function-declaration]
    time_sec = strtoul(str, &end, 10);
               ^
  util/time-utils.c:17:2: error: nested extern declaration of 'strtoul' [-Werror=nested-externs]
    time_sec = strtoul(str, &end, 10);
    ^
  util/time-utils.c: In function 'perf_time__parse_str':
  util/time-utils.c:93:2: error: implicit declaration of function 'free' [-Werror=implicit-function-declaration]
    free(str);
    ^
  util/time-utils.c:93:2: error: incompatible implicit declaration of built-in function 'free' [-Werror]
  util/time-utils.c:93:2: note: include '<stdlib.h>' or provide a declaration of 'free'

Do as suggested and add a '#include <stdlib.h>' to get the free() and strtoul()
declarations and fix the build.

	Signed-off-by: David Ahern <dsahern@gmail.com>
	Acked-by: Namhyung Kim <namhyung@kernel.org>
	Cc: Jiri Olsa <jolsa@kernel.org>
	Cc: Peter Zijlstra <peterz@infradead.org>
Link: http://lkml.kernel.org/r/1480439746-42695-3-git-send-email-dsahern@gmail.com
	Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>
(cherry picked from commit c284d669a20d408b70ce0dc9b2d995971f5fe0c7)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	tools/perf/util/time-utils.c
#	tools/perf/util/time-utils.h
#	tools/perf/util/util.c
#	tools/perf/util/util.h
diff --cc tools/perf/util/util.c
index 6282ead1eed1,9ddd98827d12..000000000000
--- a/tools/perf/util/util.c
+++ b/tools/perf/util/util.c
@@@ -395,37 -400,12 +395,46 @@@ void sighandler_dump_stack(int sig
  	raise(sig);
  }
  
++<<<<<<< HEAD
 +int parse_nsec_time(const char *str, u64 *ptime)
 +{
 +	u64 time_sec, time_nsec;
 +	char *end;
 +
 +	time_sec = strtoul(str, &end, 10);
 +	if (*end != '.' && *end != '\0')
 +		return -1;
 +
 +	if (*end == '.') {
 +		int i;
 +		char nsec_buf[10];
 +
 +		if (strlen(++end) > 9)
 +			return -1;
 +
 +		strncpy(nsec_buf, end, 9);
 +		nsec_buf[9] = '\0';
 +
 +		/* make it nsec precision */
 +		for (i = strlen(nsec_buf); i < 9; i++)
 +			nsec_buf[i] = '0';
 +
 +		time_nsec = strtoul(nsec_buf, &end, 10);
 +		if (*end != '\0')
 +			return -1;
 +	} else
 +		time_nsec = 0;
 +
 +	*ptime = time_sec * NSEC_PER_SEC + time_nsec;
 +	return 0;
++=======
+ int timestamp__scnprintf_usec(u64 timestamp, char *buf, size_t sz)
+ {
+ 	u64  sec = timestamp / NSEC_PER_SEC;
+ 	u64 usec = (timestamp % NSEC_PER_SEC) / NSEC_PER_USEC;
+ 
+ 	return scnprintf(buf, sz, "%"PRIu64".%06"PRIu64, sec, usec);
++>>>>>>> c284d669a20d (perf tools: Move parse_nsec_time to time-utils.c)
  }
  
  unsigned long parse_tag_value(const char *str, struct parse_tag *tags)
diff --cc tools/perf/util/util.h
index f09e9397b5e7,1d639e38aa82..000000000000
--- a/tools/perf/util/util.h
+++ b/tools/perf/util/util.h
@@@ -179,12 -179,6 +179,15 @@@ static inline void *zalloc(size_t size
  #undef tolower
  #undef toupper
  
++<<<<<<< HEAD
 +#ifndef NSEC_PER_MSEC
 +#define NSEC_PER_MSEC	1000000L
 +#endif
 +
 +int parse_nsec_time(const char *str, u64 *ptime);
 +
++=======
++>>>>>>> c284d669a20d (perf tools: Move parse_nsec_time to time-utils.c)
  extern unsigned char sane_ctype[256];
  #define GIT_SPACE		0x01
  #define GIT_DIGIT		0x02
* Unmerged path tools/perf/util/time-utils.c
* Unmerged path tools/perf/util/time-utils.h
* Unmerged path tools/perf/util/time-utils.c
* Unmerged path tools/perf/util/time-utils.h
* Unmerged path tools/perf/util/util.c
* Unmerged path tools/perf/util/util.h
