net/mlx5e: Reorder update stats

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
Rebuild_CHGLOG: - [netdrv] mlx5e: Reorder update stats (Kamal Heib) [1409101]
Rebuild_FUZZ: 93.10%
commit-author Saeed Mahameed <saeedm@mellanox.com>
commit 3dd69e3dd21969a34406862ae299538e2e6387e7
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/3dd69e3d.failed

Reorder update stats flow to update most important counters last,
to get more accurate results.

New update order:
	- PCIe counters
	- Port counters
	- Vport counters
	- Queue counters
	- Software counters

	Signed-off-by: Saeed Mahameed <saeedm@mellanox.com>
	Reviewed-by: Gal Pressman <galp@mellanox.com>
(cherry picked from commit 3dd69e3dd21969a34406862ae299538e2e6387e7)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/mellanox/mlx5/core/en_main.c
diff --cc drivers/net/ethernet/mellanox/mlx5/core/en_main.c
index ae009c7fda21,3a06c81ef85e..000000000000
--- a/drivers/net/ethernet/mellanox/mlx5/core/en_main.c
+++ b/drivers/net/ethernet/mellanox/mlx5/core/en_main.c
@@@ -231,11 -297,34 +231,18 @@@ static void mlx5e_update_q_counter(stru
  				      &qcnt->rx_out_of_buffer);
  }
  
 -static void mlx5e_update_pcie_counters(struct mlx5e_priv *priv)
 -{
 -	struct mlx5e_pcie_stats *pcie_stats = &priv->stats.pcie;
 -	struct mlx5_core_dev *mdev = priv->mdev;
 -	int sz = MLX5_ST_SZ_BYTES(mpcnt_reg);
 -	void *out;
 -	u32 *in;
 -
 -	if (!MLX5_CAP_MCAM_FEATURE(mdev, pcie_performance_group))
 -		return;
 -
 -	in = mlx5_vzalloc(sz);
 -	if (!in)
 -		return;
 -
 -	out = pcie_stats->pcie_perf_counters;
 -	MLX5_SET(mpcnt_reg, in, grp, MLX5_PCIE_PERFORMANCE_COUNTERS_GROUP);
 -	mlx5_core_access_reg(mdev, in, sz, out, sz, MLX5_REG_MPCNT, 0, 0);
 -
 -	kvfree(in);
 -}
 -
  void mlx5e_update_stats(struct mlx5e_priv *priv)
  {
++<<<<<<< HEAD
 +	mlx5e_update_q_counter(priv);
 +	mlx5e_update_vport_counters(priv);
 +	mlx5e_update_pport_counters(priv);
++=======
+ 	mlx5e_update_pcie_counters(priv);
+ 	mlx5e_update_pport_counters(priv);
+ 	mlx5e_update_vport_counters(priv);
+ 	mlx5e_update_q_counter(priv);
++>>>>>>> 3dd69e3dd219 (net/mlx5e: Reorder update stats)
  	mlx5e_update_sw_counters(priv);
  }
  
* Unmerged path drivers/net/ethernet/mellanox/mlx5/core/en_main.c
