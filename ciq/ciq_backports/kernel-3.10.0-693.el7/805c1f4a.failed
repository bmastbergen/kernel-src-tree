net_sched: act: action flushing missaccounting

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
Rebuild_CHGLOG: - [net] sched: act: action flushing missaccounting (Ivan Vecera) [1428588]
Rebuild_FUZZ: 95.45%
commit-author Jamal Hadi Salim <jhs@mojatatu.com>
commit 805c1f4aedaba1bc8d839e7c27b128083dd5c2f0
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/805c1f4a.failed

action flushing missaccounting
Account only for deleted actions

	Signed-off-by: Jamal Hadi Salim <jhs@mojatatu.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 805c1f4aedaba1bc8d839e7c27b128083dd5c2f0)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/sched/act_api.c
diff --cc net/sched/act_api.c
index 163e7ffce598,f63e1467cd3a..000000000000
--- a/net/sched/act_api.c
+++ b/net/sched/act_api.c
@@@ -130,14 -124,12 +130,23 @@@ static int tcf_del_walker(struct sk_buf
  	if (nla_put_string(skb, TCA_KIND, a->ops->kind))
  		goto nla_put_failure;
  	for (i = 0; i < (hinfo->hmask + 1); i++) {
++<<<<<<< HEAD
 +		p = hinfo->htab[tcf_hash(i, hinfo->hmask)];
 +
 +		while (p != NULL) {
 +			s_p = p->tcfc_next;
 +			if (ACT_P_DELETED == tcf_hash_release(p, 0, hinfo))
 +				module_put(a->ops->owner);
 +			n_i++;
 +			p = s_p;
++=======
+ 		head = &hinfo->htab[tcf_hash(i, hinfo->hmask)];
+ 		hlist_for_each_entry_safe(p, n, head, tcfc_head) {
+ 			if (ACT_P_DELETED == tcf_hash_release(p, 0, hinfo)) {
+ 				module_put(a->ops->owner);
+ 				n_i++;
+ 			}
++>>>>>>> 805c1f4aedab (net_sched: act: action flushing missaccounting)
  		}
  	}
  	if (nla_put_u32(skb, TCA_FCNT, n_i))
* Unmerged path net/sched/act_api.c
