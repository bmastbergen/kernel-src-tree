amd-xgbe: Use disable_irq_nosync from within timer function

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
commit-author Lendacky, Thomas <Thomas.Lendacky@amd.com>
commit 078b29d7e92e4254b6de16097d0369dde17efe21
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/078b29d7.failed

Since the Tx timer function runs in softirq context the driver needs
to call disable_irq_nosync instead of a disable_irq.

	Reported-by: Josh Stone <jistone@redhat.com>
	Signed-off-by: Tom Lendacky <thomas.lendacky@amd.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 078b29d7e92e4254b6de16097d0369dde17efe21)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/amd/xgbe/xgbe-drv.c
diff --cc drivers/net/ethernet/amd/xgbe/xgbe-drv.c
index d58e85811bc9,9fd6c69a8bac..000000000000
--- a/drivers/net/ethernet/amd/xgbe/xgbe-drv.c
+++ b/drivers/net/ethernet/amd/xgbe/xgbe-drv.c
@@@ -275,14 -418,17 +275,21 @@@ static enum hrtimer_restart xgbe_tx_tim
  
  	DBGPR("-->xgbe_tx_timer\n");
  
 -	napi = (pdata->per_channel_irq) ? &channel->napi : &pdata->napi;
 +	spin_lock_irqsave(&ring->lock, flags);
  
 -	if (napi_schedule_prep(napi)) {
 +	if (napi_schedule_prep(&pdata->napi)) {
  		/* Disable Tx and Rx interrupts */
++<<<<<<< HEAD
 +		xgbe_disable_rx_tx_ints(pdata);
++=======
+ 		if (pdata->per_channel_irq)
+ 			disable_irq_nosync(channel->dma_irq);
+ 		else
+ 			xgbe_disable_rx_tx_ints(pdata);
++>>>>>>> 078b29d7e92e (amd-xgbe: Use disable_irq_nosync from within timer function)
  
  		/* Turn on polling */
 -		__napi_schedule(napi);
 +		__napi_schedule(&pdata->napi);
  	}
  
  	channel->tx_timer_active = 0;
* Unmerged path drivers/net/ethernet/amd/xgbe/xgbe-drv.c
