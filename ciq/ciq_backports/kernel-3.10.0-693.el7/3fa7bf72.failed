powerpc/eeh: Don't remove passed VFs

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
Rebuild_CHGLOG: - [powerpc] eeh: Don't remove passed VFs (Gustavo Duarte) [1315131]
Rebuild_FUZZ: 87.50%
commit-author Gavin Shan <gwshan@linux.vnet.ibm.com>
commit 3fa7bf7229993eac65fd6ade2ffc5f75150b40e1
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/3fa7bf72.failed

When we have partial hotplug as part of the error recovery on PF,
the VFs that are bound with vfio-pci driver will experience hotplug.
That's not allowed.

This checks if the VF PE is passed or not. If it does, we leave
the VF without removing it.

	Signed-off-by: Gavin Shan <gwshan@linux.vnet.ibm.com>
	Reviewed-by: Russell Currey <ruscur@russell.cc>
	Signed-off-by: Michael Ellerman <mpe@ellerman.id.au>
(cherry picked from commit 3fa7bf7229993eac65fd6ade2ffc5f75150b40e1)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/powerpc/kernel/eeh_driver.c
diff --cc arch/powerpc/kernel/eeh_driver.c
index bbb53ce6649e,fb6207d2c604..000000000000
--- a/arch/powerpc/kernel/eeh_driver.c
+++ b/arch/powerpc/kernel/eeh_driver.c
@@@ -439,10 -454,13 +439,18 @@@ static void *eeh_rmv_device(void *data
  	driver = eeh_pcid_get(dev);
  	if (driver) {
  		eeh_pcid_put(dev);
++<<<<<<< HEAD
 +		if (driver->err_handler &&
++=======
+ 		if (removed &&
+ 		    eeh_pe_passed(edev->pe))
+ 			return NULL;
+ 		if (removed &&
+ 		    driver->err_handler &&
++>>>>>>> 3fa7bf722999 (powerpc/eeh: Don't remove passed VFs)
  		    driver->err_handler->error_detected &&
 -		    driver->err_handler->slot_reset)
 +		    driver->err_handler->slot_reset &&
 +		    driver->err_handler->resume)
  			return NULL;
  	}
  
* Unmerged path arch/powerpc/kernel/eeh_driver.c
