x86/boot: Clarify purpose of functions in misc.c

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
Rebuild_CHGLOG: - [x86] boot: Clarify purpose of functions in misc.c (Baoquan He) [1290840]
Rebuild_FUZZ: 95.65%
commit-author Kees Cook <keescook@chromium.org>
commit c04028813221c2d39a4f368586795ac4466d311c
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/c0402881.failed

The function "decompress_kernel" now performs many more duties, so this
patch renames it to "extract_kernel" and updates callers and comments.
Additionally the file header comment for misc.c is improved to actually
describe what is contained.

	Suggested-by: Ingo Molnar <mingo@kernel.org>
	Signed-off-by: Kees Cook <keescook@chromium.org>
	Cc: Andrew Morton <akpm@linux-foundation.org>
	Cc: Andrey Ryabinin <aryabinin@virtuozzo.com>
	Cc: Andy Lutomirski <luto@amacapital.net>
	Cc: Andy Lutomirski <luto@kernel.org>
	Cc: Baoquan He <bhe@redhat.com>
	Cc: Borislav Petkov <bp@alien8.de>
	Cc: Borislav Petkov <bp@suse.de>
	Cc: Brian Gerst <brgerst@gmail.com>
	Cc: Denys Vlasenko <dvlasenk@redhat.com>
	Cc: Dmitry Vyukov <dvyukov@google.com>
	Cc: H. Peter Anvin <hpa@zytor.com>
	Cc: H.J. Lu <hjl.tools@gmail.com>
	Cc: Josh Poimboeuf <jpoimboe@redhat.com>
	Cc: Linus Torvalds <torvalds@linux-foundation.org>
	Cc: Peter Zijlstra <peterz@infradead.org>
	Cc: Thomas Gleixner <tglx@linutronix.de>
	Cc: Yinghai Lu <yinghai@kernel.org>
Link: http://lkml.kernel.org/r/1460997735-24785-5-git-send-email-keescook@chromium.org
	Signed-off-by: Ingo Molnar <mingo@kernel.org>
(cherry picked from commit c04028813221c2d39a4f368586795ac4466d311c)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/x86/boot/compressed/head_32.S
#	arch/x86/boot/compressed/head_64.S
#	arch/x86/boot/compressed/misc.c
diff --cc arch/x86/boot/compressed/head_32.S
index fe4cda99cc30,26dd9df19a69..000000000000
--- a/arch/x86/boot/compressed/head_32.S
+++ b/arch/x86/boot/compressed/head_32.S
@@@ -203,10 -233,11 +203,16 @@@ relocated
  2:
  
  /*
-  * Do the decompression, and jump to the new kernel..
+  * Do the extraction, and jump to the new kernel..
   */
++<<<<<<< HEAD
 +				/* push arguments for decompress_kernel: */
 +	pushl	$z_output_len	/* decompressed length */
++=======
+ 				/* push arguments for extract_kernel: */
+ 	pushl	$z_run_size	/* size of kernel with .bss and .brk */
+ 	pushl	$z_output_len	/* decompressed length, end of relocs */
++>>>>>>> c04028813221 (x86/boot: Clarify purpose of functions in misc.c)
  	leal	z_extract_offset_negative(%ebx), %ebp
  	pushl	%ebp		/* output address */
  	pushl	$z_input_len	/* input_len */
@@@ -215,14 -246,14 +221,19 @@@
  	leal	boot_heap(%ebx), %eax
  	pushl	%eax		/* heap area */
  	pushl	%esi		/* real mode pointer */
++<<<<<<< HEAD
 +	call	decompress_kernel
 +	addl	$24, %esp
++=======
+ 	call	extract_kernel	/* returns kernel location in %eax */
+ 	addl	$28, %esp
++>>>>>>> c04028813221 (x86/boot: Clarify purpose of functions in misc.c)
  
  /*
-  * Jump to the decompressed kernel.
+  * Jump to the extracted kernel.
   */
  	xorl	%ebx, %ebx
 -	jmp	*%eax
 +	jmp	*%ebp
  
  #ifdef CONFIG_EFI_STUB
  	.data
diff --cc arch/x86/boot/compressed/head_64.S
index 8b77c1f2c468,d43c30ed89ed..000000000000
--- a/arch/x86/boot/compressed/head_64.S
+++ b/arch/x86/boot/compressed/head_64.S
@@@ -398,16 -408,19 +398,22 @@@ relocated
  2:
  	
  /*
-  * Do the decompression, and jump to the new kernel..
+  * Do the extraction, and jump to the new kernel..
   */
  	pushq	%rsi			/* Save the real mode argument */
 -	movq	$z_run_size, %r9	/* size of kernel with .bss and .brk */
 -	pushq	%r9
  	movq	%rsi, %rdi		/* real mode address */
  	leaq	boot_heap(%rip), %rsi	/* malloc area for uncompression */
  	leaq	input_data(%rip), %rdx  /* input_data */
  	movl	$z_input_len, %ecx	/* input_len */
  	movq	%rbp, %r8		/* output target address */
++<<<<<<< HEAD
 +	movq	$z_output_len, %r9	/* decompressed length */
 +	call	decompress_kernel
++=======
+ 	movq	$z_output_len, %r9	/* decompressed length, end of relocs */
+ 	call	extract_kernel		/* returns kernel location in %rax */
+ 	popq	%r9
++>>>>>>> c04028813221 (x86/boot: Clarify purpose of functions in misc.c)
  	popq	%rsi
  
  /*
diff --cc arch/x86/boot/compressed/misc.c
index 136cb407d4ef,0d69e809673a..000000000000
--- a/arch/x86/boot/compressed/misc.c
+++ b/arch/x86/boot/compressed/misc.c
@@@ -368,7 -385,7 +370,11 @@@ static void parse_elf(void *output
  	free(phdrs);
  }
  
++<<<<<<< HEAD
 +asmlinkage void decompress_kernel(void *rmode, memptr heap,
++=======
+ asmlinkage __visible void *extract_kernel(void *rmode, memptr heap,
++>>>>>>> c04028813221 (x86/boot: Clarify purpose of functions in misc.c)
  				  unsigned char *input_data,
  				  unsigned long input_len,
  				  unsigned char *output,
@@@ -388,11 -410,11 +394,11 @@@
  		vidport = 0x3d4;
  	}
  
 -	lines = boot_params->screen_info.orig_video_lines;
 -	cols = boot_params->screen_info.orig_video_cols;
 +	lines = real_mode->screen_info.orig_video_lines;
 +	cols = real_mode->screen_info.orig_video_cols;
  
  	console_init();
- 	debug_putstr("early console in decompress_kernel\n");
+ 	debug_putstr("early console in extract_kernel\n");
  
  	free_mem_ptr     = heap;	/* Heap */
  	free_mem_end_ptr = heap + BOOT_HEAP_SIZE;
* Unmerged path arch/x86/boot/compressed/head_32.S
* Unmerged path arch/x86/boot/compressed/head_64.S
* Unmerged path arch/x86/boot/compressed/misc.c
