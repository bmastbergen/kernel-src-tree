perf tools: Show event fd in debug output

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
commit-author Jiri Olsa <jolsa@kernel.org>
commit 7b4b82bced0755aecc026d8c14c2608aa0f9e89b
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/7b4b82bc.failed

It is useful for debug to see file descriptors for each event.

Before:

  $ perf stat -vvv -e cycles,cache-misses ls
  ...
  sys_perf_event_open: pid 12146  cpu -1  group_fd -1  flags 0x8
  ...
  sys_perf_event_open: pid 12146  cpu -1  group_fd 3  flags 0x8
  sys_perf_event_open failed, error -13

Now:

  $ perf stat -vvv -e cycles,cache-misses ls
  ...
  sys_perf_event_open: pid 12858  cpu -1  group_fd -1  flags 0x8 = 3
  ...
  sys_perf_event_open: pid 12858  cpu -1  group_fd 3  flags 0x8
  sys_perf_event_open failed, error -13

	Signed-off-by: Jiri Olsa <jolsa@redhat.com>
	Tested-by: Arnaldo Carvalho de Melo <acme@redhat.com>
	Cc: Andi Kleen <andi@firstfloor.org>
	Cc: David Ahern <dsahern@gmail.com>
	Cc: Don Zickus <dzickus@redhat.com>
	Cc: Joe Mario <jmario@redhat.com>
	Cc: Namhyung Kim <namhyung@kernel.org>
	Cc: Peter Zijlstra <a.p.zijlstra@chello.nl>
Link: http://lkml.kernel.org/r/1479764011-10732-2-git-send-email-jolsa@kernel.org
	Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>
(cherry picked from commit 7b4b82bced0755aecc026d8c14c2608aa0f9e89b)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	tools/perf/util/evsel.c
diff --cc tools/perf/util/evsel.c
index f76f126b80c9,b2365a63db45..000000000000
--- a/tools/perf/util/evsel.c
+++ b/tools/perf/util/evsel.c
@@@ -1441,7 -1494,36 +1441,28 @@@ retry_open
  					  err);
  				goto try_fallback;
  			}
++<<<<<<< HEAD
++=======
+ 
+ 			pr_debug2(" = %d\n", FD(evsel, cpu, thread));
+ 
+ 			if (evsel->bpf_fd >= 0) {
+ 				int evt_fd = FD(evsel, cpu, thread);
+ 				int bpf_fd = evsel->bpf_fd;
+ 
+ 				err = ioctl(evt_fd,
+ 					    PERF_EVENT_IOC_SET_BPF,
+ 					    bpf_fd);
+ 				if (err && errno != EEXIST) {
+ 					pr_err("failed to attach bpf fd %d: %s\n",
+ 					       bpf_fd, strerror(errno));
+ 					err = -EINVAL;
+ 					goto out_close;
+ 				}
+ 			}
+ 
++>>>>>>> 7b4b82bced07 (perf tools: Show event fd in debug output)
  			set_rlimit = NO_CHANGE;
 -
 -			/*
 -			 * If we succeeded but had to kill clockid, fail and
 -			 * have perf_evsel__open_strerror() print us a nice
 -			 * error.
 -			 */
 -			if (perf_missing_features.clockid ||
 -			    perf_missing_features.clockid_wrong) {
 -				err = -EINVAL;
 -				goto out_close;
 -			}
  		}
  	}
  
* Unmerged path tools/perf/util/evsel.c
