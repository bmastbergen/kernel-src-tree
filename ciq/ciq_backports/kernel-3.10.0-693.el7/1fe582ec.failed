qed: Conserve RDMA resources when !QEDR

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
commit-author Ram Amrani <Ram.Amrani@Cavium.com>
commit 1fe582ecade714e90e71c67c32edb7b5b809d651
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/1fe582ec.failed

If qedr isn't part of the kernel then don't allocate RDMA resources
for it in qed.

	Signed-off-by: Ram Amrani <Ram.Amrani@cavium.com>
	Signed-off-by: Yuval Mintz <Yuval.Mintz@cavium.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 1fe582ecade714e90e71c67c32edb7b5b809d651)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/qlogic/qed/qed_mcp.c
diff --cc drivers/net/ethernet/qlogic/qed/qed_mcp.c
index dae4c0af6504,c8a877594032..000000000000
--- a/drivers/net/ethernet/qlogic/qed/qed_mcp.c
+++ b/drivers/net/ethernet/qlogic/qed/qed_mcp.c
@@@ -1010,11 -1122,10 +1010,18 @@@ qed_mcp_get_shmem_proto(struct qed_hwf
  
  	switch (p_info->config & FUNC_MF_CFG_PROTOCOL_MASK) {
  	case FUNC_MF_CFG_PROTOCOL_ETHERNET:
++<<<<<<< HEAD
 +		if (test_bit(QED_DEV_CAP_ROCE,
 +			     &p_hwfn->hw_info.device_capabilities))
 +			*p_proto = QED_PCI_ETH_ROCE;
 +		else
 +			*p_proto = QED_PCI_ETH;
++=======
+ 		if (!IS_ENABLED(CONFIG_QED_RDMA))
+ 			*p_proto = QED_PCI_ETH;
+ 		else if (qed_mcp_get_shmem_proto_mfw(p_hwfn, p_ptt, p_proto))
+ 			qed_mcp_get_shmem_proto_legacy(p_hwfn, p_proto);
++>>>>>>> 1fe582ecade7 (qed: Conserve RDMA resources when !QEDR)
  		break;
  	case FUNC_MF_CFG_PROTOCOL_ISCSI:
  		*p_proto = QED_PCI_ISCSI;
* Unmerged path drivers/net/ethernet/qlogic/qed/qed_mcp.c
