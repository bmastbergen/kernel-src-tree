PCI: Export pcie_find_root_port

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
Rebuild_CHGLOG: - [pci] Export pcie_find_root_port() (Myron Stowe) [1387674]
Rebuild_FUZZ: 88.14%
commit-author Johannes Thumshirn <jthumshirn@suse.de>
commit e784930bd645e7df78c66e7872fec282b0620075
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/e784930b.failed

Export pcie_find_root_port() so we can use it outside of PCIe-AER error
injection.

	Signed-off-by: Johannes Thumshirn <jthumshirn@suse.de>
	Signed-off-by: Bjorn Helgaas <bhelgaas@google.com>
(cherry picked from commit e784930bd645e7df78c66e7872fec282b0620075)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	include/linux/pci.h
diff --cc include/linux/pci.h
index 32d11cf0340d,a38772a85588..000000000000
--- a/include/linux/pci.h
+++ b/include/linux/pci.h
@@@ -1740,7 -1919,29 +1740,33 @@@ static inline u16 pcie_caps_reg(const s
  	return dev->pcie_flags_reg;
  }
  
++<<<<<<< HEAD
 +int pci_pcie_type(const struct pci_dev *dev);
++=======
+ /**
+  * pci_pcie_type - get the PCIe device/port type
+  * @dev: PCI device
+  */
+ static inline int pci_pcie_type(const struct pci_dev *dev)
+ {
+ 	return (pcie_caps_reg(dev) & PCI_EXP_FLAGS_TYPE) >> 4;
+ }
+ 
+ static inline struct pci_dev *pcie_find_root_port(struct pci_dev *dev)
+ {
+ 	while (1) {
+ 		if (!pci_is_pcie(dev))
+ 			break;
+ 		if (pci_pcie_type(dev) == PCI_EXP_TYPE_ROOT_PORT)
+ 			return dev;
+ 		if (!dev->bus->self)
+ 			break;
+ 		dev = dev->bus->self;
+ 	}
+ 	return NULL;
+ }
+ 
++>>>>>>> e784930bd645 (PCI: Export pcie_find_root_port)
  void pci_request_acs(void);
  bool pci_acs_enabled(struct pci_dev *pdev, u16 acs_flags);
  bool pci_acs_path_enabled(struct pci_dev *start,
diff --git a/drivers/pci/pcie/aer/aer_inject.c b/drivers/pci/pcie/aer/aer_inject.c
index 20db790465dd..b7e1fa227088 100644
--- a/drivers/pci/pcie/aer/aer_inject.c
+++ b/drivers/pci/pcie/aer/aer_inject.c
@@ -283,20 +283,6 @@ out:
 	return 0;
 }
 
-static struct pci_dev *pcie_find_root_port(struct pci_dev *dev)
-{
-	while (1) {
-		if (!pci_is_pcie(dev))
-			break;
-		if (pci_pcie_type(dev) == PCI_EXP_TYPE_ROOT_PORT)
-			return dev;
-		if (!dev->bus->self)
-			break;
-		dev = dev->bus->self;
-	}
-	return NULL;
-}
-
 static int find_aer_device_iter(struct device *device, void *data)
 {
 	struct pcie_device **result = data;
* Unmerged path include/linux/pci.h
