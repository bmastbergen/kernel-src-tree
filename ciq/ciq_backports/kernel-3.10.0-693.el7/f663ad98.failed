net/mlx5: Verify module parameters

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
Rebuild_CHGLOG: - [netdrv] mlx5: Verify module parameters (Don Dutile) [1385330 1417285]
Rebuild_FUZZ: 93.75%
commit-author Kamal Heib <kamalh@mellanox.com>
commit f663ad98623926b8d7bdef4b4648d10c0229aebe
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/f663ad98.failed

Verify the mlx5_core module parameters by making sure that they are in
the expected range and if they aren't restore them to their default
values.

Fixes: 9603b61de1ee ('mlx5: Move pci device handling from mlx5_ib to mlx5_core')
	Signed-off-by: Kamal Heib <kamalh@mellanox.com>
	Signed-off-by: Saeed Mahameed <saeedm@mellanox.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit f663ad98623926b8d7bdef4b4648d10c0229aebe)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/mellanox/mlx5/core/main.c
#	drivers/net/ethernet/mellanox/mlx5/core/mlx5_core.h
diff --cc drivers/net/ethernet/mellanox/mlx5/core/main.c
index 4a5d317bf909,22eb3be06651..000000000000
--- a/drivers/net/ethernet/mellanox/mlx5/core/main.c
+++ b/drivers/net/ethernet/mellanox/mlx5/core/main.c
@@@ -66,20 -67,10 +66,20 @@@ module_param_named(debug_mask, mlx5_cor
  MODULE_PARM_DESC(debug_mask, "debug mask: 1 = dump cmd data, 2 = dump cmd exec time, 3 = both. Default=0");
  
  #define MLX5_DEFAULT_PROF	2
- static int prof_sel = MLX5_DEFAULT_PROF;
- module_param_named(prof_sel, prof_sel, int, 0444);
+ static unsigned int prof_sel = MLX5_DEFAULT_PROF;
+ module_param_named(prof_sel, prof_sel, uint, 0444);
  MODULE_PARM_DESC(prof_sel, "profile selector. Valid range 0 - 2");
  
 +static LIST_HEAD(intf_list);
 +static LIST_HEAD(dev_list);
 +static DEFINE_MUTEX(intf_mutex);
 +
 +struct mlx5_device_context {
 +	struct list_head	list;
 +	struct mlx5_interface  *intf;
 +	void		       *context;
 +};
 +
  enum {
  	MLX5_ATOMIC_REQ_MODE_BE = 0x0,
  	MLX5_ATOMIC_REQ_MODE_HOST_ENDIANNESS = 0x1,
@@@ -1324,12 -1227,6 +1324,15 @@@ static int init_one(struct pci_dev *pde
  
  	dev->pdev = pdev;
  	dev->event = mlx5_core_event;
++<<<<<<< HEAD
 +
 +	if (prof_sel < 0 || prof_sel >= ARRAY_SIZE(profile)) {
 +		pr_warn("selected profile out of range, selecting default (%d)\n",
 +			MLX5_DEFAULT_PROF);
 +		prof_sel = MLX5_DEFAULT_PROF;
 +	}
++=======
++>>>>>>> f663ad986239 (net/mlx5: Verify module parameters)
  	dev->profile = &profile[prof_sel];
  
  	INIT_LIST_HEAD(&priv->ctx_list);
diff --cc drivers/net/ethernet/mellanox/mlx5/core/mlx5_core.h
index f0d87046af8e,20d16b137e03..000000000000
--- a/drivers/net/ethernet/mellanox/mlx5/core/mlx5_core.h
+++ b/drivers/net/ethernet/mellanox/mlx5/core/mlx5_core.h
@@@ -42,7 -42,9 +42,13 @@@
  #define DRIVER_VERSION "3.0-1"
  #define DRIVER_RELDATE  "January 2015"
  
++<<<<<<< HEAD
 +extern int mlx5_core_debug_mask;
++=======
+ #define MLX5_TOTAL_VPORTS(mdev) (1 + pci_sriov_get_totalvfs(mdev->pdev))
+ 
+ extern uint mlx5_core_debug_mask;
++>>>>>>> f663ad986239 (net/mlx5: Verify module parameters)
  
  #define mlx5_core_dbg(__dev, format, ...)				\
  	dev_dbg(&(__dev)->pdev->dev, "%s:%s:%d:(pid %d): " format,	\
* Unmerged path drivers/net/ethernet/mellanox/mlx5/core/main.c
* Unmerged path drivers/net/ethernet/mellanox/mlx5/core/mlx5_core.h
