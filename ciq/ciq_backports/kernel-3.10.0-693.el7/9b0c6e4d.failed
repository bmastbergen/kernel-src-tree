bridge: netlink: allow to flush port's fdb

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
commit-author Nikolay Aleksandrov <nikolay@cumulusnetworks.com>
commit 9b0c6e4deb3df91bf0aea8158ea77dc58c9d90b6
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/9b0c6e4d.failed

Add IFLA_BRPORT_FLUSH to allow flushing port's fdb similar to sysfs's
flush.

	Signed-off-by: Nikolay Aleksandrov <nikolay@cumulusnetworks.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 9b0c6e4deb3df91bf0aea8158ea77dc58c9d90b6)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	include/uapi/linux/if_link.h
diff --cc include/uapi/linux/if_link.h
index 1b43f8aab560,fcea39a56095..000000000000
--- a/include/uapi/linux/if_link.h
+++ b/include/uapi/linux/if_link.h
@@@ -253,9 -289,21 +253,25 @@@ enum 
  	IFLA_BRPORT_FAST_LEAVE,	/* multicast fast leave    */
  	IFLA_BRPORT_LEARNING,	/* mac learning */
  	IFLA_BRPORT_UNICAST_FLOOD, /* flood unicast traffic */
 -	IFLA_BRPORT_PROXYARP,	/* proxy ARP */
 +	/* RHEL: IFLA_BRPORT_PROXYARP not fully supported yet */
 +	RESERVED_IFLA_BRPORT_PROXYARP,	/* proxy ARP */
  	IFLA_BRPORT_LEARNING_SYNC, /* mac learning sync from device */
++<<<<<<< HEAD
++=======
+ 	IFLA_BRPORT_PROXYARP_WIFI, /* proxy ARP for Wi-Fi */
+ 	IFLA_BRPORT_ROOT_ID,	/* designated root */
+ 	IFLA_BRPORT_BRIDGE_ID,	/* designated bridge */
+ 	IFLA_BRPORT_DESIGNATED_PORT,
+ 	IFLA_BRPORT_DESIGNATED_COST,
+ 	IFLA_BRPORT_ID,
+ 	IFLA_BRPORT_NO,
+ 	IFLA_BRPORT_TOPOLOGY_CHANGE_ACK,
+ 	IFLA_BRPORT_CONFIG_PENDING,
+ 	IFLA_BRPORT_MESSAGE_AGE_TIMER,
+ 	IFLA_BRPORT_FORWARD_DELAY_TIMER,
+ 	IFLA_BRPORT_HOLD_TIMER,
+ 	IFLA_BRPORT_FLUSH,
++>>>>>>> 9b0c6e4deb3d (bridge: netlink: allow to flush port's fdb)
  	__IFLA_BRPORT_MAX
  };
  #define IFLA_BRPORT_MAX (__IFLA_BRPORT_MAX - 1)
* Unmerged path include/uapi/linux/if_link.h
diff --git a/net/bridge/br_netlink.c b/net/bridge/br_netlink.c
index 858d309f4e1a..24dbcd3e9d17 100644
--- a/net/bridge/br_netlink.c
+++ b/net/bridge/br_netlink.c
@@ -489,6 +489,9 @@ static int br_setport(struct net_bridge_port *p, struct nlattr *tb[])
 			return err;
 	}
 
+	if (tb[IFLA_BRPORT_FLUSH])
+		br_fdb_delete_by_port(p->br, p, 0, 0);
+
 	br_port_flags_change(p, old_flags ^ p->flags);
 	return 0;
 }
