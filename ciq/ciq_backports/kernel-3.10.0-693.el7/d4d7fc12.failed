gfs2: Re-enable fallocate for the rindex

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
commit-author Andrew Price <anprice@redhat.com>
commit d4d7fc12b642a16732adeacefdaebe684bcb2218
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/d4d7fc12.failed

Commit 86066914edff2316cbed63aac8a87d5001441a16 "gfs2: Don't support
fallocate on jdata files" removed the ability of gfs2_grow to reserve
space at the end of the rindex, which could prevent a second gfs2_grow
from succeeding if the fs is full. Allow fallocate to work on the rindex
once again.

	Signed-off-by: Andrew Price <anprice@redhat.com>
	Signed-off-by: Bob Peterson <rpeterso@redhat.com>
(cherry picked from commit d4d7fc12b642a16732adeacefdaebe684bcb2218)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	fs/gfs2/file.c
diff --cc fs/gfs2/file.c
index af0d418da809,c2062a108d19..000000000000
--- a/fs/gfs2/file.c
+++ b/fs/gfs2/file.c
@@@ -921,11 -916,13 +922,18 @@@ static long gfs2_fallocate(struct file 
  	struct gfs2_holder gh;
  	int ret;
  
++<<<<<<< HEAD
 +	/* We only support the FALLOC_FL_KEEP_SIZE mode */
 +	if ((mode & ~FALLOC_FL_KEEP_SIZE) || gfs2_is_jdata(ip))
++=======
+ 	if (mode & ~FALLOC_FL_KEEP_SIZE)
+ 		return -EOPNOTSUPP;
+ 	/* fallocate is needed by gfs2_grow to reserve space in the rindex */
+ 	if (gfs2_is_jdata(ip) && inode != sdp->sd_rindex)
++>>>>>>> d4d7fc12b642 (gfs2: Re-enable fallocate for the rindex)
  		return -EOPNOTSUPP;
  
 -	inode_lock(inode);
 +	mutex_lock(&inode->i_mutex);
  
  	gfs2_holder_init(ip->i_gl, LM_ST_EXCLUSIVE, 0, &gh);
  	ret = gfs2_glock_nq(&gh);
* Unmerged path fs/gfs2/file.c
