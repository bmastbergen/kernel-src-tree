net: Add support for IP ID mangling TSO in cases that require encapsulation

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
Rebuild_CHGLOG: - [net] Add support for IP ID mangling TSO in cases that require encapsulation (Eric Garver) [1405429]
Rebuild_FUZZ: 96.55%
commit-author Alexander Duyck <aduyck@mirantis.com>
commit 7f348a60762afd4cd0e4e7fa14cfa66331b7c30e
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/7f348a60.failed

This patch adds support for NETIF_F_TSO_MANGLEID if a given tunnel supports
NETIF_F_TSO.  This way if needed a device can then later enable the TSO
with IP ID mangling and the tunnels on top of that device can then also
make use of the IP ID mangling as well.

	Signed-off-by: Alexander Duyck <aduyck@mirantis.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 7f348a60762afd4cd0e4e7fa14cfa66331b7c30e)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/core/dev.c
diff --cc net/core/dev.c
index 0198b4df7270,6324bc9267f7..000000000000
--- a/net/core/dev.c
+++ b/net/core/dev.c
@@@ -6574,9 -7026,22 +6574,26 @@@ int register_netdevice(struct net_devic
  	dev->features |= NETIF_F_SOFT_FEATURES;
  	dev->wanted_features = dev->features & dev->hw_features;
  
 -	if (!(dev->flags & IFF_LOOPBACK))
 +	if (!(dev->flags & IFF_LOOPBACK)) {
  		dev->hw_features |= NETIF_F_NOCACHE_COPY;
++<<<<<<< HEAD
 +	}
++=======
+ 
+ 	/* If IPv4 TCP segmentation offload is supported we should also
+ 	 * allow the device to enable segmenting the frame with the option
+ 	 * of ignoring a static IP ID value.  This doesn't enable the
+ 	 * feature itself but allows the user to enable it later.
+ 	 */
+ 	if (dev->hw_features & NETIF_F_TSO)
+ 		dev->hw_features |= NETIF_F_TSO_MANGLEID;
+ 	if (dev->vlan_features & NETIF_F_TSO)
+ 		dev->vlan_features |= NETIF_F_TSO_MANGLEID;
+ 	if (dev->mpls_features & NETIF_F_TSO)
+ 		dev->mpls_features |= NETIF_F_TSO_MANGLEID;
+ 	if (dev->hw_enc_features & NETIF_F_TSO)
+ 		dev->hw_enc_features |= NETIF_F_TSO_MANGLEID;
++>>>>>>> 7f348a60762a (net: Add support for IP ID mangling TSO in cases that require encapsulation)
  
  	/* Make NETIF_F_HIGHDMA inheritable to VLAN devices.
  	 */
* Unmerged path net/core/dev.c
