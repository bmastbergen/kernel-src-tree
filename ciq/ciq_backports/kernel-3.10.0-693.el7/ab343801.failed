ipv6: Don't unset flowi6_proto in ipxip6_tnl_xmit()

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
commit-author Eli Cooper <elicooper@gmx.com>
commit ab34380162cbc9b5172afdadf5136643c687bb73
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/ab343801.failed

Commit 8eb30be0352d0916 ("ipv6: Create ip6_tnl_xmit") unsets
flowi6_proto in ip4ip6_tnl_xmit() and ip6ip6_tnl_xmit().
Since xfrm_selector_match() relies on this info, IPv6 packets
sent by an ip6tunnel cannot be properly selected by their
protocols after removing it. This patch puts flowi6_proto back.

	Cc: stable@vger.kernel.org
Fixes: 8eb30be0352d ("ipv6: Create ip6_tnl_xmit")
	Signed-off-by: Eli Cooper <elicooper@gmx.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit ab34380162cbc9b5172afdadf5136643c687bb73)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/ipv6/ip6_tunnel.c
diff --cc net/ipv6/ip6_tunnel.c
index 100f1422a6ea,888543debe4e..000000000000
--- a/net/ipv6/ip6_tunnel.c
+++ b/net/ipv6/ip6_tunnel.c
@@@ -1093,7 -1173,7 +1093,11 @@@ ip4ip6_tnl_xmit(struct sk_buff *skb, st
  	if (!(t->parms.flags & IP6_TNL_F_IGN_ENCAP_LIMIT))
  		encap_limit = t->parms.encap_limit;
  
++<<<<<<< HEAD
 +	memcpy(&fl6, &t->fl.u.ip6, sizeof (fl6));
++=======
+ 	memcpy(&fl6, &t->fl.u.ip6, sizeof(fl6));
++>>>>>>> ab34380162cb (ipv6: Don't unset flowi6_proto in ipxip6_tnl_xmit())
  	fl6.flowi6_proto = IPPROTO_IPIP;
  
  	dsfield = ipv4_get_dsfield(iph);
@@@ -1147,7 -1233,7 +1151,11 @@@ ip6ip6_tnl_xmit(struct sk_buff *skb, st
  	} else if (!(t->parms.flags & IP6_TNL_F_IGN_ENCAP_LIMIT))
  		encap_limit = t->parms.encap_limit;
  
++<<<<<<< HEAD
 +	memcpy(&fl6, &t->fl.u.ip6, sizeof (fl6));
++=======
+ 	memcpy(&fl6, &t->fl.u.ip6, sizeof(fl6));
++>>>>>>> ab34380162cb (ipv6: Don't unset flowi6_proto in ipxip6_tnl_xmit())
  	fl6.flowi6_proto = IPPROTO_IPV6;
  
  	dsfield = ipv6_get_dsfield(ipv6h);
* Unmerged path net/ipv6/ip6_tunnel.c
