pnfs/blocklayout: fix last_write_offset incorrectly set to page boundary

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
commit-author Benjamin Coddington <bcodding@redhat.com>
commit a3f9d1b58a9ffce011ef4f074bfa36ae30eade28
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/a3f9d1b5.failed

Commit 41963c10c47a35185e68cb9049f7a3493c94d2d7 sets the block layout's
last written byte to the offset of the end of the extent rather than the
end of the write which incorrectly updates the inode's size for
partial-page writes.

Fixes: 41963c10c47a ("pnfs/blocklayout: update last_write_offset atomically with extents")
	Signed-off-by: Benjamin Coddington <bcodding@redhat.com>
	Reviewed-by: Christoph Hellwig <hch@lst.de>
	Tested-by: Christoph Hellwig <hch@lst.de>
	Cc: stable@vger.kernel.org # 4.8+
	Signed-off-by: Anna Schumaker <Anna.Schumaker@Netapp.com>
(cherry picked from commit a3f9d1b58a9ffce011ef4f074bfa36ae30eade28)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	fs/nfs/blocklayout/blocklayout.c
diff --cc fs/nfs/blocklayout/blocklayout.c
index 671d9aa831a9,2905479f214a..000000000000
--- a/fs/nfs/blocklayout/blocklayout.c
+++ b/fs/nfs/blocklayout/blocklayout.c
@@@ -341,12 -341,13 +341,17 @@@ static void bl_write_cleanup(struct wor
  
  	if (likely(!hdr->pnfs_error)) {
  		struct pnfs_block_layout *bl = BLK_LSEG2EXT(hdr->lseg);
 -		u64 start = hdr->args.offset & (loff_t)PAGE_MASK;
 +		u64 start = hdr->args.offset & (loff_t)PAGE_CACHE_MASK;
  		u64 end = (hdr->args.offset + hdr->args.count +
++<<<<<<< HEAD
 +			PAGE_CACHE_SIZE - 1) & (loff_t)PAGE_CACHE_MASK;
++=======
+ 			PAGE_SIZE - 1) & (loff_t)PAGE_MASK;
+ 		u64 lwb = hdr->args.offset + hdr->args.count;
++>>>>>>> a3f9d1b58a9f (pnfs/blocklayout: fix last_write_offset incorrectly set to page boundary)
  
  		ext_tree_mark_written(bl, start >> SECTOR_SHIFT,
- 					(end - start) >> SECTOR_SHIFT, end);
+ 					(end - start) >> SECTOR_SHIFT, lwb);
  	}
  
  	pnfs_ld_write_done(hdr);
* Unmerged path fs/nfs/blocklayout/blocklayout.c
