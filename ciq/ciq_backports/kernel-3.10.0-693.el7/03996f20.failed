storvsc: Tighten up the interrupt path

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
commit-author K. Y. Srinivasan <kys@microsoft.com>
commit 03996f2064a5c5b7c1bd942794d622179acf2d61
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/03996f20.failed

On the interrupt path, we repeatedly establish the pointer to the
storvsc_device. While the compiler does inline get_in_stor_device() (and
other static functions) in the call chain in the interrupt path, the
compiler is repeatedly inlining the call to get_in_stor_device() each
time it is invoked.  The return value of get_in_stor_device() can be
cached in the interrupt path since there is higher level serialization
in place to ensure correct handling when the module unload races with
the processing of an incoming message from the host.  Optimize this code
path by caching the pointer to storvsc_device and passing it as an
argument.

	Signed-off-by: K. Y. Srinivasan <kys@microsoft.com>
	Reviewed-by: Long Li <longli@microsoft.com>
	Reviewed-by: Johannes Thumshirn <jthumshirn@suse.de>
	Reviewed-by: Hannes Reinecke <hare@suse.com>
	Tested-by: Alex Ng <alexng@microsoft.com>
	Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
(cherry picked from commit 03996f2064a5c5b7c1bd942794d622179acf2d61)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/scsi/storvsc_drv.c
diff --cc drivers/scsi/storvsc_drv.c
index 683453d24afd,41c115c230d9..000000000000
--- a/drivers/scsi/storvsc_drv.c
+++ b/drivers/scsi/storvsc_drv.c
@@@ -1076,6 -1076,13 +1070,16 @@@ static void storvsc_on_receive(struct s
  		schedule_work(&work->work);
  		break;
  
++<<<<<<< HEAD
++=======
+ 	case VSTOR_OPERATION_FCHBA_DATA:
+ 		cache_wwn(stor_device, vstor_packet);
+ #if IS_ENABLED(CONFIG_SCSI_FC_ATTRS)
+ 		fc_host_node_name(stor_device->host) = stor_device->node_name;
+ 		fc_host_port_name(stor_device->host) = stor_device->port_name;
+ #endif
+ 		break;
++>>>>>>> 03996f2064a5 (storvsc: Tighten up the interrupt path)
  	default:
  		break;
  	}
* Unmerged path drivers/scsi/storvsc_drv.c
