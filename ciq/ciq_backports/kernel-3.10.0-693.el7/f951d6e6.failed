dell-laptop: use dell_smbios_find_token() instead of find_token_location()

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
commit-author Michał Kępień <kernel@kempniu.pl>
commit f951d6e6faedcead91419b785f73a620d8ed191a
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/f951d6e6.failed

Replace all uses of find_token_location() with dell_smbios_find_token()
to avoid directly accessing the da_tokens table.

	Signed-off-by: Michał Kępień <kernel@kempniu.pl>
	Reviewed-by: Pali Rohár <pali.rohar@gmail.com>
	Signed-off-by: Darren Hart <dvhart@linux.intel.com>
(cherry picked from commit f951d6e6faedcead91419b785f73a620d8ed191a)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/platform/x86/dell-laptop.c
diff --cc drivers/platform/x86/dell-laptop.c
index 87688ae0318c,76064c817f3d..000000000000
--- a/drivers/platform/x86/dell-laptop.c
+++ b/drivers/platform/x86/dell-laptop.c
@@@ -1005,15 -873,16 +1005,25 @@@ static void dell_cleanup_rfkill(void
  
  static int dell_send_intensity(struct backlight_device *bd)
  {
++<<<<<<< HEAD
 +	int token;
++=======
+ 	struct calling_interface_buffer *buffer;
+ 	struct calling_interface_token *token;
++>>>>>>> f951d6e6faed (dell-laptop: use dell_smbios_find_token() instead of find_token_location())
  	int ret;
  
- 	token = find_token_location(BRIGHTNESS_TOKEN);
- 	if (token == -1)
+ 	token = dell_smbios_find_token(BRIGHTNESS_TOKEN);
+ 	if (!token)
  		return -ENODEV;
  
++<<<<<<< HEAD
 +	get_buffer();
 +	buffer->input[0] = token;
++=======
+ 	buffer = dell_smbios_get_buffer();
+ 	buffer->input[0] = token->location;
++>>>>>>> f951d6e6faed (dell-laptop: use dell_smbios_find_token() instead of find_token_location())
  	buffer->input[1] = bd->props.brightness;
  
  	if (power_supply_is_system_supplied() > 0)
@@@ -1029,20 -898,21 +1039,30 @@@
  
  static int dell_get_intensity(struct backlight_device *bd)
  {
++<<<<<<< HEAD
 +	int token;
++=======
+ 	struct calling_interface_buffer *buffer;
+ 	struct calling_interface_token *token;
++>>>>>>> f951d6e6faed (dell-laptop: use dell_smbios_find_token() instead of find_token_location())
  	int ret;
  
- 	token = find_token_location(BRIGHTNESS_TOKEN);
- 	if (token == -1)
+ 	token = dell_smbios_find_token(BRIGHTNESS_TOKEN);
+ 	if (!token)
  		return -ENODEV;
  
++<<<<<<< HEAD
 +	get_buffer();
 +	buffer->input[0] = token;
++=======
+ 	buffer = dell_smbios_get_buffer();
+ 	buffer->input[0] = token->location;
++>>>>>>> f951d6e6faed (dell-laptop: use dell_smbios_find_token() instead of find_token_location())
  
  	if (power_supply_is_system_supplied() > 0)
 -		dell_smbios_send_request(0, 2);
 +		dell_send_request(buffer, 0, 2);
  	else
 -		dell_smbios_send_request(0, 1);
 +		dell_send_request(buffer, 0, 1);
  
  	if (buffer->output[0])
  		ret = dell_smi_error(buffer->output[0]);
@@@ -2077,8 -1986,9 +2097,12 @@@ static void kbd_led_exit(void
  
  static int __init dell_init(void)
  {
++<<<<<<< HEAD
++=======
+ 	struct calling_interface_buffer *buffer;
+ 	struct calling_interface_token *token;
++>>>>>>> f951d6e6faed (dell-laptop: use dell_smbios_find_token() instead of find_token_location())
  	int max_intensity = 0;
- 	int token;
  	int ret;
  
  	if (!dmi_check_system(dell_device_table))
@@@ -2134,22 -2027,17 +2158,30 @@@
  		debugfs_create_file("rfkill", 0444, dell_laptop_dir, NULL,
  				    &dell_debugfs_fops);
  
 -	if (acpi_video_get_backlight_type() != acpi_backlight_vendor)
 +#ifdef CONFIG_ACPI
 +	/* In the event of an ACPI backlight being available, don't
 +	 * register the platform controller.
 +	 */
 +	if (acpi_video_backlight_support())
  		return 0;
 -
 +#endif
 +
++<<<<<<< HEAD
 +	token = find_token_location(BRIGHTNESS_TOKEN);
 +	if (token != -1) {
 +		get_buffer();
 +		buffer->input[0] = token;
 +		dell_send_request(buffer, 0, 2);
++=======
+ 	token = dell_smbios_find_token(BRIGHTNESS_TOKEN);
+ 	if (token) {
+ 		buffer = dell_smbios_get_buffer();
+ 		buffer->input[0] = token->location;
+ 		dell_smbios_send_request(0, 2);
++>>>>>>> f951d6e6faed (dell-laptop: use dell_smbios_find_token() instead of find_token_location())
  		if (buffer->output[0] == 0)
  			max_intensity = buffer->output[3];
 -		dell_smbios_release_buffer();
 +		release_buffer();
  	}
  
  	if (max_intensity) {
* Unmerged path drivers/platform/x86/dell-laptop.c
