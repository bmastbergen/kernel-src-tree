net/mlx5e: Fix TX Timeout to detect queues stuck on BQL

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
Rebuild_CHGLOG: - [netdrv] mlx5e: Fix TX Timeout to detect queues stuck on BQL (Don Dutile) [1417284]
Rebuild_FUZZ: 96.23%
commit-author Daniel Jurgens <danielj@mellanox.com>
commit 2c1ccc993707ecb0830ef0aebb7c8061f7704aa3
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/2c1ccc99.failed

Change netif_tx_queue_stopped to netif_xmit_stopped.  This will show
when queues are stopped due to byte queue limits.

Fixes: 3947ca185999 ('net/mlx5e: Implement ndo_tx_timeout callback')
	Signed-off-by: Daniel Jurgens <danielj@mellanox.com>
	Signed-off-by: Saeed Mahameed <saeedm@mellanox.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 2c1ccc993707ecb0830ef0aebb7c8061f7704aa3)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/mellanox/mlx5/core/en_main.c
diff --cc drivers/net/ethernet/mellanox/mlx5/core/en_main.c
index 5be75c30fd16,0cebc7e44307..000000000000
--- a/drivers/net/ethernet/mellanox/mlx5/core/en_main.c
+++ b/drivers/net/ethernet/mellanox/mlx5/core/en_main.c
@@@ -2553,7 -2644,29 +2553,33 @@@ static netdev_features_t mlx5e_features
  
  	return features;
  }
++<<<<<<< HEAD
 +#endif
++=======
+ 
+ static void mlx5e_tx_timeout(struct net_device *dev)
+ {
+ 	struct mlx5e_priv *priv = netdev_priv(dev);
+ 	bool sched_work = false;
+ 	int i;
+ 
+ 	netdev_err(dev, "TX timeout detected\n");
+ 
+ 	for (i = 0; i < priv->params.num_channels * priv->params.num_tc; i++) {
+ 		struct mlx5e_sq *sq = priv->txq_to_sq_map[i];
+ 
+ 		if (!netif_xmit_stopped(netdev_get_tx_queue(dev, i)))
+ 			continue;
+ 		sched_work = true;
+ 		set_bit(MLX5E_SQ_STATE_TX_TIMEOUT, &sq->state);
+ 		netdev_err(dev, "TX timeout on queue: %d, SQ: 0x%x, CQ: 0x%x, SQ Cons: 0x%x SQ Prod: 0x%x\n",
+ 			   i, sq->sqn, sq->cq.mcq.cqn, sq->cc, sq->pc);
+ 	}
+ 
+ 	if (sched_work && test_bit(MLX5E_STATE_OPENED, &priv->state))
+ 		schedule_work(&priv->tx_timeout_work);
+ }
++>>>>>>> 2c1ccc993707 (net/mlx5e: Fix TX Timeout to detect queues stuck on BQL)
  
  static const struct net_device_ops mlx5e_netdev_ops_basic = {
  	.ndo_open                = mlx5e_open,
* Unmerged path drivers/net/ethernet/mellanox/mlx5/core/en_main.c
