xhci: get rid of platform data

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
commit-author Heikki Krogerus <heikki.krogerus@linux.intel.com>
commit a3aef37930713447b45b1f0f9f8841be44f7db45
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/a3aef379.failed

No more users for it.

	Signed-off-by: Heikki Krogerus <heikki.krogerus@linux.intel.com>
	Signed-off-by: Mathias Nyman <mathias.nyman@linux.intel.com>
	Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
(cherry picked from commit a3aef37930713447b45b1f0f9f8841be44f7db45)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/usb/host/xhci-plat.c
diff --cc drivers/usb/host/xhci-plat.c
index 6a4cb93efaf5,ed56bf9ed885..000000000000
--- a/drivers/usb/host/xhci-plat.c
+++ b/drivers/usb/host/xhci-plat.c
@@@ -18,9 -18,12 +18,13 @@@
  #include <linux/platform_device.h>
  #include <linux/usb/phy.h>
  #include <linux/slab.h>
++<<<<<<< HEAD
 +#include <linux/usb/xhci_pdriver.h>
++=======
+ #include <linux/acpi.h>
++>>>>>>> a3aef3793071 (xhci: get rid of platform data)
  
  #include "xhci.h"
 -#include "xhci-plat.h"
 -#include "xhci-mvebu.h"
 -#include "xhci-rcar.h"
  
  static struct hc_driver __read_mostly xhci_plat_hc_driver;
  
@@@ -45,10 -82,62 +49,14 @@@ static int xhci_plat_start(struct usb_h
  	return xhci_run(hcd);
  }
  
 -#ifdef CONFIG_OF
 -static const struct xhci_plat_priv xhci_plat_marvell_armada = {
 -	.init_quirk = xhci_mvebu_mbus_init_quirk,
 -};
 -
 -static const struct xhci_plat_priv xhci_plat_renesas_rcar_gen2 = {
 -	.firmware_name = XHCI_RCAR_FIRMWARE_NAME_V1,
 -	.init_quirk = xhci_rcar_init_quirk,
 -	.plat_start = xhci_rcar_start,
 -};
 -
 -static const struct xhci_plat_priv xhci_plat_renesas_rcar_gen3 = {
 -	.firmware_name = XHCI_RCAR_FIRMWARE_NAME_V2,
 -	.init_quirk = xhci_rcar_init_quirk,
 -	.plat_start = xhci_rcar_start,
 -};
 -
 -static const struct of_device_id usb_xhci_of_match[] = {
 -	{
 -		.compatible = "generic-xhci",
 -	}, {
 -		.compatible = "xhci-platform",
 -	}, {
 -		.compatible = "marvell,armada-375-xhci",
 -		.data = &xhci_plat_marvell_armada,
 -	}, {
 -		.compatible = "marvell,armada-380-xhci",
 -		.data = &xhci_plat_marvell_armada,
 -	}, {
 -		.compatible = "renesas,xhci-r8a7790",
 -		.data = &xhci_plat_renesas_rcar_gen2,
 -	}, {
 -		.compatible = "renesas,xhci-r8a7791",
 -		.data = &xhci_plat_renesas_rcar_gen2,
 -	}, {
 -		.compatible = "renesas,xhci-r8a7793",
 -		.data = &xhci_plat_renesas_rcar_gen2,
 -	}, {
 -		.compatible = "renesas,xhci-r8a7795",
 -		.data = &xhci_plat_renesas_rcar_gen3,
 -	}, {
 -		.compatible = "renesas,rcar-gen2-xhci",
 -		.data = &xhci_plat_renesas_rcar_gen2,
 -	}, {
 -		.compatible = "renesas,rcar-gen3-xhci",
 -		.data = &xhci_plat_renesas_rcar_gen3,
 -	},
 -	{},
 -};
 -MODULE_DEVICE_TABLE(of, usb_xhci_of_match);
 -#endif
 -
  static int xhci_plat_probe(struct platform_device *pdev)
  {
++<<<<<<< HEAD
 +	struct device_node	*node = pdev->dev.of_node;
 +	struct usb_xhci_pdata	*pdata = dev_get_platdata(&pdev->dev);
++=======
+ 	const struct of_device_id *match;
++>>>>>>> a3aef3793071 (xhci: get rid of platform data)
  	const struct hc_driver	*driver;
  	struct xhci_hcd		*xhci;
  	struct resource         *res;
@@@ -114,17 -217,11 +122,21 @@@
  			dev_name(&pdev->dev), hcd);
  	if (!xhci->shared_hcd) {
  		ret = -ENOMEM;
 -		goto disable_clk;
 +		goto dealloc_usb2_hcd;
  	}
  
++<<<<<<< HEAD
 +	if ((node && of_property_read_bool(node, "usb3-lpm-capable")) ||
 +			(pdata && pdata->usb3_lpm_capable))
++=======
+ 	if (device_property_read_bool(&pdev->dev, "usb3-lpm-capable"))
++>>>>>>> a3aef3793071 (xhci: get rid of platform data)
  		xhci->quirks |= XHCI_LPM_SUPPORT;
 +	/*
 +	 * Set the xHCI pointer before xhci_plat_setup() (aka hcd_driver.reset)
 +	 * is called by usb_add_hcd().
 +	 */
 +	*((struct xhci_hcd **) xhci->shared_hcd->hcd_priv) = xhci;
  
  	if (HCC_MAX_PSA(xhci->hcc_params) >= 4)
  		xhci->shared_hcd->can_do_streams = 1;
* Unmerged path drivers/usb/host/xhci-plat.c
diff --git a/include/linux/usb/xhci_pdriver.h b/include/linux/usb/xhci_pdriver.h
deleted file mode 100644
index 376654b5b0f7..000000000000
--- a/include/linux/usb/xhci_pdriver.h
+++ /dev/null
@@ -1,27 +0,0 @@
-/*
- * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License version 2 as
- * published by the Free Software Foundation.
- *
- * This program is distributed in the hope that it will be useful, but
- * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
- * or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License
- * for more details.
- *
- */
-
-#ifndef __USB_CORE_XHCI_PDRIVER_H
-#define __USB_CORE_XHCI_PDRIVER_H
-
-/**
- * struct usb_xhci_pdata - platform_data for generic xhci platform driver
- *
- * @usb3_lpm_capable:	determines if this xhci platform supports USB3
- *			LPM capability
- *
- */
-struct usb_xhci_pdata {
-	unsigned	usb3_lpm_capable:1;
-};
-
-#endif /* __USB_CORE_XHCI_PDRIVER_H */
