s390/zcrypt: Introduce CEX6 toleration

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
Rebuild_CHGLOG: - [s390] zcrypt: Introduce CEX6 toleration (Hendrik Brueckner) [1380777]
Rebuild_FUZZ: 92.96%
commit-author Harald Freudenberger <freude@linux.vnet.ibm.com>
commit b3e8652bcbfa04807e44708d4d0c8cdad39c9215
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/b3e8652b.failed

	Signed-off-by: Harald Freudenberger <freude@linux.vnet.ibm.com>
	Signed-off-by: Martin Schwidefsky <schwidefsky@de.ibm.com>
(cherry picked from commit b3e8652bcbfa04807e44708d4d0c8cdad39c9215)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/s390/crypto/ap_bus.c
diff --cc drivers/s390/crypto/ap_bus.c
index 81597ada9d94,cac919d63b43..000000000000
--- a/drivers/s390/crypto/ap_bus.c
+++ b/drivers/s390/crypto/ap_bus.c
@@@ -1487,13 -1703,15 +1487,22 @@@ static void ap_scan_bus(struct work_str
  		if (!ap_dev)
  			break;
  		ap_dev->qid = qid;
 -		ap_dev->state = AP_STATE_RESET_START;
 -		ap_dev->interrupt = AP_INTR_DISABLED;
 +		rc = ap_init_queue(ap_dev);
 +		if ((rc != 0) && (rc != -EBUSY)) {
 +			kfree(ap_dev);
 +			continue;
 +		}
  		ap_dev->queue_depth = queue_depth;
++<<<<<<< HEAD
 +		ap_dev->unregistered = AP_DEV_REGIST_IN_PROGRESS;
++=======
+ 		ap_dev->raw_hwtype = device_type;
+ 		ap_dev->device_type = device_type;
+ 		/* CEX6 toleration: map to CEX5 */
+ 		if (device_type == AP_DEVICE_TYPE_CEX6)
+ 			ap_dev->device_type = AP_DEVICE_TYPE_CEX5;
+ 		ap_dev->functions = device_functions;
++>>>>>>> b3e8652bcbfa (s390/zcrypt: Introduce CEX6 toleration)
  		spin_lock_init(&ap_dev->lock);
  		INIT_LIST_HEAD(&ap_dev->pendingq);
  		INIT_LIST_HEAD(&ap_dev->requestq);
* Unmerged path drivers/s390/crypto/ap_bus.c
diff --git a/drivers/s390/crypto/ap_bus.h b/drivers/s390/crypto/ap_bus.h
index f4214d29a423..2da8ecdc7a5f 100644
--- a/drivers/s390/crypto/ap_bus.h
+++ b/drivers/s390/crypto/ap_bus.h
@@ -121,6 +121,7 @@ static inline int ap_test_bit(unsigned int *ptr, unsigned int nr)
 #define AP_DEVICE_TYPE_CEX3C	9
 #define AP_DEVICE_TYPE_CEX4	10
 #define AP_DEVICE_TYPE_CEX5	11
+#define AP_DEVICE_TYPE_CEX6	12
 
 /*
  * Known function facilities
