net: Add skb_get_hash_perturb

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
Rebuild_CHGLOG: - [net] Add skb_get_hash_perturb (Ivan Vecera) [1382040]
Rebuild_FUZZ: 90.57%
commit-author Tom Herbert <tom@herbertland.com>
commit 50fb799289501c2eab9f43fc9af513027e1e994f
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/50fb7992.failed

This calls flow_disect and __skb_get_hash to procure a hash for a
packet. Input includes a key to initialize jhash. This function
does not set skb->hash.

	Signed-off-by: Tom Herbert <tom@herbertland.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 50fb799289501c2eab9f43fc9af513027e1e994f)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/core/flow_dissector.c
diff --cc net/core/flow_dissector.c
index b6ed85ba825b,b1df995ef06c..000000000000
--- a/net/core/flow_dissector.c
+++ b/net/core/flow_dissector.c
@@@ -270,7 -330,9 +284,13 @@@ void __skb_get_hash(struct sk_buff *skb
  	if (keys.ports)
  		skb->l4_hash = 1;
  
++<<<<<<< HEAD
 +	skb->hash = __flow_hash_from_keys(&keys);
++=======
+ 	skb->sw_hash = 1;
+ 
+ 	skb->hash = hash;
++>>>>>>> 50fb79928950 (net: Add skb_get_hash_perturb)
  }
  EXPORT_SYMBOL(__skb_get_hash);
  
diff --git a/include/linux/skbuff.h b/include/linux/skbuff.h
index 449d0a455cd2..9bbdc95f5440 100644
--- a/include/linux/skbuff.h
+++ b/include/linux/skbuff.h
@@ -984,6 +984,8 @@ static inline __u32 skb_get_hash(struct sk_buff *skb)
 	return skb->hash;
 }
 
+__u32 skb_get_hash_perturb(const struct sk_buff *skb, u32 perturb);
+
 static inline __u32 skb_get_hash_raw(const struct sk_buff *skb)
 {
 	return skb->hash;
* Unmerged path net/core/flow_dissector.c
