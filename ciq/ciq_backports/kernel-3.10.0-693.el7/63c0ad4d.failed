sched: Call skb_get_hash_perturb in sch_sfb

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
commit-author Tom Herbert <tom@herbertland.com>
commit 63c0ad4d4135d3bdb81a1ee42436f3a403632a3e
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/63c0ad4d.failed

Call skb_get_hash_perturb instead of doing skb_flow_dissect and then
jhash by hand.

	Signed-off-by: Tom Herbert <tom@herbertland.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 63c0ad4d4135d3bdb81a1ee42436f3a403632a3e)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/sched/sch_sfb.c
diff --cc net/sched/sch_sfb.c
index ccc99818ee47,4b815193326c..000000000000
--- a/net/sched/sch_sfb.c
+++ b/net/sched/sch_sfb.c
@@@ -306,23 -306,19 +305,23 @@@ static int sfb_enqueue(struct sk_buff *
  		}
  	}
  
++<<<<<<< HEAD
 +	if (q->filter_list) {
++=======
+ 	fl = rcu_dereference_bh(q->filter_list);
+ 	if (fl) {
+ 		u32 salt;
+ 
++>>>>>>> 63c0ad4d4135 (sched: Call skb_get_hash_perturb in sch_sfb)
  		/* If using external classifiers, get result and record it. */
 -		if (!sfb_classify(skb, fl, &ret, &salt))
 +		if (!sfb_classify(skb, q, &ret, &salt))
  			goto other_drop;
- 		keys.src = salt;
- 		keys.dst = 0;
- 		keys.ports = 0;
+ 		sfbhash = jhash_1word(salt, q->bins[slot].perturbation);
  	} else {
- 		skb_flow_dissect(skb, &keys);
+ 		sfbhash = skb_get_hash_perturb(skb, q->bins[slot].perturbation);
  	}
  
- 	slot = q->slot;
  
- 	sfbhash = jhash_3words((__force u32)keys.dst,
- 			       (__force u32)keys.src,
- 			       (__force u32)keys.ports,
- 			       q->bins[slot].perturbation);
  	if (!sfbhash)
  		sfbhash = 1;
  	sfb_skb_cb(skb)->hashes[slot] = sfbhash;
* Unmerged path net/sched/sch_sfb.c
