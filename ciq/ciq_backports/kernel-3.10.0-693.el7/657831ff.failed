dccp/tcp: do not inherit mc_list from parent

jira LE-1907
cve CVE-2017-9077
cve CVE-2017-9076
cve CVE-2017-9075
cve CVE-2017-8890
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
commit-author Eric Dumazet <edumazet@google.com>
commit 657831ffc38e30092a2d5f03d385d710eb88b09a
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/657831ff.failed

syzkaller found a way to trigger double frees from ip_mc_drop_socket()

It turns out that leave a copy of parent mc_list at accept() time,
which is very bad.

Very similar to commit 8b485ce69876 ("tcp: do not inherit
fastopen_req from parent")

Initial report from Pray3r, completed by Andrey one.
Thanks a lot to them !

	Signed-off-by: Eric Dumazet <edumazet@google.com>
	Reported-by: Pray3r <pray3r.z@gmail.com>
	Reported-by: Andrey Konovalov <andreyknvl@google.com>
	Tested-by: Andrey Konovalov <andreyknvl@google.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 657831ffc38e30092a2d5f03d385d710eb88b09a)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/ipv4/inet_connection_sock.c
diff --cc net/ipv4/inet_connection_sock.c
index 08698b58e3ab,1054d330bf9d..000000000000
--- a/net/ipv4/inet_connection_sock.c
+++ b/net/ipv4/inet_connection_sock.c
@@@ -694,6 -791,15 +694,18 @@@ struct sock *inet_csk_clone_lock(const 
  		inet_sk(newsk)->inet_sport = htons(inet_rsk(req)->ir_num);
  		newsk->sk_write_space = sk_stream_write_space;
  
++<<<<<<< HEAD
++=======
+ 		/* listeners have SOCK_RCU_FREE, not the children */
+ 		sock_reset_flag(newsk, SOCK_RCU_FREE);
+ 
+ 		inet_sk(newsk)->mc_list = NULL;
+ 
+ 		newsk->sk_mark = inet_rsk(req)->ir_mark;
+ 		atomic64_set(&newsk->sk_cookie,
+ 			     atomic64_read(&inet_rsk(req)->ir_cookie));
+ 
++>>>>>>> 657831ffc38e (dccp/tcp: do not inherit mc_list from parent)
  		newicsk->icsk_retransmits = 0;
  		newicsk->icsk_backoff	  = 0;
  		newicsk->icsk_probes_out  = 0;
* Unmerged path net/ipv4/inet_connection_sock.c
