dell-smbios: don't pass an SMBIOS buffer to dell_smbios_send_request()

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
commit-author Michał Kępień <kernel@kempniu.pl>
commit 17070f242aa989c33b227e61ea060f768a77f2dc
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/17070f24.failed

Passing an SMBIOS buffer pointer to dell_smbios_send_request() is
redundant as it should always operate on the SMBIOS buffer exported from
the module.

	Signed-off-by: Michał Kępień <kernel@kempniu.pl>
	Reviewed-by: Pali Rohár <pali.rohar@gmail.com>
	Signed-off-by: Darren Hart <dvhart@linux.intel.com>
(cherry picked from commit 17070f242aa989c33b227e61ea060f768a77f2dc)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/platform/x86/dell-laptop.c
#	drivers/platform/x86/dell-smbios.c
#	drivers/platform/x86/dell-smbios.h
diff --cc drivers/platform/x86/dell-laptop.c
index 87688ae0318c,0bb22114abce..000000000000
--- a/drivers/platform/x86/dell-laptop.c
+++ b/drivers/platform/x86/dell-laptop.c
@@@ -555,19 -416,19 +555,27 @@@ static int dell_rfkill_set(void *data, 
  	int status;
  	int ret;
  
 -	dell_smbios_get_buffer();
 +	get_buffer();
  
++<<<<<<< HEAD
 +	dell_send_request(buffer, 17, 11);
++=======
+ 	dell_smbios_send_request(17, 11);
++>>>>>>> 17070f242aa9 (dell-smbios: don't pass an SMBIOS buffer to dell_smbios_send_request())
  	ret = buffer->output[0];
  	status = buffer->output[1];
  
  	if (ret != 0)
  		goto out;
  
 -	dell_smbios_clear_buffer();
 +	clear_buffer();
  
  	buffer->input[0] = 0x2;
++<<<<<<< HEAD
 +	dell_send_request(buffer, 17, 11);
++=======
+ 	dell_smbios_send_request(17, 11);
++>>>>>>> 17070f242aa9 (dell-smbios: don't pass an SMBIOS buffer to dell_smbios_send_request())
  	ret = buffer->output[0];
  	hwswitch = buffer->output[1];
  
@@@ -577,10 -438,10 +585,14 @@@
  	    (status & BIT(0)) && !(status & BIT(16)))
  		disable = 1;
  
 -	dell_smbios_clear_buffer();
 +	clear_buffer();
  
  	buffer->input[0] = (1 | (radio<<8) | (disable << 16));
++<<<<<<< HEAD
 +	dell_send_request(buffer, 17, 11);
++=======
+ 	dell_smbios_send_request(17, 11);
++>>>>>>> 17070f242aa9 (dell-smbios: don't pass an SMBIOS buffer to dell_smbios_send_request())
  	ret = buffer->output[0];
  
   out:
@@@ -595,9 -456,9 +607,13 @@@ static void dell_rfkill_update_sw_state
  	if (status & BIT(0)) {
  		/* Has hw-switch, sync sw_state to BIOS */
  		int block = rfkill_blocked(rfkill);
 -		dell_smbios_clear_buffer();
 +		clear_buffer();
  		buffer->input[0] = (1 | (radio << 8) | (block << 16));
++<<<<<<< HEAD
 +		dell_send_request(buffer, 17, 11);
++=======
+ 		dell_smbios_send_request(17, 11);
++>>>>>>> 17070f242aa9 (dell-smbios: don't pass an SMBIOS buffer to dell_smbios_send_request())
  	} else {
  		/* No hw-switch, sync BIOS state to sw_state */
  		rfkill_set_sw_state(rfkill, !!(status & BIT(radio + 16)));
@@@ -618,9 -479,9 +634,13 @@@ static void dell_rfkill_query(struct rf
  	int status;
  	int ret;
  
 -	dell_smbios_get_buffer();
 +	get_buffer();
  
++<<<<<<< HEAD
 +	dell_send_request(buffer, 17, 11);
++=======
+ 	dell_smbios_send_request(17, 11);
++>>>>>>> 17070f242aa9 (dell-smbios: don't pass an SMBIOS buffer to dell_smbios_send_request())
  	ret = buffer->output[0];
  	status = buffer->output[1];
  
@@@ -629,10 -490,10 +649,14 @@@
  		return;
  	}
  
 -	dell_smbios_clear_buffer();
 +	clear_buffer();
  
  	buffer->input[0] = 0x2;
++<<<<<<< HEAD
 +	dell_send_request(buffer, 17, 11);
++=======
+ 	dell_smbios_send_request(17, 11);
++>>>>>>> 17070f242aa9 (dell-smbios: don't pass an SMBIOS buffer to dell_smbios_send_request())
  	ret = buffer->output[0];
  	hwswitch = buffer->output[1];
  
@@@ -658,16 -519,16 +682,24 @@@ static int dell_debugfs_show(struct seq
  	int status;
  	int ret;
  
 -	dell_smbios_get_buffer();
 +	get_buffer();
  
++<<<<<<< HEAD
 +	dell_send_request(buffer, 17, 11);
++=======
+ 	dell_smbios_send_request(17, 11);
++>>>>>>> 17070f242aa9 (dell-smbios: don't pass an SMBIOS buffer to dell_smbios_send_request())
  	ret = buffer->output[0];
  	status = buffer->output[1];
  
 -	dell_smbios_clear_buffer();
 +	clear_buffer();
  
  	buffer->input[0] = 0x2;
++<<<<<<< HEAD
 +	dell_send_request(buffer, 17, 11);
++=======
+ 	dell_smbios_send_request(17, 11);
++>>>>>>> 17070f242aa9 (dell-smbios: don't pass an SMBIOS buffer to dell_smbios_send_request())
  	hwswitch_ret = buffer->output[0];
  	hwswitch_state = buffer->output[1];
  
@@@ -756,19 -617,19 +788,27 @@@ static void dell_update_rfkill(struct w
  	int status;
  	int ret;
  
 -	dell_smbios_get_buffer();
 +	get_buffer();
  
++<<<<<<< HEAD
 +	dell_send_request(buffer, 17, 11);
++=======
+ 	dell_smbios_send_request(17, 11);
++>>>>>>> 17070f242aa9 (dell-smbios: don't pass an SMBIOS buffer to dell_smbios_send_request())
  	ret = buffer->output[0];
  	status = buffer->output[1];
  
  	if (ret != 0)
  		goto out;
  
 -	dell_smbios_clear_buffer();
 +	clear_buffer();
  
  	buffer->input[0] = 0x2;
++<<<<<<< HEAD
 +	dell_send_request(buffer, 17, 11);
++=======
+ 	dell_smbios_send_request(17, 11);
++>>>>>>> 17070f242aa9 (dell-smbios: don't pass an SMBIOS buffer to dell_smbios_send_request())
  	ret = buffer->output[0];
  
  	if (ret == 0 && (status & BIT(0)))
@@@ -848,11 -709,11 +888,16 @@@ static int __init dell_setup_rfkill(voi
  	if (!force_rfkill && !whitelisted)
  		return 0;
  
++<<<<<<< HEAD
 +	get_buffer();
 +	dell_send_request(buffer, 17, 11);
++=======
+ 	dell_smbios_get_buffer();
+ 	dell_smbios_send_request(17, 11);
++>>>>>>> 17070f242aa9 (dell-smbios: don't pass an SMBIOS buffer to dell_smbios_send_request())
  	ret = buffer->output[0];
  	status = buffer->output[1];
 -	dell_smbios_release_buffer();
 +	release_buffer();
  
  	/* dell wireless info smbios call is not supported */
  	if (ret != 0)
@@@ -1017,9 -878,9 +1062,15 @@@ static int dell_send_intensity(struct b
  	buffer->input[1] = bd->props.brightness;
  
  	if (power_supply_is_system_supplied() > 0)
++<<<<<<< HEAD
 +		dell_send_request(buffer, 1, 2);
 +	else
 +		dell_send_request(buffer, 1, 1);
++=======
+ 		dell_smbios_send_request(1, 2);
+ 	else
+ 		dell_smbios_send_request(1, 1);
++>>>>>>> 17070f242aa9 (dell-smbios: don't pass an SMBIOS buffer to dell_smbios_send_request())
  
  	ret = dell_smi_error(buffer->output[0]);
  
@@@ -1040,9 -901,9 +1091,15 @@@ static int dell_get_intensity(struct ba
  	buffer->input[0] = token;
  
  	if (power_supply_is_system_supplied() > 0)
++<<<<<<< HEAD
 +		dell_send_request(buffer, 0, 2);
 +	else
 +		dell_send_request(buffer, 0, 1);
++=======
+ 		dell_smbios_send_request(0, 2);
+ 	else
+ 		dell_smbios_send_request(0, 1);
++>>>>>>> 17070f242aa9 (dell-smbios: don't pass an SMBIOS buffer to dell_smbios_send_request())
  
  	if (buffer->output[0])
  		ret = dell_smi_error(buffer->output[0]);
@@@ -1296,10 -1157,10 +1353,14 @@@ static int kbd_get_info(struct kbd_inf
  	u8 units;
  	int ret;
  
 -	dell_smbios_get_buffer();
 +	get_buffer();
  
  	buffer->input[0] = 0x0;
++<<<<<<< HEAD
 +	dell_send_request(buffer, 4, 11);
++=======
+ 	dell_smbios_send_request(4, 11);
++>>>>>>> 17070f242aa9 (dell-smbios: don't pass an SMBIOS buffer to dell_smbios_send_request())
  	ret = buffer->output[0];
  
  	if (ret) {
@@@ -1384,10 -1245,10 +1445,14 @@@ static int kbd_get_state(struct kbd_sta
  {
  	int ret;
  
 -	dell_smbios_get_buffer();
 +	get_buffer();
  
  	buffer->input[0] = 0x1;
++<<<<<<< HEAD
 +	dell_send_request(buffer, 4, 11);
++=======
+ 	dell_smbios_send_request(4, 11);
++>>>>>>> 17070f242aa9 (dell-smbios: don't pass an SMBIOS buffer to dell_smbios_send_request())
  	ret = buffer->output[0];
  
  	if (ret) {
@@@ -1423,9 -1284,9 +1488,13 @@@ static int kbd_set_state(struct kbd_sta
  	buffer->input[1] |= (state->timeout_unit & 0x3) << 30;
  	buffer->input[2] = state->als_setting & 0xFF;
  	buffer->input[2] |= (state->level & 0xFF) << 16;
++<<<<<<< HEAD
 +	dell_send_request(buffer, 4, 11);
++=======
+ 	dell_smbios_send_request(4, 11);
++>>>>>>> 17070f242aa9 (dell-smbios: don't pass an SMBIOS buffer to dell_smbios_send_request())
  	ret = buffer->output[0];
 -	dell_smbios_release_buffer();
 +	release_buffer();
  
  	return dell_smi_error(ret);
  }
@@@ -1462,12 -1323,12 +1531,16 @@@ static int kbd_set_token_bit(u8 bit
  	if (id == -1)
  		return -EINVAL;
  
 -	dell_smbios_get_buffer();
 +	get_buffer();
  	buffer->input[0] = da_tokens[id].location;
  	buffer->input[1] = da_tokens[id].value;
++<<<<<<< HEAD
 +	dell_send_request(buffer, 1, 0);
++=======
+ 	dell_smbios_send_request(1, 0);
++>>>>>>> 17070f242aa9 (dell-smbios: don't pass an SMBIOS buffer to dell_smbios_send_request())
  	ret = buffer->output[0];
 -	dell_smbios_release_buffer();
 +	release_buffer();
  
  	return dell_smi_error(ret);
  }
@@@ -1485,12 -1346,12 +1558,16 @@@ static int kbd_get_token_bit(u8 bit
  	if (id == -1)
  		return -EINVAL;
  
 -	dell_smbios_get_buffer();
 +	get_buffer();
  	buffer->input[0] = da_tokens[id].location;
++<<<<<<< HEAD
 +	dell_send_request(buffer, 0, 0);
++=======
+ 	dell_smbios_send_request(0, 0);
++>>>>>>> 17070f242aa9 (dell-smbios: don't pass an SMBIOS buffer to dell_smbios_send_request())
  	ret = buffer->output[0];
  	val = buffer->output[1];
 -	dell_smbios_release_buffer();
 +	release_buffer();
  
  	if (ret)
  		return dell_smi_error(ret);
@@@ -2144,12 -2017,12 +2221,16 @@@ static int __init dell_init(void
  
  	token = find_token_location(BRIGHTNESS_TOKEN);
  	if (token != -1) {
 -		dell_smbios_get_buffer();
 +		get_buffer();
  		buffer->input[0] = token;
++<<<<<<< HEAD
 +		dell_send_request(buffer, 0, 2);
++=======
+ 		dell_smbios_send_request(0, 2);
++>>>>>>> 17070f242aa9 (dell-smbios: don't pass an SMBIOS buffer to dell_smbios_send_request())
  		if (buffer->output[0] == 0)
  			max_intensity = buffer->output[3];
 -		dell_smbios_release_buffer();
 +		release_buffer();
  	}
  
  	if (max_intensity) {
* Unmerged path drivers/platform/x86/dell-smbios.c
* Unmerged path drivers/platform/x86/dell-smbios.h
* Unmerged path drivers/platform/x86/dell-laptop.c
* Unmerged path drivers/platform/x86/dell-smbios.c
* Unmerged path drivers/platform/x86/dell-smbios.h
