tools/power turbostat: Support Knights Mill (KNM)

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
Rebuild_CHGLOG: - [tools] power turbostat: Support Knights Mill (KNM) (Steve Best) [1381293]
Rebuild_FUZZ: 93.48%
commit-author Len Brown <len.brown@intel.com>
commit 005c82d64d1aa49290a39573019f73b5088beeff
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/005c82d6.failed

Original-author: Piotr Luc <piotr.luc@intel.com>
	Signed-off-by: Len Brown <len.brown@intel.com>
(cherry picked from commit 005c82d64d1aa49290a39573019f73b5088beeff)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	tools/power/x86/turbostat/turbostat.c
diff --cc tools/power/x86/turbostat/turbostat.c
index 92e6f5e6c99d,a54ca3775521..000000000000
--- a/tools/power/x86/turbostat/turbostat.c
+++ b/tools/power/x86/turbostat/turbostat.c
@@@ -1825,48 -2164,49 +1825,53 @@@ int probe_nhm_msrs(unsigned int family
  	bclk = discover_bclk(family, model);
  
  	switch (model) {
 -	case INTEL_FAM6_NEHALEM_EP:	/* Core i7, Xeon 5500 series - Bloomfield, Gainstown NHM-EP */
 -	case INTEL_FAM6_NEHALEM:	/* Core i7 and i5 Processor - Clarksfield, Lynnfield, Jasper Forest */
 +	case 0x1A:	/* Core i7, Xeon 5500 series - Bloomfield, Gainstown NHM-EP */
 +	case 0x1E:	/* Core i7 and i5 Processor - Clarksfield, Lynnfield, Jasper Forest */
  	case 0x1F:	/* Core i7 and i5 Processor - Nehalem */
 -	case INTEL_FAM6_WESTMERE:	/* Westmere Client - Clarkdale, Arrandale */
 -	case INTEL_FAM6_WESTMERE_EP:	/* Westmere EP - Gulftown */
 -	case INTEL_FAM6_NEHALEM_EX:	/* Nehalem-EX Xeon - Beckton */
 -	case INTEL_FAM6_WESTMERE_EX:	/* Westmere-EX Xeon - Eagleton */
 +	case 0x25:	/* Westmere Client - Clarkdale, Arrandale */
 +	case 0x2C:	/* Westmere EP - Gulftown */
 +	case 0x2E:	/* Nehalem-EX Xeon - Beckton */
 +	case 0x2F:	/* Westmere-EX Xeon - Eagleton */
  		pkg_cstate_limits = nhm_pkg_cstate_limits;
  		break;
 -	case INTEL_FAM6_SANDYBRIDGE:	/* SNB */
 -	case INTEL_FAM6_SANDYBRIDGE_X:	/* SNB Xeon */
 -	case INTEL_FAM6_IVYBRIDGE:	/* IVB */
 -	case INTEL_FAM6_IVYBRIDGE_X:	/* IVB Xeon */
 +	case 0x2A:	/* SNB */
 +	case 0x2D:	/* SNB Xeon */
 +	case 0x3A:	/* IVB */
 +	case 0x3E:	/* IVB Xeon */
  		pkg_cstate_limits = snb_pkg_cstate_limits;
  		break;
 -	case INTEL_FAM6_HASWELL_CORE:	/* HSW */
 -	case INTEL_FAM6_HASWELL_X:	/* HSX */
 -	case INTEL_FAM6_HASWELL_ULT:	/* HSW */
 -	case INTEL_FAM6_HASWELL_GT3E:	/* HSW */
 -	case INTEL_FAM6_BROADWELL_CORE:	/* BDW */
 -	case INTEL_FAM6_BROADWELL_GT3E:	/* BDW */
 -	case INTEL_FAM6_BROADWELL_X:	/* BDX */
 -	case INTEL_FAM6_BROADWELL_XEON_D:	/* BDX-DE */
 -	case INTEL_FAM6_SKYLAKE_MOBILE:	/* SKL */
 -	case INTEL_FAM6_SKYLAKE_DESKTOP:	/* SKL */
 -	case INTEL_FAM6_KABYLAKE_MOBILE:	/* KBL */
 -	case INTEL_FAM6_KABYLAKE_DESKTOP:	/* KBL */
 -	case INTEL_FAM6_SKYLAKE_X:	/* SKX */
 +	case 0x3C:	/* HSW */
 +	case 0x3F:	/* HSX */
 +	case 0x45:	/* HSW */
 +	case 0x46:	/* HSW */
 +	case 0x3D:	/* BDW */
 +	case 0x47:	/* BDW */
 +	case 0x4F:	/* BDX */
 +	case 0x56:	/* BDX-DE */
 +	case 0x4E:	/* SKL */
 +	case 0x5E:	/* SKL */
 +	case 0x8E:	/* KBL */
 +	case 0x9E:	/* KBL */
 +	case 0x55:	/* SKX */
  		pkg_cstate_limits = hsw_pkg_cstate_limits;
  		break;
 -	case INTEL_FAM6_ATOM_SILVERMONT1:	/* BYT */
 -	case INTEL_FAM6_ATOM_SILVERMONT2:	/* AVN */
 +	case 0x37:	/* BYT */
 +	case 0x4D:	/* AVN */
  		pkg_cstate_limits = slv_pkg_cstate_limits;
  		break;
 -	case INTEL_FAM6_ATOM_AIRMONT:	/* AMT */
 +	case 0x4C:	/* AMT */
  		pkg_cstate_limits = amt_pkg_cstate_limits;
  		break;
++<<<<<<< HEAD
 +	case 0x57:	/* PHI */
++=======
+ 	case INTEL_FAM6_XEON_PHI_KNL:	/* PHI */
+ 	case INTEL_FAM6_XEON_PHI_KNM:
++>>>>>>> 005c82d64d1a (tools/power turbostat: Support Knights Mill (KNM))
  		pkg_cstate_limits = phi_pkg_cstate_limits;
  		break;
 -	case INTEL_FAM6_ATOM_GOLDMONT:	/* BXT */
 -	case INTEL_FAM6_ATOM_DENVERTON:	/* DNV */
 +	case 0x5C:	/* BXT */
 +	case 0x5F:	/* DNV */
  		pkg_cstate_limits = bxt_pkg_cstate_limits;
  		break;
  	default:
@@@ -1886,9 -2226,10 +1891,16 @@@ int has_nhm_turbo_ratio_limit(unsigned 
  {
  	switch (model) {
  	/* Nehalem compatible, but do not include turbo-ratio limit support */
++<<<<<<< HEAD
 +	case 0x2E:	/* Nehalem-EX Xeon - Beckton */
 +	case 0x2F:	/* Westmere-EX Xeon - Eagleton */
 +	case 0x57:	/* PHI - Knights Landing (different MSR definition) */
++=======
+ 	case INTEL_FAM6_NEHALEM_EX:	/* Nehalem-EX Xeon - Beckton */
+ 	case INTEL_FAM6_WESTMERE_EX:	/* Westmere-EX Xeon - Eagleton */
+ 	case INTEL_FAM6_XEON_PHI_KNL:	/* PHI - Knights Landing (different MSR definition) */
+ 	case INTEL_FAM6_XEON_PHI_KNM:
++>>>>>>> 005c82d64d1a (tools/power turbostat: Support Knights Mill (KNM))
  		return 0;
  	default:
  		return 1;
@@@ -1935,7 -2276,8 +1947,12 @@@ int has_knl_turbo_ratio_limit(unsigned 
  		return 0;
  
  	switch (model) {
++<<<<<<< HEAD
 +	case 0x57:	/* Knights Landing */
++=======
+ 	case INTEL_FAM6_XEON_PHI_KNL:	/* Knights Landing */
+ 	case INTEL_FAM6_XEON_PHI_KNM:
++>>>>>>> 005c82d64d1a (tools/power turbostat: Support Knights Mill (KNM))
  		return 1;
  	default:
  		return 0;
@@@ -1950,22 -2292,23 +1967,27 @@@ int has_config_tdp(unsigned int family
  		return 0;
  
  	switch (model) {
 -	case INTEL_FAM6_IVYBRIDGE:	/* IVB */
 -	case INTEL_FAM6_HASWELL_CORE:	/* HSW */
 -	case INTEL_FAM6_HASWELL_X:	/* HSX */
 -	case INTEL_FAM6_HASWELL_ULT:	/* HSW */
 -	case INTEL_FAM6_HASWELL_GT3E:	/* HSW */
 -	case INTEL_FAM6_BROADWELL_CORE:	/* BDW */
 -	case INTEL_FAM6_BROADWELL_GT3E:	/* BDW */
 -	case INTEL_FAM6_BROADWELL_X:	/* BDX */
 -	case INTEL_FAM6_BROADWELL_XEON_D:	/* BDX-DE */
 -	case INTEL_FAM6_SKYLAKE_MOBILE:	/* SKL */
 -	case INTEL_FAM6_SKYLAKE_DESKTOP:	/* SKL */
 -	case INTEL_FAM6_KABYLAKE_MOBILE:	/* KBL */
 -	case INTEL_FAM6_KABYLAKE_DESKTOP:	/* KBL */
 -	case INTEL_FAM6_SKYLAKE_X:	/* SKX */
 -
 +	case 0x3A:	/* IVB */
 +	case 0x3C:	/* HSW */
 +	case 0x3F:	/* HSX */
 +	case 0x45:	/* HSW */
 +	case 0x46:	/* HSW */
 +	case 0x3D:	/* BDW */
 +	case 0x47:	/* BDW */
 +	case 0x4F:	/* BDX */
 +	case 0x56:	/* BDX-DE */
 +	case 0x4E:	/* SKL */
 +	case 0x5E:	/* SKL */
 +	case 0x8E:	/* KBL */
 +	case 0x9E:	/* KBL */
 +	case 0x55:	/* SKX */
 +
++<<<<<<< HEAD
 +	case 0x57:	/* Knights Landing */
++=======
+ 	case INTEL_FAM6_XEON_PHI_KNL:	/* Knights Landing */
+ 	case INTEL_FAM6_XEON_PHI_KNM:
++>>>>>>> 005c82d64d1a (tools/power turbostat: Support Knights Mill (KNM))
  		return 1;
  	default:
  		return 0;
@@@ -2172,10 -2606,11 +2194,18 @@@ rapl_dram_energy_units_probe(int  model
  	/* only called for genuine_intel, family 6 */
  
  	switch (model) {
++<<<<<<< HEAD
 +	case 0x3F:	/* HSX */
 +	case 0x4F:	/* BDX */
 +	case 0x56:	/* BDX-DE */
 +	case 0x57:	/* KNL */
++=======
+ 	case INTEL_FAM6_HASWELL_X:	/* HSX */
+ 	case INTEL_FAM6_BROADWELL_X:	/* BDX */
+ 	case INTEL_FAM6_BROADWELL_XEON_D:	/* BDX-DE */
+ 	case INTEL_FAM6_XEON_PHI_KNL:	/* KNL */
+ 	case INTEL_FAM6_XEON_PHI_KNM:
++>>>>>>> 005c82d64d1a (tools/power turbostat: Support Knights Mill (KNM))
  		return (rapl_dram_energy_units = 15.3 / 1000000);
  	default:
  		return (rapl_energy_units);
@@@ -2201,40 -2636,41 +2231,49 @@@ void rapl_probe(unsigned int family, un
  		return;
  
  	switch (model) {
 -	case INTEL_FAM6_SANDYBRIDGE:
 -	case INTEL_FAM6_IVYBRIDGE:
 -	case INTEL_FAM6_HASWELL_CORE:	/* HSW */
 -	case INTEL_FAM6_HASWELL_ULT:	/* HSW */
 -	case INTEL_FAM6_HASWELL_GT3E:	/* HSW */
 -	case INTEL_FAM6_BROADWELL_CORE:	/* BDW */
 -	case INTEL_FAM6_BROADWELL_GT3E:	/* BDW */
 +	case 0x2A:
 +	case 0x3A:
 +	case 0x3C:	/* HSW */
 +	case 0x45:	/* HSW */
 +	case 0x46:	/* HSW */
 +	case 0x3D:	/* BDW */
 +	case 0x47:	/* BDW */
  		do_rapl = RAPL_PKG | RAPL_CORES | RAPL_CORE_POLICY | RAPL_GFX | RAPL_PKG_POWER_INFO;
  		break;
 -	case INTEL_FAM6_ATOM_GOLDMONT:	/* BXT */
 +	case 0x5C:	/* BXT */
  		do_rapl = RAPL_PKG | RAPL_PKG_POWER_INFO;
  		break;
 -	case INTEL_FAM6_SKYLAKE_MOBILE:	/* SKL */
 -	case INTEL_FAM6_SKYLAKE_DESKTOP:	/* SKL */
 -	case INTEL_FAM6_KABYLAKE_MOBILE:	/* KBL */
 -	case INTEL_FAM6_KABYLAKE_DESKTOP:	/* KBL */
 +	case 0x4E:	/* SKL */
 +	case 0x5E:	/* SKL */
 +	case 0x8E:	/* KBL */
 +	case 0x9E:	/* KBL */
 +		do_rapl = RAPL_PKG | RAPL_DRAM | RAPL_DRAM_PERF_STATUS | RAPL_PKG_PERF_STATUS | RAPL_PKG_POWER_INFO;
 +		break;
++<<<<<<< HEAD
 +	case 0x3F:	/* HSX */
  		do_rapl = RAPL_PKG | RAPL_DRAM | RAPL_DRAM_PERF_STATUS | RAPL_PKG_PERF_STATUS | RAPL_PKG_POWER_INFO;
  		break;
 +	case 0x2D:
 +	case 0x3E:
 +	case 0x4F:	/* BDX */
 +	case 0x56:	/* BDX-DE */
 +	case 0x55:	/* SKX */
 +	case 0x57:	/* KNL */
++=======
+ 	case INTEL_FAM6_HASWELL_X:	/* HSX */
+ 	case INTEL_FAM6_BROADWELL_X:	/* BDX */
+ 	case INTEL_FAM6_BROADWELL_XEON_D:	/* BDX-DE */
+ 	case INTEL_FAM6_SKYLAKE_X:	/* SKX */
+ 	case INTEL_FAM6_XEON_PHI_KNL:	/* KNL */
+ 	case INTEL_FAM6_XEON_PHI_KNM:
++>>>>>>> 005c82d64d1a (tools/power turbostat: Support Knights Mill (KNM))
  		do_rapl = RAPL_PKG | RAPL_DRAM | RAPL_DRAM_POWER_INFO | RAPL_DRAM_PERF_STATUS | RAPL_PKG_PERF_STATUS | RAPL_PKG_POWER_INFO;
  		break;
 -	case INTEL_FAM6_SANDYBRIDGE_X:
 -	case INTEL_FAM6_IVYBRIDGE_X:
 -		do_rapl = RAPL_PKG | RAPL_CORES | RAPL_CORE_POLICY | RAPL_DRAM | RAPL_DRAM_POWER_INFO | RAPL_PKG_PERF_STATUS | RAPL_DRAM_PERF_STATUS | RAPL_PKG_POWER_INFO;
 -		break;
 -	case INTEL_FAM6_ATOM_SILVERMONT1:	/* BYT */
 -	case INTEL_FAM6_ATOM_SILVERMONT2:	/* AVN */
 +	case 0x37:	/* BYT */
 +	case 0x4D:	/* AVN */
  		do_rapl = RAPL_PKG | RAPL_CORES;
  		break;
 -	case INTEL_FAM6_ATOM_DENVERTON:	/* DNV */
 +	case 0x5f:	/* DNV */
  		do_rapl = RAPL_PKG | RAPL_DRAM | RAPL_DRAM_POWER_INFO | RAPL_DRAM_PERF_STATUS | RAPL_PKG_PERF_STATUS | RAPL_PKG_POWER_INFO | RAPL_CORES_ENERGY_STATUS;
  		break;
  	default:
@@@ -2580,7 -3022,8 +2619,12 @@@ int is_knl(unsigned int family, unsigne
  	if (!genuine_intel)
  		return 0;
  	switch (model) {
++<<<<<<< HEAD
 +	case 0x57:	/* KNL */
++=======
+ 	case INTEL_FAM6_XEON_PHI_KNL:	/* KNL */
+ 	case INTEL_FAM6_XEON_PHI_KNM:
++>>>>>>> 005c82d64d1a (tools/power turbostat: Support Knights Mill (KNM))
  		return 1;
  	}
  	return 0;
* Unmerged path tools/power/x86/turbostat/turbostat.c
