drm/i915/lspcon: Fix resume time initialization due to unasserted HPD

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
Rebuild_CHGLOG: - [drm] i915/lspcon: Fix resume time initialization due to unasserted HPD (Rob Clark) [1422186]
Rebuild_FUZZ: 97.01%
commit-author Imre Deak <imre.deak@intel.com>
commit 390b4e00241ce14ca3967c4698c8f6a158c5a674
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/390b4e00.failed

During system resume time initialization the HPD level on LSPCON ports
can stay low for an extended amount of time, leading to failed AUX
transfers and LSPCON initialization. Fix this by waiting for HPD to get
asserted.

Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=99178
	Cc: Shashank Sharma <shashank.sharma@intel.com>
	Cc: Jani Nikula <jani.nikula@linux.intel.com>
	Cc: Ville Syrjälä <ville.syrjala@linux.intel.com>
	Cc: Daniel Vetter <daniel.vetter@ffwll.ch>
	Cc: <stable@vger.kernel.org> # v4.9+
	Signed-off-by: Imre Deak <imre.deak@intel.com>
	Reviewed-by: Shashank Sharma <shashank.sharma@intel.com>
Link: http://patchwork.freedesktop.org/patch/msgid/1485509961-9010-3-git-send-email-imre.deak@intel.com
(cherry picked from commit 390b4e00241ce14ca3967c4698c8f6a158c5a674)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/gpu/drm/i915/intel_dp.c
#	drivers/gpu/drm/i915/intel_drv.h
#	drivers/gpu/drm/i915/intel_lspcon.c
diff --cc drivers/gpu/drm/i915/intel_dp.c
index 51155b548b55,21924cf4c8ad..000000000000
--- a/drivers/gpu/drm/i915/intel_dp.c
+++ b/drivers/gpu/drm/i915/intel_dp.c
@@@ -4519,7 -4520,7 +4519,11 @@@ static bool bxt_digital_port_connected(
   * Return %true if @port is connected, %false otherwise.
   */
  bool intel_digital_port_connected(struct drm_i915_private *dev_priv,
++<<<<<<< HEAD
 +					 struct intel_digital_port *port)
++=======
+ 				  struct intel_digital_port *port)
++>>>>>>> 390b4e00241c (drm/i915/lspcon: Fix resume time initialization due to unasserted HPD)
  {
  	if (HAS_PCH_IBX(dev_priv))
  		return ibx_digital_port_connected(dev_priv, port);
diff --cc drivers/gpu/drm/i915/intel_drv.h
index fc197ed9221f,424f7ea04b68..000000000000
--- a/drivers/gpu/drm/i915/intel_drv.h
+++ b/drivers/gpu/drm/i915/intel_drv.h
@@@ -1335,6 -1489,23 +1335,26 @@@ bool intel_dp_source_supports_hbr2(stru
  bool
  intel_dp_get_link_status(struct intel_dp *intel_dp, uint8_t link_status[DP_LINK_STATUS_SIZE]);
  
++<<<<<<< HEAD
++=======
+ static inline unsigned int intel_dp_unused_lane_mask(int lane_count)
+ {
+ 	return ~((1 << lane_count) - 1) & 0xf;
+ }
+ 
+ bool intel_dp_read_dpcd(struct intel_dp *intel_dp);
+ bool __intel_dp_read_desc(struct intel_dp *intel_dp,
+ 			  struct intel_dp_desc *desc);
+ bool intel_dp_read_desc(struct intel_dp *intel_dp);
+ int intel_dp_link_required(int pixel_clock, int bpp);
+ int intel_dp_max_data_rate(int max_link_clock, int max_lanes);
+ bool intel_digital_port_connected(struct drm_i915_private *dev_priv,
+ 				  struct intel_digital_port *port);
+ 
+ /* intel_dp_aux_backlight.c */
+ int intel_dp_aux_init_backlight_funcs(struct intel_connector *intel_connector);
+ 
++>>>>>>> 390b4e00241c (drm/i915/lspcon: Fix resume time initialization due to unasserted HPD)
  /* intel_dp_mst.c */
  int intel_dp_mst_encoder_init(struct intel_digital_port *intel_dig_port, int conn_id);
  void intel_dp_mst_encoder_cleanup(struct intel_digital_port *intel_dig_port);
* Unmerged path drivers/gpu/drm/i915/intel_lspcon.c
* Unmerged path drivers/gpu/drm/i915/intel_dp.c
* Unmerged path drivers/gpu/drm/i915/intel_drv.h
* Unmerged path drivers/gpu/drm/i915/intel_lspcon.c
