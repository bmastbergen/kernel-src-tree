net: chelsio: cxgb3: use new api ethtool_{get|set}_link_ksettings

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
Rebuild_CHGLOG: - [netdrv] chelsio: cxgb3: use new api ethtool_{get|set}_link_ksettings (Don Dutile) [1417286]
Rebuild_FUZZ: 96.00%
commit-author Philippe Reynes <tremyfr@gmail.com>
commit b7b44fd23e6d2a896c6efbe85b39862f14aae11a
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/b7b44fd2.failed

The ethtool api {get|set}_settings is deprecated.
We move this driver to new api {get|set}_link_ksettings.

	Signed-off-by: Philippe Reynes <tremyfr@gmail.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit b7b44fd23e6d2a896c6efbe85b39862f14aae11a)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/chelsio/cxgb3/cxgb3_main.c
diff --cc drivers/net/ethernet/chelsio/cxgb3/cxgb3_main.c
index 5aa9a4977ba8,7b2224ae72f2..000000000000
--- a/drivers/net/ethernet/chelsio/cxgb3/cxgb3_main.c
+++ b/drivers/net/ethernet/chelsio/cxgb3/cxgb3_main.c
@@@ -1801,27 -1801,31 +1801,36 @@@ static int set_phys_id(struct net_devic
  	return 0;
  }
  
- static int get_settings(struct net_device *dev, struct ethtool_cmd *cmd)
+ static int get_link_ksettings(struct net_device *dev,
+ 			      struct ethtool_link_ksettings *cmd)
  {
  	struct port_info *p = netdev_priv(dev);
+ 	u32 supported;
  
- 	cmd->supported = p->link_config.supported;
- 	cmd->advertising = p->link_config.advertising;
+ 	ethtool_convert_legacy_u32_to_link_mode(cmd->link_modes.supported,
+ 						p->link_config.supported);
+ 	ethtool_convert_legacy_u32_to_link_mode(cmd->link_modes.advertising,
+ 						p->link_config.advertising);
  
  	if (netif_carrier_ok(dev)) {
- 		ethtool_cmd_speed_set(cmd, p->link_config.speed);
- 		cmd->duplex = p->link_config.duplex;
+ 		cmd->base.speed = p->link_config.speed;
+ 		cmd->base.duplex = p->link_config.duplex;
  	} else {
++<<<<<<< HEAD
 +		ethtool_cmd_speed_set(cmd, -1);
 +		cmd->duplex = -1;
++=======
+ 		cmd->base.speed = SPEED_UNKNOWN;
+ 		cmd->base.duplex = DUPLEX_UNKNOWN;
++>>>>>>> b7b44fd23e6d (net: chelsio: cxgb3: use new api ethtool_{get|set}_link_ksettings)
  	}
  
- 	cmd->port = (cmd->supported & SUPPORTED_TP) ? PORT_TP : PORT_FIBRE;
- 	cmd->phy_address = p->phy.mdio.prtad;
- 	cmd->transceiver = XCVR_EXTERNAL;
- 	cmd->autoneg = p->link_config.autoneg;
- 	cmd->maxtxpkt = 0;
- 	cmd->maxrxpkt = 0;
+ 	ethtool_convert_link_mode_to_legacy_u32(&supported,
+ 						cmd->link_modes.supported);
+ 
+ 	cmd->base.port = (supported & SUPPORTED_TP) ? PORT_TP : PORT_FIBRE;
+ 	cmd->base.phy_address = p->phy.mdio.prtad;
+ 	cmd->base.autoneg = p->link_config.autoneg;
  	return 0;
  }
  
* Unmerged path drivers/net/ethernet/chelsio/cxgb3/cxgb3_main.c
