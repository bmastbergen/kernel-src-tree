xprtrdma: Avoid calls to ro_unmap_safe()

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
commit-author Chuck Lever <chuck.lever@oracle.com>
commit 48016dce46ad504a378849490bfb99c98be5cfaa
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/48016dce.failed

Micro-optimization: Most of the time, calls to ro_unmap_safe are
expensive no-ops. Call only when there is work to do.

	Signed-off-by: Chuck Lever <chuck.lever@oracle.com>
	Signed-off-by: Anna Schumaker <Anna.Schumaker@Netapp.com>
(cherry picked from commit 48016dce46ad504a378849490bfb99c98be5cfaa)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/sunrpc/xprtrdma/transport.c
diff --cc net/sunrpc/xprtrdma/transport.c
index f834dfd7d240,545d3fc8de5a..000000000000
--- a/net/sunrpc/xprtrdma/transport.c
+++ b/net/sunrpc/xprtrdma/transport.c
@@@ -580,13 -619,11 +580,19 @@@ xprt_rdma_free(void *buffer
  	if (req->rl_backchannel)
  		return;
  
 +	r_xprt = container_of(req->rl_buffer, struct rpcrdma_xprt, rx_buf);
 +
  	dprintk("RPC:       %s: called on 0x%p\n", __func__, req->rl_reply);
  
++<<<<<<< HEAD
 +	r_xprt->rx_ia.ri_ops->ro_unmap_safe(r_xprt, req,
 +					    !RPC_IS_ASYNC(req->rl_task));
 +
++=======
+ 	if (unlikely(!list_empty(&req->rl_registered)))
+ 		ia->ri_ops->ro_unmap_safe(r_xprt, req, !RPC_IS_ASYNC(task));
+ 	rpcrdma_unmap_sges(ia, req);
++>>>>>>> 48016dce46ad (xprtrdma: Avoid calls to ro_unmap_safe())
  	rpcrdma_buffer_put(req);
  }
  
@@@ -610,6 -657,10 +616,13 @@@ xprt_rdma_send_request(struct rpc_task 
  	struct rpcrdma_xprt *r_xprt = rpcx_to_rdmax(xprt);
  	int rc = 0;
  
++<<<<<<< HEAD
++=======
+ 	/* On retransmit, remove any previously registered chunks */
+ 	if (unlikely(!list_empty(&req->rl_registered)))
+ 		r_xprt->rx_ia.ri_ops->ro_unmap_safe(r_xprt, req, false);
+ 
++>>>>>>> 48016dce46ad (xprtrdma: Avoid calls to ro_unmap_safe())
  	rc = rpcrdma_marshal_req(rqst);
  	if (rc < 0)
  		goto failed_marshal;
* Unmerged path net/sunrpc/xprtrdma/transport.c
