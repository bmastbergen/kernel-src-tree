mmc: core: Only change mode if mmc_select_bus_width() is successful

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
Rebuild_CHGLOG: - [mmc] core: Only change mode if mmc_select_bus_width() is successful (Don Zickus) [1430497]
Rebuild_FUZZ: 96.12%
commit-author Peter Griffin <peter.griffin@linaro.org>
commit 8b7be8f2e7fe6c037fc7c89029a4a568ad2c60b1
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/8b7be8f2.failed

mmc_select_bus_width() returns bus width (4 or 8) on success or
zero if unsupported. So only change mode if setting the bus width
is successful.

	Signed-off-by: Peter Griffin <peter.griffin@linaro.org>
	Signed-off-by: Ulf Hansson <ulf.hansson@linaro.org>
(cherry picked from commit 8b7be8f2e7fe6c037fc7c89029a4a568ad2c60b1)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/mmc/core/mmc.c
diff --cc drivers/mmc/core/mmc.c
index 39da296a75b1,ccab9bb8c45a..000000000000
--- a/drivers/mmc/core/mmc.c
+++ b/drivers/mmc/core/mmc.c
@@@ -1334,7 -1334,7 +1334,11 @@@ static int mmc_select_hs200(struct mmc_
  	 * switch to HS200 mode if bus width is set successfully.
  	 */
  	err = mmc_select_bus_width(card);
++<<<<<<< HEAD
 +	if (!IS_ERR_VALUE(err)) {
++=======
+ 	if (err > 0) {
++>>>>>>> 8b7be8f2e7fe (mmc: core: Only change mode if mmc_select_bus_width() is successful)
  		val = EXT_CSD_TIMING_HS200 |
  		      card->drive_strength << EXT_CSD_DRV_STR_SHIFT;
  		err = __mmc_switch(card, EXT_CSD_CMD_SET_NORMAL,
@@@ -1642,7 -1642,7 +1646,11 @@@ static int mmc_init_card(struct mmc_hos
  	} else if (mmc_card_hs(card)) {
  		/* Select the desired bus width optionally */
  		err = mmc_select_bus_width(card);
++<<<<<<< HEAD
 +		if (!IS_ERR_VALUE(err)) {
++=======
+ 		if (err > 0) {
++>>>>>>> 8b7be8f2e7fe (mmc: core: Only change mode if mmc_select_bus_width() is successful)
  			err = mmc_select_hs_ddr(card);
  			if (err)
  				goto free_card;
* Unmerged path drivers/mmc/core/mmc.c
