IB/rxe: Fix race condition between requester and completer

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
commit-author Yonatan Cohen <yonatanc@mellanox.com>
commit 3050b99850247695cb07a5c15265afcc08bcf400
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/3050b998.failed

rxe_requester() is sending a pkt with rxe_xmit_packet() and
then calls rxe_update() to update the wqe and qp's psn values.
But sometimes the response is received before the requester
had time to update the wqe in which case the completer
acts on errornous wqe values.
This fix updates the wqe and qp before actually sending
the request and rolls back when xmit fails.

Fixes: 8700e3e7c485 ("Soft RoCE driver")
	Signed-off-by: Yonatan Cohen <yonatanc@mellanox.com>
	Signed-off-by: Leon Romanovsky <leon@kernel.org>
	Signed-off-by: Doug Ledford <dledford@redhat.com>
(cherry picked from commit 3050b99850247695cb07a5c15265afcc08bcf400)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/infiniband/sw/rxe/rxe_req.c
* Unmerged path drivers/infiniband/sw/rxe/rxe_req.c
* Unmerged path drivers/infiniband/sw/rxe/rxe_req.c
