SUNRPC rpc_clnt_xprt_switch_put

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
commit-author Andy Adamson <andros@netapp.com>
commit 3b58a8a9049d5e191402665c339690a148504358
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/3b58a8a9.failed

Give the NFS layer access to the xprt_switch_put function

	Signed-off-by: Andy Adamson <andros@netapp.com>
	Signed-off-by: Anna Schumaker <Anna.Schumaker@Netapp.com>
(cherry picked from commit 3b58a8a9049d5e191402665c339690a148504358)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/sunrpc/clnt.c
diff --cc net/sunrpc/clnt.c
index cfcbe92be38e,0ff5cbf3d631..000000000000
--- a/net/sunrpc/clnt.c
+++ b/net/sunrpc/clnt.c
@@@ -2635,6 -2674,33 +2635,36 @@@ out_put_switch
  }
  EXPORT_SYMBOL_GPL(rpc_clnt_add_xprt);
  
++<<<<<<< HEAD
++=======
+ static int
+ rpc_xprt_cap_max_reconnect_timeout(struct rpc_clnt *clnt,
+ 		struct rpc_xprt *xprt,
+ 		void *data)
+ {
+ 	unsigned long timeout = *((unsigned long *)data);
+ 
+ 	if (timeout < xprt->max_reconnect_timeout)
+ 		xprt->max_reconnect_timeout = timeout;
+ 	return 0;
+ }
+ 
+ void
+ rpc_cap_max_reconnect_timeout(struct rpc_clnt *clnt, unsigned long timeo)
+ {
+ 	rpc_clnt_iterate_for_each_xprt(clnt,
+ 			rpc_xprt_cap_max_reconnect_timeout,
+ 			&timeo);
+ }
+ EXPORT_SYMBOL_GPL(rpc_cap_max_reconnect_timeout);
+ 
+ void rpc_clnt_xprt_switch_put(struct rpc_clnt *clnt)
+ {
+ 	xprt_switch_put(rcu_dereference(clnt->cl_xpi.xpi_xpswitch));
+ }
+ EXPORT_SYMBOL_GPL(rpc_clnt_xprt_switch_put);
+ 
++>>>>>>> 3b58a8a9049d (SUNRPC rpc_clnt_xprt_switch_put)
  #if IS_ENABLED(CONFIG_SUNRPC_DEBUG)
  static void rpc_show_header(void)
  {
diff --git a/include/linux/sunrpc/clnt.h b/include/linux/sunrpc/clnt.h
index 9a7ddbaf116e..a448c5086248 100644
--- a/include/linux/sunrpc/clnt.h
+++ b/include/linux/sunrpc/clnt.h
@@ -198,5 +198,7 @@ int		rpc_clnt_add_xprt(struct rpc_clnt *, struct xprt_create *,
 			void *data);
 
 const char *rpc_proc_name(const struct rpc_task *task);
+
+void rpc_clnt_xprt_switch_put(struct rpc_clnt *);
 #endif /* __KERNEL__ */
 #endif /* _LINUX_SUNRPC_CLNT_H */
* Unmerged path net/sunrpc/clnt.c
