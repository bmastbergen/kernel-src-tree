amd-xgbe: Check xgbe_init() return code

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
commit-author Lendacky, Thomas <Thomas.Lendacky@amd.com>
commit 738f7f647371ff4cfc9646c99dba5b58ad142db3
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/738f7f64.failed

The xgbe_init() routine returns a return code indicating success or
failure, but the return code is not checked. Add code to xgbe_init()
to issue a message when failures are seen and add code to check the
xgbe_init() return code.

	Signed-off-by: Tom Lendacky <thomas.lendacky@amd.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 738f7f647371ff4cfc9646c99dba5b58ad142db3)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/amd/xgbe/xgbe-drv.c
diff --cc drivers/net/ethernet/amd/xgbe/xgbe-drv.c
index d58e85811bc9,1c87cc204075..000000000000
--- a/drivers/net/ethernet/amd/xgbe/xgbe-drv.c
+++ b/drivers/net/ethernet/amd/xgbe/xgbe-drv.c
@@@ -576,11 -1069,20 +576,17 @@@ static int xgbe_start(struct xgbe_prv_d
  
  	DBGPR("-->xgbe_start\n");
  
++<<<<<<< HEAD
 +	xgbe_set_rx_mode(netdev);
 +
 +	hw_if->init(pdata);
++=======
+ 	ret = hw_if->init(pdata);
+ 	if (ret)
+ 		return ret;
++>>>>>>> 738f7f647371 (amd-xgbe: Check xgbe_init() return code)
  
 -	xgbe_napi_enable(pdata, 1);
 -
 -	ret = xgbe_request_irqs(pdata);
 -	if (ret)
 -		goto err_napi;
 -
 -	ret = phy_if->phy_start(pdata);
 -	if (ret)
 -		goto err_irqs;
 +	phy_start(pdata->phydev);
  
  	hw_if->enable_tx(pdata);
  	hw_if->enable_rx(pdata);
diff --git a/drivers/net/ethernet/amd/xgbe/xgbe-dev.c b/drivers/net/ethernet/amd/xgbe/xgbe-dev.c
index de7b81d8b4ee..c0ecc5f283f5 100644
--- a/drivers/net/ethernet/amd/xgbe/xgbe-dev.c
+++ b/drivers/net/ethernet/amd/xgbe/xgbe-dev.c
@@ -2130,8 +2130,10 @@ static int xgbe_init(struct xgbe_prv_data *pdata)
 
 	/* Flush Tx queues */
 	ret = xgbe_flush_tx_queues(pdata);
-	if (ret)
+	if (ret) {
+		netdev_err(pdata->netdev, "error flushing TX queues\n");
 		return ret;
+	}
 
 	/*
 	 * Initialize DMA related features
* Unmerged path drivers/net/ethernet/amd/xgbe/xgbe-drv.c
