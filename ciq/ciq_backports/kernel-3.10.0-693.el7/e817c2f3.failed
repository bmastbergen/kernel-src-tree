selinux: Don't sleep inside inode_getsecid hook

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
commit-author Andreas Gruenbacher <agruenba@redhat.com>
commit e817c2f33efb4aa7f02c98dfab9a5f8ff383ea7e
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/e817c2f3.failed

The inode_getsecid hook is called from contexts in which sleeping is not
allowed, so we cannot revalidate inode security labels from there. Use
the non-validating version of inode_security() instead.

	Reported-by: Benjamin Coddington <bcodding@redhat.com>
	Signed-off-by: Andreas Gruenbacher <agruenba@redhat.com>
	Acked-by: Stephen Smalley <sds@tycho.nsa.gov>
	Signed-off-by: Paul Moore <paul@paul-moore.com>
(cherry picked from commit e817c2f33efb4aa7f02c98dfab9a5f8ff383ea7e)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	security/selinux/hooks.c
diff --cc security/selinux/hooks.c
index 47406b6a55bb,f1ab71504e1d..000000000000
--- a/security/selinux/hooks.c
+++ b/security/selinux/hooks.c
@@@ -3102,9 -3247,9 +3102,13 @@@ static int selinux_inode_listsecurity(s
  	return len;
  }
  
 -static void selinux_inode_getsecid(struct inode *inode, u32 *secid)
 +static void selinux_inode_getsecid(const struct inode *inode, u32 *secid)
  {
++<<<<<<< HEAD
 +	struct inode_security_struct *isec = inode->i_security;
++=======
+ 	struct inode_security_struct *isec = inode_security_novalidate(inode);
++>>>>>>> e817c2f33efb (selinux: Don't sleep inside inode_getsecid hook)
  	*secid = isec->sid;
  }
  
* Unmerged path security/selinux/hooks.c
