net_sched: act_gact: make tcfg_pval non zero

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
Rebuild_CHGLOG: - [net] sched: act_gact: make tcfg_pval non zero (Ivan Vecera) [1428588]
Rebuild_FUZZ: 95.24%
commit-author Eric Dumazet <edumazet@google.com>
commit cef5ecf96b28dc91c4e9f398a336c578fb9e1a0c
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/cef5ecf9.failed

First step for gact RCU operation :

Instead of testing if tcfg_pval is zero or not, just make it 1.

No change in behavior, but slightly faster code.

The smp_rmb()/smp_wmb() barriers, while not strictly needed at this
stage are added for upcoming spinlock removal.

	Signed-off-by: Eric Dumazet <edumazet@google.com>
	Acked-by: Alexei Starovoitov <ast@plumgrid.com>
	Acked-by: Jamal Hadi Salim <jhs@mojatatu.com>
	Acked-by: John Fastabend <john.fastabend@gmail.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit cef5ecf96b28dc91c4e9f398a336c578fb9e1a0c)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/sched/act_gact.c
diff --cc net/sched/act_gact.c
index eb9ba60ebab4,22a3a61aa090..000000000000
--- a/net/sched/act_gact.c
+++ b/net/sched/act_gact.c
@@@ -37,7 -28,8 +37,12 @@@ static struct tcf_hashinfo gact_hash_in
  #ifdef CONFIG_GACT_PROB
  static int gact_net_rand(struct tcf_gact *gact)
  {
++<<<<<<< HEAD
 +	if (!gact->tcfg_pval || net_random() % gact->tcfg_pval)
++=======
+ 	smp_rmb(); /* coupled with smp_wmb() in tcf_gact_init() */
+ 	if (prandom_u32() % gact->tcfg_pval)
++>>>>>>> cef5ecf96b28 (net_sched: act_gact: make tcfg_pval non zero)
  		return gact->tcf_action;
  	return gact->tcfg_paction;
  }
* Unmerged path net/sched/act_gact.c
