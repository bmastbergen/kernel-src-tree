cxgb4/cxgb4vf: Assign netdev->dev_port with port ID

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
commit-author Arjun V <arjun@chelsio.com>
commit d2a007ab191646d41553ffb6624cef1957e899ae
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/d2a007ab.failed

Added missing dev_port assignment in cxgb4vf driver.
Also made dev_port assignment of cxgb4 in sync with cxgb4vf driver.

	Signed-off-by: Casey Leedom <leedom@chelsio.com>
	Signed-off-by: Arjun V <arjun@chelsio.com>
	Signed-off-by: Hariprasad Shenai <hariprasad@chelsio.com>
	Signed-off-by: Ganesh Goudar <ganeshgr@chelsio.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit d2a007ab191646d41553ffb6624cef1957e899ae)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/chelsio/cxgb4vf/cxgb4vf_main.c
diff --cc drivers/net/ethernet/chelsio/cxgb4vf/cxgb4vf_main.c
index 2b3330b1f939,a37481c04a87..000000000000
--- a/drivers/net/ethernet/chelsio/cxgb4vf/cxgb4vf_main.c
+++ b/drivers/net/ethernet/chelsio/cxgb4vf/cxgb4vf_main.c
@@@ -2968,7 -2968,8 +2968,12 @@@ static int cxgb4vf_pci_probe(struct pci
  		netdev->priv_flags |= IFF_UNICAST_FLT;
  
  		netdev->netdev_ops = &cxgb4vf_netdev_ops;
++<<<<<<< HEAD
 +		SET_ETHTOOL_OPS(netdev, &cxgb4vf_ethtool_ops);
++=======
+ 		netdev->ethtool_ops = &cxgb4vf_ethtool_ops;
+ 		netdev->dev_port = pi->port_id;
++>>>>>>> d2a007ab1916 (cxgb4/cxgb4vf: Assign netdev->dev_port with port ID)
  
  		/*
  		 * Initialize the hardware/software state for the port.
diff --git a/drivers/net/ethernet/chelsio/cxgb4/cxgb4_main.c b/drivers/net/ethernet/chelsio/cxgb4/cxgb4_main.c
index db420692c8e7..d6de6222bdf2 100644
--- a/drivers/net/ethernet/chelsio/cxgb4/cxgb4_main.c
+++ b/drivers/net/ethernet/chelsio/cxgb4/cxgb4_main.c
@@ -5285,6 +5285,7 @@ static int init_one(struct pci_dev *pdev, const struct pci_device_id *ent)
 	 */
 	for_each_port(adapter, i) {
 		pi = adap2pinfo(adapter, i);
+		adapter->port[i]->dev_port = pi->lport;
 		netif_set_real_num_tx_queues(adapter->port[i], pi->nqsets);
 		netif_set_real_num_rx_queues(adapter->port[i], pi->nqsets);
 
diff --git a/drivers/net/ethernet/chelsio/cxgb4/t4_hw.c b/drivers/net/ethernet/chelsio/cxgb4/t4_hw.c
index c717d4b6032b..d72c23f0c6d7 100644
--- a/drivers/net/ethernet/chelsio/cxgb4/t4_hw.c
+++ b/drivers/net/ethernet/chelsio/cxgb4/t4_hw.c
@@ -7852,7 +7852,6 @@ int t4_port_init(struct adapter *adap, int mbox, int pf, int vf)
 			return ret;
 
 		memcpy(adap->port[i]->dev_addr, addr, ETH_ALEN);
-		adap->port[i]->dev_port = j;
 		j++;
 	}
 	return 0;
* Unmerged path drivers/net/ethernet/chelsio/cxgb4vf/cxgb4vf_main.c
