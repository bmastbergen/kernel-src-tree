dm crypt: rewrite (wipe) key in crypto layer using random data

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
commit-author Ondrej Kozina <okozina@redhat.com>
commit c82feeec9a014b72c4ffea36648cfb6f81cc1b73
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/c82feeec.failed

The message "key wipe" used to wipe real key stored in crypto layer by
rewriting it with zeroes.  Since commit 28856a9 ("crypto: xts -
consolidate sanity check for keys") this no longer works in FIPS mode
for XTS.

While running in FIPS mode the crypto key part has to differ from the
tweak key.

Fixes: 28856a9 ("crypto: xts - consolidate sanity check for keys")
	Cc: stable@vger.kernel.org
	Signed-off-by: Ondrej Kozina <okozina@redhat.com>
	Signed-off-by: Mike Snitzer <snitzer@redhat.com>
(cherry picked from commit c82feeec9a014b72c4ffea36648cfb6f81cc1b73)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/md/dm-crypt.c
diff --cc drivers/md/dm-crypt.c
index a5f873f4eff4,bb2e747907b0..000000000000
--- a/drivers/md/dm-crypt.c
+++ b/drivers/md/dm-crypt.c
@@@ -1519,10 -2152,16 +1519,19 @@@ out
  
  static int crypt_wipe_key(struct crypt_config *cc)
  {
+ 	int r;
+ 
  	clear_bit(DM_CRYPT_KEY_VALID, &cc->flags);
++<<<<<<< HEAD
++=======
+ 	get_random_bytes(&cc->key, cc->key_size);
+ 	kzfree(cc->key_string);
+ 	cc->key_string = NULL;
+ 	r = crypt_setkey(cc);
++>>>>>>> c82feeec9a01 (dm crypt: rewrite (wipe) key in crypto layer using random data)
  	memset(&cc->key, 0, cc->key_size * sizeof(u8));
  
- 	return crypt_setkey(cc);
+ 	return r;
  }
  
  static void crypt_dtr(struct dm_target *ti)
* Unmerged path drivers/md/dm-crypt.c
