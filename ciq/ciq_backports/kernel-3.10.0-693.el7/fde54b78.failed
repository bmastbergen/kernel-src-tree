perf trace: Make "--call-graph" affect just "raw_syscalls:sys_exit"

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
commit-author Arnaldo Carvalho de Melo <acme@redhat.com>
commit fde54b7860ffff1c93e6b9abb3fbc3b8b95f2695
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/fde54b78.failed

We don't need the callchains at the syscall enter tracepoint, just when
finishing it at syscall exit, so reduce the overhead by asking for
callchains just at syscall exit.

	Suggested-by: Milian Wolff <milian.wolff@kdab.com>
	Cc: Adrian Hunter <adrian.hunter@intel.com>
	Cc: David Ahern <dsahern@gmail.com>
	Cc: Jiri Olsa <jolsa@kernel.org>
	Cc: Namhyung Kim <namhyung@kernel.org>
	Cc: Wang Nan <wangnan0@huawei.com>
Link: http://lkml.kernel.org/n/tip-fja1ods5vqpg42mdz09xcz3r@git.kernel.org
	Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>
(cherry picked from commit fde54b7860ffff1c93e6b9abb3fbc3b8b95f2695)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	tools/perf/builtin-trace.c
diff --cc tools/perf/builtin-trace.c
index 6a499ab19e51,60ab7ce3bc90..000000000000
--- a/tools/perf/builtin-trace.c
+++ b/tools/perf/builtin-trace.c
@@@ -2701,7 -2749,27 +2701,31 @@@ static int trace__run(struct trace *tra
  		goto out_delete_evlist;
  	}
  
++<<<<<<< HEAD
 +	perf_evlist__config(evlist, &trace->opts);
++=======
+ 	perf_evlist__config(evlist, &trace->opts, NULL);
+ 
+ 	if (trace->opts.callgraph_set && trace->syscalls.events.sys_exit) {
+ 		perf_evsel__config_callchain(trace->syscalls.events.sys_exit,
+ 					     &trace->opts, &callchain_param);
+                /*
+                 * Now we have evsels with different sample_ids, use
+                 * PERF_SAMPLE_IDENTIFIER to map from sample to evsel
+                 * from a fixed position in each ring buffer record.
+                 *
+                 * As of this the changeset introducing this comment, this
+                 * isn't strictly needed, as the fields that can come before
+                 * PERF_SAMPLE_ID are all used, but we'll probably disable
+                 * some of those for things like copying the payload of
+                 * pointer syscall arguments, and for vfs_getname we don't
+                 * need PERF_SAMPLE_ADDR and PERF_SAMPLE_IP, so do this
+                 * here as a warning we need to use PERF_SAMPLE_IDENTIFIER.
+                 */
+ 		perf_evlist__set_sample_bit(evlist, IDENTIFIER);
+ 		perf_evlist__reset_sample_bit(evlist, ID);
+ 	}
++>>>>>>> fde54b7860ff (perf trace: Make "--call-graph" affect just "raw_syscalls:sys_exit")
  
  	signal(SIGCHLD, sig_handler);
  	signal(SIGINT, sig_handler);
* Unmerged path tools/perf/builtin-trace.c
