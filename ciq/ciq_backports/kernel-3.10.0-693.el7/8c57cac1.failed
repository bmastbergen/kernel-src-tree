mei: me: disable driver on SPT SPS firmware

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
commit-author Tomas Winkler <tomas.winkler@intel.com>
commit 8c57cac1457f3125a5d13dc03635c0708c61bff0
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/8c57cac1.failed

Sunrise Point PCH with SPS Firmware doesn't expose working
MEI interface, we need to quirk it out.
The SPS Firmware is identifiable only on the first PCI function
of the device.

	Cc: <stable@vger.kernel.org> #4.6+
	Tested-by: Sujith Pandel <sujith_pandel@dell.com>
	Signed-off-by: Tomas Winkler <tomas.winkler@intel.com>
	Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
(cherry picked from commit 8c57cac1457f3125a5d13dc03635c0708c61bff0)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/misc/mei/hw-me.c
diff --cc drivers/misc/mei/hw-me.c
index 5c641651f55a,dc3a854e02d3..000000000000
--- a/drivers/misc/mei/hw-me.c
+++ b/drivers/misc/mei/hw-me.c
@@@ -1260,8 -1263,15 +1260,20 @@@ static bool mei_me_fw_type_nm(struct pc
  static bool mei_me_fw_type_sps(struct pci_dev *pdev)
  {
  	u32 reg;
++<<<<<<< HEAD
 +	/* Read ME FW Status check for SPS Firmware */
 +	pci_read_config_dword(pdev, PCI_CFG_HFS_1, &reg);
++=======
+ 	unsigned int devfn;
+ 
+ 	/*
+ 	 * Read ME FW Status register to check for SPS Firmware
+ 	 * The SPS FW is only signaled in pci function 0
+ 	 */
+ 	devfn = PCI_DEVFN(PCI_SLOT(pdev->devfn), 0);
+ 	pci_bus_read_config_dword(pdev->bus, devfn, PCI_CFG_HFS_1, &reg);
+ 	trace_mei_pci_cfg_read(&pdev->dev, "PCI_CFG_HFS_1", PCI_CFG_HFS_1, reg);
++>>>>>>> 8c57cac1457f (mei: me: disable driver on SPT SPS firmware)
  	/* if bits [19:16] = 15, running SPS Firmware */
  	return (reg & 0xf0000) == 0xf0000;
  }
* Unmerged path drivers/misc/mei/hw-me.c
diff --git a/drivers/misc/mei/pci-me.c b/drivers/misc/mei/pci-me.c
index 7237fc66b78d..57b05a38f84b 100644
--- a/drivers/misc/mei/pci-me.c
+++ b/drivers/misc/mei/pci-me.c
@@ -87,8 +87,8 @@ static const struct pci_device_id mei_me_pci_tbl[] = {
 
 	{MEI_PCI_DEVICE(MEI_DEV_ID_SPT, mei_me_pch8_cfg)},
 	{MEI_PCI_DEVICE(MEI_DEV_ID_SPT_2, mei_me_pch8_cfg)},
-	{MEI_PCI_DEVICE(MEI_DEV_ID_SPT_H, mei_me_pch8_cfg)},
-	{MEI_PCI_DEVICE(MEI_DEV_ID_SPT_H_2, mei_me_pch8_cfg)},
+	{MEI_PCI_DEVICE(MEI_DEV_ID_SPT_H, mei_me_pch8_sps_cfg)},
+	{MEI_PCI_DEVICE(MEI_DEV_ID_SPT_H_2, mei_me_pch8_sps_cfg)},
 
 	/* required last entry */
 	{0, }
