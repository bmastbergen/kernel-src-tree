raid10: record correct address of bad block

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
commit-author Tomasz Majchrzak <tomasz.majchrzak@intel.com>
commit 27028626b4b9022dcac23688e09ea43b36e1183c
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/27028626.failed

For failed write request record block address on a device, not block
address in an array.

	Signed-off-by: Tomasz Majchrzak <tomasz.majchrzak@intel.com>
	Signed-off-by: Shaohua Li <shli@fb.com>
(cherry picked from commit 27028626b4b9022dcac23688e09ea43b36e1183c)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/md/raid10.c
diff --cc drivers/md/raid10.c
index 4a55110ff8e8,4589866257d5..000000000000
--- a/drivers/md/raid10.c
+++ b/drivers/md/raid10.c
@@@ -2606,14 -2470,16 +2607,21 @@@ static int narrow_write_error(struct r1
  			sectors = sect_to_write;
  		/* Write at 'sector' for 'sectors' */
  		wbio = bio_clone_mddev(bio, GFP_NOIO, mddev);
++<<<<<<< HEAD
 +		bio_trim(wbio, sector - bio->bi_sector, sectors);
 +		wbio->bi_sector = (r10_bio->devs[i].addr+
 +				   choose_data_offset(r10_bio, rdev) +
 +				   (sector - r10_bio->sector));
++=======
+ 		bio_trim(wbio, sector - bio->bi_iter.bi_sector, sectors);
+ 		wsector = r10_bio->devs[i].addr + (sector - r10_bio->sector);
+ 		wbio->bi_iter.bi_sector = wsector +
+ 				   choose_data_offset(r10_bio, rdev);
++>>>>>>> 27028626b4b9 (raid10: record correct address of bad block)
  		wbio->bi_bdev = rdev->bdev;
 -		bio_set_op_attrs(wbio, REQ_OP_WRITE, 0);
 -
 -		if (submit_bio_wait(wbio) < 0)
 +		if (submit_bio_wait(WRITE, wbio) < 0)
  			/* Failure! */
- 			ok = rdev_set_badblocks(rdev, sector,
+ 			ok = rdev_set_badblocks(rdev, wsector,
  						sectors, 0)
  				&& ok;
  
* Unmerged path drivers/md/raid10.c
