net: fix suspicious rcu_dereference_check in net/sched/sch_fq_codel.c

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
Rebuild_CHGLOG: - [net] sched: fix suspicious rcu_dereference_check in net/sched/sch_fq_codel.c (Ivan Vecera) [1420506]
Rebuild_FUZZ: 95.71%
commit-author Valdis Kletnieks <Valdis.Kletnieks@vt.edu>
commit 69204cf7eb9c5a72067ce6922d4699378251d053
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/69204cf7.failed

commit 46e5da40ae (net: qdisc: use rcu prefix and silence
 sparse warnings) triggers a spurious warning:

net/sched/sch_fq_codel.c:97 suspicious rcu_dereference_check() usage!

The code should be using the _bh variant of rcu_dereference.

	Signed-off-by: Valdis Kletnieks <valdis.kletnieks@vt.edu>
	Acked-by: Eric Dumazet <edumazet@google.com>
	Acked-by: John Fastabend <john.r.fastabend@intel.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 69204cf7eb9c5a72067ce6922d4699378251d053)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/sched/sch_fq_codel.c
diff --cc net/sched/sch_fq_codel.c
index 37446386fbda,1e52decb7b59..000000000000
--- a/net/sched/sch_fq_codel.c
+++ b/net/sched/sch_fq_codel.c
@@@ -93,7 -94,8 +93,12 @@@ static unsigned int fq_codel_classify(s
  	    TC_H_MIN(skb->priority) <= q->flows_cnt)
  		return TC_H_MIN(skb->priority);
  
++<<<<<<< HEAD
 +	if (!q->filter_list)
++=======
+ 	filter = rcu_dereference_bh(q->filter_list);
+ 	if (!filter)
++>>>>>>> 69204cf7eb9c (net: fix suspicious rcu_dereference_check in net/sched/sch_fq_codel.c)
  		return fq_codel_hash(q, skb) + 1;
  
  	*qerr = NET_XMIT_SUCCESS | __NET_XMIT_BYPASS;
* Unmerged path net/sched/sch_fq_codel.c
