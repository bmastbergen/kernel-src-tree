dell-wmi: enable receiving WMI events on Dell Vostro V131

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
commit-author Michał Kępień <kernel@kempniu.pl>
commit e09c4d5b15438bd86ff8bfb05d70f17915bb5979
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/e09c4d5b.failed

On some laptop models (e.g. Dell Vostro V131), WMI events are not
generated until a specific SMBIOS request is issued to register an event
listener [1].  As there seems to be no ACPI method or SMBIOS request to
determine without possible side effects whether a given machine needs to
issue this SMBIOS request in order to receive WMI events, DMI matching
is used to whitelist the models which need it.

[1] https://lists.us.dell.com/pipermail/libsmbios-devel/2015-July/000612.html

	Signed-off-by: Michał Kępień <kernel@kempniu.pl>
	Reviewed-by: Pali Rohár <pali.rohar@gmail.com>
	Signed-off-by: Darren Hart <dvhart@linux.intel.com>
(cherry picked from commit e09c4d5b15438bd86ff8bfb05d70f17915bb5979)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/platform/x86/Kconfig
#	drivers/platform/x86/dell-wmi.c
diff --cc drivers/platform/x86/Kconfig
index 8882b9d2c899,ed2004be13cf..000000000000
--- a/drivers/platform/x86/Kconfig
+++ b/drivers/platform/x86/Kconfig
@@@ -108,7 -121,10 +108,12 @@@ config DELL_LAPTO
  config DELL_WMI
  	tristate "Dell WMI extras"
  	depends on ACPI_WMI
 -	depends on DMI
  	depends on INPUT
++<<<<<<< HEAD
++=======
+ 	depends on ACPI_VIDEO || ACPI_VIDEO = n
+ 	depends on DELL_SMBIOS
++>>>>>>> e09c4d5b1543 (dell-wmi: enable receiving WMI events on Dell Vostro V131)
  	select INPUT_SPARSEKMAP
  	---help---
  	  Say Y here if you want to support WMI-based hotkeys on Dell laptops.
diff --cc drivers/platform/x86/dell-wmi.c
index 29c8dbd4c921,65edd93df7de..000000000000
--- a/drivers/platform/x86/dell-wmi.c
+++ b/drivers/platform/x86/dell-wmi.c
@@@ -37,6 -36,8 +37,11 @@@
  #include <linux/acpi.h>
  #include <linux/string.h>
  #include <linux/dmi.h>
++<<<<<<< HEAD
++=======
+ #include <acpi/video.h>
+ #include "dell-smbios.h"
++>>>>>>> e09c4d5b1543 (dell-wmi: enable receiving WMI events on Dell Vostro V131)
  
  MODULE_AUTHOR("Matthew Garrett <mjg@redhat.com>");
  MODULE_AUTHOR("Pali Rohár <pali.rohar@gmail.com>");
@@@ -46,8 -47,8 +51,9 @@@ MODULE_LICENSE("GPL")
  #define DELL_EVENT_GUID "9DBB5994-A997-11DA-B012-B622A1EF5492"
  #define DELL_DESCRIPTOR_GUID "8D9DDCBC-A997-11DA-B012-B622A1EF5492"
  
 +static int acpi_video;
  static u32 dell_wmi_interface_version;
+ static bool wmi_requires_smbios_request;
  
  MODULE_ALIAS("wmi:"DELL_EVENT_GUID);
  MODULE_ALIAS("wmi:"DELL_DESCRIPTOR_GUID);
* Unmerged path drivers/platform/x86/Kconfig
* Unmerged path drivers/platform/x86/dell-wmi.c
