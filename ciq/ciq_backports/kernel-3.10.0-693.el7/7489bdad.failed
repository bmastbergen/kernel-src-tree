r8152: check rx after napi is enabled

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
commit-author hayeswang <hayeswang@realtek.com>
commit 7489bdadb7d17d3c81e39b85688500f700beb790
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/7489bdad.failed

Schedule the napi after napi_enable() for rx, if it is necessary.

If the rx is completed when napi is disabled, the sheduling of napi
would be lost. Then, no one handles the rx packet until next napi
is scheduled.

	Signed-off-by: Hayes Wang <hayeswang@realtek.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 7489bdadb7d17d3c81e39b85688500f700beb790)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/usb/r8152.c
diff --cc drivers/net/usb/r8152.c
index 190093914795,ad42295356dd..000000000000
--- a/drivers/net/usb/r8152.c
+++ b/drivers/net/usb/r8152.c
@@@ -32,7 -32,7 +32,11 @@@
  #define NETNEXT_VERSION		"08"
  
  /* Information for net */
++<<<<<<< HEAD
 +#define NET_VERSION		"4"
++=======
+ #define NET_VERSION		"8"
++>>>>>>> 7489bdadb7d1 (r8152: check rx after napi is enabled)
  
  #define DRIVER_VERSION		"v1." NETNEXT_VERSION "." NET_VERSION
  #define DRIVER_AUTHOR "Realtek linux nic maintainers <nic_swsd@realtek.com>"
@@@ -3615,6 -3701,10 +3622,13 @@@ static int rtl8152_resume(struct usb_in
  			if (netif_carrier_ok(tp->netdev))
  				rtl_start_rx(tp);
  			napi_enable(&tp->napi);
++<<<<<<< HEAD
++=======
+ 			clear_bit(SELECTIVE_SUSPEND, &tp->flags);
+ 			smp_mb__after_atomic();
+ 			if (!list_empty(&tp->rx_done))
+ 				napi_schedule(&tp->napi);
++>>>>>>> 7489bdadb7d1 (r8152: check rx after napi is enabled)
  		} else {
  			tp->rtl_ops.up(tp);
  			netif_carrier_off(tp->netdev);
* Unmerged path drivers/net/usb/r8152.c
