bnxt_en: Perform function reset earlier during probe.

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
Rebuild_CHGLOG: - [netdrv] bnxt_en: Perform function reset earlier during probe (Jonathan Toppins) [1433476]
Rebuild_FUZZ: 99.05%
commit-author Michael Chan <michael.chan@broadcom.com>
commit 3c2217a675bac22afb149166e0de71809189850d
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/3c2217a6.failed

The firmware call to do function reset is done too late.  It is causing
the rings that have been reserved to be freed.  In NPAR mode, this bug
is causing us to run out of rings.

Fixes: 391be5c27364 ("bnxt_en: Implement new scheme to reserve tx rings.")
	Signed-off-by: Michael Chan <michael.chan@broadcom.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 3c2217a675bac22afb149166e0de71809189850d)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/broadcom/bnxt/bnxt.c
diff --cc drivers/net/ethernet/broadcom/bnxt/bnxt.c
index ce26e3089912,33293ac32779..000000000000
--- a/drivers/net/ethernet/broadcom/bnxt/bnxt.c
+++ b/drivers/net/ethernet/broadcom/bnxt/bnxt.c
@@@ -6962,8 -7442,12 +6962,12 @@@ static int bnxt_init_one(struct pci_de
  	mutex_init(&bp->hwrm_cmd_lock);
  	rc = bnxt_hwrm_ver_get(bp);
  	if (rc)
 -		goto init_err_pci_clean;
 +		goto init_err;
  
+ 	rc = bnxt_hwrm_func_reset(bp);
+ 	if (rc)
+ 		goto init_err_pci_clean;
+ 
  	bnxt_hwrm_fw_set_time(bp);
  
  	dev->hw_features = NETIF_F_IP_CSUM | NETIF_F_IPV6_CSUM | NETIF_F_SG |
@@@ -7063,7 -7556,11 +7067,15 @@@
  
  	rc = bnxt_probe_phy(bp);
  	if (rc)
++<<<<<<< HEAD
 +		goto init_err;
++=======
+ 		goto init_err_pci_clean;
+ 
+ 	rc = bnxt_init_int_mode(bp);
+ 	if (rc)
+ 		goto init_err_pci_clean;
++>>>>>>> 3c2217a675ba (bnxt_en: Perform function reset earlier during probe.)
  
  	rc = register_netdev(dev);
  	if (rc)
* Unmerged path drivers/net/ethernet/broadcom/bnxt/bnxt.c
