virtio-balloon: use actual number of stats for stats queue buffers

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
commit-author Ladi Prosek <lprosek@redhat.com>
commit 9646b26e85896ef0256e66649f7937f774dc18a6
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/9646b26e.failed

The virtio balloon driver contained a not-so-obvious invariant that
update_balloon_stats has to update exactly VIRTIO_BALLOON_S_NR counters
in order to send valid stats to the host. This commit fixes it by having
update_balloon_stats return the actual number of counters, and its
callers use it when pushing buffers to the stats virtqueue.

Note that it is still out of spec to change the number of counters
at run-time. "Driver MUST supply the same subset of statistics in all
buffers submitted to the statsq."

	Suggested-by: Arnd Bergmann <arnd@arndb.de>
	Signed-off-by: Ladi Prosek <lprosek@redhat.com>
	Signed-off-by: Michael S. Tsirkin <mst@redhat.com>
(cherry picked from commit 9646b26e85896ef0256e66649f7937f774dc18a6)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/virtio/virtio_balloon.c
diff --cc drivers/virtio/virtio_balloon.c
index 1d5662631a53,d9544db231ef..000000000000
--- a/drivers/virtio/virtio_balloon.c
+++ b/drivers/virtio/virtio_balloon.c
@@@ -276,10 -293,9 +278,14 @@@ static void stats_handle_request(struc
  {
  	struct virtqueue *vq;
  	struct scatterlist sg;
- 	unsigned int len;
+ 	unsigned int len, num_stats;
  
++<<<<<<< HEAD
 +	vb->need_stats_update = 0;
 +	update_balloon_stats(vb);
++=======
+ 	num_stats = update_balloon_stats(vb);
++>>>>>>> 9646b26e8589 (virtio-balloon: use actual number of stats for stats queue buffers)
  
  	vq = vb->stats_vq;
  	if (!virtqueue_get_buf(vq, &len))
* Unmerged path drivers/virtio/virtio_balloon.c
