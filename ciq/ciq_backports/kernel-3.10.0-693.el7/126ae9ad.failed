crypto: ccp - Base AXI DMA cache settings on device tree

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
Rebuild_CHGLOG: - [crypto] ccp - Base AXI DMA cache settings on device tree (Suravee Suthikulpanit) [1390820]
Rebuild_FUZZ: 92.31%
commit-author Tom Lendacky <thomas.lendacky@amd.com>
commit 126ae9adc1ec8d9006542f1a5e474b0183845e21
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/126ae9ad.failed

The default cache operations for ARM64 were changed during 3.15.
To use coherent operations a "dma-coherent" device tree property
is required.  If that property is not present in the device tree
node then the non-coherent operations are assigned for the device.

Add support to the ccp driver to assign the AXI DMA cache settings
based on whether the "dma-coherent" property is present in the device
node.  If present, use settings that work with the caches.  If not
present, use settings that do not look at the caches.

	Signed-off-by: Tom Lendacky <thomas.lendacky@amd.com>
	Signed-off-by: Herbert Xu <herbert@gondor.apana.org.au>
(cherry picked from commit 126ae9adc1ec8d9006542f1a5e474b0183845e21)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	Documentation/devicetree/bindings/crypto/amd-ccp.txt
#	drivers/crypto/ccp/Kconfig
#	drivers/crypto/ccp/ccp-dev.c
#	drivers/crypto/ccp/ccp-dev.h
#	drivers/crypto/ccp/ccp-platform.c
diff --cc drivers/crypto/ccp/ccp-dev.c
index 53a03a9289ab,a7d110652a74..000000000000
--- a/drivers/crypto/ccp/ccp-dev.c
+++ b/drivers/crypto/ccp/ccp-dev.c
@@@ -360,6 -362,12 +360,15 @@@ int ccp_init(struct ccp_device *ccp
  		/* Build queue interrupt mask (two interrupts per queue) */
  		qim |= cmd_q->int_ok | cmd_q->int_err;
  
++<<<<<<< HEAD
++=======
+ #ifdef CONFIG_ARM64
+ 		/* For arm64 set the recommended queue cache settings */
+ 		iowrite32(ccp->axcache, ccp->io_regs + CMD_Q_CACHE_BASE +
+ 			  (CMD_Q_CACHE_INC * i));
+ #endif
+ 
++>>>>>>> 126ae9adc1ec (crypto: ccp - Base AXI DMA cache settings on device tree)
  		dev_dbg(dev, "queue #%u available\n", i);
  	}
  	if (ccp->cmd_q_count == 0) {
diff --cc drivers/crypto/ccp/ccp-dev.h
index 72bf1536b653,62ff35a6b9ec..000000000000
--- a/drivers/crypto/ccp/ccp-dev.h
+++ b/drivers/crypto/ccp/ccp-dev.h
@@@ -30,6 -30,9 +30,12 @@@
  
  #define TRNG_RETRIES			10
  
++<<<<<<< HEAD
++=======
+ #define CACHE_NONE			0x00
+ #define CACHE_WB_NO_ALLOC		0xb7
+ 
++>>>>>>> 126ae9adc1ec (crypto: ccp - Base AXI DMA cache settings on device tree)
  
  /****** Register Mappings ******/
  #define Q_MASK_REG			0x000
* Unmerged path Documentation/devicetree/bindings/crypto/amd-ccp.txt
* Unmerged path drivers/crypto/ccp/Kconfig
* Unmerged path drivers/crypto/ccp/ccp-platform.c
* Unmerged path Documentation/devicetree/bindings/crypto/amd-ccp.txt
* Unmerged path drivers/crypto/ccp/Kconfig
* Unmerged path drivers/crypto/ccp/ccp-dev.c
* Unmerged path drivers/crypto/ccp/ccp-dev.h
* Unmerged path drivers/crypto/ccp/ccp-platform.c
