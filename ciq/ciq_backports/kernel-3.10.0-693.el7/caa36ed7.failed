perf trace: Only auto set call-graph to "dwarf" when syscalls are being traced

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
commit-author Arnaldo Carvalho de Melo <acme@redhat.com>
commit caa36ed7ba82caa9f685dd04aa10d0bf87ea8b6a
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/caa36ed7.failed

When --min-stack or --max-stack is passwd but --no-syscalls is also in
effect, there is no point in automatically setting '--call-graph dwarf'.

	Cc: Adrian Hunter <adrian.hunter@intel.com>
	Cc: David Ahern <dsahern@gmail.com>
	Cc: Jiri Olsa <jolsa@kernel.org>
	Cc: Milian Wolff <milian.wolff@kdab.com>
	Cc: Namhyung Kim <namhyung@kernel.org>
	Cc: Wang Nan <wangnan0@huawei.com>
Link: http://lkml.kernel.org/n/tip-pq922i7h9wef0pho1dqpttvn@git.kernel.org
	Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>
(cherry picked from commit caa36ed7ba82caa9f685dd04aa10d0bf87ea8b6a)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	tools/perf/builtin-trace.c
diff --cc tools/perf/builtin-trace.c
index 64c465a8364f,487c10401d46..000000000000
--- a/tools/perf/builtin-trace.c
+++ b/tools/perf/builtin-trace.c
@@@ -2773,6 -2901,26 +2773,29 @@@ int cmd_trace(int argc, const char **ar
  		trace.opts.sample_time = true;
  	}
  
++<<<<<<< HEAD
++=======
+ 	if (trace.opts.mmap_pages == UINT_MAX)
+ 		mmap_pages_user_set = false;
+ 
+ 	if (trace.max_stack == UINT_MAX) {
+ 		trace.max_stack = input_name ? PERF_MAX_STACK_DEPTH : sysctl_perf_event_max_stack;
+ 		max_stack_user_set = false;
+ 	}
+ 
+ #ifdef HAVE_DWARF_UNWIND_SUPPORT
+ 	if ((trace.min_stack || max_stack_user_set) && !callchain_param.enabled && trace.trace_syscalls)
+ 		record_opts__parse_callchain(&trace.opts, &callchain_param, "dwarf", false);
+ #endif
+ 
+ 	if (callchain_param.enabled) {
+ 		if (!mmap_pages_user_set && geteuid() == 0)
+ 			trace.opts.mmap_pages = perf_event_mlock_kb_in_pages() * 4;
+ 
+ 		symbol_conf.use_callchain = true;
+ 	}
+ 
++>>>>>>> caa36ed7ba82 (perf trace: Only auto set call-graph to "dwarf" when syscalls are being traced)
  	if (trace.evlist->nr_entries > 0)
  		evlist__set_evsel_handler(trace.evlist, trace__event_handler);
  
* Unmerged path tools/perf/builtin-trace.c
