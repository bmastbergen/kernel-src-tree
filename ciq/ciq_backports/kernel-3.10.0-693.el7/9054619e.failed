powerpc/pseries: Add pseries hotplug workqueue

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
Rebuild_CHGLOG: - [powerpc] pseries: Add pseries hotplug workqueue (Thomas Huth) [1323417]
Rebuild_FUZZ: 90.48%
commit-author John Allen <jallen@linux.vnet.ibm.com>
commit 9054619ef54a3a832863ae25d15ac410ae3df146
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/9054619e.failed

In support of PAPR changes to add a new hotplug interrupt, introduce a
hotplug workqueue to avoid processing hotplug events in interrupt context.
We will also take advantage of the queue on PowerVM to ensure hotplug
events initiated from different sources (HMC and PRRN events) are handled
and serialized properly.

	Signed-off-by: John Allen <jallen@linux.vnet.ibm.com>
	Reviewed-by: Nathan Fontenot <nfont@linux.vnet.ibm.com>
	Signed-off-by: Michael Ellerman <mpe@ellerman.id.au>
(cherry picked from commit 9054619ef54a3a832863ae25d15ac410ae3df146)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/powerpc/platforms/pseries/dlpar.c
diff --cc arch/powerpc/platforms/pseries/dlpar.c
index eb48c7790834,66a77d7a7e4c..000000000000
--- a/arch/powerpc/platforms/pseries/dlpar.c
+++ b/arch/powerpc/platforms/pseries/dlpar.c
@@@ -679,16 -500,9 +729,22 @@@ static CLASS_ATTR(dlpar, S_IWUSR, NULL
  
  static int __init pseries_dlpar_init(void)
  {
++<<<<<<< HEAD
 +	int rc;
 +
 +#ifdef CONFIG_ARCH_CPU_PROBE_RELEASE
 +	ppc_md.cpu_probe = dlpar_cpu_probe;
 +	ppc_md.cpu_release = dlpar_cpu_release;
 +#endif /* CONFIG_ARCH_CPU_PROBE_RELEASE */
 +
 +	rc = sysfs_create_file(kernel_kobj, &class_attr_dlpar.attr);
 +
 +	return rc;
++=======
+ 	pseries_hp_wq = alloc_workqueue("pseries hotplug workqueue",
+ 					WQ_UNBOUND, 1);
+ 	return sysfs_create_file(kernel_kobj, &class_attr_dlpar.attr);
++>>>>>>> 9054619ef54a (powerpc/pseries: Add pseries hotplug workqueue)
  }
  machine_device_initcall(pseries, pseries_dlpar_init);
  
* Unmerged path arch/powerpc/platforms/pseries/dlpar.c
