ext4: release bh in make_indexed_dir

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
commit-author gmail <yngsion@gmail.com>
commit e81d44778d1d57bbaef9e24c4eac7c8a7a401d40
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/e81d4477.failed

The commit 6050d47adcad: "ext4: bail out from make_indexed_dir() on
first error" could end up leaking bh2 in the error path.

[ Also avoid renaming bh2 to bh, which just confuses things --tytso ]

	Cc: stable@vger.kernel.org
	Signed-off-by: yangsheng <yngsion@gmail.com>
	Signed-off-by: Theodore Ts'o <tytso@mit.edu>
(cherry picked from commit e81d44778d1d57bbaef9e24c4eac7c8a7a401d40)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	fs/ext4/namei.c
diff --cc fs/ext4/namei.c
index 0738842d53b3,c344b819cffa..000000000000
--- a/fs/ext4/namei.c
+++ b/fs/ext4/namei.c
@@@ -1857,15 -2052,13 +1856,24 @@@ static int make_indexed_dir(handle_t *h
  	if (retval)
  		goto out_frames;	
  
++<<<<<<< HEAD
 +	de = do_split(handle,dir, &bh, frame, &hinfo, &retval);
 +	if (!de) {
++=======
+ 	de = do_split(handle,dir, &bh2, frame, &fname->hinfo);
+ 	if (IS_ERR(de)) {
+ 		retval = PTR_ERR(de);
++>>>>>>> e81d44778d1d (ext4: release bh in make_indexed_dir)
  		goto out_frames;
  	}
- 	dx_release(frames);
  
++<<<<<<< HEAD
 +	retval = add_dirent_to_buf(handle, dentry, inode, de, bh);
 +	brelse(bh);
 +	return retval;
++=======
+ 	retval = add_dirent_to_buf(handle, fname, dir, inode, de, bh2);
++>>>>>>> e81d44778d1d (ext4: release bh in make_indexed_dir)
  out_frames:
  	/*
  	 * Even if the block split failed, we have to properly write
* Unmerged path fs/ext4/namei.c
