bridge: Allow set bridge ageing time when switchdev disabled

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
commit-author Haishuang Yan <yanhaishuang@cmss.chinamobile.com>
commit 5e263f712691615fb802f06c98d7638c378f5d11
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/5e263f71.failed

When NET_SWITCHDEV=n, switchdev_port_attr_set will return -EOPNOTSUPP,
we should ignore this error code and continue to set the ageing time.

Fixes: c62987bbd8a1 ("bridge: push bridge setting ageing_time down to switchdev")
	Signed-off-by: Haishuang Yan <yanhaishuang@cmss.chinamobile.com>
	Acked-by: Ido Schimmel <idosch@mellanox.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 5e263f712691615fb802f06c98d7638c378f5d11)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/bridge/br_stp.c
diff --cc net/bridge/br_stp.c
index 48a6519f8bc7,9cb7044d0801..000000000000
--- a/net/bridge/br_stp.c
+++ b/net/bridge/br_stp.c
@@@ -550,6 -562,35 +550,38 @@@ int br_set_max_age(struct net_bridge *b
  
  }
  
++<<<<<<< HEAD
++=======
+ /* Set time interval that dynamic forwarding entries live
+  * For pure software bridge, allow values outside the 802.1
+  * standard specification for special cases:
+  *  0 - entry never ages (all permanant)
+  *  1 - entry disappears (no persistance)
+  *
+  * Offloaded switch entries maybe more restrictive
+  */
+ int br_set_ageing_time(struct net_bridge *br, u32 ageing_time)
+ {
+ 	struct switchdev_attr attr = {
+ 		.orig_dev = br->dev,
+ 		.id = SWITCHDEV_ATTR_ID_BRIDGE_AGEING_TIME,
+ 		.flags = SWITCHDEV_F_SKIP_EOPNOTSUPP,
+ 		.u.ageing_time = ageing_time,
+ 	};
+ 	unsigned long t = clock_t_to_jiffies(ageing_time);
+ 	int err;
+ 
+ 	err = switchdev_port_attr_set(br->dev, &attr);
+ 	if (err && err != -EOPNOTSUPP)
+ 		return err;
+ 
+ 	br->ageing_time = t;
+ 	mod_timer(&br->gc_timer, jiffies);
+ 
+ 	return 0;
+ }
+ 
++>>>>>>> 5e263f712691 (bridge: Allow set bridge ageing time when switchdev disabled)
  void __br_set_forward_delay(struct net_bridge *br, unsigned long t)
  {
  	br->bridge_forward_delay = t;
* Unmerged path net/bridge/br_stp.c
