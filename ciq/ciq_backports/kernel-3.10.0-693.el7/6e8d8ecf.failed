crypto: algif_skcipher - Add key check exception for cipher_null

jira LE-1907
cve CVE-2015-8970
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
Rebuild_CHGLOG: - [crypto] algif_skcipher - Add key check exception for cipher_null ("Bruno E. O. Meneguele") [1386234] {CVE-2015-8970}
Rebuild_FUZZ: 93.33%
commit-author Herbert Xu <herbert@gondor.apana.org.au>
commit 6e8d8ecf438792ecf7a3207488fb4eebc4edb040
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/6e8d8ecf.failed

This patch adds an exception to the key check so that cipher_null
users may continue to use algif_skcipher without setting a key.

	Cc: stable@vger.kernel.org
	Signed-off-by: Herbert Xu <herbert@gondor.apana.org.au>
(cherry picked from commit 6e8d8ecf438792ecf7a3207488fb4eebc4edb040)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	crypto/algif_skcipher.c
diff --cc crypto/algif_skcipher.c
index 83187f497c7c,4a5bdb69fd49..000000000000
--- a/crypto/algif_skcipher.c
+++ b/crypto/algif_skcipher.c
@@@ -609,6 -974,30 +609,33 @@@ static int skcipher_accept_parent(void 
  	return 0;
  }
  
++<<<<<<< HEAD
++=======
+ static int skcipher_accept_parent(void *private, struct sock *sk)
+ {
+ 	struct skcipher_tfm *tfm = private;
+ 
+ 	if (!tfm->has_key && crypto_skcipher_has_setkey(tfm->skcipher))
+ 		return -ENOKEY;
+ 
+ 	return skcipher_accept_parent_common(private, sk);
+ }
+ 
+ static int skcipher_accept_parent_nokey(void *private, struct sock *sk)
+ {
+ 	int err;
+ 
+ 	err = skcipher_accept_parent_common(private, sk);
+ 	if (err)
+ 		goto out;
+ 
+ 	sk->sk_destruct = skcipher_sock_destruct_nokey;
+ 
+ out:
+ 	return err;
+ }
+ 
++>>>>>>> 6e8d8ecf4387 (crypto: algif_skcipher - Add key check exception for cipher_null)
  static const struct af_alg_type algif_type_skcipher = {
  	.bind		=	skcipher_bind,
  	.release	=	skcipher_release,
* Unmerged path crypto/algif_skcipher.c
