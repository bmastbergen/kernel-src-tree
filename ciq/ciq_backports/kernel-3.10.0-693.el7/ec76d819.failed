KVM: Export kvm module parameter variables

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
commit-author Suraj Jitindar Singh <sjitindarsingh@gmail.com>
commit ec76d819d27040e418801d1a57bd3bdfde51019e
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/ec76d819.failed

The kvm module has the parameters halt_poll_ns, halt_poll_ns_grow, and
halt_poll_ns_shrink. Halt polling was recently added to the powerpc kvm-hv
module and these parameters were essentially duplicated for that. There is
no benefit to this duplication and it can lead to confusion when trying to
tune halt polling.

Thus move the definition of these variables to kvm_host.h and export them.
This will allow the kvm-hv module to use the same module parameters by
accessing these variables, which will be implemented in the next patch,
meaning that they will no longer be duplicated.

	Signed-off-by: Suraj Jitindar Singh <sjitindarsingh@gmail.com>
	Signed-off-by: Paul Mackerras <paulus@ozlabs.org>
(cherry picked from commit ec76d819d27040e418801d1a57bd3bdfde51019e)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	virt/kvm/kvm_main.c
diff --cc virt/kvm/kvm_main.c
index 5a7921b2430b,9831cdf35436..000000000000
--- a/virt/kvm/kvm_main.c
+++ b/virt/kvm/kvm_main.c
@@@ -69,17 -69,20 +69,25 @@@
  MODULE_AUTHOR("Qumranet");
  MODULE_LICENSE("GPL");
  
++<<<<<<< HEAD
 +/* halt polling only reduces halt latency by 5-7 us, 400us is enough */
 +static unsigned int halt_poll_ns = 400000;
++=======
+ /* Architectures should define their poll value according to the halt latency */
+ unsigned int halt_poll_ns = KVM_HALT_POLL_NS_DEFAULT;
++>>>>>>> ec76d819d270 (KVM: Export kvm module parameter variables)
  module_param(halt_poll_ns, uint, S_IRUGO | S_IWUSR);
+ EXPORT_SYMBOL_GPL(halt_poll_ns);
  
  /* Default doubles per-vcpu halt_poll_ns. */
- static unsigned int halt_poll_ns_grow = 2;
+ unsigned int halt_poll_ns_grow = 2;
  module_param(halt_poll_ns_grow, uint, S_IRUGO | S_IWUSR);
+ EXPORT_SYMBOL_GPL(halt_poll_ns_grow);
  
  /* Default resets per-vcpu halt_poll_ns . */
- static unsigned int halt_poll_ns_shrink;
+ unsigned int halt_poll_ns_shrink;
  module_param(halt_poll_ns_shrink, uint, S_IRUGO | S_IWUSR);
+ EXPORT_SYMBOL_GPL(halt_poll_ns_shrink);
  
  /*
   * Ordering of locks:
diff --git a/include/linux/kvm_host.h b/include/linux/kvm_host.h
index b42a4bf67232..aea23e6bacbe 100644
--- a/include/linux/kvm_host.h
+++ b/include/linux/kvm_host.h
@@ -1095,6 +1095,10 @@ static inline bool kvm_check_request(int req, struct kvm_vcpu *vcpu)
 
 extern bool kvm_rebooting;
 
+extern unsigned int halt_poll_ns;
+extern unsigned int halt_poll_ns_grow;
+extern unsigned int halt_poll_ns_shrink;
+
 struct kvm_device {
 	struct kvm_device_ops *ops;
 	struct kvm *kvm;
* Unmerged path virt/kvm/kvm_main.c
