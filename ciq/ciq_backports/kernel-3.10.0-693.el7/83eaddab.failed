ipv6/dccp: do not inherit ipv6_mc_list from parent

jira LE-1907
cve CVE-2017-9077
cve CVE-2017-9076
cve CVE-2017-9075
cve CVE-2017-8890
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
commit-author WANG Cong <xiyou.wangcong@gmail.com>
commit 83eaddab4378db256d00d295bda6ca997cd13a52
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/83eaddab.failed

Like commit 657831ffc38e ("dccp/tcp: do not inherit mc_list from parent")
we should clear ipv6_mc_list etc. for IPv6 sockets too.

	Cc: Eric Dumazet <edumazet@google.com>
	Signed-off-by: Cong Wang <xiyou.wangcong@gmail.com>
	Acked-by: Eric Dumazet <edumazet@google.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 83eaddab4378db256d00d295bda6ca997cd13a52)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/dccp/ipv6.c
diff --cc net/dccp/ipv6.c
index 9d72670f8c78,b6bbb71e713e..000000000000
--- a/net/dccp/ipv6.c
+++ b/net/dccp/ipv6.c
@@@ -563,15 -493,10 +566,21 @@@ static struct sock *dccp_v6_request_rec
  	/* Clone RX bits */
  	newnp->rxopt.all = np->rxopt.all;
  
++<<<<<<< HEAD
 +	/* Clone pktoptions received with SYN */
++=======
+ 	newnp->ipv6_mc_list = NULL;
+ 	newnp->ipv6_ac_list = NULL;
+ 	newnp->ipv6_fl_list = NULL;
++>>>>>>> 83eaddab4378 (ipv6/dccp: do not inherit ipv6_mc_list from parent)
  	newnp->pktoptions = NULL;
 +	if (ireq->pktopts != NULL) {
 +		newnp->pktoptions = skb_clone(ireq->pktopts, GFP_ATOMIC);
 +		consume_skb(ireq->pktopts);
 +		ireq->pktopts = NULL;
 +		if (newnp->pktoptions)
 +			skb_set_owner_r(newnp->pktoptions, newsk);
 +	}
  	newnp->opt	  = NULL;
  	newnp->mcast_oif  = inet6_iif(skb);
  	newnp->mcast_hops = ipv6_hdr(skb)->hop_limit;
* Unmerged path net/dccp/ipv6.c
diff --git a/net/ipv6/tcp_ipv6.c b/net/ipv6/tcp_ipv6.c
index 57261a87d03d..b1bfc823f3cb 100644
--- a/net/ipv6/tcp_ipv6.c
+++ b/net/ipv6/tcp_ipv6.c
@@ -1089,6 +1089,7 @@ static struct sock *tcp_v6_syn_recv_sock(struct sock *sk, struct sk_buff *skb,
 		newtp->af_specific = &tcp_sock_ipv6_mapped_specific;
 #endif
 
+		newnp->ipv6_mc_list = NULL;
 		newnp->ipv6_ac_list = NULL;
 		newnp->ipv6_fl_list = NULL;
 		newnp->pktoptions  = NULL;
@@ -1158,6 +1159,7 @@ static struct sock *tcp_v6_syn_recv_sock(struct sock *sk, struct sk_buff *skb,
 	   First: no IPv4 options.
 	 */
 	newinet->inet_opt = NULL;
+	newnp->ipv6_mc_list = NULL;
 	newnp->ipv6_ac_list = NULL;
 	newnp->ipv6_fl_list = NULL;
 
