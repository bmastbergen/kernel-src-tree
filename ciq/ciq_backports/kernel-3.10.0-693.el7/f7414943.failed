mmc: fix mmc mode selection for HS-DDR and higher

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
Rebuild_CHGLOG: - [mmc] fix mmc mode selection for HS-DDR and higher (Don Zickus) [1430497]
Rebuild_FUZZ: 94.62%
commit-author Chen-Yu Tsai <wens@csie.org>
commit f741494363c6c90e6744117d2771bbdf0fb3c455
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/f7414943.failed

When IS_ERR_VALUE was removed from the mmc core code, it was replaced
with a simple not-zero check. This does not work, as the value checked
is the return value for mmc_select_bus_width, which returns the set
bit width on success. This made eMMC modes higher than HS-DDR unusable.

Fix this by checking for a positive return value instead.

Fixes: 287980e49ffc ("remove lots of IS_ERR_VALUE abuses")
	Cc: Arnd Bergmann <arnd@arndb.de>
	Signed-off-by: Chen-Yu Tsai <wens@csie.org>
	Acked-by: Hans de Goede <hdegoede@redhat.com>
	Reviewed-by: Krzysztof Kozlowski <k.kozlowski@samsung.com>
	Acked-by: Jaehoon Chung <jh80.chung@samsung.com>
	Reviewed-by: Shawn Lin <shawn.lin@rock-chips.com>
	Tested-by: Marcel Ziswiler <marcel.ziswiler@toradex.com>
	Tested-by: Bjorn Andersson <bjorn.andersson@linaro.org>
	Signed-off-by: Ulf Hansson <ulf.hansson@linaro.org>
(cherry picked from commit f741494363c6c90e6744117d2771bbdf0fb3c455)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/mmc/core/mmc.c
diff --cc drivers/mmc/core/mmc.c
index b81b08f81325,5d438ad3ee32..000000000000
--- a/drivers/mmc/core/mmc.c
+++ b/drivers/mmc/core/mmc.c
@@@ -1276,7 -1276,7 +1276,11 @@@ static int mmc_select_hs200(struct mmc_
  	 * switch to HS200 mode if bus width is set successfully.
  	 */
  	err = mmc_select_bus_width(card);
++<<<<<<< HEAD
 +	if (!IS_ERR_VALUE(err)) {
++=======
+ 	if (err >= 0) {
++>>>>>>> f741494363c6 (mmc: fix mmc mode selection for HS-DDR and higher)
  		val = EXT_CSD_TIMING_HS200 |
  		      card->drive_strength << EXT_CSD_DRV_STR_SHIFT;
  		err = __mmc_switch(card, EXT_CSD_CMD_SET_NORMAL,
@@@ -1583,7 -1583,7 +1587,11 @@@ static int mmc_init_card(struct mmc_hos
  	} else if (mmc_card_hs(card)) {
  		/* Select the desired bus width optionally */
  		err = mmc_select_bus_width(card);
++<<<<<<< HEAD
 +		if (!IS_ERR_VALUE(err)) {
++=======
+ 		if (err >= 0) {
++>>>>>>> f741494363c6 (mmc: fix mmc mode selection for HS-DDR and higher)
  			err = mmc_select_hs_ddr(card);
  			if (err)
  				goto free_card;
* Unmerged path drivers/mmc/core/mmc.c
