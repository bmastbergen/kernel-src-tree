net/mlx5: E-Switch, Add offloads table

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
Rebuild_CHGLOG: - [netdrv] mlx5: E-Switch, Add offloads table (Don Dutile) [1383792 1417284]
Rebuild_FUZZ: 94.44%
commit-author Or Gerlitz <ogerlitz@mellanox.com>
commit c116c6eec6f72aac82ff4228ab1d277f3f9a2460
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/c116c6ee.failed

Belongs to the NIC offloads name-space, and to be used as part of the
SRIOV offloads logic to steer packets that hit the e-switch miss rule
to the TIR of the relevant VF representor.

	Signed-off-by: Or Gerlitz <ogerlitz@mellanox.com>
	Signed-off-by: Saeed Mahameed <saeedm@mellanox.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit c116c6eec6f72aac82ff4228ab1d277f3f9a2460)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/mellanox/mlx5/core/eswitch.h
#	drivers/net/ethernet/mellanox/mlx5/core/eswitch_offloads.c
diff --cc drivers/net/ethernet/mellanox/mlx5/core/eswitch.h
index 6f9da7b7d506,32db37ab867f..000000000000
--- a/drivers/net/ethernet/mellanox/mlx5/core/eswitch.h
+++ b/drivers/net/ethernet/mellanox/mlx5/core/eswitch.h
@@@ -130,11 -134,31 +130,15 @@@ struct mlx5_l2_table 
  
  struct mlx5_eswitch_fdb {
  	void *fdb;
 -	union {
 -		struct legacy_fdb {
 -			struct mlx5_flow_group *addr_grp;
 -			struct mlx5_flow_group *allmulti_grp;
 -			struct mlx5_flow_group *promisc_grp;
 -		} legacy;
 -
 -		struct offloads_fdb {
 -			struct mlx5_flow_group *send_to_vport_grp;
 -			struct mlx5_flow_group *miss_grp;
 -			struct mlx5_flow_rule  *miss_rule;
 -		} offloads;
 -	};
 -};
 -
 -enum {
 -	SRIOV_NONE,
 -	SRIOV_LEGACY,
 -	SRIOV_OFFLOADS
 +	struct mlx5_flow_group *addr_grp;
 +	struct mlx5_flow_group *allmulti_grp;
 +	struct mlx5_flow_group *promisc_grp;
  };
  
+ struct mlx5_esw_offload {
+ 	struct mlx5_flow_table *ft_offloads;
+ };
+ 
  struct mlx5_eswitch {
  	struct mlx5_core_dev    *dev;
  	struct mlx5_l2_table    l2_table;
@@@ -148,6 -172,9 +152,12 @@@
  	 * and async SRIOV admin state changes
  	 */
  	struct mutex            state_lock;
++<<<<<<< HEAD
++=======
+ 	struct esw_mc_addr      *mc_promisc;
+ 	struct mlx5_esw_offload offloads;
+ 	int                     mode;
++>>>>>>> c116c6eec6f7 (net/mlx5: E-Switch, Add offloads table)
  };
  
  /* E-Switch API */
* Unmerged path drivers/net/ethernet/mellanox/mlx5/core/eswitch_offloads.c
* Unmerged path drivers/net/ethernet/mellanox/mlx5/core/eswitch.h
* Unmerged path drivers/net/ethernet/mellanox/mlx5/core/eswitch_offloads.c
