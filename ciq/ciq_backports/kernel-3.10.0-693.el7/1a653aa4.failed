ASoC: core: replace aux_comp_list to component_dev_list

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
Rebuild_CHGLOG: - [sound] alsa: asoc: core: replace aux_comp_list to component_dev_list (Jaroslav Kysela) [1399503]
Rebuild_FUZZ: 94.83%
commit-author Kuninori Morimoto <kuninori.morimoto.gx@renesas.com>
commit 1a653aa44725668590b36bbe2d7fe4736a69f055
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/1a653aa4.failed

Now, Card has component_dev_list, we can replace aux_comp_list
to component_dev_list with new auxiliary flags

	Signed-off-by: Kuninori Morimoto <kuninori.morimoto.gx@renesas.com>
	Signed-off-by: Mark Brown <broonie@kernel.org>
(cherry picked from commit 1a653aa44725668590b36bbe2d7fe4736a69f055)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	include/sound/soc.h
diff --cc include/sound/soc.h
index ef25e86d51ee,0bd57b77d010..000000000000
--- a/include/sound/soc.h
+++ b/include/sound/soc.h
@@@ -796,9 -807,10 +796,14 @@@ struct snd_soc_component 
  
  	unsigned int ignore_pmdown_time:1; /* pmdown_time is ignored at stop */
  	unsigned int registered_as_component:1;
+ 	unsigned int auxiliary:1; /* for auxiliary component of the card */
  
  	struct list_head list;
++<<<<<<< HEAD
 +	struct list_head list_aux; /* for auxiliary component of the card */
++=======
+ 	struct list_head card_list;
++>>>>>>> 1a653aa44725 (ASoC: core: replace aux_comp_list to component_dev_list)
  
  	struct snd_soc_dai_driver *dai_drv;
  	int num_dai;
@@@ -1553,7 -1542,7 +1557,11 @@@ static inline void snd_soc_initialize_c
  	INIT_LIST_HEAD(&card->widgets);
  	INIT_LIST_HEAD(&card->paths);
  	INIT_LIST_HEAD(&card->dapm_list);
++<<<<<<< HEAD
 +	INIT_LIST_HEAD(&card->aux_comp_list);
++=======
+ 	INIT_LIST_HEAD(&card->component_dev_list);
++>>>>>>> 1a653aa44725 (ASoC: core: replace aux_comp_list to component_dev_list)
  }
  
  static inline bool snd_soc_volsw_is_stereo(struct soc_mixer_control *mc)
* Unmerged path include/sound/soc.h
diff --git a/sound/soc/soc-core.c b/sound/soc/soc-core.c
index d2e62b159610..58965bbcd812 100644
--- a/sound/soc/soc-core.c
+++ b/sound/soc/soc-core.c
@@ -1694,7 +1694,8 @@ static int soc_bind_aux_dev(struct snd_soc_card *card, int num)
 	}
 
 	component->init = aux_dev->init;
-	list_add(&component->list_aux, &card->aux_comp_list);
+	component->auxiliary = 1;
+
 	return 0;
 
 err_defer:
@@ -1710,7 +1711,10 @@ static int soc_probe_aux_devices(struct snd_soc_card *card)
 
 	for (order = SND_SOC_COMP_ORDER_FIRST; order <= SND_SOC_COMP_ORDER_LAST;
 		order++) {
-		list_for_each_entry(comp, &card->aux_comp_list, list_aux) {
+		list_for_each_entry(comp, &card->component_dev_list, card_list) {
+			if (!comp->auxiliary)
+				continue;
+
 			if (comp->driver->probe_order == order) {
 				ret = soc_probe_component(card,	comp);
 				if (ret < 0) {
@@ -1734,11 +1738,14 @@ static void soc_remove_aux_devices(struct snd_soc_card *card)
 	for (order = SND_SOC_COMP_ORDER_FIRST; order <= SND_SOC_COMP_ORDER_LAST;
 		order++) {
 		list_for_each_entry_safe(comp, _comp,
-			&card->aux_comp_list, list_aux) {
+			&card->component_dev_list, card_list) {
+
+			if (!comp->auxiliary)
+				continue;
+
 			if (comp->driver->remove_order == order) {
 				soc_remove_component(comp);
-				/* remove it from the card's aux_comp_list */
-				list_del(&comp->list_aux);
+				comp->auxiliary = 0;
 			}
 		}
 	}
