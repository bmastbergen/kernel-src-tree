ipv6: bump genid when the IFA_F_TENTATIVE flag is clear

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
commit-author Paolo Abeni <pabeni@redhat.com>
commit 764d3be6e415b40056834bfd29b994dc3f837606
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/764d3be6.failed

When an ipv6 address has the tentative flag set, it can't be
used as source for egress traffic, while the associated route,
if any, can be looked up and even stored into some dst_cache.

In the latter scenario, the source ipv6 address selected and
stored in the cache is most probably wrong (e.g. with
link-local scope) and the entity using the dst_cache will
experience lack of ipv6 connectivity until said cache is
cleared or invalidated.

Overall this may cause lack of connectivity over most IPv6 tunnels
(comprising geneve and vxlan), if the first egress packet reaches
the tunnel before the DaD is completed for the used ipv6
address.

This patch bumps a new genid after that the IFA_F_TENTATIVE flag
is cleared, so that dst_cache will be invalidated on
next lookup and ipv6 connectivity restored.

Fixes: 0c1d70af924b ("net: use dst_cache for vxlan device")
Fixes: 468dfffcd762 ("geneve: add dst caching support")
	Acked-by: Hannes Frederic Sowa <hannes@stressinduktion.org>
	Signed-off-by: Paolo Abeni <pabeni@redhat.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 764d3be6e415b40056834bfd29b994dc3f837606)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/ipv6/addrconf.c
diff --cc net/ipv6/addrconf.c
index b7d5ce608e64,4bc5ba3ae452..000000000000
--- a/net/ipv6/addrconf.c
+++ b/net/ipv6/addrconf.c
@@@ -3207,6 -3741,7 +3208,10 @@@ static void addrconf_dad_begin(struct i
  {
  	struct inet6_dev *idev = ifp->idev;
  	struct net_device *dev = idev->dev;
++<<<<<<< HEAD
++=======
+ 	bool bump_id, notify = false;
++>>>>>>> 764d3be6e415 (ipv6: bump genid when the IFA_F_TENTATIVE flag is clear)
  
  	addrconf_join_solict(dev, &ifp->addr);
  
* Unmerged path net/ipv6/addrconf.c
