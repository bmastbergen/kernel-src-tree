drm/nouveau: initial support (display-only) for GP107

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
Rebuild_CHGLOG: - [drm] nouveau: initial support (display-only) for GP107 (Rob Clark) [1422186]
Rebuild_FUZZ: 96.08%
commit-author Ben Skeggs <bskeggs@redhat.com>
commit da2ba564a6dcf46df4f828624ff55531ff11d5b0
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/da2ba564.failed

Forked from GP106 implementation.

Split out from commit enabling secboot/gr support so that it can be
added to earlier kernels.

	Cc: stable@vger.kernel.org	[4.10+]
	Signed-off-by: Ben Skeggs <bskeggs@redhat.com>
(cherry picked from commit da2ba564a6dcf46df4f828624ff55531ff11d5b0)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/gpu/drm/nouveau/nvkm/engine/device/base.c
diff --cc drivers/gpu/drm/nouveau/nvkm/engine/device/base.c
index 75b3eae62a66,3b86a7399567..000000000000
--- a/drivers/gpu/drm/nouveau/nvkm/engine/device/base.c
+++ b/drivers/gpu/drm/nouveau/nvkm/engine/device/base.c
@@@ -2101,6 -2150,156 +2101,159 @@@ nv12b_chipset = 
  	.sw = gf100_sw_new,
  };
  
++<<<<<<< HEAD
++=======
+ static const struct nvkm_device_chip
+ nv130_chipset = {
+ 	.name = "GP100",
+ 	.bar = gf100_bar_new,
+ 	.bios = nvkm_bios_new,
+ 	.bus = gf100_bus_new,
+ 	.devinit = gm200_devinit_new,
+ 	.fb = gp100_fb_new,
+ 	.fuse = gm107_fuse_new,
+ 	.gpio = gk104_gpio_new,
+ 	.i2c = gm200_i2c_new,
+ 	.ibus = gm200_ibus_new,
+ 	.imem = nv50_instmem_new,
+ 	.ltc = gp100_ltc_new,
+ 	.mc = gp100_mc_new,
+ 	.mmu = gf100_mmu_new,
+ 	.secboot = gm200_secboot_new,
+ 	.pci = gp100_pci_new,
+ 	.pmu = gp100_pmu_new,
+ 	.timer = gk20a_timer_new,
+ 	.top = gk104_top_new,
+ 	.ce[0] = gp100_ce_new,
+ 	.ce[1] = gp100_ce_new,
+ 	.ce[2] = gp100_ce_new,
+ 	.ce[3] = gp100_ce_new,
+ 	.ce[4] = gp100_ce_new,
+ 	.ce[5] = gp100_ce_new,
+ 	.dma = gf119_dma_new,
+ 	.disp = gp100_disp_new,
+ 	.fifo = gp100_fifo_new,
+ 	.gr = gp100_gr_new,
+ 	.sw = gf100_sw_new,
+ };
+ 
+ static const struct nvkm_device_chip
+ nv132_chipset = {
+ 	.name = "GP102",
+ 	.bar = gf100_bar_new,
+ 	.bios = nvkm_bios_new,
+ 	.bus = gf100_bus_new,
+ 	.devinit = gm200_devinit_new,
+ 	.fb = gp102_fb_new,
+ 	.fuse = gm107_fuse_new,
+ 	.gpio = gk104_gpio_new,
+ 	.i2c = gm200_i2c_new,
+ 	.ibus = gm200_ibus_new,
+ 	.imem = nv50_instmem_new,
+ 	.ltc = gp100_ltc_new,
+ 	.mc = gp100_mc_new,
+ 	.mmu = gf100_mmu_new,
+ 	.pci = gp100_pci_new,
+ 	.pmu = gp102_pmu_new,
+ 	.timer = gk20a_timer_new,
+ 	.top = gk104_top_new,
+ 	.ce[0] = gp102_ce_new,
+ 	.ce[1] = gp102_ce_new,
+ 	.ce[2] = gp102_ce_new,
+ 	.ce[3] = gp102_ce_new,
+ 	.disp = gp102_disp_new,
+ 	.dma = gf119_dma_new,
+ 	.fifo = gp100_fifo_new,
+ };
+ 
+ static const struct nvkm_device_chip
+ nv134_chipset = {
+ 	.name = "GP104",
+ 	.bar = gf100_bar_new,
+ 	.bios = nvkm_bios_new,
+ 	.bus = gf100_bus_new,
+ 	.devinit = gm200_devinit_new,
+ 	.fb = gp102_fb_new,
+ 	.fuse = gm107_fuse_new,
+ 	.gpio = gk104_gpio_new,
+ 	.i2c = gm200_i2c_new,
+ 	.ibus = gm200_ibus_new,
+ 	.imem = nv50_instmem_new,
+ 	.ltc = gp100_ltc_new,
+ 	.mc = gp100_mc_new,
+ 	.mmu = gf100_mmu_new,
+ 	.pci = gp100_pci_new,
+ 	.pmu = gp102_pmu_new,
+ 	.timer = gk20a_timer_new,
+ 	.top = gk104_top_new,
+ 	.ce[0] = gp102_ce_new,
+ 	.ce[1] = gp102_ce_new,
+ 	.ce[2] = gp102_ce_new,
+ 	.ce[3] = gp102_ce_new,
+ 	.disp = gp102_disp_new,
+ 	.dma = gf119_dma_new,
+ 	.fifo = gp100_fifo_new,
+ };
+ 
+ static const struct nvkm_device_chip
+ nv136_chipset = {
+ 	.name = "GP106",
+ 	.bar = gf100_bar_new,
+ 	.bios = nvkm_bios_new,
+ 	.bus = gf100_bus_new,
+ 	.devinit = gm200_devinit_new,
+ 	.fb = gp102_fb_new,
+ 	.fuse = gm107_fuse_new,
+ 	.gpio = gk104_gpio_new,
+ 	.i2c = gm200_i2c_new,
+ 	.ibus = gm200_ibus_new,
+ 	.imem = nv50_instmem_new,
+ 	.ltc = gp100_ltc_new,
+ 	.mc = gp100_mc_new,
+ 	.mmu = gf100_mmu_new,
+ 	.pci = gp100_pci_new,
+ 	.pmu = gp102_pmu_new,
+ 	.timer = gk20a_timer_new,
+ 	.top = gk104_top_new,
+ 	.ce[0] = gp102_ce_new,
+ 	.ce[1] = gp102_ce_new,
+ 	.ce[2] = gp102_ce_new,
+ 	.ce[3] = gp102_ce_new,
+ 	.disp = gp102_disp_new,
+ 	.dma = gf119_dma_new,
+ 	.fifo = gp100_fifo_new,
+ };
+ 
+ static const struct nvkm_device_chip
+ nv137_chipset = {
+ 	.name = "GP107",
+ 	.bar = gf100_bar_new,
+ 	.bios = nvkm_bios_new,
+ 	.bus = gf100_bus_new,
+ 	.devinit = gm200_devinit_new,
+ 	.fb = gp102_fb_new,
+ 	.fuse = gm107_fuse_new,
+ 	.gpio = gk104_gpio_new,
+ 	.i2c = gm200_i2c_new,
+ 	.ibus = gm200_ibus_new,
+ 	.imem = nv50_instmem_new,
+ 	.ltc = gp100_ltc_new,
+ 	.mc = gp100_mc_new,
+ 	.mmu = gf100_mmu_new,
+ 	.pci = gp100_pci_new,
+ 	.pmu = gp102_pmu_new,
+ 	.timer = gk20a_timer_new,
+ 	.top = gk104_top_new,
+ 	.ce[0] = gp102_ce_new,
+ 	.ce[1] = gp102_ce_new,
+ 	.ce[2] = gp102_ce_new,
+ 	.ce[3] = gp102_ce_new,
+ 	.disp = gp102_disp_new,
+ 	.dma = gf119_dma_new,
+ 	.fifo = gp100_fifo_new,
+ };
+ 
++>>>>>>> da2ba564a6dc (drm/nouveau: initial support (display-only) for GP107)
  static int
  nvkm_device_event_ctor(struct nvkm_object *object, void *data, u32 size,
  		       struct nvkm_notify *notify)
@@@ -2527,6 -2733,11 +2680,14 @@@ nvkm_device_ctor(const struct nvkm_devi
  		case 0x124: device->chip = &nv124_chipset; break;
  		case 0x126: device->chip = &nv126_chipset; break;
  		case 0x12b: device->chip = &nv12b_chipset; break;
++<<<<<<< HEAD
++=======
+ 		case 0x130: device->chip = &nv130_chipset; break;
+ 		case 0x132: device->chip = &nv132_chipset; break;
+ 		case 0x134: device->chip = &nv134_chipset; break;
+ 		case 0x136: device->chip = &nv136_chipset; break;
+ 		case 0x137: device->chip = &nv137_chipset; break;
++>>>>>>> da2ba564a6dc (drm/nouveau: initial support (display-only) for GP107)
  		default:
  			nvdev_error(device, "unknown chipset (%08x)\n", boot0);
  			goto done;
* Unmerged path drivers/gpu/drm/nouveau/nvkm/engine/device/base.c
