cxgb4: fix to bring link down after adapter crash

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
commit-author Rahul Lakkireddy <rahul.lakkireddy@chelsio.com>
commit b3fd82207e2723247aac478e8756451fe85b1ac2
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/b3fd8220.failed

Use PORT_REG for T4 and T5_PORT_REG for > T4 to write to correct
register to bring down link during shutdown after adapter crash.

	Signed-off-by: Rahul Lakkireddy <rahul.lakkireddy@chelsio.com>
	Signed-off-by: Ganesh Goudar <ganeshgr@chelsio.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit b3fd82207e2723247aac478e8756451fe85b1ac2)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/chelsio/cxgb4/t4_hw.c
diff --cc drivers/net/ethernet/chelsio/cxgb4/t4_hw.c
index 45569770ddd4,da1322da4925..000000000000
--- a/drivers/net/ethernet/chelsio/cxgb4/t4_hw.c
+++ b/drivers/net/ethernet/chelsio/cxgb4/t4_hw.c
@@@ -7591,6 -7670,38 +7591,41 @@@ int t4_prep_adapter(struct adapter *ada
  }
  
  /**
++<<<<<<< HEAD
++=======
+  *	t4_shutdown_adapter - shut down adapter, host & wire
+  *	@adapter: the adapter
+  *
+  *	Perform an emergency shutdown of the adapter and stop it from
+  *	continuing any further communication on the ports or DMA to the
+  *	host.  This is typically used when the adapter and/or firmware
+  *	have crashed and we want to prevent any further accidental
+  *	communication with the rest of the world.  This will also force
+  *	the port Link Status to go down -- if register writes work --
+  *	which should help our peers figure out that we're down.
+  */
+ int t4_shutdown_adapter(struct adapter *adapter)
+ {
+ 	int port;
+ 
+ 	t4_intr_disable(adapter);
+ 	t4_write_reg(adapter, DBG_GPIO_EN_A, 0);
+ 	for_each_port(adapter, port) {
+ 		u32 a_port_cfg = is_t4(adapter->params.chip) ?
+ 				       PORT_REG(port, XGMAC_PORT_CFG_A) :
+ 				       T5_PORT_REG(port, MAC_PORT_CFG_A);
+ 
+ 		t4_write_reg(adapter, a_port_cfg,
+ 			     t4_read_reg(adapter, a_port_cfg)
+ 			     & ~SIGNAL_DET_V(1));
+ 	}
+ 	t4_set_reg_field(adapter, SGE_CONTROL_A, GLOBALENABLE_F, 0);
+ 
+ 	return 0;
+ }
+ 
+ /**
++>>>>>>> b3fd82207e27 (cxgb4: fix to bring link down after adapter crash)
   *	t4_bar2_sge_qregs - return BAR2 SGE Queue register information
   *	@adapter: the adapter
   *	@qid: the Queue ID
* Unmerged path drivers/net/ethernet/chelsio/cxgb4/t4_hw.c
