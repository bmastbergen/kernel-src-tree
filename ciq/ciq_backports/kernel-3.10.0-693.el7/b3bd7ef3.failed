HID: wacom: peport In Range event according to the spec

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
Rebuild_CHGLOG: - [hid] wacom: peport In Range event according to the spec (Aristeu Rozanski) [1346348 1388646 1385026]
Rebuild_FUZZ: 95.24%
commit-author Ping Cheng <pinglinux@gmail.com>
commit b3bd7ef397a6031f5398c76a9a0b0695a38f6587
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/b3bd7ef3.failed

Some Cintiq and Intuos tablets report In Range event. This event is sent before
valid data is reported when tool enters proximity; or before out of proximity
event is reported when tool exits.

While entering proximity, In Range means a pen is detected. This information
can be used for palm/touch rejection on both pen and touch enabled devices.
While exiting, it means the tool has reached its maximum detectable distance.

	Signed-off-by: Ping Cheng <pingc@wacom.com>
	Signed-off-by: Jiri Kosina <jkosina@suse.cz>
(cherry picked from commit b3bd7ef397a6031f5398c76a9a0b0695a38f6587)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/hid/wacom_wac.c
diff --cc drivers/hid/wacom_wac.c
index e76dca5e56b8,a4ba8caa2456..000000000000
--- a/drivers/hid/wacom_wac.c
+++ b/drivers/hid/wacom_wac.c
@@@ -335,9 -443,6 +335,12 @@@ static int wacom_intuos_inout(struct wa
  
  	/* Enter report */
  	if ((data[1] & 0xfc) == 0xc0) {
++<<<<<<< HEAD
 +		if (features->quirks == WACOM_QUIRK_MULTI_INPUT)
 +			wacom->shared->stylus_in_proximity = true;
 +
++=======
++>>>>>>> b3bd7ef397a6 (HID: wacom: peport In Range event according to the spec)
  		/* serial number of the tool */
  		wacom->serial[idx] = ((data[3] & 0x0f) << 28) +
  			(data[4] << 20) + (data[5] << 12) +
@@@ -451,12 -559,14 +457,17 @@@
  		input_report_key(input, BTN_TOUCH, 0);
  		input_report_abs(input, ABS_PRESSURE, 0);
  		input_report_abs(input, ABS_DISTANCE, wacom->features.distance_max);
++<<<<<<< HEAD
++=======
+ 		return 2;
++>>>>>>> b3bd7ef397a6 (HID: wacom: peport In Range event according to the spec)
  	}
  
  	/* Exit report */
  	if ((data[1] & 0xfe) == 0x80) {
 -		if (features->quirks & WACOM_QUIRK_MULTI_INPUT)
 +		if (features->quirks == WACOM_QUIRK_MULTI_INPUT)
  			wacom->shared->stylus_in_proximity = false;
+ 		wacom->reporting_data = false;
  
  		/* don't report exit if we don't know the ID */
  		if (!wacom->id[idx])
* Unmerged path drivers/hid/wacom_wac.c
diff --git a/drivers/hid/wacom_wac.h b/drivers/hid/wacom_wac.h
index d220d069f329..a0b455aa83b0 100644
--- a/drivers/hid/wacom_wac.h
+++ b/drivers/hid/wacom_wac.h
@@ -143,6 +143,7 @@ struct wacom_wac {
 	int tool[2];
 	int id[2];
 	__u32 serial[2];
+	bool reporting_data;
 	struct wacom_features features;
 	struct wacom_shared *shared;
 	struct input_dev *input;
