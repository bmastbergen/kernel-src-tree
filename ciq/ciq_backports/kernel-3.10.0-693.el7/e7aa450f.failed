ASoC: dapm: Implement stereo mixer control support

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
Rebuild_CHGLOG: - [sound] alsa: asoc: dapm: Implement stereo mixer control support (Jaroslav Kysela) [1399503]
Rebuild_FUZZ: 94.34%
commit-author Chen-Yu Tsai <wens@csie.org>
commit e7aa450fe17890e59db7d3c2d8eff5b6b41fc531
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/e7aa450f.failed

While DAPM is mono or single channel, its controls can be shared between
widgets, such as sharing one stereo mixer control between the left and
right channel widgets. An example such as the following routes

    [Line In Left]----------<Line In Playback Switch>-------[Left Mixer]
                                          ^
          ^           ^                   |                      ^
       (inputs)    (paths)   <shared stereo mixer control>   (outputs)
          v           v                   |                      v
                                          v
    [Line In Right]---------<Line In Playback Switch>-------[Right Mixer]

where we have separate widgets and paths for the left and right channels
from "Line In" to "Mixer", but a shared stereo mixer control for the
2 paths.

This patch introduces support for such shared mixer controls, allowing
more than 1 path to be attached to a single stereo control, and being
able to control left/right channels independently.

	Signed-off-by: Chen-Yu Tsai <wens@csie.org>
	Signed-off-by: Mark Brown <broonie@kernel.org>
(cherry picked from commit e7aa450fe17890e59db7d3c2d8eff5b6b41fc531)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	sound/soc/soc-dapm.c
diff --cc sound/soc/soc-dapm.c
index 3bbe32ee4630,27dd02e57b31..000000000000
--- a/sound/soc/soc-dapm.c
+++ b/sound/soc/soc-dapm.c
@@@ -3080,18 -3152,14 +3143,20 @@@ int snd_soc_dapm_put_volsw(struct snd_k
  	int reg = mc->reg;
  	unsigned int shift = mc->shift;
  	int max = mc->max;
- 	unsigned int mask = (1 << fls(max)) - 1;
+ 	unsigned int width = fls(max);
+ 	unsigned int mask = (1 << width) - 1;
  	unsigned int invert = mc->invert;
++<<<<<<< HEAD
 +	unsigned int val;
 +	int connect, change, reg_change = 0;
 +	struct snd_soc_dapm_update update;
++=======
+ 	unsigned int val, rval = 0;
+ 	int connect, rconnect = -1, change, reg_change = 0;
+ 	struct snd_soc_dapm_update update = { NULL };
++>>>>>>> e7aa450fe178 (ASoC: dapm: Implement stereo mixer control support)
  	int ret = 0;
  
- 	if (snd_soc_volsw_is_stereo(mc))
- 		dev_warn(dapm->dev,
- 			 "ASoC: Control '%s' is stereo, which is not supported\n",
- 			 kcontrol->id.name);
- 
  	val = (ucontrol->value.integer.value[0] & mask);
  	connect = !!val;
  
* Unmerged path sound/soc/soc-dapm.c
