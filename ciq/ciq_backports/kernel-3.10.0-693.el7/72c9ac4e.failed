amd-xgbe: Add receive buffer unavailable statistic

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
commit-author Lendacky, Thomas <Thomas.Lendacky@amd.com>
commit 72c9ac4e1f4faf1f4e7252319ab8af2517891ae5
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/72c9ac4e.failed

Add a statistic that tracks how many times an interrupt is generated for
a receive buffer not being available to the hardware which prevents the
hardware from being able to DMA the received data.

	Signed-off-by: Tom Lendacky <thomas.lendacky@amd.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 72c9ac4e1f4faf1f4e7252319ab8af2517891ae5)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/amd/xgbe/xgbe-ethtool.c
#	drivers/net/ethernet/amd/xgbe/xgbe.h
diff --cc drivers/net/ethernet/amd/xgbe/xgbe-ethtool.c
index 4d8dc09465af,204fb3afb182..000000000000
--- a/drivers/net/ethernet/amd/xgbe/xgbe-ethtool.c
+++ b/drivers/net/ethernet/amd/xgbe/xgbe-ethtool.c
@@@ -171,7 -178,10 +171,12 @@@ static const struct xgbe_stats xgbe_gst
  	XGMAC_MMC_STAT("rx_fifo_overflow_errors", rxfifooverflow),
  	XGMAC_MMC_STAT("rx_watchdog_errors", rxwatchdogerror),
  	XGMAC_MMC_STAT("rx_pause_frames", rxpauseframes),
++<<<<<<< HEAD
++=======
+ 	XGMAC_EXT_STAT("rx_split_header_packets", rx_split_header_packets),
+ 	XGMAC_EXT_STAT("rx_buffer_unavailable", rx_buffer_unavailable),
++>>>>>>> 72c9ac4e1f4f (amd-xgbe: Add receive buffer unavailable statistic)
  };
 -
  #define XGBE_STATS_COUNT	ARRAY_SIZE(xgbe_gstring_stats)
  
  static void xgbe_get_strings(struct net_device *netdev, u32 stringset, u8 *data)
diff --cc drivers/net/ethernet/amd/xgbe/xgbe.h
index 1903f878545a,a5f5a7869609..000000000000
--- a/drivers/net/ethernet/amd/xgbe/xgbe.h
+++ b/drivers/net/ethernet/amd/xgbe/xgbe.h
@@@ -385,6 -579,12 +385,15 @@@ struct xgbe_mmc_stats 
  	u64 rxwatchdogerror;
  };
  
++<<<<<<< HEAD
++=======
+ struct xgbe_ext_stats {
+ 	u64 tx_tso_packets;
+ 	u64 rx_split_header_packets;
+ 	u64 rx_buffer_unavailable;
+ };
+ 
++>>>>>>> 72c9ac4e1f4f (amd-xgbe: Add receive buffer unavailable statistic)
  struct xgbe_hw_if {
  	int (*tx_complete)(struct xgbe_ring_desc *);
  
diff --git a/drivers/net/ethernet/amd/xgbe/xgbe-drv.c b/drivers/net/ethernet/amd/xgbe/xgbe-drv.c
index d58e85811bc9..d41c94cb95fc 100644
--- a/drivers/net/ethernet/amd/xgbe/xgbe-drv.c
+++ b/drivers/net/ethernet/amd/xgbe/xgbe-drv.c
@@ -238,6 +238,9 @@ static irqreturn_t xgbe_isr(int irq, void *data)
 			}
 		}
 
+		if (XGMAC_GET_BITS(dma_ch_isr, DMA_CH_SR, RBU))
+			pdata->ext_stats.rx_buffer_unavailable++;
+
 		/* Restart the device on a Fatal Bus Error */
 		if (XGMAC_GET_BITS(dma_ch_isr, DMA_CH_SR, FBE))
 			schedule_work(&pdata->restart_work);
* Unmerged path drivers/net/ethernet/amd/xgbe/xgbe-ethtool.c
* Unmerged path drivers/net/ethernet/amd/xgbe/xgbe.h
