net/mlx5e: Moves pflags to priv->params

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
Rebuild_CHGLOG: - [netdrv] mlx5e: Moves pflags to priv->params (Don Dutile) [1385330 1417286]
Rebuild_FUZZ: 94.59%
commit-author Shaker Daibes <shakerd@mellanox.com>
commit 59ece1c9693914f969eb896906889591c4d2f172
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/59ece1c9.failed

pflags is a configuration parameter for the netdev, naturally it belongs
to priv->params.
Also introduce MLX5E_GET_PFLAG

	Signed-off-by: Shaker Daibes <shakerd@mellanox.com>
	Signed-off-by: Saeed Mahameed <saeedm@mellanox.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 59ece1c9693914f969eb896906889591c4d2f172)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/mellanox/mlx5/core/en.h
diff --cc drivers/net/ethernet/mellanox/mlx5/core/en.h
index b01f5bb32ed7,84ac78f9087f..000000000000
--- a/drivers/net/ethernet/mellanox/mlx5/core/en.h
+++ b/drivers/net/ethernet/mellanox/mlx5/core/en.h
@@@ -187,10 -218,34 +189,18 @@@ struct mlx5e_params 
  	u8  toeplitz_hash_key[40];
  	u32 indirection_rqt[MLX5E_INDIR_RQT_SIZE];
  	bool vlan_strip_disable;
++<<<<<<< HEAD
++=======
+ 	bool rx_am_enabled;
+ 	u32 lro_timeout;
+ 	u32 pflags;
+ };
+ 
++>>>>>>> 59ece1c96939 (net/mlx5e: Moves pflags to priv->params)
  #ifdef CONFIG_MLX5_CORE_EN_DCB
 -struct mlx5e_cee_config {
 -	/* bw pct for priority group */
 -	u8                         pg_bw_pct[CEE_DCBX_MAX_PGS];
 -	u8                         prio_to_pg_map[CEE_DCBX_MAX_PRIO];
 -	bool                       pfc_setting[CEE_DCBX_MAX_PRIO];
 -	bool                       pfc_enable;
 -};
 -
 -enum {
 -	MLX5_DCB_CHG_RESET,
 -	MLX5_DCB_NO_CHG,
 -	MLX5_DCB_CHG_NO_RESET,
 -};
 -
 -struct mlx5e_dcbx {
 -	enum mlx5_dcbx_oper_mode   mode;
 -	struct mlx5e_cee_config    cee_cfg; /* pending configuration */
 -
 -	/* The only setting that cannot be read from FW */
 -	u8                         tc_tsa[IEEE_8021QAZ_MAX_TCS];
 -};
 +	struct ieee_ets ets;
  #endif
 +};
  
  struct mlx5e_tstamp {
  	rwlock_t                   lock;
@@@ -510,9 -705,9 +520,8 @@@ struct mlx5e_priv 
  	struct workqueue_struct    *wq;
  	struct work_struct         update_carrier_work;
  	struct work_struct         set_rx_mode_work;
 -	struct work_struct         tx_timeout_work;
  	struct delayed_work        update_stats_work;
  
- 	u32                        pflags;
  	struct mlx5_core_dev      *mdev;
  	struct net_device         *netdev;
  	struct mlx5e_stats         stats;
* Unmerged path drivers/net/ethernet/mellanox/mlx5/core/en.h
diff --git a/drivers/net/ethernet/mellanox/mlx5/core/en_ethtool.c b/drivers/net/ethernet/mellanox/mlx5/core/en_ethtool.c
index fa6e9bbc23fb..909d871036c1 100644
--- a/drivers/net/ethernet/mellanox/mlx5/core/en_ethtool.c
+++ b/drivers/net/ethernet/mellanox/mlx5/core/en_ethtool.c
@@ -1352,7 +1352,7 @@ static int mlx5e_handle_pflag(struct net_device *netdev,
 {
 	struct mlx5e_priv *priv = netdev_priv(netdev);
 	bool enable = !!(wanted_flags & flag);
-	u32 changes = wanted_flags ^ priv->pflags;
+	u32 changes = wanted_flags ^ priv->params.pflags;
 	int err;
 
 	if (!(changes & flag))
@@ -1365,7 +1365,7 @@ static int mlx5e_handle_pflag(struct net_device *netdev,
 		return err;
 	}
 
-	MLX5E_SET_PRIV_FLAG(priv, flag, enable);
+	MLX5E_SET_PFLAG(priv, flag, enable);
 	return 0;
 }
 
@@ -1388,7 +1388,7 @@ static u32 mlx5e_get_priv_flags(struct net_device *netdev)
 {
 	struct mlx5e_priv *priv = netdev_priv(netdev);
 
-	return priv->pflags;
+	return priv->params.pflags;
 }
 
 const struct ethtool_ops mlx5e_ethtool_ops = {
diff --git a/drivers/net/ethernet/mellanox/mlx5/core/en_main.c b/drivers/net/ethernet/mellanox/mlx5/core/en_main.c
index cc20a22c48b8..b0fd98c0abde 100644
--- a/drivers/net/ethernet/mellanox/mlx5/core/en_main.c
+++ b/drivers/net/ethernet/mellanox/mlx5/core/en_main.c
@@ -2820,8 +2820,8 @@ static void mlx5e_build_netdev_priv(struct mlx5_core_dev *mdev,
 		SKB_DATA_ALIGN(sizeof(struct skb_shared_info));
 
 	/* Initialize pflags */
-	MLX5E_SET_PRIV_FLAG(priv, MLX5E_PFLAG_RX_CQE_BASED_MODER,
-			    priv->params.rx_cq_period_mode == MLX5_CQ_PERIOD_MODE_START_FROM_CQE);
+	MLX5E_SET_PFLAG(priv, MLX5E_PFLAG_RX_CQE_BASED_MODER,
+			priv->params.rx_cq_period_mode == MLX5_CQ_PERIOD_MODE_START_FROM_CQE);
 
 	priv->mdev                         = mdev;
 	priv->netdev                       = netdev;
