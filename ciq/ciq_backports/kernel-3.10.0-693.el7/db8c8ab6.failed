xen-netfront: fix locking in connect error path

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
commit-author David Vrabel <david.vrabel@citrix.com>
commit db8c8ab61a28d7e3eb86d247b342a853263262c3
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/db8c8ab6.failed

If no queues could be created when connecting to the backend, one of the
error paths would deadlock.

	Signed-off-by: David Vrabel <david.vrabel@citrix.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit db8c8ab61a28d7e3eb86d247b342a853263262c3)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/xen-netfront.c
diff --cc drivers/net/xen-netfront.c
index 6c33c68dceb8,1cc46d00d20a..000000000000
--- a/drivers/net/xen-netfront.c
+++ b/drivers/net/xen-netfront.c
@@@ -1721,10 -1992,16 +1721,18 @@@ again
  	return 0;
  
   abort_transaction:
 -	xenbus_dev_fatal(dev, err, "%s", message);
 -abort_transaction_no_dev_fatal:
  	xenbus_transaction_end(xbt, 1);
 +	xenbus_dev_fatal(dev, err, "%s", message);
   destroy_ring:
  	xennet_disconnect_backend(info);
++<<<<<<< HEAD
++=======
+ 	kfree(info->queues);
+ 	info->queues = NULL;
+ 	rtnl_lock();
+ 	netif_set_real_num_tx_queues(info->netdev, 0);
+ 	rtnl_unlock();
++>>>>>>> db8c8ab61a28 (xen-netfront: fix locking in connect error path)
   out:
  	return err;
  }
* Unmerged path drivers/net/xen-netfront.c
