x86/platform/UV: Add Support for UV4 Hubless systems

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
Rebuild_CHGLOG: - [x86] platform/uv: Add Support for UV4 Hubless systems (Frank Ramsay) [1416460]
Rebuild_FUZZ: 96.00%
commit-author travis@sgi.com <travis@sgi.com>
commit 74862b03b46a852662c1a30c859b985261ff5d5c
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/74862b03.failed

Add recognition and support for UV4 hubless systems.

	Signed-off-by: Mike Travis <travis@sgi.com>
	Reviewed-by: Russ Anderson <rja@hpe.com>
	Acked-by: Thomas Gleixner <tglx@linutronix.de>
	Acked-by: Dimitri Sivanich <sivanich@hpe.com>
	Cc: Linus Torvalds <torvalds@linux-foundation.org>
	Cc: Peter Zijlstra <peterz@infradead.org>
Link: http://lkml.kernel.org/r/20170125163517.398537358@asylum.americas.sgi.com
	Signed-off-by: Ingo Molnar <mingo@kernel.org>
(cherry picked from commit 74862b03b46a852662c1a30c859b985261ff5d5c)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/x86/kernel/apic/x2apic_uv_x.c
diff --cc arch/x86/kernel/apic/x2apic_uv_x.c
index bdcca5ada7d6,d02cc7e65e4d..000000000000
--- a/arch/x86/kernel/apic/x2apic_uv_x.c
+++ b/arch/x86/kernel/apic/x2apic_uv_x.c
@@@ -41,15 -41,14 +41,24 @@@
  
  DEFINE_PER_CPU(int, x2apic_extra_bits);
  
++<<<<<<< HEAD
 +#define PR_DEVEL(fmt, args...)	pr_devel("%s: " fmt, __func__, args)
++=======
+ static enum uv_system_type	uv_system_type;
+ static bool			uv_hubless_system;
+ static u64			gru_start_paddr, gru_end_paddr;
+ static u64			gru_dist_base, gru_first_node_paddr = -1LL, gru_last_node_paddr;
+ static u64			gru_dist_lmask, gru_dist_umask;
+ static union uvh_apicid		uvh_apicid;
++>>>>>>> 74862b03b46a (x86/platform/UV: Add Support for UV4 Hubless systems)
  
 -/* Information derived from CPUID: */
 +static enum uv_system_type uv_system_type;
 +static u64 gru_start_paddr, gru_end_paddr;
 +static u64 gru_dist_base, gru_first_node_paddr = -1LL, gru_last_node_paddr;
 +static u64 gru_dist_lmask, gru_dist_umask;
 +static union uvh_apicid uvh_apicid;
 +
 +/* info derived from CPUID */
  static struct {
  	unsigned int apicid_shift;
  	unsigned int apicid_mask;
diff --git a/arch/x86/include/asm/uv/uv.h b/arch/x86/include/asm/uv/uv.h
index 062921ef34e9..6686820feae9 100644
--- a/arch/x86/include/asm/uv/uv.h
+++ b/arch/x86/include/asm/uv/uv.h
@@ -10,6 +10,7 @@ struct mm_struct;
 
 extern enum uv_system_type get_uv_system_type(void);
 extern int is_uv_system(void);
+extern int is_uv_hubless(void);
 extern void uv_cpu_init(void);
 extern void uv_nmi_init(void);
 extern void uv_system_init(void);
@@ -23,6 +24,7 @@ extern const struct cpumask *uv_flush_tlb_others(const struct cpumask *cpumask,
 
 static inline enum uv_system_type get_uv_system_type(void) { return UV_NONE; }
 static inline int is_uv_system(void)	{ return 0; }
+static inline int is_uv_hubless(void)	{ return 0; }
 static inline void uv_cpu_init(void)	{ }
 static inline void uv_system_init(void)	{ }
 static inline const struct cpumask *
* Unmerged path arch/x86/kernel/apic/x2apic_uv_x.c
