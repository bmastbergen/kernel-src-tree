storvsc: Install the storvsc specific timeout handler for FC devices

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
commit-author K. Y. Srinivasan <kys@microsoft.com>
commit d791a8c60e9cbd1c4fecbc5c86ff59c7ffe137e8
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/d791a8c6.failed

The default timeout routine used for FC transport is not suitable for FC
devices managed by storvsc since FC devices managed by storvsc driver do
not have an rport associated with them. Use the time out handler used
for SCSI devices for FC devices as well.

	Signed-off-by: K. Y. Srinivasan <kys@microsoft.com>
	Reviewed-by: Alex Ng <alexng@microsoft.com>
	Tested-by: Vivek Yadav <vyadav@microsoft.com>
	Reviewed-by: Johannes Thumshirn <jthumshirn@suse.de>
	Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
(cherry picked from commit d791a8c60e9cbd1c4fecbc5c86ff59c7ffe137e8)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/scsi/storvsc_drv.c
diff --cc drivers/scsi/storvsc_drv.c
index 0192ee818266,622f64a98a9e..000000000000
--- a/drivers/scsi/storvsc_drv.c
+++ b/drivers/scsi/storvsc_drv.c
@@@ -41,6 -41,8 +41,11 @@@
  #include <scsi/scsi_eh.h>
  #include <scsi/scsi_devinfo.h>
  #include <scsi/scsi_dbg.h>
++<<<<<<< HEAD
++=======
+ #include <scsi/scsi_transport_fc.h>
+ #include <scsi/scsi_transport.h>
++>>>>>>> d791a8c60e9c (storvsc: Install the storvsc specific timeout handler for FC devices)
  
  /*
   * All wire protocol details (storage protocol between the guest and the host)
@@@ -1729,7 -1767,25 +1734,29 @@@ static int __init storvsc_drv_init(void
  		vmscsi_size_delta,
  		sizeof(u64)));
  
++<<<<<<< HEAD
 +	return vmbus_driver_register(&storvsc_drv);
++=======
+ #if IS_ENABLED(CONFIG_SCSI_FC_ATTRS)
+ 	fc_transport_template = fc_attach_transport(&fc_transport_functions);
+ 	if (!fc_transport_template)
+ 		return -ENODEV;
+ 
+ 	/*
+ 	 * Install Hyper-V specific timeout handler.
+ 	 */
+ 	fc_transport_template->eh_timed_out = storvsc_eh_timed_out;
+ #endif
+ 
+ 	ret = vmbus_driver_register(&storvsc_drv);
+ 
+ #if IS_ENABLED(CONFIG_SCSI_FC_ATTRS)
+ 	if (ret)
+ 		fc_release_transport(fc_transport_template);
+ #endif
+ 
+ 	return ret;
++>>>>>>> d791a8c60e9c (storvsc: Install the storvsc specific timeout handler for FC devices)
  }
  
  static void __exit storvsc_drv_exit(void)
* Unmerged path drivers/scsi/storvsc_drv.c
