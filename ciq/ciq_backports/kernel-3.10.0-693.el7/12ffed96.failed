drm/fb-helper: Allow var->x/yres(_virtual) < fb->width/height again

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
Rebuild_CHGLOG: - [drm] fb-helper: Allow var->x/yres(_virtual) < fb->width/height again (Rob Clark) [1422186]
Rebuild_FUZZ: 96.92%
commit-author Michel Dänzer <michel.daenzer@amd.com>
commit 12ffed96d4369f086261ba2ee734fa8c932d7f55
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/12ffed96.failed

Otherwise this can also prevent modesets e.g. for switching VTs, when
multiple monitors with different native resolutions are connected.

The depths must match though, so keep the != test for that.

Also update the DRM_DEBUG output to be slightly more accurate, this
doesn't only affect requests from userspace.

Bugzilla: https://bugs.freedesktop.org/99841
Fixes: 865afb11949e ("drm/fb-helper: reject any changes to the fbdev")
	Signed-off-by: Michel Dänzer <michel.daenzer@amd.com>
	Reviewed-by: Daniel Stone <daniels@collabora.com>
	Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>
Link: http://patchwork.freedesktop.org/patch/msgid/20170323085326.20185-1-michel@daenzer.net
(cherry picked from commit 12ffed96d4369f086261ba2ee734fa8c932d7f55)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/gpu/drm/drm_fb_helper.c
diff --cc drivers/gpu/drm/drm_fb_helper.c
index fe4df976f0b8,324a688b3f30..000000000000
--- a/drivers/gpu/drm/drm_fb_helper.c
+++ b/drivers/gpu/drm/drm_fb_helper.c
@@@ -1108,11 -1255,14 +1108,22 @@@ int drm_fb_helper_check_var(struct fb_v
  	if (var->pixclock != 0 || in_dbg_master())
  		return -EINVAL;
  
++<<<<<<< HEAD
 +	/* Need to resize the fb object !!! */
 +	if (var->bits_per_pixel > fb->bits_per_pixel ||
 +	    var->xres > fb->width || var->yres > fb->height ||
 +	    var->xres_virtual > fb->width || var->yres_virtual > fb->height) {
 +		DRM_DEBUG("fb userspace requested width/height/bpp is greater than current fb "
++=======
+ 	/*
+ 	 * Changes struct fb_var_screeninfo are currently not pushed back
+ 	 * to KMS, hence fail if different settings are requested.
+ 	 */
+ 	if (var->bits_per_pixel != fb->format->cpp[0] * 8 ||
+ 	    var->xres > fb->width || var->yres > fb->height ||
+ 	    var->xres_virtual > fb->width || var->yres_virtual > fb->height) {
+ 		DRM_DEBUG("fb requested width/height/bpp can't fit in current fb "
++>>>>>>> 12ffed96d436 (drm/fb-helper: Allow var->x/yres(_virtual) < fb->width/height again)
  			  "request %dx%d-%d (virtual %dx%d) > %dx%d-%d\n",
  			  var->xres, var->yres, var->bits_per_pixel,
  			  var->xres_virtual, var->yres_virtual,
* Unmerged path drivers/gpu/drm/drm_fb_helper.c
