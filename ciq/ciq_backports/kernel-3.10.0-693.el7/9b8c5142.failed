net/mlx5: Release FTE lock in error flow

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
Rebuild_CHGLOG: - [netdrv] mlx5: Release FTE lock in error flow (Don Dutile) [1385330 1417286]
Rebuild_FUZZ: 94.74%
commit-author Maor Gottlieb <maorg@mellanox.com>
commit 9b8c514291a83e53c073b473bdca6267f17a02c2
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/9b8c5142.failed

Release the FTE lock when adding rule to the FTE has failed.

Fixes: 0fd758d6112f ('net/mlx5: Don't unlock fte while still using it')
	Signed-off-by: Maor Gottlieb <maorg@mellanox.com>
	Reviewed-by: Mark Bloch <markb@mellanox.com>
	Signed-off-by: Saeed Mahameed <saeedm@mellanox.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 9b8c514291a83e53c073b473bdca6267f17a02c2)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/mellanox/mlx5/core/fs_core.c
diff --cc drivers/net/ethernet/mellanox/mlx5/core/fs_core.c
index b32d85f4e0ff,0ac7a2fc916c..000000000000
--- a/drivers/net/ethernet/mellanox/mlx5/core/fs_core.c
+++ b/drivers/net/ethernet/mellanox/mlx5/core/fs_core.c
@@@ -1085,8 -1261,9 +1085,14 @@@ static struct mlx5_flow_rule *add_rule_
  	}
  	tree_init_node(&fte->node, 0, del_fte);
  	nested_lock_ref_node(&fte->node, FS_MUTEX_CHILD);
++<<<<<<< HEAD
 +	rule = add_rule_fte(fte, fg, dest, false);
 +	if (IS_ERR(rule)) {
++=======
+ 	handle = add_rule_fte(fte, fg, dest, dest_num, false);
+ 	if (IS_ERR(handle)) {
+ 		unlock_ref_node(&fte->node);
++>>>>>>> 9b8c514291a8 (net/mlx5: Release FTE lock in error flow)
  		kfree(fte);
  		goto unlock_fg;
  	}
* Unmerged path drivers/net/ethernet/mellanox/mlx5/core/fs_core.c
