qla2xxx: Let DPORT be enabled purely by nvram.

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
Rebuild_CHGLOG: - [scsi] qla2xxx: Let DPORT be enabled purely by nvram (Chad Dupuis) [1384091]
Rebuild_FUZZ: 98.90%
commit-author Joe Carnuccio <joe.carnuccio@qlogic.com>
commit 40f3862ba91ec1a76ecd848e483db9fc20d279b8
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/40f3862b.failed

	Signed-off-by: Joe Carnuccio <joe.carnuccio@qlogic.com>
	Signed-off-by: Himanshu Madhani <himanshu.madhani@qlogic.com>
	Reviewed-by: Hannes Reinecke <hare@suse.com>
	Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
(cherry picked from commit 40f3862ba91ec1a76ecd848e483db9fc20d279b8)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/scsi/qla2xxx/qla_dbg.c
#	drivers/scsi/qla2xxx/qla_def.h
#	drivers/scsi/qla2xxx/qla_init.c
diff --cc drivers/scsi/qla2xxx/qla_dbg.c
index 2e18dc18ea3a,eebd1a585cdd..000000000000
--- a/drivers/scsi/qla2xxx/qla_dbg.c
+++ b/drivers/scsi/qla2xxx/qla_dbg.c
@@@ -11,16 -11,15 +11,25 @@@
   * ----------------------------------------------------------------------
   * |             Level            |   Last Value Used  |     Holes	|
   * ----------------------------------------------------------------------
++<<<<<<< HEAD
 + * | Module Init and Probe        |       0x018f       | 0x0146         |
 + * | Mailbox commands             |       0x1181       | 0x111a-0x111b  |
 + * |                              |                    | 0x1155-0x1158  |
 + * |                              |                    | 0x1018-0x1019  |
 + * |                              |                    | 0x1115-0x1116  |
 + * |                              |                    | 0x10ca         |
 + * | Device Discovery             |       0x2095       | 0x2020-0x2022, |
++=======
+  * | Module Init and Probe        |       0x0191       | 0x0146         |
+  * |                              |                    | 0x015b-0x0160	|
+  * |                              |                    | 0x016e		|
+  * | Mailbox commands             |       0x1196       |		|
+  * |                              |                    |		|
+  * | Device Discovery             |       0x2003       | 0x2016		|
++>>>>>>> 40f3862ba91e (qla2xxx: Let DPORT be enabled purely by nvram.)
   * |                              |                    | 0x2011-0x2012, |
   * |                              |                    | 0x2099-0x20a4  |
 - * | Queue Command and IO tracing |       0x3074       | 0x300b         |
 + * | Queue Command and IO tracing |       0x3075       | 0x300b         |
   * |                              |                    | 0x3027-0x3028  |
   * |                              |                    | 0x303d-0x3041  |
   * |                              |                    | 0x302d,0x3033  |
diff --cc drivers/scsi/qla2xxx/qla_def.h
index 0e1f0af3adff,c04d83e6a8b6..000000000000
--- a/drivers/scsi/qla2xxx/qla_def.h
+++ b/drivers/scsi/qla2xxx/qla_def.h
@@@ -2964,10 -3026,13 +2964,15 @@@ struct qla_hw_data 
  		uint32_t	isp82xx_no_md_cap:1;
  		uint32_t	host_shutting_down:1;
  		uint32_t	idc_compl_status:1;
 +
  		uint32_t        mr_reset_hdlr_active:1;
  		uint32_t        mr_intr_valid:1;
++<<<<<<< HEAD
++=======
+ 
+ 		uint32_t        dport_enabled:1;
++>>>>>>> 40f3862ba91e (qla2xxx: Let DPORT be enabled purely by nvram.)
  		uint32_t	fawwpn_enabled:1;
 -		uint32_t	exlogins_enabled:1;
 -		uint32_t	exchoffld_enabled:1;
  		/* 35 bits */
  	} flags;
  
diff --cc drivers/scsi/qla2xxx/qla_init.c
index c64ee86b3feb,5b09296b46a3..000000000000
--- a/drivers/scsi/qla2xxx/qla_init.c
+++ b/drivers/scsi/qla2xxx/qla_init.c
@@@ -2267,14 -2287,14 +2267,23 @@@ qla2x00_init_rings(scsi_qla_host_t *vha
  	if (IS_FWI2_CAPABLE(ha)) {
  		mid_init_cb->options = cpu_to_le16(BIT_1);
  		mid_init_cb->init_cb.execution_throttle =
++<<<<<<< HEAD
 +		    cpu_to_le16(ha->fw_xcb_count);
 +		/* D-Port Status */
 +		if (IS_DPORT_CAPABLE(ha))
 +			mid_init_cb->init_cb.firmware_options_1 |=
 +			    cpu_to_le16(BIT_7);
 +		/* Enable FA-WWPN */
++=======
+ 		    cpu_to_le16(ha->cur_fw_xcb_count);
+ 		ha->flags.dport_enabled =
+ 		    (mid_init_cb->init_cb.firmware_options_1 & BIT_7) != 0;
+ 		ql_dbg(ql_dbg_init, vha, 0x0191, "DPORT Support: %s.\n",
+ 		    (ha->flags.dport_enabled) ? "enabled" : "disabled");
+ 		/* FA-WWPN Status */
++>>>>>>> 40f3862ba91e (qla2xxx: Let DPORT be enabled purely by nvram.)
  		ha->flags.fawwpn_enabled =
- 		    (mid_init_cb->init_cb.firmware_options_1 & BIT_6) ? 1 : 0;
+ 		    (mid_init_cb->init_cb.firmware_options_1 & BIT_6) != 0;
  		ql_dbg(ql_dbg_init, vha, 0x0141, "FA-WWPN Support: %s.\n",
  		    (ha->flags.fawwpn_enabled) ? "enabled" : "disabled");
  	}
* Unmerged path drivers/scsi/qla2xxx/qla_dbg.c
* Unmerged path drivers/scsi/qla2xxx/qla_def.h
* Unmerged path drivers/scsi/qla2xxx/qla_init.c
