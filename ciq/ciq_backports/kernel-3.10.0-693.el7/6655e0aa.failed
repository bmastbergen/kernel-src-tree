x86/boot: Rename "real_mode" to "boot_params"

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
Rebuild_CHGLOG: - [x86] boot: Rename "real_mode" to "boot_params" (Baoquan He) [1290840]
Rebuild_FUZZ: 95.35%
commit-author Kees Cook <keescook@chromium.org>
commit 6655e0aaf768c39a62eea739c453b9db1e841cfb
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/6655e0aa.failed

The non-compressed boot code uses the (much more obvious) name
"boot_params" for the global pointer to the x86 boot parameters. The
compressed kernel loader code, though, was using the legacy name
"real_mode". There is no need to have a different name, and changing it
improves readability.

	Suggested-by: Ingo Molnar <mingo@kernel.org>
	Signed-off-by: Kees Cook <keescook@chromium.org>
	Cc: Andrew Morton <akpm@linux-foundation.org>
	Cc: Andrey Ryabinin <aryabinin@virtuozzo.com>
	Cc: Andy Lutomirski <luto@amacapital.net>
	Cc: Andy Lutomirski <luto@kernel.org>
	Cc: Baoquan He <bhe@redhat.com>
	Cc: Borislav Petkov <bp@alien8.de>
	Cc: Borislav Petkov <bp@suse.de>
	Cc: Brian Gerst <brgerst@gmail.com>
	Cc: Denys Vlasenko <dvlasenk@redhat.com>
	Cc: Dmitry Vyukov <dvyukov@google.com>
	Cc: H. Peter Anvin <hpa@zytor.com>
	Cc: H.J. Lu <hjl.tools@gmail.com>
	Cc: Josh Poimboeuf <jpoimboe@redhat.com>
	Cc: Linus Torvalds <torvalds@linux-foundation.org>
	Cc: Peter Zijlstra <peterz@infradead.org>
	Cc: Thomas Gleixner <tglx@linutronix.de>
	Cc: Yinghai Lu <yinghai@kernel.org>
Link: http://lkml.kernel.org/r/1460997735-24785-4-git-send-email-keescook@chromium.org
	Signed-off-by: Ingo Molnar <mingo@kernel.org>
(cherry picked from commit 6655e0aaf768c39a62eea739c453b9db1e841cfb)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/x86/boot/compressed/kaslr.c
#	arch/x86/boot/compressed/misc.c
#	arch/x86/boot/compressed/misc.h
diff --cc arch/x86/boot/compressed/misc.c
index 136cb407d4ef,462dfbf7467b..000000000000
--- a/arch/x86/boot/compressed/misc.c
+++ b/arch/x86/boot/compressed/misc.c
@@@ -114,16 -114,10 +114,16 @@@ static void error(char *m)
  /*
   * This is set up by the setup-routine at boot-time
   */
- struct boot_params *real_mode;		/* Pointer to real-mode data */
+ struct boot_params *boot_params;
  
 -memptr free_mem_ptr;
 -memptr free_mem_end_ptr;
 +#ifdef CONFIG_X86_64
 +#define memptr long
 +#else
 +#define memptr unsigned
 +#endif
 +
 +static memptr free_mem_ptr;
 +static memptr free_mem_end_ptr;
  
  static char *vidmem;
  static int vidport;
@@@ -376,11 -392,15 +376,19 @@@ asmlinkage void decompress_kernel(void 
  {
  	unsigned char *output_orig = output;
  
- 	real_mode = rmode;
+ 	/* Retain x86 boot parameters pointer passed from startup_32/64. */
+ 	boot_params = rmode;
  
++<<<<<<< HEAD
 +	sanitize_boot_params(real_mode);
++=======
+ 	/* Clear flags intended for solely in-kernel use. */
+ 	boot_params->hdr.loadflags &= ~KASLR_FLAG;
  
- 	if (real_mode->screen_info.orig_video_mode == 7) {
+ 	sanitize_boot_params(boot_params);
++>>>>>>> 6655e0aaf768 (x86/boot: Rename "real_mode" to "boot_params")
+ 
+ 	if (boot_params->screen_info.orig_video_mode == 7) {
  		vidmem = (char *) 0xb0000;
  		vidport = 0x3b4;
  	} else {
diff --cc arch/x86/boot/compressed/misc.h
index 674019d8e235,1f750a516580..000000000000
--- a/arch/x86/boot/compressed/misc.h
+++ b/arch/x86/boot/compressed/misc.h
@@@ -23,10 -23,20 +23,16 @@@
  #define BOOT_BOOT_H
  #include "../ctype.h"
  
 -#ifdef CONFIG_X86_64
 -#define memptr long
 -#else
 -#define memptr unsigned
 -#endif
 -
  /* misc.c */
++<<<<<<< HEAD
 +extern struct boot_params *real_mode;		/* Pointer to real-mode data */
++=======
+ extern memptr free_mem_ptr;
+ extern memptr free_mem_end_ptr;
+ extern struct boot_params *boot_params;
++>>>>>>> 6655e0aaf768 (x86/boot: Rename "real_mode" to "boot_params")
  void __putstr(const char *s);
 -void __puthex(unsigned long value);
  #define error_putstr(__x)  __putstr(__x)
 -#define error_puthex(__x)  __puthex(__x)
  
  #ifdef CONFIG_X86_VERBOSE_BOOTUP
  
* Unmerged path arch/x86/boot/compressed/kaslr.c
diff --git a/arch/x86/boot/compressed/cmdline.c b/arch/x86/boot/compressed/cmdline.c
index bffd73b45b1f..7ee93b1a4804 100644
--- a/arch/x86/boot/compressed/cmdline.c
+++ b/arch/x86/boot/compressed/cmdline.c
@@ -15,9 +15,9 @@ static inline char rdfs8(addr_t addr)
 #include "../cmdline.c"
 static unsigned long get_cmd_line_ptr(void)
 {
-	unsigned long cmd_line_ptr = real_mode->hdr.cmd_line_ptr;
+	unsigned long cmd_line_ptr = boot_params->hdr.cmd_line_ptr;
 
-	cmd_line_ptr |= (u64)real_mode->ext_cmd_line_ptr << 32;
+	cmd_line_ptr |= (u64)boot_params->ext_cmd_line_ptr << 32;
 
 	return cmd_line_ptr;
 }
* Unmerged path arch/x86/boot/compressed/kaslr.c
* Unmerged path arch/x86/boot/compressed/misc.c
* Unmerged path arch/x86/boot/compressed/misc.h
