scsi: qla2xxx: Add fix to read correct register value for ISP82xx.

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
Rebuild_CHGLOG: - [scsi] qla2xxx: Add fix to read correct register value for ISP82xx (Himanshu Madhani) [1436940]
Rebuild_FUZZ: 94.40%
commit-author Sawan Chandak <sawan.chandak@cavium.com>
commit bf6061b17a8d47ef0d9344d3ef576a4ff0edf793
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/bf6061b1.failed

Add fix to read correct register value for ISP82xx, during check for
register disconnect.ISP82xx has different base register.

Fixes: a465537ad1a4 ("qla2xxx: Disable the adapter and skip error recovery in case of register disconnect")
	Signed-off-by: Sawan Chandak <sawan.chandak@cavium.com>
	Signed-off-by: Himanshu Madhani <himanshu.madhani@cavium.com>
	Cc: <stable@vger.kernel.org>
	Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
(cherry picked from commit bf6061b17a8d47ef0d9344d3ef576a4ff0edf793)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/scsi/qla2xxx/qla_os.c
diff --cc drivers/scsi/qla2xxx/qla_os.c
index f1f989d1fce1,c9e45d2befe5..000000000000
--- a/drivers/scsi/qla2xxx/qla_os.c
+++ b/drivers/scsi/qla2xxx/qla_os.c
@@@ -928,6 -1106,35 +928,38 @@@ sp_get(struct srb *sp
  	atomic_inc(&sp->ref_count);
  }
  
++<<<<<<< HEAD
++=======
+ #define ISP_REG_DISCONNECT 0xffffffffU
+ /**************************************************************************
+ * qla2x00_isp_reg_stat
+ *
+ * Description:
+ *	Read the host status register of ISP before aborting the command.
+ *
+ * Input:
+ *	ha = pointer to host adapter structure.
+ *
+ *
+ * Returns:
+ *	Either true or false.
+ *
+ * Note:	Return true if there is register disconnect.
+ **************************************************************************/
+ static inline
+ uint32_t qla2x00_isp_reg_stat(struct qla_hw_data *ha)
+ {
+ 	struct device_reg_24xx __iomem *reg = &ha->iobase->isp24;
+ 	struct device_reg_82xx __iomem *reg82 = &ha->iobase->isp82;
+ 
+ 	if (IS_P3P_TYPE(ha))
+ 		return ((RD_REG_DWORD(&reg82->host_int)) == ISP_REG_DISCONNECT);
+ 	else
+ 		return ((RD_REG_DWORD(&reg->host_status)) ==
+ 			ISP_REG_DISCONNECT);
+ }
+ 
++>>>>>>> bf6061b17a8d (scsi: qla2xxx: Add fix to read correct register value for ISP82xx.)
  /**************************************************************************
  * qla2xxx_eh_abort
  *
* Unmerged path drivers/scsi/qla2xxx/qla_os.c
