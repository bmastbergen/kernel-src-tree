x86, boot: Don't compile early_serial_console.c when !CONFIG_EARLY_PRINTK

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
Rebuild_CHGLOG: - [x86] boot: Don't compile early_serial_console.c when !CONFIG_EARLY_PRINTK (Baoquan He) [1290840]
Rebuild_FUZZ: 96.45%
commit-author Josh Triplett <josh@joshtriplett.org>
commit 3afed06a355b5525d9a87bcb76567ef2e2e7b3a2
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/3afed06a.failed

All the code in early_serial_console.c gets compiled out if
!CONFIG_EARLY_PRINTK, but early_serial_console.o itself still gets
compiled in.  Eliminate it from the compile entirely in that case.

This does not change the generated code at all, in either case.

	Signed-off-by: Josh Triplett <josh@joshtriplett.org>
(cherry picked from commit 3afed06a355b5525d9a87bcb76567ef2e2e7b3a2)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/x86/boot/compressed/Makefile
diff --cc arch/x86/boot/compressed/Makefile
index 1dc427850e11,20db5b3609de..000000000000
--- a/arch/x86/boot/compressed/Makefile
+++ b/arch/x86/boot/compressed/Makefile
@@@ -26,9 -26,12 +26,18 @@@ LDFLAGS_vmlinux := -
  hostprogs-y	:= mkpiggy
  HOST_EXTRACFLAGS += -I$(srctree)/tools/include
  
++<<<<<<< HEAD
 +VMLINUX_OBJS = $(obj)/vmlinux.lds $(obj)/head_$(BITS).o $(obj)/misc.o \
 +	$(obj)/string.o $(obj)/cmdline.o $(obj)/early_serial_console.o \
 +	$(obj)/piggy.o
++=======
+ vmlinux-objs-y := $(obj)/vmlinux.lds $(obj)/head_$(BITS).o $(obj)/misc.o \
+ 	$(obj)/string.o $(obj)/cmdline.o \
+ 	$(obj)/piggy.o $(obj)/cpuflags.o
+ 
+ vmlinux-objs-$(CONFIG_EARLY_PRINTK) += $(obj)/early_serial_console.o
+ vmlinux-objs-$(CONFIG_RANDOMIZE_BASE) += $(obj)/aslr.o
++>>>>>>> 3afed06a355b (x86, boot: Don't compile early_serial_console.c when !CONFIG_EARLY_PRINTK)
  
  $(obj)/eboot.o: KBUILD_CFLAGS += -fshort-wchar -mno-red-zone
  
* Unmerged path arch/x86/boot/compressed/Makefile
diff --git a/arch/x86/boot/compressed/early_serial_console.c b/arch/x86/boot/compressed/early_serial_console.c
index d3d003cb5481..261e81fb9582 100644
--- a/arch/x86/boot/compressed/early_serial_console.c
+++ b/arch/x86/boot/compressed/early_serial_console.c
@@ -1,9 +1,5 @@
 #include "misc.h"
 
-#ifdef CONFIG_EARLY_PRINTK
-
 int early_serial_base;
 
 #include "../early_serial_console.c"
-
-#endif
