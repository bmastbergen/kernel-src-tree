cls_u32: complete the check for non-forced case in u32_destroy()

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
Rebuild_CHGLOG: - [net] sched: cls_u32: complete the check for non-forced case in u32_destroy() (Ivan Vecera) [1428588]
Rebuild_FUZZ: 94.81%
commit-author WANG Cong <xiyou.wangcong@gmail.com>
commit a6c1aea044e490da3e59124ec55991fe316818d5
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/a6c1aea0.failed

In commit 1e052be69d04 ("net_sched: destroy proto tp when all filters are gone")
I added a check in u32_destroy() to see if all real filters are gone
for each tp, however, that is only done for root_ht, same is needed
for others.

This can be reproduced by the following tc commands:

tc filter add dev eth0 parent 1:0 prio 5 handle 15: protocol ip u32 divisor 256
tc filter add dev eth0 protocol ip parent 1: prio 5 handle 15:2:2 u32
ht 15:2: match ip src 10.0.0.2 flowid 1:10
tc filter add dev eth0 protocol ip parent 1: prio 5 handle 15:2:3 u32
ht 15:2: match ip src 10.0.0.3 flowid 1:10

Fixes: 1e052be69d04 ("net_sched: destroy proto tp when all filters are gone")
	Reported-by: Akshat Kakkar <akshat.1984@gmail.com>
	Cc: Jamal Hadi Salim <jhs@mojatatu.com>
	Signed-off-by: Cong Wang <xiyou.wangcong@gmail.com>
	Signed-off-by: Cong Wang <cwang@twopensource.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit a6c1aea044e490da3e59124ec55991fe316818d5)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/sched/cls_u32.c
diff --cc net/sched/cls_u32.c
index 1311b04273a5,4fbb67430ce4..000000000000
--- a/net/sched/cls_u32.c
+++ b/net/sched/cls_u32.c
@@@ -437,6 -481,30 +437,33 @@@ static void u32_destroy(struct tcf_prot
  
  	WARN_ON(root_ht == NULL);
  
++<<<<<<< HEAD
++=======
+ 	if (!force) {
+ 		if (root_ht) {
+ 			if (root_ht->refcnt > 1)
+ 				return false;
+ 			if (root_ht->refcnt == 1) {
+ 				if (!ht_empty(root_ht))
+ 					return false;
+ 			}
+ 		}
+ 
+ 		if (tp_c->refcnt > 1)
+ 			return false;
+ 
+ 		if (tp_c->refcnt == 1) {
+ 			struct tc_u_hnode *ht;
+ 
+ 			for (ht = rtnl_dereference(tp_c->hlist);
+ 			     ht;
+ 			     ht = rtnl_dereference(ht->next))
+ 				if (!ht_empty(ht))
+ 					return false;
+ 		}
+ 	}
+ 
++>>>>>>> a6c1aea044e4 (cls_u32: complete the check for non-forced case in u32_destroy())
  	if (root_ht && --root_ht->refcnt == 0)
  		u32_destroy_hnode(tp, root_ht);
  
* Unmerged path net/sched/cls_u32.c
