vfio/pci: Include sparse mmap capability for MSI-X table regions

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
Rebuild_CHGLOG: - [vfio] pci: Include sparse mmap capability for MSI-X table regions (Tarun Gupta) [1116064]
Rebuild_FUZZ: 95.93%
commit-author Alex Williamson <alex.williamson@redhat.com>
commit 188ad9d6cbbce4a1d322ac208914a1dea34b30b6
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/188ad9d6.failed

vfio-pci has never allowed the user to directly mmap the MSI-X vector
table, but we've always relied on implicit knowledge of the user that
they cannot do this.  Now that we have capability chains that we can
expose in the region info ioctl and a sparse mmap capability that
represents the sub-areas within the region that can be mmap'd, we can
make the mmap constraints more explicit.

	Signed-off-by: Alex Williamson <alex.williamson@redhat.com>
(cherry picked from commit 188ad9d6cbbce4a1d322ac208914a1dea34b30b6)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/vfio/pci/vfio_pci.c
diff --cc drivers/vfio/pci/vfio_pci.c
index 2a0043c78806,4682207b1ac8..000000000000
--- a/drivers/vfio/pci/vfio_pci.c
+++ b/drivers/vfio/pci/vfio_pci.c
@@@ -546,8 -571,27 +597,32 @@@ static long vfio_pci_ioctl(void *device
  			return -EINVAL;
  		}
  
++<<<<<<< HEAD
 +		return copy_to_user((void __user *)arg, &info, minsz) ?
 +			-EFAULT : 0;
++=======
+ 		if (caps.size) {
+ 			info.flags |= VFIO_REGION_INFO_FLAG_CAPS;
+ 			if (info.argsz < sizeof(info) + caps.size) {
+ 				info.argsz = sizeof(info) + caps.size;
+ 				info.cap_offset = 0;
+ 			} else {
+ 				vfio_info_cap_shift(&caps, sizeof(info));
+ 				ret = copy_to_user((void __user *)arg +
+ 						   sizeof(info), caps.buf,
+ 						   caps.size);
+ 				if (ret) {
+ 					kfree(caps.buf);
+ 					return ret;
+ 				}
+ 				info.cap_offset = sizeof(info);
+ 			}
+ 
+ 			kfree(caps.buf);
+ 		}
+ 
+ 		return copy_to_user((void __user *)arg, &info, minsz);
++>>>>>>> 188ad9d6cbbc (vfio/pci: Include sparse mmap capability for MSI-X table regions)
  
  	} else if (cmd == VFIO_DEVICE_GET_IRQ_INFO) {
  		struct vfio_irq_info info;
* Unmerged path drivers/vfio/pci/vfio_pci.c
