net/sched: cls_flower: Hardware offloaded filters statistics support

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
Rebuild_CHGLOG: - [net] sched: cls_flower: Hardware offloaded filters statistics support (Jonathan Toppins) [1393375]
Rebuild_FUZZ: 96.97%
commit-author Amir Vadai <amirva@mellanox.com>
commit 10cbc6843446165ee250e1ee80dc19ee325f1e6d
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/10cbc684.failed

Introduce a new command in ndo_setup_tc() for hardware offloaded
filters, to call the NIC driver, and make it update the statistics.
This will be done before dumping the filter and its statistics.

	Signed-off-by: Amir Vadai <amirva@mellanox.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 10cbc6843446165ee250e1ee80dc19ee325f1e6d)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	include/net/pkt_cls.h
#	net/sched/cls_flower.c
diff --cc include/net/pkt_cls.h
index b606c03c3836,0f7efa88f210..000000000000
--- a/include/net/pkt_cls.h
+++ b/include/net/pkt_cls.h
@@@ -392,9 -392,50 +392,44 @@@ struct tc_cls_u32_offload 
  	};
  };
  
 -static inline bool tc_should_offload(struct net_device *dev, u32 flags)
 +static inline bool tc_should_offload(struct net_device *dev)
  {
 -	if (!(dev->features & NETIF_F_HW_TC))
 -		return false;
 -
 -	if (flags & TCA_CLS_FLAGS_SKIP_HW)
 -		return false;
 -
 -	if (!dev->netdev_ops->ndo_setup_tc)
 -		return false;
 -
 -	return true;
 +	return dev->netdev_ops->ndo_setup_tc;
  }
  
++<<<<<<< HEAD
++=======
+ static inline bool tc_skip_sw(u32 flags)
+ {
+ 	return (flags & TCA_CLS_FLAGS_SKIP_SW) ? true : false;
+ }
+ 
+ /* SKIP_HW and SKIP_SW are mutually exclusive flags. */
+ static inline bool tc_flags_valid(u32 flags)
+ {
+ 	if (flags & ~(TCA_CLS_FLAGS_SKIP_HW | TCA_CLS_FLAGS_SKIP_SW))
+ 		return false;
+ 
+ 	if (!(flags ^ (TCA_CLS_FLAGS_SKIP_HW | TCA_CLS_FLAGS_SKIP_SW)))
+ 		return false;
+ 
+ 	return true;
+ }
+ 
+ enum tc_fl_command {
+ 	TC_CLSFLOWER_REPLACE,
+ 	TC_CLSFLOWER_DESTROY,
+ 	TC_CLSFLOWER_STATS,
+ };
+ 
+ struct tc_cls_flower_offload {
+ 	enum tc_fl_command command;
+ 	unsigned long cookie;
+ 	struct flow_dissector *dissector;
+ 	struct fl_flow_key *mask;
+ 	struct fl_flow_key *key;
+ 	struct tcf_exts *exts;
+ };
+ 
++>>>>>>> 10cbc6843446 (net/sched: cls_flower: Hardware offloaded filters statistics support)
  #endif
* Unmerged path net/sched/cls_flower.c
* Unmerged path include/net/pkt_cls.h
* Unmerged path net/sched/cls_flower.c
