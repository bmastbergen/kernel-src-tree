KVM: x86: move nsec_to_cycles from x86.c to x86.h

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
commit-author Marcelo Tosatti <mtosatti@redhat.com>
commit 8d93c874ac899bfdf0ad3787baef684a0c878c2c
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/8d93c874.failed

Move the inline function nsec_to_cycles from x86.c to x86.h, as
the next patch uses it from lapic.c.

	Signed-off-by: Marcelo Tosatti <mtosatti@redhat.com>
	Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>
(cherry picked from commit 8d93c874ac899bfdf0ad3787baef684a0c878c2c)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/x86/kvm/x86.h
diff --cc arch/x86/kvm/x86.h
index c4ca2474e8c0,a82ca466b62e..000000000000
--- a/arch/x86/kvm/x86.h
+++ b/arch/x86/kvm/x86.h
@@@ -187,4 -195,25 +188,28 @@@ extern unsigned int min_timer_period_us
  extern unsigned int lapic_timer_advance_ns;
  
  extern struct static_key kvm_no_apic_vcpu;
++<<<<<<< HEAD
++=======
+ 
+ static inline u64 nsec_to_cycles(struct kvm_vcpu *vcpu, u64 nsec)
+ {
+ 	return pvclock_scale_delta(nsec, vcpu->arch.virtual_tsc_mult,
+ 				   vcpu->arch.virtual_tsc_shift);
+ }
+ 
+ /* Same "calling convention" as do_div:
+  * - divide (n << 32) by base
+  * - put result in n
+  * - return remainder
+  */
+ #define do_shl32_div32(n, base)					\
+ 	({							\
+ 	    u32 __quot, __rem;					\
+ 	    asm("divl %2" : "=a" (__quot), "=d" (__rem)		\
+ 			: "rm" (base), "0" (0), "1" ((u32) n));	\
+ 	    n = __quot;						\
+ 	    __rem;						\
+ 	 })
+ 
++>>>>>>> 8d93c874ac89 (KVM: x86: move nsec_to_cycles from x86.c to x86.h)
  #endif
diff --git a/arch/x86/kvm/x86.c b/arch/x86/kvm/x86.c
index 6036ab4b7587..c705563f9a9a 100644
--- a/arch/x86/kvm/x86.c
+++ b/arch/x86/kvm/x86.c
@@ -1225,12 +1225,6 @@ static atomic_t kvm_guest_has_master_clock = ATOMIC_INIT(0);
 static DEFINE_PER_CPU(unsigned long, cpu_tsc_khz);
 static unsigned long max_tsc_khz;
 
-static inline u64 nsec_to_cycles(struct kvm_vcpu *vcpu, u64 nsec)
-{
-	return pvclock_scale_delta(nsec, vcpu->arch.virtual_tsc_mult,
-				   vcpu->arch.virtual_tsc_shift);
-}
-
 static u32 adjust_tsc_khz(u32 khz, s32 ppm)
 {
 	u64 v = (u64)khz * (1000000 + ppm);
* Unmerged path arch/x86/kvm/x86.h
