vxlan/geneve: Include udp_tunnel.h in vxlan/geneve.h and fixup includes

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
commit-author Alexander Duyck <aduyck@mirantis.com>
commit 86a98057256020e75e1be0f88d7617491a06e8f1
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/86a98057.failed

This patch makes it so that we add udp_tunnel.h to vxlan.h and geneve.h
header files.  This is useful as I plan to move the generic handlers for
the port offloads into the udp_tunnel header file and leave the vxlan and
geneve headers to be a bit more protocol specific.

I also went through and cleaned out a number of redundant includes that
where in the .h and .c files for these drivers.

	Signed-off-by: Alexander Duyck <aduyck@mirantis.com>
	Acked-by: Hannes Frederic Sowa <hannes@stressinduktion.org>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 86a98057256020e75e1be0f88d7617491a06e8f1)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	include/net/udp_tunnel.h
diff --cc include/net/udp_tunnel.h
index fdc50733c4fe,59019562d14c..000000000000
--- a/include/net/udp_tunnel.h
+++ b/include/net/udp_tunnel.h
@@@ -105,14 -105,14 +105,20 @@@ struct metadata_dst *udp_tun_rx_dst(str
  				    __be16 flags, __be64 tunnel_id,
  				    int md_size);
  
++<<<<<<< HEAD
 +static inline struct sk_buff *udp_tunnel_handle_offloads(struct sk_buff *skb,
 +							 bool udp_csum)
++=======
+ #ifdef CONFIG_INET
+ static inline int udp_tunnel_handle_offloads(struct sk_buff *skb, bool udp_csum)
++>>>>>>> 86a980572560 (vxlan/geneve: Include udp_tunnel.h in vxlan/geneve.h and fixup includes)
  {
  	int type = udp_csum ? SKB_GSO_UDP_TUNNEL_CSUM : SKB_GSO_UDP_TUNNEL;
  
 -	return iptunnel_handle_offloads(skb, type);
 +	/* As we're a UDP tunnel, we support LCO, so don't need csum_help */
 +	return iptunnel_handle_offloads(skb, false, type);
  }
+ #endif
  
  static inline void udp_tunnel_encap_enable(struct socket *sock)
  {
diff --git a/drivers/net/geneve.c b/drivers/net/geneve.c
index 3313e1d18e40..a373e329abb0 100644
--- a/drivers/net/geneve.c
+++ b/drivers/net/geneve.c
@@ -12,7 +12,6 @@
 
 #include <linux/kernel.h>
 #include <linux/module.h>
-#include <linux/netdevice.h>
 #include <linux/etherdevice.h>
 #include <linux/hash.h>
 #include <net/dst_metadata.h>
diff --git a/drivers/net/vxlan.c b/drivers/net/vxlan.c
index 8f88cba29f1a..fe42e62a7371 100644
--- a/drivers/net/vxlan.c
+++ b/drivers/net/vxlan.c
@@ -11,32 +11,18 @@
 #define pr_fmt(fmt) KBUILD_MODNAME ": " fmt
 
 #include <linux/kernel.h>
-#include <linux/types.h>
 #include <linux/module.h>
 #include <linux/errno.h>
 #include <linux/slab.h>
-#include <linux/skbuff.h>
-#include <linux/rculist.h>
-#include <linux/netdevice.h>
-#include <linux/in.h>
-#include <linux/ip.h>
 #include <linux/udp.h>
 #include <linux/igmp.h>
-#include <linux/etherdevice.h>
 #include <linux/if_ether.h>
-#include <linux/if_vlan.h>
-#include <linux/hash.h>
 #include <linux/ethtool.h>
 #include <net/arp.h>
 #include <net/ndisc.h>
 #include <net/ip.h>
-#include <net/ip_tunnels.h>
 #include <net/icmp.h>
-#include <net/udp.h>
-#include <net/udp_tunnel.h>
 #include <net/rtnetlink.h>
-#include <net/route.h>
-#include <net/dsfield.h>
 #include <net/inet_ecn.h>
 #include <net/net_namespace.h>
 #include <net/netns/generic.h>
@@ -44,12 +30,9 @@
 #include <net/protocol.h>
 
 #if IS_ENABLED(CONFIG_IPV6)
-#include <net/ipv6.h>
-#include <net/addrconf.h>
 #include <net/ip6_tunnel.h>
 #include <net/ip6_checksum.h>
 #endif
-#include <net/dst_metadata.h>
 
 #define VXLAN_VERSION	"0.1"
 
diff --git a/include/net/geneve.h b/include/net/geneve.h
index a3163ec068ae..30cad16f0813 100644
--- a/include/net/geneve.h
+++ b/include/net/geneve.h
@@ -1,10 +1,7 @@
 #ifndef __NET_GENEVE_H
 #define __NET_GENEVE_H  1
 
-#ifdef CONFIG_INET
 #include <net/udp_tunnel.h>
-#endif
-
 
 /* Geneve Header:
  *  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
* Unmerged path include/net/udp_tunnel.h
diff --git a/include/net/vxlan.h b/include/net/vxlan.h
index d243713534f5..61b8e7a1e26b 100644
--- a/include/net/vxlan.h
+++ b/include/net/vxlan.h
@@ -1,12 +1,8 @@
 #ifndef __NET_VXLAN_H
 #define __NET_VXLAN_H 1
 
-#include <linux/ip.h>
-#include <linux/ipv6.h>
 #include <linux/if_vlan.h>
-#include <linux/skbuff.h>
-#include <linux/netdevice.h>
-#include <linux/udp.h>
+#include <net/udp_tunnel.h>
 #include <net/dst_metadata.h>
 
 /* VXLAN protocol (RFC 7348) header:
