KVM: nVMX: do not leak PML full vmexit to L1

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
commit-author Ladi Prosek <lprosek@redhat.com>
commit ab007cc94ff9d82f5a8db8363b3becbd946e58cf
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/ab007cc9.failed

The PML feature is not exposed to guests so we should not be forwarding
the vmexit either.

This commit fixes BSOD 0x20001 (HYPERVISOR_ERROR) when running Hyper-V
enabled Windows Server 2016 in L1 on hardware that supports PML.

Fixes: 843e4330573c ("KVM: VMX: Add PML support in VMX")
	Signed-off-by: Ladi Prosek <lprosek@redhat.com>
	Reviewed-by: David Hildenbrand <david@redhat.com>
	Signed-off-by: Radim Krčmář <rkrcmar@redhat.com>
(cherry picked from commit ab007cc94ff9d82f5a8db8363b3becbd946e58cf)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/x86/kvm/vmx.c
diff --cc arch/x86/kvm/vmx.c
index b93d99117399,605183291069..000000000000
--- a/arch/x86/kvm/vmx.c
+++ b/arch/x86/kvm/vmx.c
@@@ -7798,6 -8188,19 +7798,22 @@@ static bool nested_vmx_exit_handled(str
  		return nested_cpu_has2(vmcs12, SECONDARY_EXEC_WBINVD_EXITING);
  	case EXIT_REASON_XSETBV:
  		return true;
++<<<<<<< HEAD
++=======
+ 	case EXIT_REASON_XSAVES: case EXIT_REASON_XRSTORS:
+ 		/*
+ 		 * This should never happen, since it is not possible to
+ 		 * set XSS to a non-zero value---neither in L1 nor in L2.
+ 		 * If if it were, XSS would have to be checked against
+ 		 * the XSS exit bitmap in vmcs12.
+ 		 */
+ 		return nested_cpu_has2(vmcs12, SECONDARY_EXEC_XSAVES);
+ 	case EXIT_REASON_PREEMPTION_TIMER:
+ 		return false;
+ 	case EXIT_REASON_PML_FULL:
+ 		/* We don't expose PML support to L1. */
+ 		return false;
++>>>>>>> ab007cc94ff9 (KVM: nVMX: do not leak PML full vmexit to L1)
  	default:
  		return true;
  	}
* Unmerged path arch/x86/kvm/vmx.c
