net/mlx5: Use fte status to decide on firmware command

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
Rebuild_CHGLOG: - [netdrv] mlx5: Use fte status to decide on firmware command (Don Dutile) [1385330 1417286]
Rebuild_FUZZ: 96.15%
commit-author Mark Bloch <markb@mellanox.com>
commit 0501fc477c2bed1cce02acbc22d79418bfa2c8c3
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/0501fc47.failed

An fte status becomes FS_FTE_STATUS_EXISTING only after it was
created in HW. We can use this in order to simplify the logic on
what firmware command to use. If the status isn't FS_FTE_STATUS_EXISTING
we need to create the fte, otherwise we need only to update it.

	Signed-off-by: Mark Bloch <markb@mellanox.com>
	Signed-off-by: Saeed Mahameed <saeedm@mellanox.com>
	Signed-off-by: Leon Romanovsky <leon@kernel.org>
(cherry picked from commit 0501fc477c2bed1cce02acbc22d79418bfa2c8c3)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/mellanox/mlx5/core/fs_core.c
diff --cc drivers/net/ethernet/mellanox/mlx5/core/fs_core.c
index 2b09736a91c6,e2bab9d09acb..000000000000
--- a/drivers/net/ethernet/mellanox/mlx5/core/fs_core.c
+++ b/drivers/net/ethernet/mellanox/mlx5/core/fs_core.c
@@@ -881,9 -938,15 +881,19 @@@ static struct mlx5_flow_rule *add_rule_
  		list_add(&rule->node.list, &fte->node.children);
  	else
  		list_add_tail(&rule->node.list, &fte->node.children);
 -	if (dest) {
 +	if (dest)
  		fte->dests_size++;
++<<<<<<< HEAD
 +	if (fte->dests_size == 1 || !dest)
++=======
+ 
+ 		modify_mask |= dest->type == MLX5_FLOW_DESTINATION_TYPE_COUNTER ?
+ 			BIT(MLX5_SET_FTE_MODIFY_ENABLE_MASK_FLOW_COUNTERS) :
+ 			BIT(MLX5_SET_FTE_MODIFY_ENABLE_MASK_DESTINATION_LIST);
+ 	}
+ 
+ 	if (!(fte->status & FS_FTE_STATUS_EXISTING))
++>>>>>>> 0501fc477c2b (net/mlx5: Use fte status to decide on firmware command)
  		err = mlx5_cmd_create_fte(get_dev(&ft->node),
  					  ft, fg->id, fte);
  	else
* Unmerged path drivers/net/ethernet/mellanox/mlx5/core/fs_core.c
