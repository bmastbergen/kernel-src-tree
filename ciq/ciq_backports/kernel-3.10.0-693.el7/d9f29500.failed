Revert "NFS: nfs_rename() handle -ERESTARTSYS dentry left behind"

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
commit-author Benjamin Coddington <bcodding@redhat.com>
commit d9f2950006f110f54444a10442752372ee568289
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/d9f29500.failed

This reverts commit 920b4530fb80430ff30ef83efe21ba1fa5623731 which could
call d_move() without holding the directory's i_mutex, and reverts commit
d4ea7e3c5c0e341c15b073016dbf3ab6c65f12f3 "NFS: Fix old dentry rehash after
move", which was a follow-up fix.

	Signed-off-by: Benjamin Coddington <bcodding@redhat.com>
Fixes: 920b4530fb80 ("NFS: nfs_rename() handle -ERESTARTSYS dentry left behind")
	Cc: stable@vger.kernel.org # v4.10+
	Reviewed-by: Jeff Layton <jlayton@redhat.com>
	Signed-off-by: Trond Myklebust <trond.myklebust@primarydata.com>
(cherry picked from commit d9f2950006f110f54444a10442752372ee568289)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	fs/nfs/dir.c
diff --cc fs/nfs/dir.c
index 770fe7b74079,2ac00bf4ecf1..000000000000
--- a/fs/nfs/dir.c
+++ b/fs/nfs/dir.c
@@@ -2014,10 -1971,11 +1991,15 @@@ EXPORT_SYMBOL_GPL(nfs_link)
   * the rename.
   */
  int nfs_rename(struct inode *old_dir, struct dentry *old_dentry,
 -	       struct inode *new_dir, struct dentry *new_dentry,
 -	       unsigned int flags)
 +		      struct inode *new_dir, struct dentry *new_dentry)
  {
++<<<<<<< HEAD
 +	struct inode *old_inode = old_dentry->d_inode;
 +	struct inode *new_inode = new_dentry->d_inode;
++=======
+ 	struct inode *old_inode = d_inode(old_dentry);
+ 	struct inode *new_inode = d_inode(new_dentry);
++>>>>>>> d9f2950006f1 (Revert "NFS: nfs_rename() handle -ERESTARTSYS dentry left behind")
  	struct dentry *dentry = NULL, *rehash = NULL;
  	struct rpc_task *task;
  	int error = -EBUSY;
* Unmerged path fs/nfs/dir.c
