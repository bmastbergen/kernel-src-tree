dm stripe: add DAX support

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
commit-author Toshi Kani <toshi.kani@hpe.com>
commit beec25b4573bc310f5a12cf33207b20ecc30945c
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/beec25b4.failed

Change dm-stripe to implement direct_access function,
stripe_direct_access(), which maps bdev and sector and
calls direct_access function of its physical target device.

	Signed-off-by: Toshi Kani <toshi.kani@hpe.com>
	Signed-off-by: Mike Snitzer <snitzer@redhat.com>
(cherry picked from commit beec25b4573bc310f5a12cf33207b20ecc30945c)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/md/dm-stripe.c
diff --cc drivers/md/dm-stripe.c
index a79fc8a35b66,01bb9cf2a8c2..000000000000
--- a/drivers/md/dm-stripe.c
+++ b/drivers/md/dm-stripe.c
@@@ -411,29 -437,9 +434,29 @@@ static void stripe_io_hints(struct dm_t
  	blk_limits_io_opt(limits, chunk_size * sc->stripes);
  }
  
 +static int stripe_merge(struct dm_target *ti, struct bvec_merge_data *bvm,
 +			struct bio_vec *biovec, int max_size)
 +{
 +	struct stripe_c *sc = ti->private;
 +	sector_t bvm_sector = bvm->bi_sector;
 +	uint32_t stripe;
 +	struct request_queue *q;
 +
 +	stripe_map_sector(sc, bvm_sector, &stripe, &bvm_sector);
 +
 +	q = bdev_get_queue(sc->stripe[stripe].dev->bdev);
 +	if (!q->merge_bvec_fn)
 +		return max_size;
 +
 +	bvm->bi_bdev = sc->stripe[stripe].dev->bdev;
 +	bvm->bi_sector = sc->stripe[stripe].physical_start + bvm_sector;
 +
 +	return min(max_size, q->merge_bvec_fn(q, bvm, biovec));
 +}
 +
  static struct target_type stripe_target = {
  	.name   = "striped",
- 	.version = {1, 5, 1},
+ 	.version = {1, 6, 0},
  	.module = THIS_MODULE,
  	.ctr    = stripe_ctr,
  	.dtr    = stripe_dtr,
@@@ -442,7 -448,7 +465,11 @@@
  	.status = stripe_status,
  	.iterate_devices = stripe_iterate_devices,
  	.io_hints = stripe_io_hints,
++<<<<<<< HEAD
 +	.merge  = stripe_merge,
++=======
+ 	.direct_access = stripe_direct_access,
++>>>>>>> beec25b4573b (dm stripe: add DAX support)
  };
  
  int __init dm_stripe_init(void)
* Unmerged path drivers/md/dm-stripe.c
