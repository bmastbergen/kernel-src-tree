drm/amdgpu/pm: check for headless before calling compute_clocks

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
Rebuild_CHGLOG: - [drm] amdgpu/pm: check for headless before calling compute_clocks (Rob Clark) [1422186]
Rebuild_FUZZ: 96.72%
commit-author Alex Deucher <alexander.deucher@amd.com>
commit c10c8f7c27103bd7ac02d041d9d6e97296d48fc1
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/c10c8f7c.failed

Don't update display bandwidth on headless asics.

bug:
https://bugs.freedesktop.org/show_bug.cgi?id=99387

	Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
	Cc: stable@vger.kernel.org
(cherry picked from commit c10c8f7c27103bd7ac02d041d9d6e97296d48fc1)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/gpu/drm/amd/amdgpu/amdgpu_pm.c
diff --cc drivers/gpu/drm/amd/amdgpu/amdgpu_pm.c
index ff9597ce268c,346e80a7119b..000000000000
--- a/drivers/gpu/drm/amd/amdgpu/amdgpu_pm.c
+++ b/drivers/gpu/drm/amd/amdgpu/amdgpu_pm.c
@@@ -1142,16 -1296,16 +1142,28 @@@ void amdgpu_pm_compute_clocks(struct am
  	if (!adev->pm.dpm_enabled)
  		return;
  
++<<<<<<< HEAD
++=======
+ 	if (adev->mode_info.num_crtc)
+ 		amdgpu_display_bandwidth_update(adev);
+ 
+ 	for (i = 0; i < AMDGPU_MAX_RINGS; i++) {
+ 		struct amdgpu_ring *ring = adev->rings[i];
+ 		if (ring && ring->ready)
+ 			amdgpu_fence_wait_empty(ring);
+ 	}
+ 
++>>>>>>> c10c8f7c2710 (drm/amdgpu/pm: check for headless before calling compute_clocks)
  	if (adev->pp_enabled) {
 +		int i = 0;
 +
 +		amdgpu_display_bandwidth_update(adev);
 +		for (i = 0; i < AMDGPU_MAX_RINGS; i++) {
 +			struct amdgpu_ring *ring = adev->rings[i];
 +			if (ring && ring->ready)
 +				amdgpu_fence_wait_empty(ring);
 +		}
 +
  		amdgpu_dpm_dispatch_task(adev, AMD_PP_EVENT_DISPLAY_CONFIG_CHANGE, NULL, NULL);
  	} else {
  		mutex_lock(&adev->pm.mutex);
* Unmerged path drivers/gpu/drm/amd/amdgpu/amdgpu_pm.c
