amd-xgbe: Use __napi_schedule_irqoff

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
commit-author Lendacky, Thomas <Thomas.Lendacky@amd.com>
commit 793494228fdf15acb252063f9f6dcccd3d1d497e
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/79349422.failed

Change from calling __napi_schedule to __napi_schedule_irqoff when running
in interrupt context or when called by netpoll with interrupts already
disabled. The Tx timer function will continue to use __napi_schedule.

	Signed-off-by: Tom Lendacky <thomas.lendacky@amd.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 793494228fdf15acb252063f9f6dcccd3d1d497e)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/amd/xgbe/xgbe-drv.c
diff --cc drivers/net/ethernet/amd/xgbe/xgbe-drv.c
index d58e85811bc9,80ef4041e7a3..000000000000
--- a/drivers/net/ethernet/amd/xgbe/xgbe-drv.c
+++ b/drivers/net/ethernet/amd/xgbe/xgbe-drv.c
@@@ -264,14 -397,29 +264,36 @@@ isr_done
  	return IRQ_HANDLED;
  }
  
 -static irqreturn_t xgbe_dma_isr(int irq, void *data)
 +static enum hrtimer_restart xgbe_tx_timer(struct hrtimer *timer)
  {
++<<<<<<< HEAD
 +	struct xgbe_channel *channel = container_of(timer,
 +						    struct xgbe_channel,
 +						    tx_timer);
 +	struct xgbe_ring *ring = channel->tx_ring;
++=======
+ 	struct xgbe_channel *channel = data;
+ 
+ 	/* Per channel DMA interrupts are enabled, so we use the per
+ 	 * channel napi structure and not the private data napi structure
+ 	 */
+ 	if (napi_schedule_prep(&channel->napi)) {
+ 		/* Disable Tx and Rx interrupts */
+ 		disable_irq_nosync(channel->dma_irq);
+ 
+ 		/* Turn on polling */
+ 		__napi_schedule_irqoff(&channel->napi);
+ 	}
+ 
+ 	return IRQ_HANDLED;
+ }
+ 
+ static void xgbe_tx_timer(unsigned long data)
+ {
+ 	struct xgbe_channel *channel = (struct xgbe_channel *)data;
++>>>>>>> 793494228fdf (amd-xgbe: Use __napi_schedule_irqoff)
  	struct xgbe_prv_data *pdata = channel->pdata;
 -	struct napi_struct *napi;
 +	unsigned long flags;
  
  	DBGPR("-->xgbe_tx_timer\n");
  
* Unmerged path drivers/net/ethernet/amd/xgbe/xgbe-drv.c
