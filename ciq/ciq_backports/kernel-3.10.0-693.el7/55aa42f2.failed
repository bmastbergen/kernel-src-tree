efifb: prevent null-deref when iterating dmi_list

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
commit-author James Bates <james.h.bates@gmail.com>
commit 55aa42f2e690157e254a6a6989f5f4ac928b35c8
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/55aa42f2.failed

The dmi_list array is initialized using gnu designated initializers, and
therefore may contain fewer explicitly defined entries as there are
elements in it. This is because the enum above with M_xyz constants
contains more items than the designated initializer. Those elements not
explicitly initialized are implicitly set to 0.

Now efifb_setup() loops through all these array elements, and performs
a strcmp on each item. For non explicitly initialized elements this will
be a null pointer:

This patch swaps the check order in the if statement, thus checks first
whether dmi_list[i].base is null.

	Signed-off-by: James Bates <james.h.bates@gmail.com>
	Signed-off-by: David Herrmann <dh.herrmann@gmail.com>
	Signed-off-by: Tomi Valkeinen <tomi.valkeinen@ti.com>
(cherry picked from commit 55aa42f2e690157e254a6a6989f5f4ac928b35c8)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/video/efifb.c
diff --cc drivers/video/efifb.c
index 50fe668c6172,fcb950031246..000000000000
--- a/drivers/video/efifb.c
+++ b/drivers/video/efifb.c
@@@ -323,12 -108,12 +323,21 @@@ static int __init efifb_setup(char *opt
  			if (!*this_opt) continue;
  
  			for (i = 0; i < M_UNKNOWN; i++) {
++<<<<<<< HEAD
 +				if (!strcmp(this_opt, dmi_list[i].optname) &&
 +				    dmi_list[i].base != 0) {
 +					screen_info.lfb_base = dmi_list[i].base;
 +					screen_info.lfb_linelength = dmi_list[i].stride;
 +					screen_info.lfb_width = dmi_list[i].width;
 +					screen_info.lfb_height = dmi_list[i].height;
++=======
+ 				if (efifb_dmi_list[i].base != 0 &&
+ 				    !strcmp(this_opt, efifb_dmi_list[i].optname)) {
+ 					screen_info.lfb_base = efifb_dmi_list[i].base;
+ 					screen_info.lfb_linelength = efifb_dmi_list[i].stride;
+ 					screen_info.lfb_width = efifb_dmi_list[i].width;
+ 					screen_info.lfb_height = efifb_dmi_list[i].height;
++>>>>>>> 55aa42f2e690 (efifb: prevent null-deref when iterating dmi_list)
  				}
  			}
  			if (!strncmp(this_opt, "base:", 5))
* Unmerged path drivers/video/efifb.c
