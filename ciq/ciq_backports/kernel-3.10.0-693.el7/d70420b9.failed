Input: wacom - use a uniq name for the battery device

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
commit-author Benjamin Tissoires <benjamin.tissoires@redhat.com>
commit d70420b914c98a3758674c6e9858810e0ab4ea30
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/d70420b9.failed

The current implementation uses "wacom_battery" as a generic name for
batteries. This prevents us to have two Wacom devices with a battery
attached as the power system will complain about the name which is already
registered.

Use an incremental name for each battery attached.

Related bug:
https://sourceforge.net/p/linuxwacom/bugs/248/

	Signed-off-by: Benjamin Tissoires <benjamin.tissoires@redhat.com>
	Acked-by: Przemo Firszt <przemo@firszt.eu>
	Acked-by: Ping Cheng <pingc@wacom.com>
	Signed-off-by: Dmitry Torokhov <dmitry.torokhov@gmail.com>
(cherry picked from commit d70420b914c98a3758674c6e9858810e0ab4ea30)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/hid/wacom_sys.c
#	drivers/hid/wacom_wac.h
diff --cc drivers/hid/wacom_sys.c
index 527bf559d1db,a27404d6e98d..000000000000
--- a/drivers/hid/wacom_sys.c
+++ b/drivers/hid/wacom_sys.c
@@@ -1098,8 -809,11 +1098,15 @@@ static int wacom_battery_get_property(s
  static int wacom_initialize_battery(struct wacom *wacom)
  {
  	int error = 0;
+ 	static atomic_t battery_no = ATOMIC_INIT(0);
+ 	unsigned long n;
  
++<<<<<<< HEAD
 +	if (wacom->wacom_wac.features.quirks & WACOM_QUIRK_MONITOR) {
++=======
+ 	if (wacom->wacom_wac.features.quirks & WACOM_QUIRK_BATTERY) {
+ 		n = atomic_inc_return(&battery_no) - 1;
++>>>>>>> d70420b914c9 (Input: wacom - use a uniq name for the battery device)
  		wacom->battery.properties = wacom_battery_props;
  		wacom->battery.num_properties = ARRAY_SIZE(wacom_battery_props);
  		wacom->battery.get_property = wacom_battery_get_property;
diff --cc drivers/hid/wacom_wac.h
index d220d069f329,6cdf707821cd..000000000000
--- a/drivers/hid/wacom_wac.h
+++ b/drivers/hid/wacom_wac.h
@@@ -139,7 -153,9 +139,13 @@@ struct wacom_shared 
  
  struct wacom_wac {
  	char name[WACOM_NAME_MAX];
++<<<<<<< HEAD
 +	unsigned char *data;
++=======
+ 	char pad_name[WACOM_NAME_MAX];
+ 	char bat_name[WACOM_NAME_MAX];
+ 	unsigned char data[WACOM_PKGLEN_MAX];
++>>>>>>> d70420b914c9 (Input: wacom - use a uniq name for the battery device)
  	int tool[2];
  	int id[2];
  	__u32 serial[2];
* Unmerged path drivers/hid/wacom_sys.c
* Unmerged path drivers/hid/wacom_wac.h
