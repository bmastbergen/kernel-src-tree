IB/srpt: Fix srpt_handle_cmd() error paths

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
commit-author Bart Van Assche <bart.vanassche@sandisk.com>
commit 2c7f37ff1c33087b8a4567730ebb128e8572da5e
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/2c7f37ff.failed

The target core function that should be called if target_submit_cmd()
fails is target_put_sess_cmd(). Additionally, change the return type
of srpt_handle_cmd() from int into void.

	Signed-off-by: Bart Van Assche <bart.vanassche@sandisk.com>
	Reviewed-by: Christoph Hellwig <hch@lst.de>
	Reviewed-by: Alex Estrin <alex.estrin@intel.com>
	Cc: Sagi Grimberg <sagig@mellanox.com>
	Signed-off-by: Doug Ledford <dledford@redhat.com>
(cherry picked from commit 2c7f37ff1c33087b8a4567730ebb128e8572da5e)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/infiniband/ulp/srpt/ib_srpt.c
diff --cc drivers/infiniband/ulp/srpt/ib_srpt.c
index a4661b2c9df4,5b0fbc1bfce2..000000000000
--- a/drivers/infiniband/ulp/srpt/ib_srpt.c
+++ b/drivers/infiniband/ulp/srpt/ib_srpt.c
@@@ -93,7 -91,7 +93,11 @@@ MODULE_PARM_DESC(srpt_service_guid
  		 " instead of using the node_guid of the first HCA.");
  
  static struct ib_client srpt_client;
++<<<<<<< HEAD
 +static struct target_fabric_configfs *srpt_target;
++=======
+ static void srpt_release_cmd(struct se_cmd *se_cmd);
++>>>>>>> 2c7f37ff1c33 (IB/srpt: Fix srpt_handle_cmd() error paths)
  static void srpt_release_channel(struct srpt_rdma_ch *ch);
  static int srpt_queue_status(struct se_cmd *cmd);
  static void srpt_recv_done(struct ib_cq *cq, struct ib_wc *wc);
@@@ -1529,10 -1526,9 +1532,9 @@@ static void srpt_handle_cmd(struct srpt
  	}
  
  	if (srpt_get_desc_tbl(send_ioctx, srp_cmd, &dir, &data_len)) {
 -		pr_err("0x%llx: parsing SRP descriptor table failed.\n",
 +		printk(KERN_ERR "0x%llx: parsing SRP descriptor table failed.\n",
  		       srp_cmd->tag);
- 		ret = TCM_INVALID_CDB_FIELD;
- 		goto send_sense;
+ 		goto release_ioctx;
  	}
  
  	rc = target_submit_cmd(cmd, ch->sess, srp_cmd->cdb,
* Unmerged path drivers/infiniband/ulp/srpt/ib_srpt.c
