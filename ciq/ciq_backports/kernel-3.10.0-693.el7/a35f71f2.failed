net/mlx5: E-Switch, Implement promiscuous rx modes vf request handling

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
Rebuild_CHGLOG: - [netdrv] mlx5: E-Switch, Implement promiscuous rx modes vf request handling (Don Dutile) [1383280 1417284]
Rebuild_FUZZ: 97.06%
commit-author Mohamad Haj Yahia <mohamad@mellanox.com>
commit a35f71f27a614aff106cc89b86168962bce2725f
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/a35f71f2.failed

Add promisc_change as a trigger to vport context change event.
Add set vport promisc/allmulti functions to add vport to promiscuous
flowtable rules.
Upon promisc/allmulti rx mode vf request add the vport to
the relevant promiscuous group (Allmulti/Promisc group) so the relevant
traffic will be forwarded to it.
Upon allmulti vf request add the vport to each existing multicast fdb
rule.
Upon adding/removing mcast address from a vport, update all other
allmulti vports.

	Signed-off-by: Mohamad Haj Yahia <mohamad@mellanox.com>
	Signed-off-by: Saeed Mahameed <saeedm@mellanox.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit a35f71f27a614aff106cc89b86168962bce2725f)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/mellanox/mlx5/core/eswitch.c
#	drivers/net/ethernet/mellanox/mlx5/core/eswitch.h
diff --cc drivers/net/ethernet/mellanox/mlx5/core/eswitch.c
index 079c11f2567c,ad4bc985cc43..000000000000
--- a/drivers/net/ethernet/mellanox/mlx5/core/eswitch.c
+++ b/drivers/net/ethernet/mellanox/mlx5/core/eswitch.c
@@@ -1304,7 -1603,8 +1552,12 @@@ void mlx5_eswitch_disable_sriov(struct 
  int mlx5_eswitch_init(struct mlx5_core_dev *dev)
  {
  	int l2_table_size = 1 << MLX5_CAP_GEN(dev, log_max_l2_table);
++<<<<<<< HEAD
 +	int total_vports = 1 + pci_sriov_get_totalvfs(dev->pdev);
++=======
+ 	int total_vports = MLX5_TOTAL_VPORTS(dev);
+ 	struct esw_mc_addr *mc_promisc;
++>>>>>>> a35f71f27a61 (net/mlx5: E-Switch, Implement promiscuous rx modes vf request handling)
  	struct mlx5_eswitch *esw;
  	int vport_num;
  	int err;
diff --cc drivers/net/ethernet/mellanox/mlx5/core/eswitch.h
index 6f9da7b7d506,a39f18e3bd18..000000000000
--- a/drivers/net/ethernet/mellanox/mlx5/core/eswitch.h
+++ b/drivers/net/ethernet/mellanox/mlx5/core/eswitch.h
@@@ -118,6 -120,8 +120,11 @@@ struct mlx5_vport 
  
  	u16                     vlan;
  	u8                      qos;
++<<<<<<< HEAD
++=======
+ 	bool                    spoofchk;
+ 	bool                    trusted;
++>>>>>>> a35f71f27a61 (net/mlx5: E-Switch, Implement promiscuous rx modes vf request handling)
  	bool                    enabled;
  	u16                     enabled_events;
  };
* Unmerged path drivers/net/ethernet/mellanox/mlx5/core/eswitch.c
* Unmerged path drivers/net/ethernet/mellanox/mlx5/core/eswitch.h
