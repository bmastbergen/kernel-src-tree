switchdev: bridge: Check return code is not EOPNOTSUPP

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
commit-author Ido Schimmel <idosch@mellanox.com>
commit bbe14f54297467ddb23b7d1db564a2468c6ae151
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/bbe14f54.failed

When NET_SWITCHDEV=n, switchdev_port_attr_set simply returns EOPNOTSUPP.
In this case we should not emit errors and warnings to the kernel log.

	Reported-by: Sander Eikelenboom <linux@eikelenboom.it>
	Tested-by: Christian Borntraeger <borntraeger@de.ibm.com>
Fixes: 0bc05d585d38 ("switchdev: allow caller to explicitly request
attr_set as deferred")
Fixes: 6ac311ae8bfb ("Adding switchdev ageing notification on port
bridged")
	Signed-off-by: Ido Schimmel <idosch@mellanox.com>
	Signed-off-by: Jiri Pirko <jiri@mellanox.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit bbe14f54297467ddb23b7d1db564a2468c6ae151)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/bridge/br_stp.c
diff --cc net/bridge/br_stp.c
index 48a6519f8bc7,5f3f64553179..000000000000
--- a/net/bridge/br_stp.c
+++ b/net/bridge/br_stp.c
@@@ -38,7 -39,18 +38,14 @@@ void br_log_state(const struct net_brid
  
  void br_set_state(struct net_bridge_port *p, unsigned int state)
  {
 -	struct switchdev_attr attr = {
 -		.id = SWITCHDEV_ATTR_ID_PORT_STP_STATE,
 -		.flags = SWITCHDEV_F_DEFER,
 -		.u.stp_state = state,
 -	};
 -	int err;
 -
  	p->state = state;
++<<<<<<< HEAD
++=======
+ 	err = switchdev_port_attr_set(p->dev, &attr);
+ 	if (err && err != -EOPNOTSUPP)
+ 		br_warn(p->br, "error setting offload STP state on port %u(%s)\n",
+ 				(unsigned int) p->port_no, p->dev->name);
++>>>>>>> bbe14f542974 (switchdev: bridge: Check return code is not EOPNOTSUPP)
  }
  
  /* called under bridge lock */
* Unmerged path net/bridge/br_stp.c
diff --git a/net/bridge/br_stp_if.c b/net/bridge/br_stp_if.c
index 44b80532c4a0..5c4b04e45ffe 100644
--- a/net/bridge/br_stp_if.c
+++ b/net/bridge/br_stp_if.c
@@ -50,7 +50,7 @@ void br_init_port(struct net_bridge_port *p)
 	p->config_pending = 0;
 
 	err = switchdev_port_attr_set(p->dev, &attr);
-	if (err)
+	if (err && err != -EOPNOTSUPP)
 		netdev_err(p->dev, "failed to set HW ageing time\n");
 }
 
