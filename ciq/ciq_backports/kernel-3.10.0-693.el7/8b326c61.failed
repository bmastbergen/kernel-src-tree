ovl: copy_up_xattr(): use strnlen

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
commit-author Miklos Szeredi <mszeredi@redhat.com>
commit 8b326c61de08f5ca4bc454a168f19e7e43c4cc2a
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/8b326c61.failed

Be defensive about what underlying fs provides us in the returned xattr
list buffer.  strlen() may overrun the buffer, so use strnlen() and WARN if
the contents are not properly null terminated.

	Signed-off-by: Miklos Szeredi <mszeredi@redhat.com>
	Cc: <stable@vger.kernel.org>
(cherry picked from commit 8b326c61de08f5ca4bc454a168f19e7e43c4cc2a)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	fs/overlayfs/copy_up.c
diff --cc fs/overlayfs/copy_up.c
index 7aec041555ef,abadbc30e013..000000000000
--- a/fs/overlayfs/copy_up.c
+++ b/fs/overlayfs/copy_up.c
@@@ -79,7 -80,18 +80,22 @@@ int ovl_copy_xattr(struct dentry *old, 
  		goto out;
  	}
  
++<<<<<<< HEAD
 +	for (name = buf; name < (buf + list_size); name += strlen(name) + 1) {
++=======
+ 	for (name = buf; list_size; name += slen) {
+ 		slen = strnlen(name, list_size) + 1;
+ 
+ 		/* underlying fs providing us with an broken xattr list? */
+ 		if (WARN_ON(slen > list_size)) {
+ 			error = -EIO;
+ 			break;
+ 		}
+ 		list_size -= slen;
+ 
+ 		if (ovl_is_private_xattr(name))
+ 			continue;
++>>>>>>> 8b326c61de08 (ovl: copy_up_xattr(): use strnlen)
  retry:
  		size = vfs_getxattr(old, name, value, value_size);
  		if (size == -ERANGE)
* Unmerged path fs/overlayfs/copy_up.c
