md/raid1: fix a use-after-free bug

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
Rebuild_CHGLOG: - [md] raid1: fix a use-after-free bug (Xiao Ni) [1379764]
Rebuild_FUZZ: 95.38%
commit-author Shaohua Li <shli@fb.com>
commit af5f42a7e426a87bfa69adc9b9d8930385a1ddf6
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/af5f42a7.failed

Commit fd76863 (RAID1: a new I/O barrier implementation to remove resync
window) introduces a user-after-free bug.

	Signed-off-by: Shaohua Li <shli@fb.com>
(cherry picked from commit af5f42a7e426a87bfa69adc9b9d8930385a1ddf6)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/md/raid1.c
diff --cc drivers/md/raid1.c
index e588c32492da,2e5e4805cbe1..000000000000
--- a/drivers/md/raid1.c
+++ b/drivers/md/raid1.c
@@@ -209,7 -214,7 +210,11 @@@ static void put_buf(struct r1bio *r1_bi
  
  	mempool_free(r1_bio, conf->r1buf_pool);
  
++<<<<<<< HEAD
 +	lower_barrier(conf);
++=======
+ 	lower_barrier(conf, sect);
++>>>>>>> af5f42a7e426 (md/raid1: fix a use-after-free bug)
  }
  
  static void reschedule_retry(struct r1bio *r1_bio)
* Unmerged path drivers/md/raid1.c
