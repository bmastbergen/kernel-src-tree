kvmclock: export kvmclock clocksource and data pointers

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
Rebuild_CHGLOG: - [x86] kvmclock: export kvmclock clocksource pointer (Marcelo Tosatti) [1419783]
Rebuild_FUZZ: 90.00%
commit-author Marcelo Tosatti <mtosatti@redhat.com>
commit f4066c2bc4d0de4e5dcbff21dae41e89fe8f38c0
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/f4066c2b.failed

To be used by KVM PTP driver.

	Signed-off-by: Marcelo Tosatti <mtosatti@redhat.com>
	Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>
(cherry picked from commit f4066c2bc4d0de4e5dcbff21dae41e89fe8f38c0)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/x86/kernel/kvmclock.c
diff --cc arch/x86/kernel/kvmclock.c
index 2def10d14fa6,995fa260a6da..000000000000
--- a/arch/x86/kernel/kvmclock.c
+++ b/arch/x86/kernel/kvmclock.c
@@@ -28,11 -28,12 +28,12 @@@
  
  #include <asm/x86_init.h>
  #include <asm/reboot.h>
+ #include <asm/kvmclock.h>
  
 -static int kvmclock __ro_after_init = 1;
 +static int kvmclock = 1;
  static int msr_kvm_system_time = MSR_KVM_SYSTEM_TIME;
  static int msr_kvm_wall_clock = MSR_KVM_WALL_CLOCK;
 -static u64 kvm_sched_clock_offset;
 +static cycle_t kvm_sched_clock_offset;
  
  static int parse_no_kvmclock(char *arg)
  {
@@@ -45,6 -46,12 +46,15 @@@ early_param("no-kvmclock", parse_no_kvm
  static struct pvclock_vsyscall_time_info *hv_clock;
  static struct pvclock_wall_clock wall_clock;
  
++<<<<<<< HEAD
++=======
+ struct pvclock_vsyscall_time_info *pvclock_pvti_cpu0_va(void)
+ {
+ 	return hv_clock;
+ }
+ EXPORT_SYMBOL_GPL(pvclock_pvti_cpu0_va);
+ 
++>>>>>>> f4066c2bc4d0 (kvmclock: export kvmclock clocksource and data pointers)
  /*
   * The wallclock is the time of day when we booted. Since then, some time may
   * have elapsed since the hypervisor wrote the data. So we try to account for
diff --git a/arch/x86/include/asm/kvmclock.h b/arch/x86/include/asm/kvmclock.h
new file mode 100644
index 000000000000..f260bef63591
--- /dev/null
+++ b/arch/x86/include/asm/kvmclock.h
@@ -0,0 +1,6 @@
+#ifndef _ASM_X86_KVM_CLOCK_H
+#define _ASM_X86_KVM_CLOCK_H
+
+extern struct clocksource kvm_clock;
+
+#endif /* _ASM_X86_KVM_CLOCK_H */
* Unmerged path arch/x86/kernel/kvmclock.c
