NFS: Don't let readdirplus revalidate an inode that was marked as stale

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
commit-author Trond Myklebust <trond.myklebust@primarydata.com>
commit d8fdb47fae5febc02e62da121f85625244b98b2e
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/d8fdb47f.failed

	Signed-off-by: Trond Myklebust <trond.myklebust@primarydata.com>
	Signed-off-by: Anna Schumaker <Anna.Schumaker@Netapp.com>
(cherry picked from commit d8fdb47fae5febc02e62da121f85625244b98b2e)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	fs/nfs/dir.c
diff --cc fs/nfs/dir.c
index 8cabfa5feb35,a924d66b5608..000000000000
--- a/fs/nfs/dir.c
+++ b/fs/nfs/dir.c
@@@ -413,12 -424,17 +413,21 @@@ static int xdr_decode(nfs_readdir_descr
  static
  int nfs_same_file(struct dentry *dentry, struct nfs_entry *entry)
  {
+ 	struct inode *inode;
  	struct nfs_inode *nfsi;
  
 -	if (d_really_is_negative(dentry))
 -		return 0;
 +	if (dentry->d_inode == NULL)
 +		goto different;
  
++<<<<<<< HEAD
 +	nfsi = NFS_I(dentry->d_inode);
++=======
+ 	inode = d_inode(dentry);
+ 	if (is_bad_inode(inode) || NFS_STALE(inode))
+ 		return 0;
+ 
+ 	nfsi = NFS_I(inode);
++>>>>>>> d8fdb47fae5f (NFS: Don't let readdirplus revalidate an inode that was marked as stale)
  	if (entry->fattr->fileid == nfsi->fileid)
  		return 1;
  	if (nfs_compare_fh(entry->fh, &nfsi->fh) == 0)
* Unmerged path fs/nfs/dir.c
