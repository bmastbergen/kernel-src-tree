net: bridge: allow IPv6 when multicast flood is disabled

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
Rebuild_CHGLOG: - [net] bridge: allow IPv6 when multicast flood is disabled (Ivan Vecera) [1464167]
Rebuild_FUZZ: 95.33%
commit-author Mike Manning <mmanning@brocade.com>
commit 8953de2f02ad7b15e4964c82f9afd60f128e4e98
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/8953de2f.failed

Even with multicast flooding turned off, IPv6 ND should still work so
that IPv6 connectivity is provided. Allow this by continuing to flood
multicast traffic originated by us.

Fixes: b6cb5ac8331b ("net: bridge: add per-port multicast flood flag")
	Cc: Nikolay Aleksandrov <nikolay@cumulusnetworks.com>
	Signed-off-by: Mike Manning <mmanning@brocade.com>
	Acked-by: Nikolay Aleksandrov <nikolay@cumulusnetworks.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 8953de2f02ad7b15e4964c82f9afd60f128e4e98)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/bridge/br_forward.c
diff --cc net/bridge/br_forward.c
index 20c11b41fe6a,902af6ba481c..000000000000
--- a/net/bridge/br_forward.c
+++ b/net/bridge/br_forward.c
@@@ -203,11 -184,26 +203,27 @@@ static void br_flood(struct net_bridge 
  
  	list_for_each_entry_rcu(p, &br->port_list, list) {
  		/* Do not flood unicast traffic to ports that turn it off */
 -		if (pkt_type == BR_PKT_UNICAST && !(p->flags & BR_FLOOD))
 +		if (unicast && !(p->flags & BR_FLOOD))
  			continue;
++<<<<<<< HEAD
 +		prev = maybe_deliver(prev, p, skb, __packet_hook);
++=======
+ 		/* Do not flood if mc off, except for traffic we originate */
+ 		if (pkt_type == BR_PKT_MULTICAST &&
+ 		    !(p->flags & BR_MCAST_FLOOD) && skb->dev != br->dev)
+ 			continue;
+ 
+ 		/* Do not flood to ports that enable proxy ARP */
+ 		if (p->flags & BR_PROXYARP)
+ 			continue;
+ 		if ((p->flags & BR_PROXYARP_WIFI) &&
+ 		    BR_INPUT_SKB_CB(skb)->proxyarp_replied)
+ 			continue;
+ 
+ 		prev = maybe_deliver(prev, p, skb, local_orig);
++>>>>>>> 8953de2f02ad (net: bridge: allow IPv6 when multicast flood is disabled)
  		if (IS_ERR(prev))
  			goto out;
 -		if (prev == p)
 -			br_multicast_count(p->br, p, skb, igmp_type,
 -					   BR_MCAST_DIR_TX);
  	}
  
  	if (!prev)
* Unmerged path net/bridge/br_forward.c
