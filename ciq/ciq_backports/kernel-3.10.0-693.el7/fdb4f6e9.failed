powerpc/pseries: Remove call to memblock_add()

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
Rebuild_CHGLOG: - [powerpc] pseries: Remove call to memblock_add() (Thomas Huth) [1323417]
Rebuild_FUZZ: 90.48%
commit-author Nathan Fontenot <nfont@linux.vnet.ibm.com>
commit fdb4f6e99ffacfa643ab2d2da99171b3084d4446
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/fdb4f6e9.failed

The call to memblock_add is not needed, this is already done by
memory_add(). This patch removes this call which shrinks
dlpar_add_lmb_memory() enough that it can be merged into dlpar_add_lmb().

	Signed-off-by: Nathan Fontenot <nfont@linux.vnet.ibm.com>
	Signed-off-by: Michael Ellerman <mpe@ellerman.id.au>
(cherry picked from commit fdb4f6e99ffacfa643ab2d2da99171b3084d4446)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/powerpc/platforms/pseries/hotplug-memory.c
diff --cc arch/powerpc/platforms/pseries/hotplug-memory.c
index a96025209e16,43f7beb2902d..000000000000
--- a/arch/powerpc/platforms/pseries/hotplug-memory.c
+++ b/arch/powerpc/platforms/pseries/hotplug-memory.c
@@@ -607,50 -588,11 +607,53 @@@ static int dlpar_memory_remove_by_index
  
  #endif /* CONFIG_MEMORY_HOTREMOVE */
  
- static int dlpar_add_lmb_memory(struct of_drconf_cell *lmb)
+ static int dlpar_add_lmb(struct of_drconf_cell *lmb)
  {
 +	struct memory_block *mem_block;
  	unsigned long block_sz;
  	int nid, rc;
  
++<<<<<<< HEAD
 +	block_sz = memory_block_size_bytes();
 +
 +	/* Find the node id for this address */
 +	nid = memory_add_physaddr_to_nid(lmb->base_addr);
 +
 +	/* Add the memory */
 +	rc = add_memory(nid, lmb->base_addr, block_sz);
 +	if (rc)
 +		return rc;
 +
 +	/* Register this block of memory */
 +	rc = memblock_add(lmb->base_addr, block_sz);
 +	if (rc) {
 +		remove_memory(nid, lmb->base_addr, block_sz);
 +		return rc;
 +	}
 +
 +	mem_block = lmb_to_memblock(lmb);
 +	if (!mem_block) {
 +		remove_memory(nid, lmb->base_addr, block_sz);
 +		return -EINVAL;
 +	}
 +
 +	rc = device_online(&mem_block->dev);
 +	put_device(&mem_block->dev);
 +	if (rc) {
 +		remove_memory(nid, lmb->base_addr, block_sz);
 +		return rc;
 +	}
 +
 +	lmb->flags |= DRCONF_MEM_ASSIGNED;
 +	return 0;
 +}
 +
 +static int dlpar_add_lmb(struct of_drconf_cell *lmb)
 +{
 +	int rc;
 +
++=======
++>>>>>>> fdb4f6e99ffa (powerpc/pseries: Remove call to memblock_add())
  	if (lmb->flags & DRCONF_MEM_ASSIGNED)
  		return -EINVAL;
  
* Unmerged path arch/powerpc/platforms/pseries/hotplug-memory.c
