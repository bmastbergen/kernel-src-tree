drm/i915/lspcon: Enable AUX interrupts for resume time initialization

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
Rebuild_CHGLOG: - [drm] i915/lspcon: Enable AUX interrupts for resume time initialization (Rob Clark) [1422186]
Rebuild_FUZZ: 97.01%
commit-author Imre Deak <imre.deak@intel.com>
commit 908764f6d0bd1ba496cb8da33b9b98297ed27351
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/908764f6.failed

For LSPCON initialization during system resume we need AUX
functionality, but we call the corresponding encoder reset hook with all
interrupts disabled. Without interrupts we'll do a poll-wait for AUX
transfer completions, which adds a significant delay if the transfers
timeout/need to be retried for some reason.

Fix this by enabling interrupts before calling the reset hooks. Note
that while this will enable AUX interrupts it will keep HPD interrupts
disabled, in a similar way to the init time output setup code.

This issue existed since LSPCON support was added.

v2:
- Rebased on drm-tip.

	Cc: Shashank Sharma <shashank.sharma@intel.com>
	Signed-off-by: Imre Deak <imre.deak@intel.com>
	Reviewed-by: Ville Syrjälä <ville.syrjala@linux.intel.com>
	Tested-by: David Weinehall <david.weinehall@linux.intel.com>
Link: http://patchwork.freedesktop.org/patch/msgid/1480448429-27739-1-git-send-email-imre.deak@intel.com
(cherry picked from commit 908764f6d0bd1ba496cb8da33b9b98297ed27351)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/gpu/drm/i915/i915_drv.c
diff --cc drivers/gpu/drm/i915/i915_drv.c
index e47a02f4ec43,89af78eb5c32..000000000000
--- a/drivers/gpu/drm/i915/i915_drv.c
+++ b/drivers/gpu/drm/i915/i915_drv.c
@@@ -721,19 -1556,25 +721,23 @@@ int i915_suspend_switcheroo(struct drm_
  
  static int i915_drm_resume(struct drm_device *dev)
  {
 -	struct drm_i915_private *dev_priv = to_i915(dev);
 -	int ret;
 +	struct drm_i915_private *dev_priv = dev->dev_private;
  
  	disable_rpm_wakeref_asserts(dev_priv);
 -	intel_sanitize_gt_powersave(dev_priv);
 -
 -	ret = i915_ggtt_enable_hw(dev_priv);
 -	if (ret)
 -		DRM_ERROR("failed to re-enable GGTT\n");
  
 -	intel_csr_ucode_resume(dev_priv);
 -
 -	i915_gem_resume(dev);
 +	mutex_lock(&dev->struct_mutex);
 +	i915_gem_restore_gtt_mappings(dev);
 +	mutex_unlock(&dev->struct_mutex);
  
  	i915_restore_state(dev);
 -	intel_pps_unlock_regs_wa(dev_priv);
 -	intel_opregion_setup(dev_priv);
 +	intel_opregion_setup(dev);
  
++<<<<<<< HEAD
 +	intel_init_pch_refclk(dev);
 +	drm_mode_config_reset(dev);
++=======
+ 	intel_init_pch_refclk(dev_priv);
++>>>>>>> 908764f6d0bd (drm/i915/lspcon: Enable AUX interrupts for resume time initialization)
  
  	/*
  	 * Interrupts have to be enabled before any batches are run. If not the
* Unmerged path drivers/gpu/drm/i915/i915_drv.c
