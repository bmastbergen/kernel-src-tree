qla2xxx: Remove sysfs node fw_dump_template.

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-693.el7
Rebuild_CHGLOG: - [scsi] qla2xxx: Remove sysfs node fw_dump_template (Chad Dupuis) [1384091]
Rebuild_FUZZ: 98.85%
commit-author Joe Carnuccio <joe.carnuccio@qlogic.com>
commit f1d7ce65c9003a8e027a8745adc74b550da3ab16
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-693.el7/f1d7ce65.failed

	Signed-off-by: Joe Carnuccio <joe.carnuccio@qlogic.com>
	Signed-off-by: Himanshu Madhani <himanshu.madhani@qlogic.com>
	Reviewed-by: Hannes Reinecke <hare@suse.com>
	Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
(cherry picked from commit f1d7ce65c9003a8e027a8745adc74b550da3ab16)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/scsi/qla2xxx/qla_attr.c
diff --cc drivers/scsi/qla2xxx/qla_attr.c
index 47ea1643e6d4,c9bcd82f08bc..000000000000
--- a/drivers/scsi/qla2xxx/qla_attr.c
+++ b/drivers/scsi/qla2xxx/qla_attr.c
@@@ -147,92 -147,6 +147,95 @@@ static struct bin_attribute sysfs_fw_du
  };
  
  static ssize_t
++<<<<<<< HEAD
 +qla2x00_sysfs_read_fw_dump_template(struct file *filp, struct kobject *kobj,
 +			   struct bin_attribute *bin_attr,
 +			   char *buf, loff_t off, size_t count)
 +{
 +	struct scsi_qla_host *vha = shost_priv(dev_to_shost(container_of(kobj,
 +	    struct device, kobj)));
 +	struct qla_hw_data *ha = vha->hw;
 +
 +	if (!ha->fw_dump_template || !ha->fw_dump_template_len)
 +		return 0;
 +
 +	ql_dbg(ql_dbg_user, vha, 0x70e2,
 +	    "chunk <- off=%llx count=%lx\n", off, count);
 +	return memory_read_from_buffer(buf, count, &off,
 +	    ha->fw_dump_template, ha->fw_dump_template_len);
 +}
 +
 +static ssize_t
 +qla2x00_sysfs_write_fw_dump_template(struct file *filp, struct kobject *kobj,
 +			    struct bin_attribute *bin_attr,
 +			    char *buf, loff_t off, size_t count)
 +{
 +	struct scsi_qla_host *vha = shost_priv(dev_to_shost(container_of(kobj,
 +	    struct device, kobj)));
 +	struct qla_hw_data *ha = vha->hw;
 +	uint32_t size;
 +
 +	if (off == 0) {
 +		if (ha->fw_dump)
 +			vfree(ha->fw_dump);
 +		if (ha->fw_dump_template)
 +			vfree(ha->fw_dump_template);
 +
 +		ha->fw_dump = NULL;
 +		ha->fw_dump_len = 0;
 +		ha->fw_dump_template = NULL;
 +		ha->fw_dump_template_len = 0;
 +
 +		size = qla27xx_fwdt_template_size(buf);
 +		ql_dbg(ql_dbg_user, vha, 0x70d1,
 +		    "-> allocating fwdt (%x bytes)...\n", size);
 +		ha->fw_dump_template = vmalloc(size);
 +		if (!ha->fw_dump_template) {
 +			ql_log(ql_log_warn, vha, 0x70d2,
 +			    "Failed allocate fwdt (%x bytes).\n", size);
 +			return -ENOMEM;
 +		}
 +		ha->fw_dump_template_len = size;
 +	}
 +
 +	if (off + count > ha->fw_dump_template_len) {
 +		count = ha->fw_dump_template_len - off;
 +		ql_dbg(ql_dbg_user, vha, 0x70d3,
 +		    "chunk -> truncating to %lx bytes.\n", count);
 +	}
 +
 +	ql_dbg(ql_dbg_user, vha, 0x70d4,
 +	    "chunk -> off=%llx count=%lx\n", off, count);
 +	memcpy(ha->fw_dump_template + off, buf, count);
 +
 +	if (off + count == ha->fw_dump_template_len) {
 +		size = qla27xx_fwdt_calculate_dump_size(vha);
 +		ql_dbg(ql_dbg_user, vha, 0x70d5,
 +		    "-> allocating fwdump (%x bytes)...\n", size);
 +		ha->fw_dump = vmalloc(size);
 +		if (!ha->fw_dump) {
 +			ql_log(ql_log_warn, vha, 0x70d6,
 +			    "Failed allocate fwdump (%x bytes).\n", size);
 +			return -ENOMEM;
 +		}
 +		ha->fw_dump_len = size;
 +	}
 +
 +	return count;
 +}
 +static struct bin_attribute sysfs_fw_dump_template_attr = {
 +	.attr = {
 +		.name = "fw_dump_template",
 +		.mode = S_IRUSR | S_IWUSR,
 +	},
 +	.size = 0,
 +	.read = qla2x00_sysfs_read_fw_dump_template,
 +	.write = qla2x00_sysfs_write_fw_dump_template,
 +};
 +
 +static ssize_t
++=======
++>>>>>>> f1d7ce65c900 (qla2xxx: Remove sysfs node fw_dump_template.)
  qla2x00_sysfs_read_nvram(struct file *filp, struct kobject *kobj,
  			 struct bin_attribute *bin_attr,
  			 char *buf, loff_t off, size_t count)
* Unmerged path drivers/scsi/qla2xxx/qla_attr.c
diff --git a/drivers/scsi/qla2xxx/qla_dbg.c b/drivers/scsi/qla2xxx/qla_dbg.c
index ad3345b48ba5..1acc9818426c 100644
--- a/drivers/scsi/qla2xxx/qla_dbg.c
+++ b/drivers/scsi/qla2xxx/qla_dbg.c
@@ -40,6 +40,7 @@
  * |                              |                    | 0x70a5-0x70a6  |
  * |                              |                    | 0x70a8,0x70ab  |
  * |                              |                    | 0x70ad-0x70ae  |
+ * |                              |                    | 0x70d0-0x70d6	|
  * |                              |                    | 0x70d7-0x70db  |
  * |                              |                    | 0x70de-0x70df  |
  * | Task Management              |       0x803d       | 0x8000,0x800b  |
