target/fcoe: Add tag support to tcm_fc

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
commit-author Andy Grover <agrover@redhat.com>
commit 091b70623e2b9caee1c27190c3a5614b3563a672
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/091b7062.failed

Add the 'tag' attribute to FC node ACLs. This is not used by kernel code,
but gives userspace a place to store a tag string. This is used to provide
support for initiator groups in targetcli.

Just copy iscsi's implementation for tcm_fc. A few other fabrics that
support acls also need this, to be submitted separately after the holidays.

	Signed-off-by: Andy Grover <agrover@redhat.com>
	Signed-off-by: Nicholas Bellinger <nab@linux-iscsi.org>
(cherry picked from commit 091b70623e2b9caee1c27190c3a5614b3563a672)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/target/tcm_fc/tfc_conf.c
diff --cc drivers/target/tcm_fc/tfc_conf.c
index 8f5b91a74d09,9cdb2acfd626..000000000000
--- a/drivers/target/tcm_fc/tfc_conf.c
+++ b/drivers/target/tcm_fc/tfc_conf.c
@@@ -182,11 -168,34 +182,38 @@@ static ssize_t ft_nacl_store_node_name
  	return ft_wwn_store(&acl->node_auth.node_name, page, count);
  }
  
 -CONFIGFS_ATTR(ft_nacl_, node_name);
 -CONFIGFS_ATTR(ft_nacl_, port_name);
 +TF_NACL_BASE_ATTR(ft, node_name, S_IRUGO | S_IWUSR);
  
+ static ssize_t ft_nacl_tag_show(struct config_item *item,
+ 		char *page)
+ {
+ 	return snprintf(page, PAGE_SIZE, "%s", acl_to_nacl(item)->acl_tag);
+ }
+ 
+ static ssize_t ft_nacl_tag_store(struct config_item *item,
+ 		const char *page, size_t count)
+ {
+ 	struct se_node_acl *se_nacl = acl_to_nacl(item);
+ 	int ret;
+ 
+ 	ret = core_tpg_set_initiator_node_tag(se_nacl->se_tpg, se_nacl, page);
+ 
+ 	if (ret < 0)
+ 		return ret;
+ 	return count;
+ }
+ 
+ CONFIGFS_ATTR(ft_nacl_, tag);
+ 
  static struct configfs_attribute *ft_nacl_base_attrs[] = {
++<<<<<<< HEAD
 +	&ft_nacl_port_name.attr,
 +	&ft_nacl_node_name.attr,
++=======
+ 	&ft_nacl_attr_port_name,
+ 	&ft_nacl_attr_node_name,
+ 	&ft_nacl_attr_tag,
++>>>>>>> 091b70623e2b (target/fcoe: Add tag support to tcm_fc)
  	NULL,
  };
  
* Unmerged path drivers/target/tcm_fc/tfc_conf.c
