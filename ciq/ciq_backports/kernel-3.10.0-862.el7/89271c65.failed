s390/qeth: fix underestimated count of buffer elements

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
Rebuild_CHGLOG: - [s390] qeth: fix underestimated count of buffer elements (Hendrik Brueckner) [1544698]
Rebuild_FUZZ: 95.15%
commit-author Ursula Braun <ubraun@linux.vnet.ibm.com>
commit 89271c65edd599207dd982007900506283c90ae3
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/89271c65.failed

For a memory range/skb where the last byte falls onto a page boundary
(ie. 'end' is of the form xxx...xxx001), the PFN_UP() part of the
calculation currently doesn't round up to the next PFN due to an
off-by-one error.
Thus qeth believes that the skb occupies one page less than it
actually does, and may select a IO buffer that doesn't have enough spare
buffer elements to fit all of the skb's data.
HW detects this as a malformed buffer descriptor, and raises an
exception which then triggers device recovery.

Fixes: 2863c61334aa ("qeth: refactor calculation of SBALE count")
	Signed-off-by: Ursula Braun <ubraun@linux.vnet.ibm.com>
	Signed-off-by: Julian Wiedmann <jwi@linux.vnet.ibm.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 89271c65edd599207dd982007900506283c90ae3)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/s390/net/qeth_core.h
diff --cc drivers/s390/net/qeth_core.h
index 89c842ea1533,c33fbc4c2e91..000000000000
--- a/drivers/s390/net/qeth_core.h
+++ b/drivers/s390/net/qeth_core.h
@@@ -846,11 -836,17 +846,15 @@@ struct qeth_trap_id 
  /*some helper functions*/
  #define QETH_CARD_IFNAME(card) (((card)->dev)? (card)->dev->name : "")
  
 -/**
 - * qeth_get_elements_for_range() -	find number of SBALEs to cover range.
 - * @start:				Start of the address range.
 - * @end:				Address after the end of the range.
 - *
 - * Returns the number of pages, and thus QDIO buffer elements, needed to cover
 - * the specified address range.
 - */
 -static inline int qeth_get_elements_for_range(addr_t start, addr_t end)
 +static inline struct qeth_card *CARD_FROM_CDEV(struct ccw_device *cdev)
  {
++<<<<<<< HEAD
 +	struct qeth_card *card = dev_get_drvdata(&((struct ccwgroup_device *)
 +		dev_get_drvdata(&cdev->dev))->dev);
 +	return card;
++=======
+ 	return PFN_UP(end) - PFN_DOWN(start);
++>>>>>>> 89271c65edd5 (s390/qeth: fix underestimated count of buffer elements)
  }
  
  static inline int qeth_get_micros(void)
* Unmerged path drivers/s390/net/qeth_core.h
