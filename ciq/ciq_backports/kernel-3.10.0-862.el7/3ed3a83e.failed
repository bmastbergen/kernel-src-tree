bnxt_en: Fix DMA unmapping of the RX buffers in XDP mode during shutdown.

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
Rebuild_CHGLOG: - [netdrv] bnxt_en: Fix DMA unmapping of the RX buffers in XDP mode during shutdown (Jonathan Toppins) [1459659]
Rebuild_FUZZ: 99.31%
commit-author Michael Chan <michael.chan@broadcom.com>
commit 3ed3a83e3f3871c57b18cef09b148e96921236ed
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/3ed3a83e.failed

In bnxt_free_rx_skbs(), which is called to free up all RX buffers during
shutdown, we need to unmap the page if we are running in XDP mode.

Fixes: c61fb99cae51 ("bnxt_en: Add RX page mode support.")
	Signed-off-by: Michael Chan <michael.chan@broadcom.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 3ed3a83e3f3871c57b18cef09b148e96921236ed)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/broadcom/bnxt/bnxt.c
diff --cc drivers/net/ethernet/broadcom/bnxt/bnxt.c
index 0dfdab3588c4,1f1e54ba0ecb..000000000000
--- a/drivers/net/ethernet/broadcom/bnxt/bnxt.c
+++ b/drivers/net/ethernet/broadcom/bnxt/bnxt.c
@@@ -1900,12 -1989,19 +1901,23 @@@ static void bnxt_free_rx_skbs(struct bn
  			if (!data)
  				continue;
  
- 			dma_unmap_single(&pdev->dev, rx_buf->mapping,
- 					 bp->rx_buf_use_size, bp->rx_dir);
- 
  			rx_buf->data = NULL;
  
++<<<<<<< HEAD
 +			kfree(data);
++=======
+ 			if (BNXT_RX_PAGE_MODE(bp)) {
+ 				mapping -= bp->rx_dma_offset;
+ 				dma_unmap_page(&pdev->dev, mapping,
+ 					       PAGE_SIZE, bp->rx_dir);
+ 				__free_page(data);
+ 			} else {
+ 				dma_unmap_single(&pdev->dev, mapping,
+ 						 bp->rx_buf_use_size,
+ 						 bp->rx_dir);
+ 				kfree(data);
+ 			}
++>>>>>>> 3ed3a83e3f38 (bnxt_en: Fix DMA unmapping of the RX buffers in XDP mode during shutdown.)
  		}
  
  		for (j = 0; j < max_agg_idx; j++) {
* Unmerged path drivers/net/ethernet/broadcom/bnxt/bnxt.c
