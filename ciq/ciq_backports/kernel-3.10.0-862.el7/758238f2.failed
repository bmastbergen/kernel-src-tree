nfp: app callbacks for SRIOV

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
commit-author Simon Horman <simon.horman@netronome.com>
commit 758238f2e7a645630c3fead7577c3fa5a36c6ad7
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/758238f2.failed

Add app-callbacks for app-specific initialisation of SRIOV.

Disabling SRIOV is brought forward in nfp_pci_remove()
so that nfp_app_sriov_disable is called while the app still exists.

This is intended to be used to implement representor netdevs for virtual
ports.

	Signed-off-by: Simon Horman <simon.horman@netronome.com>
	Reviewed-by: Jakub Kicinski <jakub.kicinski@netronome.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 758238f2e7a645630c3fead7577c3fa5a36c6ad7)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/netronome/nfp/nfp_app.h
#	drivers/net/ethernet/netronome/nfp/nfp_main.c
diff --cc drivers/net/ethernet/netronome/nfp/nfp_main.c
index 813e29b99369,748e54cc885e..000000000000
--- a/drivers/net/ethernet/netronome/nfp/nfp_main.c
+++ b/drivers/net/ethernet/netronome/nfp/nfp_main.c
@@@ -396,12 -457,21 +428,19 @@@ err_pci_disable
  static void nfp_pci_remove(struct pci_dev *pdev)
  {
  	struct nfp_pf *pf = pci_get_drvdata(pdev);
 -	struct devlink *devlink;
 -
 -	nfp_hwmon_unregister(pf);
 -
 -	devlink = priv_to_devlink(pf);
  
- 	nfp_net_pci_remove(pf);
- 
  	nfp_pcie_sriov_disable(pdev);
  	pci_sriov_set_totalvfs(pf->pdev, 0);
  
++<<<<<<< HEAD
++=======
+ 	nfp_net_pci_remove(pf);
+ 
+ 	devlink_unregister(devlink);
+ 
+ 	kfree(pf->rtbl);
+ 	nfp_mip_close(pf->mip);
++>>>>>>> 758238f2e7a6 (nfp: app callbacks for SRIOV)
  	if (pf->fw_loaded)
  		nfp_fw_unload(pf);
  
* Unmerged path drivers/net/ethernet/netronome/nfp/nfp_app.h
* Unmerged path drivers/net/ethernet/netronome/nfp/nfp_app.h
* Unmerged path drivers/net/ethernet/netronome/nfp/nfp_main.c
