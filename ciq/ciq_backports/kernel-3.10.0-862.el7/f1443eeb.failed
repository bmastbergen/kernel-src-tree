qla2xxx: Add async new target notification

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
commit-author Quinn Tran <quinn.tran@cavium.com>
commit f1443eebca7792b3b8b41b27652d67ddc5d31fa2
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/f1443eeb.failed

	Signed-off-by: Quinn Tran <quinn.tran@cavium.com>
	Signed-off-by: Himanshu Madhani <himanshu.madhani@cavium.com>
	Signed-off-by: Nicholas Bellinger <nab@linux-iscsi.org>
(cherry picked from commit f1443eebca7792b3b8b41b27652d67ddc5d31fa2)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/scsi/qla2xxx/qla_target.h
diff --cc drivers/scsi/qla2xxx/qla_target.h
index b33e411f28a0,d64420251194..000000000000
--- a/drivers/scsi/qla2xxx/qla_target.h
+++ b/drivers/scsi/qla2xxx/qla_target.h
@@@ -645,18 -679,21 +645,27 @@@ struct qla_tgt_func_tmpl 
  			uint32_t);
  	void (*free_cmd)(struct qla_tgt_cmd *);
  	void (*free_mcmd)(struct qla_tgt_mgmt_cmd *);
 -	void (*free_session)(struct fc_port *);
 +	void (*free_session)(struct qla_tgt_sess *);
  
  	int (*check_initiator_node_acl)(struct scsi_qla_host *, unsigned char *,
 -					struct fc_port *);
 -	void (*update_sess)(struct fc_port *, port_id_t, uint16_t, bool);
 -	struct fc_port *(*find_sess_by_loop_id)(struct scsi_qla_host *,
 +					void *, uint8_t *, uint16_t);
 +	void (*update_sess)(struct qla_tgt_sess *, port_id_t, uint16_t, bool);
 +	struct qla_tgt_sess *(*find_sess_by_loop_id)(struct scsi_qla_host *,
  						const uint16_t);
 -	struct fc_port *(*find_sess_by_s_id)(struct scsi_qla_host *,
 +	struct qla_tgt_sess *(*find_sess_by_s_id)(struct scsi_qla_host *,
  						const uint8_t *);
++<<<<<<< HEAD
 +	void (*clear_nacl_from_fcport_map)(struct qla_tgt_sess *);
 +	void (*put_sess)(struct qla_tgt_sess *);
 +	void (*shutdown_sess)(struct qla_tgt_sess *);
++=======
+ 	void (*clear_nacl_from_fcport_map)(struct fc_port *);
+ 	void (*put_sess)(struct fc_port *);
+ 	void (*shutdown_sess)(struct fc_port *);
+ 	int (*get_dif_tags)(struct qla_tgt_cmd *cmd, uint16_t *pfw_prot_opts);
+ 	int (*chk_dif_tags)(uint32_t tag);
+ 	void (*add_target)(struct scsi_qla_host *);
++>>>>>>> f1443eebca77 (qla2xxx: Add async new target notification)
  };
  
  int qla2x00_wait_for_hba_online(struct scsi_qla_host *);
diff --git a/drivers/scsi/qla2xxx/qla_target.c b/drivers/scsi/qla2xxx/qla_target.c
index f10c075d97ef..641a3ae96d84 100644
--- a/drivers/scsi/qla2xxx/qla_target.c
+++ b/drivers/scsi/qla2xxx/qla_target.c
@@ -4339,6 +4339,9 @@ int qlt_add_target(struct qla_hw_data *ha, struct scsi_qla_host *base_vha)
 	list_add_tail(&tgt->tgt_list_entry, &qla_tgt_glist);
 	mutex_unlock(&qla_tgt_mutex);
 
+	if (ha->tgt.tgt_ops && ha->tgt.tgt_ops->add_target)
+		ha->tgt.tgt_ops->add_target(base_vha);
+
 	return 0;
 }
 
* Unmerged path drivers/scsi/qla2xxx/qla_target.h
