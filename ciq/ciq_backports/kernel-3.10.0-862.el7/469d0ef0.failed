nvme-fc: move remote port get/put/free location

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
commit-author James Smart <jsmart2021@gmail.com>
commit 469d0ef06debe29ec60350b9976a520c4ad5a1e8
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/469d0ef0.failed

move nvme_fc_rport_get/put and rport free to higher in the file to
avoid adding prototypes to resolve references in upcoming code additions

	Signed-off-by: James Smart <james.smart@broadcom.com>
	Signed-off-by: Christoph Hellwig <hch@lst.de>
(cherry picked from commit 469d0ef06debe29ec60350b9976a520c4ad5a1e8)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/nvme/host/fc.c
diff --cc drivers/nvme/host/fc.c
index 3d6f5a15d0aa,b8e0822127c1..000000000000
--- a/drivers/nvme/host/fc.c
+++ b/drivers/nvme/host/fc.c
@@@ -548,43 -607,28 +587,68 @@@ out_reghost_failed
  }
  EXPORT_SYMBOL_GPL(nvme_fc_register_remoteport);
  
++<<<<<<< HEAD
 +static void
 +nvme_fc_free_rport(struct kref *ref)
 +{
 +	struct nvme_fc_rport *rport =
 +		container_of(ref, struct nvme_fc_rport, ref);
 +	struct nvme_fc_lport *lport =
 +			localport_to_lport(rport->remoteport.localport);
 +	unsigned long flags;
 +
 +	WARN_ON(rport->remoteport.port_state != FC_OBJSTATE_DELETED);
 +	WARN_ON(!list_empty(&rport->ctrl_list));
 +
 +	/* remove from lport list */
 +	spin_lock_irqsave(&nvme_fc_lock, flags);
 +	list_del(&rport->endp_list);
 +	spin_unlock_irqrestore(&nvme_fc_lock, flags);
 +
 +	/* let the LLDD know we've finished tearing it down */
 +	lport->ops->remoteport_delete(&rport->remoteport);
 +
 +	ida_simple_remove(&lport->endp_cnt, rport->remoteport.port_num);
 +
 +	kfree(rport);
 +
 +	nvme_fc_lport_put(lport);
 +}
 +
 +static void
 +nvme_fc_rport_put(struct nvme_fc_rport *rport)
 +{
 +	kref_put(&rport->ref, nvme_fc_free_rport);
 +}
 +
 +static int
 +nvme_fc_rport_get(struct nvme_fc_rport *rport)
 +{
 +	return kref_get_unless_zero(&rport->ref);
++=======
+ static int
+ nvme_fc_abort_lsops(struct nvme_fc_rport *rport)
+ {
+ 	struct nvmefc_ls_req_op *lsop;
+ 	unsigned long flags;
+ 
+ restart:
+ 	spin_lock_irqsave(&rport->lock, flags);
+ 
+ 	list_for_each_entry(lsop, &rport->ls_req_list, lsreq_list) {
+ 		if (!(lsop->flags & FCOP_FLAGS_TERMIO)) {
+ 			lsop->flags |= FCOP_FLAGS_TERMIO;
+ 			spin_unlock_irqrestore(&rport->lock, flags);
+ 			rport->lport->ops->ls_abort(&rport->lport->localport,
+ 						&rport->remoteport,
+ 						&lsop->ls_req);
+ 			goto restart;
+ 		}
+ 	}
+ 	spin_unlock_irqrestore(&rport->lock, flags);
+ 
+ 	return 0;
++>>>>>>> 469d0ef06deb (nvme-fc: move remote port get/put/free location)
  }
  
  /**
* Unmerged path drivers/nvme/host/fc.c
