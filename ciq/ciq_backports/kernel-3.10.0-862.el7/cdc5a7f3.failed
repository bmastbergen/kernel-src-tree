net/mlx5e: Use the correct delete call on offloaded TC encap entry detach

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
Rebuild_CHGLOG: - [netdrv] mlx5e: Use the correct delete call on offloaded TC encap entry detach (Don Dutile) [1462433 1499362]
Rebuild_FUZZ: 97.18%
commit-author Or Gerlitz <ogerlitz@mellanox.com>
commit cdc5a7f363be34287ac6c2345e5d1d3b37cf4a23
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/cdc5a7f3.failed

We wrongly direcly invoke hlist_del_rcu() and not hash_del_rcu() which
does a slightly different call now and may change later, fix that.

Fixes: a54e20b4fcae ('net/mlx5e: Add basic TC tunnel set action for SRIOV offloads')
	Signed-off-by: Or Gerlitz <ogerlitz@mellanox.com>
	Reported-by: Paul Blakey <paulb@mellanox.com>
	Reviewed-by: Paul Blakey <paulb@mellanox.com>
	Signed-off-by: Saeed Mahameed <saeedm@mellanox.com>
(cherry picked from commit cdc5a7f363be34287ac6c2345e5d1d3b37cf4a23)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/mellanox/mlx5/core/en_tc.c
diff --cc drivers/net/ethernet/mellanox/mlx5/core/en_tc.c
index d3c637b0294b,a90dd26ea51c..000000000000
--- a/drivers/net/ethernet/mellanox/mlx5/core/en_tc.c
+++ b/drivers/net/ethernet/mellanox/mlx5/core/en_tc.c
@@@ -219,14 -376,16 +219,20 @@@ static void mlx5e_detach_encap(struct m
  
  	list_del(&flow->encap);
  	if (list_empty(next)) {
 -		struct mlx5e_encap_entry *e;
 -
 -		e = list_entry(next, struct mlx5e_encap_entry, flows);
 -		mlx5e_rep_encap_entry_detach(netdev_priv(e->out_dev), e);
 +		struct mlx5_encap_entry *e;
  
 -		if (e->flags & MLX5_ENCAP_ENTRY_VALID)
 +		e = list_entry(next, struct mlx5_encap_entry, flows);
 +		if (e->n) {
  			mlx5_encap_dealloc(priv->mdev, e->encap_id);
++<<<<<<< HEAD
 +			neigh_release(e->n);
 +		}
 +		hlist_del_rcu(&e->encap_hlist);
++=======
+ 
+ 		hash_del_rcu(&e->encap_hlist);
+ 		kfree(e->encap_header);
++>>>>>>> cdc5a7f363be (net/mlx5e: Use the correct delete call on offloaded TC encap entry detach)
  		kfree(e);
  	}
  }
* Unmerged path drivers/net/ethernet/mellanox/mlx5/core/en_tc.c
