radix tree test suite: keep regression test runs short

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
commit-author Ross Zwisler <ross.zwisler@linux.intel.com>
commit aa1d62d8530d5adf158dd633d360108466f93fcd
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/aa1d62d8.failed

Currently the full suite of regression tests take upwards of 30 minutes
to run on my development machine.  The vast majority of this time is
taken by the big_gang_check() and copy_tag_check() tests, which each run
their tests through thousands of iterations...does this have value?

Without big_gang_check() and copy_tag_check(), the test suite runs in
around 15 seconds on my box.

Honestly the first time I ever ran through the entire test suite was to
gather the timings for this email - it simply takes too long to be
useful on a normal basis.

Instead, hide the excessive iterations through big_gang_check() and
copy_tag_check() tests behind an '-l' flag (for "long run") in case they
are still useful, but allow the regression test suite to complete in a
reasonable amount of time.  We still run each of these tests a few times
(3 at present) to try and keep the test coverage.

	Signed-off-by: Ross Zwisler <ross.zwisler@linux.intel.com>
	Signed-off-by: Matthew Wilcox <willy@linux.intel.com>
	Cc: Konstantin Khlebnikov <koct9i@gmail.com>
	Cc: Kirill Shutemov <kirill.shutemov@linux.intel.com>
	Cc: Jan Kara <jack@suse.com>
	Cc: Neil Brown <neilb@suse.de>
	Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
	Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
(cherry picked from commit aa1d62d8530d5adf158dd633d360108466f93fcd)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	tools/testing/radix-tree/main.c
diff --cc tools/testing/radix-tree/main.c
index 0e83cad27a9f,122c8b9be17e..000000000000
--- a/tools/testing/radix-tree/main.c
+++ b/tools/testing/radix-tree/main.c
@@@ -232,7 -232,45 +232,49 @@@ void copy_tag_check(void
  	item_kill_tree(&tree);
  }
  
++<<<<<<< HEAD
 +static void single_thread_tests(void)
++=======
+ void __locate_check(struct radix_tree_root *tree, unsigned long index)
+ {
+ 	struct item *item;
+ 	unsigned long index2;
+ 
+ 	item_insert(tree, index);
+ 	item = item_lookup(tree, index);
+ 	index2 = radix_tree_locate_item(tree, item);
+ 	if (index != index2) {
+ 		printf("index %ld inserted; found %ld\n",
+ 			index, index2);
+ 		abort();
+ 	}
+ }
+ 
+ static void locate_check(void)
+ {
+ 	RADIX_TREE(tree, GFP_KERNEL);
+ 	unsigned long offset, index;
+ 
+ 	for (offset = 0; offset < (1 << 3); offset++) {
+ 		for (index = 0; index < (1UL << 5); index++) {
+ 			__locate_check(&tree, index + offset);
+ 		}
+ 		if (radix_tree_locate_item(&tree, &tree) != -1)
+ 			abort();
+ 
+ 		item_kill_tree(&tree);
+ 	}
+ 
+ 	if (radix_tree_locate_item(&tree, &tree) != -1)
+ 		abort();
+ 	__locate_check(&tree, -1);
+ 	if (radix_tree_locate_item(&tree, &tree) != -1)
+ 		abort();
+ 	item_kill_tree(&tree);
+ }
+ 
+ static void single_thread_tests(bool long_run)
++>>>>>>> aa1d62d8530d (radix tree test suite: keep regression test runs short)
  {
  	int i;
  
* Unmerged path tools/testing/radix-tree/main.c
