net: make default TX queue length a defined constant

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
Rebuild_CHGLOG: - [net] make default TX queue length a defined constant (Ivan Vecera) [1445420]
Rebuild_FUZZ: 94.95%
commit-author Jesper Dangaard Brouer <brouer@redhat.com>
commit d0a81f67cd6286d32f42a167d19c7a387c23db79
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/d0a81f67.failed

The default TX queue length of Ethernet devices have been a magic
constant of 1000, ever since the initial git import.

Looking back in historical trees[1][2] the value used to be 100,
with the same comment "Ethernet wants good queues". The commit[3]
that changed this from 100 to 1000 didn't describe why, but from
conversations with Robert Olsson it seems that it was changed
when Ethernet devices went from 100Mbit/s to 1Gbit/s, because the
link speed increased x10 the queue size were also adjusted.  This
value later caused much heartache for the bufferbloat community.

This patch merely moves the value into a defined constant.

[1] https://git.kernel.org/cgit/linux/kernel/git/davem/netdev-vger-cvs.git/
[2] https://git.kernel.org/cgit/linux/kernel/git/tglx/history.git/
[3] https://git.kernel.org/tglx/history/c/98921832c232

	Signed-off-by: Jesper Dangaard Brouer <brouer@redhat.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit d0a81f67cd6286d32f42a167d19c7a387c23db79)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/ethernet/eth.c
diff --cc net/ethernet/eth.c
index 071ff5a0f796,8c5a479681ca..000000000000
--- a/net/ethernet/eth.c
+++ b/net/ethernet/eth.c
@@@ -63,7 -61,8 +63,12 @@@
  #include <net/ip.h>
  #include <net/dsa.h>
  #include <net/flow_dissector.h>
++<<<<<<< HEAD
 +#include <asm/uaccess.h>
++=======
+ #include <linux/uaccess.h>
+ #include <net/pkt_sched.h>
++>>>>>>> d0a81f67cd62 (net: make default TX queue length a defined constant)
  
  __setup("ether=", netdev_boot_setup);
  
@@@ -400,8 -357,10 +405,8 @@@ void ether_setup(struct net_device *dev
  	dev->type		= ARPHRD_ETHER;
  	dev->hard_header_len 	= ETH_HLEN;
  	dev->mtu		= ETH_DATA_LEN;
 -	dev->min_mtu		= ETH_MIN_MTU;
 -	dev->max_mtu		= ETH_DATA_LEN;
  	dev->addr_len		= ETH_ALEN;
- 	dev->tx_queue_len	= 1000;	/* Ethernet wants good queues */
+ 	dev->tx_queue_len	= DEFAULT_TX_QUEUE_LEN;
  	dev->flags		= IFF_BROADCAST|IFF_MULTICAST;
  	dev->priv_flags		|= IFF_TX_SKB_SHARING;
  
diff --git a/include/net/pkt_sched.h b/include/net/pkt_sched.h
index 7caa99b482c6..228252c6effd 100644
--- a/include/net/pkt_sched.h
+++ b/include/net/pkt_sched.h
@@ -6,6 +6,8 @@
 #include <linux/if_vlan.h>
 #include <net/sch_generic.h>
 
+#define DEFAULT_TX_QUEUE_LEN	1000
+
 struct qdisc_walker {
 	int	stop;
 	int	skip;
* Unmerged path net/ethernet/eth.c
