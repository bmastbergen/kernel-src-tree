ftrace/graph: Add ftrace_graph_max_depth kernel parameter

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
commit-author Todd Brandt <todd.e.brandt@linux.intel.com>
commit 65a50c656276b0846bea09dd011c0a3d35b77f3e
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/65a50c65.failed

Early trace callgraphs can be extremely large on systems with
several seconds of boot time. The max_depth parameter limits how
deep the graph trace goes and reduces the output size. This
parameter is the same as the max_graph_depth file in tracefs.

Link: http://lkml.kernel.org/r/1488499935-23216-1-git-send-email-todd.e.brandt@linux.intel.com

	Signed-off-by: Todd Brandt <todd.e.brandt@linux.intel.com>
[ changed comments about debugfs to tracefs ]
	Signed-off-by: Steven Rostedt (VMware) <rostedt@goodmis.org>
(cherry picked from commit 65a50c656276b0846bea09dd011c0a3d35b77f3e)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	Documentation/kernel-parameters.txt
#	kernel/trace/ftrace.c
diff --cc Documentation/kernel-parameters.txt
index cbd5f28e2ade,1c9016b27ee9..000000000000
--- a/Documentation/kernel-parameters.txt
+++ b/Documentation/kernel-parameters.txt
@@@ -1008,6 -1167,18 +1008,21 @@@ bytes respectively. Such letter suffixe
  			that can be changed at run time by the
  			set_graph_function file in the debugfs tracing directory.
  
++<<<<<<< HEAD:Documentation/kernel-parameters.txt
++=======
+ 	ftrace_graph_notrace=[function-list]
+ 			[FTRACE] Do not trace from the functions specified in
+ 			function-list.  This list is a comma separated list of
+ 			functions that can be changed at run time by the
+ 			set_graph_notrace file in the debugfs tracing directory.
+ 
+ 	ftrace_graph_max_depth=<uint>
+ 			[FTRACE] Used with the function graph tracer. This is
+ 			the max depth it will trace into a function. This value
+ 			can be changed at run time by the max_graph_depth file
+ 			in the tracefs tracing directory. default: 0 (no limit)
+ 
++>>>>>>> 65a50c656276 (ftrace/graph: Add ftrace_graph_max_depth kernel parameter):Documentation/admin-guide/kernel-parameters.txt
  	gamecon.map[2|3]=
  			[HW,JOY] Multisystem joystick and NES/SNES/PSX pad
  			support via parallel port (up to 5 devices per port)
diff --cc kernel/trace/ftrace.c
index 3800d970e761,d129ae51329a..000000000000
--- a/kernel/trace/ftrace.c
+++ b/kernel/trace/ftrace.c
@@@ -3821,7 -4408,23 +3821,27 @@@ static int __init set_graph_function(ch
  }
  __setup("ftrace_graph_filter=", set_graph_function);
  
++<<<<<<< HEAD
 +static void __init set_ftrace_early_graph(char *buf)
++=======
+ static int __init set_graph_notrace_function(char *str)
+ {
+ 	strlcpy(ftrace_graph_notrace_buf, str, FTRACE_FILTER_SIZE);
+ 	return 1;
+ }
+ __setup("ftrace_graph_notrace=", set_graph_notrace_function);
+ 
+ static int __init set_graph_max_depth_function(char *str)
+ {
+ 	if (!str)
+ 		return 0;
+ 	fgraph_max_depth = simple_strtoul(str, NULL, 0);
+ 	return 1;
+ }
+ __setup("ftrace_graph_max_depth=", set_graph_max_depth_function);
+ 
+ static void __init set_ftrace_early_graph(char *buf, int enable)
++>>>>>>> 65a50c656276 (ftrace/graph: Add ftrace_graph_max_depth kernel parameter)
  {
  	int ret;
  	char *func;
* Unmerged path Documentation/kernel-parameters.txt
* Unmerged path kernel/trace/ftrace.c
