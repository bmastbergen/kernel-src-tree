blktrace: use existing disk debugfs directory

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
commit-author Omar Sandoval <osandov@fb.com>
commit 6ac93117ab009d3901ed5d3d0f79056eb5fc0afd
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/6ac93117.failed

We may already have a directory to put the blktrace stuff in if

1. The disk uses blk-mq
2. CONFIG_BLK_DEBUG_FS is enabled
3. We are tracing the whole disk and not a partition

Instead of hardcoding this very specific case, let's use the new
debugfs_lookup(). If the directory exists, we use it, otherwise we
create one and clean it up later.

Fixes: 07e4fead45e6 ("blk-mq: create debugfs directory tree")
	Signed-off-by: Omar Sandoval <osandov@fb.com>
	Signed-off-by: Jens Axboe <axboe@fb.com>
(cherry picked from commit 6ac93117ab009d3901ed5d3d0f79056eb5fc0afd)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	kernel/trace/blktrace.c
diff --cc kernel/trace/blktrace.c
index f3433e85f50f,b2058a7f94bd..000000000000
--- a/kernel/trace/blktrace.c
+++ b/kernel/trace/blktrace.c
@@@ -459,24 -467,18 +459,29 @@@ static int do_blk_trace_setup(struct re
  
  	ret = -ENOENT;
  
 -	if (!blk_debugfs_root)
 -		goto err;
 +	mutex_lock(&blk_tree_mutex);
 +	if (!blk_tree_root) {
 +		blk_tree_root = debugfs_create_dir("block", NULL);
 +		if (!blk_tree_root) {
 +			mutex_unlock(&blk_tree_mutex);
 +			goto err;
 +		}
 +	}
 +	mutex_unlock(&blk_tree_mutex);
 +
++<<<<<<< HEAD
 +	dir = debugfs_create_dir(buts->name, blk_tree_root);
  
++=======
+ 	dir = debugfs_lookup(buts->name, blk_debugfs_root);
+ 	if (!dir)
+ 		bt->dir = dir = debugfs_create_dir(buts->name, blk_debugfs_root);
++>>>>>>> 6ac93117ab00 (blktrace: use existing disk debugfs directory)
  	if (!dir)
  		goto err;
  
- 	bt->dir = dir;
  	bt->dev = dev;
  	atomic_set(&bt->dropped, 0);
 -	INIT_LIST_HEAD(&bt->running_list);
  
  	ret = -EIO;
  	bt->dropped_file = debugfs_create_file("dropped", 0444, dir, bt,
* Unmerged path kernel/trace/blktrace.c
