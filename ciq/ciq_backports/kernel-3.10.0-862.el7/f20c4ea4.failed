PCI/DPC: Add eDPC support

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
Rebuild_CHGLOG: - [pci] dpc: Add eDPC support (Myron Stowe) [1499031]
Rebuild_FUZZ: 91.30%
commit-author Dongdong Liu <liudongdong3@huawei.com>
commit f20c4ea49ec4708de97248927ac6138c2d14eba9
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/f20c4ea4.failed

Add eDPC support. Get and print the RP PIO error information when the
trigger condition is RP PIO error.

For more information on eDPC, please see PCI Express Base Specification
Revision 3.1, section 6.2.10.3, or view the PCI-SIG eDPC ECN here:
https://pcisig.com/sites/default/files/specification_documents/ECN_Enhanced_DPC_2012-11-19_final.pdf

	Signed-off-by: Dongdong Liu <liudongdong3@huawei.com>
	Signed-off-by: Bjorn Helgaas <bhelgaas@google.com>
	Reviewed-by: Keith Busch <keith.busch@intel.com>
(cherry picked from commit f20c4ea49ec4708de97248927ac6138c2d14eba9)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/pci/pcie/pcie-dpc.c
#	include/uapi/linux/pci_regs.h
diff --cc include/uapi/linux/pci_regs.h
index 11d0eed025f3,1ce96275531c..000000000000
--- a/include/uapi/linux/pci_regs.h
+++ b/include/uapi/linux/pci_regs.h
@@@ -950,4 -962,56 +950,59 @@@
  #define PCI_TPH_CAP_ST_SHIFT	16	/* st table shift */
  #define PCI_TPH_BASE_SIZEOF	12	/* size with no st table */
  
++<<<<<<< HEAD
++=======
+ /* Downstream Port Containment */
+ #define PCI_EXP_DPC_CAP			4	/* DPC Capability */
+ #define  PCI_EXP_DPC_CAP_RP_EXT		0x20	/* Root Port Extensions for DPC */
+ #define  PCI_EXP_DPC_CAP_POISONED_TLP	0x40	/* Poisoned TLP Egress Blocking Supported */
+ #define  PCI_EXP_DPC_CAP_SW_TRIGGER	0x80	/* Software Triggering Supported */
+ #define  PCI_EXP_DPC_RP_PIO_LOG_SIZE	0xF00	/* RP PIO log size */
+ #define  PCI_EXP_DPC_CAP_DL_ACTIVE	0x1000	/* ERR_COR signal on DL_Active supported */
+ 
+ #define PCI_EXP_DPC_CTL			6	/* DPC control */
+ #define  PCI_EXP_DPC_CTL_EN_NONFATAL 	0x02	/* Enable trigger on ERR_NONFATAL message */
+ #define  PCI_EXP_DPC_CTL_INT_EN 	0x08	/* DPC Interrupt Enable */
+ 
+ #define PCI_EXP_DPC_STATUS		8	/* DPC Status */
+ #define  PCI_EXP_DPC_STATUS_TRIGGER	0x01	/* Trigger Status */
+ #define  PCI_EXP_DPC_STATUS_INTERRUPT	0x08	/* Interrupt Status */
+ #define  PCI_EXP_DPC_RP_BUSY		0x10	/* Root Port Busy */
+ 
+ #define PCI_EXP_DPC_SOURCE_ID		10	/* DPC Source Identifier */
+ 
+ #define PCI_EXP_DPC_RP_PIO_STATUS	 0x0C	/* RP PIO Status */
+ #define PCI_EXP_DPC_RP_PIO_MASK		 0x10	/* RP PIO MASK */
+ #define PCI_EXP_DPC_RP_PIO_SEVERITY	 0x14	/* RP PIO Severity */
+ #define PCI_EXP_DPC_RP_PIO_SYSERROR	 0x18	/* RP PIO SysError */
+ #define PCI_EXP_DPC_RP_PIO_EXCEPTION	 0x1C	/* RP PIO Exception */
+ #define PCI_EXP_DPC_RP_PIO_HEADER_LOG	 0x20	/* RP PIO Header Log */
+ #define PCI_EXP_DPC_RP_PIO_IMPSPEC_LOG	 0x30	/* RP PIO ImpSpec Log */
+ #define PCI_EXP_DPC_RP_PIO_TLPPREFIX_LOG 0x34	/* RP PIO TLP Prefix Log */
+ 
+ /* Precision Time Measurement */
+ #define PCI_PTM_CAP			0x04	    /* PTM Capability */
+ #define  PCI_PTM_CAP_REQ		0x00000001  /* Requester capable */
+ #define  PCI_PTM_CAP_ROOT		0x00000004  /* Root capable */
+ #define  PCI_PTM_GRANULARITY_MASK	0x0000FF00  /* Clock granularity */
+ #define PCI_PTM_CTRL			0x08	    /* PTM Control */
+ #define  PCI_PTM_CTRL_ENABLE		0x00000001  /* PTM enable */
+ #define  PCI_PTM_CTRL_ROOT		0x00000002  /* Root select */
+ 
+ /* L1 PM Substates */
+ #define PCI_L1SS_CAP		    4	/* capability register */
+ #define  PCI_L1SS_CAP_PCIPM_L1_2	 1	/* PCI PM L1.2 Support */
+ #define  PCI_L1SS_CAP_PCIPM_L1_1	 2	/* PCI PM L1.1 Support */
+ #define  PCI_L1SS_CAP_ASPM_L1_2		 4	/* ASPM L1.2 Support */
+ #define  PCI_L1SS_CAP_ASPM_L1_1		 8	/* ASPM L1.1 Support */
+ #define  PCI_L1SS_CAP_L1_PM_SS		16	/* L1 PM Substates Support */
+ #define PCI_L1SS_CTL1		    8	/* Control Register 1 */
+ #define  PCI_L1SS_CTL1_PCIPM_L1_2	1	/* PCI PM L1.2 Enable */
+ #define  PCI_L1SS_CTL1_PCIPM_L1_1	2	/* PCI PM L1.1 Support */
+ #define  PCI_L1SS_CTL1_ASPM_L1_2	4	/* ASPM L1.2 Support */
+ #define  PCI_L1SS_CTL1_ASPM_L1_1	8	/* ASPM L1.1 Support */
+ #define  PCI_L1SS_CTL1_L1SS_MASK	0x0000000F
+ #define PCI_L1SS_CTL2		    0xC	/* Control Register 2 */
+ 
++>>>>>>> f20c4ea49ec4 (PCI/DPC: Add eDPC support)
  #endif /* LINUX_PCI_REGS_H */
* Unmerged path drivers/pci/pcie/pcie-dpc.c
* Unmerged path drivers/pci/pcie/pcie-dpc.c
* Unmerged path include/uapi/linux/pci_regs.h
