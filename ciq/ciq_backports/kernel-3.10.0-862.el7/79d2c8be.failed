pinctrl/amd: save pin registers over suspend/resume

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
commit-author Daniel Drake <drake@endlessm.com>
commit 79d2c8bede2c93f9432d7da0bc2f76a195c90fc0
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/79d2c8be.failed

The touchpad in the Asus laptop models X505BA/BP and X542BA/BP is
unresponsive after suspend/resume. The following error appears during
resume:

  i2c_hid i2c-ELAN1300:00: failed to reset device.

The problem here is that i2c_hid does not notice the interrupt being
generated at this point, because the GPIO is no longer configured
for interrupts.

Fix this by saving pinctrl-amd pin registers during suspend and
restoring them at resume time.

Based on code from pinctrl-intel.

	Cc: stable@vger.kernel.org
	Signed-off-by: Daniel Drake <drake@endlessm.com>
	Signed-off-by: Linus Walleij <linus.walleij@linaro.org>
(cherry picked from commit 79d2c8bede2c93f9432d7da0bc2f76a195c90fc0)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/pinctrl/pinctrl-amd.c
diff --cc drivers/pinctrl/pinctrl-amd.c
index d98fd4b2218d,3f6b34febbf1..000000000000
--- a/drivers/pinctrl/pinctrl-amd.c
+++ b/drivers/pinctrl/pinctrl-amd.c
@@@ -36,13 -36,10 +36,18 @@@
  #include <linux/pinctrl/pinconf.h>
  #include <linux/pinctrl/pinconf-generic.h>
  
++<<<<<<< HEAD
++=======
+ #include "core.h"
+ #include "pinctrl-utils.h"
++>>>>>>> 79d2c8bede2c (pinctrl/amd: save pin registers over suspend/resume)
  #include "pinctrl-amd.h"
  
 +static inline struct amd_gpio *to_amd_gpio(struct gpio_chip *gc)
 +{
 +	return container_of(gc, struct amd_gpio, gc);
 +}
 +
  static int amd_gpio_direction_input(struct gpio_chip *gc, unsigned offset)
  {
  	unsigned long flags;
* Unmerged path drivers/pinctrl/pinctrl-amd.c
diff --git a/drivers/pinctrl/pinctrl-amd.h b/drivers/pinctrl/pinctrl-amd.h
index 5b1cb965c767..8fa453a59da5 100644
--- a/drivers/pinctrl/pinctrl-amd.h
+++ b/drivers/pinctrl/pinctrl-amd.h
@@ -97,6 +97,7 @@ struct amd_gpio {
 	unsigned int            hwbank_num;
 	struct resource         *res;
 	struct platform_device  *pdev;
+	u32			*saved_regs;
 };
 
 /*  KERNCZ configuration*/
