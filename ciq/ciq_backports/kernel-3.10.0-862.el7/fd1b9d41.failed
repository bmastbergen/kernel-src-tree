mlxsw: spectrum_router: Add rif helper functions

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
commit-author Arkadi Sharshevsky <arkadis@mellanox.com>
commit fd1b9d41928824eda4694a1015e7ccf233bfff3e
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/fd1b9d41.failed

Add rif helper function to access the rif index and rif devices ifindex.
This functions will be used by dpipe in order to dump the rif table.

	Signed-off-by: Arkadi Sharshevsky <arkadis@mellanox.com>
	Signed-off-by: Jiri Pirko <jiri@mellanox.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit fd1b9d41928824eda4694a1015e7ccf233bfff3e)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/tipc/ref.h
diff --cc net/tipc/ref.h
index 5bc8e7ab84de,c3095fef6697..000000000000
--- a/net/tipc/ref.h
+++ b/net/tipc/ref.h
@@@ -34,16 -32,27 +34,31 @@@
   * POSSIBILITY OF SUCH DAMAGE.
   */
  
 -#ifndef _MLXSW_ROUTER_H_
 -#define _MLXSW_ROUTER_H_
 +#ifndef _TIPC_REF_H
 +#define _TIPC_REF_H
  
 -#include "spectrum.h"
 +int tipc_ref_table_init(u32 requested_size, u32 start);
 +void tipc_ref_table_stop(void);
  
 -enum mlxsw_sp_rif_counter_dir {
 -	MLXSW_SP_RIF_COUNTER_INGRESS,
 -	MLXSW_SP_RIF_COUNTER_EGRESS,
 -};
 +u32 tipc_ref_acquire(void *object, spinlock_t **lock);
 +void tipc_ref_discard(u32 ref);
  
++<<<<<<< HEAD:net/tipc/ref.h
 +void *tipc_ref_lock(u32 ref);
 +void *tipc_ref_deref(u32 ref);
++=======
+ u16 mlxsw_sp_rif_index(const struct mlxsw_sp_rif *rif);
+ int mlxsw_sp_rif_dev_ifindex(const struct mlxsw_sp_rif *rif);
+ int mlxsw_sp_rif_counter_value_get(struct mlxsw_sp *mlxsw_sp,
+ 				   struct mlxsw_sp_rif *rif,
+ 				   enum mlxsw_sp_rif_counter_dir dir,
+ 				   u64 *cnt);
+ void mlxsw_sp_rif_counter_free(struct mlxsw_sp *mlxsw_sp,
+ 			       struct mlxsw_sp_rif *rif,
+ 			       enum mlxsw_sp_rif_counter_dir dir);
+ int mlxsw_sp_rif_counter_alloc(struct mlxsw_sp *mlxsw_sp,
+ 			       struct mlxsw_sp_rif *rif,
+ 			       enum mlxsw_sp_rif_counter_dir dir);
++>>>>>>> fd1b9d419288 (mlxsw: spectrum_router: Add rif helper functions):drivers/net/ethernet/mellanox/mlxsw/spectrum_router.h
  
 -#endif /* _MLXSW_ROUTER_H_*/
 +#endif
diff --git a/drivers/net/ethernet/mellanox/mlxsw/spectrum_router.c b/drivers/net/ethernet/mellanox/mlxsw/spectrum_router.c
index bcd69721f339..3713abd690c5 100644
--- a/drivers/net/ethernet/mellanox/mlxsw/spectrum_router.c
+++ b/drivers/net/ethernet/mellanox/mlxsw/spectrum_router.c
@@ -2768,6 +2768,16 @@ mlxsw_sp_rif_alloc(u16 rif, u16 vr_id, struct net_device *l3_dev,
 	return r;
 }
 
+u16 mlxsw_sp_rif_index(const struct mlxsw_sp_rif *rif)
+{
+	return rif->rif_index;
+}
+
+int mlxsw_sp_rif_dev_ifindex(const struct mlxsw_sp_rif *rif)
+{
+	return rif->dev->ifindex;
+}
+
 static struct mlxsw_sp_rif *
 mlxsw_sp_vport_rif_sp_create(struct mlxsw_sp_port *mlxsw_sp_vport,
 			     struct net_device *l3_dev)
* Unmerged path net/tipc/ref.h
