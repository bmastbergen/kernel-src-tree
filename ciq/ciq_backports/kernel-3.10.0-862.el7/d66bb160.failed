proc: Fix unbalanced hard link numbers

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
commit-author Takashi Iwai <tiwai@suse.de>
commit d66bb1607e2d8d384e53f3d93db5c18483c8c4f7
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/d66bb160.failed

proc_create_mount_point() forgot to increase the parent's nlink, and
it resulted in unbalanced hard link numbers, e.g. /proc/fs shows one
less than expected.

Fixes: eb6d38d5427b ("proc: Allow creating permanently empty directories...")
	Cc: stable@vger.kernel.org
	Reported-by: Tristan Ye <tristan.ye@suse.com>
	Signed-off-by: Takashi Iwai <tiwai@suse.de>
	Signed-off-by: Eric W. Biederman <ebiederm@xmission.com>
(cherry picked from commit d66bb1607e2d8d384e53f3d93db5c18483c8c4f7)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	fs/proc/generic.c
diff --cc fs/proc/generic.c
index ae73c569138f,9425c0d97262..000000000000
--- a/fs/proc/generic.c
+++ b/fs/proc/generic.c
@@@ -509,6 -462,27 +509,30 @@@ struct proc_dir_entry *proc_mkdir(cons
  }
  EXPORT_SYMBOL(proc_mkdir);
  
++<<<<<<< HEAD
++=======
+ struct proc_dir_entry *proc_create_mount_point(const char *name)
+ {
+ 	umode_t mode = S_IFDIR | S_IRUGO | S_IXUGO;
+ 	struct proc_dir_entry *ent, *parent = NULL;
+ 
+ 	ent = __proc_create(&parent, name, mode, 2);
+ 	if (ent) {
+ 		ent->data = NULL;
+ 		ent->proc_fops = NULL;
+ 		ent->proc_iops = NULL;
+ 		parent->nlink++;
+ 		if (proc_register(parent, ent) < 0) {
+ 			kfree(ent);
+ 			parent->nlink--;
+ 			ent = NULL;
+ 		}
+ 	}
+ 	return ent;
+ }
+ EXPORT_SYMBOL(proc_create_mount_point);
+ 
++>>>>>>> d66bb1607e2d (proc: Fix unbalanced hard link numbers)
  struct proc_dir_entry *proc_create_data(const char *name, umode_t mode,
  					struct proc_dir_entry *parent,
  					const struct file_operations *proc_fops,
* Unmerged path fs/proc/generic.c
