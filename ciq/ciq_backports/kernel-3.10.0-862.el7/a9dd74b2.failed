KEYS: encrypted: sanitize all key material

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
commit-author Eric Biggers <ebiggers@google.com>
commit a9dd74b252e04b7e41ffe78d418b896b33b70a13
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/a9dd74b2.failed

For keys of type "encrypted", consistently zero sensitive key material
before freeing it.  This was already being done for the decrypted
payloads of encrypted keys, but not for the master key and the keys
derived from the master key.

Out of an abundance of caution and because it is trivial to do so, also
zero buffers containing the key payload in encrypted form, although
depending on how the encrypted-keys feature is used such information
does not necessarily need to be kept secret.

	Cc: Mimi Zohar <zohar@linux.vnet.ibm.com>
	Cc: David Safford <safford@us.ibm.com>
	Signed-off-by: Eric Biggers <ebiggers@google.com>
	Signed-off-by: David Howells <dhowells@redhat.com>
	Signed-off-by: James Morris <james.l.morris@oracle.com>
(cherry picked from commit a9dd74b252e04b7e41ffe78d418b896b33b70a13)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	security/keys/encrypted-keys/encrypted.c
diff --cc security/keys/encrypted-keys/encrypted.c
index f03ff1a51afe,bb6324d1ccec..000000000000
--- a/security/keys/encrypted-keys/encrypted.c
+++ b/security/keys/encrypted-keys/encrypted.c
@@@ -934,13 -960,7 +935,17 @@@ out
   */
  static void encrypted_destroy(struct key *key)
  {
++<<<<<<< HEAD
 +	struct encrypted_key_payload *epayload = key->payload.data;
 +
 +	if (!epayload)
 +		return;
 +
 +	memset(epayload->decrypted_data, 0, epayload->decrypted_datalen);
 +	kfree(key->payload.data);
++=======
+ 	kzfree(key->payload.data[0]);
++>>>>>>> a9dd74b252e0 (KEYS: encrypted: sanitize all key material)
  }
  
  struct key_type key_type_encrypted = {
* Unmerged path security/keys/encrypted-keys/encrypted.c
