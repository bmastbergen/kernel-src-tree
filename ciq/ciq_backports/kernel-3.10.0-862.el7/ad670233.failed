nl80211: Define policy for packet pattern attributes

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
commit-author Peng Xu <pxu@qti.qualcomm.com>
commit ad670233c9e1d5feb365d870e30083ef1b889177
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/ad670233.failed

Define a policy for packet pattern attributes in order to fix a
potential read over the end of the buffer during nla_get_u32()
of the NL80211_PKTPAT_OFFSET attribute.

Note that the data there can always be read due to SKB allocation
(with alignment and struct skb_shared_info at the end), but the
data might be uninitialized. This could be used to leak some data
from uninitialized vmalloc() memory, but most drivers don't allow
an offset (so you'd just get -EINVAL if the data is non-zero) or
just allow it with a fixed value - 100 or 128 bytes, so anything
above that would get -EINVAL. With brcmfmac the limit is 1500 so
(at least) one byte could be obtained.

	Cc: stable@kernel.org
	Signed-off-by: Peng Xu <pxu@qti.qualcomm.com>
	Signed-off-by: Jouni Malinen <jouni@qca.qualcomm.com>
[rewrite description based on SKB allocation knowledge]
	Signed-off-by: Johannes Berg <johannes.berg@intel.com>
(cherry picked from commit ad670233c9e1d5feb365d870e30083ef1b889177)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/wireless/nl80211.c
diff --cc net/wireless/nl80211.c
index aea6305a7568,d396cb61a280..000000000000
--- a/net/wireless/nl80211.c
+++ b/net/wireless/nl80211.c
@@@ -10212,7 -10540,8 +10220,12 @@@ static int nl80211_set_wowlan(struct sk
  			u8 *mask_pat;
  
  			nla_parse_nested(pat_tb, MAX_NL80211_PKTPAT, pat,
++<<<<<<< HEAD
 +					 NULL);
++=======
+ 					 nl80211_packet_pattern_policy,
+ 					 info->extack);
++>>>>>>> ad670233c9e1 (nl80211: Define policy for packet pattern attributes)
  			err = -EINVAL;
  			if (!pat_tb[NL80211_PKTPAT_MASK] ||
  			    !pat_tb[NL80211_PKTPAT_PATTERN])
@@@ -10461,7 -10790,8 +10474,12 @@@ static int nl80211_parse_coalesce_rule(
  			    rem) {
  		u8 *mask_pat;
  
++<<<<<<< HEAD
 +		nla_parse_nested(pat_tb, MAX_NL80211_PKTPAT, pat, NULL);
++=======
+ 		nla_parse_nested(pat_tb, MAX_NL80211_PKTPAT, pat,
+ 				 nl80211_packet_pattern_policy, NULL);
++>>>>>>> ad670233c9e1 (nl80211: Define policy for packet pattern attributes)
  		if (!pat_tb[NL80211_PKTPAT_MASK] ||
  		    !pat_tb[NL80211_PKTPAT_PATTERN])
  			return -EINVAL;
* Unmerged path net/wireless/nl80211.c
