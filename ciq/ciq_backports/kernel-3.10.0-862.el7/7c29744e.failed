dm raid: simplify rs_get_progress()

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
commit-author Heinz Mauelshagen <heinzm@redhat.com>
commit 7c29744eccecc2c74c9b4d1ea0a60b4d95229399
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/7c29744e.failed

No need to calculate the reshaping progress because
mddev->curr_resync_completed holds it.

	Signed-off-by: Heinz Mauelshagen <heinzm@redhat.com>
	Signed-off-by: Mike Snitzer <snitzer@redhat.com>
(cherry picked from commit 7c29744eccecc2c74c9b4d1ea0a60b4d95229399)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/md/dm-raid.c
diff --cc drivers/md/dm-raid.c
index 94db8c87956d,21e007c89c2e..000000000000
--- a/drivers/md/dm-raid.c
+++ b/drivers/md/dm-raid.c
@@@ -3297,33 -3396,21 +3297,40 @@@ static sector_t rs_get_progress(struct 
  
  	if (rs_is_raid0(rs)) {
  		r = resync_max_sectors;
 -		set_bit(RT_FLAG_RS_IN_SYNC, &rs->runtime_flags);
 +		*array_in_sync = true;
  
  	} else {
++<<<<<<< HEAD
 +		r = mddev->reshape_position;
 +
 +		/* Reshape is relative to the array size */
 +		if (test_bit(MD_RECOVERY_RESHAPE, &mddev->recovery) ||
 +		    r != MaxSector) {
 +			if (r == MaxSector) {
 +				*array_in_sync = true;
 +				r = resync_max_sectors;
 +			} else {
 +				/* Got to reverse on backward reshape */
 +				if (mddev->reshape_backwards)
 +					r = mddev->array_sectors - r;
 +
 +				/* Devide by # of data stripes */
 +				sector_div(r, mddev_data_stripes(rs));
 +			}
 +
 +		/* Sync is relative to the component device size */
 +		} else if (test_bit(MD_RECOVERY_RUNNING, &mddev->recovery))
 +			r = curr_resync_completed;
++=======
+ 		if (test_bit(MD_RECOVERY_NEEDED, &recovery) ||
+ 		    test_bit(MD_RECOVERY_RESHAPE, &recovery) ||
+ 		    test_bit(MD_RECOVERY_RUNNING, &recovery))
+ 			r = mddev->curr_resync_completed;
++>>>>>>> 7c29744eccec (dm raid: simplify rs_get_progress())
  		else
 -			r = mddev->recovery_cp;
 +			r = recovery_cp;
  
 -		if (r >= resync_max_sectors &&
 -		    (!test_bit(MD_RECOVERY_REQUESTED, &recovery) ||
 -		     (!test_bit(MD_RECOVERY_FROZEN, &recovery) &&
 -		      !test_bit(MD_RECOVERY_NEEDED, &recovery) &&
 -		      !test_bit(MD_RECOVERY_RUNNING, &recovery)))) {
 +		if (r == MaxSector) {
  			/*
  			 * Sync complete.
  			 */
* Unmerged path drivers/md/dm-raid.c
