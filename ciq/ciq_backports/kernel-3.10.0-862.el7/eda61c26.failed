x86/intel_rdt/cqm: Clear the default RMID during hotcpu

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
Rebuild_CHGLOG: - [x86] intel_rdt/cqm: Clear the default RMID during hotcpu (Jiri Olsa) [1457533]
Rebuild_FUZZ: 96.23%
commit-author Vikas Shivappa <vikas.shivappa@linux.intel.com>
commit eda61c265f3656be8345fdf0334b3a77829437fc
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/eda61c26.failed

The user configured per cpu default RMID is not cleared during cpu
hotplug. This may lead to incorrect RMID values after a cpu goes offline
and again comes back online. Clear the per cpu default RMID during cpu
offline and online handling.

	Reported-by: Prakyha Sai Praneeth <sai.praneeth.prakhya@intel.com>
	Signed-off-by: Vikas Shivappa <vikas.shivappa@linux.intel.com>
	Signed-off-by: Thomas Gleixner <tglx@linutronix.de>
	Cc: ravi.v.shankar@intel.com
	Cc: tony.luck@intel.com
	Cc: fenghua.yu@intel.com
	Cc: peterz@infradead.org
	Cc: eranian@google.com
	Cc: ak@linux.intel.com
	Cc: davidcc@google.com
Link: http://lkml.kernel.org/r/1502304395-7166-2-git-send-email-vikas.shivappa@linux.intel.com

(cherry picked from commit eda61c265f3656be8345fdf0334b3a77829437fc)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/x86/kernel/cpu/intel_rdt.c
diff --cc arch/x86/kernel/cpu/intel_rdt.c
index ad087dd4421e,4b9edb2617a5..000000000000
--- a/arch/x86/kernel/cpu/intel_rdt.c
+++ b/arch/x86/kernel/cpu/intel_rdt.c
@@@ -357,12 -550,14 +357,17 @@@ static void clear_closid(int cpu
  {
  	struct intel_pqr_state *state = this_cpu_ptr(&pqr_state);
  
++<<<<<<< HEAD
 +	per_cpu(cpu_closid, cpu) = 0;
++=======
+ 	per_cpu(rdt_cpu_default.closid, cpu) = 0;
+ 	per_cpu(rdt_cpu_default.rmid, cpu) = 0;
++>>>>>>> eda61c265f36 (x86/intel_rdt/cqm: Clear the default RMID during hotcpu)
  	state->closid = 0;
 -	state->rmid = 0;
 -	wrmsr(IA32_PQR_ASSOC, 0, 0);
 +	wrmsr(MSR_IA32_PQR_ASSOC, state->rmid, 0);
  }
  
 -static int intel_rdt_online_cpu(unsigned int cpu)
 +static int intel_rdt_online_cpu(unsigned int cpu, bool notifier)
  {
  	struct rdt_resource *r;
  
* Unmerged path arch/x86/kernel/cpu/intel_rdt.c
