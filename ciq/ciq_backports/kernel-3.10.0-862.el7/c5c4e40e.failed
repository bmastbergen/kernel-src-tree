IB/CM: Change sgid to IB GID when handling CM request

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
Rebuild_CHGLOG: - [infiniband] cm: Change sgid to IB GID when handling CM request (Alex Estrin) [1526145 1520402]
Rebuild_FUZZ: 97.09%
commit-author Don Hiatt <don.hiatt@intel.com>
commit c5c4e40e90b5c714248bcf4e8a63b1a1cd07c11e
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/c5c4e40e.failed

ULPs do not understand OPA GIDs and will reject CM requests
if the sgid does not match the local_gid. In order to
fix this behavior we convert the OPA GID back to an IB GID.

	Reviewed-by: Ira Weiny <ira.weiny@intel.com>
	Signed-off-by: Don Hiatt <don.hiatt@intel.com>
	Signed-off-by: Dennis Dalessandro <dennis.dalessandro@intel.com>
	Signed-off-by: Jason Gunthorpe <jgg@mellanox.com>
(cherry picked from commit c5c4e40e90b5c714248bcf4e8a63b1a1cd07c11e)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/infiniband/core/cm.c
diff --cc drivers/infiniband/core/cm.c
index ea27dc1ae666,1cafa8350c52..000000000000
--- a/drivers/infiniband/core/cm.c
+++ b/drivers/infiniband/core/cm.c
@@@ -1480,10 -1604,13 +1511,17 @@@ static void cm_format_req_event(struct 
  	param->bth_pkey = cm_get_bth_pkey(work);
  	param->port = cm_id_priv->av.port->port_num;
  	param->primary_path = &work->path[0];
++<<<<<<< HEAD
 +	if (req_msg->alt_local_lid)
++=======
+ 	cm_opa_to_ib_sgid(work, param->primary_path);
+ 	if (cm_req_has_alt_path(req_msg)) {
++>>>>>>> c5c4e40e90b5 (IB/CM: Change sgid to IB GID when handling CM request)
  		param->alternate_path = &work->path[1];
- 	else
+ 		cm_opa_to_ib_sgid(work, param->alternate_path);
+ 	} else {
  		param->alternate_path = NULL;
+ 	}
  	param->remote_ca_guid = req_msg->local_ca_guid;
  	param->remote_qkey = be32_to_cpu(req_msg->local_qkey);
  	param->remote_qpn = be32_to_cpu(cm_req_get_local_qpn(req_msg));
* Unmerged path drivers/infiniband/core/cm.c
