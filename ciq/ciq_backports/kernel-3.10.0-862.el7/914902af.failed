libceph: don't call encode_request_finish() on MOSDBackoff messages

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
commit-author Ilya Dryomov <idryomov@gmail.com>
commit 914902af4f271884968f72c4fa144c723be2a699
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/914902af.failed

encode_request_finish() is for MOSDOp messages.  Calling it on
MOSDBackoff ack-block messages corrupts them.

Fixes: a02a946dfe96 ("libceph: respect RADOS_BACKOFF backoffs")
	Signed-off-by: Ilya Dryomov <idryomov@gmail.com>
(cherry picked from commit 914902af4f271884968f72c4fa144c723be2a699)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/ceph/osd_client.c
diff --cc net/ceph/osd_client.c
index ad98fe36def9,901bb8221366..000000000000
--- a/net/ceph/osd_client.c
+++ b/net/ceph/osd_client.c
@@@ -5147,6 -5308,14 +5147,17 @@@ static int invalidate_authorizer(struc
  	return ceph_monc_validate_auth(&osdc->client->monc);
  }
  
++<<<<<<< HEAD
++=======
+ static void osd_reencode_message(struct ceph_msg *msg)
+ {
+ 	int type = le16_to_cpu(msg->hdr.type);
+ 
+ 	if (type == CEPH_MSG_OSD_OP)
+ 		encode_request_finish(msg);
+ }
+ 
++>>>>>>> 914902af4f27 (libceph: don't call encode_request_finish() on MOSDBackoff messages)
  static int osd_sign_message(struct ceph_msg *msg)
  {
  	struct ceph_osd *o = msg->con->private;
* Unmerged path net/ceph/osd_client.c
