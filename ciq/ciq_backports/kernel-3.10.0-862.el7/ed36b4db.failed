libnvdimm, btt: check memory allocation failure

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
commit-author Christophe Jaillet <christophe.jaillet@wanadoo.fr>
commit ed36b4dba54a421ce5551638f6a9790b2c2116b1
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/ed36b4db.failed

Check memory allocation failures and return -ENOMEM in such cases, as
already done few lines below for another memory allocation.

This avoids NULL pointers dereference.

	Cc: <stable@vger.kernel.org>
Fixes: 14e494542636 ("libnvdimm, btt: BTT updates for UEFI 2.7 format")
	Signed-off-by: Christophe JAILLET <christophe.jaillet@wanadoo.fr>
	Reviewed-by: Vishal Verma <vishal.l.verma@intel.com>
	Signed-off-by: Dan Williams <dan.j.williams@intel.com>
(cherry picked from commit ed36b4dba54a421ce5551638f6a9790b2c2116b1)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/nvdimm/btt.c
diff --cc drivers/nvdimm/btt.c
index 73d03e1bfbd1,7ec6393b6ba1..000000000000
--- a/drivers/nvdimm/btt.c
+++ b/drivers/nvdimm/btt.c
@@@ -1386,10 -1428,23 +1386,26 @@@ int nvdimm_namespace_attach_btt(struct 
  		return -ENODEV;
  	}
  
++<<<<<<< HEAD
 +	rawsize = nvdimm_namespace_capacity(ndns) - SZ_4K;
++=======
+ 	btt_sb = devm_kzalloc(&nd_btt->dev, sizeof(*btt_sb), GFP_KERNEL);
+ 	if (!btt_sb)
+ 		return -ENOMEM;
+ 
+ 	/*
+ 	 * If this returns < 0, that is ok as it just means there wasn't
+ 	 * an existing BTT, and we're creating a new one. We still need to
+ 	 * call this as we need the version dependent fields in nd_btt to be
+ 	 * set correctly based on the holder class
+ 	 */
+ 	nd_btt_version(nd_btt, ndns, btt_sb);
+ 
+ 	rawsize = nvdimm_namespace_capacity(ndns) - nd_btt->initial_offset;
++>>>>>>> ed36b4dba54a (libnvdimm, btt: check memory allocation failure)
  	if (rawsize < ARENA_MIN_SIZE) {
  		dev_dbg(&nd_btt->dev, "%s must be at least %ld bytes\n",
 -				dev_name(&ndns->dev),
 -				ARENA_MIN_SIZE + nd_btt->initial_offset);
 +				dev_name(&ndns->dev), ARENA_MIN_SIZE + SZ_4K);
  		return -ENXIO;
  	}
  	nd_region = to_nd_region(nd_btt->dev.parent);
* Unmerged path drivers/nvdimm/btt.c
