scsi: fnic: switch to pci_alloc_irq_vectors

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
Rebuild_CHGLOG: - [scsi] fnic: switch to pci_alloc_irq_vectors (Govindarajulu Varadarajan) [1448553]
Rebuild_FUZZ: 92.50%
commit-author Christoph Hellwig <hch@lst.de>
commit cca678dfbad4954d53e58ca6b132b306c56f4423
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/cca678df.failed

Not a full cleanup for the IRQ code, for that we'd need to know if the
max number of the various CQ types is going to stay 1 forever.

	Signed-off-by: Christoph Hellwig <hch@lst.de>
	Acked-by: Satish Kharat <satishkh@cisco.com>
	Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
(cherry picked from commit cca678dfbad4954d53e58ca6b132b306c56f4423)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/scsi/fnic/fnic_isr.c
diff --cc drivers/scsi/fnic/fnic_isr.c
index 7d9b54ae7f62,4e3a50202e8c..000000000000
--- a/drivers/scsi/fnic/fnic_isr.c
+++ b/drivers/scsi/fnic/fnic_isr.c
@@@ -257,8 -251,10 +251,15 @@@ int fnic_set_intr_mode(struct fnic *fni
  	    fnic->raw_wq_count >= m &&
  	    fnic->wq_copy_count >= o &&
  	    fnic->cq_count >= n + m + o) {
++<<<<<<< HEAD
 +		if (!pci_enable_msix(fnic->pdev, fnic->msix_entry,
 +				    n + m + o + 1)) {
++=======
+ 		int vecs = n + m + o + 1;
+ 
+ 		if (pci_alloc_irq_vectors(fnic->pdev, vecs, vecs,
+ 				PCI_IRQ_MSIX) < 0) {
++>>>>>>> cca678dfbad4 (scsi: fnic: switch to pci_alloc_irq_vectors)
  			fnic->rq_count = n;
  			fnic->raw_wq_count = m;
  			fnic->wq_copy_count = o;
diff --git a/drivers/scsi/fnic/fnic.h b/drivers/scsi/fnic/fnic.h
index bc0339c2e645..c1a6cee1b918 100644
--- a/drivers/scsi/fnic/fnic.h
+++ b/drivers/scsi/fnic/fnic.h
@@ -216,7 +216,6 @@ struct fnic {
 	struct fcoe_ctlr ctlr;		/* FIP FCoE controller structure */
 	struct vnic_dev_bar bar0;
 
-	struct msix_entry msix_entry[FNIC_MSIX_INTR_MAX];
 	struct fnic_msix_entry msix[FNIC_MSIX_INTR_MAX];
 
 	struct vnic_stats *stats;
* Unmerged path drivers/scsi/fnic/fnic_isr.c
