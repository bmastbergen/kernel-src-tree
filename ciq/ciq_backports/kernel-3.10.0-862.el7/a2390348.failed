scsi: qla2xxx: Fix logo flag for qlt_free_session_done()

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
Rebuild_CHGLOG: - [scsi] qla2xxx: Fix logo flag for qlt_free_session_done() (Himanshu Madhani) [1524717]
Rebuild_FUZZ: 94.34%
commit-author Himanshu Madhani <hmadhani@redhat.com>
commit a2390348c19d0819d525d375414a7cfdacb51a68
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/a2390348.failed

Commit 3515832cc614 ("scsi: qla2xxx: Reset the logo flag, after target
re-login.")fixed the target re-login after session relogin is complete,
but missed out the qlt_free_session_done() path.

This patch clears send_els_logo flag in qlt_free_session_done()
callback.

[mkp: checkpatch]

Fixes: 3515832cc614 ("scsi: qla2xxx: Reset the logo flag, after target re-login.")
	Signed-off-by: Himanshu Madhani <hmadhani@redhat.com>
	Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
(cherry picked from commit a2390348c19d0819d525d375414a7cfdacb51a68)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/scsi/qla2xxx/qla_target.c
diff --cc drivers/scsi/qla2xxx/qla_target.c
index 4244f37d5d93,fc89af8fe256..000000000000
--- a/drivers/scsi/qla2xxx/qla_target.c
+++ b/drivers/scsi/qla2xxx/qla_target.c
@@@ -340,8 -968,58 +340,62 @@@ static void qlt_free_session_done(struc
  	struct qla_tgt *tgt = sess->tgt;
  	struct scsi_qla_host *vha = sess->vha;
  	struct qla_hw_data *ha = vha->hw;
++<<<<<<< HEAD
++=======
+ 	unsigned long flags;
+ 	bool logout_started = false;
+ 	scsi_qla_host_t *base_vha;
+ 	struct qlt_plogi_ack_t *own =
+ 		sess->plogi_link[QLT_PLOGI_LINK_SAME_WWN];
+ 
+ 	ql_dbg(ql_dbg_tgt_mgt, vha, 0xf084,
+ 		"%s: se_sess %p / sess %p from port %8phC loop_id %#04x"
+ 		" s_id %02x:%02x:%02x logout %d keep %d els_logo %d\n",
+ 		__func__, sess->se_sess, sess, sess->port_name, sess->loop_id,
+ 		sess->d_id.b.domain, sess->d_id.b.area, sess->d_id.b.al_pa,
+ 		sess->logout_on_delete, sess->keep_nport_handle,
+ 		sess->send_els_logo);
+ 
+ 	if (!IS_SW_RESV_ADDR(sess->d_id)) {
+ 		if (sess->send_els_logo) {
+ 			qlt_port_logo_t logo;
+ 
+ 			logo.id = sess->d_id;
+ 			logo.cmd_count = 0;
+ 			sess->send_els_logo = 0;
+ 			qlt_send_first_logo(vha, &logo);
+ 		}
+ 
+ 		if (sess->logout_on_delete && sess->loop_id != FC_NO_LOOP_ID) {
+ 			int rc;
+ 
+ 			if (!own ||
+ 			    (own &&
+ 			     (own->iocb.u.isp24.status_subcode == ELS_PLOGI))) {
+ 				rc = qla2x00_post_async_logout_work(vha, sess,
+ 				    NULL);
+ 				if (rc != QLA_SUCCESS)
+ 					ql_log(ql_log_warn, vha, 0xf085,
+ 					    "Schedule logo failed sess %p rc %d\n",
+ 					    sess, rc);
+ 				else
+ 					logout_started = true;
+ 			} else if (own && (own->iocb.u.isp24.status_subcode ==
+ 				ELS_PRLI) && ha->flags.rida_fmt2) {
+ 				rc = qla2x00_post_async_prlo_work(vha, sess,
+ 				    NULL);
+ 				if (rc != QLA_SUCCESS)
+ 					ql_log(ql_log_warn, vha, 0xf085,
+ 					    "Schedule PRLO failed sess %p rc %d\n",
+ 					    sess, rc);
+ 				else
+ 					logout_started = true;
+ 			}
+ 		}
+ 	}
++>>>>>>> a2390348c19d (scsi: qla2xxx: Fix logo flag for qlt_free_session_done())
  
 +	BUG_ON(!tgt);
  	/*
  	 * Release the target session for FC Nexus from fabric module code.
  	 */
* Unmerged path drivers/scsi/qla2xxx/qla_target.c
