sysfs: honor bin_attr.attr.ignore_lockdep

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
commit-author Tejun Heo <tj@kernel.org>
commit 672f76a81ad524359e761d7c863d24aec58e23c5
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/672f76a8.failed

ignore_lockdep is currently honored only for regular files.  There's
no reason to ignore it for bin files.  Update sysfs_ignore_lockdep()
so that bin_attr.attr.ignore_lockdep works too.

While this doesn't have any in-kernel user, this unifies the behaviors
between regular and bin files and will help later changes.

	Signed-off-by: Tejun Heo <tj@kernel.org>
	Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
(cherry picked from commit 672f76a81ad524359e761d7c863d24aec58e23c5)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	fs/sysfs/sysfs.h
diff --cc fs/sysfs/sysfs.h
index b6deca3e301d,bdce8458af3b..000000000000
--- a/fs/sysfs/sysfs.h
+++ b/fs/sysfs/sysfs.h
@@@ -124,8 -110,25 +124,21 @@@ do {								
  								\
  	lockdep_init_map(&sd->dep_map, "s_active", key, 0);	\
  } while (0)
++<<<<<<< HEAD
++=======
+ 
+ /* Test for attributes that want to ignore lockdep for read-locking */
+ static inline bool sysfs_ignore_lockdep(struct sysfs_dirent *sd)
+ {
+ 	int type = sysfs_type(sd);
+ 
+ 	return (type == SYSFS_KOBJ_ATTR || type == SYSFS_KOBJ_BIN_ATTR) &&
+ 		sd->s_attr.attr->ignore_lockdep;
+ }
+ 
++>>>>>>> 672f76a81ad5 (sysfs: honor bin_attr.attr.ignore_lockdep)
  #else
 -
  #define sysfs_dirent_init_lockdep(sd) do {} while (0)
 -
 -static inline bool sysfs_ignore_lockdep(struct sysfs_dirent *sd)
 -{
 -	return true;
 -}
 -
  #endif
  
  /*
* Unmerged path fs/sysfs/sysfs.h
