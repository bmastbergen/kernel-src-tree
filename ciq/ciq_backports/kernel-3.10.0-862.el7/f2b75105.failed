cls_tcindex: use tcf_exts_get_net() before call_rcu()

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
commit-author Cong Wang <xiyou.wangcong@gmail.com>
commit f2b751053ee9314e82c178f6ca0fee7e160fac95
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/f2b75105.failed

Hold netns refcnt before call_rcu() and release it after
the tcf_exts_destroy() is done.

Note, on ->destroy() path we have to respect the return value
of tcf_exts_get_net(), on other paths it should always return
true, so we don't need to care.

	Cc: Lucas Bates <lucasb@mojatatu.com>
	Cc: Jamal Hadi Salim <jhs@mojatatu.com>
	Cc: Jiri Pirko <jiri@resnulli.us>
	Signed-off-by: Cong Wang <xiyou.wangcong@gmail.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit f2b751053ee9314e82c178f6ca0fee7e160fac95)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/sched/cls_tcindex.c
diff --cc net/sched/cls_tcindex.c
index e079711dac57,a76937ee0b2d..000000000000
--- a/net/sched/cls_tcindex.c
+++ b/net/sched/cls_tcindex.c
@@@ -209,10 -222,19 +221,26 @@@ found
  	 * grace period, since converted-to-rcu actions are relying on that
  	 * in cleanup() callback
  	 */
++<<<<<<< HEAD
 +	if (f)
 +		call_rcu(&f->rcu, tcindex_destroy_fexts);
 +	else
 +		call_rcu(&r->rcu, tcindex_destroy_rexts);
++=======
+ 	if (f) {
+ 		if (tcf_exts_get_net(&f->result.exts))
+ 			call_rcu(&f->rcu, tcindex_destroy_fexts);
+ 		else
+ 			__tcindex_destroy_fexts(f);
+ 	} else {
+ 		if (tcf_exts_get_net(&r->exts))
+ 			call_rcu(&r->rcu, tcindex_destroy_rexts);
+ 		else
+ 			__tcindex_destroy_rexts(r);
+ 	}
+ 
+ 	*last = false;
++>>>>>>> f2b751053ee9 (cls_tcindex: use tcf_exts_get_net() before call_rcu())
  	return 0;
  }
  
* Unmerged path net/sched/cls_tcindex.c
