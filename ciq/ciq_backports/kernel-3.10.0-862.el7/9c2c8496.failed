IB/core: Add new SRQ type IB_SRQT_TM

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
commit-author Artemy Kovalyov <artemyko@mellanox.com>
commit 9c2c849625cf779e0fac41c8be3c163df4b80c14
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/9c2c8496.failed

This patch adds new SRQ type - IB_SRQT_TM. The new SRQ type supports tag
matching and rendezvous offloads for MPI applications.

When SRQ receives a message it will search through the matching list
for the corresponding posted receive buffer. The process of searching
the matching list is called tag matching.
In case the tag matching results in a match, the received message will
be placed in the address specified by the receive buffer. In case no
match was found the message will be placed in a generic buffer until the
corresponding receive buffer will be posted. These messages are called
unexpected and their set is called an unexpected list.

	Signed-off-by: Artemy Kovalyov <artemyko@mellanox.com>
	Reviewed-by: Yossi Itigin <yosefe@mellanox.com>
	Signed-off-by: Leon Romanovsky <leon@kernel.org>
	Signed-off-by: Doug Ledford <dledford@redhat.com>
(cherry picked from commit 9c2c849625cf779e0fac41c8be3c163df4b80c14)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	include/rdma/ib_verbs.h
diff --cc include/rdma/ib_verbs.h
index 4d1f48778a52,1b4bb8743969..000000000000
--- a/include/rdma/ib_verbs.h
+++ b/include/rdma/ib_verbs.h
@@@ -960,9 -991,16 +960,19 @@@ enum ib_cq_notify_flags 
  
  enum ib_srq_type {
  	IB_SRQT_BASIC,
- 	IB_SRQT_XRC
+ 	IB_SRQT_XRC,
+ 	IB_SRQT_TM,
  };
  
++<<<<<<< HEAD
++=======
+ static inline bool ib_srq_has_cq(enum ib_srq_type srq_type)
+ {
+ 	return srq_type == IB_SRQT_XRC ||
+ 	       srq_type == IB_SRQT_TM;
+ }
+ 
++>>>>>>> 9c2c849625cf (IB/core: Add new SRQ type IB_SRQT_TM)
  enum ib_srq_attr_mask {
  	IB_SRQ_MAX_WR	= 1 << 0,
  	IB_SRQ_LIMIT	= 1 << 1,
@@@ -980,11 -1018,17 +990,25 @@@ struct ib_srq_init_attr 
  	struct ib_srq_attr	attr;
  	enum ib_srq_type	srq_type;
  
++<<<<<<< HEAD
 +	union {
 +		struct {
 +			struct ib_xrcd *xrcd;
 +			struct ib_cq   *cq;
 +		} xrc;
++=======
+ 	struct {
+ 		struct ib_cq   *cq;
+ 		union {
+ 			struct {
+ 				struct ib_xrcd *xrcd;
+ 			} xrc;
+ 
+ 			struct {
+ 				u32		max_num_tags;
+ 			} tag_matching;
+ 		};
++>>>>>>> 9c2c849625cf (IB/core: Add new SRQ type IB_SRQT_TM)
  	} ext;
  };
  
* Unmerged path include/rdma/ib_verbs.h
