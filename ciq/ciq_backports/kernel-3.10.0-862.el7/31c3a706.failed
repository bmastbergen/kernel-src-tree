Revert "ovl: get_write_access() in truncate"

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
commit-author Miklos Szeredi <mszeredi@redhat.com>
commit 31c3a7069593b072bd57192b63b62f9a7e994e9a
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/31c3a706.failed

This reverts commit 03bea60409328de54e4ff7ec41672e12a9cb0908.

Commit 4d0c5ba2ff79 ("vfs: do get_write_access() on upper layer of
overlayfs") makes the writecount checks inside overlayfs superfluous, the
file is already copied up and write access acquired on the upper inode when
ovl_setattr is called with ATTR_SIZE.

	Signed-off-by: Miklos Szeredi <mszeredi@redhat.com>
(cherry picked from commit 31c3a7069593b072bd57192b63b62f9a7e994e9a)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	fs/overlayfs/inode.c
diff --cc fs/overlayfs/inode.c
index b5466ac817a0,a572e38349f6..000000000000
--- a/fs/overlayfs/inode.c
+++ b/fs/overlayfs/inode.c
@@@ -95,12 -77,8 +78,15 @@@ int ovl_setattr(struct dentry *dentry, 
  		revert_creds(old_cred);
  		if (!err)
  			ovl_copyattr(upperdentry->d_inode, dentry->d_inode);
++<<<<<<< HEAD
 +		mutex_unlock(&upperdentry->d_inode->i_mutex);
 +
 +		if (winode)
 +			put_write_access(winode);
++=======
+ 		inode_unlock(upperdentry->d_inode);
++>>>>>>> 31c3a7069593 (Revert "ovl: get_write_access() in truncate")
  	}
- out_drop_write:
  	ovl_drop_write(dentry);
  out:
  	return err;
* Unmerged path fs/overlayfs/inode.c
