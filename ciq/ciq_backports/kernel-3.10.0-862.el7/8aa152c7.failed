ceph: remove ceph_mdsc_lease_release

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
commit-author Jeff Layton <jlayton@redhat.com>
commit 8aa152c77890abd0731f119e4e6662375503e288
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/8aa152c7.failed

Nothing calls it.

	Signed-off-by: Jeff Layton <jlayton@redhat.com>
	Reviewed-by: Yan, Zheng <zyan@redhat.com>
(cherry picked from commit 8aa152c77890abd0731f119e4e6662375503e288)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	fs/ceph/mds_client.c
diff --cc fs/ceph/mds_client.c
index 031b5b4535be,78a3495a11be..000000000000
--- a/fs/ceph/mds_client.c
+++ b/fs/ceph/mds_client.c
@@@ -3299,47 -3292,6 +3299,50 @@@ void ceph_mdsc_lease_send_msg(struct ce
  }
  
  /*
++<<<<<<< HEAD
 + * Preemptively release a lease we expect to invalidate anyway.
 + * Pass @inode always, @dentry is optional.
 + */
 +void ceph_mdsc_lease_release(struct ceph_mds_client *mdsc, struct inode *inode,
 +			     struct dentry *dentry)
 +{
 +	struct ceph_dentry_info *di;
 +	struct ceph_mds_session *session;
 +	u32 seq;
 +
 +	BUG_ON(inode == NULL);
 +	BUG_ON(dentry == NULL);
 +
 +	/* is dentry lease valid? */
 +	spin_lock(&dentry->d_lock);
 +	di = ceph_dentry(dentry);
 +	if (!di || !di->lease_session ||
 +	    di->lease_session->s_mds < 0 ||
 +	    di->lease_gen != di->lease_session->s_cap_gen ||
 +	    !time_before(jiffies, dentry->d_time)) {
 +		dout("lease_release inode %p dentry %p -- "
 +		     "no lease\n",
 +		     inode, dentry);
 +		spin_unlock(&dentry->d_lock);
 +		return;
 +	}
 +
 +	/* we do have a lease on this dentry; note mds and seq */
 +	session = ceph_get_mds_session(di->lease_session);
 +	seq = di->lease_seq;
 +	__ceph_mdsc_drop_dentry_lease(dentry);
 +	spin_unlock(&dentry->d_lock);
 +
 +	dout("lease_release inode %p dentry %p to mds%d\n",
 +	     inode, dentry, session->s_mds);
 +	ceph_mdsc_lease_send_msg(session, inode, dentry,
 +				 CEPH_MDS_LEASE_RELEASE, seq);
 +	ceph_put_mds_session(session);
 +}
 +
 +/*
++=======
++>>>>>>> 8aa152c77890 (ceph: remove ceph_mdsc_lease_release)
   * drop all leases (and dentry refs) in preparation for umount
   */
  static void drop_leases(struct ceph_mds_client *mdsc)
* Unmerged path fs/ceph/mds_client.c
diff --git a/fs/ceph/mds_client.h b/fs/ceph/mds_client.h
index 37712ccffcc6..e94d0a67cd49 100644
--- a/fs/ceph/mds_client.h
+++ b/fs/ceph/mds_client.h
@@ -375,10 +375,6 @@ extern void ceph_mdsc_destroy(struct ceph_fs_client *fsc);
 
 extern void ceph_mdsc_sync(struct ceph_mds_client *mdsc);
 
-extern void ceph_mdsc_lease_release(struct ceph_mds_client *mdsc,
-				    struct inode *inode,
-				    struct dentry *dn);
-
 extern void ceph_invalidate_dir_request(struct ceph_mds_request *req);
 extern int ceph_alloc_readdir_reply_buffer(struct ceph_mds_request *req,
 					   struct inode *dir);
