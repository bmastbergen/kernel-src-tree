mlxsw: spectrum_router: Create IPv4 specific entry struct

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
commit-author Ido Schimmel <idosch@mellanox.com>
commit 4f1c7f1f2e954cca8230fad4b33b192f84307f50
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/4f1c7f1f.failed

Some of the parameters stored in the FIB entry structure are specific to
IPv4 and therefore better placed in an IPv4 specific structure.

Create an IPv4 specific structure that encapsulates the common FIB entry
structure and contains IPv4 specific parameters.

In a follow-up patchset an IPv6 specific structure will be introduced.

	Signed-off-by: Ido Schimmel <idosch@mellanox.com>
	Signed-off-by: Jiri Pirko <jiri@mellanox.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 4f1c7f1f2e954cca8230fad4b33b192f84307f50)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/mellanox/mlxsw/spectrum_router.c
diff --cc drivers/net/ethernet/mellanox/mlxsw/spectrum_router.c
index ba2b4952cadc,52487a4db09e..000000000000
--- a/drivers/net/ethernet/mellanox/mlxsw/spectrum_router.c
+++ b/drivers/net/ethernet/mellanox/mlxsw/spectrum_router.c
@@@ -155,7 -396,26 +148,29 @@@ struct mlxsw_sp_fib_entry 
  	bool offloaded;
  };
  
++<<<<<<< HEAD
++=======
+ struct mlxsw_sp_fib4_entry {
+ 	struct mlxsw_sp_fib_entry common;
+ 	u32 tb_id;
+ 	u32 prio;
+ 	u8 tos;
+ 	u8 type;
+ };
+ 
+ enum mlxsw_sp_l3proto {
+ 	MLXSW_SP_L3_PROTO_IPV4,
+ 	MLXSW_SP_L3_PROTO_IPV6,
+ };
+ 
+ struct mlxsw_sp_lpm_tree {
+ 	u8 id; /* tree ID */
+ 	unsigned int ref_count;
+ 	enum mlxsw_sp_l3proto proto;
+ 	struct mlxsw_sp_prefix_usage prefix_usage;
+ };
+ 
++>>>>>>> 4f1c7f1f2e95 (mlxsw: spectrum_router: Create IPv4 specific entry struct)
  struct mlxsw_sp_fib {
  	struct rhashtable ht;
  	struct list_head node_list;
@@@ -2466,19 -2816,19 +2503,19 @@@ err_fib4_entry_create
  static void mlxsw_sp_router_fib4_del(struct mlxsw_sp *mlxsw_sp,
  				     struct fib_entry_notifier_info *fen_info)
  {
- 	struct mlxsw_sp_fib_entry *fib_entry;
+ 	struct mlxsw_sp_fib4_entry *fib4_entry;
  	struct mlxsw_sp_fib_node *fib_node;
  
 -	if (mlxsw_sp->router->aborted)
 +	if (mlxsw_sp->router.aborted)
  		return;
  
- 	fib_entry = mlxsw_sp_fib4_entry_lookup(mlxsw_sp, fen_info);
- 	if (WARN_ON(!fib_entry))
+ 	fib4_entry = mlxsw_sp_fib4_entry_lookup(mlxsw_sp, fen_info);
+ 	if (WARN_ON(!fib4_entry))
  		return;
- 	fib_node = fib_entry->fib_node;
+ 	fib_node = fib4_entry->common.fib_node;
  
- 	mlxsw_sp_fib4_node_entry_unlink(mlxsw_sp, fib_entry);
- 	mlxsw_sp_fib4_entry_destroy(mlxsw_sp, fib_entry);
+ 	mlxsw_sp_fib4_node_entry_unlink(mlxsw_sp, fib4_entry);
+ 	mlxsw_sp_fib4_entry_destroy(mlxsw_sp, fib4_entry);
  	mlxsw_sp_fib_node_put(mlxsw_sp, fib_node);
  }
  
* Unmerged path drivers/net/ethernet/mellanox/mlxsw/spectrum_router.c
