ALSA: x86: Fix memory leak in had_build_channel_allocation_map()

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
commit-author Takashi Iwai <tiwai@suse.de>
commit 18353192b8f696a27420e2e8f39804c2075f26fb
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/18353192.failed

The previously allocated chmap has to be released before setting the
new one.

	Signed-off-by: Takashi Iwai <tiwai@suse.de>
(cherry picked from commit 18353192b8f696a27420e2e8f39804c2075f26fb)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	sound/x86/intel_hdmi_audio.c
diff --cc sound/x86/intel_hdmi_audio.c
index 3dd33e089501,5f2445389716..000000000000
--- a/sound/x86/intel_hdmi_audio.c
+++ b/sound/x86/intel_hdmi_audio.c
@@@ -468,17 -444,15 +468,23 @@@ void had_build_channel_allocation_map(s
  	u8 eld_high, eld_high_mask = 0xF0;
  	u8 high_msb;
  
+ 	kfree(intelhaddata->chmap->chmap);
+ 	intelhaddata->chmap->chmap = NULL;
+ 
  	chmap = kzalloc(sizeof(*chmap), GFP_KERNEL);
++<<<<<<< HEAD
 +	if (chmap == NULL) {
 +		intelhaddata->chmap->chmap = NULL;
++=======
+ 	if (!chmap)
++>>>>>>> 18353192b8f6 (ALSA: x86: Fix memory leak in had_build_channel_allocation_map())
  		return;
- 	}
  
 -	dev_dbg(intelhaddata->dev, "eld speaker = %x\n",
 -		intelhaddata->eld[DRM_ELD_SPEAKER]);
 +	had_get_caps(intelhaddata, HAD_GET_ELD, &intelhaddata->eeld);
 +	had_get_caps(intelhaddata, HAD_GET_DP_OUTPUT, &intelhaddata->dp_output);
 +
 +	pr_debug("eeld.speaker_allocation_block = %x\n",
 +			intelhaddata->eeld.speaker_allocation_block);
  
  	/* WA: Fix the max channel supported to 8 */
  
* Unmerged path sound/x86/intel_hdmi_audio.c
