i40e: fix disabling overflow promiscuous mode

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
commit-author Alan Brady <alan.brady@intel.com>
commit e588723986845457942e8a1acb1e31cf18e8eb08
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/e5887239.failed

There exists a bug in which the driver does not correctly exit overflow
promiscuous mode.  This can occur if "too many" mac filters are added,
putting the driver into overflow promiscuous mode, and the filters are
then removed.  When the failed filters are removed, the driver reports
exiting overflow promiscuous mode which is correct, however traffic
continues to be received as if in promiscuous mode still.

The bug occurs because the conditional for toggling promiscuous mode was
set to only execute when promiscuous mode was enabled and not when it
was disabled as well.  This patch fixes the conditional to correctly
execute when promiscuous mode is toggled and not just enabled.  Without
this patch, the driver is unable to correctly exit overflow promiscuous
mode.

	Signed-off-by: Alan Brady <alan.brady@intel.com>
	Tested-by: Andrew Bowers <andrewx.bowers@intel.com>
	Signed-off-by: Jeff Kirsher <jeffrey.t.kirsher@intel.com>
(cherry picked from commit e588723986845457942e8a1acb1e31cf18e8eb08)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/intel/i40e/i40e_main.c
diff --cc drivers/net/ethernet/intel/i40e/i40e_main.c
index 39821eb982b6,b743eca879d5..000000000000
--- a/drivers/net/ethernet/intel/i40e/i40e_main.c
+++ b/drivers/net/ethernet/intel/i40e/i40e_main.c
@@@ -2339,9 -2281,8 +2339,14 @@@ int i40e_sync_vsi_filters(struct i40e_v
  				 i40e_aq_str(hw, hw->aq.asq_last_status));
  		}
  	}
++<<<<<<< HEAD
 +	if ((changed_flags & IFF_PROMISC) ||
 +	    (promisc_changed &&
 +	     test_bit(__I40E_FILTER_OVERFLOW_PROMISC, &vsi->state))) {
++=======
+ 
+ 	if ((changed_flags & IFF_PROMISC) || promisc_changed) {
++>>>>>>> e58872398684 (i40e: fix disabling overflow promiscuous mode)
  		bool cur_promisc;
  
  		cur_promisc = (!!(vsi->current_netdev_flags & IFF_PROMISC) ||
* Unmerged path drivers/net/ethernet/intel/i40e/i40e_main.c
