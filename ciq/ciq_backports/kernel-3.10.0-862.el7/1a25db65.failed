drm/i915/cnl: Apply large line width optimization

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
commit-author Rodrigo Vivi <rodrigo.vivi@intel.com>
commit 1a25db65d39cc6c1bdc2bdb999611311f8fec3da
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/1a25db65.failed

This bit enables hardware that will change the approximation used for distances
calculations for AA wide lines so that they are rendered more accurately.

The default value for this bit leaves the legacy behavior. There is no good
reason to not enable the new approximation except if comparing to previous GEN
rendered images.

v2: Rebase
v3: Fix author.
    Rebased by Rodrigo who also added  a comment as suggested by Oscar.
    Since it is surrounded by Workarounds let's just add a comment to
    make clear it is not an Wa.

	Cc: Oscar Mateo <oscar.mateo@intel.com>
	Signed-off-by: Ben Widawsky <benjamin.widawsky@intel.com>
	Signed-off-by: Rodrigo Vivi <rodrigo.vivi@intel.com>
	Reviewed-by: Oscar Mateo <oscar.mateo@intel.com>
Link: https://patchwork.freedesktop.org/patch/msgid/20170815231651.975-4-rodrigo.vivi@intel.com
(cherry picked from commit 1a25db65d39cc6c1bdc2bdb999611311f8fec3da)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/gpu/drm/i915/intel_pm.c
diff --cc drivers/gpu/drm/i915/intel_pm.c
index 52c3abe82e2f,68187bcfded4..000000000000
--- a/drivers/gpu/drm/i915/intel_pm.c
+++ b/drivers/gpu/drm/i915/intel_pm.c
@@@ -7154,6 -8263,27 +7154,30 @@@ static void gen8_set_l3sqc_credits(stru
  	I915_WRITE(GEN7_MISCCPCTL, misccpctl);
  }
  
++<<<<<<< HEAD
++=======
+ static void cannonlake_init_clock_gating(struct drm_i915_private *dev_priv)
+ {
+ 	/* This is not an Wa. Enable for better image quality */
+ 	I915_WRITE(_3D_CHICKEN3,
+ 		   _MASKED_BIT_ENABLE(_3D_CHICKEN3_AA_LINE_QUALITY_FIX_ENABLE));
+ 
+ 	/* WaEnableChickenDCPR:cnl */
+ 	I915_WRITE(GEN8_CHICKEN_DCPR_1,
+ 		   I915_READ(GEN8_CHICKEN_DCPR_1) | MASK_WAKEMEM);
+ 
+ 	/* WaFbcWakeMemOn:cnl */
+ 	I915_WRITE(DISP_ARB_CTL, I915_READ(DISP_ARB_CTL) |
+ 		   DISP_FBC_MEMORY_WAKE);
+ 
+ 	/* WaSarbUnitClockGatingDisable:cnl (pre-prod) */
+ 	if (IS_CNL_REVID(dev_priv, CNL_REVID_A0, CNL_REVID_B0))
+ 		I915_WRITE(SLICE_UNIT_LEVEL_CLKGATE,
+ 			   I915_READ(SLICE_UNIT_LEVEL_CLKGATE) |
+ 			   SARBUNIT_CLKGATE_DIS);
+ }
+ 
++>>>>>>> 1a25db65d39c (drm/i915/cnl: Apply large line width optimization)
  static void kabylake_init_clock_gating(struct drm_i915_private *dev_priv)
  {
  	gen9_init_clock_gating(dev_priv);
diff --git a/drivers/gpu/drm/i915/i915_reg.h b/drivers/gpu/drm/i915/i915_reg.h
index c70c07a7b586..cbeb49c385dc 100644
--- a/drivers/gpu/drm/i915/i915_reg.h
+++ b/drivers/gpu/drm/i915/i915_reg.h
@@ -1731,6 +1731,7 @@ enum skl_disp_power_wells {
 # define _3D_CHICKEN2_WM_READ_PIPELINED			(1 << 14)
 #define _3D_CHICKEN3	_MMIO(0x2090)
 #define  _3D_CHICKEN_SF_DISABLE_OBJEND_CULL		(1 << 10)
+#define  _3D_CHICKEN3_AA_LINE_QUALITY_FIX_ENABLE	(1 << 5)
 #define  _3D_CHICKEN3_SF_DISABLE_FASTCLIP_CULL		(1 << 5)
 #define  _3D_CHICKEN_SDE_LIMIT_FIFO_POLY_DEPTH(x)	((x)<<1) /* gen8+ */
 #define  _3D_CHICKEN3_SF_DISABLE_PIPELINED_ATTR_FETCH	(1 << 1) /* gen6 */
* Unmerged path drivers/gpu/drm/i915/intel_pm.c
