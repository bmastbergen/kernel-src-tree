fib_trie: Only display main table in /proc/net/route

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
commit-author Alexander Duyck <alexander.h.duyck@redhat.com>
commit 654eff45166c7e89d18fc476325c975768b2e347
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/654eff45.failed

When we merged the tries for local and main I had overlooked the iterator
for /proc/net/route.  As a result it was outputting both local and main
when the two tries were merged.

This patch resolves that by only providing output for aliases that are
actually in the main trie.  As a result we should go back to the original
behavior which I assume will be necessary to maintain legacy support.

Fixes: 0ddcf43d5 ("ipv4: FIB Local/MAIN table collapse")
	Signed-off-by: Alexander Duyck <alexander.h.duyck@redhat.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 654eff45166c7e89d18fc476325c975768b2e347)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/ipv4/fib_trie.c
diff --cc net/ipv4/fib_trie.c
index c6fa84ea0802,dd488c102d89..000000000000
--- a/net/ipv4/fib_trie.c
+++ b/net/ipv4/fib_trie.c
@@@ -2535,27 -2563,32 +2537,35 @@@ static int fib_route_seq_show(struct se
  		    (fa->fa_type == RTN_MULTICAST))
  			continue;
  
++<<<<<<< HEAD
++=======
+ 		if (fa->tb_id != tb->tb_id)
+ 			continue;
+ 
+ 		seq_setwidth(seq, 127);
+ 
++>>>>>>> 654eff45166c (fib_trie: Only display main table in /proc/net/route)
  		if (fi)
  			seq_printf(seq,
 -				   "%s\t%08X\t%08X\t%04X\t%d\t%u\t"
 -				   "%d\t%08X\t%d\t%u\t%u",
 -				   fi->fib_dev ? fi->fib_dev->name : "*",
 -				   prefix,
 -				   fi->fib_nh->nh_gw, flags, 0, 0,
 -				   fi->fib_priority,
 -				   mask,
 -				   (fi->fib_advmss ?
 -				    fi->fib_advmss + 40 : 0),
 -				   fi->fib_window,
 -				   fi->fib_rtt >> 3);
 +				 "%s\t%08X\t%08X\t%04X\t%d\t%u\t"
 +				 "%d\t%08X\t%d\t%u\t%u%n",
 +				 fi->fib_dev ? fi->fib_dev->name : "*",
 +				 prefix,
 +				 fi->fib_nh->nh_gw, flags, 0, 0,
 +				 fi->fib_priority,
 +				 mask,
 +				 (fi->fib_advmss ?
 +				  fi->fib_advmss + 40 : 0),
 +				 fi->fib_window,
 +				 fi->fib_rtt >> 3, &len);
  		else
  			seq_printf(seq,
 -				   "*\t%08X\t%08X\t%04X\t%d\t%u\t"
 -				   "%d\t%08X\t%d\t%u\t%u",
 -				   prefix, 0, flags, 0, 0, 0,
 -				   mask, 0, 0, 0);
 +				 "*\t%08X\t%08X\t%04X\t%d\t%u\t"
 +				 "%d\t%08X\t%d\t%u\t%u%n",
 +				 prefix, 0, flags, 0, 0, 0,
 +				 mask, 0, 0, 0, &len);
  
 -		seq_pad(seq, '\n');
 +		seq_printf(seq, "%*s\n", 127 - len, "");
  	}
  
  	return 0;
* Unmerged path net/ipv4/fib_trie.c
