net_sched: netem: do not call qdisc_drop() with a NULL skb

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
commit-author Eric Dumazet <edumazet@google.com>
commit 8a6e9c670341db1ee913e3888cb44a08f18e7489
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/8a6e9c67.failed

If skb_unshare() fails, we call qdisc_drop() with a NULL skb, which
is no longer supported.

Fixes: 520ac30f4551 ("net_sched: drop packets after root qdisc lock is released")
	Signed-off-by: Eric Dumazet <edumazet@google.com>
	Reported-by: Dan Carpenter <dan.carpenter@oracle.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 8a6e9c670341db1ee913e3888cb44a08f18e7489)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/sched/sch_netem.c
diff --cc net/sched/sch_netem.c
index 759dca493346,6eac3d880048..000000000000
--- a/net/sched/sch_netem.c
+++ b/net/sched/sch_netem.c
@@@ -498,10 -487,14 +498,21 @@@ static int netem_enqueue(struct sk_buf
  		skb = segs;
  		segs = segs->next;
  
++<<<<<<< HEAD
 +		if (!(skb = skb_unshare(skb, GFP_ATOMIC)) ||
 +		    (skb->ip_summed == CHECKSUM_PARTIAL &&
 +		     skb_checksum_help(skb))) {
 +			rc = qdisc_drop(skb, sch);
++=======
+ 		skb = skb_unshare(skb, GFP_ATOMIC);
+ 		if (unlikely(!skb)) {
+ 			qdisc_qstats_drop(sch);
+ 			goto finish_segs;
+ 		}
+ 		if (skb->ip_summed == CHECKSUM_PARTIAL &&
+ 		    skb_checksum_help(skb)) {
+ 			qdisc_drop(skb, sch, to_free);
++>>>>>>> 8a6e9c670341 (net_sched: netem: do not call qdisc_drop() with a NULL skb)
  			goto finish_segs;
  		}
  
* Unmerged path net/sched/sch_netem.c
