ceph: cleanup ceph_readdir_prepopulate()

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
commit-author Yan, Zheng <zyan@redhat.com>
commit 9a86962b35be06c8908028975e2261e4df0f79fd
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/9a86962b.failed

In LSSNAP case, req->r_dentry is already set to snapdir dentry.

	Signed-off-by: "Yan, Zheng" <zyan@redhat.com>
	Signed-off-by: Ilya Dryomov <idryomov@gmail.com>
(cherry picked from commit 9a86962b35be06c8908028975e2261e4df0f79fd)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	fs/ceph/inode.c
diff --cc fs/ceph/inode.c
index 9e0ac8e3a6f6,2c5db3686173..000000000000
--- a/fs/ceph/inode.c
+++ b/fs/ceph/inode.c
@@@ -1443,10 -1477,10 +1443,9 @@@ int ceph_readdir_prepopulate(struct cep
  	struct dentry *dn;
  	struct inode *in;
  	int err = 0, skipped = 0, ret, i;
- 	struct inode *snapdir = NULL;
  	struct ceph_mds_request_head *rhead = req->r_request->front.iov_base;
 +	struct ceph_dentry_info *di;
  	u32 frag = le32_to_cpu(rhead->args.readdir.frag);
 -	u32 last_hash = 0;
 -	u32 fpos_offset;
  	struct ceph_readdir_cache_control cache_ctl = {};
  
  	if (test_bit(CEPH_MDS_R_ABORTED, &req->r_req_flags))
@@@ -1464,8 -1509,6 +1463,11 @@@
  	}
  
  	if (le32_to_cpu(rinfo->head->op) == CEPH_MDS_OP_LSSNAP) {
++<<<<<<< HEAD
 +		snapdir = ceph_get_snapdir(parent->d_inode);
 +		parent = d_find_alias(snapdir);
++=======
++>>>>>>> 9a86962b35be (ceph: cleanup ceph_readdir_prepopulate())
  		dout("readdir_prepopulate %d items under SNAPDIR dn %p\n",
  		     rinfo->dir_nr, parent);
  	} else {
* Unmerged path fs/ceph/inode.c
