ovl: compare inodes

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
commit-author Miklos Szeredi <mszeredi@redhat.com>
commit 9020df37207867272e590a416c2fb3da0e5383c6
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/9020df37.failed

When checking for consistency in directory operations (unlink, rename,
etc.) match inodes not dentries.

	Signed-off-by: Miklos Szeredi <mszeredi@redhat.com>
(cherry picked from commit 9020df37207867272e590a416c2fb3da0e5383c6)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	fs/overlayfs/dir.c
diff --cc fs/overlayfs/dir.c
index 709c8eb662f9,59e0dc9897fb..000000000000
--- a/fs/overlayfs/dir.c
+++ b/fs/overlayfs/dir.c
@@@ -730,14 -711,15 +735,26 @@@ static int ovl_remove_upper(struct dent
  		goto out_unlock;
  
  	err = -ESTALE;
++<<<<<<< HEAD
 +	if (upper == ovl_dentry_upper(dentry)) {
 +		if (is_dir)
 +			err = vfs_rmdir(dir, upper);
 +		else
 +			err = vfs_unlink(dir, upper, NULL);
 +		ovl_dentry_version_inc(dentry->d_parent);
 +	}
 +	dput(upper);
++=======
+ 	if ((opaquedir && upper != opaquedir) ||
+ 	    (!opaquedir && !ovl_matches_upper(dentry, upper)))
+ 		goto out_dput_upper;
+ 
+ 	if (is_dir)
+ 		err = vfs_rmdir(dir, upper);
+ 	else
+ 		err = vfs_unlink(dir, upper, NULL);
+ 	ovl_dentry_version_inc(dentry->d_parent);
++>>>>>>> 9020df372078 (ovl: compare inodes)
  
  	/*
  	 * Keeping this dentry hashed would mean having to release
* Unmerged path fs/overlayfs/dir.c
