net/mlx5e: Add rollback on add VLAN failure

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
Rebuild_CHGLOG: - [netdrv] mlx5e: Add rollback on add VLAN failure (Kamal Heib) [1525603]
Rebuild_FUZZ: 95.12%
commit-author Gal Pressman <galp@mellanox.com>
commit 355368d530460aa19b9d4291e2da2c6fd8929c76
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/355368d5.failed

When add VLAN rule fails the active vlan bit should be cleared.

Fixes: afb736e9330a ("net/mlx5: Ethernet resource handling files")
	Signed-off-by: Gal Pressman <galp@mellanox.com>
	Reviewed-by: Maor Gottlieb <maorg@mellanox.com>
	Signed-off-by: Saeed Mahameed <saeedm@mellanox.com>
(cherry picked from commit 355368d530460aa19b9d4291e2da2c6fd8929c76)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/mellanox/mlx5/core/en_fs.c
diff --cc drivers/net/ethernet/mellanox/mlx5/core/en_fs.c
index b408896f4719,d3d775a93183..000000000000
--- a/drivers/net/ethernet/mellanox/mlx5/core/en_fs.c
+++ b/drivers/net/ethernet/mellanox/mlx5/core/en_fs.c
@@@ -310,10 -309,15 +310,19 @@@ int mlx5e_vlan_rx_add_vid(struct net_de
  			  u16 vid)
  {
  	struct mlx5e_priv *priv = netdev_priv(dev);
+ 	int err;
  
 -	set_bit(vid, priv->fs.vlan.active_cvlans);
 +	set_bit(vid, priv->fs.vlan.active_vlans);
  
++<<<<<<< HEAD
 +	return mlx5e_add_vlan_rule(priv, MLX5E_VLAN_RULE_TYPE_MATCH_VID, vid);
++=======
+ 	err = mlx5e_add_vlan_rule(priv, MLX5E_VLAN_RULE_TYPE_MATCH_CTAG_VID, vid);
+ 	if (err)
+ 		clear_bit(vid, priv->fs.vlan.active_cvlans);
+ 
+ 	return err;
++>>>>>>> 355368d53046 (net/mlx5e: Add rollback on add VLAN failure)
  }
  
  int mlx5e_vlan_rx_kill_vid(struct net_device *dev, __always_unused __be16 proto,
* Unmerged path drivers/net/ethernet/mellanox/mlx5/core/en_fs.c
