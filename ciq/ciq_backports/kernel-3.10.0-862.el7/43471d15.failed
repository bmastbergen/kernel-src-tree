audit_tree: Use mark flags to check whether mark is alive

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
commit-author Jan Kara <jack@suse.cz>
commit 43471d15df0e7c40ca4df1513fc1dcf5765396ac
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/43471d15.failed

Currently audit code uses checking of mark->inode to verify whether mark
is still alive. Switch that to checking mark flags as that is more
logical and current way will become unreliable in future.

	Reviewed-by: Miklos Szeredi <mszeredi@redhat.com>
	Signed-off-by: Jan Kara <jack@suse.cz>
(cherry picked from commit 43471d15df0e7c40ca4df1513fc1dcf5765396ac)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	kernel/audit_tree.c
diff --cc kernel/audit_tree.c
index 4dfdb945bae9,51451245936a..000000000000
--- a/kernel/audit_tree.c
+++ b/kernel/audit_tree.c
@@@ -171,12 -187,12 +171,16 @@@ static inline struct list_head *chunk_h
  /* hash_lock & entry->lock is held by caller */
  static void insert_hash(struct audit_chunk *chunk)
  {
 -	unsigned long key = chunk_to_key(chunk);
 +	struct fsnotify_mark *entry = &chunk->mark;
  	struct list_head *list;
  
++<<<<<<< HEAD
 +	if (!entry->inode)
++=======
+ 	if (!(chunk->mark.flags & FSNOTIFY_MARK_FLAG_ATTACHED))
++>>>>>>> 43471d15df0e (audit_tree: Use mark flags to check whether mark is alive)
  		return;
 -	list = chunk_hash(key);
 +	list = chunk_hash(entry->inode);
  	list_add_rcu(&chunk->hash, list);
  }
  
* Unmerged path kernel/audit_tree.c
