bridge: modify bridge and port to have often accessed fields in one cache line

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
commit-author Nikolay Aleksandrov <nikolay@cumulusnetworks.com>
commit 1f90c7f3470580e24da25f6a6c1fb480ed9371ac
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/1f90c7f3.failed

Move around net_bridge so the vlan fields are in the beginning since
they're checked on every packet even if vlan filtering is disabled.
For the port move flags & vlan group to the beginning, so they're in the
same cache line with the port's state (both flags and state are checked
on each packet).

	Signed-off-by: Nikolay Aleksandrov <nikolay@cumulusnetworks.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 1f90c7f3470580e24da25f6a6c1fb480ed9371ac)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/bridge/br_private.h
diff --cc net/bridge/br_private.h
index f039f4f78237,ec8560349b6f..000000000000
--- a/net/bridge/br_private.h
+++ b/net/bridge/br_private.h
@@@ -283,14 -282,21 +282,27 @@@ static inline struct net_bridge_port *b
  		rtnl_dereference(dev->rx_handler_data) : NULL;
  }
  
- struct net_bridge
- {
+ struct net_bridge {
  	spinlock_t			lock;
+ 	spinlock_t			hash_lock;
  	struct list_head		port_list;
  	struct net_device		*dev;
++<<<<<<< HEAD
 +
 +	RH_KABI_REPLACE(struct br_cpu_netstats __percpu *stats, struct pcpu_sw_netstats		__percpu *stats)
 +	spinlock_t			hash_lock;
++=======
+ 	struct pcpu_sw_netstats		__percpu *stats;
+ 	/* These fields are accessed on each packet */
+ #ifdef CONFIG_BRIDGE_VLAN_FILTERING
+ 	u8				vlan_enabled;
+ 	u8				vlan_stats_enabled;
+ 	__be16				vlan_proto;
+ 	u16				default_pvid;
+ 	struct net_bridge_vlan_group	__rcu *vlgrp;
+ #endif
+ 
++>>>>>>> 1f90c7f34705 (bridge: modify bridge and port to have often accessed fields in one cache line)
  	struct hlist_head		hash[BR_HASH_SIZE];
  #if IS_ENABLED(CONFIG_BRIDGE_NETFILTER)
  	union {
* Unmerged path net/bridge/br_private.h
