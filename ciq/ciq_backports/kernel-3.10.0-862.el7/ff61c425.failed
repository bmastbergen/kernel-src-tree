RDMA/netlink: Simplify and rename ibnl_chk_listeners

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
Rebuild_CHGLOG: - [infiniband] netlink: Simplify and rename ibnl_chk_listeners (Don Dutile) [1499364]
Rebuild_FUZZ: 94.95%
commit-author Leon Romanovsky <leonro@mellanox.com>
commit ff61c425c1c563f1d688d59caf3b18a395cbf9c4
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/ff61c425.failed

Make ibnl_chk_listeners function to be one line by removing
unneeded comparison.

Rename that function to be complaint to other functions in RDMA netlink.

	Signed-off-by: Leon Romanovsky <leonro@mellanox.com>
	Reviewed-by: Steve Wise <swise@opengridcomputing.com>
(cherry picked from commit ff61c425c1c563f1d688d59caf3b18a395cbf9c4)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/infiniband/core/sa_query.c
diff --cc drivers/infiniband/core/sa_query.c
index 2eb90b156b94,2cc85c2b74b7..000000000000
--- a/drivers/infiniband/core/sa_query.c
+++ b/drivers/infiniband/core/sa_query.c
@@@ -1172,8 -1416,9 +1172,14 @@@ static int send_mad(struct ib_sa_query 
  	query->mad_buf->context[0] = query;
  	query->id = id;
  
++<<<<<<< HEAD
 +	if (query->flags & IB_SA_ENABLE_LOCAL_SERVICE) {
 +		if (!ibnl_chk_listeners(RDMA_NL_GROUP_LS)) {
++=======
+ 	if ((query->flags & IB_SA_ENABLE_LOCAL_SERVICE) &&
+ 	    (!(query->flags & IB_SA_QUERY_OPA))) {
+ 		if (!rdma_nl_chk_listeners(RDMA_NL_GROUP_LS)) {
++>>>>>>> ff61c425c1c5 (RDMA/netlink: Simplify and rename ibnl_chk_listeners)
  			if (!ib_nl_make_request(query, gfp_mask))
  				return id;
  		}
diff --git a/drivers/infiniband/core/addr.c b/drivers/infiniband/core/addr.c
index 27485694190c..e75a1839424f 100644
--- a/drivers/infiniband/core/addr.c
+++ b/drivers/infiniband/core/addr.c
@@ -325,7 +325,7 @@ static void queue_req(struct addr_req *req)
 static int ib_nl_fetch_ha(struct dst_entry *dst, struct rdma_dev_addr *dev_addr,
 			  const void *daddr, u32 seq, u16 family)
 {
-	if (ibnl_chk_listeners(RDMA_NL_GROUP_LS))
+	if (rdma_nl_chk_listeners(RDMA_NL_GROUP_LS))
 		return -EADDRNOTAVAIL;
 
 	/* We fill in what we can, the response will fill the rest */
diff --git a/drivers/infiniband/core/netlink.c b/drivers/infiniband/core/netlink.c
index 66c3e82b1b77..e020217624b5 100644
--- a/drivers/infiniband/core/netlink.c
+++ b/drivers/infiniband/core/netlink.c
@@ -50,12 +50,11 @@ static DEFINE_MUTEX(ibnl_mutex);
 static struct sock *nls;
 static LIST_HEAD(client_list);
 
-int ibnl_chk_listeners(unsigned int group)
+int rdma_nl_chk_listeners(unsigned int group)
 {
-	if (netlink_has_listeners(nls, group) == 0)
-		return -1;
-	return 0;
+	return (netlink_has_listeners(nls, group)) ? 0 : -1;
 }
+EXPORT_SYMBOL(rdma_nl_chk_listeners);
 
 int ibnl_add_client(int index, int nops,
 		    const struct ibnl_client_cbs cb_table[])
* Unmerged path drivers/infiniband/core/sa_query.c
diff --git a/include/rdma/rdma_netlink.h b/include/rdma/rdma_netlink.h
index 3d228061a9e1..8ff261950a9b 100644
--- a/include/rdma/rdma_netlink.h
+++ b/include/rdma/rdma_netlink.h
@@ -78,4 +78,10 @@ int rdma_nl_unicast_wait(struct sk_buff *skb, __u32 pid);
  */
 int rdma_nl_multicast(struct sk_buff *skb, unsigned int group, gfp_t flags);
 
+/**
+ * Check if there are any listeners to the netlink group
+ * @group: the netlink group ID
+ * Returns 0 on success or a negative for no listeners.
+ */
+int rdma_nl_chk_listeners(unsigned int group);
 #endif /* _RDMA_NETLINK_H */
