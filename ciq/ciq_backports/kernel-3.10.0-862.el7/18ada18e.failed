scsi: qla2xxx: Change ha->wq max_active value to default

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
Rebuild_CHGLOG: - [scsi] qla2xxx: Change ha->wq max_active value to default (Himanshu Madhani) [1460030]
Rebuild_FUZZ: 94.34%
commit-author Quinn Tran <quinn.tran@cavium.com>
commit 18ada18e5e2dc565731e758785964013cf502650
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/18ada18e.failed

Update ha->wq max_active from 1 to default. MQ interrupts are queued up
via this work queue. This allows interrupts to be process in parrallel,
instead of serialized by the work queue.

	Signed-off-by: Quinn Tran <quinn.tran@cavium.com>
	Signed-off-by: Himanshu Madhani <himanshu.madhani@cavium.com>
	Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
(cherry picked from commit 18ada18e5e2dc565731e758785964013cf502650)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/scsi/qla2xxx/qla_os.c
diff --cc drivers/scsi/qla2xxx/qla_os.c
index 4e0d0a2f9461,fe5148899117..000000000000
--- a/drivers/scsi/qla2xxx/qla_os.c
+++ b/drivers/scsi/qla2xxx/qla_os.c
@@@ -3066,19 -3167,29 +3066,42 @@@ qla2x00_probe_one(struct pci_dev *pdev
  	    host->can_queue, base_vha->req,
  	    base_vha->mgmt_svr_loop_id, host->sg_tablesize);
  
++<<<<<<< HEAD
 +	if (ha->mqenable && qla_ini_mode_enabled(base_vha)) {
 +		base_vha->qps_hint = alloc_percpu(struct qla_percpu_qp_hint);
 +		ha->wq = alloc_workqueue("qla2xxx_wq", WQ_MEM_RECLAIM, 1);
 +		/* Create start of day qpairs for Block MQ */
 +		if (shost_use_blk_mq(host)) {
 +			cpumask_clear(&cpu_mask);
 +			for (cpu_id = 0; cpu_id < ha->max_qpairs; cpu_id++) {
 +				cpumask_set_cpu(cpu_id, &cpu_mask);
 +				qla2xxx_create_qpair(base_vha, &cpu_mask, 5, 0);
 +				cpumask_clear_cpu(cpu_id, &cpu_mask);
 +			}
++=======
+ 	if (ha->mqenable) {
+ 		bool mq = false;
+ 		bool startit = false;
+ 		ha->wq = alloc_workqueue("qla2xxx_wq", WQ_MEM_RECLAIM, 0);
+ 
+ 		if (QLA_TGT_MODE_ENABLED()) {
+ 			mq = true;
+ 			startit = false;
+ 		}
+ 
+ 		if ((ql2x_ini_mode == QLA2XXX_INI_MODE_ENABLED) &&
+ 		    shost_use_blk_mq(host)) {
+ 			mq = true;
+ 			startit = true;
+ 		}
+ 
+ 		if (mq) {
+ 			/* Create start of day qpairs for Block MQ */
+ 			for (i = 0; i < ha->max_qpairs; i++)
+ 				qla2xxx_create_qpair(base_vha, 5, 0, startit);
++>>>>>>> 18ada18e5e2d (scsi: qla2xxx: Change ha->wq max_active value to default)
  		}
  	}
 -
  	if (ha->flags.running_gold_fw)
  		goto skip_dpc;
  
* Unmerged path drivers/scsi/qla2xxx/qla_os.c
