scsi: allow passing in null rq to scsi_prep_state_check()

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
commit-author Ming Lei <ming.lei@redhat.com>
commit aeec77629a4ac6f8c248f3a82e80d4170a881f22
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/aeec7762.failed

In the following patch, we will implement scsi_get_budget()
which need to call scsi_prep_state_check() when rq isn't
dequeued yet.

	Signed-off-by: Ming Lei <ming.lei@redhat.com>
	Signed-off-by: Jens Axboe <axboe@kernel.dk>
(cherry picked from commit aeec77629a4ac6f8c248f3a82e80d4170a881f22)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/scsi/scsi_lib.c
diff --cc drivers/scsi/scsi_lib.c
index 540886abddcc,d159bb085714..000000000000
--- a/drivers/scsi/scsi_lib.c
+++ b/drivers/scsi/scsi_lib.c
@@@ -1248,7 -1298,10 +1248,11 @@@ scsi_prep_state_check(struct scsi_devic
  			/*
  			 * If the devices is blocked we defer normal commands.
  			 */
++<<<<<<< HEAD
 +			if (!(req->cmd_flags & REQ_PREEMPT))
++=======
+ 			if (req && !(req->rq_flags & RQF_PREEMPT))
++>>>>>>> aeec77629a4a (scsi: allow passing in null rq to scsi_prep_state_check())
  				ret = BLKPREP_DEFER;
  			break;
  		default:
@@@ -1257,7 -1310,7 +1261,11 @@@
  			 * special commands.  In particular any user initiated
  			 * command is not allowed.
  			 */
++<<<<<<< HEAD
 +			if (!(req->cmd_flags & REQ_PREEMPT))
++=======
+ 			if (req && !(req->rq_flags & RQF_PREEMPT))
++>>>>>>> aeec77629a4a (scsi: allow passing in null rq to scsi_prep_state_check())
  				ret = BLKPREP_KILL;
  			break;
  		}
* Unmerged path drivers/scsi/scsi_lib.c
