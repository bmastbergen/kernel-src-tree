selinux: allow per-file labeling for cgroupfs

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
commit-author Antonio Murdaca <runcom@redhat.com>
commit 901ef845fa2469c211ce3b1e955d9e7245ab5d50
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/901ef845.failed

This patch allows genfscon per-file labeling for cgroupfs. For instance,
this allows to label the "release_agent" file within each
cgroup mount and limit writes to it.

	Signed-off-by: Antonio Murdaca <amurdaca@redhat.com>
[PM: subject line and merge tweaks]
	Signed-off-by: Paul Moore <paul@paul-moore.com>
(cherry picked from commit 901ef845fa2469c211ce3b1e955d9e7245ab5d50)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	security/selinux/hooks.c
diff --cc security/selinux/hooks.c
index 7c150cbbfbc6,f803fdcde9cf..000000000000
--- a/security/selinux/hooks.c
+++ b/security/selinux/hooks.c
@@@ -776,7 -810,15 +776,19 @@@ static int selinux_set_mnt_opts(struct 
  	}
  
  	if (strcmp(sb->s_type->name, "proc") == 0)
++<<<<<<< HEAD
 +		sbsec->flags |= SE_SBPROC;
++=======
+ 		sbsec->flags |= SE_SBPROC | SE_SBGENFS;
+ 
+ 	if (!strcmp(sb->s_type->name, "debugfs") ||
+ 	    !strcmp(sb->s_type->name, "tracefs") ||
+ 	    !strcmp(sb->s_type->name, "sysfs") ||
+ 	    !strcmp(sb->s_type->name, "pstore") ||
+ 	    !strcmp(sb->s_type->name, "cgroup") ||
+ 	    !strcmp(sb->s_type->name, "cgroup2"))
+ 		sbsec->flags |= SE_SBGENFS;
++>>>>>>> 901ef845fa24 (selinux: allow per-file labeling for cgroupfs)
  
  	if (!sbsec->behavior) {
  		/*
* Unmerged path security/selinux/hooks.c
