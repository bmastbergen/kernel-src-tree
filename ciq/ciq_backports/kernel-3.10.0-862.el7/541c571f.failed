csiostor:Use firmware version from cxgb4/t4fw_version.h

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
Rebuild_CHGLOG: - [scsi] csiostor: Use firmware version from cxgb4/t4fw_version.h (Arjun Vynipadath) [1458318]
Rebuild_FUZZ: 99.10%
commit-author Praveen Madhavan <praveenm@chelsio.com>
commit 541c571fa2fdfd4782d840276c5aedb535349075
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/541c571f.failed

This patch is to use firmware version macros from t4fw_version.h
and also enables 40g T5 adapter.

	Signed-off-by: Praveen Madhavan <praveenm@chelsio.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 541c571fa2fdfd4782d840276c5aedb535349075)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/scsi/csiostor/csio_hw.c
#	drivers/scsi/csiostor/csio_hw_chip.h
diff --cc drivers/scsi/csiostor/csio_hw.c
index 5c31fa603de4,2e66f34ebb79..000000000000
--- a/drivers/scsi/csiostor/csio_hw.c
+++ b/drivers/scsi/csiostor/csio_hw.c
@@@ -1852,10 -1774,12 +1853,17 @@@ csio_hw_use_fwconfig(struct csio_hw *hw
  		csio_warn(hw,
  		      "Config File checksum mismatch: csum=%#x, computed=%#x\n",
  		      finicsum, cfcsum);
 +
 +		hw->cfg_csum_status = false;
  	}
  
++<<<<<<< HEAD
++=======
+ 	/* Validate device capabilities */
+ 	rv = csio_hw_validate_caps(hw, mbp);
+ 	if (rv != 0)
+ 		goto bye;
++>>>>>>> 541c571fa2fd (csiostor:Use firmware version from cxgb4/t4fw_version.h)
  	/*
  	 * Note that we're operating with parameters
  	 * not supplied by the driver, rather than from hard-wired
diff --cc drivers/scsi/csiostor/csio_hw_chip.h
index eec98f523ec9,b56a11d817be..000000000000
--- a/drivers/scsi/csiostor/csio_hw_chip.h
+++ b/drivers/scsi/csiostor/csio_hw_chip.h
@@@ -43,23 -41,10 +43,26 @@@
  #define CSIO_T5_FCOE_ASIC			0x5600
  #define CSIO_HW_CHIP_MASK			0xF000
  
 +#define T4_REGMAP_SIZE				(160 * 1024)
  #define T5_REGMAP_SIZE				(332 * 1024)
 +#define FW_FNAME_T4				"cxgb4/t4fw.bin"
  #define FW_FNAME_T5				"cxgb4/t5fw.bin"
 +#define FW_CFG_NAME_T4				"cxgb4/t4-config.txt"
  #define FW_CFG_NAME_T5				"cxgb4/t5-config.txt"
  
++<<<<<<< HEAD
 +#define T4FW_VERSION_MAJOR 0x01
 +#define T4FW_VERSION_MINOR 0x0B
 +#define T4FW_VERSION_MICRO 0x1B
 +#define T4FW_VERSION_BUILD 0x00
 +
 +#define T5FW_VERSION_MAJOR 0x01
 +#define T5FW_VERSION_MINOR 0x0B
 +#define T5FW_VERSION_MICRO 0x1B
 +#define T5FW_VERSION_BUILD 0x00
 +
++=======
++>>>>>>> 541c571fa2fd (csiostor:Use firmware version from cxgb4/t4fw_version.h)
  #define CHELSIO_CHIP_CODE(version, revision) (((version) << 4) | (revision))
  #define CHELSIO_CHIP_FPGA          0x100
  #define CHELSIO_CHIP_VERSION(code) (((code) >> 12) & 0xf)
@@@ -95,22 -68,8 +98,23 @@@ static inline int csio_is_t5(uint16_t c
  #define CSIO_DEVICE(devid, idx)						\
  	{ PCI_VENDOR_ID_CHELSIO, (devid), PCI_ANY_ID, PCI_ANY_ID, 0, 0, (idx) }
  
 +#define CSIO_HW_PIDX(hw, index)						\
 +	(csio_is_t4(hw->chip_id) ? (PIDX_V(index)) :			\
 +					(PIDX_T5_G(index) | DBTYPE_F))
 +
 +#define CSIO_HW_LP_INT_THRESH(hw, val)					\
 +	(csio_is_t4(hw->chip_id) ? (LP_INT_THRESH_V(val)) :		\
 +					(LP_INT_THRESH_T5_V(val)))
 +
 +#define CSIO_HW_M_LP_INT_THRESH(hw)					\
 +	(csio_is_t4(hw->chip_id) ? (LP_INT_THRESH_M) : (LP_INT_THRESH_T5_M))
 +
 +#define CSIO_MAC_INT_CAUSE_REG(hw, port)				\
 +	(csio_is_t4(hw->chip_id) ? (PORT_REG(port, XGMAC_PORT_INT_CAUSE_A)) : \
 +				(T5_PORT_REG(port, MAC_PORT_INT_CAUSE_A)))
 +
  #include "t4fw_api.h"
+ #include "t4fw_version.h"
  
  #define FW_VERSION(chip) ( \
  		FW_HDR_FW_VER_MAJOR_G(chip##FW_VERSION_MAJOR) | \
* Unmerged path drivers/scsi/csiostor/csio_hw.c
* Unmerged path drivers/scsi/csiostor/csio_hw_chip.h
diff --git a/drivers/scsi/csiostor/csio_mb.c b/drivers/scsi/csiostor/csio_mb.c
index 1132c41d99ce..9451787ca7f2 100644
--- a/drivers/scsi/csiostor/csio_mb.c
+++ b/drivers/scsi/csiostor/csio_mb.c
@@ -327,7 +327,8 @@ csio_mb_caps_config(struct csio_hw *hw, struct csio_mb *mbp, uint32_t tmo,
 }
 
 #define CSIO_ADVERT_MASK     (FW_PORT_CAP_SPEED_100M | FW_PORT_CAP_SPEED_1G |\
-			      FW_PORT_CAP_SPEED_10G | FW_PORT_CAP_ANEG)
+			      FW_PORT_CAP_SPEED_10G | FW_PORT_CAP_SPEED_40G |\
+			      FW_PORT_CAP_ANEG)
 
 /*
  * csio_mb_port- FW PORT command helper
