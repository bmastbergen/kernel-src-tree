l2tp: initialise session's refcount before making it reachable

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
commit-author Guillaume Nault <g.nault@alphalink.fr>
commit 9ee369a405c57613d7c83a3967780c3e30c52ecc
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/9ee369a4.failed

Sessions must be fully initialised before calling
l2tp_session_add_to_tunnel(). Otherwise, there's a short time frame
where partially initialised sessions can be accessed by external users.

Fixes: dbdbc73b4478 ("l2tp: fix duplicate session creation")
	Signed-off-by: Guillaume Nault <g.nault@alphalink.fr>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 9ee369a405c57613d7c83a3967780c3e30c52ecc)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/l2tp/l2tp_core.c
diff --cc net/l2tp/l2tp_core.c
index 0968b39152ba,f363669eae47..000000000000
--- a/net/l2tp/l2tp_core.c
+++ b/net/l2tp/l2tp_core.c
@@@ -1840,10 -1853,6 +1842,13 @@@ struct l2tp_session *l2tp_session_creat
  			return ERR_PTR(err);
  		}
  
++<<<<<<< HEAD
 +		/* Bump the reference count. The session context is deleted
 +		 * only when this drops to zero.
 +		 */
 +		l2tp_session_inc_refcount(session);
++=======
++>>>>>>> 9ee369a405c5 (l2tp: initialise session's refcount before making it reachable)
  		l2tp_tunnel_inc_refcount(tunnel);
  
  		/* Ensure tunnel socket isn't deleted */
* Unmerged path net/l2tp/l2tp_core.c
