ipv6: set all.accept_dad to 0 by default

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
commit-author Nicolas Dichtel <nicolas.dichtel@6wind.com>
commit 094009531612246d9e13f9e0c3ae2205d7f63a0a
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/09400953.failed

With commits 35e015e1f577 and a2d3f3e33853, the global 'accept_dad' flag
is also taken into account (default value is 1). If either global or
per-interface flag is non-zero, DAD will be enabled on a given interface.

This is not backward compatible: before those patches, the user could
disable DAD just by setting the per-interface flag to 0. Now, the
user instead needs to set both flags to 0 to actually disable DAD.

Restore the previous behaviour by setting the default for the global
'accept_dad' flag to 0. This way, DAD is still enabled by default,
as per-interface flags are set to 1 on device creation, but setting
them to 0 is enough to disable DAD on a given interface.

- Before 35e015e1f57a7 and a2d3f3e33853:
          global    per-interface    DAD enabled
[default]   1             1              yes
            X             0              no
            X             1              yes

- After 35e015e1f577 and a2d3f3e33853:
          global    per-interface    DAD enabled
[default]   1             1              yes
            0             0              no
            0             1              yes
            1             0              yes

- After this fix:
          global    per-interface    DAD enabled
            1             1              yes
            0             0              no
[default]   0             1              yes
            1             0              yes

Fixes: 35e015e1f577 ("ipv6: fix net.ipv6.conf.all interface DAD handlers")
Fixes: a2d3f3e33853 ("ipv6: fix net.ipv6.conf.all.accept_dad behaviour for real")
CC: Stefano Brivio <sbrivio@redhat.com>
CC: Matteo Croce <mcroce@redhat.com>
CC: Erik Kline <ek@google.com>
	Signed-off-by: Nicolas Dichtel <nicolas.dichtel@6wind.com>
	Acked-by: Stefano Brivio <sbrivio@redhat.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 094009531612246d9e13f9e0c3ae2205d7f63a0a)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/ipv6/addrconf.c
diff --cc net/ipv6/addrconf.c
index 6636188d78f6,a0ae1c9d37df..000000000000
--- a/net/ipv6/addrconf.c
+++ b/net/ipv6/addrconf.c
@@@ -205,10 -231,22 +205,16 @@@ static struct ipv6_devconf ipv6_devcon
  	.proxy_ndp		= 0,
  	.accept_source_route	= 0,	/* we do not accept RH0 by default. */
  	.disable_ipv6		= 0,
++<<<<<<< HEAD
 +	.accept_dad		= 1,
++=======
+ 	.accept_dad		= 0,
+ 	.suppress_frag_ndisc	= 1,
+ 	.accept_ra_mtu		= 1,
++>>>>>>> 094009531612 (ipv6: set all.accept_dad to 0 by default)
  	.stable_secret		= {
  		.initialized = false,
 -	},
 -	.use_oif_addrs_only	= 0,
 -	.ignore_routes_with_linkdown = 0,
 -	.keep_addr_on_down	= 0,
 -	.seg6_enabled		= 0,
 -#ifdef CONFIG_IPV6_SEG6_HMAC
 -	.seg6_require_hmac	= 0,
 -#endif
 -	.enhanced_dad           = 1,
 -	.addr_gen_mode		= IN6_ADDR_GEN_MODE_EUI64,
 -	.disable_policy		= 0,
 +	}
  };
  
  static struct ipv6_devconf ipv6_devconf_dflt __read_mostly = {
* Unmerged path net/ipv6/addrconf.c
