sched/headers: Prepare for new header dependencies before moving code to <linux/sched/mm.h>

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
commit-author Ingo Molnar <mingo@kernel.org>
commit 6e84f31522f931027bf695752087ece278c10d3f
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/6e84f315.failed

We are going to split <linux/sched/mm.h> out of <linux/sched.h>, which
will have to be picked up from other headers and a couple of .c files.

Create a trivial placeholder <linux/sched/mm.h> file that just
maps to <linux/sched.h> to make this patch obviously correct and
bisectable.

The APIs that are going to be moved first are:

   mm_alloc()
   __mmdrop()
   mmdrop()
   mmdrop_async_fn()
   mmdrop_async()
   mmget_not_zero()
   mmput()
   mmput_async()
   get_task_mm()
   mm_access()
   mm_release()

Include the new header in the files that are going to need it.

	Acked-by: Linus Torvalds <torvalds@linux-foundation.org>
	Cc: Mike Galbraith <efault@gmx.de>
	Cc: Peter Zijlstra <peterz@infradead.org>
	Cc: Thomas Gleixner <tglx@linutronix.de>
	Cc: linux-kernel@vger.kernel.org
	Signed-off-by: Ingo Molnar <mingo@kernel.org>
(cherry picked from commit 6e84f31522f931027bf695752087ece278c10d3f)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/gpu/drm/etnaviv/etnaviv_gem.c
#	drivers/infiniband/hw/hfi1/file_ops.c
#	drivers/iommu/intel-svm.c
#	drivers/lguest/lguest_user.c
#	drivers/misc/mic/scif/scif_rma.c
#	fs/proc/base.c
#	kernel/events/core.c
#	kernel/exit.c
#	kernel/fork.c
#	kernel/futex.c
#	kernel/sched/sched.h
#	kernel/sys.c
#	kernel/trace/trace_output.c
#	mm/khugepaged.c
#	mm/memcontrol.c
#	mm/migrate.c
#	mm/mmu_context.c
#	mm/nommu.c
diff --cc drivers/infiniband/hw/hfi1/file_ops.c
index 26b530e53cfc,f78c739b330a..000000000000
--- a/drivers/infiniband/hw/hfi1/file_ops.c
+++ b/drivers/infiniband/hw/hfi1/file_ops.c
@@@ -48,7 -48,7 +48,11 @@@
  #include <linux/cdev.h>
  #include <linux/vmalloc.h>
  #include <linux/io.h>
++<<<<<<< HEAD
 +#include <linux/aio.h>
++=======
+ #include <linux/sched/mm.h>
++>>>>>>> 6e84f31522f9 (sched/headers: Prepare for new header dependencies before moving code to <linux/sched/mm.h>)
  
  #include <rdma/ib.h>
  
diff --cc drivers/lguest/lguest_user.c
index 4263f4cc8c55,1a6787bc9386..000000000000
--- a/drivers/lguest/lguest_user.c
+++ b/drivers/lguest/lguest_user.c
@@@ -10,7 -8,7 +10,11 @@@
  #include <linux/miscdevice.h>
  #include <linux/fs.h>
  #include <linux/sched.h>
++<<<<<<< HEAD
 +#include <linux/eventfd.h>
++=======
+ #include <linux/sched/mm.h>
++>>>>>>> 6e84f31522f9 (sched/headers: Prepare for new header dependencies before moving code to <linux/sched/mm.h>)
  #include <linux/file.h>
  #include <linux/slab.h>
  #include <linux/export.h>
diff --cc fs/proc/base.c
index c36f34194d71,9efe12376af1..000000000000
--- a/fs/proc/base.c
+++ b/fs/proc/base.c
@@@ -85,6 -85,8 +85,11 @@@
  #include <linux/user_namespace.h>
  #include <linux/fs_struct.h>
  #include <linux/slab.h>
++<<<<<<< HEAD
++=======
+ #include <linux/sched/autogroup.h>
+ #include <linux/sched/mm.h>
++>>>>>>> 6e84f31522f9 (sched/headers: Prepare for new header dependencies before moving code to <linux/sched/mm.h>)
  #include <linux/flex_array.h>
  #include <linux/posix-timers.h>
  #ifdef CONFIG_HARDWALL
diff --cc kernel/events/core.c
index c7982922c47d,6f41548f2e32..000000000000
--- a/kernel/events/core.c
+++ b/kernel/events/core.c
@@@ -42,8 -42,12 +42,13 @@@
  #include <linux/module.h>
  #include <linux/mman.h>
  #include <linux/compat.h>
 -#include <linux/bpf.h>
 -#include <linux/filter.h>
  #include <linux/namei.h>
  #include <linux/parser.h>
++<<<<<<< HEAD
++=======
+ #include <linux/sched/clock.h>
+ #include <linux/sched/mm.h>
++>>>>>>> 6e84f31522f9 (sched/headers: Prepare for new header dependencies before moving code to <linux/sched/mm.h>)
  
  #include "internal.h"
  
diff --cc kernel/exit.c
index 1afa79930cfc,48649ccbb649..000000000000
--- a/kernel/exit.c
+++ b/kernel/exit.c
@@@ -6,6 -6,8 +6,11 @@@
  
  #include <linux/mm.h>
  #include <linux/slab.h>
++<<<<<<< HEAD
++=======
+ #include <linux/sched/autogroup.h>
+ #include <linux/sched/mm.h>
++>>>>>>> 6e84f31522f9 (sched/headers: Prepare for new header dependencies before moving code to <linux/sched/mm.h>)
  #include <linux/interrupt.h>
  #include <linux/module.h>
  #include <linux/capability.h>
diff --cc kernel/fork.c
index d1ed92efc038,1875468e2a81..000000000000
--- a/kernel/fork.c
+++ b/kernel/fork.c
@@@ -12,6 -12,8 +12,11 @@@
   */
  
  #include <linux/slab.h>
++<<<<<<< HEAD
++=======
+ #include <linux/sched/autogroup.h>
+ #include <linux/sched/mm.h>
++>>>>>>> 6e84f31522f9 (sched/headers: Prepare for new header dependencies before moving code to <linux/sched/mm.h>)
  #include <linux/init.h>
  #include <linux/unistd.h>
  #include <linux/module.h>
diff --cc kernel/futex.c
index 96b663cd803c,229a744b1781..000000000000
--- a/kernel/futex.c
+++ b/kernel/futex.c
@@@ -61,9 -61,12 +61,15 @@@
  #include <linux/nsproxy.h>
  #include <linux/ptrace.h>
  #include <linux/sched/rt.h>
++<<<<<<< HEAD
++=======
+ #include <linux/sched/wake_q.h>
+ #include <linux/sched/mm.h>
+ #include <linux/hugetlb.h>
++>>>>>>> 6e84f31522f9 (sched/headers: Prepare for new header dependencies before moving code to <linux/sched/mm.h>)
  #include <linux/freezer.h>
  #include <linux/bootmem.h>
 -#include <linux/fault-inject.h>
 +#include <linux/hugetlb.h>
  
  #include <asm/futex.h>
  
diff --cc kernel/sched/sched.h
index 3e0ea93b25ef,e2307a6c29f1..000000000000
--- a/kernel/sched/sched.h
+++ b/kernel/sched/sched.h
@@@ -1,8 -1,15 +1,15 @@@
  
  #include <linux/sched.h>
  #include <linux/sched/sysctl.h>
 -#include <linux/sched/topology.h>
  #include <linux/sched/rt.h>
++<<<<<<< HEAD
++=======
+ #include <linux/sched/clock.h>
+ #include <linux/sched/wake_q.h>
+ #include <linux/sched/mm.h>
+ #include <linux/u64_stats_sync.h>
++>>>>>>> 6e84f31522f9 (sched/headers: Prepare for new header dependencies before moving code to <linux/sched/mm.h>)
  #include <linux/sched/deadline.h>
 -#include <linux/kernel_stat.h>
 -#include <linux/binfmts.h>
  #include <linux/mutex.h>
  #include <linux/spinlock.h>
  #include <linux/stop_machine.h>
diff --cc kernel/sys.c
index 20c59a4e34c9,dc71ec1e1967..000000000000
--- a/kernel/sys.c
+++ b/kernel/sys.c
@@@ -50,6 -49,9 +50,12 @@@
  #include <linux/binfmts.h>
  
  #include <linux/sched.h>
++<<<<<<< HEAD
++=======
+ #include <linux/sched/autogroup.h>
+ #include <linux/sched/loadavg.h>
+ #include <linux/sched/mm.h>
++>>>>>>> 6e84f31522f9 (sched/headers: Prepare for new header dependencies before moving code to <linux/sched/mm.h>)
  #include <linux/rcupdate.h>
  #include <linux/uidgid.h>
  #include <linux/cred.h>
diff --cc kernel/trace/trace_output.c
index bdc9e6d81c41,02a4aeb22c47..000000000000
--- a/kernel/trace/trace_output.c
+++ b/kernel/trace/trace_output.c
@@@ -8,6 -8,8 +8,11 @@@
  #include <linux/module.h>
  #include <linux/mutex.h>
  #include <linux/ftrace.h>
++<<<<<<< HEAD
++=======
+ #include <linux/sched/clock.h>
+ #include <linux/sched/mm.h>
++>>>>>>> 6e84f31522f9 (sched/headers: Prepare for new header dependencies before moving code to <linux/sched/mm.h>)
  
  #include "trace_output.h"
  
diff --cc mm/memcontrol.c
index 23e6528af2de,c52ec893e241..000000000000
--- a/mm/memcontrol.c
+++ b/mm/memcontrol.c
@@@ -29,6 -35,8 +29,11 @@@
  #include <linux/memcontrol.h>
  #include <linux/cgroup.h>
  #include <linux/mm.h>
++<<<<<<< HEAD
++=======
+ #include <linux/sched/mm.h>
+ #include <linux/shmem_fs.h>
++>>>>>>> 6e84f31522f9 (sched/headers: Prepare for new header dependencies before moving code to <linux/sched/mm.h>)
  #include <linux/hugetlb.h>
  #include <linux/pagemap.h>
  #include <linux/smp.h>
diff --cc mm/migrate.c
index f70d80642c5a,9a0897a14d37..000000000000
--- a/mm/migrate.c
+++ b/mm/migrate.c
@@@ -37,8 -38,9 +37,14 @@@
  #include <linux/gfp.h>
  #include <linux/balloon_compaction.h>
  #include <linux/mmu_notifier.h>
++<<<<<<< HEAD
 +#include <linux/memremap.h>
 +#include <linux/userfaultfd_k.h>
++=======
+ #include <linux/page_idle.h>
+ #include <linux/page_owner.h>
+ #include <linux/sched/mm.h>
++>>>>>>> 6e84f31522f9 (sched/headers: Prepare for new header dependencies before moving code to <linux/sched/mm.h>)
  
  #include <asm/tlbflush.h>
  
diff --cc mm/mmu_context.c
index 8a8cd0265e52,8888b124a386..000000000000
--- a/mm/mmu_context.c
+++ b/mm/mmu_context.c
@@@ -4,9 -4,10 +4,14 @@@
   */
  
  #include <linux/mm.h>
++<<<<<<< HEAD
++=======
+ #include <linux/sched.h>
+ #include <linux/sched/mm.h>
++>>>>>>> 6e84f31522f9 (sched/headers: Prepare for new header dependencies before moving code to <linux/sched/mm.h>)
  #include <linux/mmu_context.h>
  #include <linux/export.h>
 +#include <linux/sched.h>
  
  #include <asm/mmu_context.h>
  
diff --cc mm/nommu.c
index 9b6c2b5a762b,79abed514a4b..000000000000
--- a/mm/nommu.c
+++ b/mm/nommu.c
@@@ -13,8 -13,12 +13,13 @@@
   *  Copyright (c) 2007-2010 Paul Mundt <lethal@linux-sh.org>
   */
  
 -#define pr_fmt(fmt) KBUILD_MODNAME ": " fmt
 -
  #include <linux/export.h>
  #include <linux/mm.h>
++<<<<<<< HEAD
++=======
+ #include <linux/sched/mm.h>
+ #include <linux/vmacache.h>
++>>>>>>> 6e84f31522f9 (sched/headers: Prepare for new header dependencies before moving code to <linux/sched/mm.h>)
  #include <linux/mman.h>
  #include <linux/swap.h>
  #include <linux/file.h>
* Unmerged path drivers/gpu/drm/etnaviv/etnaviv_gem.c
* Unmerged path drivers/iommu/intel-svm.c
* Unmerged path drivers/misc/mic/scif/scif_rma.c
* Unmerged path mm/khugepaged.c
diff --git a/arch/arc/include/asm/mmu_context.h b/arch/arc/include/asm/mmu_context.h
index 0d71fb11b57c..8a7c9bbb8e76 100644
--- a/arch/arc/include/asm/mmu_context.h
+++ b/arch/arc/include/asm/mmu_context.h
@@ -20,6 +20,7 @@
 
 #include <asm/arcregs.h>
 #include <asm/tlb.h>
+#include <linux/sched/mm.h>
 
 #include <asm-generic/mm_hooks.h>
 
diff --git a/arch/arc/kernel/troubleshoot.c b/arch/arc/kernel/troubleshoot.c
index 11c301b81c92..5c05d9d979c1 100644
--- a/arch/arc/kernel/troubleshoot.c
+++ b/arch/arc/kernel/troubleshoot.c
@@ -13,6 +13,8 @@
 #include <linux/fs_struct.h>
 #include <linux/proc_fs.h>
 #include <linux/file.h>
+#include <linux/sched/mm.h>
+
 #include <asm/arcregs.h>
 
 /*
diff --git a/arch/arm/mach-rpc/ecard.c b/arch/arm/mach-rpc/ecard.c
index fcb1d59f7aec..6b3387ccaa28 100644
--- a/arch/arm/mach-rpc/ecard.c
+++ b/arch/arm/mach-rpc/ecard.c
@@ -31,6 +31,7 @@
 #include <linux/kernel.h>
 #include <linux/types.h>
 #include <linux/sched.h>
+#include <linux/sched/mm.h>
 #include <linux/interrupt.h>
 #include <linux/completion.h>
 #include <linux/reboot.h>
diff --git a/arch/frv/mm/mmu-context.c b/arch/frv/mm/mmu-context.c
index 81757d55a5b5..a3b4d02de7c0 100644
--- a/arch/frv/mm/mmu-context.c
+++ b/arch/frv/mm/mmu-context.c
@@ -10,6 +10,7 @@
  */
 
 #include <linux/sched.h>
+#include <linux/sched/mm.h>
 #include <linux/mm.h>
 #include <asm/tlbflush.h>
 
diff --git a/arch/m68k/sun3/mmu_emu.c b/arch/m68k/sun3/mmu_emu.c
index 8edc510a21be..9a06b72d1b8e 100644
--- a/arch/m68k/sun3/mmu_emu.c
+++ b/arch/m68k/sun3/mmu_emu.c
@@ -14,6 +14,7 @@
 #include <linux/bootmem.h>
 #include <linux/bitops.h>
 #include <linux/module.h>
+#include <linux/sched/mm.h>
 
 #include <asm/setup.h>
 #include <asm/traps.h>
diff --git a/arch/powerpc/platforms/cell/spufs/context.c b/arch/powerpc/platforms/cell/spufs/context.c
index 9c6790d17eda..8f29b3daff50 100644
--- a/arch/powerpc/platforms/cell/spufs/context.c
+++ b/arch/powerpc/platforms/cell/spufs/context.c
@@ -25,6 +25,8 @@
 #include <linux/slab.h>
 #include <linux/atomic.h>
 #include <linux/sched.h>
+#include <linux/sched/mm.h>
+
 #include <asm/spu.h>
 #include <asm/spu_csa.h>
 #include "spufs.h"
diff --git a/drivers/gpu/drm/amd/amdkfd/kfd_process.c b/drivers/gpu/drm/amd/amdkfd/kfd_process.c
index ef7c8de7060e..771fc24dcf7c 100644
--- a/drivers/gpu/drm/amd/amdkfd/kfd_process.c
+++ b/drivers/gpu/drm/amd/amdkfd/kfd_process.c
@@ -23,6 +23,7 @@
 #include <linux/mutex.h>
 #include <linux/log2.h>
 #include <linux/sched.h>
+#include <linux/sched/mm.h>
 #include <linux/slab.h>
 #include <linux/amd-iommu.h>
 #include <linux/notifier.h>
* Unmerged path drivers/gpu/drm/etnaviv/etnaviv_gem.c
diff --git a/drivers/gpu/drm/i915/i915_gem_userptr.c b/drivers/gpu/drm/i915/i915_gem_userptr.c
index d068af2ec3a3..9c9167590320 100644
--- a/drivers/gpu/drm/i915/i915_gem_userptr.c
+++ b/drivers/gpu/drm/i915/i915_gem_userptr.c
@@ -31,6 +31,7 @@
 #include <linux/mmu_notifier.h>
 #include <linux/mempolicy.h>
 #include <linux/swap.h>
+#include <linux/sched/mm.h>
 
 struct i915_mm_struct {
 	struct mm_struct *mm;
diff --git a/drivers/infiniband/core/umem.c b/drivers/infiniband/core/umem.c
index db0900d3da1e..3eb4e151a24a 100644
--- a/drivers/infiniband/core/umem.c
+++ b/drivers/infiniband/core/umem.c
@@ -35,6 +35,7 @@
 #include <linux/mm.h>
 #include <linux/dma-mapping.h>
 #include <linux/sched.h>
+#include <linux/sched/mm.h>
 #include <linux/export.h>
 #include <linux/hugetlb.h>
 #include <linux/dma-attrs.h>
diff --git a/drivers/infiniband/core/umem_odp.c b/drivers/infiniband/core/umem_odp.c
index ea5520c53058..381847c5f039 100644
--- a/drivers/infiniband/core/umem_odp.c
+++ b/drivers/infiniband/core/umem_odp.c
@@ -32,6 +32,7 @@
 
 #include <linux/types.h>
 #include <linux/sched.h>
+#include <linux/sched/mm.h>
 #include <linux/pid.h>
 #include <linux/slab.h>
 #include <linux/export.h>
* Unmerged path drivers/infiniband/hw/hfi1/file_ops.c
diff --git a/drivers/infiniband/hw/mlx4/main.c b/drivers/infiniband/hw/mlx4/main.c
index aa0cb6252b8c..58445e0da0be 100644
--- a/drivers/infiniband/hw/mlx4/main.c
+++ b/drivers/infiniband/hw/mlx4/main.c
@@ -39,6 +39,8 @@
 #include <linux/inetdevice.h>
 #include <linux/rtnetlink.h>
 #include <linux/if_vlan.h>
+#include <linux/sched/mm.h>
+
 #include <net/ipv6.h>
 #include <net/addrconf.h>
 #include <net/devlink.h>
diff --git a/drivers/infiniband/hw/mlx5/main.c b/drivers/infiniband/hw/mlx5/main.c
index 248a4210de25..d8554759b80e 100644
--- a/drivers/infiniband/hw/mlx5/main.c
+++ b/drivers/infiniband/hw/mlx5/main.c
@@ -41,6 +41,7 @@
 #include <asm/pat.h>
 #endif
 #include <linux/sched.h>
+#include <linux/sched/mm.h>
 #include <linux/delay.h>
 #include <rdma/ib_user_verbs.h>
 #include <rdma/ib_addr.h>
diff --git a/drivers/infiniband/hw/usnic/usnic_uiom.c b/drivers/infiniband/hw/usnic/usnic_uiom.c
index b500d8d322ba..44c4b54d5f60 100644
--- a/drivers/infiniband/hw/usnic/usnic_uiom.c
+++ b/drivers/infiniband/hw/usnic/usnic_uiom.c
@@ -35,6 +35,7 @@
 #include <linux/mm.h>
 #include <linux/dma-mapping.h>
 #include <linux/sched.h>
+#include <linux/sched/mm.h>
 #include <linux/hugetlb.h>
 #include <linux/iommu.h>
 #include <linux/workqueue.h>
diff --git a/drivers/iommu/amd_iommu_v2.c b/drivers/iommu/amd_iommu_v2.c
index 9b539a79cc08..900c9f7f72f0 100644
--- a/drivers/iommu/amd_iommu_v2.c
+++ b/drivers/iommu/amd_iommu_v2.c
@@ -22,6 +22,7 @@
 #include <linux/profile.h>
 #include <linux/module.h>
 #include <linux/sched.h>
+#include <linux/sched/mm.h>
 #include <linux/iommu.h>
 #include <linux/wait.h>
 #include <linux/pci.h>
* Unmerged path drivers/iommu/intel-svm.c
* Unmerged path drivers/lguest/lguest_user.c
diff --git a/drivers/misc/cxl/fault.c b/drivers/misc/cxl/fault.c
index 9a8650bcb042..f7c9742a2661 100644
--- a/drivers/misc/cxl/fault.c
+++ b/drivers/misc/cxl/fault.c
@@ -9,6 +9,7 @@
 
 #include <linux/workqueue.h>
 #include <linux/sched.h>
+#include <linux/sched/mm.h>
 #include <linux/pid.h>
 #include <linux/mm.h>
 #include <linux/moduleparam.h>
* Unmerged path drivers/misc/mic/scif/scif_rma.c
diff --git a/drivers/oprofile/buffer_sync.c b/drivers/oprofile/buffer_sync.c
index d93b2b6b1f7a..4cdf6b9590d5 100644
--- a/drivers/oprofile/buffer_sync.c
+++ b/drivers/oprofile/buffer_sync.c
@@ -30,6 +30,7 @@
 #include <linux/fs.h>
 #include <linux/oprofile.h>
 #include <linux/sched.h>
+#include <linux/sched/mm.h>
 #include <linux/gfp.h>
 
 #include "oprofile_stats.h"
diff --git a/drivers/staging/android/binder.c b/drivers/staging/android/binder.c
index 1567ac296b39..8ff91f4e0a4b 100644
--- a/drivers/staging/android/binder.c
+++ b/drivers/staging/android/binder.c
@@ -31,6 +31,7 @@
 #include <linux/debugfs.h>
 #include <linux/rbtree.h>
 #include <linux/sched.h>
+#include <linux/sched/mm.h>
 #include <linux/seq_file.h>
 #include <linux/uaccess.h>
 #include <linux/vmalloc.h>
diff --git a/drivers/vfio/vfio_iommu_spapr_tce.c b/drivers/vfio/vfio_iommu_spapr_tce.c
index 0582b72ef377..6361f12fe503 100644
--- a/drivers/vfio/vfio_iommu_spapr_tce.c
+++ b/drivers/vfio/vfio_iommu_spapr_tce.c
@@ -20,6 +20,8 @@
 #include <linux/err.h>
 #include <linux/vfio.h>
 #include <linux/vmalloc.h>
+#include <linux/sched/mm.h>
+
 #include <asm/iommu.h>
 #include <asm/tce.h>
 #include <asm/mmu_context.h>
diff --git a/drivers/vfio/vfio_iommu_type1.c b/drivers/vfio/vfio_iommu_type1.c
index 54fa9eeb9cc3..72e6120bc130 100644
--- a/drivers/vfio/vfio_iommu_type1.c
+++ b/drivers/vfio/vfio_iommu_type1.c
@@ -32,6 +32,7 @@
 #include <linux/mm.h>
 #include <linux/rbtree.h>
 #include <linux/sched.h>
+#include <linux/sched/mm.h>
 #include <linux/slab.h>
 #include <linux/uaccess.h>
 #include <linux/vfio.h>
diff --git a/drivers/vhost/vhost.c b/drivers/vhost/vhost.c
index 093267a56a1a..8ae9c9980d65 100644
--- a/drivers/vhost/vhost.c
+++ b/drivers/vhost/vhost.c
@@ -27,6 +27,7 @@
 #include <linux/cgroup.h>
 #include <linux/module.h>
 #include <linux/sort.h>
+#include <linux/sched/mm.h>
 #include <linux/interval_tree_generic.h>
 
 #include "vhost.h"
diff --git a/drivers/xen/gntdev.c b/drivers/xen/gntdev.c
index eab5427c75f5..5779e00a4347 100644
--- a/drivers/xen/gntdev.c
+++ b/drivers/xen/gntdev.c
@@ -32,6 +32,7 @@
 #include <linux/types.h>
 #include <linux/uaccess.h>
 #include <linux/sched.h>
+#include <linux/sched/mm.h>
 #include <linux/spinlock.h>
 #include <linux/slab.h>
 #include <linux/highmem.h>
diff --git a/fs/exec.c b/fs/exec.c
index 9ca6d51722de..af9fd382e04e 100644
--- a/fs/exec.c
+++ b/fs/exec.c
@@ -31,6 +31,7 @@
 #include <linux/swap.h>
 #include <linux/string.h>
 #include <linux/init.h>
+#include <linux/sched/mm.h>
 #include <linux/pagemap.h>
 #include <linux/perf_event.h>
 #include <linux/highmem.h>
diff --git a/fs/proc/array.c b/fs/proc/array.c
index e72efe817a60..04315d850a96 100644
--- a/fs/proc/array.c
+++ b/fs/proc/array.c
@@ -60,6 +60,7 @@
 #include <linux/tty.h>
 #include <linux/string.h>
 #include <linux/mman.h>
+#include <linux/sched/mm.h>
 #include <linux/proc_fs.h>
 #include <linux/ioport.h>
 #include <linux/uaccess.h>
* Unmerged path fs/proc/base.c
diff --git a/fs/proc/task_mmu.c b/fs/proc/task_mmu.c
index a48a2953412f..59baf76611f5 100644
--- a/fs/proc/task_mmu.c
+++ b/fs/proc/task_mmu.c
@@ -10,6 +10,7 @@
 #include <linux/mempolicy.h>
 #include <linux/rmap.h>
 #include <linux/swap.h>
+#include <linux/sched/mm.h>
 #include <linux/swapops.h>
 #include <linux/shmem_fs.h>
 #include <linux/mmu_notifier.h>
diff --git a/fs/proc/task_nommu.c b/fs/proc/task_nommu.c
index 56123a6f462e..348f20523ff8 100644
--- a/fs/proc/task_nommu.c
+++ b/fs/proc/task_nommu.c
@@ -7,6 +7,8 @@
 #include <linux/ptrace.h>
 #include <linux/slab.h>
 #include <linux/seq_file.h>
+#include <linux/sched/mm.h>
+
 #include "internal.h"
 
 /*
diff --git a/fs/userfaultfd.c b/fs/userfaultfd.c
index 69c6fe3b2f1f..8ffc765a590d 100644
--- a/fs/userfaultfd.c
+++ b/fs/userfaultfd.c
@@ -15,6 +15,7 @@
 #include <linux/list.h>
 #include <linux/hashtable.h>
 #include <linux/sched.h>
+#include <linux/sched/mm.h>
 #include <linux/mm.h>
 #include <linux/poll.h>
 #include <linux/slab.h>
diff --git a/include/linux/sched/mm.h b/include/linux/sched/mm.h
new file mode 100644
index 000000000000..a7adba1cd0a9
--- /dev/null
+++ b/include/linux/sched/mm.h
@@ -0,0 +1,6 @@
+#ifndef _LINUX_SCHED_MM_H
+#define _LINUX_SCHED_MM_H
+
+#include <linux/sched.h>
+
+#endif /* _LINUX_SCHED_MM_H */
diff --git a/kernel/cpuset.c b/kernel/cpuset.c
index d73addbf6754..6af140cbfcf6 100644
--- a/kernel/cpuset.c
+++ b/kernel/cpuset.c
@@ -44,6 +44,7 @@
 #include <linux/proc_fs.h>
 #include <linux/rcupdate.h>
 #include <linux/sched.h>
+#include <linux/sched/mm.h>
 #include <linux/seq_file.h>
 #include <linux/security.h>
 #include <linux/slab.h>
* Unmerged path kernel/events/core.c
diff --git a/kernel/events/uprobes.c b/kernel/events/uprobes.c
index 9c0b5accc271..4b991e8ddb93 100644
--- a/kernel/events/uprobes.c
+++ b/kernel/events/uprobes.c
@@ -27,6 +27,7 @@
 #include <linux/pagemap.h>	/* read_mapping_page */
 #include <linux/slab.h>
 #include <linux/sched.h>
+#include <linux/sched/mm.h>
 #include <linux/export.h>
 #include <linux/rmap.h>		/* anon_vma_prepare */
 #include <linux/mmu_notifier.h>	/* set_pte_at_notify */
* Unmerged path kernel/exit.c
* Unmerged path kernel/fork.c
* Unmerged path kernel/futex.c
diff --git a/kernel/ptrace.c b/kernel/ptrace.c
index 33f02efaea58..474b3e0f7872 100644
--- a/kernel/ptrace.c
+++ b/kernel/ptrace.c
@@ -10,6 +10,7 @@
 #include <linux/capability.h>
 #include <linux/export.h>
 #include <linux/sched.h>
+#include <linux/sched/mm.h>
 #include <linux/errno.h>
 #include <linux/mm.h>
 #include <linux/highmem.h>
* Unmerged path kernel/sched/sched.h
* Unmerged path kernel/sys.c
* Unmerged path kernel/trace/trace_output.c
diff --git a/kernel/tsacct.c b/kernel/tsacct.c
index 146f5fd0996b..c06f2ba2f7bb 100644
--- a/kernel/tsacct.c
+++ b/kernel/tsacct.c
@@ -18,6 +18,7 @@
 
 #include <linux/kernel.h>
 #include <linux/sched.h>
+#include <linux/sched/mm.h>
 #include <linux/tsacct_kern.h>
 #include <linux/acct.h>
 #include <linux/jiffies.h>
* Unmerged path mm/khugepaged.c
diff --git a/mm/ksm.c b/mm/ksm.c
index feae14491122..d37de514be27 100644
--- a/mm/ksm.c
+++ b/mm/ksm.c
@@ -19,6 +19,7 @@
 #include <linux/fs.h>
 #include <linux/mman.h>
 #include <linux/sched.h>
+#include <linux/sched/mm.h>
 #include <linux/rwsem.h>
 #include <linux/pagemap.h>
 #include <linux/rmap.h>
* Unmerged path mm/memcontrol.c
diff --git a/mm/memory.c b/mm/memory.c
index 2fc5b28b6782..3c9b74662655 100644
--- a/mm/memory.c
+++ b/mm/memory.c
@@ -40,6 +40,7 @@
 
 #include <linux/kernel_stat.h>
 #include <linux/mm.h>
+#include <linux/sched/mm.h>
 #include <linux/hugetlb.h>
 #include <linux/mman.h>
 #include <linux/swap.h>
diff --git a/mm/mempolicy.c b/mm/mempolicy.c
index 3043a0f6d814..97da739fcc0c 100644
--- a/mm/mempolicy.c
+++ b/mm/mempolicy.c
@@ -71,6 +71,7 @@
 #include <linux/hugetlb.h>
 #include <linux/kernel.h>
 #include <linux/sched.h>
+#include <linux/sched/mm.h>
 #include <linux/nodemask.h>
 #include <linux/cpuset.h>
 #include <linux/slab.h>
* Unmerged path mm/migrate.c
* Unmerged path mm/mmu_context.c
diff --git a/mm/mmu_notifier.c b/mm/mmu_notifier.c
index 93757865a9ab..36108364b096 100644
--- a/mm/mmu_notifier.c
+++ b/mm/mmu_notifier.c
@@ -17,6 +17,7 @@
 #include <linux/srcu.h>
 #include <linux/rcupdate.h>
 #include <linux/sched.h>
+#include <linux/sched/mm.h>
 #include <linux/slab.h>
 
 /* global SRCU for all MMs */
* Unmerged path mm/nommu.c
diff --git a/mm/oom_kill.c b/mm/oom_kill.c
index 287e96813fc2..3e025190dc61 100644
--- a/mm/oom_kill.c
+++ b/mm/oom_kill.c
@@ -22,6 +22,7 @@
 #include <linux/err.h>
 #include <linux/gfp.h>
 #include <linux/sched.h>
+#include <linux/sched/mm.h>
 #include <linux/swap.h>
 #include <linux/timex.h>
 #include <linux/jiffies.h>
diff --git a/mm/process_vm_access.c b/mm/process_vm_access.c
index b7140e4b7916..ceb4af1aec3f 100644
--- a/mm/process_vm_access.c
+++ b/mm/process_vm_access.c
@@ -12,6 +12,7 @@
 #include <linux/mm.h>
 #include <linux/uio.h>
 #include <linux/sched.h>
+#include <linux/sched/mm.h>
 #include <linux/highmem.h>
 #include <linux/ptrace.h>
 #include <linux/slab.h>
diff --git a/mm/rmap.c b/mm/rmap.c
index bab4f8a26c59..9e3f73ba12a1 100644
--- a/mm/rmap.c
+++ b/mm/rmap.c
@@ -46,6 +46,7 @@
  */
 
 #include <linux/mm.h>
+#include <linux/sched/mm.h>
 #include <linux/pagemap.h>
 #include <linux/swap.h>
 #include <linux/swapops.h>
diff --git a/mm/swapfile.c b/mm/swapfile.c
index 44c2eac6b890..a3fb18daa120 100644
--- a/mm/swapfile.c
+++ b/mm/swapfile.c
@@ -6,6 +6,7 @@
  */
 
 #include <linux/mm.h>
+#include <linux/sched/mm.h>
 #include <linux/hugetlb.h>
 #include <linux/mman.h>
 #include <linux/slab.h>
diff --git a/mm/util.c b/mm/util.c
index 7bb27027324a..87fbf7fc8dd0 100644
--- a/mm/util.c
+++ b/mm/util.c
@@ -4,6 +4,7 @@
 #include <linux/export.h>
 #include <linux/err.h>
 #include <linux/sched.h>
+#include <linux/sched/mm.h>
 #include <linux/security.h>
 #include <linux/swap.h>
 #include <linux/swapops.h>
diff --git a/virt/kvm/async_pf.c b/virt/kvm/async_pf.c
index d1ed9e7b49f6..b41e0895cedf 100644
--- a/virt/kvm/async_pf.c
+++ b/virt/kvm/async_pf.c
@@ -24,6 +24,7 @@
 #include <linux/slab.h>
 #include <linux/module.h>
 #include <linux/mmu_context.h>
+#include <linux/sched/mm.h>
 
 #include "async_pf.h"
 #include <trace/events/kvm.h>
diff --git a/virt/kvm/kvm_main.c b/virt/kvm/kvm_main.c
index cdf2c08cae2d..02d1ebce415a 100644
--- a/virt/kvm/kvm_main.c
+++ b/virt/kvm/kvm_main.c
@@ -33,6 +33,7 @@
 #include <linux/syscore_ops.h>
 #include <linux/cpu.h>
 #include <linux/sched.h>
+#include <linux/sched/mm.h>
 #include <linux/cpumask.h>
 #include <linux/smp.h>
 #include <linux/anon_inodes.h>
