RDMA/qedr: Parse VLAN ID correctly and ignore the value of zero

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
commit-author Amrani, Ram <Ram.Amrani@cavium.com>
commit efe63c220e57ce74e240670399912e609ac125d9
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/efe63c22.failed

Rename vlan_id field name to vlan as it contains more than the vlan_id.
Mask out non vlan id fields from vlan tag of the QED LL2 RX GSI
vlan output. As it is expected to be vlan id only.
Ignore vlan_id with value of zero.

Fixes: abd49676c707 ("qed: Add RoCE ll2 & GSI support")
	Signed-off-by: Ram Amrani <Ram.Amrani@cavium.com>
	Signed-off-by: Michal Kalderon <Michal.Kalderon@cavium.com>
	Signed-off-by: Doug Ledford <dledford@redhat.com>
(cherry picked from commit efe63c220e57ce74e240670399912e609ac125d9)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/infiniband/hw/qedr/qedr_cm.c
diff --cc drivers/infiniband/hw/qedr/qedr_cm.c
index 54568c16e682,5ebbe4952386..000000000000
--- a/drivers/infiniband/hw/qedr/qedr_cm.c
+++ b/drivers/infiniband/hw/qedr/qedr_cm.c
@@@ -98,10 -103,16 +98,23 @@@ void qedr_ll2_rx_cb(void *_dev, struct 
  
  	spin_lock_irqsave(&qp->q_lock, flags);
  
++<<<<<<< HEAD
 +	qp->rqe_wr_id[qp->rq.gsi_cons].rc = params->rc;
 +	qp->rqe_wr_id[qp->rq.gsi_cons].vlan_id = params->vlan_id;
 +	qp->rqe_wr_id[qp->rq.gsi_cons].sg_list[0].length = pkt->payload[0].len;
 +	ether_addr_copy(qp->rqe_wr_id[qp->rq.gsi_cons].smac, params->smac);
++=======
+ 	qp->rqe_wr_id[qp->rq.gsi_cons].rc = data->u.data_length_error ?
+ 		-EINVAL : 0;
+ 	qp->rqe_wr_id[qp->rq.gsi_cons].vlan = data->vlan;
+ 	/* note: length stands for data length i.e. GRH is excluded */
+ 	qp->rqe_wr_id[qp->rq.gsi_cons].sg_list[0].length =
+ 		data->length.data_length;
+ 	*((u32 *)&qp->rqe_wr_id[qp->rq.gsi_cons].smac[0]) =
+ 		ntohl(data->opaque_data_0);
+ 	*((u16 *)&qp->rqe_wr_id[qp->rq.gsi_cons].smac[4]) =
+ 		ntohs((u16)data->opaque_data_1);
++>>>>>>> efe63c220e57 (RDMA/qedr: Parse VLAN ID correctly and ignore the value of zero)
  
  	qedr_inc_sw_gsi_cons(&qp->rq);
  
diff --git a/drivers/infiniband/hw/qedr/qedr.h b/drivers/infiniband/hw/qedr/qedr.h
index 86d23afa66c9..211e3f0a5080 100644
--- a/drivers/infiniband/hw/qedr/qedr.h
+++ b/drivers/infiniband/hw/qedr/qedr.h
@@ -383,7 +383,7 @@ struct qedr_qp {
 		u8 wqe_size;
 
 		u8 smac[ETH_ALEN];
-		u16 vlan_id;
+		u16 vlan;
 		int rc;
 	} *rqe_wr_id;
 
* Unmerged path drivers/infiniband/hw/qedr/qedr_cm.c
