net: sched: replace nprio by a bool to make the function more readable

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
Rebuild_CHGLOG: - [net] sched: replace nprio by a bool to make the function more readable (Ivan Vecera) [1445420]
Rebuild_FUZZ: 96.30%
commit-author Jiri Pirko <jiri@mellanox.com>
commit 9d36d9e545dce53c6fff046b277c261d6568c5b9
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/9d36d9e5.failed

The use of "nprio" variable in tc_ctl_tfilter is a bit cryptic and makes
a reader wonder what is going on for a while. So help him to understand
this priority allocation dance a litte bit better.

	Signed-off-by: Jiri Pirko <jiri@mellanox.com>
	Acked-by: Jamal Hadi Salim <jhs@mojatatu.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 9d36d9e545dce53c6fff046b277c261d6568c5b9)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/sched/cls_api.c
diff --cc net/sched/cls_api.c
index 1dc6d123ed94,bf2e59cc1174..000000000000
--- a/net/sched/cls_api.c
+++ b/net/sched/cls_api.c
@@@ -238,11 -384,14 +239,17 @@@ replay
  	     back = &tp->next) {
  		if (tp->prio >= prio) {
  			if (tp->prio == prio) {
++<<<<<<< HEAD
 +				if (!nprio ||
 +				    (tp->protocol != protocol && protocol))
++=======
+ 				if (prio_allocate ||
+ 				    (tp->protocol != protocol && protocol)) {
+ 					err = -EINVAL;
++>>>>>>> 9d36d9e545dc (net: sched: replace nprio by a bool to make the function more readable)
  					goto errout;
 -				}
 -			} else {
 +			} else
  				tp = NULL;
 -			}
  			break;
  		}
  	}
@@@ -308,10 -410,20 +315,22 @@@
  			goto errout;
  		}
  
++<<<<<<< HEAD
++=======
+ 		if (prio_allocate)
+ 			prio = TC_H_MAJ(tcf_auto_prio(rtnl_dereference(*back)));
+ 
+ 		tp = tcf_proto_create(nla_data(tca[TCA_KIND]),
+ 				      protocol, prio, parent, q, block);
+ 		if (IS_ERR(tp)) {
+ 			err = PTR_ERR(tp);
+ 			goto errout;
+ 		}
++>>>>>>> 9d36d9e545dc (net: sched: replace nprio by a bool to make the function more readable)
  		tp_created = 1;
 -	} else if (tca[TCA_KIND] && nla_strcmp(tca[TCA_KIND], tp->ops->kind)) {
 -		err = -EINVAL;
 +
 +	} else if (tca[TCA_KIND] && nla_strcmp(tca[TCA_KIND], tp->ops->kind))
  		goto errout;
 -	}
  
  	fh = tp->ops->get(tp, t->tcm_handle);
  
* Unmerged path net/sched/cls_api.c
