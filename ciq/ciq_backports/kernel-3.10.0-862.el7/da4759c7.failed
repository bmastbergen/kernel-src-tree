sysfs: Use only return value from is_visible for the file mode

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
commit-author Guenter Roeck <linux@roeck-us.net>
commit da4759c73b0f1aac79f37bdb39ad2124439c30e7
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/da4759c7.failed

Up to now, is_visible can only be used to either remove visibility
of a file entirely or to add permissions, but not to reduce permissions.
This makes it impossible, for example, to use DEVICE_ATTR_RW to define
file attributes and reduce permissions to read-only.

This behavior is undesirable and unnecessarily complicates code which
needs to reduce permissions; instead of just returning the desired
permissions, it has to ensure that the permissions in the attribute
variable declaration only reflect the minimal permissions ever needed.

Change semantics of is_visible to only use the permissions returned
from it instead of oring the returned value with the hard-coded
permissions.

	Signed-off-by: Guenter Roeck <linux@roeck-us.net>
	Signed-off-by: Vivien Didelot <vivien.didelot@savoirfairelinux.com>
	Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
(cherry picked from commit da4759c73b0f1aac79f37bdb39ad2124439c30e7)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	fs/sysfs/group.c
diff --cc fs/sysfs/group.c
index 443e6d916039,3fdccd99a9d9..000000000000
--- a/fs/sysfs/group.c
+++ b/fs/sysfs/group.c
@@@ -56,9 -55,8 +56,14 @@@ static int create_files(struct sysfs_di
  				if (!mode)
  					continue;
  			}
++<<<<<<< HEAD
 +			error = sysfs_add_file_mode(dir_sd, *attr,
 +						    SYSFS_KOBJ_ATTR,
 +						    (*attr)->mode | mode);
++=======
+ 			error = sysfs_add_file_mode_ns(parent, *attr, false,
+ 						       mode, NULL);
++>>>>>>> da4759c73b0f (sysfs: Use only return value from is_visible for the file mode)
  			if (unlikely(error))
  				break;
  		}
* Unmerged path fs/sysfs/group.c
