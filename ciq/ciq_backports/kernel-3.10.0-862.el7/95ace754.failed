locks: Don't allow mounts in user namespaces to enable mandatory locking

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
Rebuild_CHGLOG: - [fs] locks: Don't allow mounts in user namespaces to enable mandatory locking ("Eric W. Biederman") [1487751]
Rebuild_FUZZ: 99.31%
commit-author Eric W. Biederman <ebiederm@xmission.com>
commit 95ace75414f312f9a7b93d873f386987b92a5301
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/95ace754.failed

Since no one uses mandatory locking and files with mandatory locks can
cause problems don't allow them in user namespaces.

	Signed-off-by: "Eric W. Biederman" <ebiederm@xmission.com>
	Signed-off-by: Jeff Layton <jeff.layton@primarydata.com>
(cherry picked from commit 95ace75414f312f9a7b93d873f386987b92a5301)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	fs/namespace.c
diff --cc fs/namespace.c
index c3276b690896,4d2c8f64b7bf..000000000000
--- a/fs/namespace.c
+++ b/fs/namespace.c
@@@ -1640,6 -1584,14 +1640,17 @@@ static inline bool may_mount(void
  	return ns_capable(current->nsproxy->mnt_ns->user_ns, CAP_SYS_ADMIN);
  }
  
++<<<<<<< HEAD
++=======
+ static inline bool may_mandlock(void)
+ {
+ #ifndef	CONFIG_MANDATORY_FILE_LOCKING
+ 	return false;
+ #endif
+ 	return capable(CAP_SYS_ADMIN);
+ }
+ 
++>>>>>>> 95ace75414f3 (locks: Don't allow mounts in user namespaces to enable mandatory locking)
  /*
   * Now umount can handle mount points as well as block devices.
   * This is important for filesystems which use unnamed block devices.
* Unmerged path fs/namespace.c
