iommu/amd: Detect and initialize guest vAPIC log

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
Rebuild_CHGLOG: - [iommu] amd: Detect and initialize guest vAPIC log (Jerry Snitselaar) [1411581]
Rebuild_FUZZ: 93.33%
commit-author Suravee Suthikulpanit <suravee.suthikulpanit@amd.com>
commit 8bda0cfbdc1a6278a1bbdba795139da682f296ff
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/8bda0cfb.failed

This patch adds support to detect and initialize IOMMU Guest vAPIC log
(GALOG). By default, it also enable GALog interrupt to notify IOMMU driver
when GA Log entry is created.

	Signed-off-by: Suravee Suthikulpanit <suravee.suthikulpanit@amd.com>
	Signed-off-by: Joerg Roedel <jroedel@suse.de>
(cherry picked from commit 8bda0cfbdc1a6278a1bbdba795139da682f296ff)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/iommu/amd_iommu_init.c
#	drivers/iommu/amd_iommu_types.h
diff --cc drivers/iommu/amd_iommu_init.c
index d1b313b945cf,156ab4b0f4bd..000000000000
--- a/drivers/iommu/amd_iommu_init.c
+++ b/drivers/iommu/amd_iommu_init.c
@@@ -1427,6 -1594,10 +1527,13 @@@ static int iommu_init_pci(struct amd_io
  	if (iommu_feature(iommu, FEATURE_PPR) && alloc_ppr_log(iommu))
  		return -ENOMEM;
  
++<<<<<<< HEAD
++=======
+ 	ret = iommu_init_ga(iommu);
+ 	if (ret)
+ 		return ret;
+ 
++>>>>>>> 8bda0cfbdc1a (iommu/amd: Detect and initialize guest vAPIC log)
  	if (iommu->cap & (1UL << IOMMU_CAP_NPCACHE))
  		amd_iommu_np_cache = true;
  
diff --cc drivers/iommu/amd_iommu_types.h
index c9e00df52a4f,8a7a93d40063..000000000000
--- a/drivers/iommu/amd_iommu_types.h
+++ b/drivers/iommu/amd_iommu_types.h
@@@ -79,6 -79,12 +81,15 @@@
  #define MMIO_STATUS_OFFSET	0x2020
  #define MMIO_PPR_HEAD_OFFSET	0x2030
  #define MMIO_PPR_TAIL_OFFSET	0x2038
++<<<<<<< HEAD
++=======
+ #define MMIO_GA_HEAD_OFFSET	0x2040
+ #define MMIO_GA_TAIL_OFFSET	0x2048
+ #define MMIO_CNTR_CONF_OFFSET	0x4000
+ #define MMIO_CNTR_REG_OFFSET	0x40000
+ #define MMIO_REG_END_OFFSET	0x80000
+ 
++>>>>>>> 8bda0cfbdc1a (iommu/amd: Detect and initialize guest vAPIC log)
  
  
  /* Extended Feature Bits */
@@@ -145,6 -155,10 +159,13 @@@
  #define CONTROL_PPFINT_EN       0x0eULL
  #define CONTROL_PPR_EN          0x0fULL
  #define CONTROL_GT_EN           0x10ULL
++<<<<<<< HEAD
++=======
+ #define CONTROL_GA_EN           0x11ULL
+ #define CONTROL_GAM_EN          0x19ULL
+ #define CONTROL_GALOG_EN        0x1CULL
+ #define CONTROL_GAINT_EN        0x1DULL
++>>>>>>> 8bda0cfbdc1a (iommu/amd: Detect and initialize guest vAPIC log)
  
  #define CTRL_INV_TO_MASK	(7 << CONTROL_INV_TIMEOUT)
  #define CTRL_INV_TO_NONE	0
* Unmerged path drivers/iommu/amd_iommu_init.c
* Unmerged path drivers/iommu/amd_iommu_types.h
