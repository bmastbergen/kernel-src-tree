brcmfmac: change driver unbind order of the sdio function devices

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
commit-author Arend Van Spriel <arend.vanspriel@broadcom.com>
commit 5c3de777bdaf48bd0cfb43097c0d0fb85056cab7
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/5c3de777.failed

In the function brcmf_sdio_firmware_callback() the driver is
unbound from the sdio function devices in the error path.
However, the order in which it is done resulted in a use-after-free
issue (see brcmf_ops_sdio_remove() in bcmsdh.c). Hence change
the order and first unbind sdio function #2 device and then
unbind sdio function #1 device.

	Cc: stable@vger.kernel.org # v4.12.x
Fixes: 7a51461fc2da ("brcmfmac: unbind all devices upon failure in firmware callback")
	Reported-by: Stefan Wahren <stefan.wahren@i2se.com>
	Reviewed-by: Hante Meuleman <hante.meuleman@broadcom.com>
	Reviewed-by: Pieter-Paul Giesberts <pieter-paul.giesberts@broadcom.com>
	Reviewed-by: Franky Lin <franky.lin@broadcom.com>
	Signed-off-by: Arend van Spriel <arend.vanspriel@broadcom.com>
	Signed-off-by: Kalle Valo <kvalo@codeaurora.org>
(cherry picked from commit 5c3de777bdaf48bd0cfb43097c0d0fb85056cab7)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/wireless/broadcom/brcm80211/brcmfmac/sdio.c
diff --cc drivers/net/wireless/broadcom/brcm80211/brcmfmac/sdio.c
index 67e69bff2545,adf180f338ca..000000000000
--- a/drivers/net/wireless/broadcom/brcm80211/brcmfmac/sdio.c
+++ b/drivers/net/wireless/broadcom/brcm80211/brcmfmac/sdio.c
@@@ -4069,6 -4121,7 +4069,10 @@@ release
  	sdio_release_host(sdiodev->func[1]);
  fail:
  	brcmf_dbg(TRACE, "failed: dev=%s, err=%d\n", dev_name(dev), err);
++<<<<<<< HEAD
++=======
+ 	device_release_driver(&sdiodev->func[2]->dev);
++>>>>>>> 5c3de777bdaf (brcmfmac: change driver unbind order of the sdio function devices)
  	device_release_driver(dev);
  }
  
* Unmerged path drivers/net/wireless/broadcom/brcm80211/brcmfmac/sdio.c
