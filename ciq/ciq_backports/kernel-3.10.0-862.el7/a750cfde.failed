IB/core: Fix static analysis warning in ib_policy_change_task

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
commit-author Daniel Jurgens <danielj@mellanox.com>
commit a750cfde1397dbbee1efe7737c2e952d6fc2d878
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/a750cfde.failed

ib_get_cached_subnet_prefix can technically fail, but the only way it
could is not possible based on the loop conditions. Check the return
value before using the variable sp to resolve a static analysis warning.

-v1:
- Fix check to !ret. Paul Moore

Fixes: 8f408ab64be6 ("selinux lsm IB/core: Implement LSM notification
system")
	Signed-off-by: Daniel Jurgens <danielj@mellanox.com>
	Reported-by: Dan Carpenter <dan.carpenter@oracle.com>
	Signed-off-by: Paul Moore <paul@paul-moore.com>
	Signed-off-by: James Morris <james.l.morris@oracle.com>
(cherry picked from commit a750cfde1397dbbee1efe7737c2e952d6fc2d878)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/infiniband/core/device.c
diff --cc drivers/infiniband/core/device.c
index 32656f7b9a64,a5dfab6adf49..000000000000
--- a/drivers/infiniband/core/device.c
+++ b/drivers/infiniband/core/device.c
@@@ -317,6 -335,65 +317,68 @@@ void ib_get_device_fw_str(struct ib_dev
  }
  EXPORT_SYMBOL(ib_get_device_fw_str);
  
++<<<<<<< HEAD
++=======
+ static int setup_port_pkey_list(struct ib_device *device)
+ {
+ 	int i;
+ 
+ 	/**
+ 	 * device->port_pkey_list is indexed directly by the port number,
+ 	 * Therefore it is declared as a 1 based array with potential empty
+ 	 * slots at the beginning.
+ 	 */
+ 	device->port_pkey_list = kcalloc(rdma_end_port(device) + 1,
+ 					 sizeof(*device->port_pkey_list),
+ 					 GFP_KERNEL);
+ 
+ 	if (!device->port_pkey_list)
+ 		return -ENOMEM;
+ 
+ 	for (i = 0; i < (rdma_end_port(device) + 1); i++) {
+ 		spin_lock_init(&device->port_pkey_list[i].list_lock);
+ 		INIT_LIST_HEAD(&device->port_pkey_list[i].pkey_list);
+ 	}
+ 
+ 	return 0;
+ }
+ 
+ static void ib_policy_change_task(struct work_struct *work)
+ {
+ 	struct ib_device *dev;
+ 
+ 	down_read(&lists_rwsem);
+ 	list_for_each_entry(dev, &device_list, core_list) {
+ 		int i;
+ 
+ 		for (i = rdma_start_port(dev); i <= rdma_end_port(dev); i++) {
+ 			u64 sp;
+ 			int ret = ib_get_cached_subnet_prefix(dev,
+ 							      i,
+ 							      &sp);
+ 
+ 			WARN_ONCE(ret,
+ 				  "ib_get_cached_subnet_prefix err: %d, this should never happen here\n",
+ 				  ret);
+ 			if (!ret)
+ 				ib_security_cache_change(dev, i, sp);
+ 		}
+ 	}
+ 	up_read(&lists_rwsem);
+ }
+ 
+ static int ib_security_change(struct notifier_block *nb, unsigned long event,
+ 			      void *lsm_data)
+ {
+ 	if (event != LSM_POLICY_CHANGE)
+ 		return NOTIFY_DONE;
+ 
+ 	schedule_work(&ib_policy_change_work);
+ 
+ 	return NOTIFY_OK;
+ }
+ 
++>>>>>>> a750cfde1397 (IB/core: Fix static analysis warning in ib_policy_change_task)
  /**
   * ib_register_device - Register an IB device with IB core
   * @device:Device to register
* Unmerged path drivers/infiniband/core/device.c
