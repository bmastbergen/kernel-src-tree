virtio_balloon: fix increment of vb->num_pfns in fill_balloon()

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
commit-author Jan Stancek <jstancek@redhat.com>
commit d9e427f6ab8142d6868eb719e6a7851aafea56b6
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/d9e427f6.failed

commit c7cdff0e8647 ("virtio_balloon: fix deadlock on OOM")
changed code to increment vb->num_pfns before call to
set_page_pfns(), which used to happen only after.

This patch fixes boot hang for me on ppc64le KVM guests.

Fixes: c7cdff0e8647 ("virtio_balloon: fix deadlock on OOM")
	Cc: Michael S. Tsirkin <mst@redhat.com>
	Cc: Tetsuo Handa <penguin-kernel@I-love.SAKURA.ne.jp>
	Cc: Michal Hocko <mhocko@suse.com>
	Cc: Wei Wang <wei.w.wang@intel.com>
	Cc: stable@vger.kernel.org
	Signed-off-by: Jan Stancek <jstancek@redhat.com>
	Signed-off-by: Michael S. Tsirkin <mst@redhat.com>
(cherry picked from commit d9e427f6ab8142d6868eb719e6a7851aafea56b6)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/virtio/virtio_balloon.c
diff --cc drivers/virtio/virtio_balloon.c
index 084ac49e6625,a1fb52cb3f0a..000000000000
--- a/drivers/virtio/virtio_balloon.c
+++ b/drivers/virtio/virtio_balloon.c
@@@ -156,6 -163,17 +156,20 @@@ static unsigned fill_balloon(struct vir
  			msleep(200);
  			break;
  		}
++<<<<<<< HEAD
++=======
+ 
+ 		balloon_page_push(&pages, page);
+ 	}
+ 
+ 	mutex_lock(&vb->balloon_lock);
+ 
+ 	vb->num_pfns = 0;
+ 
+ 	while ((page = balloon_page_pop(&pages))) {
+ 		balloon_page_enqueue(&vb->vb_dev_info, page);
+ 
++>>>>>>> d9e427f6ab81 (virtio_balloon: fix increment of vb->num_pfns in fill_balloon())
  		set_page_pfns(vb, vb->pfns + vb->num_pfns, page);
  		vb->num_pages += VIRTIO_BALLOON_PAGES_PER_PAGE;
  		if (!virtio_has_feature(vb->vdev,
* Unmerged path drivers/virtio/virtio_balloon.c
