xfs: truncate transaction does not modify the inobt

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
commit-author Brian Foster <bfoster@redhat.com>
commit a606ebdb859e78beb757dfefa08001df366e2ef5
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/a606ebdb.failed

The truncate transaction does not ever modify the inode btree, but
includes an associated log reservation. Update
xfs_calc_itruncate_reservation() to remove the reservation
associated with inobt updates.

	Signed-off-by: Brian Foster <bfoster@redhat.com>
	Reviewed-by: Dave Chinner <dchinner@redhat.com>
	Reviewed-by: Darrick J. Wong <darrick.wong@oracle.com>
	Signed-off-by: Darrick J. Wong <darrick.wong@oracle.com>
(cherry picked from commit a606ebdb859e78beb757dfefa08001df366e2ef5)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	fs/xfs/libxfs/xfs_trans_resv.c
diff --cc fs/xfs/libxfs/xfs_trans_resv.c
index 1b754cb1e8ae,037a1295d289..000000000000
--- a/fs/xfs/libxfs/xfs_trans_resv.c
+++ b/fs/xfs/libxfs/xfs_trans_resv.c
@@@ -217,13 -242,8 +215,18 @@@ xfs_calc_itruncate_reservation
  		     xfs_calc_buf_res(XFS_BM_MAXLEVELS(mp, XFS_DATA_FORK) + 1,
  				      XFS_FSB_TO_B(mp, 1))),
  		    (xfs_calc_buf_res(9, mp->m_sb.sb_sectsize) +
++<<<<<<< HEAD
 +		     xfs_calc_buf_res(XFS_ALLOCFREE_LOG_COUNT(mp, 4),
 +				      XFS_FSB_TO_B(mp, 1)) +
 +		    xfs_calc_buf_res(5, 0) +
 +		    xfs_calc_buf_res(XFS_ALLOCFREE_LOG_COUNT(mp, 1),
 +				     XFS_FSB_TO_B(mp, 1)) +
 +		    xfs_calc_buf_res(2 + mp->m_ialloc_blks +
 +				     mp->m_in_maxlevels, 0)));
++=======
+ 		     xfs_calc_buf_res(xfs_allocfree_log_count(mp, 4),
+ 				      XFS_FSB_TO_B(mp, 1))));
++>>>>>>> a606ebdb859e (xfs: truncate transaction does not modify the inobt)
  }
  
  /*
* Unmerged path fs/xfs/libxfs/xfs_trans_resv.c
