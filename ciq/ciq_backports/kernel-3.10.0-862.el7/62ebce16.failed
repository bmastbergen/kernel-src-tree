blk-mq: move debugfs_remove() of disk dir to blk_release_queue()

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
commit-author Omar Sandoval <osandov@fb.com>
commit 62ebce16c0ac2ffac44e32f931a2d8f6e749be4c
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/62ebce16.failed

This needs to happen after we tear down blktrace.

	Signed-off-by: Omar Sandoval <osandov@fb.com>
	Signed-off-by: Jens Axboe <axboe@fb.com>
(cherry picked from commit 62ebce16c0ac2ffac44e32f931a2d8f6e749be4c)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	block/blk-mq-sysfs.c
#	block/blk-sysfs.c
diff --cc block/blk-mq-sysfs.c
index 08941faf0f9a,295e69670c39..000000000000
--- a/block/blk-mq-sysfs.c
+++ b/block/blk-mq-sysfs.c
@@@ -388,6 -254,8 +388,11 @@@ static void __blk_mq_unregister_disk(st
  		kobject_put(&hctx->kobj);
  	}
  
++<<<<<<< HEAD
++=======
+ 	blk_mq_debugfs_unregister_hctxs(q);
+ 
++>>>>>>> 62ebce16c0ac (blk-mq: move debugfs_remove() of disk dir to blk_release_queue())
  	kobject_uevent(&q->mq_kobj, KOBJ_REMOVE);
  	kobject_del(&q->mq_kobj);
  	kobject_put(&q->mq_kobj);
diff --cc block/blk-sysfs.c
index 91f42f273aad,3ce1217778f4..000000000000
--- a/block/blk-sysfs.c
+++ b/block/blk-sysfs.c
@@@ -561,7 -823,12 +561,15 @@@ static void blk_release_queue(struct ko
  
  	blk_trace_shutdown(q);
  
++<<<<<<< HEAD
 +	bdi_destroy(&q->backing_dev_info);
++=======
+ 	if (q->mq_ops)
+ 		blk_mq_debugfs_unregister(q);
+ 
+ 	if (q->bio_split)
+ 		bioset_free(q->bio_split);
++>>>>>>> 62ebce16c0ac (blk-mq: move debugfs_remove() of disk dir to blk_release_queue())
  
  	ida_simple_remove(&blk_queue_ida, q->id);
  	call_rcu(&q->rcu_head, blk_free_queue_rcu);
* Unmerged path block/blk-mq-sysfs.c
* Unmerged path block/blk-sysfs.c
