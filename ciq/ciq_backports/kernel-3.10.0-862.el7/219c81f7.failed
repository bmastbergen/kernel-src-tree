net/mlx5: Fix command bad flow on command entry allocation failure

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
Rebuild_CHGLOG: - [netdrv] mlx5: Fix command bad flow on command entry allocation failure (Kamal Heib) [1456694]
Rebuild_FUZZ: 96.88%
commit-author Moshe Shemesh <moshe@mellanox.com>
commit 219c81f7d1d5a89656cb3b53d3b4e11e93608d80
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/219c81f7.failed

When driver fail to allocate an entry to send command to FW, it must
notify the calling function and release the memory allocated for
this command.

Fixes: e126ba97dba9e ('mlx5: Add driver for Mellanox Connect-IB adapters')
	Signed-off-by: Moshe Shemesh <moshe@mellanox.com>
	Cc: kernel-team@fb.com
	Signed-off-by: Saeed Mahameed <saeedm@mellanox.com>
(cherry picked from commit 219c81f7d1d5a89656cb3b53d3b4e11e93608d80)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/mellanox/mlx5/core/cmd.c
diff --cc drivers/net/ethernet/mellanox/mlx5/core/cmd.c
index 2f8331466ba6,31cbe5e86a01..000000000000
--- a/drivers/net/ethernet/mellanox/mlx5/core/cmd.c
+++ b/drivers/net/ethernet/mellanox/mlx5/core/cmd.c
@@@ -787,6 -799,9 +791,12 @@@ static void cmd_work_handler(struct wor
  	struct mlx5_cmd_layout *lay;
  	struct semaphore *sem;
  	unsigned long flags;
++<<<<<<< HEAD
++=======
+ 	bool poll_cmd = ent->polling;
+ 	int alloc_ret;
+ 
++>>>>>>> 219c81f7d1d5 (net/mlx5: Fix command bad flow on command entry allocation failure)
  
  	sem = ent->page_queue ? &cmd->pages_sem : &cmd->sem;
  	down(sem);
* Unmerged path drivers/net/ethernet/mellanox/mlx5/core/cmd.c
