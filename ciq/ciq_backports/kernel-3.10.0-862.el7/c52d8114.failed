IB/core: A small refactor in destroy WQ handler

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
commit-author Matan Barak <matanb@mellanox.com>
commit c52d8114d1a58f6fe4bfb9af39d262dd8f21e50e
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/c52d8114.failed

Instead of having uverbs_uobject_put both in the error flow and the
good flow, we unite them.

Fixes: fd3c7904db6e ('IB/core: Change idr objects to use the new schema')
	Signed-off-by: Matan Barak <matanb@mellanox.com>
	Reviewed-by: Sean Hefty <sean.hefty@intel.com>
	Signed-off-by: Doug Ledford <dledford@redhat.com>
(cherry picked from commit c52d8114d1a58f6fe4bfb9af39d262dd8f21e50e)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/infiniband/core/uverbs_cmd.c
diff --cc drivers/infiniband/core/uverbs_cmd.c
index 9f5575bf9d2c,66cb22e82e24..000000000000
--- a/drivers/infiniband/core/uverbs_cmd.c
+++ b/drivers/infiniband/core/uverbs_cmd.c
@@@ -3463,25 -2982,15 +3463,31 @@@ int ib_uverbs_ex_destroy_wq(struct ib_u
  
  	wq = uobj->object;
  	obj = container_of(uobj, struct ib_uwq_object, uevent.uobject);
 -	/*
 -	 * Make sure we don't free the memory in remove_commit as we still
 -	 * needs the uobject memory to create the response.
 -	 */
 -	uverbs_uobject_get(uobj);
 +	ret = ib_destroy_wq(wq);
 +	if (!ret)
 +		uobj->live = 0;
 +
++<<<<<<< HEAD
 +	put_uobj_write(uobj);
 +	if (ret)
 +		return ret;
 +
 +	idr_remove_uobj(&ib_uverbs_wq_idr, uobj);
 +
 +	mutex_lock(&file->mutex);
 +	list_del(&uobj->list);
 +	mutex_unlock(&file->mutex);
 +
 +	ib_uverbs_release_uevent(file, &obj->uevent);
 +	resp.events_reported = obj->uevent.events_reported;
 +	put_uobj(uobj);
  
 +	ret = ib_copy_to_udata(ucore, &resp, resp.response_length);
++=======
+ 	ret = uobj_remove_commit(uobj);
+ 	resp.events_reported = obj->uevent.events_reported;
+ 	uverbs_uobject_put(uobj);
++>>>>>>> c52d8114d1a5 (IB/core: A small refactor in destroy WQ handler)
  	if (ret)
  		return ret;
  
* Unmerged path drivers/infiniband/core/uverbs_cmd.c
