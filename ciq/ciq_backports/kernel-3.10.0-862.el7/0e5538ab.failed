net sched: simple action fix late binding

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
commit-author Jamal Hadi Salim <jhs@mojatatu.com>
commit 0e5538ab2b59ec205411949d839de6dbab663730
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/0e5538ab.failed

The process below was broken and is fixed with this patch.

//add a simple action and give it an instance id of 1
sudo tc actions add action simple sdata "foobar" index 1
//create a filter which binds to simple action id 1
sudo tc filter add dev $DEV parent ffff: protocol ip prio 1 u32\
match ip dst 17.0.0.1/32 flowid 1:10 action simple index 1

Message before fix was:
RTNETLINK answers: Invalid argument
We have an error talking to the kernel

	Signed-off-by: Jamal Hadi Salim <jhs@mojatatu.com>
	Reviewed-by: Cong Wang <xiyou.wangcong@gmail.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 0e5538ab2b59ec205411949d839de6dbab663730)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/sched/act_simple.c
diff --cc net/sched/act_simple.c
index 4876cc19a2ed,3a33fb648a6d..000000000000
--- a/net/sched/act_simple.c
+++ b/net/sched/act_simple.c
@@@ -96,15 -99,23 +96,29 @@@ static int tcf_simp_init(struct net *ne
  	if (tb[TCA_DEF_PARMS] == NULL)
  		return -EINVAL;
  
- 	if (tb[TCA_DEF_DATA] == NULL)
- 		return -EINVAL;
  
  	parm = nla_data(tb[TCA_DEF_PARMS]);
+ 	exists = tcf_hash_check(tn, parm->index, a, bind);
+ 	if (exists && bind)
+ 		return 0;
+ 
+ 	if (tb[TCA_DEF_DATA] == NULL) {
+ 		if (exists)
+ 			tcf_hash_release(a, bind);
+ 		return -EINVAL;
+ 	}
+ 
  	defdata = nla_data(tb[TCA_DEF_DATA]);
  
++<<<<<<< HEAD
 +	if (!tcf_hash_check(parm->index, a, bind)) {
 +		ret = tcf_hash_create(parm->index, est, a, sizeof(*d),
 +				      bind, false);
++=======
+ 	if (!exists) {
+ 		ret = tcf_hash_create(tn, parm->index, est, a,
+ 				      sizeof(*d), bind, false);
++>>>>>>> 0e5538ab2b59 (net sched: simple action fix late binding)
  		if (ret)
  			return ret;
  
* Unmerged path net/sched/act_simple.c
