ipv4: fib_rules: Add notifier info to FIB rules notifications

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
commit-author Ido Schimmel <idosch@mellanox.com>
commit 6a003a5ff29499a94373110202631743663569c6
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/6a003a5f.failed

Whenever a FIB rule is added or removed, a notification is sent in the
FIB notification chain. However, listeners don't have a way to tell
which rule was added or removed.

This is problematic as we would like to give listeners the ability to
decide which action to execute based on the notified rule. Specifically,
offloading drivers should be able to determine if they support the
reflection of the notified FIB rule and flush their LPM tables in case
they don't.

Do that by adding a notifier info to these notifications and embed the
common FIB rule struct in it.

	Signed-off-by: Ido Schimmel <idosch@mellanox.com>
	Acked-by: David Ahern <dsa@cumulusnetworks.com>
	Signed-off-by: Jiri Pirko <jiri@mellanox.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 6a003a5ff29499a94373110202631743663569c6)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/ipv4/fib_rules.c
diff --cc net/ipv4/fib_rules.c
index 329dfa168e33,310d24a2e097..000000000000
--- a/net/ipv4/fib_rules.c
+++ b/net/ipv4/fib_rules.c
@@@ -215,7 -282,9 +218,13 @@@ static void fib4_rule_delete(struct fib
  		net->ipv4.fib_num_tclassid_users--;
  #endif
  	net->ipv4.fib_has_custom_rules = true;
++<<<<<<< HEAD
 +	call_fib_rule_notifiers(net, FIB_EVENT_RULE_DEL);
++=======
+ 	call_fib_rule_notifiers(net, FIB_EVENT_RULE_DEL, rule);
+ errout:
+ 	return err;
++>>>>>>> 6a003a5ff294 (ipv4: fib_rules: Add notifier info to FIB rules notifications)
  }
  
  static int fib4_rule_compare(struct fib_rule *rule, struct fib_rule_hdr *frh,
diff --git a/include/net/ip_fib.h b/include/net/ip_fib.h
index c9e0e41061bc..52045accaa40 100644
--- a/include/net/ip_fib.h
+++ b/include/net/ip_fib.h
@@ -212,6 +212,11 @@ struct fib_entry_notifier_info {
 	u32 tb_id;
 };
 
+struct fib_rule_notifier_info {
+	struct fib_notifier_info info; /* must be first */
+	struct fib_rule *rule;
+};
+
 struct fib_nh_notifier_info {
 	struct fib_notifier_info info; /* must be first */
 	struct fib_nh *fib_nh;
* Unmerged path net/ipv4/fib_rules.c
