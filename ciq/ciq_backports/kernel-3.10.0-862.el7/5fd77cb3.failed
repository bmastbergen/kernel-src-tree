EDAC, pnd2: Conditionally unhide/hide the P2SB PCI device to read BAR

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
Rebuild_CHGLOG: - [edac] pnd2: Conditionally unhide/hide the P2SB PCI device to read BAR (Aristeu Rozanski) [1479627 1273769]
Rebuild_FUZZ: 95.45%
commit-author Qiuxu Zhuo <qiuxu.zhuo@intel.com>
commit 5fd77cb3bac77f690d1d9cf57dc7851fcb3e7945
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/5fd77cb3.failed

On Deverton server, the P2SB PCI device (DEV:1F, FUN:1) is used by multiple
device drivers.

If it's hidden by some device driver (e.g. with the i801 I2C driver,
the commit

  9424693035a5 ("i2c: i801: Create iTCO device on newer Intel PCHs")

unconditionally hid the P2SB PCI device wrongly) it will make the
pnd2_edac driver read out an invalid BAR value of 0xffffffff and then
fail on ioremap().

Therefore, store the presence state of P2SB PCI device before unhiding
it for reading BAR and restore the presence state after reading BAR.

	Signed-off-by: Qiuxu Zhuo <qiuxu.zhuo@intel.com>
	Cc: Tony Luck <tony.luck@intel.com>
	Cc: linux-edac <linux-edac@vger.kernel.org>
	Cc: linux-i2c@vger.kernel.org
Link: http://lkml.kernel.org/r/20170814154845.21663-1-qiuxu.zhuo@intel.com
	Signed-off-by: Borislav Petkov <bp@suse.de>
(cherry picked from commit 5fd77cb3bac77f690d1d9cf57dc7851fcb3e7945)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/edac/pnd2_edac.c
* Unmerged path drivers/edac/pnd2_edac.c
* Unmerged path drivers/edac/pnd2_edac.c
