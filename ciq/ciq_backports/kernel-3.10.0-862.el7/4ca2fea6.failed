ceph: unify inode i_ctime update

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
commit-author Yan, Zheng <zyan@redhat.com>
commit 4ca2fea6f8277ab381bd08b996d641255b6f7b00
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/4ca2fea6.failed

Current __ceph_setattr() can set inode's i_ctime to current_time(),
req->r_stamp or attr->ia_ctime. These time stamps may have minor
differences. It may cause potential problem.

	Signed-off-by: "Yan, Zheng" <zyan@redhat.com>
	Acked-by: Arnd Bergmann <arnd@arndb.de>
	Signed-off-by: Ilya Dryomov <idryomov@gmail.com>
(cherry picked from commit 4ca2fea6f8277ab381bd08b996d641255b6f7b00)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	fs/ceph/inode.c
diff --cc fs/ceph/inode.c
index 9d67b9b0f077,4de6cdddf059..000000000000
--- a/fs/ceph/inode.c
+++ b/fs/ceph/inode.c
@@@ -2037,7 -2065,7 +2035,11 @@@ int ceph_setattr(struct dentry *dentry
  	if (dirtied) {
  		inode_dirty_flags = __ceph_mark_dirty_caps(ci, dirtied,
  							   &prealloc_cf);
++<<<<<<< HEAD
 +		inode->i_ctime = current_fs_time(inode->i_sb);
++=======
+ 		inode->i_ctime = attr->ia_ctime;
++>>>>>>> 4ca2fea6f827 (ceph: unify inode i_ctime update)
  	}
  
  	release &= issued;
diff --git a/fs/ceph/acl.c b/fs/ceph/acl.c
index 626b3d36ffe2..3c0fdef43afc 100644
--- a/fs/ceph/acl.c
+++ b/fs/ceph/acl.c
@@ -146,6 +146,7 @@ static int ceph_set_acl(struct dentry *dentry, struct inode *inode,
 	}
 
 	if (new_mode != old_mode) {
+		newattrs.ia_ctime = current_time(inode);
 		newattrs.ia_mode = new_mode;
 		newattrs.ia_valid = ATTR_MODE;
 		ret = ceph_setattr(dentry, &newattrs);
* Unmerged path fs/ceph/inode.c
