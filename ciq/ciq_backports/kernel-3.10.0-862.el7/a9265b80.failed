mlxsw: spectrum_switchdev: Remove unused variable

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
commit-author Ido Schimmel <idosch@mellanox.com>
commit a9265b804dfdfca4e2ce3730fe0528da9c01dbf7
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/a9265b80.failed

Commit 10e23eb299fa ("mlxsw: spectrum: Remove support for bypass bridge
port attributes/vlan set") removed statements that used 'bridge_vlan',
but didn't remove the variable itself resulting in the following warning
with W=1:

warning: variable ‘bridge_vlan’ set but not used
[-Wunused-but-set-variable]

Remove the variable and suppress the warning.

Fixes: 10e23eb299fa ("mlxsw: spectrum: Remove support for bypass bridge port attributes/vlan set")
	Signed-off-by: Ido Schimmel <idosch@mellanox.com>
	Signed-off-by: Jiri Pirko <jiri@mellanox.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit a9265b804dfdfca4e2ce3730fe0528da9c01dbf7)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/mellanox/mlxsw/spectrum_switchdev.c
diff --cc drivers/net/ethernet/mellanox/mlxsw/spectrum_switchdev.c
index a7736231096b,4733fe918315..000000000000
--- a/drivers/net/ethernet/mellanox/mlxsw/spectrum_switchdev.c
+++ b/drivers/net/ethernet/mellanox/mlxsw/spectrum_switchdev.c
@@@ -635,31 -940,45 +635,35 @@@ err_port_flood_set
  	return err;
  }
  
 -void
 -mlxsw_sp_port_vlan_bridge_leave(struct mlxsw_sp_port_vlan *mlxsw_sp_port_vlan)
 +static void mlxsw_sp_port_fid_leave(struct mlxsw_sp_port *mlxsw_sp_port,
 +				    u16 fid)
  {
 -	struct mlxsw_sp_port *mlxsw_sp_port = mlxsw_sp_port_vlan->mlxsw_sp_port;
 -	struct mlxsw_sp_fid *fid = mlxsw_sp_port_vlan->fid;
 -	struct mlxsw_sp_bridge_vlan *bridge_vlan;
 -	struct mlxsw_sp_bridge_port *bridge_port;
 -	u16 vid = mlxsw_sp_port_vlan->vid;
 -	bool last;
 -
 -	if (WARN_ON(mlxsw_sp_fid_type(fid) != MLXSW_SP_FID_TYPE_8021Q &&
 -		    mlxsw_sp_fid_type(fid) != MLXSW_SP_FID_TYPE_8021D))
 -		return;
 -
 -	bridge_port = mlxsw_sp_port_vlan->bridge_port;
 -	bridge_vlan = mlxsw_sp_bridge_vlan_find(bridge_port, vid);
 -	last = list_is_singular(&bridge_vlan->port_vlan_list);
 -
 -	list_del(&mlxsw_sp_port_vlan->bridge_vlan_node);
 -	mlxsw_sp_bridge_vlan_put(bridge_vlan);
 -	mlxsw_sp_port_vid_stp_set(mlxsw_sp_port, vid, BR_STATE_DISABLED);
 -	mlxsw_sp_port_vid_learning_set(mlxsw_sp_port, vid, false);
 -	if (last)
 -		mlxsw_sp_bridge_port_fdb_flush(mlxsw_sp_port->mlxsw_sp,
 -					       bridge_port,
 -					       mlxsw_sp_fid_index(fid));
 -	mlxsw_sp_port_vlan_fid_leave(mlxsw_sp_port_vlan);
 +	mlxsw_sp_port_fid_map(mlxsw_sp_port, fid, false);
 +	__mlxsw_sp_port_flood_set(mlxsw_sp_port, fid, fid, false,
 +				  false, false);
 +	__mlxsw_sp_port_fid_leave(mlxsw_sp_port, fid);
 +}
  
 -	mlxsw_sp_bridge_port_put(mlxsw_sp_port->mlxsw_sp->bridge, bridge_port);
 -	mlxsw_sp_port_vlan->bridge_port = NULL;
 +static u16
 +mlxsw_sp_port_pvid_determine(const struct mlxsw_sp_port *mlxsw_sp_port,
 +			     u16 vid, bool is_pvid)
 +{
 +	if (is_pvid)
 +		return vid;
 +	else if (mlxsw_sp_port->pvid == vid)
 +		return 0;	/* Dis-allow untagged packets */
 +	else
 +		return mlxsw_sp_port->pvid;
  }
  
 -static int
 -mlxsw_sp_bridge_port_vlan_add(struct mlxsw_sp_port *mlxsw_sp_port,
 -			      struct mlxsw_sp_bridge_port *bridge_port,
 -			      u16 vid, bool is_untagged, bool is_pvid)
 +static int mlxsw_sp_port_vlan_add(struct mlxsw_sp_port *mlxsw_sp_port, u16 vid,
 +				  bool is_untagged, bool is_pvid)
  {
  	u16 pvid = mlxsw_sp_port_pvid_determine(mlxsw_sp_port, vid, is_pvid);
++<<<<<<< HEAD
++=======
+ 	struct mlxsw_sp_port_vlan *mlxsw_sp_port_vlan;
++>>>>>>> a9265b804dfd (mlxsw: spectrum_switchdev: Remove unused variable)
  	u16 old_pvid = mlxsw_sp_port->pvid;
  	int err;
  
@@@ -676,27 -995,13 +680,30 @@@
  	if (err)
  		goto err_port_pvid_set;
  
 -	err = mlxsw_sp_port_vlan_bridge_join(mlxsw_sp_port_vlan, bridge_port);
 +	err = mlxsw_sp_port_vid_learning_set(mlxsw_sp_port, vid,
 +					     mlxsw_sp_port->learning);
 +	if (err)
 +		goto err_port_vid_learning_set;
 +
++<<<<<<< HEAD
 +	err = mlxsw_sp_port_vid_stp_set(mlxsw_sp_port, vid,
 +					mlxsw_sp_port->stp_state);
  	if (err)
 -		goto err_port_vlan_bridge_join;
 +		goto err_port_vid_stp_set;
 +
 +	if (is_untagged)
 +		__set_bit(vid, mlxsw_sp_port->untagged_vlans);
 +	else
 +		__clear_bit(vid, mlxsw_sp_port->untagged_vlans);
 +	__set_bit(vid, mlxsw_sp_port->active_vlans);
  
++=======
++>>>>>>> a9265b804dfd (mlxsw: spectrum_switchdev: Remove unused variable)
  	return 0;
  
 -err_port_vlan_bridge_join:
 +err_port_vid_stp_set:
 +	mlxsw_sp_port_vid_learning_set(mlxsw_sp_port, vid, false);
 +err_port_vid_learning_set:
  	mlxsw_sp_port_pvid_set(mlxsw_sp_port, old_pvid);
  err_port_pvid_set:
  	mlxsw_sp_port_vlan_set(mlxsw_sp_port, vid, vid, false, false);
* Unmerged path drivers/net/ethernet/mellanox/mlxsw/spectrum_switchdev.c
