ovl: fix creds leak in copy up error path

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
commit-author Amir Goldstein <amir73il@gmail.com>
commit 8137ae26d25303e7b5cfb418fd28b976461e5b6e
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/8137ae26.failed

Fixes: 42f269b92540 ("ovl: rearrange code in ovl_copy_up_locked()")
	Cc: <stable@vger.kernel.org> # v4.11
	Signed-off-by: Amir Goldstein <amir73il@gmail.com>
	Signed-off-by: Miklos Szeredi <mszeredi@redhat.com>
(cherry picked from commit 8137ae26d25303e7b5cfb418fd28b976461e5b6e)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	fs/overlayfs/copy_up.c
diff --cc fs/overlayfs/copy_up.c
index 6e96b99a973d,061a8448e6c4..000000000000
--- a/fs/overlayfs/copy_up.c
+++ b/fs/overlayfs/copy_up.c
@@@ -295,10 -339,18 +295,25 @@@ static int ovl_copy_up_locked(struct de
  	if (new_creds)
  		old_creds = override_creds(new_creds);
  
++<<<<<<< HEAD
 +	/* Can't properly set mode on creation because of the umask */
 +	stat->mode &= S_IFMT;
 +	err = ovl_create_real(wdir, newdentry, stat, link, NULL, true);
 +	stat->mode = mode;
++=======
+ 	if (tmpfile)
+ 		temp = ovl_do_tmpfile(upperdir, stat->mode);
+ 	else
+ 		temp = ovl_lookup_temp(workdir, dentry);
+ 	err = 0;
+ 	if (IS_ERR(temp)) {
+ 		err = PTR_ERR(temp);
+ 		temp = NULL;
+ 	}
+ 
+ 	if (!err && !tmpfile)
+ 		err = ovl_create_real(wdir, temp, &cattr, NULL, true);
++>>>>>>> 8137ae26d253 (ovl: fix creds leak in copy up error path)
  
  	if (new_creds) {
  		revert_creds(old_creds);
* Unmerged path fs/overlayfs/copy_up.c
