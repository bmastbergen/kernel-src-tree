net/mlx5: Stay in polling mode when command EQ destroy fails

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
Rebuild_CHGLOG: - [netdrv] mlx5: Stay in polling mode when command EQ destroy fails (Kamal Heib) [1534242]
Rebuild_FUZZ: 96.55%
commit-author Moshe Shemesh <moshe@mellanox.com>
commit a2fba188fd5eadd6061bef4f2f2577a43231ebf3
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/a2fba188.failed

During unload, on mlx5_stop_eqs we move command interface from events
mode to polling mode, but if command interface EQ destroy fail we move
back to events mode.
That's wrong since even if we fail to destroy command interface EQ, we
do release its irq, so no interrupts will be received.

Fixes: e126ba97dba9 ("mlx5: Add driver for Mellanox Connect-IB adapters")
	Signed-off-by: Moshe Shemesh <moshe@mellanox.com>
	Signed-off-by: Saeed Mahameed <saeedm@mellanox.com>
(cherry picked from commit a2fba188fd5eadd6061bef4f2f2577a43231ebf3)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/mellanox/mlx5/core/eq.c
diff --cc drivers/net/ethernet/mellanox/mlx5/core/eq.c
index e96faecb3e7d,e7e7cef2bde4..000000000000
--- a/drivers/net/ethernet/mellanox/mlx5/core/eq.c
+++ b/drivers/net/ethernet/mellanox/mlx5/core/eq.c
@@@ -555,9 -802,8 +555,14 @@@ int mlx5_stop_eqs(struct mlx5_core_dev 
  
  	err = mlx5_destroy_unmap_eq(dev, &table->cmd_eq);
  	if (err)
++<<<<<<< HEAD
 +		mlx5_cmd_use_events(dev);
 +
 +	return err;
++=======
+ 		mlx5_core_err(dev, "failed to destroy command eq, err(%d)\n",
+ 			      err);
++>>>>>>> a2fba188fd5e (net/mlx5: Stay in polling mode when command EQ destroy fails)
  }
  
  int mlx5_core_eq_query(struct mlx5_core_dev *dev, struct mlx5_eq *eq,
* Unmerged path drivers/net/ethernet/mellanox/mlx5/core/eq.c
