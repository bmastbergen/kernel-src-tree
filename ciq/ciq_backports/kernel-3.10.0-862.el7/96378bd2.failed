ath10k: fix core PCI suspend when WoWLAN is supported but disabled

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
commit-author Brian Norris <briannorris@chromium.org>
commit 96378bd2c6cda5f04d0f6da2cd35d4670a982c38
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/96378bd2.failed

For devices where the FW supports WoWLAN but user-space has not
configured it, we don't do any PCI-specific suspend/resume operations,
because mac80211 doesn't call drv_suspend() when !wowlan. This has
particularly bad effects for some platforms, because we don't stop the
power-save timer, and if this timer goes off after the PCI controller
has suspended the link, Bad Things will happen.

Commit 32faa3f0ee50 ("ath10k: add the PCI PM core suspend/resume ops")
got some of this right, in that it understood there was a problem on
non-WoWLAN firmware. But it forgot the $subject case.

Fix this by moving all the PCI driver suspend/resume logic exclusively
into the driver PM hooks. This shouldn't affect WoWLAN support much
(this just gets executed later on).

I would just as well kill the entirety of ath10k_hif_suspend(), as it's
not even implemented on the USB or SDIO drivers. I expect that we don't
need the callback, except to return "supported" (i.e., 0) or "not
supported" (i.e., -EOPNOTSUPP).

Fixes: 32faa3f0ee50 ("ath10k: add the PCI PM core suspend/resume ops")
Fixes: 77258d409ce4 ("ath10k: enable pci soc powersaving")
	Signed-off-by: Brian Norris <briannorris@chromium.org>
	Cc: Ryan Hsu <ryanhsu@qti.qualcomm.com>
	Cc: Kalle Valo <kvalo@qca.qualcomm.com>
	Cc: Michal Kazior <michal.kazior@tieto.com>
	Signed-off-by: Kalle Valo <kvalo@qca.qualcomm.com>
(cherry picked from commit 96378bd2c6cda5f04d0f6da2cd35d4670a982c38)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/wireless/ath/ath10k/pci.c
diff --cc drivers/net/wireless/ath/ath10k/pci.c
index 6094372307aa,4655c944e3fd..000000000000
--- a/drivers/net/wireless/ath/ath10k/pci.c
+++ b/drivers/net/wireless/ath/ath10k/pci.c
@@@ -3372,6 -3408,37 +3384,40 @@@ static void ath10k_pci_remove(struct pc
  
  MODULE_DEVICE_TABLE(pci, ath10k_pci_id_table);
  
++<<<<<<< HEAD
++=======
+ #ifdef CONFIG_PM
+ 
+ static int ath10k_pci_pm_suspend(struct device *dev)
+ {
+ 	struct ath10k *ar = dev_get_drvdata(dev);
+ 	int ret;
+ 
+ 	ret = ath10k_pci_suspend(ar);
+ 	if (ret)
+ 		ath10k_warn(ar, "failed to suspend hif: %d\n", ret);
+ 
+ 	return ret;
+ }
+ 
+ static int ath10k_pci_pm_resume(struct device *dev)
+ {
+ 	struct ath10k *ar = dev_get_drvdata(dev);
+ 	int ret;
+ 
+ 	ret = ath10k_pci_resume(ar);
+ 	if (ret)
+ 		ath10k_warn(ar, "failed to resume hif: %d\n", ret);
+ 
+ 	return ret;
+ }
+ 
+ static SIMPLE_DEV_PM_OPS(ath10k_pci_pm_ops,
+ 			 ath10k_pci_pm_suspend,
+ 			 ath10k_pci_pm_resume);
+ #endif
+ 
++>>>>>>> 96378bd2c6cd (ath10k: fix core PCI suspend when WoWLAN is supported but disabled)
  static struct pci_driver ath10k_pci_driver = {
  	.name = "ath10k_pci",
  	.id_table = ath10k_pci_id_table,
* Unmerged path drivers/net/wireless/ath/ath10k/pci.c
