scsi: qla2xxx: Fix uninitialized work element

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
Rebuild_CHGLOG: - [scsi] qla2xxx: Fix uninitialized work element (Himanshu Madhani) [1500417]
Rebuild_FUZZ: 92.86%
commit-author Quinn Tran <quinn.tran@cavium.com>
commit a9e170e28636fd577249f39029d59e4e960a42b8
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/a9e170e2.failed

Fixes following stack trace

kernel: Call Trace:
kernel: dump_stack+0x63/0x84
kernel: __warn+0xd1/0xf0
kernel: warn_slowpath_null+0x1d/0x20
kernel: __queue_work+0x37a/0x420
kernel: queue_work_on+0x27/0x40
kernel: queue_work+0x14/0x20 [qla2xxx]
kernel: schedule_work+0x13/0x20 [qla2xxx]
kernel: qla2x00_post_work+0xab/0xb0 [qla2xxx]
kernel: qla2x00_post_aen_work+0x3b/0x50 [qla2xxx]
kernel: qla2x00_async_event+0x20d/0x15d0 [qla2xxx]
kernel: ? lock_timer_base+0x7d/0xa0
kernel: qla24xx_intr_handler+0x1da/0x310 [qla2xxx]
kernel: qla2x00_poll+0x36/0x60 [qla2xxx]
kernel: qla2x00_mailbox_command+0x659/0xec0 [qla2xxx]
kernel: ? proc_create_data+0x7a/0xd0
kernel: qla25xx_init_rsp_que+0x15b/0x240 [qla2xxx]
kernel: ? request_irq+0x14/0x20 [qla2xxx]
kernel: qla25xx_create_rsp_que+0x256/0x3c0 [qla2xxx]
kernel: qla2xxx_create_qpair+0x2af/0x5b0 [qla2xxx]
kernel: qla2x00_probe_one+0x1107/0x1c30 [qla2xxx]

Fixes: ec7193e26055 ("qla2xxx: Fix delayed response to command for loop mode/direct connect.")
	Cc: <stable@vger.kernel.org> # 4.13
	Signed-off-by: Quinn Tran <quinn.tran@cavium.com>
	Signed-off-by: Himanshu Madhani <himanshu.madhani@cavium.com>
	Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
(cherry picked from commit a9e170e28636fd577249f39029d59e4e960a42b8)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/scsi/qla2xxx/qla_os.c
diff --cc drivers/scsi/qla2xxx/qla_os.c
index c724f888aca6,937209805baf..000000000000
--- a/drivers/scsi/qla2xxx/qla_os.c
+++ b/drivers/scsi/qla2xxx/qla_os.c
@@@ -3066,19 -3175,31 +3066,44 @@@ qla2x00_probe_one(struct pci_dev *pdev
  	    host->can_queue, base_vha->req,
  	    base_vha->mgmt_svr_loop_id, host->sg_tablesize);
  
++<<<<<<< HEAD
 +	if (ha->mqenable && qla_ini_mode_enabled(base_vha)) {
 +		base_vha->qps_hint = alloc_percpu(struct qla_percpu_qp_hint);
 +		ha->wq = alloc_workqueue("qla2xxx_wq", WQ_MEM_RECLAIM, 1);
 +		/* Create start of day qpairs for Block MQ */
 +		if (shost_use_blk_mq(host)) {
 +			cpumask_clear(&cpu_mask);
 +			for (cpu_id = 0; cpu_id < ha->max_qpairs; cpu_id++) {
 +				cpumask_set_cpu(cpu_id, &cpu_mask);
 +				qla2xxx_create_qpair(base_vha, &cpu_mask, 5, 0);
 +				cpumask_clear_cpu(cpu_id, &cpu_mask);
 +			}
++=======
+ 	INIT_WORK(&base_vha->iocb_work, qla2x00_iocb_work_fn);
+ 
+ 	if (ha->mqenable) {
+ 		bool mq = false;
+ 		bool startit = false;
+ 		ha->wq = alloc_workqueue("qla2xxx_wq", WQ_MEM_RECLAIM, 0);
+ 
+ 		if (QLA_TGT_MODE_ENABLED()) {
+ 			mq = true;
+ 			startit = false;
+ 		}
+ 
+ 		if ((ql2x_ini_mode == QLA2XXX_INI_MODE_ENABLED) &&
+ 		    shost_use_blk_mq(host)) {
+ 			mq = true;
+ 			startit = true;
+ 		}
+ 
+ 		if (mq) {
+ 			/* Create start of day qpairs for Block MQ */
+ 			for (i = 0; i < ha->max_qpairs; i++)
+ 				qla2xxx_create_qpair(base_vha, 5, 0, startit);
++>>>>>>> a9e170e28636 (scsi: qla2xxx: Fix uninitialized work element)
  		}
  	}
 -
  	if (ha->flags.running_gold_fw)
  		goto skip_dpc;
  
* Unmerged path drivers/scsi/qla2xxx/qla_os.c
