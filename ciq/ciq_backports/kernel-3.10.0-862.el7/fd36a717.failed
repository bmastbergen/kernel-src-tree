ceph: pass parent dir ino info to build_dentry_path

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
commit-author Jeff Layton <jlayton@redhat.com>
commit fd36a71762f3b0fcb9741ed24021afabec7e0c45
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/fd36a717.failed

In the event that we have a parent inode reference in the request, we
can use that instead of mucking about in the dcache. Pass any parent
inode info we have down to build_dentry_path so it can make use of it.

Link: http://tracker.ceph.com/issues/18148
	Signed-off-by: Jeff Layton <jlayton@redhat.com>
	Reviewed-by: Yan, Zheng <zyan@redhat.com>
	Signed-off-by: Ilya Dryomov <idryomov@gmail.com>
(cherry picked from commit fd36a71762f3b0fcb9741ed24021afabec7e0c45)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	fs/ceph/mds_client.c
diff --cc fs/ceph/mds_client.c
index 33c790140222,c41c6aab3232..000000000000
--- a/fs/ceph/mds_client.c
+++ b/fs/ceph/mds_client.c
@@@ -1776,8 -1801,12 +1776,17 @@@ static int build_dentry_path(struct den
  {
  	char *path;
  
++<<<<<<< HEAD
 +	if (ceph_snap(dentry->d_parent->d_inode) == CEPH_NOSNAP) {
 +		*pino = ceph_ino(dentry->d_parent->d_inode);
++=======
+ 	rcu_read_lock();
+ 	if (!dir)
+ 		dir = d_inode_rcu(dentry->d_parent);
+ 	if (dir && ceph_snap(dir) == CEPH_NOSNAP) {
+ 		*pino = ceph_ino(dir);
+ 		rcu_read_unlock();
++>>>>>>> fd36a71762f3 (ceph: pass parent dir ino info to build_dentry_path)
  		*ppath = dentry->d_name.name;
  		*ppathlen = dentry->d_name.len;
  		return 0;
* Unmerged path fs/ceph/mds_client.c
