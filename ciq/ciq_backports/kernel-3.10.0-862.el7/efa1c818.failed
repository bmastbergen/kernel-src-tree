scsi: cxlflash: Refactor AFU capability checking

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
Rebuild_CHGLOG: - [scsi] cxlflash: Refactor AFU capability checking (Gustavo Duarte) [1456494]
Rebuild_FUZZ: 93.33%
commit-author Matthew R. Ochs <mrochs@linux.vnet.ibm.com>
commit efa1c818d3458fe97d8f83f40051518b44183234
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/efa1c818.failed

The existing AFU capability checking infrastructure is closely tied to
the command mode capability bits. In order to support new capabilities,
refactor the existing infrastructure to be more generic.

	Signed-off-by: Matthew R. Ochs <mrochs@linux.vnet.ibm.com>
	Signed-off-by: Uma Krishnan <ukrishn@linux.vnet.ibm.com>
	Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
(cherry picked from commit efa1c818d3458fe97d8f83f40051518b44183234)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/scsi/cxlflash/common.h
diff --cc drivers/scsi/cxlflash/common.h
index 811927d91c5c,c96526e1fb11..000000000000
--- a/drivers/scsi/cxlflash/common.h
+++ b/drivers/scsi/cxlflash/common.h
@@@ -179,10 -234,44 +179,42 @@@ struct afu 
  	char version[16];
  	u64 interface_version;
  
 -	u32 irqpoll_weight;
  	struct cxlflash_cfg *parent; /* Pointer back to parent cxlflash_cfg */
 +
  };
  
++<<<<<<< HEAD
++=======
+ static inline struct hwq *get_hwq(struct afu *afu, u32 index)
+ {
+ 	WARN_ON(index >= CXLFLASH_MAX_HWQS);
+ 
+ 	return &afu->hwqs[index];
+ }
+ 
+ static inline bool afu_is_irqpoll_enabled(struct afu *afu)
+ {
+ 	return !!afu->irqpoll_weight;
+ }
+ 
+ static inline bool afu_has_cap(struct afu *afu, u64 cap)
+ {
+ 	u64 afu_cap = afu->interface_version >> SISL_INTVER_CAP_SHIFT;
+ 
+ 	return afu_cap & cap;
+ }
+ 
+ static inline bool afu_is_sq_cmd_mode(struct afu *afu)
+ {
+ 	return afu_has_cap(afu, SISL_INTVER_CAP_SQ_CMD_MODE);
+ }
+ 
+ static inline bool afu_is_ioarrin_cmd_mode(struct afu *afu)
+ {
+ 	return afu_has_cap(afu, SISL_INTVER_CAP_IOARRIN_CMD_MODE);
+ }
+ 
++>>>>>>> efa1c818d345 (scsi: cxlflash: Refactor AFU capability checking)
  static inline u64 lun_to_lunid(u64 lun)
  {
  	__be64 lun_id;
* Unmerged path drivers/scsi/cxlflash/common.h
