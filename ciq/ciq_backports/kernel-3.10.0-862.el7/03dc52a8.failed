vxlan: avoid checking socket multiple times.

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
Rebuild_CHGLOG: - [net] vxlan: avoid checking socket multiple times (Jiri Benc) [1467280]
Rebuild_FUZZ: 98.85%
commit-author pravin shelar <pshelar@ovn.org>
commit 03dc52a86d58c70577d9f62527f68db9116f61a5
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/03dc52a8.failed

Check the vxlan socket in vxlan6_getroute().

	Signed-off-by: Pravin B Shelar <pshelar@ovn.org>
	Acked-by: Jiri Benc <jbenc@redhat.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 03dc52a86d58c70577d9f62527f68db9116f61a5)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/vxlan.c
diff --cc drivers/net/vxlan.c
index f909b180e18b,7730b33a3c3c..000000000000
--- a/drivers/net/vxlan.c
+++ b/drivers/net/vxlan.c
@@@ -2043,11 -2070,8 +2044,15 @@@ static void vxlan_xmit_one(struct sk_bu
  		struct dst_entry *ndst;
  		u32 rt6i_flags;
  
++<<<<<<< HEAD
 +		if (!vxlan->vn6_sock)
 +			goto drop;
 +		sk = vxlan->vn6_sock->sock->sk;
 +
 +		ndst = vxlan6_get_route(vxlan, skb,
++=======
+ 		ndst = vxlan6_get_route(vxlan, sock6, skb,
++>>>>>>> 03dc52a86d58 (vxlan: avoid checking socket multiple times.)
  					rdst ? rdst->remote_ifindex : 0, tos,
  					label, &dst->sin6.sin6_addr,
  					&src->sin6.sin6_addr,
@@@ -2432,14 -2431,12 +2438,19 @@@ static int vxlan_fill_metadata_dst(stru
  		ip_rt_put(rt);
  	} else {
  #if IS_ENABLED(CONFIG_IPV6)
+ 		struct vxlan_sock *sock6 = rcu_dereference(vxlan->vn6_sock);
  		struct dst_entry *ndst;
  
++<<<<<<< HEAD
 +		if (!vxlan->vn6_sock)
 +			return -EINVAL;
 +		ndst = vxlan6_get_route(vxlan, skb, 0, info->key.tos,
++=======
+ 		ndst = vxlan6_get_route(vxlan, sock6, skb, 0, info->key.tos,
++>>>>>>> 03dc52a86d58 (vxlan: avoid checking socket multiple times.)
  					info->key.label, &info->key.u.ipv6.dst,
 -					&info->key.u.ipv6.src, NULL, info);
 +					&info->key.u.ipv6.src,
 +					&info->dst_cache, info);
  		if (IS_ERR(ndst))
  			return PTR_ERR(ndst);
  		dst_release(ndst);
* Unmerged path drivers/net/vxlan.c
