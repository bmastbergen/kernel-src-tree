ovl: do not set overlay.opaque on non-dir create

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
commit-author Amir Goldstein <amir73il@gmail.com>
commit 4a99f3c83dc493c8ea84693d78cd792839c8aa64
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/4a99f3c8.failed

The optimization for opaque dir create was wrongly being applied
also to non-dir create.

Fixes: 97c684cc9110 ("ovl: create directories inside merged parent opaque")
	Signed-off-by: Amir Goldstein <amir73il@gmail.com>
	Signed-off-by: Miklos Szeredi <mszeredi@redhat.com>
	Cc: <stable@vger.kernel.org> # v4.10
(cherry picked from commit 4a99f3c83dc493c8ea84693d78cd792839c8aa64)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	fs/overlayfs/dir.c
diff --cc fs/overlayfs/dir.c
index c82fdefe6d3b,bfabc65fdc74..000000000000
--- a/fs/overlayfs/dir.c
+++ b/fs/overlayfs/dir.c
@@@ -193,6 -210,11 +193,14 @@@ static int ovl_create_upper(struct dent
  	if (err)
  		goto out_dput;
  
++<<<<<<< HEAD
++=======
+ 	if (ovl_type_merge(dentry->d_parent) && d_is_dir(newdentry)) {
+ 		/* Setting opaque here is just an optimization, allow to fail */
+ 		ovl_set_opaque(dentry, newdentry);
+ 	}
+ 
++>>>>>>> 4a99f3c83dc4 (ovl: do not set overlay.opaque on non-dir create)
  	ovl_instantiate(dentry, inode, newdentry, !!hardlink);
  	newdentry = NULL;
  out_dput:
* Unmerged path fs/overlayfs/dir.c
