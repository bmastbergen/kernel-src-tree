PCI: Make the "entries" argument to pci_enable_msix() optional

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
Rebuild_CHGLOG: - [pci] Make the "entries" argument to pci_enable_msix() optional (Ming Lei) [1389540]
Rebuild_FUZZ: 95.80%
commit-author Christoph Hellwig <hch@lst.de>
commit 3ac020e0ca8beff9b695f9866a06d50c09c602d6
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/3ac020e0.failed

The "entries" argument isn't needed if the list of entries does not contain
any holes.  Make it optional so that we can avoid the need to allocate a
msix_entry structure for this (common) case.

	Signed-off-by: Christoph Hellwig <hch@lst.de>
	Signed-off-by: Bjorn Helgaas <bhelgaas@google.com>
	Reviewed-by: Alexander Gordeev <agordeev@redhat.com>
(cherry picked from commit 3ac020e0ca8beff9b695f9866a06d50c09c602d6)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/pci/msi.c
diff --cc drivers/pci/msi.c
index 3127b0433131,98ace67c5f4d..000000000000
--- a/drivers/pci/msi.c
+++ b/drivers/pci/msi.c
@@@ -707,15 -715,12 +710,22 @@@ static void msix_program_entries(struc
  	struct msi_desc *entry;
  	int i = 0;
  
++<<<<<<< HEAD
 +	list_for_each_entry(entry, &dev->msi_list, list) {
 +		int offset = entries[i].entry * PCI_MSIX_ENTRY_SIZE +
 +						PCI_MSIX_ENTRY_VECTOR_CTRL;
 +
 +		entries[i].vector = entry->irq;
 +		irq_set_msi_desc(entry->irq, entry);
 +		entry->masked = readl(entry->mask_base + offset);
++=======
+ 	for_each_pci_msi_entry(entry, dev) {
+ 		if (entries)
+ 			entries[i++].vector = entry->irq;
+ 		entry->masked = readl(pci_msix_desc_addr(entry) +
+ 				PCI_MSIX_ENTRY_VECTOR_CTRL);
++>>>>>>> 3ac020e0ca8b (PCI: Make the "entries" argument to pci_enable_msix() optional)
  		msix_mask_irq(entry, 1);
- 		i++;
  	}
  }
  
* Unmerged path drivers/pci/msi.c
