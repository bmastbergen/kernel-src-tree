sched/headers: Prepare for new header dependencies before moving code to <linux/sched/clock.h>

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
commit-author Ingo Molnar <mingo@kernel.org>
commit e601757102cfd3eeae068f53b3bc1234f3a2b2e9
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/e6017571.failed

We are going to split <linux/sched/clock.h> out of <linux/sched.h>, which
will have to be picked up from other headers and .c files.

Create a trivial placeholder <linux/sched/clock.h> file that just
maps to <linux/sched.h> to make this patch obviously correct and
bisectable.

Include the new header in the files that are going to need it.

	Acked-by: Linus Torvalds <torvalds@linux-foundation.org>
	Cc: Mike Galbraith <efault@gmx.de>
	Cc: Peter Zijlstra <peterz@infradead.org>
	Cc: Thomas Gleixner <tglx@linutronix.de>
	Cc: linux-kernel@vger.kernel.org
	Signed-off-by: Ingo Molnar <mingo@kernel.org>
(cherry picked from commit e601757102cfd3eeae068f53b3bc1234f3a2b2e9)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/arm/mach-bcm/platsmp.c
#	arch/microblaze/kernel/timer.c
#	arch/parisc/kernel/setup.c
#	arch/parisc/kernel/time.c
#	arch/x86/events/amd/ibs.c
#	arch/x86/kernel/cpu/centaur.c
#	arch/x86/kernel/cpu/cyrix.c
#	arch/x86/kernel/cpu/transmeta.c
#	drivers/acpi/apei/ghes.c
#	drivers/clocksource/arm_arch_timer.c
#	drivers/clocksource/pxa_timer.c
#	drivers/clocksource/timer-digicolor.c
#	drivers/firmware/tegra/bpmp.c
#	drivers/md/bcache/bset.c
#	drivers/md/bcache/writeback.c
#	drivers/perf/arm_pmu.c
#	kernel/printk.c
#	kernel/sched/core.c
#	kernel/sched/sched.h
#	kernel/time/sched_clock.c
#	kernel/torture.c
#	net/ipv4/tcp_cdg.c
diff --cc arch/microblaze/kernel/timer.c
index aec5020a6e31,999066192715..000000000000
--- a/arch/microblaze/kernel/timer.c
+++ b/arch/microblaze/kernel/timer.c
@@@ -8,34 -9,19 +8,39 @@@
   * for more details.
   */
  
 +#include <linux/init.h>
 +#include <linux/kernel.h>
 +#include <linux/param.h>
  #include <linux/interrupt.h>
 +#include <linux/profile.h>
 +#include <linux/irq.h>
  #include <linux/delay.h>
  #include <linux/sched.h>
++<<<<<<< HEAD
 +#include <linux/spinlock.h>
 +#include <linux/err.h>
++=======
+ #include <linux/sched/clock.h>
+ #include <linux/sched_clock.h>
++>>>>>>> e601757102cf (sched/headers: Prepare for new header dependencies before moving code to <linux/sched/clock.h>)
  #include <linux/clk.h>
 +#include <linux/clocksource.h>
  #include <linux/clockchips.h>
 -#include <linux/of_address.h>
 -#include <linux/of_irq.h>
 -#include <linux/timecounter.h>
 +#include <linux/io.h>
 +#include <linux/bug.h>
  #include <asm/cpuinfo.h>
 -
 -static void __iomem *timer_baseaddr;
 +#include <asm/setup.h>
 +#include <asm/prom.h>
 +#include <asm/irq.h>
 +#include <linux/cnt32_to_63.h>
 +
 +#ifdef CONFIG_SELFMOD_TIMER
 +#include <asm/selfmod.h>
 +#define TIMER_BASE	BARRIER_BASE_ADDR
 +#else
 +static unsigned int timer_baseaddr;
 +#define TIMER_BASE	timer_baseaddr
 +#endif
  
  static unsigned int freq_div_hz;
  static unsigned int timer_clock_freq;
diff --cc arch/parisc/kernel/setup.c
index 1e95b2000ce8,dee6f9d6a153..000000000000
--- a/arch/parisc/kernel/setup.c
+++ b/arch/parisc/kernel/setup.c
@@@ -36,8 -36,11 +36,13 @@@
  #undef PCI_DEBUG
  #include <linux/proc_fs.h>
  #include <linux/export.h>
++<<<<<<< HEAD
++=======
+ #include <linux/sched.h>
+ #include <linux/sched/clock.h>
++>>>>>>> e601757102cf (sched/headers: Prepare for new header dependencies before moving code to <linux/sched/clock.h>)
  
  #include <asm/processor.h>
 -#include <asm/sections.h>
  #include <asm/pdc.h>
  #include <asm/led.h>
  #include <asm/machdep.h>	/* for pa7300lc_init() proto */
diff --cc arch/parisc/kernel/time.c
index 70e105d62423,89421df70160..000000000000
--- a/arch/parisc/kernel/time.c
+++ b/arch/parisc/kernel/time.c
@@@ -12,7 -12,10 +12,12 @@@
   */
  #include <linux/errno.h>
  #include <linux/module.h>
 -#include <linux/rtc.h>
  #include <linux/sched.h>
++<<<<<<< HEAD
++=======
+ #include <linux/sched/clock.h>
+ #include <linux/sched_clock.h>
++>>>>>>> e601757102cf (sched/headers: Prepare for new header dependencies before moving code to <linux/sched/clock.h>)
  #include <linux/kernel.h>
  #include <linux/param.h>
  #include <linux/string.h>
diff --cc arch/x86/events/amd/ibs.c
index 8e59344c8506,786fd875de92..000000000000
--- a/arch/x86/events/amd/ibs.c
+++ b/arch/x86/events/amd/ibs.c
@@@ -7,9 -7,12 +7,14 @@@
   */
  
  #include <linux/perf_event.h>
 -#include <linux/init.h>
 -#include <linux/export.h>
 +#include <linux/module.h>
  #include <linux/pci.h>
  #include <linux/ptrace.h>
++<<<<<<< HEAD
++=======
+ #include <linux/syscore_ops.h>
+ #include <linux/sched/clock.h>
++>>>>>>> e601757102cf (sched/headers: Prepare for new header dependencies before moving code to <linux/sched/clock.h>)
  
  #include <asm/apic.h>
  
diff --cc arch/x86/kernel/cpu/centaur.c
index f9ff97902eac,adc0ebd8bed0..000000000000
--- a/arch/x86/kernel/cpu/centaur.c
+++ b/arch/x86/kernel/cpu/centaur.c
@@@ -1,7 -1,8 +1,14 @@@
 +#include <linux/bitops.h>
 +#include <linux/kernel.h>
  
++<<<<<<< HEAD
 +#include <asm/processor.h>
++=======
+ #include <linux/sched.h>
+ #include <linux/sched/clock.h>
+ 
+ #include <asm/cpufeature.h>
++>>>>>>> e601757102cf (sched/headers: Prepare for new header dependencies before moving code to <linux/sched/clock.h>)
  #include <asm/e820.h>
  #include <asm/mtrr.h>
  #include <asm/msr.h>
diff --cc arch/x86/kernel/cpu/cyrix.c
index 1de9bd97c7b5,0a3bc19de017..000000000000
--- a/arch/x86/kernel/cpu/cyrix.c
+++ b/arch/x86/kernel/cpu/cyrix.c
@@@ -8,6 -8,9 +8,12 @@@
  #include <linux/timer.h>
  #include <asm/pci-direct.h>
  #include <asm/tsc.h>
++<<<<<<< HEAD
++=======
+ #include <asm/cpufeature.h>
+ #include <linux/sched.h>
+ #include <linux/sched/clock.h>
++>>>>>>> e601757102cf (sched/headers: Prepare for new header dependencies before moving code to <linux/sched/clock.h>)
  
  #include "cpu.h"
  
diff --cc arch/x86/kernel/cpu/transmeta.c
index 3fa0e5ad86b4,8457b4978668..000000000000
--- a/arch/x86/kernel/cpu/transmeta.c
+++ b/arch/x86/kernel/cpu/transmeta.c
@@@ -1,6 -1,8 +1,11 @@@
  #include <linux/kernel.h>
++<<<<<<< HEAD
++=======
+ #include <linux/sched.h>
+ #include <linux/sched/clock.h>
++>>>>>>> e601757102cf (sched/headers: Prepare for new header dependencies before moving code to <linux/sched/clock.h>)
  #include <linux/mm.h>
 -#include <asm/cpufeature.h>
 +#include <asm/processor.h>
  #include <asm/msr.h>
  #include "cpu.h"
  
diff --cc drivers/acpi/apei/ghes.c
index 200e10f6ea9e,b192b42a8351..000000000000
--- a/drivers/acpi/apei/ghes.c
+++ b/drivers/acpi/apei/ghes.c
@@@ -48,11 -43,12 +48,16 @@@
  #include <linux/genalloc.h>
  #include <linux/pci.h>
  #include <linux/aer.h>
++<<<<<<< HEAD
++=======
+ #include <linux/nmi.h>
+ #include <linux/sched/clock.h>
++>>>>>>> e601757102cf (sched/headers: Prepare for new header dependencies before moving code to <linux/sched/clock.h>)
  
  #include <acpi/ghes.h>
 -#include <acpi/apei.h>
 +#include <asm/mce.h>
  #include <asm/tlbflush.h>
 +#include <asm/nmi.h>
  
  #include "apei-internal.h"
  
diff --cc drivers/clocksource/arm_arch_timer.c
index 960fd03a2cb0,7a8a4117f123..000000000000
--- a/drivers/clocksource/arm_arch_timer.c
+++ b/drivers/clocksource/arm_arch_timer.c
@@@ -13,10 -16,17 +13,17 @@@
  #include <linux/device.h>
  #include <linux/smp.h>
  #include <linux/cpu.h>
 -#include <linux/cpu_pm.h>
  #include <linux/clockchips.h>
 -#include <linux/clocksource.h>
  #include <linux/interrupt.h>
  #include <linux/of_irq.h>
 -#include <linux/of_address.h>
  #include <linux/io.h>
++<<<<<<< HEAD
++=======
+ #include <linux/slab.h>
+ #include <linux/sched/clock.h>
+ #include <linux/sched_clock.h>
+ #include <linux/acpi.h>
++>>>>>>> e601757102cf (sched/headers: Prepare for new header dependencies before moving code to <linux/sched/clock.h>)
  
  #include <asm/arch_timer.h>
  #include <asm/virt.h>
diff --cc drivers/md/bcache/bset.c
index 14032e8c7731,18526d44688d..000000000000
--- a/drivers/md/bcache/bset.c
+++ b/drivers/md/bcache/bset.c
@@@ -5,10 -5,13 +5,18 @@@
   * Copyright 2012 Google, Inc.
   */
  
 -#define pr_fmt(fmt) "bcache: %s() " fmt "\n", __func__
 +#include "bcache.h"
 +#include "btree.h"
 +#include "debug.h"
  
++<<<<<<< HEAD
++=======
+ #include "util.h"
+ #include "bset.h"
+ 
+ #include <linux/console.h>
+ #include <linux/sched/clock.h>
++>>>>>>> e601757102cf (sched/headers: Prepare for new header dependencies before moving code to <linux/sched/clock.h>)
  #include <linux/random.h>
  #include <linux/prefetch.h>
  
diff --cc drivers/md/bcache/writeback.c
index 841f0490d4ef,6ac2e48b9235..000000000000
--- a/drivers/md/bcache/writeback.c
+++ b/drivers/md/bcache/writeback.c
@@@ -9,16 -9,12 +9,23 @@@
  #include "bcache.h"
  #include "btree.h"
  #include "debug.h"
 -#include "writeback.h"
  
++<<<<<<< HEAD
 +static struct workqueue_struct *dirty_wq;
 +
 +static void read_dirty(struct closure *);
 +
 +struct dirty_io {
 +	struct closure		cl;
 +	struct cached_dev	*dc;
 +	struct bio		bio;
 +};
++=======
+ #include <linux/delay.h>
+ #include <linux/kthread.h>
+ #include <linux/sched/clock.h>
+ #include <trace/events/bcache.h>
++>>>>>>> e601757102cf (sched/headers: Prepare for new header dependencies before moving code to <linux/sched/clock.h>)
  
  /* Rate limiting */
  
diff --cc kernel/printk.c
index 4dac9fcf52c9,47050eedc206..000000000000
--- a/kernel/printk.c
+++ b/kernel/printk.c
@@@ -45,8 -43,12 +45,14 @@@
  #include <linux/poll.h>
  #include <linux/irq_work.h>
  #include <linux/utsname.h>
++<<<<<<< HEAD:kernel/printk.c
++=======
+ #include <linux/ctype.h>
+ #include <linux/uio.h>
+ #include <linux/sched/clock.h>
++>>>>>>> e601757102cf (sched/headers: Prepare for new header dependencies before moving code to <linux/sched/clock.h>):kernel/printk/printk.c
  
 -#include <linux/uaccess.h>
 -#include <asm/sections.h>
 +#include <asm/uaccess.h>
  
  #define CREATE_TRACE_POINTS
  #include <trace/events/printk.h>
diff --cc kernel/sched/core.c
index 108629661cfb,1a7fd3d21e5a..000000000000
--- a/kernel/sched/core.c
+++ b/kernel/sched/core.c
@@@ -1,80 -1,27 +1,90 @@@
  /*
   *  kernel/sched/core.c
   *
 - *  Core kernel scheduler code and related syscalls
 + *  Kernel scheduler and related syscalls
   *
   *  Copyright (C) 1991-2002  Linus Torvalds
 + *
 + *  1996-12-23  Modified by Dave Grothe to fix bugs in semaphores and
 + *		make semaphores SMP safe
 + *  1998-11-19	Implemented schedule_timeout() and related stuff
 + *		by Andrea Arcangeli
 + *  2002-01-04	New ultra-scalable O(1) scheduler by Ingo Molnar:
 + *		hybrid priority-list and round-robin design with
 + *		an array-switch method of distributing timeslices
 + *		and per-CPU runqueues.  Cleanups and useful suggestions
 + *		by Davide Libenzi, preemptible kernel bits by Robert Love.
 + *  2003-09-03	Interactivity tuning by Con Kolivas.
 + *  2004-04-02	Scheduler domains code by Nick Piggin
 + *  2007-04-15  Work begun on replacing all interactivity tuning with a
 + *              fair scheduling design by Con Kolivas.
 + *  2007-05-05  Load balancing (smp-nice) and other improvements
 + *              by Peter Williams
 + *  2007-05-06  Interactivity improvements to CFS by Mike Galbraith
 + *  2007-07-01  Group scheduling enhancements by Srivatsa Vaddagiri
 + *  2007-11-29  RT balancing improvements by Steven Rostedt, Gregory Haskins,
 + *              Thomas Gleixner, Mike Kravetz
   */
++<<<<<<< HEAD
++=======
+ #include <linux/sched.h>
+ #include <linux/sched/clock.h>
+ #include <linux/cpuset.h>
+ #include <linux/delayacct.h>
+ #include <linux/init_task.h>
+ #include <linux/context_tracking.h>
+ #include <linux/rcupdate_wait.h>
++>>>>>>> e601757102cf (sched/headers: Prepare for new header dependencies before moving code to <linux/sched/clock.h>)
  
 -#include <linux/blkdev.h>
 -#include <linux/kprobes.h>
 -#include <linux/mmu_context.h>
 +#include <linux/mm.h>
  #include <linux/module.h>
  #include <linux/nmi.h>
 -#include <linux/prefetch.h>
 -#include <linux/profile.h>
 +#include <linux/init.h>
 +#include <linux/uaccess.h>
 +#include <linux/highmem.h>
 +#include <asm/mmu_context.h>
 +#include <linux/interrupt.h>
 +#include <linux/capability.h>
 +#include <linux/completion.h>
 +#include <linux/kernel_stat.h>
 +#include <linux/debug_locks.h>
 +#include <linux/perf_event.h>
  #include <linux/security.h>
 +#include <linux/notifier.h>
 +#include <linux/profile.h>
 +#include <linux/freezer.h>
 +#include <linux/vmalloc.h>
 +#include <linux/blkdev.h>
 +#include <linux/delay.h>
 +#include <linux/pid_namespace.h>
 +#include <linux/smp.h>
 +#include <linux/threads.h>
 +#include <linux/timer.h>
 +#include <linux/rcupdate.h>
 +#include <linux/cpu.h>
 +#include <linux/cpuset.h>
 +#include <linux/percpu.h>
 +#include <linux/proc_fs.h>
 +#include <linux/seq_file.h>
 +#include <linux/sysctl.h>
  #include <linux/syscalls.h>
 +#include <linux/times.h>
 +#include <linux/tsacct_kern.h>
 +#include <linux/kprobes.h>
 +#include <linux/delayacct.h>
 +#include <linux/unistd.h>
 +#include <linux/pagemap.h>
 +#include <linux/hrtimer.h>
 +#include <linux/tick.h>
 +#include <linux/debugfs.h>
 +#include <linux/ctype.h>
 +#include <linux/ftrace.h>
 +#include <linux/slab.h>
 +#include <linux/init_task.h>
 +#include <linux/binfmts.h>
 +#include <linux/context_tracking.h>
 +#include <linux/compiler.h>
 +#include <linux/frame.h>
  
  #include <asm/switch_to.h>
  #include <asm/tlb.h>
diff --cc kernel/sched/sched.h
index 3e0ea93b25ef,4d386461f13a..000000000000
--- a/kernel/sched/sched.h
+++ b/kernel/sched/sched.h
@@@ -1,8 -1,14 +1,14 @@@
  
  #include <linux/sched.h>
  #include <linux/sched/sysctl.h>
 -#include <linux/sched/topology.h>
  #include <linux/sched/rt.h>
++<<<<<<< HEAD
++=======
+ #include <linux/sched/clock.h>
+ #include <linux/sched/wake_q.h>
+ #include <linux/u64_stats_sync.h>
++>>>>>>> e601757102cf (sched/headers: Prepare for new header dependencies before moving code to <linux/sched/clock.h>)
  #include <linux/sched/deadline.h>
 -#include <linux/kernel_stat.h>
 -#include <linux/binfmts.h>
  #include <linux/mutex.h>
  #include <linux/spinlock.h>
  #include <linux/stop_machine.h>
* Unmerged path arch/arm/mach-bcm/platsmp.c
* Unmerged path drivers/clocksource/pxa_timer.c
* Unmerged path drivers/clocksource/timer-digicolor.c
* Unmerged path drivers/firmware/tegra/bpmp.c
* Unmerged path drivers/perf/arm_pmu.c
* Unmerged path kernel/time/sched_clock.c
* Unmerged path kernel/torture.c
* Unmerged path net/ipv4/tcp_cdg.c
diff --git a/arch/arm/kernel/kprobes-test.c b/arch/arm/kernel/kprobes-test.c
index 0cd63d080c7b..70f996f7fd19 100644
--- a/arch/arm/kernel/kprobes-test.c
+++ b/arch/arm/kernel/kprobes-test.c
@@ -200,6 +200,7 @@
 #include <linux/kernel.h>
 #include <linux/module.h>
 #include <linux/slab.h>
+#include <linux/sched/clock.h>
 #include <linux/kprobes.h>
 
 #include <asm/opcodes.h>
* Unmerged path arch/arm/mach-bcm/platsmp.c
diff --git a/arch/arm/mach-omap2/pm-debug.c b/arch/arm/mach-omap2/pm-debug.c
index 0b339861d751..a2046ba84bdc 100644
--- a/arch/arm/mach-omap2/pm-debug.c
+++ b/arch/arm/mach-omap2/pm-debug.c
@@ -21,6 +21,7 @@
 
 #include <linux/kernel.h>
 #include <linux/sched.h>
+#include <linux/sched/clock.h>
 #include <linux/clk.h>
 #include <linux/err.h>
 #include <linux/io.h>
diff --git a/arch/cris/kernel/time.c b/arch/cris/kernel/time.c
index fe6acdabbc8d..02d7778653c1 100644
--- a/arch/cris/kernel/time.c
+++ b/arch/cris/kernel/time.c
@@ -29,7 +29,7 @@
 #include <linux/timex.h>
 #include <linux/init.h>
 #include <linux/profile.h>
-#include <linux/sched.h>	/* just for sched_clock() - funny that */
+#include <linux/sched/clock.h>
 
 
 #define D(x)
diff --git a/arch/ia64/kernel/setup.c b/arch/ia64/kernel/setup.c
index 4978fcbf20b9..a8733ce6b63e 100644
--- a/arch/ia64/kernel/setup.c
+++ b/arch/ia64/kernel/setup.c
@@ -32,6 +32,7 @@
 #include <linux/kernel.h>
 #include <linux/reboot.h>
 #include <linux/sched.h>
+#include <linux/sched/clock.h>
 #include <linux/seq_file.h>
 #include <linux/string.h>
 #include <linux/threads.h>
* Unmerged path arch/microblaze/kernel/timer.c
diff --git a/arch/mn10300/kernel/time.c b/arch/mn10300/kernel/time.c
index 67c6416a58f8..06b83b17c5f1 100644
--- a/arch/mn10300/kernel/time.c
+++ b/arch/mn10300/kernel/time.c
@@ -10,6 +10,7 @@
  * 2 of the Licence, or (at your option) any later version.
  */
 #include <linux/sched.h>
+#include <linux/sched/clock.h>
 #include <linux/kernel.h>
 #include <linux/interrupt.h>
 #include <linux/time.h>
* Unmerged path arch/parisc/kernel/setup.c
* Unmerged path arch/parisc/kernel/time.c
diff --git a/arch/powerpc/kernel/time.c b/arch/powerpc/kernel/time.c
index 859343e21b75..a895a0001251 100644
--- a/arch/powerpc/kernel/time.c
+++ b/arch/powerpc/kernel/time.c
@@ -34,6 +34,7 @@
 #include <linux/errno.h>
 #include <linux/export.h>
 #include <linux/sched.h>
+#include <linux/sched/clock.h>
 #include <linux/kernel.h>
 #include <linux/param.h>
 #include <linux/string.h>
diff --git a/arch/s390/kernel/time.c b/arch/s390/kernel/time.c
index 232a1e9ed542..df968ef05fec 100644
--- a/arch/s390/kernel/time.c
+++ b/arch/s390/kernel/time.c
@@ -18,6 +18,7 @@
 #include <linux/errno.h>
 #include <linux/module.h>
 #include <linux/sched.h>
+#include <linux/sched/clock.h>
 #include <linux/kernel.h>
 #include <linux/param.h>
 #include <linux/string.h>
diff --git a/arch/sparc/kernel/ds.c b/arch/sparc/kernel/ds.c
index 252f8768aac6..a6dbff35388f 100644
--- a/arch/sparc/kernel/ds.c
+++ b/arch/sparc/kernel/ds.c
@@ -9,6 +9,7 @@
 #include <linux/string.h>
 #include <linux/slab.h>
 #include <linux/sched.h>
+#include <linux/sched/clock.h>
 #include <linux/delay.h>
 #include <linux/mutex.h>
 #include <linux/kthread.h>
diff --git a/arch/sparc/kernel/viohs.c b/arch/sparc/kernel/viohs.c
index f8e7dd53e1c7..2997bc355b06 100644
--- a/arch/sparc/kernel/viohs.c
+++ b/arch/sparc/kernel/viohs.c
@@ -8,6 +8,7 @@
 #include <linux/string.h>
 #include <linux/delay.h>
 #include <linux/sched.h>
+#include <linux/sched/clock.h>
 #include <linux/slab.h>
 
 #include <asm/ldc.h>
diff --git a/arch/tile/kernel/time.c b/arch/tile/kernel/time.c
index 5ac397ec6986..434bc105418a 100644
--- a/arch/tile/kernel/time.c
+++ b/arch/tile/kernel/time.c
@@ -20,6 +20,7 @@
 #include <linux/clockchips.h>
 #include <linux/hardirq.h>
 #include <linux/sched.h>
+#include <linux/sched/clock.h>
 #include <linux/smp.h>
 #include <linux/delay.h>
 #include <linux/module.h>
* Unmerged path arch/x86/events/amd/ibs.c
diff --git a/arch/x86/events/core.c b/arch/x86/events/core.c
index a084757b46db..d6b319e2899c 100644
--- a/arch/x86/events/core.c
+++ b/arch/x86/events/core.c
@@ -20,6 +20,7 @@
 #include <linux/module.h>
 #include <linux/kdebug.h>
 #include <linux/sched.h>
+#include <linux/sched/clock.h>
 #include <linux/uaccess.h>
 #include <linux/slab.h>
 #include <linux/cpu.h>
diff --git a/arch/x86/kernel/cpu/amd.c b/arch/x86/kernel/cpu/amd.c
index 485733876ab9..248e242a8b87 100644
--- a/arch/x86/kernel/cpu/amd.c
+++ b/arch/x86/kernel/cpu/amd.c
@@ -5,6 +5,7 @@
 
 #include <linux/io.h>
 #include <linux/sched.h>
+#include <linux/sched/clock.h>
 #include <linux/random.h>
 #include <asm/processor.h>
 #include <asm/apic.h>
* Unmerged path arch/x86/kernel/cpu/centaur.c
diff --git a/arch/x86/kernel/cpu/common.c b/arch/x86/kernel/cpu/common.c
index 59edb62b6a2b..418ac2b5db70 100644
--- a/arch/x86/kernel/cpu/common.c
+++ b/arch/x86/kernel/cpu/common.c
@@ -8,6 +8,7 @@
 #include <linux/ctype.h>
 #include <linux/delay.h>
 #include <linux/sched.h>
+#include <linux/sched/clock.h>
 #include <linux/init.h>
 #include <linux/kgdb.h>
 #include <linux/smp.h>
* Unmerged path arch/x86/kernel/cpu/cyrix.c
diff --git a/arch/x86/kernel/cpu/intel.c b/arch/x86/kernel/cpu/intel.c
index 74476001995a..3d42180f3bf2 100644
--- a/arch/x86/kernel/cpu/intel.c
+++ b/arch/x86/kernel/cpu/intel.c
@@ -4,6 +4,7 @@
 #include <linux/bitops.h>
 #include <linux/smp.h>
 #include <linux/sched.h>
+#include <linux/sched/clock.h>
 #include <linux/thread_info.h>
 #include <linux/module.h>
 #include <linux/uaccess.h>
* Unmerged path arch/x86/kernel/cpu/transmeta.c
diff --git a/arch/x86/kernel/kvmclock.c b/arch/x86/kernel/kvmclock.c
index d4dcab1c784a..fe456fb09302 100644
--- a/arch/x86/kernel/kvmclock.c
+++ b/arch/x86/kernel/kvmclock.c
@@ -25,6 +25,7 @@
 #include <linux/hardirq.h>
 #include <linux/memblock.h>
 #include <linux/sched.h>
+#include <linux/sched/clock.h>
 
 #include <asm/x86_init.h>
 #include <asm/reboot.h>
diff --git a/arch/x86/kernel/nmi.c b/arch/x86/kernel/nmi.c
index 1a36028022e7..489f80b71b07 100644
--- a/arch/x86/kernel/nmi.c
+++ b/arch/x86/kernel/nmi.c
@@ -19,6 +19,7 @@
 #include <linux/hardirq.h>
 #include <linux/slab.h>
 #include <linux/export.h>
+#include <linux/sched/clock.h>
 
 #if defined(CONFIG_EDAC)
 #include <linux/edac.h>
diff --git a/arch/x86/kernel/tsc.c b/arch/x86/kernel/tsc.c
index 65f4ed2c438a..ba25a992df01 100644
--- a/arch/x86/kernel/tsc.c
+++ b/arch/x86/kernel/tsc.c
@@ -2,6 +2,7 @@
 
 #include <linux/kernel.h>
 #include <linux/sched.h>
+#include <linux/sched/clock.h>
 #include <linux/init.h>
 #include <linux/module.h>
 #include <linux/timer.h>
diff --git a/block/cfq-iosched.c b/block/cfq-iosched.c
index 4bf045b4882d..7124c63b96eb 100644
--- a/block/cfq-iosched.c
+++ b/block/cfq-iosched.c
@@ -8,6 +8,7 @@
  */
 #include <linux/module.h>
 #include <linux/slab.h>
+#include <linux/sched/clock.h>
 #include <linux/blkdev.h>
 #include <linux/elevator.h>
 #include <linux/jiffies.h>
* Unmerged path drivers/acpi/apei/ghes.c
* Unmerged path drivers/clocksource/arm_arch_timer.c
* Unmerged path drivers/clocksource/pxa_timer.c
* Unmerged path drivers/clocksource/timer-digicolor.c
diff --git a/drivers/cpuidle/cpuidle.c b/drivers/cpuidle/cpuidle.c
index 88f7d0c7d161..77e519068bdb 100644
--- a/drivers/cpuidle/cpuidle.c
+++ b/drivers/cpuidle/cpuidle.c
@@ -12,6 +12,7 @@
 #include <linux/kernel.h>
 #include <linux/mutex.h>
 #include <linux/sched.h>
+#include <linux/sched/clock.h>
 #include <linux/notifier.h>
 #include <linux/pm_qos.h>
 #include <linux/cpu.h>
* Unmerged path drivers/firmware/tegra/bpmp.c
diff --git a/drivers/gpu/drm/i915/i915_gem_request.c b/drivers/gpu/drm/i915/i915_gem_request.c
index d7958dc26d21..26c7f4bc3967 100644
--- a/drivers/gpu/drm/i915/i915_gem_request.c
+++ b/drivers/gpu/drm/i915/i915_gem_request.c
@@ -24,6 +24,8 @@
 
 #include <linux/prefetch.h>
 #include <linux/dma-fence-array.h>
+#include <linux/sched.h>
+#include <linux/sched/clock.h>
 
 #include "i915_drv.h"
 
diff --git a/drivers/gpu/drm/i915/intel_drv.h b/drivers/gpu/drm/i915/intel_drv.h
index a0af54bba85b..b1e806bd4bd0 100644
--- a/drivers/gpu/drm/i915/intel_drv.h
+++ b/drivers/gpu/drm/i915/intel_drv.h
@@ -28,6 +28,7 @@
 #include <linux/async.h>
 #include <linux/i2c.h>
 #include <linux/hdmi.h>
+#include <linux/sched/clock.h>
 #include <drm/i915_drm.h>
 #include "i915_drv.h"
 #include <drm/drm_crtc.h>
* Unmerged path drivers/md/bcache/bset.c
diff --git a/drivers/md/bcache/btree.c b/drivers/md/bcache/btree.c
index 7d3deab11fce..1b95451f2b44 100644
--- a/drivers/md/bcache/btree.c
+++ b/drivers/md/bcache/btree.c
@@ -31,6 +31,7 @@
 #include <linux/prefetch.h>
 #include <linux/random.h>
 #include <linux/rcupdate.h>
+#include <linux/sched/clock.h>
 #include <trace/events/bcache.h>
 
 /*
diff --git a/drivers/md/bcache/sysfs.c b/drivers/md/bcache/sysfs.c
index e9bd6c0cca5b..58e9d92b8196 100644
--- a/drivers/md/bcache/sysfs.c
+++ b/drivers/md/bcache/sysfs.c
@@ -11,6 +11,7 @@
 #include "request.h"
 
 #include <linux/sort.h>
+#include <linux/sched/clock.h>
 
 static const char * const cache_replacement_policies[] = {
 	"lru",
diff --git a/drivers/md/bcache/util.c b/drivers/md/bcache/util.c
index 38a43f8d36ec..ad11c49c9f03 100644
--- a/drivers/md/bcache/util.c
+++ b/drivers/md/bcache/util.c
@@ -12,6 +12,7 @@
 #include <linux/module.h>
 #include <linux/seq_file.h>
 #include <linux/types.h>
+#include <linux/sched/clock.h>
 
 #include "util.h"
 
diff --git a/drivers/md/bcache/util.h b/drivers/md/bcache/util.h
index 43fd78affcea..0dc343c09b15 100644
--- a/drivers/md/bcache/util.h
+++ b/drivers/md/bcache/util.h
@@ -4,6 +4,7 @@
 
 #include <linux/errno.h>
 #include <linux/kernel.h>
+#include <linux/sched/clock.h>
 #include <linux/llist.h>
 #include <linux/ratelimit.h>
 #include <linux/vmalloc.h>
* Unmerged path drivers/md/bcache/writeback.c
diff --git a/drivers/misc/cxl/native.c b/drivers/misc/cxl/native.c
index 09e30e218045..dc9faf04b2d6 100644
--- a/drivers/misc/cxl/native.c
+++ b/drivers/misc/cxl/native.c
@@ -9,6 +9,7 @@
 
 #include <linux/spinlock.h>
 #include <linux/sched.h>
+#include <linux/sched/clock.h>
 #include <linux/slab.h>
 #include <linux/sched.h>
 #include <linux/mutex.h>
diff --git a/drivers/net/irda/pxaficp_ir.c b/drivers/net/irda/pxaficp_ir.c
index 964b116a0ab7..2573bd31a514 100644
--- a/drivers/net/irda/pxaficp_ir.c
+++ b/drivers/net/irda/pxaficp_ir.c
@@ -21,6 +21,7 @@
 #include <linux/clk.h>
 #include <linux/gpio.h>
 #include <linux/slab.h>
+#include <linux/sched/clock.h>
 
 #include <net/irda/irda.h>
 #include <net/irda/irmod.h>
* Unmerged path drivers/perf/arm_pmu.c
diff --git a/drivers/vhost/net.c b/drivers/vhost/net.c
index cd57a27c00c7..e58cc5154378 100644
--- a/drivers/vhost/net.c
+++ b/drivers/vhost/net.c
@@ -17,6 +17,7 @@
 #include <linux/workqueue.h>
 #include <linux/file.h>
 #include <linux/slab.h>
+#include <linux/sched/clock.h>
 #include <linux/vmalloc.h>
 
 #include <linux/net.h>
diff --git a/include/linux/blkdev.h b/include/linux/blkdev.h
index ba3405333171..4a456de7f743 100644
--- a/include/linux/blkdev.h
+++ b/include/linux/blkdev.h
@@ -2,6 +2,7 @@
 #define _LINUX_BLKDEV_H
 
 #include <linux/sched.h>
+#include <linux/sched/clock.h>
 
 #ifdef CONFIG_BLOCK
 
diff --git a/include/linux/sched/clock.h b/include/linux/sched/clock.h
new file mode 100644
index 000000000000..7cb7d79b2cf9
--- /dev/null
+++ b/include/linux/sched/clock.h
@@ -0,0 +1,6 @@
+#ifndef _LINUX_SCHED_CLOCK_H
+#define _LINUX_SCHED_CLOCK_H
+
+#include <linux/sched.h>
+
+#endif /* _LINUX_SCHED_CLOCK_H */
diff --git a/include/linux/skbuff.h b/include/linux/skbuff.h
index 28aefdf34562..6fb87b15a7ad 100644
--- a/include/linux/skbuff.h
+++ b/include/linux/skbuff.h
@@ -34,6 +34,7 @@
 #include <linux/dma-mapping.h>
 #include <linux/netdev_features.h>
 #include <linux/sched.h>
+#include <linux/sched/clock.h>
 #include <net/flow_dissector.h>
 #include <linux/in6.h>
 #include <net/flow.h>
diff --git a/include/net/busy_poll.h b/include/net/busy_poll.h
index 0e737177db2a..74ca766f5864 100644
--- a/include/net/busy_poll.h
+++ b/include/net/busy_poll.h
@@ -25,6 +25,7 @@
 #define _LINUX_NET_BUSY_POLL_H
 
 #include <linux/netdevice.h>
+#include <linux/sched/clock.h>
 #include <net/ip.h>
 
 #ifdef CONFIG_NET_RX_BUSY_POLL
diff --git a/kernel/events/core.c b/kernel/events/core.c
index c7982922c47d..e8a43e1b02ad 100644
--- a/kernel/events/core.c
+++ b/kernel/events/core.c
@@ -44,6 +44,7 @@
 #include <linux/compat.h>
 #include <linux/namei.h>
 #include <linux/parser.h>
+#include <linux/sched/clock.h>
 
 #include "internal.h"
 
diff --git a/kernel/lockdep.c b/kernel/lockdep.c
index afa5a3e0029b..68851b81354a 100644
--- a/kernel/lockdep.c
+++ b/kernel/lockdep.c
@@ -28,6 +28,7 @@
 #define DISABLE_BRANCH_PROFILING
 #include <linux/mutex.h>
 #include <linux/sched.h>
+#include <linux/sched/clock.h>
 #include <linux/delay.h>
 #include <linux/module.h>
 #include <linux/proc_fs.h>
* Unmerged path kernel/printk.c
diff --git a/kernel/qspinlock_stat.h b/kernel/qspinlock_stat.h
index 3e50514377ad..2d3d48bdc456 100644
--- a/kernel/qspinlock_stat.h
+++ b/kernel/qspinlock_stat.h
@@ -69,6 +69,7 @@ enum qlock_stats {
  */
 #include <linux/debugfs.h>
 #include <linux/sched.h>
+#include <linux/sched/clock.h>
 #include <linux/fs.h>
 
 static const char * const qstat_names[qstat_num + 1] = {
diff --git a/kernel/sched/clock.c b/kernel/sched/clock.c
index 8dc200aaa09f..3c5e93626daf 100644
--- a/kernel/sched/clock.c
+++ b/kernel/sched/clock.c
@@ -58,6 +58,7 @@
 #include <linux/percpu.h>
 #include <linux/ktime.h>
 #include <linux/sched.h>
+#include <linux/sched/clock.h>
 #include <linux/static_key.h>
 #include <linux/workqueue.h>
 #include <linux/compiler.h>
* Unmerged path kernel/sched/core.c
* Unmerged path kernel/sched/sched.h
* Unmerged path kernel/time/sched_clock.c
diff --git a/kernel/time/tick-sched.c b/kernel/time/tick-sched.c
index 85c7fe06eace..f2aeb9fd87c4 100644
--- a/kernel/time/tick-sched.c
+++ b/kernel/time/tick-sched.c
@@ -19,6 +19,7 @@
 #include <linux/percpu.h>
 #include <linux/profile.h>
 #include <linux/sched.h>
+#include <linux/sched/clock.h>
 #include <linux/module.h>
 #include <linux/irq_work.h>
 #include <linux/posix-timers.h>
* Unmerged path kernel/torture.c
diff --git a/kernel/trace/ring_buffer.c b/kernel/trace/ring_buffer.c
index b6fd21ee8ebf..cf3b37b2f5e2 100644
--- a/kernel/trace/ring_buffer.c
+++ b/kernel/trace/ring_buffer.c
@@ -6,6 +6,7 @@
 #include <linux/ftrace_event.h>
 #include <linux/ring_buffer.h>
 #include <linux/trace_clock.h>
+#include <linux/sched/clock.h>
 #include <linux/trace_seq.h>
 #include <linux/spinlock.h>
 #include <linux/irq_work.h>
diff --git a/kernel/trace/trace_clock.c b/kernel/trace/trace_clock.c
index 26dc348332b7..0900547dc097 100644
--- a/kernel/trace/trace_clock.c
+++ b/kernel/trace/trace_clock.c
@@ -18,6 +18,7 @@
 #include <linux/module.h>
 #include <linux/percpu.h>
 #include <linux/sched.h>
+#include <linux/sched/clock.h>
 #include <linux/ktime.h>
 #include <linux/trace_clock.h>
 
diff --git a/kernel/trace/trace_hwlat.c b/kernel/trace/trace_hwlat.c
index 4b30d8bcf79c..aacdf86df2af 100644
--- a/kernel/trace/trace_hwlat.c
+++ b/kernel/trace/trace_hwlat.c
@@ -44,6 +44,7 @@
 #include <linux/uaccess.h>
 #include <linux/cpumask.h>
 #include <linux/delay.h>
+#include <linux/sched/clock.h>
 #include "trace.h"
 
 static struct trace_array	*hwlat_trace;
diff --git a/kernel/trace/trace_output.c b/kernel/trace/trace_output.c
index bdc9e6d81c41..33aeb46e4d26 100644
--- a/kernel/trace/trace_output.c
+++ b/kernel/trace/trace_output.c
@@ -8,6 +8,7 @@
 #include <linux/module.h>
 #include <linux/mutex.h>
 #include <linux/ftrace.h>
+#include <linux/sched/clock.h>
 
 #include "trace_output.h"
 
diff --git a/kernel/watchdog.c b/kernel/watchdog.c
index 704b2184e535..ea9e43a22513 100644
--- a/kernel/watchdog.c
+++ b/kernel/watchdog.c
@@ -21,6 +21,7 @@
 #include <linux/sched/rt.h>
 #include <linux/tick.h>
 #include <linux/workqueue.h>
+#include <linux/sched/clock.h>
 
 #include <asm/irq_regs.h>
 #include <linux/kvm_para.h>
diff --git a/lib/plist.c b/lib/plist.c
index 0f2084d30798..65ca543c317c 100644
--- a/lib/plist.c
+++ b/lib/plist.c
@@ -176,6 +176,7 @@ void plist_requeue(struct plist_node *node, struct plist_head *head)
 
 #ifdef CONFIG_DEBUG_PI_LIST
 #include <linux/sched.h>
+#include <linux/sched/clock.h>
 #include <linux/module.h>
 #include <linux/init.h>
 
* Unmerged path net/ipv4/tcp_cdg.c
