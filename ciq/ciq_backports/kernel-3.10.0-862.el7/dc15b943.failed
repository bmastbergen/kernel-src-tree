dm raid: ensure 'a' chars during reshape

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
commit-author Heinz Mauelshagen <heinzm@redhat.com>
commit dc15b943d4651bc13b9737bb27283ad9d3b8eeba
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/dc15b943.failed

During reshape, 'A' chars were reported in status rather than 'a'.

	Signed-off-by: Heinz Mauelshagen <heinzm@redhat.com>
	Signed-off-by: Mike Snitzer <snitzer@redhat.com>
(cherry picked from commit dc15b943d4651bc13b9737bb27283ad9d3b8eeba)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/md/dm-raid.c
diff --cc drivers/md/dm-raid.c
index 94db8c87956d,af4f40de2c0b..000000000000
--- a/drivers/md/dm-raid.c
+++ b/drivers/md/dm-raid.c
@@@ -3327,9 -3431,36 +3327,42 @@@ static sector_t rs_get_progress(struct 
  			/*
  			 * Sync complete.
  			 */
++<<<<<<< HEAD
 +			*array_in_sync = true;
 +			r = resync_max_sectors;
 +		} else if (test_bit(MD_RECOVERY_REQUESTED, &mddev->recovery)) {
++=======
+ 			/* In case we have finished recovering, the array is in sync. */
+ 			if (test_bit(MD_RECOVERY_RECOVER, &recovery))
+ 				set_bit(RT_FLAG_RS_IN_SYNC, &rs->runtime_flags);
+ 
+ 		} else if (test_bit(MD_RECOVERY_RECOVER, &recovery)) {
+ 			/*
+ 			 * In case we are recovering, the array is not in sync
+ 			 * and health chars should show the recovering legs.
+ 			 */
+ 			;
+ 
+ 		} else if (test_bit(MD_RECOVERY_SYNC, &recovery) &&
+ 			   !test_bit(MD_RECOVERY_REQUESTED, &recovery)) {
+ 			/*
+ 			 * If "resync" is occurring, the raid set
+ 			 * is or may be out of sync hence the health
+ 			 * characters shall be 'a'.
+ 			 */
+ 			set_bit(RT_FLAG_RS_RESYNCING, &rs->runtime_flags);
+ 
+ 		} else if (test_bit(MD_RECOVERY_RESHAPE, &recovery) &&
+ 			   !test_bit(MD_RECOVERY_REQUESTED, &recovery)) {
+ 			/*
+ 			 * If "reshape" is occurring, the raid set
+ 			 * is or may be out of sync hence the health
+ 			 * characters shall be 'a'.
+ 			 */
+ 			set_bit(RT_FLAG_RS_RESYNCING, &rs->runtime_flags);
+ 
+ 		} else if (test_bit(MD_RECOVERY_REQUESTED, &recovery)) {
++>>>>>>> dc15b943d465 (dm raid: ensure 'a' chars during reshape)
  			/*
  			 * If "check" or "repair" is occurring, the raid set has
  			 * undergone an initial sync and the health characters
* Unmerged path drivers/md/dm-raid.c
