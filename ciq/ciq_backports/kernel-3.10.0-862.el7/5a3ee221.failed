sbp-target: Conversion to percpu_ida tag pre-allocation

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
commit-author Nicholas Bellinger <nab@linux-iscsi.org>
commit 5a3ee221b543100ce3bed5b59bfb155d0ef293b7
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/5a3ee221.failed

This patch converts sbp-target to use struct sbp_target_request
descriptor tag pre-allocation using percpu_ida.

(Fix sbp_mgt_get_req() IS_ERR failure checking - Dan Carpenter)
(Add missing sbp_target_request tag memset - Chris Boot)

	Acked-by: Chris Boot <bootc@bootc.net>
	Tested-by: Chris Boot <bootc@bootc.net>
	Cc: Christoph Hellwig <hch@lst.de>
	Cc: Hannes Reinecke <hare@suse.de>
	Signed-off-by: Nicholas Bellinger <nab@linux-iscsi.org>
(cherry picked from commit 5a3ee221b543100ce3bed5b59bfb155d0ef293b7)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/target/sbp/sbp_target.c
diff --cc drivers/target/sbp/sbp_target.c
index b33c121ab56c,627044f2b75e..000000000000
--- a/drivers/target/sbp/sbp_target.c
+++ b/drivers/target/sbp/sbp_target.c
@@@ -209,11 -204,17 +209,18 @@@ static struct sbp_session *sbp_session_
  		pr_err("failed to allocate session descriptor\n");
  		return ERR_PTR(-ENOMEM);
  	}
 -	spin_lock_init(&sess->lock);
 -	INIT_LIST_HEAD(&sess->login_list);
 -	INIT_DELAYED_WORK(&sess->maint_work, session_maintenance_work);
 -	sess->guid = guid;
  
++<<<<<<< HEAD
 +	sess->se_sess = transport_init_session(TARGET_PROT_NORMAL);
++=======
+ 	sess->se_sess = target_alloc_session(&tpg->se_tpg, 128,
+ 					     sizeof(struct sbp_target_request),
+ 					     TARGET_PROT_NORMAL, guid_str,
+ 					     sess, NULL);
++>>>>>>> 5a3ee221b543 (sbp-target: Conversion to percpu_ida tag pre-allocation)
  	if (IS_ERR(sess->se_sess)) {
  		pr_err("failed to init se_session\n");
 +
  		ret = PTR_ERR(sess->se_sess);
  		kfree(sess);
  		return ERR_PTR(ret);
* Unmerged path drivers/target/sbp/sbp_target.c
