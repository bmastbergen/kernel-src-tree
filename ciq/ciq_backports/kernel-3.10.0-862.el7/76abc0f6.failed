nfp: report application FW build name in ethtool -i

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
commit-author Jakub Kicinski <jakub.kicinski@netronome.com>
commit 76abc0f620549d7fdf960bb8c99e502e9b61faae
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/76abc0f6.failed

Make sure application FW build name is NULL-terminated and
print it as a part of ethtool's firmware version string.

	Signed-off-by: Jakub Kicinski <jakub.kicinski@netronome.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 76abc0f620549d7fdf960bb8c99e502e9b61faae)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/netronome/nfp/nfp_app.c
#	drivers/net/ethernet/netronome/nfp/nfp_app.h
#	drivers/net/ethernet/netronome/nfp/nfp_net_ethtool.c
diff --cc drivers/net/ethernet/netronome/nfp/nfp_net_ethtool.c
index 69f458e0de89,6e31355c3567..000000000000
--- a/drivers/net/ethernet/netronome/nfp/nfp_net_ethtool.c
+++ b/drivers/net/ethernet/netronome/nfp/nfp_net_ethtool.c
@@@ -149,11 -164,12 +149,18 @@@ static void nfp_net_get_drvinfo(struct 
  		sizeof(drvinfo->driver));
  	strlcpy(drvinfo->version, nfp_driver_version, sizeof(drvinfo->version));
  
 -	nfp_net_get_nspinfo(nn->app, nsp_version);
 +	nfp_net_get_nspinfo(nn, nsp_version);
  	snprintf(drvinfo->fw_version, sizeof(drvinfo->fw_version),
++<<<<<<< HEAD
 +		 "%d.%d.%d.%d %s",
 +		 nn->fw_ver.resv, nn->fw_ver.class,
 +		 nn->fw_ver.major, nn->fw_ver.minor, nsp_version);
++=======
+ 		 "%d.%d.%d.%d %s %s %s",
+ 		 nn->fw_ver.resv, nn->fw_ver.class,
+ 		 nn->fw_ver.major, nn->fw_ver.minor, nsp_version,
+ 		 nfp_app_mip_name(nn->app), nfp_app_name(nn->app));
++>>>>>>> 76abc0f62054 (nfp: report application FW build name in ethtool -i)
  	strlcpy(drvinfo->bus_info, pci_name(nn->pdev),
  		sizeof(drvinfo->bus_info));
  
* Unmerged path drivers/net/ethernet/netronome/nfp/nfp_app.c
* Unmerged path drivers/net/ethernet/netronome/nfp/nfp_app.h
* Unmerged path drivers/net/ethernet/netronome/nfp/nfp_app.c
* Unmerged path drivers/net/ethernet/netronome/nfp/nfp_app.h
* Unmerged path drivers/net/ethernet/netronome/nfp/nfp_net_ethtool.c
diff --git a/drivers/net/ethernet/netronome/nfp/nfpcore/nfp_mip.c b/drivers/net/ethernet/netronome/nfp/nfpcore/nfp_mip.c
index 3d15dd03647e..5f193fe2d69e 100644
--- a/drivers/net/ethernet/netronome/nfp/nfpcore/nfp_mip.c
+++ b/drivers/net/ethernet/netronome/nfp/nfpcore/nfp_mip.c
@@ -141,6 +141,8 @@ const struct nfp_mip *nfp_mip_open(struct nfp_cpp *cpp)
 		return NULL;
 	}
 
+	mip->name[sizeof(mip->name) - 1] = 0;
+
 	return mip;
 }
 
@@ -149,6 +151,11 @@ void nfp_mip_close(const struct nfp_mip *mip)
 	kfree(mip);
 }
 
+const char *nfp_mip_name(const struct nfp_mip *mip)
+{
+	return mip->name;
+}
+
 /**
  * nfp_mip_symtab() - Get the address and size of the MIP symbol table
  * @mip:	MIP handle
diff --git a/drivers/net/ethernet/netronome/nfp/nfpcore/nfp_nffw.h b/drivers/net/ethernet/netronome/nfp/nfpcore/nfp_nffw.h
index 988badd230d1..4d74b332a892 100644
--- a/drivers/net/ethernet/netronome/nfp/nfpcore/nfp_nffw.h
+++ b/drivers/net/ethernet/netronome/nfp/nfpcore/nfp_nffw.h
@@ -55,6 +55,7 @@ struct nfp_mip;
 const struct nfp_mip *nfp_mip_open(struct nfp_cpp *cpp);
 void nfp_mip_close(const struct nfp_mip *mip);
 
+const char *nfp_mip_name(const struct nfp_mip *mip);
 void nfp_mip_symtab(const struct nfp_mip *mip, u32 *addr, u32 *size);
 void nfp_mip_strtab(const struct nfp_mip *mip, u32 *addr, u32 *size);
 
