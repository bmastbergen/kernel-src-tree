net/mlx5e: Set default RX moderation parameters on driver load

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
Rebuild_CHGLOG: - [netdrv] mlx5e: Set default RX moderation parameters on driver load (Don Dutile) [1456694 1499362]
Rebuild_FUZZ: 96.67%
commit-author Saeed Mahameed <saeedm@mellanox.com>
commit 457fcd8a11f7f7f2483b2366d8a98f269c085302
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/457fcd8a.failed

RX moderation default parameters shouldn't be set in
mlx5e_build_rx_cq_param since it would reset the values every time on
netdev open/close.  Instead, it should be set in
mlx5e_set_rx_cq_mode_params which is called on driver load only.

Fixes: 6a9764efb255 ("net/mlx5e: Isolate open_channels from priv->params")
	Signed-off-by: Saeed Mahameed <saeedm@mellanox.com>
(cherry picked from commit 457fcd8a11f7f7f2483b2366d8a98f269c085302)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/mellanox/mlx5/core/en_main.c
diff --cc drivers/net/ethernet/mellanox/mlx5/core/en_main.c
index fc92406a15c4,8b7b7e604ea0..000000000000
--- a/drivers/net/ethernet/mellanox/mlx5/core/en_main.c
+++ b/drivers/net/ethernet/mellanox/mlx5/core/en_main.c
@@@ -1670,8 -1944,6 +1670,11 @@@ static void mlx5e_build_rx_cq_param(str
  	}
  
  	mlx5e_build_common_cq_param(priv, param);
++<<<<<<< HEAD
 +
 +	param->cq_period_mode = priv->params.rx_cq_period_mode;
++=======
++>>>>>>> 457fcd8a11f7 (net/mlx5e: Set default RX moderation parameters on driver load)
  }
  
  static void mlx5e_build_tx_cq_param(struct mlx5e_priv *priv,
@@@ -3295,6 -3782,13 +3298,16 @@@ void mlx5e_set_rx_cq_mode_params(struc
  	if (cq_period_mode == MLX5_CQ_PERIOD_MODE_START_FROM_CQE)
  		params->rx_cq_moderation.usec =
  			MLX5E_PARAMS_DEFAULT_RX_CQ_MODERATION_USEC_FROM_CQE;
++<<<<<<< HEAD
++=======
+ 
+ 	if (params->rx_am_enabled)
+ 		params->rx_cq_moderation =
+ 			mlx5e_am_get_def_profile(params->rx_cq_period_mode);
+ 
+ 	MLX5E_SET_PFLAG(params, MLX5E_PFLAG_RX_CQE_BASED_MODER,
+ 			params->rx_cq_period_mode == MLX5_CQ_PERIOD_MODE_START_FROM_CQE);
++>>>>>>> 457fcd8a11f7 (net/mlx5e: Set default RX moderation parameters on driver load)
  }
  
  u32 mlx5e_choose_lro_timeout(struct mlx5_core_dev *mdev, u32 wanted_timeout)
* Unmerged path drivers/net/ethernet/mellanox/mlx5/core/en_main.c
