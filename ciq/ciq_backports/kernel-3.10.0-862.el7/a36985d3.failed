userfaultfd: provide pid in userfault msg - add feat union

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
commit-author Andrea Arcangeli <aarcange@redhat.com>
commit a36985d31a65d5c0559fb582719e32eaf0ccec3b
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/a36985d3.failed

No ABI change, but this will make it more explicit to software that ptid
is only available if requested by passing UFFD_FEATURE_THREAD_ID to
UFFDIO_API.  The fact it's a union will also self document it shouldn't
be taken for granted there's a tpid there.

Link: http://lkml.kernel.org/r/20170802165145.22628-7-aarcange@redhat.com
	Signed-off-by: Andrea Arcangeli <aarcange@redhat.com>
	Cc: "Dr. David Alan Gilbert" <dgilbert@redhat.com>
	Cc: Alexey Perevalov <a.perevalov@samsung.com>
	Cc: Maxime Coquelin <maxime.coquelin@redhat.com>
	Cc: Mike Kravetz <mike.kravetz@oracle.com>
	Cc: Mike Rapoport <rppt@linux.vnet.ibm.com>
	Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
	Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
(cherry picked from commit a36985d31a65d5c0559fb582719e32eaf0ccec3b)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	fs/userfaultfd.c
#	include/uapi/linux/userfaultfd.h
diff --cc fs/userfaultfd.c
index 66d8f60bb538,5419e7da82ba..000000000000
--- a/fs/userfaultfd.c
+++ b/fs/userfaultfd.c
@@@ -204,6 -203,8 +204,11 @@@ static inline struct uffd_msg userfault
  		 * write protect fault.
  		 */
  		msg.arg.pagefault.flags |= UFFD_PAGEFAULT_FLAG_WP;
++<<<<<<< HEAD
++=======
+ 	if (features & UFFD_FEATURE_THREAD_ID)
+ 		msg.arg.pagefault.feat.ptid = task_pid_vnr(current);
++>>>>>>> a36985d31a65 (userfaultfd: provide pid in userfault msg - add feat union)
  	return msg;
  }
  
diff --cc include/uapi/linux/userfaultfd.h
index b871274013d9,d6d1f65cb3c3..000000000000
--- a/include/uapi/linux/userfaultfd.h
+++ b/include/uapi/linux/userfaultfd.h
@@@ -79,6 -80,9 +79,12 @@@ struct uffd_msg 
  		struct {
  			__u64	flags;
  			__u64	address;
++<<<<<<< HEAD
++=======
+ 			union {
+ 				__u32 ptid;
+ 			} feat;
++>>>>>>> a36985d31a65 (userfaultfd: provide pid in userfault msg - add feat union)
  		} pagefault;
  
  		struct {
* Unmerged path fs/userfaultfd.c
* Unmerged path include/uapi/linux/userfaultfd.h
