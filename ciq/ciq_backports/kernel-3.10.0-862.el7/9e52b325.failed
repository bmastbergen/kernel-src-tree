tracing/kprobes: Allow to create probe with a module name starting with a digit

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
commit-author Sabrina Dubroca <sd@queasysnail.net>
commit 9e52b32567126fe146f198971364f68d3bc5233f
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/9e52b325.failed

Always try to parse an address, since kstrtoul() will safely fail when
given a symbol as input. If that fails (which will be the case for a
symbol), try to parse a symbol instead.

This allows creating a probe such as:

    p:probe/vlan_gro_receive 8021q:vlan_gro_receive+0

Which is necessary for this command to work:

    perf probe -m 8021q -a vlan_gro_receive

Link: http://lkml.kernel.org/r/fd72d666f45b114e2c5b9cf7e27b91de1ec966f1.1498122881.git.sd@queasysnail.net

	Cc: stable@vger.kernel.org
Fixes: 413d37d1e ("tracing: Add kprobe-based event tracer")
	Acked-by: Masami Hiramatsu <mhiramat@kernel.org>
	Signed-off-by: Sabrina Dubroca <sd@queasysnail.net>
	Signed-off-by: Steven Rostedt (VMware) <rostedt@goodmis.org>
(cherry picked from commit 9e52b32567126fe146f198971364f68d3bc5233f)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	kernel/trace/trace_kprobe.c
diff --cc kernel/trace/trace_kprobe.c
index 50356290f72e,b53c8d369163..000000000000
--- a/kernel/trace/trace_kprobe.c
+++ b/kernel/trace/trace_kprobe.c
@@@ -755,28 -707,21 +755,35 @@@ static int create_trace_probe(int argc
  		pr_info("Probe point is not specified.\n");
  		return -EINVAL;
  	}
++<<<<<<< HEAD
 +	if (isdigit(argv[1][0])) {
 +		if (is_return) {
 +			pr_info("Return probe point must be a symbol.\n");
 +			return -EINVAL;
 +		}
 +		/* an address specified */
 +		ret = kstrtoul(&argv[1][0], 0, (unsigned long *)&addr);
 +		if (ret) {
 +			pr_info("Failed to parse address.\n");
 +			return ret;
 +		}
 +	} else {
++=======
+ 
+ 	/* try to parse an address. if that fails, try to read the
+ 	 * input as a symbol. */
+ 	if (kstrtoul(argv[1], 0, (unsigned long *)&addr)) {
++>>>>>>> 9e52b3256712 (tracing/kprobes: Allow to create probe with a module name starting with a digit)
  		/* a symbol specified */
  		symbol = argv[1];
  		/* TODO: support .init module functions */
  		ret = traceprobe_split_symbol_offset(symbol, &offset);
  		if (ret) {
- 			pr_info("Failed to parse symbol.\n");
+ 			pr_info("Failed to parse either an address or a symbol.\n");
  			return ret;
  		}
 -		if (offset && is_return &&
 -		    !function_offset_within_entry(NULL, symbol, offset)) {
 -			pr_info("Given offset is not valid for return probe.\n");
 +		if (offset && is_return) {
 +			pr_info("Return probe must be used without offset.\n");
  			return -EINVAL;
  		}
  	}
* Unmerged path kernel/trace/trace_kprobe.c
