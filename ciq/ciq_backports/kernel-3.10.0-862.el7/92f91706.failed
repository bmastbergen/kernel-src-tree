net_sched: check noop_qdisc before qdisc_hash_add()

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
commit-author WANG Cong <xiyou.wangcong@gmail.com>
commit 92f9170621a13e4ba4eda6dfb070318d5405a0cf
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/92f91706.failed

Dmitry reported a crash when injecting faults in
attach_one_default_qdisc() and dev->qdisc is still
a noop_disc, the check before qdisc_hash_add() fails
to catch it because it tests NULL. We should test
against noop_qdisc since it is the default qdisc
at this point.

Fixes: 59cc1f61f09c ("net: sched: convert qdisc linked list to hashtable")
	Reported-by: Dmitry Vyukov <dvyukov@google.com>
	Cc: Jiri Kosina <jkosina@suse.cz>
	Signed-off-by: Cong Wang <xiyou.wangcong@gmail.com>
	Acked-by: Jiri Kosina <jkosina@suse.cz>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 92f9170621a13e4ba4eda6dfb070318d5405a0cf)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/sched/sch_generic.c
diff --cc net/sched/sch_generic.c
index 57cbfa322683,1a2f9e964330..000000000000
--- a/net/sched/sch_generic.c
+++ b/net/sched/sch_generic.c
@@@ -767,6 -793,10 +767,13 @@@ static void attach_default_qdiscs(struc
  			qdisc->ops->attach(qdisc);
  		}
  	}
++<<<<<<< HEAD
++=======
+ #ifdef CONFIG_NET_SCHED
+ 	if (dev->qdisc != &noop_qdisc)
+ 		qdisc_hash_add(dev->qdisc);
+ #endif
++>>>>>>> 92f9170621a1 (net_sched: check noop_qdisc before qdisc_hash_add())
  }
  
  static void transition_one_qdisc(struct net_device *dev,
* Unmerged path net/sched/sch_generic.c
