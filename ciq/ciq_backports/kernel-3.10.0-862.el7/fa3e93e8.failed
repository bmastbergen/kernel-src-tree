bnxt_en: Refactor tx completion path.

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
Rebuild_CHGLOG: - [netdrv] bnxt_en: Refactor tx completion path (Jonathan Toppins) [1459659]
Rebuild_FUZZ: 98.63%
commit-author Michael Chan <michael.chan@broadcom.com>
commit fa3e93e86cc3d1809fba67cb138883ed4bb74a5f
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/fa3e93e8.failed

XDP_TX requires a different function to handle completion.  Add a
function pointer to handle tx completion logic.  Regular TX rings
will be assigned the current bnxt_tx_int() for the ->tx_int()
function pointer.

	Signed-off-by: Michael Chan <michael.chan@broadcom.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit fa3e93e86cc3d1809fba67cb138883ed4bb74a5f)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/broadcom/bnxt/bnxt.c
diff --cc drivers/net/ethernet/broadcom/bnxt/bnxt.c
index 10385773ecb6,64dc94d62a95..000000000000
--- a/drivers/net/ethernet/broadcom/bnxt/bnxt.c
+++ b/drivers/net/ethernet/broadcom/bnxt/bnxt.c
@@@ -2957,8 -3044,13 +2957,18 @@@ static int bnxt_alloc_mem(struct bnxt *
  		for (i = 0; i < bp->tx_nr_rings; i++, j++) {
  			bp->tx_ring[i].bnapi = bp->bnapi[j];
  			bp->bnapi[j]->tx_ring = &bp->tx_ring[i];
++<<<<<<< HEAD
 +			bp->tx_ring_map[i] = i;
 +			bp->tx_ring[i].txq_index = i;
++=======
+ 			bp->tx_ring_map[i] = bp->tx_nr_rings_xdp + i;
+ 			if (i >= bp->tx_nr_rings_xdp)
+ 				bp->tx_ring[i].txq_index = i -
+ 					bp->tx_nr_rings_xdp;
+ 			else
+ 				bp->bnapi[j]->flags |= BNXT_NAPI_FLAG_XDP;
+ 			bp->bnapi[j]->tx_int = bnxt_tx_int;
++>>>>>>> fa3e93e86cc3 (bnxt_en: Refactor tx completion path.)
  		}
  
  		rc = bnxt_alloc_stats(bp);
* Unmerged path drivers/net/ethernet/broadcom/bnxt/bnxt.c
diff --git a/drivers/net/ethernet/broadcom/bnxt/bnxt.h b/drivers/net/ethernet/broadcom/bnxt/bnxt.h
index 5e8dec350fca..ad05324f609b 100644
--- a/drivers/net/ethernet/broadcom/bnxt/bnxt.h
+++ b/drivers/net/ethernet/broadcom/bnxt/bnxt.h
@@ -661,6 +661,11 @@ struct bnxt_napi {
 	struct bnxt_rx_ring_info	*rx_ring;
 	struct bnxt_tx_ring_info	*tx_ring;
 
+	void			(*tx_int)(struct bnxt *, struct bnxt_napi *,
+					  int);
+	u32			flags;
+#define BNXT_NAPI_FLAG_XDP	0x1
+
 	bool			in_reset;
 };
 
