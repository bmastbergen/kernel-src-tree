IB/opa-vnic: RDMA NETDEV interface

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
commit-author Vishwanathapura, Niranjana <niranjana.vishwanathapura@intel.com>
commit 2fc77572649163f8d669389e87217cc99942847a
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/2fc77572.failed

Add rdma netdev interface to ib device structure allowing rdma netdev
devices to be allocated by ib clients.

	Reviewed-by: Dennis Dalessandro <dennis.dalessandro@intel.com>
	Reviewed-by: Ira Weiny <ira.weiny@intel.com>
	Signed-off-by: Niranjana Vishwanathapura <niranjana.vishwanathapura@intel.com>
	Signed-off-by: Doug Ledford <dledford@redhat.com>
(cherry picked from commit 2fc77572649163f8d669389e87217cc99942847a)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	include/rdma/ib_verbs.h
diff --cc include/rdma/ib_verbs.h
index 09960c5840eb,dd02ba53fd1f..000000000000
--- a/include/rdma/ib_verbs.h
+++ b/include/rdma/ib_verbs.h
@@@ -1899,7 -1878,26 +1900,25 @@@ struct ib_port_immutable 
  	u32                           max_mad_size;
  };
  
+ /* rdma netdev type - specifies protocol type */
+ enum rdma_netdev_t {
+ 	RDMA_NETDEV_OPA_VNIC
+ };
+ 
+ /**
+  * struct rdma_netdev - rdma netdev
+  * For cases where netstack interfacing is required.
+  */
+ struct rdma_netdev {
+ 	void              *clnt_priv;
+ 	struct ib_device  *hca;
+ 	u8                 port_num;
+ 
+ 	/* control functions */
+ 	void (*set_id)(struct net_device *netdev, int id);
+ };
+ 
  struct ib_device {
 -	/* Do not access @dma_device directly from ULP nor from HW drivers. */
  	struct device                *dma_device;
  
  	char                          name[IB_DEVICE_NAME_MAX];
@@@ -2149,10 -2149,20 +2168,27 @@@
  							   struct ib_rwq_ind_table_init_attr *init_attr,
  							   struct ib_udata *udata);
  	int                        (*destroy_rwq_ind_table)(struct ib_rwq_ind_table *wq_ind_table);
++<<<<<<< HEAD
 +	void			   (*drain_rq)(struct ib_qp *qp);
 +	void			   (*drain_sq)(struct ib_qp *qp);
 +
 +	struct ib_dma_mapping_ops   *dma_ops;
++=======
+ 	/**
+ 	 * rdma netdev operations
+ 	 *
+ 	 * Driver implementing alloc_rdma_netdev must return -EOPNOTSUPP if it
+ 	 * doesn't support the specified rdma netdev type.
+ 	 */
+ 	struct net_device *(*alloc_rdma_netdev)(
+ 					struct ib_device *device,
+ 					u8 port_num,
+ 					enum rdma_netdev_t type,
+ 					const char *name,
+ 					unsigned char name_assign_type,
+ 					void (*setup)(struct net_device *));
+ 	void (*free_rdma_netdev)(struct net_device *netdev);
++>>>>>>> 2fc775726491 (IB/opa-vnic: RDMA NETDEV interface)
  
  	struct module               *owner;
  	struct device                dev;
* Unmerged path include/rdma/ib_verbs.h
