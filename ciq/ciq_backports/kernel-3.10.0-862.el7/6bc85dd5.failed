qla2xxx: Remove msleep in qlt_send_term_exchange

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
commit-author Himanshu Madhani <himanshu.madhani@qlogic.com>
commit 6bc85dd595a5438b50ec085668e53ef26058bb90
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/6bc85dd5.failed

Remove unnecessary msleep from qlt_send_term_exchange as it
adds latency of 250 msec while sending terminate exchange to
an aborted task.

	Cc: <stable@vger.kernel.org> # v3.18+
	Signed-off-by: Himanshu Madhani <himanshu.madhani@qlogic.com>
	Signed-off-by: Giridhar Malavali <giridhar.malavali@qlogic.com>
	Reviewed-by: Nicholas Bellinger <nab@linux-iscsi.org>
	Signed-off-by: Nicholas Bellinger <nab@linux-iscsi.org>
(cherry picked from commit 6bc85dd595a5438b50ec085668e53ef26058bb90)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/scsi/qla2xxx/qla_target.c
diff --cc drivers/scsi/qla2xxx/qla_target.c
index 4e0d4c3c5146,2491bc9dd2a5..000000000000
--- a/drivers/scsi/qla2xxx/qla_target.c
+++ b/drivers/scsi/qla2xxx/qla_target.c
@@@ -2270,25 -2727,20 +2270,40 @@@ static void qlt_send_term_exchange(stru
  	}
  	spin_lock_irqsave(&vha->hw->hardware_lock, flags);
  	rc = __qlt_send_term_exchange(vha, cmd, atio);
++<<<<<<< HEAD
 +	spin_unlock_irqrestore(&vha->hw->hardware_lock, flags);
 +done:
 +	/*
 +	 * Terminate exchange will tell fw to release any active CTIO
 +	 * that's in FW posession and cleanup the exchange.
 +	 *
 +	 * "cmd->state == QLA_TGT_STATE_ABORTED" means CTIO is still
 +	 * down at FW.  Free the cmd later when CTIO comes back later
 +	 * w/aborted(0x2) status.
 +	 *
 +	 * "cmd->state != QLA_TGT_STATE_ABORTED" means CTIO is already
 +	 * back w/some err.  Free the cmd now.
 +	 */
 +	if ((rc == 1) && (cmd->state != QLA_TGT_STATE_ABORTED)) {
 +		if (!ha_locked && !in_interrupt())
 +			msleep(250); /* just in case */
 +
++=======
+ 	if (rc == -ENOMEM)
+ 		qlt_alloc_qfull_cmd(vha, atio, 0, 0);
+ 
+ done:
+ 	if (cmd && ((cmd->state != QLA_TGT_STATE_ABORTED) ||
+ 	    !cmd->cmd_sent_to_fw)) {
+ 		if (cmd->sg_mapped)
+ 			qlt_unmap_sg(vha, cmd);
++>>>>>>> 6bc85dd595a5 (qla2xxx: Remove msleep in qlt_send_term_exchange)
  		vha->hw->tgt.tgt_ops->free_cmd(cmd);
  	}
+ 
+ 	if (!ha_locked)
+ 		spin_unlock_irqrestore(&vha->hw->hardware_lock, flags);
+ 
  	return;
  }
  
* Unmerged path drivers/scsi/qla2xxx/qla_target.c
