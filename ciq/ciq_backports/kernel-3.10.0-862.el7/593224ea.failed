USB: uas: Fix slave queue_depth not being set

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
Rebuild_CHGLOG: - [usb] uas: Fix slave queue_depth not being set (Torez Smith) [1435752]
Rebuild_FUZZ: 94.12%
commit-author Hans de Goede <hdegoede@redhat.com>
commit 593224ea77b1ca842f45cf76f4deeef44dfbacd1
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/593224ea.failed

Commit 198de51dbc34 ("USB: uas: Limit qdepth at the scsi-host level")
removed the scsi_change_queue_depth() call from uas_slave_configure()
assuming that the slave would inherit the host's queue_depth, which
that commit sets to the same value.

This is incorrect, without the scsi_change_queue_depth() call the slave's
queue_depth defaults to 1, introducing a performance regression.

This commit restores the call, fixing the performance regression.

	Cc: stable@vger.kernel.org
Fixes: 198de51dbc34 ("USB: uas: Limit qdepth at the scsi-host level")
	Reported-by: Tom Yan <tom.ty89@gmail.com>
	Signed-off-by: Hans de Goede <hdegoede@redhat.com>
	Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
(cherry picked from commit 593224ea77b1ca842f45cf76f4deeef44dfbacd1)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/usb/storage/uas.c
diff --cc drivers/usb/storage/uas.c
index d371b91ecf04,5ef014ba6ae8..000000000000
--- a/drivers/usb/storage/uas.c
+++ b/drivers/usb/storage/uas.c
@@@ -832,8 -832,11 +832,16 @@@ static int uas_slave_configure(struct s
  	if (devinfo->flags & US_FL_NO_REPORT_OPCODES)
  		sdev->no_report_opcodes = 1;
  
++<<<<<<< HEAD
 +	scsi_set_tag_type(sdev, MSG_ORDERED_TAG);
 +	scsi_activate_tcq(sdev, devinfo->qdepth - 2);
++=======
+ 	/* A few buggy USB-ATA bridges don't understand FUA */
+ 	if (devinfo->flags & US_FL_BROKEN_FUA)
+ 		sdev->broken_fua = 1;
+ 
+ 	scsi_change_queue_depth(sdev, devinfo->qdepth - 2);
++>>>>>>> 593224ea77b1 (USB: uas: Fix slave queue_depth not being set)
  	return 0;
  }
  
* Unmerged path drivers/usb/storage/uas.c
