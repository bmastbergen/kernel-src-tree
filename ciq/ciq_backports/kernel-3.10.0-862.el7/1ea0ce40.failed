selinux: allow changing labels for cgroupfs

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
commit-author Antonio Murdaca <amurdaca@redhat.com>
commit 1ea0ce40690dff38935538e8dab7b12683ded0d3
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/1ea0ce40.failed

This patch allows changing labels for cgroup mounts. Previously, running
chcon on cgroupfs would throw an "Operation not supported". This patch
specifically whitelist cgroupfs.

The patch could also allow containers to write only to the systemd cgroup
for instance, while the other cgroups are kept with cgroup_t label.

	Signed-off-by: Antonio Murdaca <runcom@redhat.com>
	Acked-by: Stephen Smalley <sds@tycho.nsa.gov>
	Signed-off-by: Paul Moore <paul@paul-moore.com>
(cherry picked from commit 1ea0ce40690dff38935538e8dab7b12683ded0d3)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	security/selinux/hooks.c
diff --cc security/selinux/hooks.c
index 7c150cbbfbc6,76af95fa741a..000000000000
--- a/security/selinux/hooks.c
+++ b/security/selinux/hooks.c
@@@ -455,6 -470,24 +455,27 @@@ static int may_context_mount_inode_rela
  	return rc;
  }
  
++<<<<<<< HEAD
++=======
+ static int selinux_is_sblabel_mnt(struct super_block *sb)
+ {
+ 	struct superblock_security_struct *sbsec = sb->s_security;
+ 
+ 	return sbsec->behavior == SECURITY_FS_USE_XATTR ||
+ 		sbsec->behavior == SECURITY_FS_USE_TRANS ||
+ 		sbsec->behavior == SECURITY_FS_USE_TASK ||
+ 		sbsec->behavior == SECURITY_FS_USE_NATIVE ||
+ 		/* Special handling. Genfs but also in-core setxattr handler */
+ 		!strcmp(sb->s_type->name, "sysfs") ||
+ 		!strcmp(sb->s_type->name, "cgroup") ||
+ 		!strcmp(sb->s_type->name, "cgroup2") ||
+ 		!strcmp(sb->s_type->name, "pstore") ||
+ 		!strcmp(sb->s_type->name, "debugfs") ||
+ 		!strcmp(sb->s_type->name, "tracefs") ||
+ 		!strcmp(sb->s_type->name, "rootfs");
+ }
+ 
++>>>>>>> 1ea0ce40690d (selinux: allow changing labels for cgroupfs)
  static int sb_finish_set_opts(struct super_block *sb)
  {
  	struct superblock_security_struct *sbsec = sb->s_security;
* Unmerged path security/selinux/hooks.c
