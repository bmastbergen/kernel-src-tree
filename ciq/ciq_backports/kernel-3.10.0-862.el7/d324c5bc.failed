drm/nouveau/kms/nv50: use the correct state for base channel notifier setup

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
commit-author Ben Skeggs <bskeggs@redhat.com>
commit d324c5bc462d354d337dcf3a14ffd0eb17b4fa38
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/d324c5bc.failed

Fixes: 857263 ("drm/nouveau: Handle drm_atomic_helper_swap_state failure")
	Signed-off-by: Ben Skeggs <bskeggs@redhat.com>
	Tested-by: Lyude Paul <lyude@redhat.com>
Reviewed by: Lyude Paul <lyude@redhat.com>
(cherry picked from commit d324c5bc462d354d337dcf3a14ffd0eb17b4fa38)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/gpu/drm/nouveau/nv50_display.c
diff --cc drivers/gpu/drm/nouveau/nv50_display.c
index 30cc3b53e2a4,fb47d46050ec..000000000000
--- a/drivers/gpu/drm/nouveau/nv50_display.c
+++ b/drivers/gpu/drm/nouveau/nv50_display.c
@@@ -4135,7 -4099,7 +4135,11 @@@ nv50_disp_atomic_commit(struct drm_devi
  {
  	struct nouveau_drm *drm = nouveau_drm(dev);
  	struct nv50_disp *disp = nv50_disp(dev);
++<<<<<<< HEAD
 +	struct drm_plane_state *plane_state;
++=======
+ 	struct drm_plane_state *new_plane_state;
++>>>>>>> d324c5bc462d (drm/nouveau/kms/nv50: use the correct state for base channel notifier setup)
  	struct drm_plane *plane;
  	struct drm_crtc *crtc;
  	bool active = false;
@@@ -4158,12 -4122,17 +4162,21 @@@
  	if (!nonblock) {
  		ret = drm_atomic_helper_wait_for_fences(dev, state, true);
  		if (ret)
 -			goto err_cleanup;
 +			goto done;
  	}
  
++<<<<<<< HEAD
 +	for_each_plane_in_state(state, plane, plane_state, i) {
 +		struct nv50_wndw_atom *asyw = nv50_wndw_atom(plane_state);
++=======
+ 	ret = drm_atomic_helper_swap_state(state, true);
+ 	if (ret)
+ 		goto err_cleanup;
+ 
+ 	for_each_new_plane_in_state(state, plane, new_plane_state, i) {
+ 		struct nv50_wndw_atom *asyw = nv50_wndw_atom(new_plane_state);
++>>>>>>> d324c5bc462d (drm/nouveau/kms/nv50: use the correct state for base channel notifier setup)
  		struct nv50_wndw *wndw = nv50_wndw(plane);
 -
  		if (asyw->set.image) {
  			asyw->ntfy.handle = wndw->dmac->sync.handle;
  			asyw->ntfy.offset = wndw->ntfy;
* Unmerged path drivers/gpu/drm/nouveau/nv50_display.c
