ALSA: x86: Don't enable runtime PM as default

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
commit-author Takashi Iwai <tiwai@suse.de>
commit 0b6b524f3915f88eb4562e8d927528224a8eab41
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/0b6b524f.failed

Unlike HSW and newer, BYT/CHT devices have no fine control of audio
power domain in i915 side.  Since there is little gain by runtime PM
on BYT/CHT, so far, this commit removes the pm_runtime_enable() call
as default.

User who still wants the runtime PM may adjust the corresponding
sysfs files (power/control and power/autosuspend_delay_ms)
appropriately, of course.

	Signed-off-by: Takashi Iwai <tiwai@suse.de>
(cherry picked from commit 0b6b524f3915f88eb4562e8d927528224a8eab41)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	sound/x86/intel_hdmi_audio.c
diff --cc sound/x86/intel_hdmi_audio.c
index 3dd33e089501,c505b019e09c..000000000000
--- a/sound/x86/intel_hdmi_audio.c
+++ b/sound/x86/intel_hdmi_audio.c
@@@ -1680,28 -1792,39 +1680,50 @@@ int hdmi_audio_probe(struct platform_de
  	init_channel_allocations();
  
  	/* Register channel map controls */
 -	ret = had_register_chmap_ctls(ctx, pcm);
 -	if (ret < 0)
 +	retval = had_register_chmap_ctls(intelhaddata, pcm);
 +	if (retval < 0)
  		goto err;
  
 -	ret = had_create_jack(ctx);
 -	if (ret < 0)
 -		goto err;
 +	intelhaddata->dev = &devptr->dev;
 +	pm_runtime_set_active(intelhaddata->dev);
 +	pm_runtime_enable(intelhaddata->dev);
  
++<<<<<<< HEAD
 +	*had_ret = intelhaddata;
++=======
+ 	ret = snd_card_register(card);
+ 	if (ret)
+ 		goto err;
+ 
+ 	spin_lock_irq(&pdata->lpe_audio_slock);
+ 	pdata->notify_audio_lpe = notify_audio_lpe;
+ 	pdata->notify_pending = false;
+ 	spin_unlock_irq(&pdata->lpe_audio_slock);
+ 
+ 	/* runtime PM isn't enabled as default, since it won't save much on
+ 	 * BYT/CHT devices; user who want the runtime PM should adjust the
+ 	 * power/ontrol and power/autosuspend_delay_ms sysfs entries instead
+ 	 */
+ 	pm_runtime_use_autosuspend(&pdev->dev);
+ 	pm_runtime_mark_last_busy(&pdev->dev);
+ 	pm_runtime_set_active(&pdev->dev);
+ 
+ 	dev_dbg(&pdev->dev, "%s: handle pending notification\n", __func__);
+ 	schedule_work(&ctx->hdmi_audio_wq);
++>>>>>>> 0b6b524f3915 (ALSA: x86: Don't enable runtime PM as default)
  
  	return 0;
 -
  err:
  	snd_card_free(card);
 -	return ret;
 +free_hadstream:
 +	kfree(had_stream);
 +	pm_runtime_disable(intelhaddata->dev);
 +	intelhaddata->dev = NULL;
 +free_haddata:
 +	kfree(intelhaddata);
 +	intelhaddata = NULL;
 +	pr_err("Error returned from %s api %#x\n", __func__, retval);
 +	return retval;
  }
  
  /*
* Unmerged path sound/x86/intel_hdmi_audio.c
