xfs: sanity check inode di_mode

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
commit-author Amir Goldstein <amir73il@gmail.com>
commit a324cbf10a3c67aaa10c9f47f7b5801562925bc2
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/a324cbf1.failed

Check for invalid file type in xfs_dinode_verify()
and fail to load the inode structure from disk.

	Reviewed-by: Darrick J. Wong <darrick.wong@oracle.com>
	Signed-off-by: Amir Goldstein <amir73il@gmail.com>
	Reviewed-by: Christoph Hellwig <hch@lst.de>
	Reviewed-by: Darrick J. Wong <darrick.wong@oracle.com>
	Signed-off-by: Darrick J. Wong <darrick.wong@oracle.com>
(cherry picked from commit a324cbf10a3c67aaa10c9f47f7b5801562925bc2)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	fs/xfs/libxfs/xfs_inode_buf.c
diff --cc fs/xfs/libxfs/xfs_inode_buf.c
index 24fbc95bc07a,d93f9d918cfc..000000000000
--- a/fs/xfs/libxfs/xfs_inode_buf.c
+++ b/fs/xfs/libxfs/xfs_inode_buf.c
@@@ -379,8 -398,12 +380,17 @@@ xfs_dinode_verify
  	if (be64_to_cpu(dip->di_size) & (1ULL << 63))
  		return false;
  
++<<<<<<< HEAD
 +	/* No zero-length symlinks. */
 +	if (S_ISLNK(be16_to_cpu(dip->di_mode)) && dip->di_size == 0)
++=======
+ 	mode = be16_to_cpu(dip->di_mode);
+ 	if (mode && xfs_mode_to_ftype(mode) == XFS_DIR3_FT_UNKNOWN)
+ 		return false;
+ 
+ 	/* No zero-length symlinks/dirs. */
+ 	if ((S_ISLNK(mode) || S_ISDIR(mode)) && dip->di_size == 0)
++>>>>>>> a324cbf10a3c (xfs: sanity check inode di_mode)
  		return false;
  
  	/* only version 3 or greater inodes are extensively verified here */
* Unmerged path fs/xfs/libxfs/xfs_inode_buf.c
