net: Remove fib_local variable

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
Rebuild_CHGLOG: - [net] ipv4: Remove fib_local variable (Ivan Vecera) [1464119]
Rebuild_FUZZ: 88.52%
commit-author David Ahern <dsa@cumulusnetworks.com>
commit 631fee7d70e8eabb642b4bcc58f08bbe880c91aa
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/631fee7d.failed

After commit 0ddcf43d5d4a ("ipv4: FIB Local/MAIN table collapse")
fib_local is set but not used. Remove it.

	Signed-off-by: David Ahern <dsa@cumulusnetworks.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 631fee7d70e8eabb642b4bcc58f08bbe880c91aa)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/ipv4/fib_frontend.c
diff --cc net/ipv4/fib_frontend.c
index 30f0d2b5e192,317c31939732..000000000000
--- a/net/ipv4/fib_frontend.c
+++ b/net/ipv4/fib_frontend.c
@@@ -126,6 -129,48 +123,51 @@@ struct fib_table *fib_get_table(struct 
  }
  #endif /* CONFIG_IP_MULTIPLE_TABLES */
  
++<<<<<<< HEAD
++=======
+ static void fib_replace_table(struct net *net, struct fib_table *old,
+ 			      struct fib_table *new)
+ {
+ #ifdef CONFIG_IP_MULTIPLE_TABLES
+ 	switch (new->tb_id) {
+ 	case RT_TABLE_MAIN:
+ 		rcu_assign_pointer(net->ipv4.fib_main, new);
+ 		break;
+ 	case RT_TABLE_DEFAULT:
+ 		rcu_assign_pointer(net->ipv4.fib_default, new);
+ 		break;
+ 	default:
+ 		break;
+ 	}
+ 
+ #endif
+ 	/* replace the old table in the hlist */
+ 	hlist_replace_rcu(&old->tb_hlist, &new->tb_hlist);
+ }
+ 
+ int fib_unmerge(struct net *net)
+ {
+ 	struct fib_table *old, *new;
+ 
+ 	/* attempt to fetch local table if it has been allocated */
+ 	old = fib_get_table(net, RT_TABLE_LOCAL);
+ 	if (!old)
+ 		return 0;
+ 
+ 	new = fib_trie_unmerge(old);
+ 	if (!new)
+ 		return -ENOMEM;
+ 
+ 	/* replace merged table with clean table */
+ 	if (new != old) {
+ 		fib_replace_table(net, old, new);
+ 		fib_free_table(old);
+ 	}
+ 
+ 	return 0;
+ }
+ 
++>>>>>>> 631fee7d70e8 (net: Remove fib_local variable)
  static void fib_flush(struct net *net)
  {
  	int flushed = 0;
@@@ -1136,7 -1242,10 +1178,14 @@@ static void ip_fib_net_exit(struct net 
  	unsigned int i;
  
  	rtnl_lock();
++<<<<<<< HEAD
 +
++=======
+ #ifdef CONFIG_IP_MULTIPLE_TABLES
+ 	RCU_INIT_POINTER(net->ipv4.fib_main, NULL);
+ 	RCU_INIT_POINTER(net->ipv4.fib_default, NULL);
+ #endif
++>>>>>>> 631fee7d70e8 (net: Remove fib_local variable)
  	for (i = 0; i < FIB_TABLE_HASHSZ; i++) {
  		struct hlist_head *head = &net->ipv4.fib_table_hash[i];
  		struct hlist_node *tmp;
diff --git a/include/net/netns/ipv4.h b/include/net/netns/ipv4.h
index 4b15ee83774e..2a68abcb5e1e 100644
--- a/include/net/netns/ipv4.h
+++ b/include/net/netns/ipv4.h
@@ -35,7 +35,6 @@ struct netns_ipv4 {
 #ifdef CONFIG_IP_MULTIPLE_TABLES
 	struct fib_rules_ops	*rules_ops;
 	bool			fib_has_custom_rules;
-	struct fib_table __rcu	*fib_local;
 	struct fib_table __rcu	*fib_main;
 	struct fib_table __rcu	*fib_default;
 #endif
* Unmerged path net/ipv4/fib_frontend.c
