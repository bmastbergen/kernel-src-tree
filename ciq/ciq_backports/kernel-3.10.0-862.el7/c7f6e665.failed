mlxsw: spectrum_router: Don't abort on l3mdev rules

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
commit-author Ido Schimmel <idosch@mellanox.com>
commit c7f6e6658b771c64a07b69852ac4362a8e781ab6
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/c7f6e665.failed

Now that port netdevs can be enslaved to a VRF master we need to make
sure the device's routing tables won't be flushed upon the insertion of
a l3mdev rule.

Note that we assume the notified l3mdev rule is a simple rule as used by
the VRF master. We don't check for the presence of other selectors such
as 'iif' and 'oif'.

	Signed-off-by: Ido Schimmel <idosch@mellanox.com>
	Signed-off-by: Jiri Pirko <jiri@mellanox.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit c7f6e6658b771c64a07b69852ac4362a8e781ab6)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/mellanox/mlxsw/spectrum_router.c
diff --cc drivers/net/ethernet/mellanox/mlxsw/spectrum_router.c
index a483082a16a0,488bc1fd7868..000000000000
--- a/drivers/net/ethernet/mellanox/mlxsw/spectrum_router.c
+++ b/drivers/net/ethernet/mellanox/mlxsw/spectrum_router.c
@@@ -2551,7 -2553,10 +2551,14 @@@ static void mlxsw_sp_router_fib_event_w
  		break;
  	case FIB_EVENT_RULE_ADD: /* fall through */
  	case FIB_EVENT_RULE_DEL:
++<<<<<<< HEAD
 +		mlxsw_sp_router_fib4_abort(mlxsw_sp);
++=======
+ 		rule = fib_work->fr_info.rule;
+ 		if (!fib4_rule_default(rule) && !rule->l3mdev)
+ 			mlxsw_sp_router_fib4_abort(mlxsw_sp);
+ 		fib_rule_put(rule);
++>>>>>>> c7f6e6658b77 (mlxsw: spectrum_router: Don't abort on l3mdev rules)
  		break;
  	case FIB_EVENT_NH_ADD: /* fall through */
  	case FIB_EVENT_NH_DEL:
* Unmerged path drivers/net/ethernet/mellanox/mlxsw/spectrum_router.c
