mlxsw: spectrum: Add FID miss trap

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
commit-author Jiri Pirko <jiri@mellanox.com>
commit 9d41accc1e917d071497d749e9686ba6db91517e
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/9d41accc.failed

When there is no FID set for a specific packet, the HW will drop it.
However, by default these packets are useful to be delivered to CPU as
it can inspect them and program HW accordingly. So add this trap.

This would only ever happen when port is enslaved to an OVS master.
Otherwise, packets would be dropped during VLAN / STP filtering,
before FID classification.

	Signed-off-by: Jiri Pirko <jiri@mellanox.com>
	Reviewed-by: Ido Schimmel <idosch@mellanox.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 9d41accc1e917d071497d749e9686ba6db91517e)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/mellanox/mlxsw/trap.h
diff --cc drivers/net/ethernet/mellanox/mlxsw/trap.h
index 7ab275deacac,e008fdbed20f..000000000000
--- a/drivers/net/ethernet/mellanox/mlxsw/trap.h
+++ b/drivers/net/ethernet/mellanox/mlxsw/trap.h
@@@ -54,6 -54,8 +54,11 @@@ enum 
  	MLXSW_TRAP_ID_IGMP_V2_REPORT = 0x32,
  	MLXSW_TRAP_ID_IGMP_V2_LEAVE = 0x33,
  	MLXSW_TRAP_ID_IGMP_V3_REPORT = 0x34,
++<<<<<<< HEAD
++=======
+ 	MLXSW_TRAP_ID_PKT_SAMPLE = 0x38,
+ 	MLXSW_TRAP_ID_FID_MISS = 0x3D,
++>>>>>>> 9d41accc1e91 (mlxsw: spectrum: Add FID miss trap)
  	MLXSW_TRAP_ID_ARPBC = 0x50,
  	MLXSW_TRAP_ID_ARPUC = 0x51,
  	MLXSW_TRAP_ID_MTUERROR = 0x52,
diff --git a/drivers/net/ethernet/mellanox/mlxsw/spectrum.c b/drivers/net/ethernet/mellanox/mlxsw/spectrum.c
index 7a7462d3c086..721d13cfe987 100644
--- a/drivers/net/ethernet/mellanox/mlxsw/spectrum.c
+++ b/drivers/net/ethernet/mellanox/mlxsw/spectrum.c
@@ -2895,6 +2895,7 @@ static const struct mlxsw_listener mlxsw_sp_listener[] = {
 	MLXSW_SP_RXL_NO_MARK(IGMP_V3_REPORT, TRAP_TO_CPU, IGMP, false),
 	MLXSW_SP_RXL_MARK(ARPBC, MIRROR_TO_CPU, ARP, false),
 	MLXSW_SP_RXL_MARK(ARPUC, MIRROR_TO_CPU, ARP, false),
+	MLXSW_SP_RXL_NO_MARK(FID_MISS, TRAP_TO_CPU, IP2ME, false),
 	/* L3 traps */
 	MLXSW_SP_RXL_NO_MARK(MTUERROR, TRAP_TO_CPU, ROUTER_EXP, false),
 	MLXSW_SP_RXL_NO_MARK(TTLERROR, TRAP_TO_CPU, ROUTER_EXP, false),
* Unmerged path drivers/net/ethernet/mellanox/mlxsw/trap.h
