scsi: qedf: Look at all descriptors when processing a clear virtual link.

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
Rebuild_CHGLOG: - [scsi] qedf: Look at all descriptors when processing a clear virtual link (Chad Dupuis) [1461960]
Rebuild_FUZZ: 94.96%
commit-author Chad Dupuis <chad.dupuis@cavium.com>
commit 53c51adbe6f83eba94fd39000f98cf4235a89e4c
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/53c51adb.failed

If there are multiple descriptors for a particular type in a clear virtual
link we receive, we will not process it correctly but rather take the last
value. This can cause us not to not flap the virtual link as the value from
the descriptors that we compare against the our stored FCF or fc_lport values
may not match.

Change this to do a comparison when processing the each descriptor instead of at
the end and then set a bool if we need to do the reset.

	Signed-off-by: Chad Dupuis <chad.dupuis@cavium.com>
	Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
(cherry picked from commit 53c51adbe6f83eba94fd39000f98cf4235a89e4c)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/scsi/qedf/qedf_fip.c
diff --cc drivers/scsi/qedf/qedf_fip.c
index 38c68acbaefa,64b04f245e15..000000000000
--- a/drivers/scsi/qedf/qedf_fip.c
+++ b/drivers/scsi/qedf/qedf_fip.c
@@@ -204,8 -201,10 +201,15 @@@ void qedf_fip_recv(struct qedf_ctx *qed
  			case FIP_DT_MAC:
  				mp = (struct fip_mac_desc *)desc;
  				QEDF_INFO(&(qedf->dbg_ctx), QEDF_LOG_LL2,
++<<<<<<< HEAD
 +				    "fd_mac=%pM.\n", __func__, mp->fd_mac);
 +				ether_addr_copy(cvl_mac, mp->fd_mac);
++=======
+ 				    "fd_mac=%pM\n", mp->fd_mac);
+ 				if (ether_addr_equal(mp->fd_mac,
+ 				    qedf->ctlr.sel_fcf->fcf_mac))
+ 					do_reset = true;
++>>>>>>> 53c51adbe6f8 (scsi: qedf: Look at all descriptors when processing a clear virtual link.)
  				break;
  			case FIP_DT_NAME:
  				wp = (struct fip_wwn_desc *)desc;
* Unmerged path drivers/scsi/qedf/qedf_fip.c
