IB/IPoIB: Introduce RDMA netdev interface and IPoIB structs

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
commit-author Niranjana Vishwanathapura <niranjana.vishwanathapura@intel.com>
commit f0ad83ac58468e3807e72e929317519b69bcde1c
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/f0ad83ac.failed

Add RDMA netdev interface to ib device structure allowing RDMA
netdev devices to be allocated by ib clients.

The idea is to allow to providers to optimize IPoIB data path.
New struct that includes functions and data member is exposed.
It exposes set of callback functions for handling data path flows
in IPoIB driver.

Each provider can support these set of functions in order
to optimize its specific data path, and let IPoIB to leverage
its data path.

There is an assumption, that providers should give the full set
of functions and not only part of them, in order to work properly.

	Signed-off-by: Erez Shitrit <erezsh@mellanox.com>
	Signed-off-by: Niranjana Vishwanathapura <niranjana.vishwanathapura@intel.com>
	Signed-off-by: Leon Romanovsky <leon@kernel.org>
	Signed-off-by: Doug Ledford <dledford@redhat.com>
(cherry picked from commit f0ad83ac58468e3807e72e929317519b69bcde1c)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	include/rdma/ib_verbs.h
diff --cc include/rdma/ib_verbs.h
index 7219dbdf47ee,16f15ea8606e..000000000000
--- a/include/rdma/ib_verbs.h
+++ b/include/rdma/ib_verbs.h
@@@ -1900,7 -1879,36 +1900,38 @@@ struct ib_port_immutable 
  	u32                           max_mad_size;
  };
  
++<<<<<<< HEAD
++=======
+ /* rdma netdev type - specifies protocol type */
+ enum rdma_netdev_t {
+ 	RDMA_NETDEV_OPA_VNIC,
+ 	RDMA_NETDEV_IPOIB,
+ };
+ 
+ /**
+  * struct rdma_netdev - rdma netdev
+  * For cases where netstack interfacing is required.
+  */
+ struct rdma_netdev {
+ 	void              *clnt_priv;
+ 	struct ib_device  *hca;
+ 	u8                 port_num;
+ 
+ 	/* control functions */
+ 	void (*set_id)(struct net_device *netdev, int id);
+ 	/* send packet */
+ 	int (*send)(struct net_device *dev, struct sk_buff *skb,
+ 		    struct ib_ah *address, u32 dqpn);
+ 	/* multicast */
+ 	int (*attach_mcast)(struct net_device *dev, struct ib_device *hca,
+ 			    union ib_gid *gid, u16 mlid,
+ 			    int set_qkey, u32 qkey);
+ 	int (*detach_mcast)(struct net_device *dev, struct ib_device *hca,
+ 			    union ib_gid *gid, u16 mlid);
+ };
+ 
++>>>>>>> f0ad83ac5846 (IB/IPoIB: Introduce RDMA netdev interface and IPoIB structs)
  struct ib_device {
 -	/* Do not access @dma_device directly from ULP nor from HW drivers. */
  	struct device                *dma_device;
  
  	char                          name[IB_DEVICE_NAME_MAX];
* Unmerged path include/rdma/ib_verbs.h
