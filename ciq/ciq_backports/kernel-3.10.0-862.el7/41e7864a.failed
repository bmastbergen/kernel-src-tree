x86/tsc: Drastically reduce the number of firmware bug warnings

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
Rebuild_CHGLOG: - [x86] tsc: Drastically reduce the number of firmware bug warnings (Frank Ramsay) [1526066]
Rebuild_FUZZ: 96.72%
commit-author mike.travis@hpe.com <mike.travis@hpe.com>
commit 41e7864ab5ce4ec36e89a9f55d8d9dfe19b0392c
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/41e7864a.failed

Prior to the TSC ADJUST MSR being available, the method to set TSC's in
sync with each other naturally caused a small skew between cpu threads.
This was NOT a firmware bug at the time so introducing a whole avalanche
of alarming warning messages might cause unnecessary concern and customer
complaints. (Example: >3000 msgs in a 32 socket Skylake system.)

Simply report the warning condition, if possible do the necessary fixes,
and move on.

	Signed-off-by: Mike Travis <mike.travis@hpe.com>
	Signed-off-by: Thomas Gleixner <tglx@linutronix.de>
	Reviewed-by: Dimitri Sivanich <dimitri.sivanich@hpe.com>
	Reviewed-by: Russ Anderson <russ.anderson@hpe.com>
	Reviewed-by: Peter Zijlstra <peterz@infradead.org>
	Cc: Prarit Bhargava <prarit@redhat.com>
	Cc: Andrew Banman <andrew.banman@hpe.com>
	Cc: Bin Gao <bin.gao@linux.intel.com>
Link: https://lkml.kernel.org/r/20171012163202.175062400@stormcage.americas.sgi.com

(cherry picked from commit 41e7864ab5ce4ec36e89a9f55d8d9dfe19b0392c)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/x86/kernel/tsc_sync.c
diff --cc arch/x86/kernel/tsc_sync.c
index 640b9d08cc09,26ba0530a8a7..000000000000
--- a/arch/x86/kernel/tsc_sync.c
+++ b/arch/x86/kernel/tsc_sync.c
@@@ -130,10 -177,9 +130,16 @@@ bool tsc_store_and_check_tsc_adjust(voi
  	 * Compare the boot value and complain if it differs in the
  	 * package.
  	 */
++<<<<<<< HEAD
 +	if (bootval != ref->bootval) {
 +		pr_warn("TSC ADJUST differs: Reference CPU%u: %lld CPU%u: %lld\n",
 +			refcpu, ref->bootval, cpu, bootval);
 +	}
++=======
+ 	if (bootval != ref->bootval)
+ 		printk_once(FW_BUG "TSC ADJUST differs within socket(s), fixing all errors\n");
+ 
++>>>>>>> 41e7864ab5ce (x86/tsc: Drastically reduce the number of firmware bug warnings)
  	/*
  	 * The TSC_ADJUST values in a package must be the same. If the boot
  	 * value on this newly upcoming CPU differs from the adjustment
* Unmerged path arch/x86/kernel/tsc_sync.c
