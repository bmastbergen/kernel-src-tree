i40evf: Add support for Adaptive Virtual Function

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
commit-author Preethi Banala <preethi.banala@intel.com>
commit abf709a1e7316b3f99647bb88c4031b1e62e1c75
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/abf709a1.failed

Add device ID define and mac_type assignment needed for
Adaptive Virtual Function (VF Base Mode Support).

Also, update version to v3.0.0 in order to indicate
clearly that this is the first driver supporting the AVF
device ID.

	Signed-off-by: Preethi Banala <preethi.banala@intel.com>
	Signed-off-by: Jesse Brandeburg <jesse.brandeburg@intel.com>
	Tested-by: Andrew Bowers <andrewx.bowers@intel.com>
	Signed-off-by: Jeff Kirsher <jeffrey.t.kirsher@intel.com>
(cherry picked from commit abf709a1e7316b3f99647bb88c4031b1e62e1c75)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/intel/Kconfig
diff --cc drivers/net/ethernet/intel/Kconfig
index d89f96325489,1feb54b6d92e..000000000000
--- a/drivers/net/ethernet/intel/Kconfig
+++ b/drivers/net/ethernet/intel/Kconfig
@@@ -291,29 -235,15 +291,37 @@@ config I40E_DC
  
  	  If unsure, say N.
  
 +config I40E_FCOE
 +	bool "Fibre Channel over Ethernet (FCoE)"
 +	default n
 +	depends on I40E && DCB && FCOE
 +	---help---
 +	  Say Y here if you want to use Fibre Channel over Ethernet (FCoE)
 +	  in the driver. This will create new netdev for exclusive FCoE
 +	  use with XL710 FCoE offloads enabled.
 +
 +	  If unsure, say N.
 +
  config I40EVF
- 	tristate "Intel(R) XL710 X710 Virtual Function Ethernet support"
+ 	tristate "Intel(R) Ethernet Adaptive Virtual Function support"
  	depends on PCI_MSI
  	---help---
++<<<<<<< HEAD
 +	  This driver supports Intel(R) XL710 and X710 virtual functions.
 +	  For more information on how to identify your adapter, go to the
 +	  Adapter & Driver ID Guide at:
 +
 +	  <http://support.intel.com/support/network/sb/CS-008441.htm>
 +
 +	  For general information and support, go to the Intel support
 +	  website at:
++=======
+ 	  This driver supports virtual functions for Intel XL710,
+ 	  X710, X722, and all devices advertising support for Intel
+ 	  Ethernet Adaptive Virtual Function devices. For more
+ 	  information on how to identify your adapter, go to the Adapter
+ 	  & Driver ID Guide that can be located at:
++>>>>>>> abf709a1e731 (i40evf: Add support for Adaptive Virtual Function)
  
  	  <http://support.intel.com>
  
* Unmerged path drivers/net/ethernet/intel/Kconfig
diff --git a/drivers/net/ethernet/intel/i40evf/i40e_common.c b/drivers/net/ethernet/intel/i40evf/i40e_common.c
index 6729624fda5b..bcaf4a690403 100644
--- a/drivers/net/ethernet/intel/i40evf/i40e_common.c
+++ b/drivers/net/ethernet/intel/i40evf/i40e_common.c
@@ -68,6 +68,7 @@ i40e_status i40e_set_mac_type(struct i40e_hw *hw)
 			break;
 		case I40E_DEV_ID_VF:
 		case I40E_DEV_ID_VF_HV:
+		case I40E_DEV_ID_ADAPTIVE_VF:
 			hw->mac.type = I40E_MAC_VF;
 			break;
 		default:
diff --git a/drivers/net/ethernet/intel/i40evf/i40e_devids.h b/drivers/net/ethernet/intel/i40evf/i40e_devids.h
index d76393c95056..0469e4bfd3ec 100644
--- a/drivers/net/ethernet/intel/i40evf/i40e_devids.h
+++ b/drivers/net/ethernet/intel/i40evf/i40e_devids.h
@@ -43,6 +43,7 @@
 #define I40E_DEV_ID_25G_SFP28		0x158B
 #define I40E_DEV_ID_VF			0x154C
 #define I40E_DEV_ID_VF_HV		0x1571
+#define I40E_DEV_ID_ADAPTIVE_VF		0x1889
 #define I40E_DEV_ID_SFP_X722		0x37D0
 #define I40E_DEV_ID_1G_BASE_T_X722	0x37D1
 #define I40E_DEV_ID_10G_BASE_T_X722	0x37D2
diff --git a/drivers/net/ethernet/intel/i40evf/i40evf_main.c b/drivers/net/ethernet/intel/i40evf/i40evf_main.c
index 92233e4beca5..81d3dccb6d42 100644
--- a/drivers/net/ethernet/intel/i40evf/i40evf_main.c
+++ b/drivers/net/ethernet/intel/i40evf/i40evf_main.c
@@ -44,9 +44,9 @@ static const char i40evf_driver_string[] =
 
 #define DRV_KERN "-k"
 
-#define DRV_VERSION_MAJOR 2
-#define DRV_VERSION_MINOR 1
-#define DRV_VERSION_BUILD 14
+#define DRV_VERSION_MAJOR 3
+#define DRV_VERSION_MINOR 0
+#define DRV_VERSION_BUILD 0
 #define DRV_VERSION __stringify(DRV_VERSION_MAJOR) "." \
 	     __stringify(DRV_VERSION_MINOR) "." \
 	     __stringify(DRV_VERSION_BUILD) \
@@ -67,6 +67,7 @@ static const struct pci_device_id i40evf_pci_tbl[] = {
 	{PCI_VDEVICE(INTEL, I40E_DEV_ID_VF), 0},
 	{PCI_VDEVICE(INTEL, I40E_DEV_ID_VF_HV), 0},
 	{PCI_VDEVICE(INTEL, I40E_DEV_ID_X722_VF), 0},
+	{PCI_VDEVICE(INTEL, I40E_DEV_ID_ADAPTIVE_VF), 0},
 	/* required last entry */
 	{0, }
 };
