x86/intel_rdt: Return error for incorrect resource names in schemata

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
Rebuild_CHGLOG: - [x86] intel_rdt: Return error for incorrect resource names in schemata (Jiri Olsa) [1379551]
Rebuild_FUZZ: 96.97%
commit-author Vikas Shivappa <vikas.shivappa@linux.intel.com>
commit 4797b7dfdfcf457075c36743d71e2b0feeaaa20f
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/4797b7df.failed

When schemata parses the resource names it does not return an error if it
detects incorrect resource names and fails quietly.

This happens because for_each_enabled_rdt_resource(r) leaves "r" pointing
beyond the end of the rdt_resources_all[] array, and the check for !r->name
results in an out of bounds access.

Split the resource parsing part into a helper function to avoid the issue.

[ tglx: Made it readable by splitting the parser loop out into a function ]

	Reported-by: Prakhya, Sai Praneeth <sai.praneeth.prakhya@intel.com>
	Signed-off-by: Vikas Shivappa <vikas.shivappa@linux.intel.com>
	Tested-by: Prakhya, Sai Praneeth <sai.praneeth.prakhya@intel.com>
	Cc: fenghua.yu@intel.com
	Cc: tony.luck@intel.com
	Cc: ravi.v.shankar@intel.com
	Cc: vikas.shivappa@intel.com
Link: http://lkml.kernel.org/r/1492645804-17465-4-git-send-email-vikas.shivappa@linux.intel.com
	Signed-off-by: Thomas Gleixner <tglx@linutronix.de>

(cherry picked from commit 4797b7dfdfcf457075c36743d71e2b0feeaaa20f)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/x86/kernel/cpu/intel_rdt_schemata.c
diff --cc arch/x86/kernel/cpu/intel_rdt_schemata.c
index 6efa856bc635,406d7a6532f9..000000000000
--- a/arch/x86/kernel/cpu/intel_rdt_schemata.c
+++ b/arch/x86/kernel/cpu/intel_rdt_schemata.c
@@@ -163,9 -221,10 +174,14 @@@ ssize_t rdtgroup_schemata_write(struct 
  
  	closid = rdtgrp->closid;
  
- 	for_each_enabled_rdt_resource(r)
+ 	for_each_enabled_rdt_resource(r) {
  		list_for_each_entry(dom, &r->domains, list)
++<<<<<<< HEAD
 +			dom->have_new_cbm = false;
++=======
+ 			dom->have_new_ctrl = false;
+ 	}
++>>>>>>> 4797b7dfdfcf (x86/intel_rdt: Return error for incorrect resource names in schemata)
  
  	while ((tok = strsep(&buf, "\n")) != NULL) {
  		resname = strim(strsep(&tok, ":"));
* Unmerged path arch/x86/kernel/cpu/intel_rdt_schemata.c
