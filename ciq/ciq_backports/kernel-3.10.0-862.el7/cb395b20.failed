net: sched: optimize class dumps

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
Rebuild_CHGLOG: - [net] sched: optimize class dumps (Ivan Vecera) [1445420]
Rebuild_FUZZ: 91.53%
commit-author Eric Dumazet <edumazet@google.com>
commit cb395b2010879a8461aa1b1c37025769708c32cf
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/cb395b20.failed

In commit 59cc1f61f09c ("net: sched: convert qdisc linked list to
hashtable") we missed the opportunity to considerably speed up
tc_dump_tclass_root() if a qdisc handle is provided by user.

Instead of iterating all the qdiscs, use qdisc_match_from_root()
to directly get the one we look for.

	Signed-off-by: Eric Dumazet <edumazet@google.com>
	Cc: Jiri Kosina <jkosina@suse.cz>
	Cc: Jamal Hadi Salim <jhs@mojatatu.com>
	Cc: Cong Wang <xiyou.wangcong@gmail.com>
	Cc: Jiri Pirko <jiri@resnulli.us>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit cb395b2010879a8461aa1b1c37025769708c32cf)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/sched/sch_api.c
diff --cc net/sched/sch_api.c
index ed3bc037a800,e88342fde1bc..000000000000
--- a/net/sched/sch_api.c
+++ b/net/sched/sch_api.c
@@@ -1781,7 -1828,16 +1781,20 @@@ static int tc_dump_tclass_root(struct Q
  	if (tc_dump_tclass_qdisc(root, skb, tcm, cb, t_p, s_t) < 0)
  		return -1;
  
++<<<<<<< HEAD
 +	list_for_each_entry(q, &root->list, list) {
++=======
+ 	if (!qdisc_dev(root))
+ 		return 0;
+ 
+ 	if (tcm->tcm_parent) {
+ 		q = qdisc_match_from_root(root, TC_H_MAJ(tcm->tcm_parent));
+ 		if (q && tc_dump_tclass_qdisc(q, skb, tcm, cb, t_p, s_t) < 0)
+ 			return -1;
+ 		return 0;
+ 	}
+ 	hash_for_each(qdisc_dev(root)->qdisc_hash, b, q, hash) {
++>>>>>>> cb395b201087 (net: sched: optimize class dumps)
  		if (tc_dump_tclass_qdisc(q, skb, tcm, cb, t_p, s_t) < 0)
  			return -1;
  	}
* Unmerged path net/sched/sch_api.c
