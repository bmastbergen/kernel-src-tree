genirq/affinity: Fix node generation from cpumask

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
commit-author Guilherme G. Piccoli <gpiccoli@linux.vnet.ibm.com>
commit c0af52437254fda8b0cdbaae5a9b6d9327f1fcd5
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/c0af5243.failed

Commit 34c3d9819fda ("genirq/affinity: Provide smarter irq spreading
infrastructure") introduced a better IRQ spreading mechanism, taking
account of the available NUMA nodes in the machine.

Problem is that the algorithm of retrieving the nodemask iterates
"linearly" based on the number of online nodes - some architectures
present non-linear node distribution among the nodemask, like PowerPC.
If this is the case, the algorithm lead to a wrong node count number
and therefore to a bad/incomplete IRQ affinity distribution.

For example, this problem were found in a machine with 128 CPUs and two
nodes, namely nodes 0 and 8 (instead of 0 and 1, if it was linearly
distributed). This led to a wrong affinity distribution which then led to
a bad mq allocation for nvme driver.

Finally, we take the opportunity to fix a comment regarding the affinity
distribution when we have _more_ nodes than vectors.

Fixes: 34c3d9819fda ("genirq/affinity: Provide smarter irq spreading infrastructure")
	Reported-by: Gabriel Krisman Bertazi <gabriel@krisman.be>
	Signed-off-by: Guilherme G. Piccoli <gpiccoli@linux.vnet.ibm.com>
	Reviewed-by: Christoph Hellwig <hch@lst.de>
	Reviewed-by: Gabriel Krisman Bertazi <gabriel@krisman.be>
	Reviewed-by: Gavin Shan <gwshan@linux.vnet.ibm.com>
	Cc: linux-pci@vger.kernel.org
	Cc: linuxppc-dev@lists.ozlabs.org
	Cc: hch@lst.de
Link: http://lkml.kernel.org/r/1481738472-2671-1-git-send-email-gpiccoli@linux.vnet.ibm.com
	Signed-off-by: Thomas Gleixner <tglx@linutronix.de>

(cherry picked from commit c0af52437254fda8b0cdbaae5a9b6d9327f1fcd5)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	kernel/irq/affinity.c
* Unmerged path kernel/irq/affinity.c
* Unmerged path kernel/irq/affinity.c
