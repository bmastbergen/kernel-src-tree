security/keys: add CONFIG_KEYS_COMPAT to Kconfig

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
Rebuild_CHGLOG: - [security] keys: add CONFIG_KEYS_COMPAT to Kconfig (David Howells) [1503242]
Rebuild_FUZZ: 89.66%
commit-author Bilal Amarni <bilal.amarni@gmail.com>
commit 47b2c3fff4932e6fc17ce13d51a43c6969714e20
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/47b2c3ff.failed

CONFIG_KEYS_COMPAT is defined in arch-specific Kconfigs and is missing for
several 64-bit architectures : mips, parisc, tile.

At the moment and for those architectures, calling in 32-bit userspace the
keyctl syscall would return an ENOSYS error.

This patch moves the CONFIG_KEYS_COMPAT option to security/keys/Kconfig, to
make sure the compatibility wrapper is registered by default for any 64-bit
architecture as long as it is configured with CONFIG_COMPAT.

[DH: Modified to remove arm64 compat enablement also as requested by Eric
 Biggers]

	Signed-off-by: Bilal Amarni <bilal.amarni@gmail.com>
	Signed-off-by: David Howells <dhowells@redhat.com>
	Reviewed-by: Arnd Bergmann <arnd@arndb.de>
cc: Eric Biggers <ebiggers3@gmail.com>
	Signed-off-by: James Morris <james.l.morris@oracle.com>
(cherry picked from commit 47b2c3fff4932e6fc17ce13d51a43c6969714e20)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/arm64/Kconfig
diff --cc arch/arm64/Kconfig
index 56b3f6d447ae,b2024db225a9..000000000000
--- a/arch/arm64/Kconfig
+++ b/arch/arm64/Kconfig
@@@ -227,6 -1084,31 +227,34 @@@ config SYSVIPC_COMPA
  	def_bool y
  	depends on COMPAT && SYSVIPC
  
++<<<<<<< HEAD
++=======
+ endmenu
+ 
+ menu "Power management options"
+ 
+ source "kernel/power/Kconfig"
+ 
+ config ARCH_HIBERNATION_POSSIBLE
+ 	def_bool y
+ 	depends on CPU_PM
+ 
+ config ARCH_HIBERNATION_HEADER
+ 	def_bool y
+ 	depends on HIBERNATION
+ 
+ config ARCH_SUSPEND_POSSIBLE
+ 	def_bool y
+ 
+ endmenu
+ 
+ menu "CPU Power Management"
+ 
+ source "drivers/cpuidle/Kconfig"
+ 
+ source "drivers/cpufreq/Kconfig"
+ 
++>>>>>>> 47b2c3fff493 (security/keys: add CONFIG_KEYS_COMPAT to Kconfig)
  endmenu
  
  source "net/Kconfig"
* Unmerged path arch/arm64/Kconfig
diff --git a/arch/powerpc/Kconfig b/arch/powerpc/Kconfig
index cae2cf0c3760..8ee139346332 100644
--- a/arch/powerpc/Kconfig
+++ b/arch/powerpc/Kconfig
@@ -1122,11 +1122,6 @@ source "arch/powerpc/Kconfig.debug"
 
 source "security/Kconfig"
 
-config KEYS_COMPAT
-	bool
-	depends on COMPAT && KEYS
-	default y
-
 source "crypto/Kconfig"
 
 config PPC_CLOCK
diff --git a/arch/s390/Kconfig b/arch/s390/Kconfig
index a9f2ba62baed..428051ec5768 100644
--- a/arch/s390/Kconfig
+++ b/arch/s390/Kconfig
@@ -351,9 +351,6 @@ config COMPAT
 config SYSVIPC_COMPAT
 	def_bool y if COMPAT && SYSVIPC
 
-config KEYS_COMPAT
-	def_bool y if COMPAT && KEYS
-
 config SMP
 	def_bool y
 	prompt "Symmetric multi-processing support"
diff --git a/arch/sparc/Kconfig b/arch/sparc/Kconfig
index 9ac9f1666339..c2464f842f19 100644
--- a/arch/sparc/Kconfig
+++ b/arch/sparc/Kconfig
@@ -535,9 +535,6 @@ config SYSVIPC_COMPAT
 	depends on COMPAT && SYSVIPC
 	default y
 
-config KEYS_COMPAT
-	def_bool y if COMPAT && KEYS
-
 endmenu
 
 source "net/Kconfig"
diff --git a/arch/x86/Kconfig b/arch/x86/Kconfig
index 0912e61d8b57..03cf276e6479 100644
--- a/arch/x86/Kconfig
+++ b/arch/x86/Kconfig
@@ -2547,10 +2547,6 @@ config COMPAT_FOR_U64_ALIGNMENT
 config SYSVIPC_COMPAT
 	def_bool y
 	depends on SYSVIPC
-
-config KEYS_COMPAT
-	def_bool y
-	depends on KEYS
 endif
 
 endmenu
diff --git a/security/keys/Kconfig b/security/keys/Kconfig
index f74355c8696c..97c7d1fb4cd4 100644
--- a/security/keys/Kconfig
+++ b/security/keys/Kconfig
@@ -20,6 +20,10 @@ config KEYS
 
 	  If you are unsure as to whether this is required, answer N.
 
+config KEYS_COMPAT
+	def_bool y
+	depends on COMPAT && KEYS
+
 config PERSISTENT_KEYRINGS
 	bool "Enable register of persistent per-UID keyrings"
 	depends on KEYS
