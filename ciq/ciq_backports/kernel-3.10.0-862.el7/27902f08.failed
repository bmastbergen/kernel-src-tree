net/mlx5e: Fix possible memory leak

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
Rebuild_CHGLOG: - [netdrv] mlx5e: Fix possible memory leak (Don Dutile) [1499363 1456694]
Rebuild_FUZZ: 93.94%
commit-author Wei Yongjun <weiyongjun1@huawei.com>
commit 27902f08065ba61514c331b7d6e85635c1655d82
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/27902f08.failed

'encap_header' is malloced and should be freed before leaving from
the error handling cases, otherwise it will cause memory leak.

Fixes: 232c001398ae ("net/mlx5e: Add support to neighbour update flow")
	Signed-off-by: Wei Yongjun <weiyongjun1@huawei.com>
	Reviewed-by: Yuval Shaia <yuval.shaia@oracle.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 27902f08065ba61514c331b7d6e85635c1655d82)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/mellanox/mlx5/core/en_tc.c
diff --cc drivers/net/ethernet/mellanox/mlx5/core/en_tc.c
index d3c637b0294b,a72ecbc27f85..000000000000
--- a/drivers/net/ethernet/mellanox/mlx5/core/en_tc.c
+++ b/drivers/net/ethernet/mellanox/mlx5/core/en_tc.c
@@@ -939,6 -1397,14 +939,17 @@@ static int mlx5e_create_encap_header_ip
  		break;
  	default:
  		err = -EOPNOTSUPP;
++<<<<<<< HEAD
++=======
+ 		goto destroy_neigh_entry;
+ 	}
+ 	e->encap_size = ipv4_encap_size;
+ 	e->encap_header = encap_header;
+ 
+ 	if (!(nud_state & NUD_VALID)) {
+ 		neigh_event_send(n, NULL);
+ 		err = -EAGAIN;
++>>>>>>> 27902f08065b (net/mlx5e: Fix possible memory leak)
  		goto out;
  	}
  
@@@ -1015,6 -1502,15 +1026,18 @@@ static int mlx5e_create_encap_header_ip
  		break;
  	default:
  		err = -EOPNOTSUPP;
++<<<<<<< HEAD
++=======
+ 		goto destroy_neigh_entry;
+ 	}
+ 
+ 	e->encap_size = ipv6_encap_size;
+ 	e->encap_header = encap_header;
+ 
+ 	if (!(nud_state & NUD_VALID)) {
+ 		neigh_event_send(n, NULL);
+ 		err = -EAGAIN;
++>>>>>>> 27902f08065b (net/mlx5e: Fix possible memory leak)
  		goto out;
  	}
  
* Unmerged path drivers/net/ethernet/mellanox/mlx5/core/en_tc.c
