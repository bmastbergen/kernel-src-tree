scsi: qla2xxx: Use flag PFLG_DISCONNECTED.

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
Rebuild_CHGLOG: - [scsi] qla2xxx: Use flag PFLG_DISCONNECTED (Himanshu Madhani) [1460030]
Rebuild_FUZZ: 90.91%
commit-author Sawan Chandak <sawan.chandak@cavium.com>
commit ba1758919906b1f04f239532e03b9fc5b49f3aa1
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/ba175891.failed

There is already flag defined PFLG_DISCONNECTED, which is set
for PCI or register disconnect error condition. There is no need to have
flag PCI_ERR, which has same purpose. Remove use of PCI_ERR flag and use
PFLG_DISCONNECTED flag during error condition.

	Signed-off-by: Sawan Chandak <sawan.chandak@cavium.com>
	Signed-off-by: Himanshu Madhani <himanshu.madhani@cavium.com>
	Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
(cherry picked from commit ba1758919906b1f04f239532e03b9fc5b49f3aa1)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/scsi/qla2xxx/qla_mbx.c
diff --cc drivers/scsi/qla2xxx/qla_mbx.c
index 21eee93873e8,fffa1f7cd8d2..000000000000
--- a/drivers/scsi/qla2xxx/qla_mbx.c
+++ b/drivers/scsi/qla2xxx/qla_mbx.c
@@@ -101,8 -123,9 +101,14 @@@ qla2x00_mailbox_command(scsi_qla_host_
  		return QLA_FUNCTION_TIMEOUT;
  	}
  
++<<<<<<< HEAD
 +	 /* if PCI error, then avoid mbx processing.*/
 +	 if (test_bit(PCI_ERR, &base_vha->dpc_flags)) {
++=======
+ 	/* if PCI error, then avoid mbx processing.*/
+ 	if (test_bit(PFLG_DISCONNECTED, &base_vha->dpc_flags) &&
+ 	    test_bit(UNLOADING, &base_vha->dpc_flags)) {
++>>>>>>> ba1758919906 (scsi: qla2xxx: Use flag PFLG_DISCONNECTED.)
  		ql_log(ql_log_warn, vha, 0x1191,
  		    "PCI error, exiting.\n");
  		return QLA_FUNCTION_TIMEOUT;
diff --git a/drivers/scsi/qla2xxx/qla_def.h b/drivers/scsi/qla2xxx/qla_def.h
index 3f28536dc812..32a519fc88f3 100644
--- a/drivers/scsi/qla2xxx/qla_def.h
+++ b/drivers/scsi/qla2xxx/qla_def.h
@@ -3619,7 +3619,6 @@ typedef struct scsi_qla_host {
 #define PFLG_DISCONNECTED	0	/* PCI device removed */
 #define PFLG_DRIVER_REMOVING	1	/* PCI driver .remove */
 #define PFLG_DRIVER_PROBING	2	/* PCI driver .probe */
-#define PCI_ERR			30
 
 	uint32_t	device_flags;
 #define SWITCH_FOUND		BIT_0
* Unmerged path drivers/scsi/qla2xxx/qla_mbx.c
