mlxsw: spectrum_router: Extract mlxsw_sp_fi_is_gateway()

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
commit-author Petr Machata <petrm@mellanox.com>
commit 9b01451ad5fe09d95aea9cfd5b36cde574651ab4
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/9b01451a.failed

For IPv4 IP-in-IP offload, routes that direct traffic to IP-in-IP
devices need to be considered gateway routes as well. That involves a
bit more logic, so extract the current test to a separate function,
where the logic can be later added.

	Signed-off-by: Petr Machata <petrm@mellanox.com>
	Reviewed-by: Ido Schimmel <idosch@mellanox.com>
	Signed-off-by: Jiri Pirko <jiri@mellanox.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 9b01451ad5fe09d95aea9cfd5b36cde574651ab4)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/mellanox/mlxsw/spectrum_router.c
diff --cc drivers/net/ethernet/mellanox/mlxsw/spectrum_router.c
index 2055c8543e7b,04e188772109..000000000000
--- a/drivers/net/ethernet/mellanox/mlxsw/spectrum_router.c
+++ b/drivers/net/ethernet/mellanox/mlxsw/spectrum_router.c
@@@ -1711,8 -2382,14 +1711,14 @@@ static void mlxsw_sp_nexthop_rif_gone_s
  	}
  }
  
+ static bool mlxsw_sp_fi_is_gateway(const struct mlxsw_sp *mlxsw_sp,
+ 				   const struct fib_info *fi)
+ {
+ 	return fi->fib_nh->nh_scope == RT_SCOPE_LINK;
+ }
+ 
  static struct mlxsw_sp_nexthop_group *
 -mlxsw_sp_nexthop4_group_create(struct mlxsw_sp *mlxsw_sp, struct fib_info *fi)
 +mlxsw_sp_nexthop_group_create(struct mlxsw_sp *mlxsw_sp, struct fib_info *fi)
  {
  	struct mlxsw_sp_nexthop_group *nh_grp;
  	struct mlxsw_sp_nexthop *nh;
@@@ -1726,10 -2403,12 +1732,16 @@@
  	nh_grp = kzalloc(alloc_size, GFP_KERNEL);
  	if (!nh_grp)
  		return ERR_PTR(-ENOMEM);
 -	nh_grp->priv = fi;
  	INIT_LIST_HEAD(&nh_grp->fib_list);
++<<<<<<< HEAD
 +	nh_grp->gateway = fi->fib_nh->nh_scope == RT_SCOPE_LINK;
++=======
+ 	nh_grp->neigh_tbl = &arp_tbl;
+ 
+ 	nh_grp->gateway = mlxsw_sp_fi_is_gateway(mlxsw_sp, fi);
++>>>>>>> 9b01451ad5fe (mlxsw: spectrum_router: Extract mlxsw_sp_fi_is_gateway())
  	nh_grp->count = fi->fib_nhs;
 +	nh_grp->key.fi = fi;
  	fib_info_hold(fi);
  	for (i = 0; i < nh_grp->count; i++) {
  		nh = &nh_grp->nexthops[i];
* Unmerged path drivers/net/ethernet/mellanox/mlxsw/spectrum_router.c
