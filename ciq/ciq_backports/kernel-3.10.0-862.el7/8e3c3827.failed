dm cache: pass cache structure to mode functions

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
commit-author Mike Snitzer <snitzer@redhat.com>
commit 8e3c3827776fc93728c0c8d7c7b731226dc6ee23
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/8e3c3827.failed

No functional changes, just a bit cleaner than passing cache_features
structure.

	Signed-off-by: Mike Snitzer <snitzer@redhat.com>
(cherry picked from commit 8e3c3827776fc93728c0c8d7c7b731226dc6ee23)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/md/dm-cache-target.c
diff --cc drivers/md/dm-cache-target.c
index 9a1cc393163a,04ffae7b2301..000000000000
--- a/drivers/md/dm-cache-target.c
+++ b/drivers/md/dm-cache-target.c
@@@ -1201,6 -1201,18 +1201,21 @@@ static void background_work_end(struct 
  
  /*----------------------------------------------------------------*/
  
++<<<<<<< HEAD
++=======
+ static bool bio_writes_complete_block(struct cache *cache, struct bio *bio)
+ {
+ 	return (bio_data_dir(bio) == WRITE) &&
+ 		(bio->bi_iter.bi_size == (cache->sectors_per_block << SECTOR_SHIFT));
+ }
+ 
+ static bool optimisable_bio(struct cache *cache, struct bio *bio, dm_oblock_t block)
+ {
+ 	return writeback_mode(cache) &&
+ 		(is_discarded_oblock(cache, block) || bio_writes_complete_block(cache, bio));
+ }
+ 
++>>>>>>> 8e3c3827776f (dm cache: pass cache structure to mode functions)
  static void quiesce(struct dm_cache_migration *mg,
  		    void (*continuation)(struct work_struct *))
  {
* Unmerged path drivers/md/dm-cache-target.c
