mlxsw: spectrum_router: Don't check state when refreshing offload indication

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
commit-author Ido Schimmel <idosch@mellanox.com>
commit 1353ee707362478527d54cd0b25d3ac17c47168d
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/1353ee70.failed

Previous patch removed the reliance on the counter in the FIB info to
set the offload indication, so we no longer need to keep an offload
state on each FIB entry and can just set or unset the RTNH_F_OFFLOAD
flag in each nexthop.

This is also necessary because we're going to need to refresh the
offload indication whenever the nexthop group associated with the FIB
entry is refreshed. Current check would prevent us from marking a newly
resolved nexthop as offloaded if the FIB entry is already marked as
offloaded.

	Signed-off-by: Ido Schimmel <idosch@mellanox.com>
	Signed-off-by: Jiri Pirko <jiri@mellanox.com>
	Tested-by: David Ahern <dsahern@gmail.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 1353ee707362478527d54cd0b25d3ac17c47168d)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/mellanox/mlxsw/spectrum_router.c
diff --cc drivers/net/ethernet/mellanox/mlxsw/spectrum_router.c
index 8985e26f4eb7,40aecbc116ac..000000000000
--- a/drivers/net/ethernet/mellanox/mlxsw/spectrum_router.c
+++ b/drivers/net/ethernet/mellanox/mlxsw/spectrum_router.c
@@@ -139,7 -388,16 +139,20 @@@ struct mlxsw_sp_fib_node 
  	struct mlxsw_sp_fib_key key;
  };
  
++<<<<<<< HEAD
 +struct mlxsw_sp_fib_entry_params {
++=======
+ struct mlxsw_sp_fib_entry {
+ 	struct list_head list;
+ 	struct mlxsw_sp_fib_node *fib_node;
+ 	enum mlxsw_sp_fib_entry_type type;
+ 	struct list_head nexthop_group_node;
+ 	struct mlxsw_sp_nexthop_group *nh_group;
+ };
+ 
+ struct mlxsw_sp_fib4_entry {
+ 	struct mlxsw_sp_fib_entry common;
++>>>>>>> 1353ee707362 (mlxsw: spectrum_router: Don't check state when refreshing offload indication)
  	u32 tb_id;
  	u32 prio;
  	u8 tos;
* Unmerged path drivers/net/ethernet/mellanox/mlxsw/spectrum_router.c
