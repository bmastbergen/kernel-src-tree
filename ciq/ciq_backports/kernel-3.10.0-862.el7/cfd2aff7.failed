scsi: mpt: Move scsi_remove_host() out of mptscsih_remove_host()

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
commit-author Hannes Reinecke <hare@suse.de>
commit cfd2aff711aa9de301258d322a0b5a3c64010220
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/cfd2aff7.failed

Commit c5ce0abeb628 ("scsi: sas: move scsi_remove_host call...")  moved
the call to scsi_remove_host() into sas_remove_host(), but forgot to
modify the mpt drivers.

Fixes: c5ce0abeb628 ("scsi: sas: move scsi_remove_host call into sas_remove_host")
	Signed-off-by: Hannes Reinecke <hare@suse.com>
	Reviewed-by: Christoph Hellwig <hch@lst.de>
	Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
(cherry picked from commit cfd2aff711aa9de301258d322a0b5a3c64010220)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/message/fusion/mptfc.c
diff --cc drivers/message/fusion/mptfc.c
index 02a3eefd6931,d065062240bc..000000000000
--- a/drivers/message/fusion/mptfc.c
+++ b/drivers/message/fusion/mptfc.c
@@@ -1325,9 -1325,12 +1325,18 @@@ mptfc_probe(struct pci_dev *pdev, cons
  	snprintf(ioc->fc_rescan_work_q_name, sizeof(ioc->fc_rescan_work_q_name),
  		 "mptfc_wq_%d", sh->host_no);
  	ioc->fc_rescan_work_q =
++<<<<<<< HEAD
 +		create_singlethread_workqueue(ioc->fc_rescan_work_q_name);
 +	if (!ioc->fc_rescan_work_q)
 +		goto out_mptfc_probe;
++=======
+ 		alloc_ordered_workqueue(ioc->fc_rescan_work_q_name,
+ 					WQ_MEM_RECLAIM);
+ 	if (!ioc->fc_rescan_work_q) {
+ 		error = -ENOMEM;
+ 		goto out_mptfc_host;
+ 	}
++>>>>>>> cfd2aff711aa (scsi: mpt: Move scsi_remove_host() out of mptscsih_remove_host())
  
  	/*
  	 *  Pre-fetch FC port WWN and stuff...
* Unmerged path drivers/message/fusion/mptfc.c
diff --git a/drivers/message/fusion/mptscsih.c b/drivers/message/fusion/mptscsih.c
index 2a1c6f21af27..bd8490117555 100644
--- a/drivers/message/fusion/mptscsih.c
+++ b/drivers/message/fusion/mptscsih.c
@@ -1176,8 +1176,6 @@ mptscsih_remove(struct pci_dev *pdev)
 	MPT_SCSI_HOST		*hd;
 	int sz1;
 
-	scsi_remove_host(host);
-
 	if((hd = shost_priv(host)) == NULL)
 		return;
 
diff --git a/drivers/message/fusion/mptspi.c b/drivers/message/fusion/mptspi.c
index 63ddaf842893..382804903d6e 100644
--- a/drivers/message/fusion/mptspi.c
+++ b/drivers/message/fusion/mptspi.c
@@ -1544,11 +1544,19 @@ out_mptspi_probe:
 	return error;
 }
 
+static void mptspi_remove(struct pci_dev *pdev)
+{
+	MPT_ADAPTER *ioc = pci_get_drvdata(pdev);
+
+	scsi_remove_host(ioc->sh);
+	mptscsih_remove(pdev);
+}
+
 static struct pci_driver mptspi_driver = {
 	.name		= "mptspi",
 	.id_table	= mptspi_pci_table,
 	.probe		= mptspi_probe,
-	.remove		= mptscsih_remove,
+	.remove		= mptspi_remove,
 	.shutdown	= mptscsih_shutdown,
 #ifdef CONFIG_PM
 	.suspend	= mptscsih_suspend,
