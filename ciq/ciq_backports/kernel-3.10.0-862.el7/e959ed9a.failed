scsi_dh: add a common helper to get a scsi_device from a request_queue

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
Rebuild_CHGLOG: - [scsi] dh: add a common helper to get a scsi_device from a request_queue (Mike Snitzer) [1546212]
Rebuild_FUZZ: 96.30%
commit-author Christoph Hellwig <hch@lst.de>
commit e959ed9a44c5239863ca6db42cb37130bee3c7a3
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/e959ed9a.failed

And cleanup the various messy opencoded versions of this.  Note that this
moves the sdev_state checks outside the queue_lock coverage, but as
we don't hold the lock over the activation they are only advisory anyway.

	Signed-off-by: Christoph Hellwig <hch@lst.de>
	Reviewed-by: Martin K. Petersen <martin.petersen@oracle.com>
	Reviewed-by: Hannes Reinecke <hare@suse.de>
	Signed-off-by: James Bottomley <JBottomley@Odin.com>
(cherry picked from commit e959ed9a44c5239863ca6db42cb37130bee3c7a3)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/scsi/scsi_dh.c
* Unmerged path drivers/scsi/scsi_dh.c
* Unmerged path drivers/scsi/scsi_dh.c
