netvsc: fix error unwind on device setup failure

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
commit-author stephen hemminger <stephen@networkplumber.org>
commit 493933472d33d3e82d6323842edeb281199ee430
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/49393347.failed

If setting receive buffer fails, the error unwind would cause
kernel panic because it was not correctly doing RCU and NAPI
unwind.  RCU'd pointer needs to be reset to NULL, and NAPI needs
to be disabled not deleted.

	Signed-off-by: Stephen Hemminger <sthemmin@microsoft.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 493933472d33d3e82d6323842edeb281199ee430)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/hyperv/netvsc.c
diff --cc drivers/net/hyperv/netvsc.c
index 52667f48ba1c,db95487807fd..000000000000
--- a/drivers/net/hyperv/netvsc.c
+++ b/drivers/net/hyperv/netvsc.c
@@@ -1393,9 -1304,12 +1393,15 @@@ int netvsc_device_add(struct hv_device 
  		goto close;
  	}
  
 -	return net_device;
 +	return ret;
  
  close:
++<<<<<<< HEAD
++=======
+ 	RCU_INIT_POINTER(net_device_ctx->nvdev, NULL);
+ 	napi_disable(&net_device->chan_table[0].napi);
+ 
++>>>>>>> 493933472d33 (netvsc: fix error unwind on device setup failure)
  	/* Now, we can close the channel safely */
  	vmbus_close(device->channel);
  
* Unmerged path drivers/net/hyperv/netvsc.c
