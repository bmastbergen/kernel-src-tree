x86: Use new cache mode type in track_pfn_remap() and track_pfn_insert()

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
Rebuild_CHGLOG: - [x86] Use new cache mode type in track_pfn_remap() and track_pfn_insert() (Suravee Suthikulpanit) [1361287]
Rebuild_FUZZ: 96.40%
commit-author Juergen Gross <jgross@suse.com>
commit 2a3746984c98b17b565e6a2c2bbaaaef757db1b4
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/2a374698.failed

Instead of directly using the cache mode bits in the pte switch to
using the cache mode type. As those are the main callers of
lookup_memtype(), change this as well.

Based-on-patch-by: Stefan Bader <stefan.bader@canonical.com>
	Signed-off-by: Juergen Gross <jgross@suse.com>
	Reviewed-by: Thomas Gleixner <tglx@linutronix.de>
	Cc: stefan.bader@canonical.com
	Cc: xen-devel@lists.xensource.com
	Cc: konrad.wilk@oracle.com
	Cc: ville.syrjala@linux.intel.com
	Cc: david.vrabel@citrix.com
	Cc: jbeulich@suse.com
	Cc: toshi.kani@hp.com
	Cc: plagnioj@jcrosoft.com
	Cc: tomi.valkeinen@ti.com
	Cc: bhelgaas@google.com
Link: http://lkml.kernel.org/r/1415019724-4317-10-git-send-email-jgross@suse.com
	Signed-off-by: Thomas Gleixner <tglx@linutronix.de>
(cherry picked from commit 2a3746984c98b17b565e6a2c2bbaaaef757db1b4)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/x86/mm/pat.c
diff --cc arch/x86/mm/pat.c
index 25b8aa9d4620,2f3744fdc741..000000000000
--- a/arch/x86/mm/pat.c
+++ b/arch/x86/mm/pat.c
@@@ -754,17 -751,17 +754,21 @@@ int track_pfn_remap(struct vm_area_stru
  }
  
  int track_pfn_insert(struct vm_area_struct *vma, pgprot_t *prot,
 -		     unsigned long pfn)
 +		     pfn_t pfn)
  {
- 	unsigned long flags;
+ 	enum page_cache_mode pcm;
  
  	if (!pat_enabled)
  		return 0;
  
  	/* Set prot based on lookup */
++<<<<<<< HEAD
 +	flags = lookup_memtype(pfn_t_to_phys(pfn));
++=======
+ 	pcm = lookup_memtype((resource_size_t)pfn << PAGE_SHIFT);
++>>>>>>> 2a3746984c98 (x86: Use new cache mode type in track_pfn_remap() and track_pfn_insert())
  	*prot = __pgprot((pgprot_val(vma->vm_page_prot) & (~_PAGE_CACHE_MASK)) |
- 			 flags);
+ 			 cachemode2protval(pcm));
  
  	return 0;
  }
* Unmerged path arch/x86/mm/pat.c
