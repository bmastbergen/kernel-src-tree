net: aquantia: Fixed transient link up/down/up notification

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
Rebuild_CHGLOG: - [netdrv] aquantia: Fixed transient link up/down/up notification (David Arcari) [1505539]
Rebuild_FUZZ: 95.58%
commit-author Igor Russkikh <igor.russkikh@aquantia.com>
commit 93d87b8fbe6cf17f0ad9552a934b5a6623ccd7d1
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/93d87b8f.failed

When doing ifconfig down/up, driver did not reported carrier_off neither
in nic_stop nor in nic_start. That caused link to be visible as "up"
during couple of seconds immediately after "ifconfig up".

	Signed-off-by: Pavel Belous <pavel.belous@aquantia.com>
	Signed-off-by: Igor Russkikh <igor.russkikh@aquantia.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 93d87b8fbe6cf17f0ad9552a934b5a6623ccd7d1)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/aquantia/atlantic/aq_nic.c
diff --cc drivers/net/ethernet/aquantia/atlantic/aq_nic.c
index ed836cc6597f,9378b4877783..000000000000
--- a/drivers/net/ethernet/aquantia/atlantic/aq_nic.c
+++ b/drivers/net/ethernet/aquantia/atlantic/aq_nic.c
@@@ -322,12 -335,9 +322,18 @@@ struct aq_nic_s *aq_nic_alloc_hot(struc
  		err = -EINVAL;
  		goto err_exit;
  	}
++<<<<<<< HEAD
 +	if (netif_running(ndev)) {
 +		unsigned int i;
 +
 +		for (i = AQ_CFG_VECS_MAX; i--;)
 +			netif_stop_subqueue(ndev, i);
 +	}
++=======
+ 	if (netif_running(ndev))
+ 		netif_tx_disable(ndev);
+ 	netif_carrier_off(self->ndev);
++>>>>>>> 93d87b8fbe6c (net: aquantia: Fixed transient link up/down/up notification)
  
  	for (self->aq_vecs = 0; self->aq_vecs < self->aq_nic_cfg.vecs;
  		self->aq_vecs++) {
@@@ -905,9 -902,8 +911,14 @@@ int aq_nic_stop(struct aq_nic_s *self
  	struct aq_vec_s *aq_vec = NULL;
  	unsigned int i = 0U;
  
++<<<<<<< HEAD
 +	for (i = 0U, aq_vec = self->aq_vec[0];
 +		self->aq_vecs > i; ++i, aq_vec = self->aq_vec[i])
 +		aq_nic_ndev_queue_stop(self, i);
++=======
+ 	netif_tx_disable(self->ndev);
+ 	netif_carrier_off(self->ndev);
++>>>>>>> 93d87b8fbe6c (net: aquantia: Fixed transient link up/down/up notification)
  
  	del_timer_sync(&self->service_timer);
  
* Unmerged path drivers/net/ethernet/aquantia/atlantic/aq_nic.c
