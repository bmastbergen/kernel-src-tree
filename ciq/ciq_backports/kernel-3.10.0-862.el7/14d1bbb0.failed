NFS: Create a common nfs4_match_client() function

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
commit-author Anna Schumaker <Anna.Schumaker@Netapp.com>
commit 14d1bbb0ca425c4fdd9a38eaac346c028661b752
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/14d1bbb0.failed

This puts all the common code in a single place for the
walk_client_list() functions.

	Signed-off-by: Anna Schumaker <Anna.Schumaker@Netapp.com>
	Signed-off-by: Trond Myklebust <trond.myklebust@primarydata.com>
(cherry picked from commit 14d1bbb0ca425c4fdd9a38eaac346c028661b752)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	fs/nfs/nfs4client.c
diff --cc fs/nfs/nfs4client.c
index f08b7f95dabd,8853c32eedf5..000000000000
--- a/fs/nfs/nfs4client.c
+++ b/fs/nfs/nfs4client.c
@@@ -742,33 -726,10 +764,40 @@@ int nfs41_walk_client_list(struct nfs_c
  		if (pos == new)
  			goto found;
  
++<<<<<<< HEAD
 +		if (pos->rpc_ops != new->rpc_ops)
 +			continue;
 +
 +		if (pos->cl_minorversion != new->cl_minorversion)
 +			continue;
 +
 +		/* If "pos" isn't marked ready, we can't trust the
 +		 * remaining fields in "pos", especially the client
 +		 * ID and serverowner fields.  Wait for CREATE_SESSION
 +		 * to finish. */
 +		if (pos->cl_cons_state > NFS_CS_READY) {
 +			atomic_inc(&pos->cl_count);
 +			spin_unlock(&nn->nfs_client_lock);
 +
 +			nfs_put_client(prev);
 +			prev = pos;
 +
 +			status = nfs_wait_client_init_complete(pos);
 +			spin_lock(&nn->nfs_client_lock);
 +			if (status < 0)
 +				break;
 +			status = -NFS4ERR_STALE_CLIENTID;
 +		}
 +		if (pos->cl_cons_state != NFS_CS_READY)
 +			continue;
 +
 +		if (!nfs4_match_clientids(pos->cl_clientid, new->cl_clientid))
++=======
+ 		status = nfs4_match_client(pos, new, &prev, nn);
+ 		if (status < 0)
+ 			goto out;
+ 		if (status != 0)
++>>>>>>> 14d1bbb0ca42 (NFS: Create a common nfs4_match_client() function)
  			continue;
  
  		/*
* Unmerged path fs/nfs/nfs4client.c
