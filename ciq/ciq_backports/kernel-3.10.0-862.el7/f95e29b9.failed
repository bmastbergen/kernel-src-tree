drm/i915: Pass pipe to LPE audio notification

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
Rebuild_CHGLOG: - [sound] alsa: drm/i915: Pass pipe to LPE audio notification (Jaroslav Kysela) [1463624]
Rebuild_FUZZ: 93.75%
commit-author Takashi Iwai <tiwai@suse.de>
commit f95e29b92190607c66dc5c96b7e0de9c332062c2
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/f95e29b9.failed

The LPE audio configuration depends on the pipe, thus we need to pass
the currently used pipe.  It's now embedded in struct
intel_hdmi_lpe_audio_eld as well as port id.

	Acked-by: Ville Syrjälä <ville.syrjala@linux.intel.com>
	Signed-off-by: Takashi Iwai <tiwai@suse.de>
(cherry picked from commit f95e29b92190607c66dc5c96b7e0de9c332062c2)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/gpu/drm/i915/i915_drv.h
#	drivers/gpu/drm/i915/intel_audio.c
#	drivers/gpu/drm/i915/intel_lpe_audio.c
#	include/drm/intel_lpe_audio.h
diff --cc drivers/gpu/drm/i915/i915_drv.h
index c383dcb3961f,27311a337e2b..000000000000
--- a/drivers/gpu/drm/i915/i915_drv.h
+++ b/drivers/gpu/drm/i915/i915_drv.h
@@@ -3388,6 -3396,14 +3388,17 @@@ extern int i915_restore_state(struct dr
  void i915_setup_sysfs(struct drm_i915_private *dev_priv);
  void i915_teardown_sysfs(struct drm_i915_private *dev_priv);
  
++<<<<<<< HEAD
++=======
+ /* intel_lpe_audio.c */
+ int  intel_lpe_audio_init(struct drm_i915_private *dev_priv);
+ void intel_lpe_audio_teardown(struct drm_i915_private *dev_priv);
+ void intel_lpe_audio_irq_handler(struct drm_i915_private *dev_priv);
+ void intel_lpe_audio_notify(struct drm_i915_private *dev_priv,
+ 			    void *eld, int port, int pipe, int tmds_clk_speed,
+ 			    bool dp_output, int link_rate);
+ 
++>>>>>>> f95e29b92190 (drm/i915: Pass pipe to LPE audio notification)
  /* intel_i2c.c */
  extern int intel_setup_gmbus(struct drm_device *dev);
  extern void intel_teardown_gmbus(struct drm_device *dev);
diff --cc drivers/gpu/drm/i915/intel_audio.c
index 49f10538d4aa,892169b7952b..000000000000
--- a/drivers/gpu/drm/i915/intel_audio.c
+++ b/drivers/gpu/drm/i915/intel_audio.c
@@@ -623,13 -624,28 +623,32 @@@ void intel_audio_codec_enable(struct in
  	dev_priv->av_enc_map[pipe] = intel_encoder;
  	mutex_unlock(&dev_priv->av_mutex);
  
 -	if (acomp && acomp->audio_ops && acomp->audio_ops->pin_eld_notify) {
 -		/* audio drivers expect pipe = -1 to indicate Non-MST cases */
 -		if (intel_encoder->type != INTEL_OUTPUT_DP_MST)
 -			pipe = -1;
 +	/* audio drivers expect pipe = -1 to indicate Non-MST cases */
 +	if (intel_encoder->type != INTEL_OUTPUT_DP_MST)
 +		pipe = -1;
 +
 +	if (acomp && acomp->audio_ops && acomp->audio_ops->pin_eld_notify)
  		acomp->audio_ops->pin_eld_notify(acomp->audio_ops->audio_ptr,
  						 (int) port, (int) pipe);
++<<<<<<< HEAD
++=======
+ 	}
+ 
+ 	switch (intel_encoder->type) {
+ 	case INTEL_OUTPUT_HDMI:
+ 		intel_lpe_audio_notify(dev_priv, connector->eld, port, pipe,
+ 				       crtc_state->port_clock,
+ 				       false, 0);
+ 		break;
+ 	case INTEL_OUTPUT_DP:
+ 		intel_lpe_audio_notify(dev_priv, connector->eld, port, pipe,
+ 				       adjusted_mode->crtc_clock,
+ 				       true, crtc_state->port_clock);
+ 		break;
+ 	default:
+ 		break;
+ 	}
++>>>>>>> f95e29b92190 (drm/i915: Pass pipe to LPE audio notification)
  }
  
  /**
@@@ -656,13 -672,15 +675,19 @@@ void intel_audio_codec_disable(struct i
  	dev_priv->av_enc_map[pipe] = NULL;
  	mutex_unlock(&dev_priv->av_mutex);
  
 -	if (acomp && acomp->audio_ops && acomp->audio_ops->pin_eld_notify) {
 -		/* audio drivers expect pipe = -1 to indicate Non-MST cases */
 -		if (intel_encoder->type != INTEL_OUTPUT_DP_MST)
 -			pipe = -1;
 +	/* audio drivers expect pipe = -1 to indicate Non-MST cases */
 +	if (intel_encoder->type != INTEL_OUTPUT_DP_MST)
 +		pipe = -1;
 +
 +	if (acomp && acomp->audio_ops && acomp->audio_ops->pin_eld_notify)
  		acomp->audio_ops->pin_eld_notify(acomp->audio_ops->audio_ptr,
  						 (int) port, (int) pipe);
++<<<<<<< HEAD
++=======
+ 	}
+ 
+ 	intel_lpe_audio_notify(dev_priv, NULL, port, pipe, 0, false, 0);
++>>>>>>> f95e29b92190 (drm/i915: Pass pipe to LPE audio notification)
  }
  
  /**
* Unmerged path drivers/gpu/drm/i915/intel_lpe_audio.c
* Unmerged path include/drm/intel_lpe_audio.h
* Unmerged path drivers/gpu/drm/i915/i915_drv.h
* Unmerged path drivers/gpu/drm/i915/intel_audio.c
* Unmerged path drivers/gpu/drm/i915/intel_lpe_audio.c
* Unmerged path include/drm/intel_lpe_audio.h
