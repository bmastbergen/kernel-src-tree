x86/vmware: Skip timer_irq_works() check on VMware

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
commit-author Renat Valiullin <rvaliullin@vmware.com>
commit 854dd54245f7f1b1175b1bada613929396a571be
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/854dd542.failed

The timer_irq_works() boot check may sometimes fail in a VM, when
the Host is overcommitted or when the Guest is running nested.

Since the intended check is unnecessary on VMware's virtual
hardware, by-pass it.

	Signed-off-by: Renat Valiullin <rvaliullin@vmware.com>
	Acked-by: Alok N Kataria <akataria@vmware.com>
	Cc: virtualization@lists.linux-foundation.org
Link: http://lkml.kernel.org/r/20161013184539.GA11497@rvaliullin-vm
	Signed-off-by: Thomas Gleixner <tglx@linutronix.de>

(cherry picked from commit 854dd54245f7f1b1175b1bada613929396a571be)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/x86/kernel/cpu/vmware.c
diff --cc arch/x86/kernel/cpu/vmware.c
index 628a059a9a06,5130985b758b..000000000000
--- a/arch/x86/kernel/cpu/vmware.c
+++ b/arch/x86/kernel/cpu/vmware.c
@@@ -26,6 -27,8 +26,11 @@@
  #include <asm/div64.h>
  #include <asm/x86_init.h>
  #include <asm/hypervisor.h>
++<<<<<<< HEAD
++=======
+ #include <asm/timer.h>
+ #include <asm/apic.h>
++>>>>>>> 854dd54245f7 (x86/vmware: Skip timer_irq_works() check on VMware)
  
  #define CPUID_VMWARE_INFO_LEAF	0x40000000
  #define VMWARE_HYPERVISOR_MAGIC	0x564D5868
@@@ -81,11 -84,21 +86,27 @@@ static void __init vmware_platform_setu
  
  	VMWARE_PORT(GETHZ, eax, ebx, ecx, edx);
  
 -	if (ebx != UINT_MAX) {
 +	if (ebx != UINT_MAX)
  		x86_platform.calibrate_tsc = vmware_get_tsc_khz;
++<<<<<<< HEAD
 +	else
 +		printk(KERN_WARNING
 +		       "Failed to get TSC freq from the hypervisor\n");
++=======
+ #ifdef CONFIG_X86_LOCAL_APIC
+ 		/* Skip lapic calibration since we know the bus frequency. */
+ 		lapic_timer_frequency = ecx / HZ;
+ 		pr_info("Host bus clock speed read from hypervisor : %u Hz\n",
+ 			ecx);
+ #endif
+ 	} else {
+ 		pr_warn("Failed to get TSC freq from the hypervisor\n");
+ 	}
+ 
+ #ifdef CONFIG_X86_IO_APIC
+ 	no_timer_check = 1;
+ #endif
++>>>>>>> 854dd54245f7 (x86/vmware: Skip timer_irq_works() check on VMware)
  }
  
  /*
* Unmerged path arch/x86/kernel/cpu/vmware.c
