selinux: Create policydb version for Infiniband support

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
commit-author Daniel Jurgens <danielj@mellanox.com>
commit a806f7a1616f29b80749d708115a643c1f4ba056
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/a806f7a1.failed

Support for Infiniband requires the addition of two new object contexts,
one for infiniband PKeys and another IB Ports. Added handlers to read
and write the new ocontext types when reading or writing a binary policy
representation.

	Signed-off-by: Daniel Jurgens <danielj@mellanox.com>
	Reviewed-by: Eli Cohen <eli@mellanox.com>
	Reviewed-by: James Morris <james.l.morris@oracle.com>
	Acked-by: Doug Ledford <dledford@redhat.com>
	Signed-off-by: Paul Moore <paul@paul-moore.com>
(cherry picked from commit a806f7a1616f29b80749d708115a643c1f4ba056)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	security/selinux/include/security.h
#	security/selinux/ss/policydb.c
diff --cc security/selinux/include/security.h
index 227cdabfb447,b48a462cf446..000000000000
--- a/security/selinux/include/security.h
+++ b/security/selinux/include/security.h
@@@ -34,14 -35,12 +34,23 @@@
  #define POLICYDB_VERSION_NEW_OBJECT_DEFAULTS	27
  #define POLICYDB_VERSION_DEFAULT_TYPE	28
  #define POLICYDB_VERSION_CONSTRAINT_NAMES	29
++<<<<<<< HEAD
 +
 +/* Range of policy versions we understand*/
 +#define POLICYDB_VERSION_MIN   POLICYDB_VERSION_BASE
 +#ifdef CONFIG_SECURITY_SELINUX_POLICYDB_VERSION_MAX
 +#define POLICYDB_VERSION_MAX	CONFIG_SECURITY_SELINUX_POLICYDB_VERSION_MAX_VALUE
 +#else
 +#define POLICYDB_VERSION_MAX	POLICYDB_VERSION_CONSTRAINT_NAMES
 +#endif
++=======
+ #define POLICYDB_VERSION_XPERMS_IOCTL	30
+ #define POLICYDB_VERSION_INFINIBAND		31
+ 
+ /* Range of policy versions we understand*/
+ #define POLICYDB_VERSION_MIN   POLICYDB_VERSION_BASE
+ #define POLICYDB_VERSION_MAX   POLICYDB_VERSION_INFINIBAND
++>>>>>>> a806f7a1616f (selinux: Create policydb version for Infiniband support)
  
  /* Mask for just the mount related flags */
  #define SE_MNTMASK	0x0f
diff --cc security/selinux/ss/policydb.c
index 9c5cdc2caaef,aa6500abb178..000000000000
--- a/security/selinux/ss/policydb.c
+++ b/security/selinux/ss/policydb.c
@@@ -146,8 -151,18 +151,21 @@@ static struct policydb_compat_info poli
  	{
  		.version	= POLICYDB_VERSION_CONSTRAINT_NAMES,
  		.sym_num	= SYM_NUM,
+ 		.ocon_num	= OCON_NUM - 2,
+ 	},
++<<<<<<< HEAD
++=======
+ 	{
+ 		.version	= POLICYDB_VERSION_XPERMS_IOCTL,
+ 		.sym_num	= SYM_NUM,
+ 		.ocon_num	= OCON_NUM - 2,
+ 	},
+ 	{
+ 		.version	= POLICYDB_VERSION_INFINIBAND,
+ 		.sym_num	= SYM_NUM,
  		.ocon_num	= OCON_NUM,
  	},
++>>>>>>> a806f7a1616f (selinux: Create policydb version for Infiniband support)
  };
  
  static struct policydb_compat_info *policydb_lookup_compat(int version)
* Unmerged path security/selinux/include/security.h
* Unmerged path security/selinux/ss/policydb.c
diff --git a/security/selinux/ss/policydb.h b/security/selinux/ss/policydb.h
index 725d5945a97e..5d23eed35fa7 100644
--- a/security/selinux/ss/policydb.h
+++ b/security/selinux/ss/policydb.h
@@ -187,6 +187,15 @@ struct ocontext {
 			u32 addr[4];
 			u32 mask[4];
 		} node6;        /* IPv6 node information */
+		struct {
+			u64 subnet_prefix;
+			u16 low_pkey;
+			u16 high_pkey;
+		} ibpkey;
+		struct {
+			char *dev_name;
+			u8 port;
+		} ibendport;
 	} u;
 	union {
 		u32 sclass;  /* security class for genfs */
@@ -215,14 +224,16 @@ struct genfs {
 #define SYM_NUM     8
 
 /* object context array indices */
-#define OCON_ISID  0	/* initial SIDs */
-#define OCON_FS    1	/* unlabeled file systems */
-#define OCON_PORT  2	/* TCP and UDP port numbers */
-#define OCON_NETIF 3	/* network interfaces */
-#define OCON_NODE  4	/* nodes */
-#define OCON_FSUSE 5	/* fs_use */
-#define OCON_NODE6 6	/* IPv6 nodes */
-#define OCON_NUM   7
+#define OCON_ISID	0 /* initial SIDs */
+#define OCON_FS		1 /* unlabeled file systems */
+#define OCON_PORT	2 /* TCP and UDP port numbers */
+#define OCON_NETIF	3 /* network interfaces */
+#define OCON_NODE	4 /* nodes */
+#define OCON_FSUSE	5 /* fs_use */
+#define OCON_NODE6	6 /* IPv6 nodes */
+#define OCON_IBPKEY	7 /* Infiniband PKeys */
+#define OCON_IBENDPORT	8 /* Infiniband end ports */
+#define OCON_NUM	9
 
 /* The policy database */
 struct policydb {
