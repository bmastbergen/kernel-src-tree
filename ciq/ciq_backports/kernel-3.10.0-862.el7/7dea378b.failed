dm: do not set 'discards_supported' in targets that do not need it

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-862.el7
commit-author Mike Snitzer <snitzer@redhat.com>
commit 7dea378b23fdc5003379615fc579dbf987ed8128
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-862.el7/7dea378b.failed

The DM target's 'discards_supported' flag is intended to act as an
override.  Meaning, even if the underlying storage doesn't support
discards the DM target will.

	Signed-off-by: Mike Snitzer <snitzer@redhat.com>
(cherry picked from commit 7dea378b23fdc5003379615fc579dbf987ed8128)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/md/dm-raid.c
diff --cc drivers/md/dm-raid.c
index c5dc8bbc8b47,ea6eb96b5012..000000000000
--- a/drivers/md/dm-raid.c
+++ b/drivers/md/dm-raid.c
@@@ -2822,10 -2887,9 +2822,16 @@@ static void configure_discard_support(s
  	bool raid456;
  	struct dm_target *ti = rs->ti;
  
++<<<<<<< HEAD
 +	/* Assume discards not supported until after checks below. */
 +	ti->discards_supported = false;
 +
 +	/* RAID level 4,5,6 require discard_zeroes_data for data integrity! */
++=======
+ 	/*
+ 	 * XXX: RAID level 4,5,6 require zeroing for safety.
+ 	 */
++>>>>>>> 7dea378b23fd (dm: do not set 'discards_supported' in targets that do not need it)
  	raid456 = (rs->md.level == 4 || rs->md.level == 5 || rs->md.level == 6);
  
  	for (i = 0; i < rs->raid_disks; i++) {
diff --git a/drivers/md/dm-era-target.c b/drivers/md/dm-era-target.c
index 444c4acf2728..fa1a6387d181 100644
--- a/drivers/md/dm-era-target.c
+++ b/drivers/md/dm-era-target.c
@@ -1514,7 +1514,6 @@ static int era_ctr(struct dm_target *ti, unsigned argc, char **argv)
 	ti->flush_supported = true;
 
 	ti->num_discard_bios = 1;
-	ti->discards_supported = true;
 	era->callbacks.congested_fn = era_is_congested;
 	dm_table_add_target_callbacks(ti->table, &era->callbacks);
 
* Unmerged path drivers/md/dm-raid.c
