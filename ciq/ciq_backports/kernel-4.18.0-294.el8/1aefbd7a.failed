intel_idle: Move 3 functions closer to their callers

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-294.el8
commit-author Rafael J. Wysocki <rafael.j.wysocki@intel.com>
commit 1aefbd7aeb7695c1a9e6ece9a1612ee88e1ea3f8
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-294.el8/1aefbd7a.failed

Move intel_idle_verify_cstate(), auto_demotion_disable() and
c1e_promotion_disable() closer to their callers.

While at it, annotate intel_idle_verify_cstate() with __init,
as it is only used during the initialization of the driver.

No intentional functional impact.

	Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>
(cherry picked from commit 1aefbd7aeb7695c1a9e6ece9a1612ee88e1ea3f8)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/idle/intel_idle.c
diff --cc drivers/idle/intel_idle.c
index ea562fdda44c,27c50fba26d5..000000000000
--- a/drivers/idle/intel_idle.c
+++ b/drivers/idle/intel_idle.c
@@@ -1518,7 -1401,23 +1485,27 @@@ static void sklh_idle_state_table_updat
  	skl_cstates[6].flags |= CPUIDLE_FLAG_UNUSABLE;	/* C9-SKL */
  }
  
++<<<<<<< HEAD
 +static void intel_idle_init_cstates_icpu(struct cpuidle_driver *drv)
++=======
+ static bool __init intel_idle_verify_cstate(unsigned int mwait_hint)
+ {
+ 	unsigned int mwait_cstate = MWAIT_HINT2CSTATE(mwait_hint) + 1;
+ 	unsigned int num_substates = (mwait_substates >> mwait_cstate * 4) &
+ 					MWAIT_SUBSTATE_MASK;
+ 
+ 	/* Ignore the C-state if there are NO sub-states in CPUID for it. */
+ 	if (num_substates == 0)
+ 		return false;
+ 
+ 	if (mwait_cstate > 2 && !boot_cpu_has(X86_FEATURE_NONSTOP_TSC))
+ 		mark_tsc_unstable("TSC halts in idle states deeper than C2");
+ 
+ 	return true;
+ }
+ 
+ static void __init intel_idle_init_cstates_icpu(struct cpuidle_driver *drv)
++>>>>>>> 1aefbd7aeb76 (intel_idle: Move 3 functions closer to their callers)
  {
  	int cstate;
  
* Unmerged path drivers/idle/intel_idle.c
