arm64: vdso: Add -fasynchronous-unwind-tables to cflags

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-294.el8
commit-author Vincenzo Frascino <vincenzo.frascino@arm.com>
commit 1578e5d03112e3e9d37e1c4d95b6dfb734c73955
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-294.el8/1578e5d0.failed

On arm64 linux gcc uses -fasynchronous-unwind-tables -funwind-tables
by default since gcc-8, so now the de facto platform ABI is to allow
unwinding from async signal handlers.

However on bare metal targets (aarch64-none-elf), and on old gcc,
async and sync unwind tables are not enabled by default to avoid
runtime memory costs.

This means if linux is built with a baremetal toolchain the vdso.so
may not have unwind tables which breaks the gcc platform ABI guarantee
in userspace.

Add -fasynchronous-unwind-tables explicitly to the vgettimeofday.o
cflags to address the ABI change.

Fixes: 28b1a824a4f4 ("arm64: vdso: Substitute gettimeofday() with C implementation")
	Cc: Will Deacon <will@kernel.org>
	Reported-by: Szabolcs Nagy <szabolcs.nagy@arm.com>
	Signed-off-by: Vincenzo Frascino <vincenzo.frascino@arm.com>
	Signed-off-by: Catalin Marinas <catalin.marinas@arm.com>
(cherry picked from commit 1578e5d03112e3e9d37e1c4d95b6dfb734c73955)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/arm64/kernel/vdso/Makefile
diff --cc arch/arm64/kernel/vdso/Makefile
index fa230ff09aa1,3862cad2410c..000000000000
--- a/arch/arm64/kernel/vdso/Makefile
+++ b/arch/arm64/kernel/vdso/Makefile
@@@ -15,6 -20,31 +15,34 @@@ obj-vdso := $(addprefix $(obj)/, $(obj-
  ldflags-y := -shared -nostdlib -soname=linux-vdso.so.1 --hash-style=sysv \
  		--build-id -n -T
  
++<<<<<<< HEAD
++=======
+ ccflags-y := -fno-common -fno-builtin -fno-stack-protector -ffixed-x18
+ ccflags-y += -DDISABLE_BRANCH_PROFILING
+ 
+ VDSO_LDFLAGS := -Bsymbolic
+ 
+ CFLAGS_REMOVE_vgettimeofday.o = $(CC_FLAGS_FTRACE) -Os
+ KBUILD_CFLAGS			+= $(DISABLE_LTO)
+ KASAN_SANITIZE			:= n
+ UBSAN_SANITIZE			:= n
+ OBJECT_FILES_NON_STANDARD	:= y
+ KCOV_INSTRUMENT			:= n
+ 
+ CFLAGS_vgettimeofday.o = -O2 -mcmodel=tiny -fasynchronous-unwind-tables
+ 
+ ifneq ($(c-gettimeofday-y),)
+   CFLAGS_vgettimeofday.o += -include $(c-gettimeofday-y)
+ endif
+ 
+ # Clang versions less than 8 do not support -mcmodel=tiny
+ ifeq ($(CONFIG_CC_IS_CLANG), y)
+   ifeq ($(shell test $(CONFIG_CLANG_VERSION) -lt 80000; echo $$?),0)
+     CFLAGS_REMOVE_vgettimeofday.o += -mcmodel=tiny
+   endif
+ endif
+ 
++>>>>>>> 1578e5d03112 (arm64: vdso: Add -fasynchronous-unwind-tables to cflags)
  # Disable gcov profiling for VDSO code
  GCOV_PROFILE := n
  
* Unmerged path arch/arm64/kernel/vdso/Makefile
