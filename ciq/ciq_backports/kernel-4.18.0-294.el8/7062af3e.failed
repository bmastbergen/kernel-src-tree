iommu/virtio: Fix freeing of incomplete domains

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-294.el8
commit-author Jean-Philippe Brucker <jean-philippe@linaro.org>
commit 7062af3ed2ba451029e3733d9f677c68f5ea9e77
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-294.el8/7062af3e.failed

Calling viommu_domain_free() on a domain that hasn't been finalised (not
attached to any device, for example) can currently cause an Oops,
because we attempt to call ida_free() on ID 0, which may either be
unallocated or used by another domain.

Only initialise the vdomain->viommu pointer, which denotes a finalised
domain, at the end of a successful viommu_domain_finalise().

Fixes: edcd69ab9a32 ("iommu: Add virtio-iommu driver")
	Reported-by: Eric Auger <eric.auger@redhat.com>
	Signed-off-by: Jean-Philippe Brucker <jean-philippe@linaro.org>
	Reviewed-by: Robin Murphy <robin.murphy@arm.com>
Link: https://lore.kernel.org/r/20200326093558.2641019-3-jean-philippe@linaro.org
	Signed-off-by: Joerg Roedel <jroedel@suse.de>
(cherry picked from commit 7062af3ed2ba451029e3733d9f677c68f5ea9e77)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/iommu/virtio-iommu.c
* Unmerged path drivers/iommu/virtio-iommu.c
* Unmerged path drivers/iommu/virtio-iommu.c
