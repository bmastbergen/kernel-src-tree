net: atlantic: add support for 64-bit reads/writes

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-294.el8
commit-author Pavel Belous <pbelous@marvell.com>
commit 1e41b3fee795faa8a67713749a21e60828ae21ad
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-294.el8/1e41b3fe.failed

This patch adds support for 64-bit reads/writes where applicable, e.g.
A2 supports them.

	Signed-off-by: Pavel Belous <pbelous@marvell.com>
	Signed-off-by: Mark Starovoytov <mstarovoitov@marvell.com>
	Signed-off-by: Igor Russkikh <irusskikh@marvell.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 1e41b3fee795faa8a67713749a21e60828ae21ad)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/aquantia/atlantic/aq_hw.h
#	drivers/net/ethernet/aquantia/atlantic/aq_hw_utils.c
#	drivers/net/ethernet/aquantia/atlantic/aq_hw_utils.h
#	drivers/net/ethernet/aquantia/atlantic/hw_atl2/hw_atl2.c
diff --cc drivers/net/ethernet/aquantia/atlantic/aq_hw.h
index 46eaf70c5ccb,96d59ee3eb70..000000000000
--- a/drivers/net/ethernet/aquantia/atlantic/aq_hw.h
+++ b/drivers/net/ethernet/aquantia/atlantic/aq_hw.h
@@@ -55,6 -67,8 +55,11 @@@ struct aq_hw_caps_s 
  	u8 rx_rings;
  	bool flow_control;
  	bool is_64_dma;
++<<<<<<< HEAD
++=======
+ 	bool op64bit;
+ 	u32 priv_data_len;
++>>>>>>> 1e41b3fee795 (net: atlantic: add support for 64-bit reads/writes)
  };
  
  struct aq_hw_link_status_s {
diff --cc drivers/net/ethernet/aquantia/atlantic/aq_hw_utils.c
index 22a1c784dc9c,ae85c0a7d238..000000000000
--- a/drivers/net/ethernet/aquantia/atlantic/aq_hw_utils.c
+++ b/drivers/net/ethernet/aquantia/atlantic/aq_hw_utils.c
@@@ -1,10 -1,8 +1,18 @@@
++<<<<<<< HEAD
 +/*
 + * aQuantia Corporation Network Driver
 + * Copyright (C) 2014-2017 aQuantia Corporation. All rights reserved
 + *
 + * This program is free software; you can redistribute it and/or modify it
 + * under the terms and conditions of the GNU General Public License,
 + * version 2, as published by the Free Software Foundation.
++=======
+ // SPDX-License-Identifier: GPL-2.0-only
+ /* Atlantic Network Driver
+  *
+  * Copyright (C) 2014-2019 aQuantia Corporation
+  * Copyright (C) 2019-2020 Marvell International Ltd.
++>>>>>>> 1e41b3fee795 (net: atlantic: add support for 64-bit reads/writes)
   */
  
  /* File aq_hw_utils.c: Definitions of helper functions used across
@@@ -59,9 -60,17 +70,21 @@@ void aq_hw_write_reg(struct aq_hw_s *hw
   */
  u64 aq_hw_read_reg64(struct aq_hw_s *hw, u32 reg)
  {
- 	u64 value = aq_hw_read_reg(hw, reg);
+ 	u64 value = U64_MAX;
  
++<<<<<<< HEAD
 +	value |= (u64)aq_hw_read_reg(hw, reg + 4) << 32;
++=======
+ 	if (hw->aq_nic_cfg->aq_hw_caps->op64bit)
+ 		value = readq(hw->mmio + reg);
+ 	else
+ 		value = lo_hi_readq(hw->mmio + reg);
+ 
+ 	if (value == U64_MAX &&
+ 	    readl(hw->mmio + hw->aq_nic_cfg->aq_hw_caps->hw_alive_check_addr) == U32_MAX)
+ 		aq_utils_obj_set(&hw->flags, AQ_HW_FLAG_ERR_UNPLUG);
+ 
++>>>>>>> 1e41b3fee795 (net: atlantic: add support for 64-bit reads/writes)
  	return value;
  }
  
diff --cc drivers/net/ethernet/aquantia/atlantic/aq_hw_utils.h
index bf73428ed689,ffa6e4067c21..000000000000
--- a/drivers/net/ethernet/aquantia/atlantic/aq_hw_utils.h
+++ b/drivers/net/ethernet/aquantia/atlantic/aq_hw_utils.h
@@@ -1,10 -1,8 +1,18 @@@
++<<<<<<< HEAD
 +/*
 + * aQuantia Corporation Network Driver
 + * Copyright (C) 2014-2017 aQuantia Corporation. All rights reserved
 + *
 + * This program is free software; you can redistribute it and/or modify it
 + * under the terms and conditions of the GNU General Public License,
 + * version 2, as published by the Free Software Foundation.
++=======
+ /* SPDX-License-Identifier: GPL-2.0-only */
+ /* Atlantic Network Driver
+  *
+  * Copyright (C) 2014-2019 aQuantia Corporation
+  * Copyright (C) 2019-2020 Marvell International Ltd.
++>>>>>>> 1e41b3fee795 (net: atlantic: add support for 64-bit reads/writes)
   */
  
  /* File aq_hw_utils.h: Declaration of helper functions used across hardware
@@@ -36,6 -34,9 +44,7 @@@ u32 aq_hw_read_reg_bit(struct aq_hw_s *
  u32 aq_hw_read_reg(struct aq_hw_s *hw, u32 reg);
  void aq_hw_write_reg(struct aq_hw_s *hw, u32 reg, u32 value);
  u64 aq_hw_read_reg64(struct aq_hw_s *hw, u32 reg);
+ void aq_hw_write_reg64(struct aq_hw_s *hw, u32 reg, u64 value);
  int aq_hw_err_from_flags(struct aq_hw_s *hw);
 -int aq_hw_num_tcs(struct aq_hw_s *hw);
 -int aq_hw_q_per_tc(struct aq_hw_s *hw);
  
  #endif /* AQ_HW_UTILS_H */
* Unmerged path drivers/net/ethernet/aquantia/atlantic/hw_atl2/hw_atl2.c
* Unmerged path drivers/net/ethernet/aquantia/atlantic/aq_hw.h
* Unmerged path drivers/net/ethernet/aquantia/atlantic/aq_hw_utils.c
* Unmerged path drivers/net/ethernet/aquantia/atlantic/aq_hw_utils.h
diff --git a/drivers/net/ethernet/aquantia/atlantic/hw_atl/hw_atl_a0.c b/drivers/net/ethernet/aquantia/atlantic/hw_atl/hw_atl_a0.c
index ec4ee92db31b..6bfc452e773e 100644
--- a/drivers/net/ethernet/aquantia/atlantic/hw_atl/hw_atl_a0.c
+++ b/drivers/net/ethernet/aquantia/atlantic/hw_atl/hw_atl_a0.c
@@ -20,6 +20,7 @@
 
 #define DEFAULT_A0_BOARD_BASIC_CAPABILITIES \
 	.is_64_dma = true,		  \
+	.op64bit = false,		  \
 	.msix_irqs = 4U,		  \
 	.irq_mask = ~0U,		  \
 	.vecs = HW_ATL_A0_RSS_MAX,	  \
diff --git a/drivers/net/ethernet/aquantia/atlantic/hw_atl/hw_atl_b0.c b/drivers/net/ethernet/aquantia/atlantic/hw_atl/hw_atl_b0.c
index b7e5ce0d7af5..be3e78aeb83f 100644
--- a/drivers/net/ethernet/aquantia/atlantic/hw_atl/hw_atl_b0.c
+++ b/drivers/net/ethernet/aquantia/atlantic/hw_atl/hw_atl_b0.c
@@ -21,6 +21,7 @@
 
 #define DEFAULT_B0_BOARD_BASIC_CAPABILITIES \
 	.is_64_dma = true,		  \
+	.op64bit = false,		  \
 	.msix_irqs = 8U,		  \
 	.irq_mask = ~0U,		  \
 	.vecs = HW_ATL_B0_RSS_MAX,	  \
* Unmerged path drivers/net/ethernet/aquantia/atlantic/hw_atl2/hw_atl2.c
