block: don't call part_{inc,dec}_in_flight for blk-mq devices

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-294.el8
Rebuild_CHGLOG: - [block] block: don't call part_{inc, dec}_in_flight for blk-mq devices (Ming Lei) [1881760]
Rebuild_FUZZ: 99.19%
commit-author Christoph Hellwig <hch@lst.de>
commit 76268f3ac0a69e76270af5f67ab239ccd796ae56
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-294.el8/76268f3a.failed

part_inc_in_flight and part_dec_in_flight are no-ops for blk-mq queues,
so remove the calls in purely blk-mq callers.

	Signed-off-by: Christoph Hellwig <hch@lst.de>
	Signed-off-by: Jens Axboe <axboe@kernel.dk>
(cherry picked from commit 76268f3ac0a69e76270af5f67ab239ccd796ae56)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	block/blk-core.c
diff --cc block/blk-core.c
index 9aabbc020a34,77e57c2e8d60..000000000000
--- a/block/blk-core.c
+++ b/block/blk-core.c
@@@ -1323,8 -1412,6 +1323,11 @@@ void blk_account_io_done(struct reques
  		update_io_ticks(part, jiffies, true);
  		part_stat_inc(part, ios[sgrp]);
  		part_stat_add(part, nsecs[sgrp], now - req->start_time_ns);
++<<<<<<< HEAD
 +		part_stat_add(part, time_in_queue, nsecs_to_jiffies64(now - req->start_time_ns));
 +		part_dec_in_flight(req->q, part, rq_data_dir(req));
++=======
++>>>>>>> 76268f3ac0a6 (block: don't call part_{inc,dec}_in_flight for blk-mq devices)
  
  		hd_struct_put(part);
  		part_stat_unlock();
* Unmerged path block/blk-core.c
diff --git a/block/blk-merge.c b/block/blk-merge.c
index 96b6e62209ca..72ee1b2e1164 100644
--- a/block/blk-merge.c
+++ b/block/blk-merge.c
@@ -670,8 +670,6 @@ static void blk_account_io_merge(struct request *req)
 		part_stat_lock();
 		part = req->part;
 
-		part_dec_in_flight(req->q, part, rq_data_dir(req));
-
 		hd_struct_put(part);
 		part_stat_unlock();
 	}
