net/mlx5e: Set IPsec WAs only in IP's non checksum partial case.

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-294.el8
Rebuild_CHGLOG: - [netdrv] net/mlx5e: Set IPsec WAs only in IP's non checksum partial case (Alaa Hleihel) [1858561]
Rebuild_FUZZ: 99.21%
commit-author Huy Nguyen <huyn@mellanox.com>
commit 5cfb540ef27b5b763a3b181d142847ef0411728e
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-294.el8/5cfb540e.failed

The IP's checksum partial still requires L4 csum flag on Ethernet WQE.
Make the IPsec WAs only for the IP's non checksum partial case
(for example icmd packet)

Fixes: 5be019040cb7 ("net/mlx5e: IPsec: Add Connect-X IPsec Tx data path offload")
	Signed-off-by: Huy Nguyen <huyn@mellanox.com>
	Reviewed-by: Raed Salem <raeds@nvidia.com>
	Reviewed-by: Alaa Hleihel <alaa@nvidia.com>
	Signed-off-by: Saeed Mahameed <saeedm@nvidia.com>
(cherry picked from commit 5cfb540ef27b5b763a3b181d142847ef0411728e)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/mellanox/mlx5/core/en_tx.c
diff --cc drivers/net/ethernet/mellanox/mlx5/core/en_tx.c
index d2c9bb371f27,6dd3ea3cbbed..000000000000
--- a/drivers/net/ethernet/mellanox/mlx5/core/en_tx.c
+++ b/drivers/net/ethernet/mellanox/mlx5/core/en_tx.c
@@@ -145,6 -144,22 +145,25 @@@ static inline void mlx5e_insert_vlan(vo
  	memcpy(&vhdr->h_vlan_encapsulated_proto, skb->data + cpy1_sz, cpy2_sz);
  }
  
++<<<<<<< HEAD
++=======
+ /* If packet is not IP's CHECKSUM_PARTIAL (e.g. icmd packet),
+  * need to set L3 checksum flag for IPsec
+  */
+ static void
+ ipsec_txwqe_build_eseg_csum(struct mlx5e_txqsq *sq, struct sk_buff *skb,
+ 			    struct mlx5_wqe_eth_seg *eseg)
+ {
+ 	eseg->cs_flags = MLX5_ETH_WQE_L3_CSUM;
+ 	if (skb->encapsulation) {
+ 		eseg->cs_flags |= MLX5_ETH_WQE_L3_INNER_CSUM;
+ 		sq->stats->csum_partial_inner++;
+ 	} else {
+ 		sq->stats->csum_partial++;
+ 	}
+ }
+ 
++>>>>>>> 5cfb540ef27b (net/mlx5e: Set IPsec WAs only in IP's non checksum partial case.)
  static inline void
  mlx5e_txwqe_build_eseg_csum(struct mlx5e_txqsq *sq, struct sk_buff *skb, struct mlx5_wqe_eth_seg *eseg)
  {
* Unmerged path drivers/net/ethernet/mellanox/mlx5/core/en_tx.c
