x86/boot/compressed/64: Rename kaslr_64.c to ident_map_64.c

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-294.el8
Rebuild_CHGLOG: - [x86] boot/compressed/64: Rename kaslr_64.c to ident_map_64.c (Vitaly Kuznetsov) [1868080]
Rebuild_FUZZ: 96.49%
commit-author Joerg Roedel <jroedel@suse.de>
commit 5f2bb01682b7b067783207994c7b8a3dbeb1cd83
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-294.el8/5f2bb016.failed

The file contains only code related to identity-mapped page tables.
Rename the file and compile it always in.

	Signed-off-by: Joerg Roedel <jroedel@suse.de>
	Signed-off-by: Borislav Petkov <bp@suse.de>
	Reviewed-by: Kees Cook <keescook@chromium.org>
Link: https://lkml.kernel.org/r/20200907131613.12703-15-joro@8bytes.org
(cherry picked from commit 5f2bb01682b7b067783207994c7b8a3dbeb1cd83)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/x86/boot/compressed/Makefile
#	arch/x86/boot/compressed/kaslr.c
#	arch/x86/boot/compressed/misc.h
diff --cc arch/x86/boot/compressed/Makefile
index 0ae4decaece3,e7f3eba99ea2..000000000000
--- a/arch/x86/boot/compressed/Makefile
+++ b/arch/x86/boot/compressed/Makefile
@@@ -78,7 -84,8 +78,12 @@@ vmlinux-objs-y := $(obj)/vmlinux.lds $(
  vmlinux-objs-$(CONFIG_EARLY_PRINTK) += $(obj)/early_serial_console.o
  vmlinux-objs-$(CONFIG_RANDOMIZE_BASE) += $(obj)/kaslr.o
  ifdef CONFIG_X86_64
++<<<<<<< HEAD
 +	vmlinux-objs-$(CONFIG_RANDOMIZE_BASE) += $(obj)/kaslr_64.o
++=======
+ 	vmlinux-objs-y += $(obj)/ident_map_64.o
+ 	vmlinux-objs-y += $(obj)/idt_64.o $(obj)/idt_handlers_64.o
++>>>>>>> 5f2bb01682b7 (x86/boot/compressed/64: Rename kaslr_64.c to ident_map_64.c)
  	vmlinux-objs-y += $(obj)/mem_encrypt.o
  	vmlinux-objs-y += $(obj)/pgtable_64.o
  endif
diff --cc arch/x86/boot/compressed/kaslr.c
index d375b8f0f703,e27de98ed038..000000000000
--- a/arch/x86/boot/compressed/kaslr.c
+++ b/arch/x86/boot/compressed/kaslr.c
@@@ -46,11 -36,9 +46,17 @@@
  #define STATIC
  #include <linux/decompress/mm.h>
  
++<<<<<<< HEAD
 +#ifdef CONFIG_X86_5LEVEL
 +unsigned int __pgtable_l5_enabled;
 +unsigned int pgdir_shift __ro_after_init = 39;
 +unsigned int ptrs_per_p4d __ro_after_init = 1;
 +#endif
++=======
+ #define _SETUP
+ #include <asm/setup.h>	/* For COMMAND_LINE_SIZE */
+ #undef _SETUP
++>>>>>>> 5f2bb01682b7 (x86/boot/compressed/64: Rename kaslr_64.c to ident_map_64.c)
  
  extern unsigned long get_cmd_line_ptr(void);
  
diff --cc arch/x86/boot/compressed/misc.h
index d55a1ca4f95b,98b7a1df9c59..000000000000
--- a/arch/x86/boot/compressed/misc.h
+++ b/arch/x86/boot/compressed/misc.h
@@@ -133,4 -134,16 +133,19 @@@ int count_immovable_mem_regions(void)
  static inline int count_immovable_mem_regions(void) { return 0; }
  #endif
  
++<<<<<<< HEAD
++=======
+ /* ident_map_64.c */
+ #ifdef CONFIG_X86_5LEVEL
+ extern unsigned int __pgtable_l5_enabled, pgdir_shift, ptrs_per_p4d;
+ #endif
+ 
+ /* Used by PAGE_KERN* macros: */
+ extern pteval_t __default_kernel_pte_mask;
+ 
+ /* idt_64.c */
+ extern gate_desc boot_idt[BOOT_IDT_ENTRIES];
+ extern struct desc_ptr boot_idt_desc;
+ 
++>>>>>>> 5f2bb01682b7 (x86/boot/compressed/64: Rename kaslr_64.c to ident_map_64.c)
  #endif /* BOOT_COMPRESSED_MISC_H */
* Unmerged path arch/x86/boot/compressed/Makefile
diff --git a/arch/x86/boot/compressed/kaslr_64.c b/arch/x86/boot/compressed/ident_map_64.c
similarity index 95%
rename from arch/x86/boot/compressed/kaslr_64.c
rename to arch/x86/boot/compressed/ident_map_64.c
index 9557c5a15b91..89a44598ed65 100644
--- a/arch/x86/boot/compressed/kaslr_64.c
+++ b/arch/x86/boot/compressed/ident_map_64.c
@@ -29,6 +29,15 @@
 #define __PAGE_OFFSET __PAGE_OFFSET_BASE
 #include "../../mm/ident_map.c"
 
+#ifdef CONFIG_X86_5LEVEL
+unsigned int __pgtable_l5_enabled;
+unsigned int pgdir_shift = 39;
+unsigned int ptrs_per_p4d = 1;
+#endif
+
+/* Used by PAGE_KERN* macros: */
+pteval_t __default_kernel_pte_mask __read_mostly = ~0;
+
 /* Used to track our page table allocation area. */
 struct alloc_pgt_data {
 	unsigned char *pgt_buf;
* Unmerged path arch/x86/boot/compressed/kaslr.c
* Unmerged path arch/x86/boot/compressed/misc.h
