ceph: remove timeout on allowing reconnect after blocklisting

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-294.el8
commit-author Jeff Layton <jlayton@kernel.org>
commit dbeec07bc84f8229322d7919692a17adae1e388e
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-294.el8/dbeec07b.failed

30 minutes is a long time to wait, and this makes it difficult to test
the feature by manually blocklisting clients. Remove the timeout
infrastructure and just allow the client to reconnect at will.

	Signed-off-by: Jeff Layton <jlayton@kernel.org>
	Reviewed-by: Xiubo Li <xiubli@redhat.com>
	Reviewed-by: "Yan, Zheng" <zyan@redhat.com>
	Signed-off-by: Ilya Dryomov <idryomov@gmail.com>
(cherry picked from commit dbeec07bc84f8229322d7919692a17adae1e388e)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	fs/ceph/mds_client.c
#	fs/ceph/super.h
diff --cc fs/ceph/mds_client.c
index 2a34ec6780af,de95e08815c0..000000000000
--- a/fs/ceph/mds_client.c
+++ b/fs/ceph/mds_client.c
@@@ -4370,15 -4371,10 +4370,19 @@@ static void maybe_recover_session(struc
  	if (READ_ONCE(fsc->mount_state) != CEPH_MOUNT_MOUNTED)
  		return;
  
 -	if (!READ_ONCE(fsc->blocklisted))
 +	if (!READ_ONCE(fsc->blacklisted))
  		return;
  
++<<<<<<< HEAD
 +	if (fsc->last_auto_reconnect &&
 +	    time_before(jiffies, fsc->last_auto_reconnect + HZ * 60 * 30))
 +		return;
 +
 +	pr_info("auto reconnect after blacklisted\n");
 +	fsc->last_auto_reconnect = jiffies;
++=======
+ 	pr_info("auto reconnect after blocklisted\n");
++>>>>>>> dbeec07bc84f (ceph: remove timeout on allowing reconnect after blocklisting)
  	ceph_force_reconnect(fsc->sb);
  }
  
diff --cc fs/ceph/super.h
index 7b6f489ea08a,f097237a5ad3..000000000000
--- a/fs/ceph/super.h
+++ b/fs/ceph/super.h
@@@ -109,8 -108,7 +109,12 @@@ struct ceph_fs_client 
  
  	int mount_state;
  
++<<<<<<< HEAD
 +	unsigned long last_auto_reconnect;
 +	bool blacklisted;
++=======
+ 	bool blocklisted;
++>>>>>>> dbeec07bc84f (ceph: remove timeout on allowing reconnect after blocklisting)
  
  	bool have_copy_from2;
  
* Unmerged path fs/ceph/mds_client.c
* Unmerged path fs/ceph/super.h
