x86/sev-es: Support CPU offline/online

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-294.el8
Rebuild_CHGLOG: - [x86] sev-es: Support CPU offline/online (Vitaly Kuznetsov) [1868080]
Rebuild_FUZZ: 94.44%
commit-author Joerg Roedel <jroedel@suse.de>
commit 094794f59720d7e877a1eeb372ecedeed6b441ab
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-294.el8/094794f5.failed

Add a play_dead handler when running under SEV-ES. This is needed
because the hypervisor can't deliver an SIPI request to restart the AP.
Instead, the kernel has to issue a VMGEXIT to halt the VCPU until the
hypervisor wakes it up again.

	Signed-off-by: Joerg Roedel <jroedel@suse.de>
	Signed-off-by: Borislav Petkov <bp@suse.de>
Link: https://lkml.kernel.org/r/20200907131613.12703-70-joro@8bytes.org
(cherry picked from commit 094794f59720d7e877a1eeb372ecedeed6b441ab)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/x86/include/uapi/asm/svm.h
#	arch/x86/kernel/sev-es.c
diff --cc arch/x86/include/uapi/asm/svm.h
index 522d42dfc28c,c1dcf3e114e4..000000000000
--- a/arch/x86/include/uapi/asm/svm.h
+++ b/arch/x86/include/uapi/asm/svm.h
@@@ -81,6 -81,15 +81,18 @@@
  #define SVM_EXIT_AVIC_INCOMPLETE_IPI		0x401
  #define SVM_EXIT_AVIC_UNACCELERATED_ACCESS	0x402
  
++<<<<<<< HEAD
++=======
+ /* SEV-ES software-defined VMGEXIT events */
+ #define SVM_VMGEXIT_MMIO_READ			0x80000001
+ #define SVM_VMGEXIT_MMIO_WRITE			0x80000002
+ #define SVM_VMGEXIT_AP_HLT_LOOP			0x80000004
+ #define SVM_VMGEXIT_AP_JUMP_TABLE		0x80000005
+ #define SVM_VMGEXIT_SET_AP_JUMP_TABLE		0
+ #define SVM_VMGEXIT_GET_AP_JUMP_TABLE		1
+ #define SVM_VMGEXIT_UNSUPPORTED_EVENT		0x8000ffff
+ 
++>>>>>>> 094794f59720 (x86/sev-es: Support CPU offline/online)
  #define SVM_EXIT_ERR           -1
  
  #define SVM_EXIT_REASONS \
* Unmerged path arch/x86/kernel/sev-es.c
* Unmerged path arch/x86/include/uapi/asm/svm.h
* Unmerged path arch/x86/kernel/sev-es.c
