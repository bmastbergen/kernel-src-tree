x86/sev-es: Add a Runtime #VC Exception Handler

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-294.el8
Rebuild_CHGLOG: - [x86] sev-es: Add a Runtime #VC Exception Handler (Vitaly Kuznetsov) [1868080]
Rebuild_FUZZ: 95.56%
commit-author Tom Lendacky <thomas.lendacky@amd.com>
commit 0786138c78e79343c7b015d77507cbf9d5f15d00
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-294.el8/0786138c.failed

Add the handlers for #VC exceptions invoked at runtime.

	Signed-off-by: Tom Lendacky <thomas.lendacky@amd.com>
	Signed-off-by: Joerg Roedel <jroedel@suse.de>
	Signed-off-by: Borislav Petkov <bp@suse.de>
Link: https://lkml.kernel.org/r/20200907131613.12703-47-joro@8bytes.org
(cherry picked from commit 0786138c78e79343c7b015d77507cbf9d5f15d00)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/x86/include/asm/idtentry.h
#	arch/x86/kernel/idt.c
#	arch/x86/kernel/sev-es.c
diff --cc arch/x86/kernel/idt.c
index cdf4700ac5e2,e29a6c728001..000000000000
--- a/arch/x86/kernel/idt.c
+++ b/arch/x86/kernel/idt.c
@@@ -264,6 -216,30 +264,33 @@@ void __init idt_setup_traps(void
  }
  
  #ifdef CONFIG_X86_64
++<<<<<<< HEAD
++=======
+ /*
+  * Early traps running on the DEFAULT_STACK because the other interrupt
+  * stacks work only after cpu_init().
+  */
+ static const __initconst struct idt_data early_pf_idts[] = {
+ 	INTG(X86_TRAP_PF,		asm_exc_page_fault),
+ };
+ 
+ /*
+  * The exceptions which use Interrupt stacks. They are setup after
+  * cpu_init() when the TSS has been initialized.
+  */
+ static const __initconst struct idt_data ist_idts[] = {
+ 	ISTG(X86_TRAP_DB,	asm_exc_debug,			IST_INDEX_DB),
+ 	ISTG(X86_TRAP_NMI,	asm_exc_nmi,			IST_INDEX_NMI),
+ 	ISTG(X86_TRAP_DF,	asm_exc_double_fault,		IST_INDEX_DF),
+ #ifdef CONFIG_X86_MCE
+ 	ISTG(X86_TRAP_MC,	asm_exc_machine_check,		IST_INDEX_MCE),
+ #endif
+ #ifdef CONFIG_AMD_MEM_ENCRYPT
+ 	ISTG(X86_TRAP_VC,	asm_exc_vmm_communication,	IST_INDEX_VC),
+ #endif
+ };
+ 
++>>>>>>> 0786138c78e7 (x86/sev-es: Add a Runtime #VC Exception Handler)
  /**
   * idt_setup_early_pf - Initialize the idt table with early pagefault handler
   *
* Unmerged path arch/x86/include/asm/idtentry.h
* Unmerged path arch/x86/kernel/sev-es.c
* Unmerged path arch/x86/include/asm/idtentry.h
* Unmerged path arch/x86/kernel/idt.c
* Unmerged path arch/x86/kernel/sev-es.c
