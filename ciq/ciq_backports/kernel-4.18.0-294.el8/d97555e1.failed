net/mlx5e: Add bond_metadata and its slave entries

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-294.el8
commit-author Vu Pham <vuhuong@mellanox.com>
commit d97555e1452943264295cd3c1f066474bc3660dd
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-294.el8/d97555e1.failed

Adding bond_metadata and its slave entries to represent a lag device
and its slaves VF representors. Bond_metadata structure includes a
unique metadata shared by slaves VF respresentors, and a list of slaves
representors slave entries.

On enslaving event, create a bond_metadata structure representing
the upper lag device of this slave representor if it has not been
created yet. Create and add entry for the slave representor to the
slaves list.

On unslaving event, free the slave entry of the slave representor.
On the last unslave event, free the bond_metadata structure and its
resources.

Introduce APIs to create and remove bond_metadata and its resources,
enslave and unslave VF representor slave entries.

	Signed-off-by: Vu Pham <vuhuong@mellanox.com>
	Reviewed-by: Parav Pandit <parav@mellanox.com>
	Reviewed-by: Roi Dayan <roid@mellanox.com>
	Signed-off-by: Saeed Mahameed <saeedm@mellanox.com>
(cherry picked from commit d97555e1452943264295cd3c1f066474bc3660dd)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/mellanox/mlx5/core/en/rep/bond.c
#	drivers/net/ethernet/mellanox/mlx5/core/en_rep.h
diff --cc drivers/net/ethernet/mellanox/mlx5/core/en_rep.h
index 1f74a4b54f5f,ed741b6e6af2..000000000000
--- a/drivers/net/ethernet/mellanox/mlx5/core/en_rep.h
+++ b/drivers/net/ethernet/mellanox/mlx5/core/en_rep.h
@@@ -190,6 -215,14 +190,17 @@@ struct mlx5e_rep_sq 
  
  void mlx5e_rep_register_vport_reps(struct mlx5_core_dev *mdev);
  void mlx5e_rep_unregister_vport_reps(struct mlx5_core_dev *mdev);
++<<<<<<< HEAD
++=======
+ int mlx5e_rep_bond_init(struct mlx5e_rep_priv *rpriv);
+ void mlx5e_rep_bond_cleanup(struct mlx5e_rep_priv *rpriv);
+ int mlx5e_rep_bond_enslave(struct mlx5_eswitch *esw, struct net_device *netdev,
+ 			   struct net_device *lag_dev);
+ void mlx5e_rep_bond_unslave(struct mlx5_eswitch *esw,
+ 			    const struct net_device *netdev,
+ 			    const struct net_device *lag_dev);
+ 
++>>>>>>> d97555e14529 (net/mlx5e: Add bond_metadata and its slave entries)
  bool mlx5e_is_uplink_rep(struct mlx5e_priv *priv);
  int mlx5e_add_sqs_fwd_rules(struct mlx5e_priv *priv);
  void mlx5e_remove_sqs_fwd_rules(struct mlx5e_priv *priv);
* Unmerged path drivers/net/ethernet/mellanox/mlx5/core/en/rep/bond.c
* Unmerged path drivers/net/ethernet/mellanox/mlx5/core/en/rep/bond.c
* Unmerged path drivers/net/ethernet/mellanox/mlx5/core/en_rep.h
