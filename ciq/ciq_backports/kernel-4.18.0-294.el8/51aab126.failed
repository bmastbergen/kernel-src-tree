RDMA/core: Get xmit slave for LAG

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-294.el8
commit-author Maor Gottlieb <maorg@mellanox.com>
commit 51aab12631dd7700385d275846ca49dc0b8c2124
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-294.el8/51aab126.failed

Add a call to rdma_lag_get_ah_roce_slave() when the address handle is
created. Lower driver can use it to select the QP's affinity port.

Link: https://lore.kernel.org/r/20200430192146.12863-15-maorg@mellanox.com
	Signed-off-by: Maor Gottlieb <maorg@mellanox.com>
	Reviewed-by: Leon Romanovsky <leonro@mellanox.com>
	Signed-off-by: Jason Gunthorpe <jgg@mellanox.com>
(cherry picked from commit 51aab12631dd7700385d275846ca49dc0b8c2124)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/infiniband/core/verbs.c
#	include/rdma/ib_verbs.h
diff --cc drivers/infiniband/core/verbs.c
index f53e9dab12a7,bf0249f76ae9..000000000000
--- a/drivers/infiniband/core/verbs.c
+++ b/drivers/infiniband/core/verbs.c
@@@ -500,8 -501,10 +501,9 @@@ rdma_update_sgid_attr(struct rdma_ah_at
  static struct ib_ah *_rdma_create_ah(struct ib_pd *pd,
  				     struct rdma_ah_attr *ah_attr,
  				     u32 flags,
- 				     struct ib_udata *udata)
+ 				     struct ib_udata *udata,
+ 				     struct net_device *xmit_slave)
  {
 -	struct rdma_ah_init_attr init_attr = {};
  	struct ib_device *device = pd->device;
  	struct ib_ah *ah;
  	int ret;
@@@ -521,8 -524,11 +523,14 @@@
  	ah->pd = pd;
  	ah->type = ah_attr->type;
  	ah->sgid_attr = rdma_update_sgid_attr(ah_attr, NULL);
++<<<<<<< HEAD
++=======
+ 	init_attr.ah_attr = ah_attr;
+ 	init_attr.flags = flags;
+ 	init_attr.xmit_slave = xmit_slave;
++>>>>>>> 51aab12631dd (RDMA/core: Get xmit slave for LAG)
  
 -	ret = device->ops.create_ah(ah, &init_attr, udata);
 +	ret = device->ops.create_ah(ah, ah_attr, flags, udata);
  	if (ret) {
  		kfree(ah);
  		return ERR_PTR(ret);
diff --cc include/rdma/ib_verbs.h
index 2bbc19f4ccda,8d29f2f79da8..000000000000
--- a/include/rdma/ib_verbs.h
+++ b/include/rdma/ib_verbs.h
@@@ -880,6 -880,12 +880,15 @@@ struct ib_mr_status 
   */
  __attribute_const__ enum ib_rate mult_to_ib_rate(int mult);
  
++<<<<<<< HEAD
++=======
+ struct rdma_ah_init_attr {
+ 	struct rdma_ah_attr *ah_attr;
+ 	u32 flags;
+ 	struct net_device *xmit_slave;
+ };
+ 
++>>>>>>> 51aab12631dd (RDMA/core: Get xmit slave for LAG)
  enum rdma_ah_attr_type {
  	RDMA_AH_ATTR_TYPE_UNDEFINED,
  	RDMA_AH_ATTR_TYPE_IB,
* Unmerged path drivers/infiniband/core/verbs.c
* Unmerged path include/rdma/ib_verbs.h
