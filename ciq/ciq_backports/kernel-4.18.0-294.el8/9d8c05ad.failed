tcp: fix syn cookied MPTCP request socket leak

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-294.el8
commit-author Paolo Abeni <pabeni@redhat.com>
commit 9d8c05ad5627b3a650087c14c67dd1d22a6368ab
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-294.el8/9d8c05ad.failed

If a syn-cookies request socket don't pass MPTCP-level
validation done in syn_recv_sock(), we need to release
it immediately, or it will be leaked.

Closes: https://github.com/multipath-tcp/mptcp_net-next/issues/89
Fixes: 9466a1ccebbe ("mptcp: enable JOIN requests even if cookies are in use")
Reported-and-tested-by: Geliang Tang <geliangtang@gmail.com>
	Reviewed-by: Matthieu Baerts <matthieu.baerts@tessares.net>
	Signed-off-by: Paolo Abeni <pabeni@redhat.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 9d8c05ad5627b3a650087c14c67dd1d22a6368ab)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/ipv4/syncookies.c
diff --cc net/ipv4/syncookies.c
index c74c6eb5a0e6,e03756631541..000000000000
--- a/net/ipv4/syncookies.c
+++ b/net/ipv4/syncookies.c
@@@ -216,6 -212,12 +216,15 @@@ struct sock *tcp_get_cookie_sock(struc
  		refcount_set(&req->rsk_refcnt, 1);
  		tcp_sk(child)->tsoffset = tsoff;
  		sock_rps_save_rxhash(child, skb);
++<<<<<<< HEAD
++=======
+ 
+ 		if (rsk_drop_req(req)) {
+ 			reqsk_put(req);
+ 			return child;
+ 		}
+ 
++>>>>>>> 9d8c05ad5627 (tcp: fix syn cookied MPTCP request socket leak)
  		if (inet_csk_reqsk_queue_add(sk, req, child))
  			return child;
  
* Unmerged path net/ipv4/syncookies.c
