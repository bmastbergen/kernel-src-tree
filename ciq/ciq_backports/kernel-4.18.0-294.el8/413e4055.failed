powerpc/numa: Use cpu node map of first sibling thread

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-294.el8
commit-author Srikar Dronamraju <srikar@linux.vnet.ibm.com>
commit 413e40550c5cfdba7e062aa6350a0d2448014519
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-294.el8/413e4055.failed

All the sibling threads of a core have to be part of the same node.
To ensure that all the sibling threads map to the same node, always
lookup/update the cpu-to-node map of the first thread in the core.

	Signed-off-by: Srikar Dronamraju <srikar@linux.vnet.ibm.com>
	Reported-by: Abdul Haleem <abdhalee@linux.vnet.ibm.com>
	Reviewed-by: Nathan Lynch <nathanl@linux.ibm.com>
	Signed-off-by: Michael Ellerman <mpe@ellerman.id.au>
Link: https://lore.kernel.org/r/20200129135301.24739-4-srikar@linux.vnet.ibm.com
(cherry picked from commit 413e40550c5cfdba7e062aa6350a0d2448014519)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/powerpc/mm/numa.c
diff --cc arch/powerpc/mm/numa.c
index 521195e99be3,518c6dbbccbe..000000000000
--- a/arch/powerpc/mm/numa.c
+++ b/arch/powerpc/mm/numa.c
@@@ -472,8 -467,9 +472,13 @@@ static int of_drconf_to_nid_single(stru
   */
  static int numa_setup_cpu(unsigned long lcpu)
  {
++<<<<<<< HEAD
 +	int nid = -1;
++=======
++>>>>>>> 413e40550c5c (powerpc/numa: Use cpu node map of first sibling thread)
  	struct device_node *cpu;
+ 	int fcpu = cpu_first_thread_sibling(lcpu);
+ 	int nid = NUMA_NO_NODE;
  
  	/*
  	 * If a valid cpu-to-node mapping is already available, use it
* Unmerged path arch/powerpc/mm/numa.c
