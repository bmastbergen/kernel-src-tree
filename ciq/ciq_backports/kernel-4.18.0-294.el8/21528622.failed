IB/mlx5: Limit the scope of struct mlx5_bfreg_info to mlx5_ib

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-294.el8
commit-author Leon Romanovsky <leon@kernel.org>
commit 2152862298fbfd237d37c231dfca8ae8f3ed0e48
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-294.el8/21528622.failed

struct mlx5_bfreg_info is used by mlx5_ib only but is exposed to both RDMA
and netdev parts of mlx5 driver. Move that struct to mlx5_ib namespace,
clean vertical space alignment and convert lib_uar_4k from bool to
bitfield.

Link: https://lore.kernel.org/r/20200324060143.1569116-5-leon@kernel.org
	Signed-off-by: Leon Romanovsky <leonro@mellanox.com>
	Signed-off-by: Jason Gunthorpe <jgg@mellanox.com>
(cherry picked from commit 2152862298fbfd237d37c231dfca8ae8f3ed0e48)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	include/linux/mlx5/driver.h
diff --cc include/linux/mlx5/driver.h
index 8e4f0e07fb29,a30d834fdf7e..000000000000
--- a/include/linux/mlx5/driver.h
+++ b/include/linux/mlx5/driver.h
@@@ -214,29 -213,6 +214,32 @@@ enum mlx5_port_status 
  	MLX5_PORT_DOWN      = 2,
  };
  
++<<<<<<< HEAD
 +struct mlx5_bfreg_info {
 +	u32		       *sys_pages;
 +	int			num_low_latency_bfregs;
 +	unsigned int	       *count;
 +
 +	/*
 +	 * protect bfreg allocation data structs
 +	 */
 +	struct mutex		lock;
 +	u32			ver;
 +	bool			lib_uar_4k;
 +	u32			num_sys_pages;
 +	u32			num_static_sys_pages;
 +	u32			total_num_bfregs;
 +	u32			num_dyn_bfregs;
 +};
 +
 +enum mlx5_cmdif_state {
 +	MLX5_CMDIF_STATE_UNINITIALIZED,
 +	MLX5_CMDIF_STATE_UP,
 +	MLX5_CMDIF_STATE_DOWN,
 +};
 +
++=======
++>>>>>>> 2152862298fb (IB/mlx5: Limit the scope of struct mlx5_bfreg_info to mlx5_ib)
  struct mlx5_cmd_first {
  	__be32		data[4];
  };
diff --git a/drivers/infiniband/hw/mlx5/mlx5_ib.h b/drivers/infiniband/hw/mlx5/mlx5_ib.h
index b2c552a6e848..e5bcd566e9c7 100644
--- a/drivers/infiniband/hw/mlx5/mlx5_ib.h
+++ b/drivers/infiniband/hw/mlx5/mlx5_ib.h
@@ -128,6 +128,23 @@ enum mlx5_ib_mmap_type {
 	MLX5_IB_MMAP_TYPE_UAR_NC = 4,
 };
 
+struct mlx5_bfreg_info {
+	u32 *sys_pages;
+	int num_low_latency_bfregs;
+	unsigned int *count;
+
+	/*
+	 * protect bfreg allocation data structs
+	 */
+	struct mutex lock;
+	u32 ver;
+	u8 lib_uar_4k : 1;
+	u32 num_sys_pages;
+	u32 num_static_sys_pages;
+	u32 total_num_bfregs;
+	u32 num_dyn_bfregs;
+};
+
 struct mlx5_ib_ucontext {
 	struct ib_ucontext	ibucontext;
 	struct list_head	db_page_list;
* Unmerged path include/linux/mlx5/driver.h
