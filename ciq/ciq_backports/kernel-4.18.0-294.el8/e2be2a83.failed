x86/tboot: Don't disable swiotlb when iommu is forced on

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-294.el8
commit-author Lu Baolu <baolu.lu@linux.intel.com>
commit e2be2a833ab5338fa5b8b99ba622b911d96f1795
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-294.el8/e2be2a83.failed

After commit 327d5b2fee91c ("iommu/vt-d: Allow 32bit devices to uses DMA
domain"), swiotlb could also be used for direct memory access if IOMMU
is enabled but a device is configured to pass through the DMA translation.
Keep swiotlb when IOMMU is forced on, otherwise, some devices won't work
if "iommu=pt" kernel parameter is used.

Fixes: 327d5b2fee91 ("iommu/vt-d: Allow 32bit devices to uses DMA domain")
Reported-and-tested-by: Adrian Huang <ahuang12@lenovo.com>
	Signed-off-by: Lu Baolu <baolu.lu@linux.intel.com>
Link: https://lore.kernel.org/r/20201125014124.4070776-1-baolu.lu@linux.intel.com
Bugzilla: https://bugzilla.kernel.org/show_bug.cgi?id=210237
	Signed-off-by: Will Deacon <will@kernel.org>
(cherry picked from commit e2be2a833ab5338fa5b8b99ba622b911d96f1795)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/x86/kernel/tboot.c
diff --cc arch/x86/kernel/tboot.c
index 6e5ef8fb8a02,ae64f98ec2ab..000000000000
--- a/arch/x86/kernel/tboot.c
+++ b/arch/x86/kernel/tboot.c
@@@ -525,16 -514,10 +525,18 @@@ int tboot_force_iommu(void
  	if (!tboot_enabled())
  		return 0;
  
++<<<<<<< HEAD
 +	if (intel_iommu_tboot_noforce)
 +		return 1;
 +
 +	if (no_iommu || swiotlb || dmar_disabled)
 +		pr_warning("Forcing Intel-IOMMU to enabled\n");
++=======
+ 	if (no_iommu || dmar_disabled)
+ 		pr_warn("Forcing Intel-IOMMU to enabled\n");
++>>>>>>> e2be2a833ab5 (x86/tboot: Don't disable swiotlb when iommu is forced on)
  
  	dmar_disabled = 0;
- #ifdef CONFIG_SWIOTLB
- 	swiotlb = 0;
- #endif
  	no_iommu = 0;
  
  	return 1;
* Unmerged path arch/x86/kernel/tboot.c
