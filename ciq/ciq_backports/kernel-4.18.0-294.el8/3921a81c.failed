net: ena: xdp: update napi budget for DROP and ABORTED

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-294.el8
commit-author Sameeh Jubran <sameehj@amazon.com>
commit 3921a81c31df6057183aeb7f7d204003bf699d6f
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-294.el8/3921a81c.failed

This patch fixes two issues with XDP:

1. If the XDP verdict is XDP_ABORTED we break the loop, which results in
   us handling one buffer per napi cycle instead of the total budget
   (usually 64). To overcome this simply change the xdp_verdict check to
   != XDP_PASS. When the verdict is XDP_PASS, the skb is not expected to
   be NULL.

2. Update the residual budget for XDP_DROP and XDP_ABORTED, since
   packets are handled in these cases.

Fixes: 548c4940b9f1 ("net: ena: Implement XDP_TX action")
	Signed-off-by: Sameeh Jubran <sameehj@amazon.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 3921a81c31df6057183aeb7f7d204003bf699d6f)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/amazon/ena/ena_netdev.c
diff --cc drivers/net/ethernet/amazon/ena/ena_netdev.c
index c8d0e2454b88,dda4b8fc9525..000000000000
--- a/drivers/net/ethernet/amazon/ena/ena_netdev.c
+++ b/drivers/net/ethernet/amazon/ena/ena_netdev.c
@@@ -1250,6 -1646,9 +1250,12 @@@ static int ena_clean_rx_irq(struct ena_
  					 &next_to_clean);
  
  		if (unlikely(!skb)) {
++<<<<<<< HEAD
++=======
+ 			if (xdp_verdict == XDP_TX)
+ 				ena_free_rx_page(rx_ring,
+ 						 &rx_ring->rx_buffer_info[rx_ring->ena_bufs[0].req_id]);
++>>>>>>> 3921a81c31df (net: ena: xdp: update napi budget for DROP and ABORTED)
  			for (i = 0; i < ena_rx_ctx.descs; i++) {
  				rx_ring->free_ids[next_to_clean] =
  					rx_ring->ena_bufs[i].req_id;
@@@ -1257,8 -1656,10 +1263,14 @@@
  					ENA_RX_RING_IDX_NEXT(next_to_clean,
  							     rx_ring->ring_size);
  			}
++<<<<<<< HEAD
 +			if (xdp_verdict == XDP_DROP)
++=======
+ 			if (xdp_verdict != XDP_PASS) {
+ 				res_budget--;
++>>>>>>> 3921a81c31df (net: ena: xdp: update napi budget for DROP and ABORTED)
  				continue;
+ 			}
  			break;
  		}
  
* Unmerged path drivers/net/ethernet/amazon/ena/ena_netdev.c
