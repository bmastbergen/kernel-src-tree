md: only calculate blocksize once and use i_blocksize()

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-294.el8
commit-author Xianting Tian <tian.xianting@h3c.com>
commit 313b825fa218bef78419d7b4092c1f4af222335d
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-294.el8/313b825f.failed

We alreday has the interface i_blocksize(), which can be used
to get blocksize, so use it.
Only calculate blocksize once and use it within read_page().

	Signed-off-by: Xianting Tian <tian.xianting@h3c.com>
	Signed-off-by: Song Liu <songliubraving@fb.com>
(cherry picked from commit 313b825fa218bef78419d7b4092c1f4af222335d)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/md/md-bitmap.c
diff --cc drivers/md/md-bitmap.c
index 7eea8df75451,55b757a223a4..000000000000
--- a/drivers/md/md-bitmap.c
+++ b/drivers/md/md-bitmap.c
@@@ -363,7 -356,8 +363,12 @@@ static int read_page(struct file *file
  	int ret = 0;
  	struct inode *inode = file_inode(file);
  	struct buffer_head *bh;
++<<<<<<< HEAD
 +	sector_t block;
++=======
+ 	sector_t block, blk_cur;
+ 	unsigned long blocksize = i_blocksize(inode);
++>>>>>>> 313b825fa218 (md: only calculate blocksize once and use i_blocksize())
  
  	pr_debug("read bitmap file (%dB @ %llu)\n", (int)PAGE_SIZE,
  		 (unsigned long long)index << PAGE_SHIFT);
@@@ -379,17 -373,21 +384,17 @@@
  		if (count == 0)
  			bh->b_blocknr = 0;
  		else {
 -			ret = bmap(inode, &block);
 -			if (ret || !block) {
 +			bh->b_blocknr = bmap(inode, block);
 +			if (bh->b_blocknr == 0) {
 +				/* Cannot use this file! */
  				ret = -EINVAL;
 -				bh->b_blocknr = 0;
  				goto out;
  			}
 -
 -			bh->b_blocknr = block;
  			bh->b_bdev = inode->i_sb->s_bdev;
- 			if (count < (1<<inode->i_blkbits))
+ 			if (count < blocksize)
  				count = 0;
  			else
- 				count -= (1<<inode->i_blkbits);
+ 				count -= blocksize;
  
  			bh->b_end_io = end_bitmap_write;
  			bh->b_private = bitmap;
* Unmerged path drivers/md/md-bitmap.c
