block: remove rcu_read_lock() from part_stat_lock()

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-294.el8
commit-author Konstantin Khlebnikov <khlebnikov@yandex-team.ru>
commit 8ab1d40a646e753adb6814642432a093d93dbf47
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-294.el8/8ab1d40a.failed

The RCU lock is required only in disk_map_sector_rcu() to lookup the
partition.  After that request holds reference to related hd_struct.

Replace get_cpu() with preempt_disable() - returned cpu index is unused.

[hch: rebased]

	Signed-off-by: Konstantin Khlebnikov <khlebnikov@yandex-team.ru>
	Signed-off-by: Christoph Hellwig <hch@lst.de>
	Signed-off-by: Jens Axboe <axboe@kernel.dk>
(cherry picked from commit 8ab1d40a646e753adb6814642432a093d93dbf47)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	block/genhd.c
#	include/linux/part_stat.h
diff --cc block/genhd.c
index a40c6bd653e9,1a7659327664..000000000000
--- a/block/genhd.c
+++ b/block/genhd.c
@@@ -325,11 -340,14 +326,19 @@@ struct hd_struct *disk_map_sector_rcu(s
  			if (!hd_struct_try_get(part))
  				break;
  			rcu_assign_pointer(ptbl->last_lookup, part);
- 			return part;
+ 			goto out_unlock;
  		}
  	}
++<<<<<<< HEAD
 +	hd_struct_get(&disk->part0);
 +	return &disk->part0;
++=======
+ 
+ 	part = &disk->part0;
+ out_unlock:
+ 	rcu_read_unlock();
+ 	return part;
++>>>>>>> 8ab1d40a646e (block: remove rcu_read_lock() from part_stat_lock())
  }
  
  /**
* Unmerged path include/linux/part_stat.h
* Unmerged path block/genhd.c
* Unmerged path include/linux/part_stat.h
