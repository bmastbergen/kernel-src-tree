net/mlx5: E-switch, Avoid extack error log for disabled vport

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-294.el8
commit-author Parav Pandit <parav@nvidia.com>
commit ae35859445607f7f18dd4f332749219cd636ed59
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-294.el8/ae358594.failed

When E-switch vport is disabled, querying its hardware address is
unsupported.
Avoid setting extack error log message in such case.

Fixes: f099fde16db3 ("net/mlx5: E-switch, Support querying port function mac address")
	Signed-off-by: Parav Pandit <parav@nvidia.com>
	Reviewed-by: Roi Dayan <roid@nvidia.com>
	Signed-off-by: Saeed Mahameed <saeedm@nvidia.com>
(cherry picked from commit ae35859445607f7f18dd4f332749219cd636ed59)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/mellanox/mlx5/core/eswitch.c
diff --cc drivers/net/ethernet/mellanox/mlx5/core/eswitch.c
index fbe1d587403b,e8e6294c7cca..000000000000
--- a/drivers/net/ethernet/mellanox/mlx5/core/eswitch.c
+++ b/drivers/net/ethernet/mellanox/mlx5/core/eswitch.c
@@@ -1835,6 -1866,83 +1835,86 @@@ int mlx5_eswitch_set_vport_mac(struct m
  	return err;
  }
  
++<<<<<<< HEAD
++=======
+ static bool
+ is_port_function_supported(const struct mlx5_eswitch *esw, u16 vport_num)
+ {
+ 	return vport_num == MLX5_VPORT_PF ||
+ 	       mlx5_eswitch_is_vf_vport(esw, vport_num);
+ }
+ 
+ int mlx5_devlink_port_function_hw_addr_get(struct devlink *devlink,
+ 					   struct devlink_port *port,
+ 					   u8 *hw_addr, int *hw_addr_len,
+ 					   struct netlink_ext_ack *extack)
+ {
+ 	struct mlx5_eswitch *esw;
+ 	struct mlx5_vport *vport;
+ 	int err = -EOPNOTSUPP;
+ 	u16 vport_num;
+ 
+ 	esw = mlx5_devlink_eswitch_get(devlink);
+ 	if (IS_ERR(esw))
+ 		return PTR_ERR(esw);
+ 
+ 	vport_num = mlx5_esw_devlink_port_index_to_vport_num(port->index);
+ 	if (!is_port_function_supported(esw, vport_num))
+ 		return -EOPNOTSUPP;
+ 
+ 	vport = mlx5_eswitch_get_vport(esw, vport_num);
+ 	if (IS_ERR(vport)) {
+ 		NL_SET_ERR_MSG_MOD(extack, "Invalid port");
+ 		return PTR_ERR(vport);
+ 	}
+ 
+ 	mutex_lock(&esw->state_lock);
+ 	if (vport->enabled) {
+ 		ether_addr_copy(hw_addr, vport->info.mac);
+ 		*hw_addr_len = ETH_ALEN;
+ 		err = 0;
+ 	}
+ 	mutex_unlock(&esw->state_lock);
+ 	return err;
+ }
+ 
+ int mlx5_devlink_port_function_hw_addr_set(struct devlink *devlink,
+ 					   struct devlink_port *port,
+ 					   const u8 *hw_addr, int hw_addr_len,
+ 					   struct netlink_ext_ack *extack)
+ {
+ 	struct mlx5_eswitch *esw;
+ 	struct mlx5_vport *vport;
+ 	int err = -EOPNOTSUPP;
+ 	u16 vport_num;
+ 
+ 	esw = mlx5_devlink_eswitch_get(devlink);
+ 	if (IS_ERR(esw)) {
+ 		NL_SET_ERR_MSG_MOD(extack, "Eswitch doesn't support set hw_addr");
+ 		return PTR_ERR(esw);
+ 	}
+ 
+ 	vport_num = mlx5_esw_devlink_port_index_to_vport_num(port->index);
+ 	if (!is_port_function_supported(esw, vport_num)) {
+ 		NL_SET_ERR_MSG_MOD(extack, "Port doesn't support set hw_addr");
+ 		return -EINVAL;
+ 	}
+ 	vport = mlx5_eswitch_get_vport(esw, vport_num);
+ 	if (IS_ERR(vport)) {
+ 		NL_SET_ERR_MSG_MOD(extack, "Invalid port");
+ 		return PTR_ERR(vport);
+ 	}
+ 
+ 	mutex_lock(&esw->state_lock);
+ 	if (vport->enabled)
+ 		err = mlx5_esw_set_vport_mac_locked(esw, vport, hw_addr);
+ 	else
+ 		NL_SET_ERR_MSG_MOD(extack, "Eswitch vport is disabled");
+ 	mutex_unlock(&esw->state_lock);
+ 	return err;
+ }
+ 
++>>>>>>> ae3585944560 (net/mlx5: E-switch, Avoid extack error log for disabled vport)
  int mlx5_eswitch_set_vport_state(struct mlx5_eswitch *esw,
  				 u16 vport, int link_state)
  {
* Unmerged path drivers/net/ethernet/mellanox/mlx5/core/eswitch.c
