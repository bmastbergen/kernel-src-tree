bpf: factor out a bpf_trace_copy_string helper

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-294.el8
commit-author Christoph Hellwig <hch@lst.de>
commit d7b2977b816223a884814eea46fbe38e192cec4c
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-294.el8/d7b2977b.failed

Split out a helper to do the fault free access to the string pointer
to get it out of a crazy indentation level.

	Signed-off-by: Christoph Hellwig <hch@lst.de>
	Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
	Cc: Alexei Starovoitov <ast@kernel.org>
	Cc: Daniel Borkmann <daniel@iogearbox.net>
	Cc: "H. Peter Anvin" <hpa@zytor.com>
	Cc: Ingo Molnar <mingo@elte.hu>
	Cc: Masami Hiramatsu <mhiramat@kernel.org>
	Cc: Thomas Gleixner <tglx@linutronix.de>
Link: http://lkml.kernel.org/r/20200521152301.2587579-12-hch@lst.de
	Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
(cherry picked from commit d7b2977b816223a884814eea46fbe38e192cec4c)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	kernel/trace/bpf_trace.c
diff --cc kernel/trace/bpf_trace.c
index 5481c35d2b9d,60e82c7b8122..000000000000
--- a/kernel/trace/bpf_trace.c
+++ b/kernel/trace/bpf_trace.c
@@@ -400,24 -428,8 +422,29 @@@ fmt_str
  				break;
  			}
  
++<<<<<<< HEAD
 +			buf[0] = 0;
 +			switch (fmt_ptype) {
 +			case 's':
 +#ifdef CONFIG_ARCH_HAS_NON_OVERLAPPING_ADDRESS_SPACE
 +				strncpy_from_unsafe(buf, unsafe_ptr,
 +						    sizeof(buf));
 +				break;
 +#endif
 +			case 'k':
 +				strncpy_from_unsafe_strict(buf, unsafe_ptr,
 +							   sizeof(buf));
 +				break;
 +			case 'u':
 +				strncpy_from_unsafe_user(buf,
 +					(__force void __user *)unsafe_ptr,
 +							 sizeof(buf));
 +				break;
 +			}
++=======
+ 			bpf_trace_copy_string(buf, unsafe_ptr, fmt_ptype,
+ 					sizeof(buf));
++>>>>>>> d7b2977b8162 (bpf: factor out a bpf_trace_copy_string helper)
  			goto fmt_next;
  		}
  
* Unmerged path kernel/trace/bpf_trace.c
