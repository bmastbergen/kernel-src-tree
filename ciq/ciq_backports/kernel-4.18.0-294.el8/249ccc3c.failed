net/mlx5e: Add support for offloading traffic from uplink to uplink

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-294.el8
commit-author Eli Cohen <eli@mellanox.com>
commit 249ccc3c95bd1bca17406b5b3d0474fd67220931
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-294.el8/249ccc3c.failed

Termination tables change the direction of a packet in hw from RX to SX
pipeline. Use that to offload hairpin flows received from uplink and
sent back to uplink.

Currently termination tables are used for pushing VLAN to packets
received from uplink and targeting a VF. Extend the implementation to
allow forwarding packets to uplink. These packets can either be
encapsulated or not.

In case encapsulation is needed before forwarding, move the reformat
object to the termination table as required.

Extend the hash table key to include tunnel information for the sake of
reusing reformat objects.

	Signed-off-by: Eli Cohen <eli@mellanox.com>
	Reviewed-by: Oz Shlomo <ozsh@mellanox.com>
	Signed-off-by: Saeed Mahameed <saeedm@mellanox.com>
(cherry picked from commit 249ccc3c95bd1bca17406b5b3d0474fd67220931)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/mellanox/mlx5/core/eswitch_offloads_termtbl.c
diff --cc drivers/net/ethernet/mellanox/mlx5/core/eswitch_offloads_termtbl.c
index 269eddc3d38b,17a0d2bc102b..000000000000
--- a/drivers/net/ethernet/mellanox/mlx5/core/eswitch_offloads_termtbl.c
+++ b/drivers/net/ethernet/mellanox/mlx5/core/eswitch_offloads_termtbl.c
@@@ -198,7 -231,12 +231,15 @@@ mlx5_eswitch_termtbl_required(struct ml
  			      struct mlx5_flow_act *flow_act,
  			      struct mlx5_flow_spec *spec)
  {
++<<<<<<< HEAD
 +	if (!MLX5_CAP_ESW_FLOWTABLE_FDB(esw->dev, termination_table))
++=======
+ 	int i;
+ 
+ 	if (!MLX5_CAP_ESW_FLOWTABLE_FDB(esw->dev, termination_table) ||
+ 	    attr->flags & MLX5_ESW_ATTR_FLAG_SLOW_PATH ||
+ 	    !mlx5_eswitch_offload_is_uplink_port(esw, spec))
++>>>>>>> 249ccc3c95bd (net/mlx5e: Add support for offloading traffic from uplink to uplink)
  		return false;
  
  	/* push vlan on RX */
* Unmerged path drivers/net/ethernet/mellanox/mlx5/core/eswitch_offloads_termtbl.c
