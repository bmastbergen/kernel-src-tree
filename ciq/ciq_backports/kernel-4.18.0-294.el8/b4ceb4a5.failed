iommu: Tidy up Kconfig for SoC IOMMUs

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-294.el8
commit-author Robin Murphy <robin.murphy@arm.com>
commit b4ceb4a5359ed1c9ba4a20acf3a70d4bbead3248
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-294.el8/b4ceb4a5.failed

Wacky COMPILE_TEST dependencies based on who used to define
dev_archdata.iommu can go.

Dependencies on ARM or ARM64 already implied by the ARCH_* platform
selection can go.

The entire IOMMU_SUPPORT menu already depends on MMU, so those can go.

IOMMU_DMA is for the architecture's DMA API implementation to choose,
and its interface to IOMMU drivers is properly stubbed out if disabled,
so dependencies on or selections of that can go (AMD_IOMMU is the
current exception since the x86 drivers have to provide their own entire
dma_map_ops implementation).

Since commit ed6ccf10f24b ("dma-mapping: properly stub out the DMA API
for !CONFIG_HAS_DMA"), drivers which simply use the dma-mapping API
should not need to depend on HAS_DMA, so those can go.

And a long-dead option for code removed from the MSM driver 4 years ago
can also go.

	Signed-off-by: Robin Murphy <robin.murphy@arm.com>
Link: https://lore.kernel.org/r/7fb9c74dc6bd12a4619ca44c92408e91352f1be0.1593791968.git.robin.murphy@arm.com
	Signed-off-by: Joerg Roedel <jroedel@suse.de>
(cherry picked from commit b4ceb4a5359ed1c9ba4a20acf3a70d4bbead3248)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/iommu/Kconfig
diff --cc drivers/iommu/Kconfig
index e0bc43a8d316,4dcd85bbff99..000000000000
--- a/drivers/iommu/Kconfig
+++ b/drivers/iommu/Kconfig
@@@ -273,10 -270,9 +269,13 @@@ config IRQ_REMA
  # OMAP IOMMU support
  config OMAP_IOMMU
  	bool "OMAP IOMMU Support"
++<<<<<<< HEAD
 +	depends on ARM && MMU
++=======
++>>>>>>> b4ceb4a5359e (iommu: Tidy up Kconfig for SoC IOMMUs)
  	depends on ARCH_OMAP2PLUS || COMPILE_TEST
  	select IOMMU_API
 -	help
 +	---help---
  	  The OMAP3 media platform drivers depend on iommu support,
  	  if you need them say Y here.
  
@@@ -291,7 -287,6 +290,10 @@@ config OMAP_IOMMU_DEBU
  
  config ROCKCHIP_IOMMU
  	bool "Rockchip IOMMU Support"
++<<<<<<< HEAD
 +	depends on ARM || ARM64
++=======
++>>>>>>> b4ceb4a5359e (iommu: Tidy up Kconfig for SoC IOMMUs)
  	depends on ARCH_ROCKCHIP || COMPILE_TEST
  	select IOMMU_API
  	select ARM_DMA_USE_IOMMU
@@@ -302,6 -297,14 +304,17 @@@
  	  Say Y here if you are using a Rockchip SoC that includes an IOMMU
  	  device.
  
++<<<<<<< HEAD
++=======
+ config SUN50I_IOMMU
+ 	bool "Allwinner H6 IOMMU Support"
+ 	depends on ARCH_SUNXI || COMPILE_TEST
+ 	select ARM_DMA_USE_IOMMU
+ 	select IOMMU_API
+ 	help
+ 	  Support for the IOMMU introduced in the Allwinner H6 SoCs.
+ 
++>>>>>>> b4ceb4a5359e (iommu: Tidy up Kconfig for SoC IOMMUs)
  config TEGRA_IOMMU_GART
  	bool "Tegra GART IOMMU Support"
  	depends on ARCH_TEGRA_2x_SOC
@@@ -324,7 -328,7 +337,11 @@@ config TEGRA_IOMMU_SMM
  
  config EXYNOS_IOMMU
  	bool "Exynos IOMMU Support"
++<<<<<<< HEAD
 +	depends on ARCH_EXYNOS && MMU
++=======
+ 	depends on ARCH_EXYNOS || COMPILE_TEST
++>>>>>>> b4ceb4a5359e (iommu: Tidy up Kconfig for SoC IOMMUs)
  	depends on !CPU_BIG_ENDIAN # revisit driver if we can enable big-endian ptes
  	select IOMMU_API
  	select ARM_DMA_USE_IOMMU
@@@ -368,8 -372,8 +385,13 @@@ config SPAPR_TCE_IOMM
  
  # ARM IOMMU support
  config ARM_SMMU
++<<<<<<< HEAD
 +	bool "ARM Ltd. System MMU (SMMU) Support"
 +	depends on (ARM64 || ARM) && MMU
++=======
+ 	tristate "ARM Ltd. System MMU (SMMU) Support"
+ 	depends on ARM64 || ARM || (COMPILE_TEST && !GENERIC_ATOMIC64)
++>>>>>>> b4ceb4a5359e (iommu: Tidy up Kconfig for SoC IOMMUs)
  	select IOMMU_API
  	select IOMMU_IO_PGTABLE_LPAE
  	select ARM_DMA_USE_IOMMU if ARM
@@@ -418,7 -459,6 +440,10 @@@ config S390_AP_IOMM
  
  config MTK_IOMMU
  	bool "MTK IOMMU Support"
++<<<<<<< HEAD
 +	depends on ARM || ARM64
++=======
++>>>>>>> b4ceb4a5359e (iommu: Tidy up Kconfig for SoC IOMMUs)
  	depends on ARCH_MEDIATEK || COMPILE_TEST
  	select ARM_DMA_USE_IOMMU
  	select IOMMU_API
* Unmerged path drivers/iommu/Kconfig
