net: ena: move llq configuration from ena_probe to ena_device_init()

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-294.el8
commit-author Arthur Kiyanovski <akiyano@amazon.com>
commit c29efeae37077f4bcb2ecd710fc66ca72c43ec79
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-294.el8/c29efeae.failed

When the ENA device resets to recover from some error state, all LLQ
configuration values are reset to their defaults, because LLQ is
initialized only once during ena_probe().

Changes in this commit:
1. Move the LLQ configuration process into ena_init_device()
which is called from both ena_probe() and ena_restore_device(). This
way, LLQ setup configurations that are different from the default
values will survive resets.

2. Extract the LLQ bar mapping to ena_map_llq_bar(),
and call once in the lifetime of the driver from ena_probe(),
since there is no need to unmap and map the LLQ bar again every reset.

3. Map the LLQ bar if it exists, regardless if initialization of LLQ
placement policy (ENA_ADMIN_PLACEMENT_POLICY_DEV) succeeded
or not. Initialization might fail the first time, falling back to the
ENA_ADMIN_PLACEMENT_POLICY_HOST placement policy, but later succeed
after device reset, in which case the LLQ bar needs to be mapped
already.

	Signed-off-by: Sameeh Jubran <sameehj@amazon.com>
	Signed-off-by: Arthur Kiyanovski <akiyano@amazon.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit c29efeae37077f4bcb2ecd710fc66ca72c43ec79)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/amazon/ena/ena_netdev.c
diff --cc drivers/net/ethernet/amazon/ena/ena_netdev.c
index 081e61da3092,913d698b9834..000000000000
--- a/drivers/net/ethernet/amazon/ena/ena_netdev.c
+++ b/drivers/net/ethernet/amazon/ena/ena_netdev.c
@@@ -3656,9 -4144,8 +3670,12 @@@ static int ena_calc_io_queue_size(struc
   */
  static int ena_probe(struct pci_dev *pdev, const struct pci_device_id *ent)
  {
 -	struct ena_calc_queue_size_ctx calc_queue_ctx = { 0 };
  	struct ena_com_dev_get_features_ctx get_feat_ctx;
++<<<<<<< HEAD
 +	struct ena_calc_queue_size_ctx calc_queue_ctx = { 0 };
 +	struct ena_llq_configurations llq_config;
++=======
++>>>>>>> c29efeae3707 (net: ena: move llq configuration from ena_probe to ena_device_init())
  	struct ena_com_dev *ena_dev = NULL;
  	struct ena_adapter *adapter;
  	struct net_device *netdev;
* Unmerged path drivers/net/ethernet/amazon/ena/ena_netdev.c
