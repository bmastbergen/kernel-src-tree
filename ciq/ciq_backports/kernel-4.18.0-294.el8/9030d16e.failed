vfs: Convert bdev to use the new mount API

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-294.el8
commit-author David Howells <dhowells@redhat.com>
commit 9030d16eb8adcbf9e80d20b909856c6fdabfdec4
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-294.el8/9030d16e.failed

Convert the bdev filesystem to the new internal mount API as the old
one will be obsoleted and removed.  This allows greater flexibility in
communication of mount parameters between userspace, the VFS and the
filesystem.

See Documentation/filesystems/mount_api.txt for more information.

	Signed-off-by: David Howells <dhowells@redhat.com>
cc: Jens Axboe <axboe@kernel.dk>
cc: linux-fsdevel@vger.kernel.org
	Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>
(cherry picked from commit 9030d16eb8adcbf9e80d20b909856c6fdabfdec4)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	fs/block_dev.c
diff --cc fs/block_dev.c
index 9233529a6f8f,1d051b962159..000000000000
--- a/fs/block_dev.c
+++ b/fs/block_dev.c
@@@ -843,14 -834,14 +844,22 @@@ static const struct super_operations bd
  	.evict_inode = bdev_evict_inode,
  };
  
- static struct dentry *bd_mount(struct file_system_type *fs_type,
- 	int flags, const char *dev_name, void *data)
+ static int bd_init_fs_context(struct fs_context *fc)
  {
++<<<<<<< HEAD
 +	struct dentry *dent;
 +	dent = mount_pseudo(fs_type, "bdev:", &bdev_sops, NULL, BDEVFS_MAGIC);
 +	if (!IS_ERR(dent))
 +		dent->d_sb->s_iflags |= SB_I_CGROUPWB;
 +	return dent;
++=======
+ 	struct pseudo_fs_context *ctx = init_pseudo(fc, BDEVFS_MAGIC);
+ 	if (!ctx)
+ 		return -ENOMEM;
+ 	fc->s_iflags |= SB_I_CGROUPWB;
+ 	ctx->ops = &bdev_sops;
+ 	return 0;
++>>>>>>> 9030d16eb8ad (vfs: Convert bdev to use the new mount API)
  }
  
  static struct file_system_type bd_type = {
* Unmerged path fs/block_dev.c
