net: bridge: Fix a warning when del bridge sysfs

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-294.el8
Rebuild_CHGLOG: - [net] bridge: Fix a warning when del bridge sysfs (Davide Caratti) [1917518]
Rebuild_FUZZ: 94.51%
commit-author Wang Hai <wanghai38@huawei.com>
commit 989a1db06eb18ff605377eec87e18d795e0ec74b
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-294.el8/989a1db0.failed

I got a warining report:

br_sysfs_addbr: can't create group bridge4/bridge
------------[ cut here ]------------
sysfs group 'bridge' not found for kobject 'bridge4'
WARNING: CPU: 2 PID: 9004 at fs/sysfs/group.c:279 sysfs_remove_group fs/sysfs/group.c:279 [inline]
WARNING: CPU: 2 PID: 9004 at fs/sysfs/group.c:279 sysfs_remove_group+0x153/0x1b0 fs/sysfs/group.c:270
Modules linked in: iptable_nat
...
Call Trace:
  br_dev_delete+0x112/0x190 net/bridge/br_if.c:384
  br_dev_newlink net/bridge/br_netlink.c:1381 [inline]
  br_dev_newlink+0xdb/0x100 net/bridge/br_netlink.c:1362
  __rtnl_newlink+0xe11/0x13f0 net/core/rtnetlink.c:3441
  rtnl_newlink+0x64/0xa0 net/core/rtnetlink.c:3500
  rtnetlink_rcv_msg+0x385/0x980 net/core/rtnetlink.c:5562
  netlink_rcv_skb+0x134/0x3d0 net/netlink/af_netlink.c:2494
  netlink_unicast_kernel net/netlink/af_netlink.c:1304 [inline]
  netlink_unicast+0x4a0/0x6a0 net/netlink/af_netlink.c:1330
  netlink_sendmsg+0x793/0xc80 net/netlink/af_netlink.c:1919
  sock_sendmsg_nosec net/socket.c:651 [inline]
  sock_sendmsg+0x139/0x170 net/socket.c:671
  ____sys_sendmsg+0x658/0x7d0 net/socket.c:2353
  ___sys_sendmsg+0xf8/0x170 net/socket.c:2407
  __sys_sendmsg+0xd3/0x190 net/socket.c:2440
  do_syscall_64+0x33/0x40 arch/x86/entry/common.c:46
  entry_SYSCALL_64_after_hwframe+0x44/0xa9

In br_device_event(), if the bridge sysfs fails to be added,
br_device_event() should return error. This can prevent warining
when removing bridge sysfs that do not exist.

Fixes: bb900b27a2f4 ("bridge: allow creating bridge devices with netlink")
	Reported-by: Hulk Robot <hulkci@huawei.com>
	Signed-off-by: Wang Hai <wanghai38@huawei.com>
	Tested-by: Nikolay Aleksandrov <nikolay@nvidia.com>
	Acked-by: Nikolay Aleksandrov <nikolay@nvidia.com>
Link: https://lore.kernel.org/r/20201211122921.40386-1-wanghai38@huawei.com
	Signed-off-by: Jakub Kicinski <kuba@kernel.org>
(cherry picked from commit 989a1db06eb18ff605377eec87e18d795e0ec74b)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/bridge/br.c
diff --cc net/bridge/br.c
index 814c3c52e8f7,1b169f8e7491..000000000000
--- a/net/bridge/br.c
+++ b/net/bridge/br.c
@@@ -40,10 -36,19 +40,26 @@@ static int br_device_event(struct notif
  	bool changed_addr;
  	int err;
  
++<<<<<<< HEAD
 +	/* register of bridge completed, add sysfs entries */
 +	if ((dev->priv_flags & IFF_EBRIDGE) && event == NETDEV_REGISTER) {
 +		br_sysfs_addbr(dev);
 +		return NOTIFY_DONE;
++=======
+ 	if (dev->priv_flags & IFF_EBRIDGE) {
+ 		err = br_vlan_bridge_event(dev, event, ptr);
+ 		if (err)
+ 			return notifier_from_errno(err);
+ 
+ 		if (event == NETDEV_REGISTER) {
+ 			/* register of bridge completed, add sysfs entries */
+ 			err = br_sysfs_addbr(dev);
+ 			if (err)
+ 				return notifier_from_errno(err);
+ 
+ 			return NOTIFY_DONE;
+ 		}
++>>>>>>> 989a1db06eb1 (net: bridge: Fix a warning when del bridge sysfs)
  	}
  
  	/* not a port of a bridge */
* Unmerged path net/bridge/br.c
