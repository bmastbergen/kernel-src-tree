mptcp: fix locking in mptcp_disconnect()

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-294.el8
commit-author Paolo Abeni <pabeni@redhat.com>
commit 13a9499e833387fcc7a53915bbe5cddf3c336b59
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-294.el8/13a9499e.failed

tcp_disconnect() expects the caller acquires the sock lock,
but mptcp_disconnect() is not doing that. Add the missing
required lock.

	Reported-by: Eric Dumazet <eric.dumazet@gmail.com>
Fixes: 76e2a55d1625 ("mptcp: better msk-level shutdown.")
	Signed-off-by: Paolo Abeni <pabeni@redhat.com>
Link: https://lore.kernel.org/r/f818e82b58a556feeb71dcccc8bf1c87aafc6175.1610638176.git.pabeni@redhat.com
	Signed-off-by: Jakub Kicinski <kuba@kernel.org>
(cherry picked from commit 13a9499e833387fcc7a53915bbe5cddf3c336b59)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/mptcp/protocol.c
diff --cc net/mptcp/protocol.c
index 509aa48ee70d,f998a077c7dd..000000000000
--- a/net/mptcp/protocol.c
+++ b/net/mptcp/protocol.c
@@@ -1713,11 -2642,17 +1713,25 @@@ static void mptcp_copy_inaddrs(struct s
  
  static int mptcp_disconnect(struct sock *sk, int flags)
  {
++<<<<<<< HEAD
 +	/* Should never be called.
 +	 * inet_stream_connect() calls ->disconnect, but that
 +	 * refers to the subflow socket, not the mptcp one.
 +	 */
 +	WARN_ON_ONCE(1);
++=======
+ 	struct mptcp_subflow_context *subflow;
+ 	struct mptcp_sock *msk = mptcp_sk(sk);
+ 
+ 	__mptcp_flush_join_list(msk);
+ 	mptcp_for_each_subflow(msk, subflow) {
+ 		struct sock *ssk = mptcp_subflow_tcp_sock(subflow);
+ 
+ 		lock_sock(ssk);
+ 		tcp_disconnect(ssk, flags);
+ 		release_sock(ssk);
+ 	}
++>>>>>>> 13a9499e8333 (mptcp: fix locking in mptcp_disconnect())
  	return 0;
  }
  
* Unmerged path net/mptcp/protocol.c
