s390/qdio: inline shared_ind()

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-294.el8
commit-author Julian Wiedmann <jwi@linux.ibm.com>
commit a8a4ee2740bb6224271f06742884ec375c42cb9e
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-294.el8/a8a4ee27.failed

This is just prep work for a subsequent patch, no functional change.

For the non-polling path we can pull the code chunk in front of the
for-loop, since it only evaluates to true for a 1-queue configuration.

	Signed-off-by: Julian Wiedmann <jwi@linux.ibm.com>
	Reviewed-by: Benjamin Block <bblock@linux.ibm.com>
	Signed-off-by: Vasily Gorbik <gor@linux.ibm.com>
(cherry picked from commit a8a4ee2740bb6224271f06742884ec375c42cb9e)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/s390/cio/qdio_thinint.c
diff --cc drivers/s390/cio/qdio_thinint.c
index 999b998ea0c9,c78c8dd18a89..000000000000
--- a/drivers/s390/cio/qdio_thinint.c
+++ b/drivers/s390/cio/qdio_thinint.c
@@@ -135,28 -131,25 +131,50 @@@ static inline void tiqdio_call_inq_hand
  	    has_multiple_inq_on_dsci(irq))
  		xchg(irq->dsci, 0);
  
++<<<<<<< HEAD
 +	for_each_input_queue(irq, q, i) {
 +		if (q->u.in.queue_start_poll) {
 +			/* skip if polling is enabled or already in work */
 +			if (test_and_set_bit(QDIO_QUEUE_IRQS_DISABLED,
 +					     &q->u.in.queue_irq_state)) {
 +				QDIO_PERF_STAT_INC(irq, int_discarded);
 +				continue;
 +			}
 +
 +			/* avoid dsci clear here, done after processing */
 +			q->u.in.queue_start_poll(irq->cdev, q->nr,
 +						 irq->int_parm);
 +		} else {
 +			if (!shared_ind(irq))
 +				xchg(irq->dsci, 0);
 +
 +			/*
 +			 * Call inbound processing but not directly
 +			 * since that could starve other thinint queues.
 +			 */
 +			tasklet_schedule(&q->tasklet);
 +		}
++=======
+ 	if (irq->irq_poll) {
+ 		if (!test_and_set_bit(QDIO_IRQ_DISABLED, &irq->poll_state))
+ 			irq->irq_poll(irq->cdev, irq->int_parm);
+ 		else
+ 			QDIO_PERF_STAT_INC(irq, int_discarded);
+ 
+ 		return;
+ 	}
+ 
+ 	if (!references_shared_dsci(irq) &&
+ 	    !has_multiple_inq_on_dsci(irq))
+ 		xchg(irq->dsci, 0);
+ 
+ 	for_each_input_queue(irq, q, i) {
+ 		/*
+ 		 * Call inbound processing but not directly
+ 		 * since that could starve other thinint queues.
+ 		 */
+ 		tasklet_schedule(&q->tasklet);
++>>>>>>> a8a4ee2740bb (s390/qdio: inline shared_ind())
  	}
  }
  
* Unmerged path drivers/s390/cio/qdio_thinint.c
