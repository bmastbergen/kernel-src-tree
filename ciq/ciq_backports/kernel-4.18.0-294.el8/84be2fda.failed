net/mlx5: Fix condition for termination table cleanup

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-294.el8
commit-author Eli Cohen <eli@mellanox.com>
commit 84be2fdae4f80b7388f754fe49149374a41725f2
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-294.el8/84be2fda.failed

When we destroy rules from slow path we need to avoid destroying
termination tables since termination tables are never created in slow
path. By doing so we avoid destroying the termination table created for the
slow path.

Fixes: d8a2034f152a ("net/mlx5: Don't use termination tables in slow path")
	Signed-off-by: Eli Cohen <eli@mellanox.com>
	Reviewed-by: Oz Shlomo <ozsh@mellanox.com>
	Signed-off-by: Saeed Mahameed <saeedm@mellanox.com>
(cherry picked from commit 84be2fdae4f80b7388f754fe49149374a41725f2)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/mellanox/mlx5/core/eswitch_offloads.c
diff --cc drivers/net/ethernet/mellanox/mlx5/core/eswitch_offloads.c
index 43ed228c4d29,b2e38e0cde97..000000000000
--- a/drivers/net/ethernet/mellanox/mlx5/core/eswitch_offloads.c
+++ b/drivers/net/ethernet/mellanox/mlx5/core/eswitch_offloads.c
@@@ -400,9 -397,7 +400,13 @@@ mlx5_eswitch_add_offloaded_rule(struct 
  		goto err_esw_get;
  	}
  
++<<<<<<< HEAD
 +	mlx5_eswitch_set_rule_flow_source(esw, spec, attr);
 +
 +	if (mlx5_eswitch_termtbl_required(esw, &flow_act, spec))
++=======
+ 	if (mlx5_eswitch_termtbl_required(esw, attr, &flow_act, spec))
++>>>>>>> 84be2fdae4f8 (net/mlx5: Fix condition for termination table cleanup)
  		rule = mlx5_eswitch_add_termtbl_rule(esw, fdb, spec, attr,
  						     &flow_act, dest, i);
  	else
@@@ -501,10 -495,12 +505,19 @@@ __mlx5_eswitch_del_rule(struct mlx5_esw
  
  	mlx5_del_flow_rules(rule);
  
++<<<<<<< HEAD
 +	/* unref the term table */
 +	for (i = 0; i < MLX5_MAX_FLOW_FWD_VPORTS; i++) {
 +		if (attr->dests[i].termtbl)
 +			mlx5_eswitch_termtbl_put(esw, attr->dests[i].termtbl);
++=======
+ 	if (!(attr->flags & MLX5_ESW_ATTR_FLAG_SLOW_PATH)) {
+ 		/* unref the term table */
+ 		for (i = 0; i < MLX5_MAX_FLOW_FWD_VPORTS; i++) {
+ 			if (attr->dests[i].termtbl)
+ 				mlx5_eswitch_termtbl_put(esw, attr->dests[i].termtbl);
+ 		}
++>>>>>>> 84be2fdae4f8 (net/mlx5: Fix condition for termination table cleanup)
  	}
  
  	atomic64_dec(&esw->offloads.num_flows);
* Unmerged path drivers/net/ethernet/mellanox/mlx5/core/eswitch_offloads.c
