xdp: introduce xdp_get_shared_info_from_{buff, frame} utility routines

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-294.el8
commit-author Lorenzo Bianconi <lorenzo@kernel.org>
commit 2f0bc54ba9a85032f2402faf0fccab513848300a
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-294.el8/2f0bc54b.failed

Introduce xdp_get_shared_info_from_{buff,frame} utility routines to get
skb_shared_info from xdp buffer/frame pointer.
xdp_get_shared_info_from_{buff,frame} will be used to implement xdp
multi-buffer support

	Signed-off-by: Lorenzo Bianconi <lorenzo@kernel.org>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 2f0bc54ba9a85032f2402faf0fccab513848300a)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	include/net/xdp.h
diff --cc include/net/xdp.h
index 6368152dc76c,d3005bef812f..000000000000
--- a/include/net/xdp.h
+++ b/include/net/xdp.h
@@@ -84,10 -70,27 +84,29 @@@ struct xdp_buff 
  	void *data_end;
  	void *data_meta;
  	void *data_hard_start;
 +	unsigned long handle;
  	struct xdp_rxq_info *rxq;
 -	struct xdp_txq_info *txq;
 -	u32 frame_sz; /* frame size to deduce data_hard_end/reserved tailroom*/
  };
  
++<<<<<<< HEAD
++=======
+ /* Reserve memory area at end-of data area.
+  *
+  * This macro reserves tailroom in the XDP buffer by limiting the
+  * XDP/BPF data access to data_hard_end.  Notice same area (and size)
+  * is used for XDP_PASS, when constructing the SKB via build_skb().
+  */
+ #define xdp_data_hard_end(xdp)				\
+ 	((xdp)->data_hard_start + (xdp)->frame_sz -	\
+ 	 SKB_DATA_ALIGN(sizeof(struct skb_shared_info)))
+ 
+ static inline struct skb_shared_info *
+ xdp_get_shared_info_from_buff(struct xdp_buff *xdp)
+ {
+ 	return (struct skb_shared_info *)xdp_data_hard_end(xdp);
+ }
+ 
++>>>>>>> 2f0bc54ba9a8 (xdp: introduce xdp_get_shared_info_from_{buff, frame} utility routines)
  struct xdp_frame {
  	void *data;
  	u16 len;
* Unmerged path include/net/xdp.h
