mptcp: put reference in mptcp timeout timer

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-294.el8
commit-author Florian Westphal <fw@strlen.de>
commit b6d69fc8e8cfd1694e709c16e6192339bde68923
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-294.el8/b6d69fc8.failed

On close this timer might be scheduled. mptcp uses sk_reset_timer for
this, so the a reference on the mptcp socket is taken.

This causes a refcount leak which can for example be reproduced
with 'mp_join_server_v4.pkt' from the mptcp-packetdrill repo.

The leak has nothing to do with join requests, v1_mp_capable_bind_no_cs.pkt
works too when replacing the last ack mpcapable to v1 instead of v0.

unreferenced object 0xffff888109bba040 (size 2744):
  comm "packetdrill", [..]
  backtrace:
    [..] sk_prot_alloc.isra.0+0x2b/0xc0
    [..] sk_clone_lock+0x2f/0x740
    [..] mptcp_sk_clone+0x33/0x1a0
    [..] subflow_syn_recv_sock+0x2b1/0x690 [..]

Fixes: e16163b6e2b7 ("mptcp: refactor shutdown and close")
	Cc: Davide Caratti <dcaratti@redhat.com>
	Signed-off-by: Florian Westphal <fw@strlen.de>
	Acked-by: Paolo Abeni <pabeni@redhat.com>
Link: https://lore.kernel.org/r/20201124162446.11448-1-fw@strlen.de
	Signed-off-by: Jakub Kicinski <kuba@kernel.org>
(cherry picked from commit b6d69fc8e8cfd1694e709c16e6192339bde68923)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/mptcp/protocol.c
diff --cc net/mptcp/protocol.c
index 75ee5f9fd199,dc979571f561..000000000000
--- a/net/mptcp/protocol.c
+++ b/net/mptcp/protocol.c
@@@ -1361,6 -1705,14 +1361,17 @@@ static void mptcp_retransmit_timer(stru
  	sock_put(sk);
  }
  
++<<<<<<< HEAD
++=======
+ static void mptcp_timeout_timer(struct timer_list *t)
+ {
+ 	struct sock *sk = from_timer(sk, t, sk_timer);
+ 
+ 	mptcp_schedule_work(sk);
+ 	sock_put(sk);
+ }
+ 
++>>>>>>> b6d69fc8e8cf (mptcp: put reference in mptcp timeout timer)
  /* Find an idle subflow.  Return NULL if there is unacked data at tcp
   * level.
   *
* Unmerged path net/mptcp/protocol.c
