Input: elan_i2c - only increment wakeup count on touch

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-294.el8
commit-author Derek Basehore <dbasehore@chromium.org>
commit 966334dfc472bdfa67bed864842943b19755d192
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-294.el8/966334df.failed

This moves the wakeup increment for elan devices to the touch report.
This prevents the drivers from incorrectly reporting a wakeup when the
resume callback resets then device, which causes an interrupt to
occur.

	Signed-off-by: Derek Basehore <dbasehore@chromium.org>
Link: https://lore.kernel.org/r/20200706235046.1984283-1-dbasehore@chromium.org
	Signed-off-by: Dmitry Torokhov <dmitry.torokhov@gmail.com>
(cherry picked from commit 966334dfc472bdfa67bed864842943b19755d192)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/input/mouse/elan_i2c_core.c
diff --cc drivers/input/mouse/elan_i2c_core.c
index 659a93d2b79f,6291fb5fa015..000000000000
--- a/drivers/input/mouse/elan_i2c_core.c
+++ b/drivers/input/mouse/elan_i2c_core.c
@@@ -998,12 -951,13 +998,21 @@@ static void elan_report_absolute(struc
  	u8 hover_info = packet[ETP_HOVER_INFO_OFFSET];
  	bool contact_valid, hover_event;
  
++<<<<<<< HEAD
 +	hover_event = hover_info & BIT(6);
++=======
+ 	pm_wakeup_event(&data->client->dev, 0);
+ 
+ 	hover_event = hover_info & 0x40;
+ 	for (i = 0; i < ETP_MAX_FINGERS; i++) {
+ 		contact_valid = tp_info & (1U << (3 + i));
+ 		elan_report_contact(data, i, contact_valid, finger_data);
++>>>>>>> 966334dfc472 (Input: elan_i2c - only increment wakeup count on touch)
  
 +	for (i = 0; i < ETP_MAX_FINGERS; i++) {
 +		contact_valid = tp_info & BIT(3 + i);
 +		elan_report_contact(data, i, contact_valid, high_precision,
 +				    packet, finger_data);
  		if (contact_valid)
  			finger_data += ETP_FINGER_DATA_LEN;
  	}
@@@ -1064,14 -1019,9 +1074,12 @@@ static irqreturn_t elan_isr(int irq, vo
  	if (error)
  		goto out;
  
- 	pm_wakeup_event(dev, 0);
- 
  	switch (report[ETP_REPORT_ID_OFFSET]) {
  	case ETP_REPORT_ID:
 -		elan_report_absolute(data, report);
 +		elan_report_absolute(data, report, false);
 +		break;
 +	case ETP_REPORT_ID2:
 +		elan_report_absolute(data, report, true);
  		break;
  	case ETP_TP_REPORT_ID:
  		elan_report_trackpoint(data, report);
* Unmerged path drivers/input/mouse/elan_i2c_core.c
