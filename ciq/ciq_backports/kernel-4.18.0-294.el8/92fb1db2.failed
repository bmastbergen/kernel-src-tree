mm/page_idle.c: skip offline pages

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-294.el8
commit-author SeongJae Park <sjpark@amazon.de>
commit 92fb1db26eefc11554820f11ce8e92007da2fbf4
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-294.el8/92fb1db2.failed

'Idle page tracking' users can pass random pfn that might be mapped to an
offline page.  To avoid accessing such pages, this commit modifies the
'page_idle_get_page()' to use 'pfn_to_online_page()' instead of
'pfn_valid()' and 'pfn_to_page()' combination, so that the pfn mapped to
an offline page can be skipped.

	Reported-by: David Hildenbrand <david@redhat.com>
	Signed-off-by: SeongJae Park <sjpark@amazon.de>
	Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
	Reviewed-by: David Hildenbrand <david@redhat.com>
	Reviewed-by: Pankaj Gupta <pankaj.gupta.linux@gmail.com>
Link: http://lkml.kernel.org/r/20200605092502.18018-2-sjpark@amazon.com
	Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
(cherry picked from commit 92fb1db26eefc11554820f11ce8e92007da2fbf4)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	mm/page_idle.c
diff --cc mm/page_idle.c
index 59c0f8e2cc5f,057c61df12db..000000000000
--- a/mm/page_idle.c
+++ b/mm/page_idle.c
@@@ -30,13 -31,9 +31,14 @@@
   */
  static struct page *page_idle_get_page(unsigned long pfn)
  {
++<<<<<<< HEAD
 +	struct page *page;
 +	struct zone *zone;
++=======
+ 	struct page *page = pfn_to_online_page(pfn);
+ 	pg_data_t *pgdat;
++>>>>>>> 92fb1db26eef (mm/page_idle.c: skip offline pages)
  
- 	if (!pfn_valid(pfn))
- 		return NULL;
- 
- 	page = pfn_to_page(pfn);
  	if (!page || !PageLRU(page) ||
  	    !get_page_unless_zero(page))
  		return NULL;
* Unmerged path mm/page_idle.c
