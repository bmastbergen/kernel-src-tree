virtiofs: add DAX mmap support

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-294.el8
commit-author Stefan Hajnoczi <stefanha@redhat.com>
commit 2a9a609a0c4a3b0a6892fbe360b8c419839e6da7
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-294.el8/2a9a609a.failed

Add DAX mmap() support.

	Signed-off-by: Stefan Hajnoczi <stefanha@redhat.com>
	Signed-off-by: Miklos Szeredi <mszeredi@redhat.com>
(cherry picked from commit 2a9a609a0c4a3b0a6892fbe360b8c419839e6da7)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	fs/fuse/dax.c
* Unmerged path fs/fuse/dax.c
* Unmerged path fs/fuse/dax.c
diff --git a/fs/fuse/file.c b/fs/fuse/file.c
index e64ca703e652..9c395761b7c6 100644
--- a/fs/fuse/file.c
+++ b/fs/fuse/file.c
@@ -2308,6 +2308,10 @@ static int fuse_file_mmap(struct file *file, struct vm_area_struct *vma)
 {
 	struct fuse_file *ff = file->private_data;
 
+	/* DAX mmap is superior to direct_io mmap */
+	if (FUSE_IS_DAX(file_inode(file)))
+		return fuse_dax_mmap(file, vma);
+
 	if (ff->open_flags & FOPEN_DIRECT_IO) {
 		/* Can't provide the coherency needed for MAP_SHARED */
 		if (vma->vm_flags & VM_MAYSHARE)
@@ -3386,6 +3390,7 @@ static const struct file_operations fuse_file_operations = {
 	.release	= fuse_release,
 	.fsync		= fuse_fsync,
 	.lock		= fuse_file_lock,
+	.get_unmapped_area = thp_get_unmapped_area,
 	.flock		= fuse_file_flock,
 	.splice_read	= generic_file_splice_read,
 	.splice_write	= iter_file_splice_write,
