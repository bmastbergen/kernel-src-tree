s390/ap: Support AP card SCLP config and deconfig operations

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-294.el8
commit-author Harald Freudenberger <freude@linux.ibm.com>
commit 5caa2af97118308c79f29cc9876aec3ed504f9b0
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-294.el8/5caa2af9.failed

Support SCLP AP adapter config and deconfig operations:
The sysfs deconfig attribute /sys/devices/ap/cardxx/deconfig
for each AP card is now read-write. Writing in a '1' triggers
a synchronous SCLP request to configure the adapter, writing
in a '0' sends a synchronous SCLP deconfigure request.

	Signed-off-by: Harald Freudenberger <freude@linux.ibm.com>
	Signed-off-by: Vasily Gorbik <gor@linux.ibm.com>
(cherry picked from commit 5caa2af97118308c79f29cc9876aec3ed504f9b0)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/s390/crypto/ap_card.c
diff --cc drivers/s390/crypto/ap_card.c
index 6588713319ba,d98bdd28d23e..000000000000
--- a/drivers/s390/crypto/ap_card.c
+++ b/drivers/s390/crypto/ap_card.c
@@@ -139,6 -140,38 +140,41 @@@ static ssize_t modalias_show(struct dev
  
  static DEVICE_ATTR_RO(modalias);
  
++<<<<<<< HEAD
++=======
+ static ssize_t config_show(struct device *dev,
+ 			   struct device_attribute *attr, char *buf)
+ {
+ 	struct ap_card *ac = to_ap_card(dev);
+ 
+ 	return scnprintf(buf, PAGE_SIZE, "%d\n", ac->config ? 1 : 0);
+ }
+ 
+ static ssize_t config_store(struct device *dev,
+ 			    struct device_attribute *attr,
+ 			    const char *buf, size_t count)
+ {
+ 	int rc = 0, cfg;
+ 	struct ap_card *ac = to_ap_card(dev);
+ 
+ 	if (sscanf(buf, "%d\n", &cfg) != 1 || cfg < 0 || cfg > 1)
+ 		return -EINVAL;
+ 
+ 	if (cfg && !ac->config)
+ 		rc = sclp_ap_configure(ac->id);
+ 	else if (!cfg && ac->config)
+ 		rc = sclp_ap_deconfigure(ac->id);
+ 	if (rc)
+ 		return rc;
+ 
+ 	ac->config = cfg ? true : false;
+ 
+ 	return count;
+ }
+ 
+ static DEVICE_ATTR_RW(config);
+ 
++>>>>>>> 5caa2af97118 (s390/ap: Support AP card SCLP config and deconfig operations)
  static struct attribute *ap_card_dev_attrs[] = {
  	&dev_attr_hwtype.attr,
  	&dev_attr_raw_hwtype.attr,
* Unmerged path drivers/s390/crypto/ap_card.c
