scsi: vmw_pscsi: use sg helper to iterate over scatterlist

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-294.el8
commit-author Ming Lei <ming.lei@redhat.com>
commit cf9648cb71d6f1a463553d2fcd4c8137587dc060
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-294.el8/cf9648cb.failed

Unlike the legacy I/O path, scsi-mq preallocates a large array to hold
the scatterlist for each request. This static allocation can consume
substantial amounts of memory on modern controllers which support a
large number of concurrently outstanding requests.

To facilitate a switch to a smaller static allocation combined with a
dynamic allocation for requests that need it, we need to make sure all
SCSI drivers handle chained scatterlists correctly.

Convert remaining drivers that directly dereference the scatterlist
array to using the iterator functions.

[mkp: clarified commit message]

	Reviewed-by: Ewan D. Milne <emilne@redhat.com>
	Reviewed-by: Christoph Hellwig <hch@lst.de>
	Reviewed-by: Bart Van Assche <bvanassche@acm.org>
	Signed-off-by: Ming Lei <ming.lei@redhat.com>
	Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
(cherry picked from commit cf9648cb71d6f1a463553d2fcd4c8137587dc060)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/scsi/vmw_pvscsi.c
diff --cc drivers/scsi/vmw_pvscsi.c
index 0ea63c886a07,d71abd416eb4..000000000000
--- a/drivers/scsi/vmw_pvscsi.c
+++ b/drivers/scsi/vmw_pvscsi.c
@@@ -336,9 -335,9 +336,15 @@@ static void pvscsi_create_sg(struct pvs
  	BUG_ON(count > PVSCSI_MAX_NUM_SG_ENTRIES_PER_SEGMENT);
  
  	sge = &ctx->sgl->sge[0];
++<<<<<<< HEAD
 +	scsi_for_each_sg(cmd, s, count, i) {
 +		sge[i].addr   = sg_dma_address(s);
 +		sge[i].length = sg_dma_len(s);
++=======
+ 	for (i = 0; i < count; i++, sg = sg_next(sg)) {
+ 		sge[i].addr   = sg_dma_address(sg);
+ 		sge[i].length = sg_dma_len(sg);
++>>>>>>> cf9648cb71d6 (scsi: vmw_pscsi: use sg helper to iterate over scatterlist)
  		sge[i].flags  = 0;
  	}
  }
* Unmerged path drivers/scsi/vmw_pvscsi.c
