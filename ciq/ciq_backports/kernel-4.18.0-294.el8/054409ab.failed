KVM: SVM: fix error return code in svm_create_vcpu()

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-294.el8
commit-author Chen Zhou <chenzhou10@huawei.com>
commit 054409ab253d9f31bec5760105144166b4b71e22
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-294.el8/054409ab.failed

Fix to return a negative error code from the error handling case
instead of 0 in function svm_create_vcpu(), as done elsewhere in this
function.

Fixes: f4c847a95654 ("KVM: SVM: refactor msr permission bitmap allocation")
	Reported-by: Hulk Robot <hulkci@huawei.com>
	Signed-off-by: Chen Zhou <chenzhou10@huawei.com>
Message-Id: <20201117025426.167824-1-chenzhou10@huawei.com>
	Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>
(cherry picked from commit 054409ab253d9f31bec5760105144166b4b71e22)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/x86/kvm/svm/svm.c
diff --cc arch/x86/kvm/svm/svm.c
index 72f42a4954e3,79b3a564f1c9..000000000000
--- a/arch/x86/kvm/svm/svm.c
+++ b/arch/x86/kvm/svm/svm.c
@@@ -1218,15 -1308,13 +1218,23 @@@ static int svm_create_vcpu(struct kvm_v
  	if (irqchip_in_kernel(vcpu->kvm) && kvm_apicv_activated(vcpu->kvm))
  		svm->avic_is_running = true;
  
++<<<<<<< HEAD
 +	svm->nested.hsave = page_address(hsave_page);
++=======
+ 	svm->msrpm = svm_vcpu_alloc_msrpm();
+ 	if (!svm->msrpm) {
+ 		err = -ENOMEM;
+ 		goto error_free_vmcb_page;
+ 	}
++>>>>>>> 054409ab253d (KVM: SVM: fix error return code in svm_create_vcpu())
  
 -	svm_vcpu_init_msrpm(vcpu, svm->msrpm);
 +	svm->msrpm = svm_vcpu_init_msrpm();
 +	if (!svm->msrpm)
 +		goto error_free_hsave_page;
 +
 +	svm->nested.msrpm = svm_vcpu_init_msrpm();
 +	if (!svm->nested.msrpm)
 +		goto error_free_msrpm;
  
  	svm->vmcb = page_address(vmcb_page);
  	svm->vmcb_pa = __sme_set(page_to_pfn(vmcb_page) << PAGE_SHIFT);
* Unmerged path arch/x86/kvm/svm/svm.c
