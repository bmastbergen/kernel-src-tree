lib: enable building KUnit in lib/

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-294.el8
commit-author Brendan Higgins <brendanhiggins@google.com>
commit 84bc809eecf37f3bd3ee7d2002b2528787a11cb1
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-294.el8/84bc809e.failed

KUnit is a new unit testing framework for the kernel and when used is
built into the kernel as a part of it. Add KUnit to the lib Kconfig and
Makefile to allow it to be actually built.

	Signed-off-by: Brendan Higgins <brendanhiggins@google.com>
	Cc: Randy Dunlap <rdunlap@infradead.org>
	Cc: Andrew Morton <akpm@linux-foundation.org>
	Cc: Masahiro Yamada <yamada.masahiro@socionext.com>
	Cc: Kees Cook <keescook@chromium.org>
	Reviewed-by: Stephen Boyd <sboyd@kernel.org>
	Signed-off-by: Shuah Khan <skhan@linuxfoundation.org>
(cherry picked from commit 84bc809eecf37f3bd3ee7d2002b2528787a11cb1)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	lib/Kconfig.debug
diff --cc lib/Kconfig.debug
index da5a3060bee2,683863264655..000000000000
--- a/lib/Kconfig.debug
+++ b/lib/Kconfig.debug
@@@ -1702,41 -1664,7 +1702,45 @@@ config PROVIDE_OHCI1394_DMA_INI
  
  	  See Documentation/debugging-via-ohci1394.txt for more information.
  
++<<<<<<< HEAD
 +config DMA_API_DEBUG
 +	bool "Enable debugging of DMA-API usage"
 +	select NEED_DMA_MAP_STATE
 +	help
 +	  Enable this option to debug the use of the DMA API by device drivers.
 +	  With this option you will be able to detect common bugs in device
 +	  drivers like double-freeing of DMA mappings or freeing mappings that
 +	  were never allocated.
 +
 +	  This also attempts to catch cases where a page owned by DMA is
 +	  accessed by the cpu in a way that could cause data corruption.  For
 +	  example, this enables cow_user_page() to check that the source page is
 +	  not undergoing DMA.
 +
 +	  This option causes a performance degradation.  Use only if you want to
 +	  debug device drivers and dma interactions.
 +
 +	  If unsure, say N.
 +
 +config DMA_API_DEBUG_SG
 +	bool "Debug DMA scatter-gather usage"
 +	default y
 +	depends on DMA_API_DEBUG
 +	help
 +	  Perform extra checking that callers of dma_map_sg() have respected the
 +	  appropriate segment length/boundary limits for the given device when
 +	  preparing DMA scatterlists.
 +
 +	  This is particularly likely to have been overlooked in cases where the
 +	  dma_map_sg() API is used for general bulk mapping of pages rather than
 +	  preparing literal scatter-gather descriptors, where there is a risk of
 +	  unexpected behaviour from DMA API implementations if the scatterlist
 +	  is technically out-of-spec.
 +
 +	  If unsure, say N.
++=======
+ source "lib/kunit/Kconfig"
++>>>>>>> 84bc809eecf3 (lib: enable building KUnit in lib/)
  
  menuconfig RUNTIME_TESTING_MENU
  	bool "Runtime Testing"
* Unmerged path lib/Kconfig.debug
diff --git a/lib/Makefile b/lib/Makefile
index a2b9f6cfbc3e..2884f571ecfa 100644
--- a/lib/Makefile
+++ b/lib/Makefile
@@ -87,6 +87,8 @@ obj-$(CONFIG_TEST_OBJAGG) += test_objagg.o
 
 obj-$(CONFIG_TEST_LIVEPATCH) += livepatch/
 
+obj-$(CONFIG_KUNIT) += kunit/
+
 ifeq ($(CONFIG_DEBUG_KOBJECT),y)
 CFLAGS_kobject.o += -DDEBUG
 CFLAGS_kobject_uevent.o += -DDEBUG
