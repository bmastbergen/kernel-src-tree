net/udpgso_bench.sh test fails on error

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-294.el8
commit-author Fred Klassen <fklassen@appneta.com>
commit 4ffc37f5c07791ffe1de59a7c08fdf8d7f585a60
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-294.el8/4ffc37f5.failed

Ensure that failure on any individual test results in an overall
failure of the test script.

	Signed-off-by: Fred Klassen <fklassen@appneta.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 4ffc37f5c07791ffe1de59a7c08fdf8d7f585a60)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	tools/testing/selftests/net/udpgso_bench.sh
diff --cc tools/testing/selftests/net/udpgso_bench.sh
index 99e537ab5ad9,4df1cd8d69d2..000000000000
--- a/tools/testing/selftests/net/udpgso_bench.sh
+++ b/tools/testing/selftests/net/udpgso_bench.sh
@@@ -32,9 -37,33 +37,37 @@@ run_udp() 
  
  	echo "udp"
  	run_in_netns ${args}
+ 	errors=$(( $errors + $? ))
  
  	echo "udp gso"
++<<<<<<< HEAD
 +	run_in_netns ${args} -S
++=======
+ 	run_in_netns ${args} -S 0
+ 	errors=$(( $errors + $? ))
+ 
+ 	echo "udp gso zerocopy"
+ 	run_in_netns ${args} -S 0 -z
+ 	errors=$(( $errors + $? ))
+ 
+ 	echo "udp gso timestamp"
+ 	run_in_netns ${args} -S 0 -T
+ 	errors=$(( $errors + $? ))
+ 
+ 	echo "udp gso zerocopy audit"
+ 	run_in_netns ${args} -S 0 -z -a
+ 	errors=$(( $errors + $? ))
+ 
+ 	echo "udp gso timestamp audit"
+ 	run_in_netns ${args} -S 0 -T -a
+ 	errors=$(( $errors + $? ))
+ 
+ 	echo "udp gso zerocopy timestamp audit"
+ 	run_in_netns ${args} -S 0 -T -z -a
+ 	errors=$(( $errors + $? ))
+ 
+ 	return $errors
++>>>>>>> 4ffc37f5c077 (net/udpgso_bench.sh test fails on error)
  }
  
  run_tcp() {
@@@ -45,12 -76,22 +80,25 @@@
  
  	echo "tcp zerocopy"
  	run_in_netns ${args} -t -z
++<<<<<<< HEAD
++=======
+ 	errors=$(( $errors + $? ))
+ 
+ 	# excluding for now because test fails intermittently
+ 	# add -P option to include poll() to reduce possibility of lost messages
+ 	#echo "tcp zerocopy audit"
+ 	#run_in_netns ${args} -t -z -P -a
+ 	#errors=$(( $errors + $? ))
+ 
+ 	return $errors
++>>>>>>> 4ffc37f5c077 (net/udpgso_bench.sh test fails on error)
  }
  
  run_all() {
 -	local -r core_args="-l 3"
 +	local -r core_args="-l 4"
  	local -r ipv4_args="${core_args} -4 -D 127.0.0.1"
  	local -r ipv6_args="${core_args} -6 -D ::1"
+ 	local errors=0
  
  	echo "ipv4"
  	run_tcp "${ipv4_args}"
* Unmerged path tools/testing/selftests/net/udpgso_bench.sh
