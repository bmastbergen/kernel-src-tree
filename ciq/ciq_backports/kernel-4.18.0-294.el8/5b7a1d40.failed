mm, hugetlbfs: rename address to haddr in hugetlb_cow()

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-294.el8
commit-author Huang Ying <ying.huang@intel.com>
commit 5b7a1d406062449a4d51aea1df37a73285ced1dc
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-294.el8/5b7a1d40.failed

To take better advantage of general huge page copying optimization, the
target subpage address will be passed to hugetlb_cow(), then
copy_user_huge_page().  So we will use both target subpage address and
huge page size aligned address in hugetlb_cow().  To distinguish between
them, "haddr" is used for huge page size aligned address to be
consistent with Transparent Huge Page naming convention.

Now, only huge page size aligned address is used in hugetlb_cow(), so
the "address" is renamed to "haddr" in hugetlb_cow() in this patch.
Next patch will use target subpage address in hugetlb_cow() too.

The patch is just code cleanup without any functionality changes.

Link: http://lkml.kernel.org/r/20180524005851.4079-4-ying.huang@intel.com
	Signed-off-by: "Huang, Ying" <ying.huang@intel.com>
	Suggested-by: Mike Kravetz <mike.kravetz@oracle.com>
	Suggested-by: Michal Hocko <mhocko@suse.com>
	Reviewed-by: Mike Kravetz <mike.kravetz@oracle.com>
	Cc: David Rientjes <rientjes@google.com>
	Cc: Andrea Arcangeli <aarcange@redhat.com>
	Cc: "Kirill A. Shutemov" <kirill.shutemov@linux.intel.com>
	Cc: Andi Kleen <andi.kleen@intel.com>
	Cc: Jan Kara <jack@suse.cz>
	Cc: Matthew Wilcox <willy@infradead.org>
	Cc: Hugh Dickins <hughd@google.com>
	Cc: Minchan Kim <minchan@kernel.org>
	Cc: Shaohua Li <shli@fb.com>
	Cc: Christopher Lameter <cl@linux.com>
	Cc: "Aneesh Kumar K.V" <aneesh.kumar@linux.vnet.ibm.com>
	Cc: Punit Agrawal <punit.agrawal@arm.com>
	Cc: Anshuman Khandual <khandual@linux.vnet.ibm.com>
	Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
	Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
(cherry picked from commit 5b7a1d406062449a4d51aea1df37a73285ced1dc)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	mm/hugetlb.c
diff --cc mm/hugetlb.c
index 350141219e0f,e6767a35f7de..000000000000
--- a/mm/hugetlb.c
+++ b/mm/hugetlb.c
@@@ -3766,8 -3508,8 +3766,13 @@@ static void unmap_ref_private(struct mm
   * cannot race with other handlers or page migration.
   * Keep the pte_same checks anyway to make transition from the mutex easier.
   */
++<<<<<<< HEAD
 +static vm_fault_t hugetlb_cow(struct mm_struct *mm, struct vm_area_struct *vma,
 +		       unsigned long address, pte_t *ptep,
++=======
+ static int hugetlb_cow(struct mm_struct *mm, struct vm_area_struct *vma,
+ 		       unsigned long haddr, pte_t *ptep,
++>>>>>>> 5b7a1d406062 (mm, hugetlbfs: rename address to haddr in hugetlb_cow())
  		       struct page *pagecache_page, spinlock_t *ptl)
  {
  	pte_t pte;
@@@ -3851,11 -3592,12 +3855,11 @@@ retry_avoidcopy
  		goto out_release_all;
  	}
  
- 	copy_user_huge_page(new_page, old_page, address, vma,
+ 	copy_user_huge_page(new_page, old_page, haddr, vma,
  			    pages_per_huge_page(h));
  	__SetPageUptodate(new_page);
 -	set_page_huge_active(new_page);
  
- 	mmun_start = address & huge_page_mask(h);
+ 	mmun_start = haddr;
  	mmun_end = mmun_start + huge_page_size(h);
  	mmu_notifier_invalidate_range_start(mm, mmun_start, mmun_end);
  
@@@ -3870,13 -3611,12 +3873,17 @@@
  		ClearPagePrivate(new_page);
  
  		/* Break COW */
- 		huge_ptep_clear_flush(vma, address, ptep);
+ 		huge_ptep_clear_flush(vma, haddr, ptep);
  		mmu_notifier_invalidate_range(mm, mmun_start, mmun_end);
- 		set_huge_pte_at(mm, address, ptep,
+ 		set_huge_pte_at(mm, haddr, ptep,
  				make_huge_pte(vma, new_page, 1));
  		page_remove_rmap(old_page, true);
++<<<<<<< HEAD
 +		hugepage_add_new_anon_rmap(new_page, vma, address);
 +		set_page_huge_active(new_page);
++=======
+ 		hugepage_add_new_anon_rmap(new_page, vma, haddr);
++>>>>>>> 5b7a1d406062 (mm, hugetlbfs: rename address to haddr in hugetlb_cow())
  		/* Make the old page be freed below */
  		new_page = old_page;
  	}
* Unmerged path mm/hugetlb.c
