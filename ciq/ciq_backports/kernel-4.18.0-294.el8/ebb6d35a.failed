kasan: remove clang version check for KASAN_STACK

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-294.el8
commit-author Arnd Bergmann <arnd@arndb.de>
commit ebb6d35a74ce21ce1673b8f404c1039d5a1e7e2d
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-294.el8/ebb6d35a.failed

asan-stack mode still uses dangerously large kernel stacks of tens of
kilobytes in some drivers, and it does not seem that anyone is working
on the clang bug.

Turn it off for all clang versions to prevent users from accidentally
enabling it once they update to clang-9, and to help automated build
testing with clang-9.

Link: https://bugs.llvm.org/show_bug.cgi?id=38809
Link: http://lkml.kernel.org/r/20190719200347.2596375-1-arnd@arndb.de
Fixes: 6baec880d7a5 ("kasan: turn off asan-stack for clang-8 and earlier")
	Signed-off-by: Arnd Bergmann <arnd@arndb.de>
	Acked-by: Nick Desaulniers <ndesaulniers@google.com>
	Reviewed-by: Mark Brown <broonie@kernel.org>
	Reviewed-by: Andrey Ryabinin <aryabinin@virtuozzo.com>
	Cc: Qian Cai <cai@lca.pw>
	Cc: Andrey Konovalov <andreyknvl@google.com>
	Cc: Vasily Gorbik <gor@linux.ibm.com>
	Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
	Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
(cherry picked from commit ebb6d35a74ce21ce1673b8f404c1039d5a1e7e2d)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	lib/Kconfig.kasan
diff --cc lib/Kconfig.kasan
index d0bad1bd9a2b,7fa97a8b5717..000000000000
--- a/lib/Kconfig.kasan
+++ b/lib/Kconfig.kasan
@@@ -57,6 -104,27 +57,30 @@@ config KASAN_INLIN
  
  endchoice
  
++<<<<<<< HEAD
++=======
+ config KASAN_STACK_ENABLE
+ 	bool "Enable stack instrumentation (unsafe)" if CC_IS_CLANG && !COMPILE_TEST
+ 	depends on KASAN
+ 	help
+ 	  The LLVM stack address sanitizer has a know problem that
+ 	  causes excessive stack usage in a lot of functions, see
+ 	  https://bugs.llvm.org/show_bug.cgi?id=38809
+ 	  Disabling asan-stack makes it safe to run kernels build
+ 	  with clang-8 with KASAN enabled, though it loses some of
+ 	  the functionality.
+ 	  This feature is always disabled when compile-testing with clang
+ 	  to avoid cluttering the output in stack overflow warnings,
+ 	  but clang users can still enable it for builds without
+ 	  CONFIG_COMPILE_TEST.	On gcc it is assumed to always be safe
+ 	  to use and enabled by default.
+ 
+ config KASAN_STACK
+ 	int
+ 	default 1 if KASAN_STACK_ENABLE || CC_IS_GCC
+ 	default 0
+ 
++>>>>>>> ebb6d35a74ce (kasan: remove clang version check for KASAN_STACK)
  config KASAN_S390_4_LEVEL_PAGING
  	bool "KASan: use 4-level paging"
  	depends on KASAN && S390
* Unmerged path lib/Kconfig.kasan
