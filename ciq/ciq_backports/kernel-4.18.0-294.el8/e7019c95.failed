scsi: qla2xxx: Introduce a function for computing the debug message prefix

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-294.el8
commit-author Bart Van Assche <bvanassche@acm.org>
commit e7019c95c40daf8e8a9fa1d5f36eabce2eb8ef6b
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-294.el8/e7019c95.failed

Instead of repeating the code for generating a debug message prefix six
times, introduce a function for computing the debug message prefix.

Link: https://lore.kernel.org/r/20200629225454.22863-10-bvanassche@acm.org
	Cc: Nilesh Javali <njavali@marvell.com>
	Cc: Quinn Tran <qutran@marvell.com>
	Cc: Himanshu Madhani <himanshu.madhani@oracle.com>
	Cc: Martin Wilck <mwilck@suse.com>
	Cc: Roman Bolshakov <r.bolshakov@yadro.com>
	Reviewed-by: Daniel Wagner <dwagner@suse.de>
	Reviewed-by: Himanshu Madhani <himanshu.madhani@oracle.com>
	Signed-off-by: Bart Van Assche <bvanassche@acm.org>
	Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
(cherry picked from commit e7019c95c40daf8e8a9fa1d5f36eabce2eb8ef6b)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/scsi/qla2xxx/qla_dbg.c
diff --cc drivers/scsi/qla2xxx/qla_dbg.c
index fbd8cb5647b6,911c7852e660..000000000000
--- a/drivers/scsi/qla2xxx/qla_dbg.c
+++ b/drivers/scsi/qla2xxx/qla_dbg.c
@@@ -2471,33 -2489,12 +2488,27 @@@ ql_dbg(uint level, scsi_qla_host_t *vha
  	vaf.fmt = fmt;
  	vaf.va = &va;
  
++<<<<<<< HEAD
 +	if (!ql_mask_match(level)) {
 +		if (vha != NULL) {
 +			const struct pci_dev *pdev = vha->hw->pdev;
 +			/* <module-name> <msg-id>:<host> Message */
 +			snprintf(pbuf, sizeof(pbuf), "%s [%s]-%04x:%ld: ",
 +			    QL_MSGHDR, dev_name(&(pdev->dev)), id,
 +			    vha->host_no);
 +		} else {
 +			snprintf(pbuf, sizeof(pbuf), "%s [%s]-%04x: : ",
 +			    QL_MSGHDR, "0000:00:00.0", id);
 +		}
 +		pbuf[sizeof(pbuf) - 1] = 0;
- 		trace_ql_dbg_log(pbuf, &vaf);
- 		va_end(va);
- 		return;
- 	}
++=======
+ 	ql_dbg_prefix(pbuf, ARRAY_SIZE(pbuf), vha, id);
  
- 	if (vha != NULL) {
- 		const struct pci_dev *pdev = vha->hw->pdev;
- 		/* <module-name> <pci-name> <msg-id>:<host> Message */
- 		pr_warn("%s [%s]-%04x:%ld: %pV",
- 			QL_MSGHDR, dev_name(&(pdev->dev)), id + ql_dbg_offset,
- 			vha->host_no, &vaf);
- 	} else {
- 		pr_warn("%s [%s]-%04x: : %pV",
- 			QL_MSGHDR, "0000:00:00.0", id + ql_dbg_offset, &vaf);
- 	}
+ 	if (!ql_mask_match(level))
++>>>>>>> e7019c95c40d (scsi: qla2xxx: Introduce a function for computing the debug message prefix)
+ 		trace_ql_dbg_log(pbuf, &vaf);
+ 	else
+ 		pr_warn("%s%pV", pbuf, &vaf);
  
  	va_end(va);
  
* Unmerged path drivers/scsi/qla2xxx/qla_dbg.c
