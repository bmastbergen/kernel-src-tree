scsi: qla2xxx: Fix a Coverity complaint in qla2100_fw_dump()

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-294.el8
commit-author Bart Van Assche <bvanassche@acm.org>
commit 57fec9f24e580d8fe4219ee89572f49758e62c75
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-294.el8/57fec9f2.failed

'cnt' can exceed the size of the risc_ram[] array. Prevent that Coverity
complains by rewriting an address calculation expression. This patch fixes
the following Coverity complaint:

CID 337803 (#1 of 1): Out-of-bounds read (OVERRUN)
109. overrun-local: Overrunning array of 122880 bytes at byte offset 122880
by dereferencing pointer &fw->risc_ram[cnt].

Link: https://lore.kernel.org/r/20200629225454.22863-8-bvanassche@acm.org
	Cc: Nilesh Javali <njavali@marvell.com>
	Cc: Quinn Tran <qutran@marvell.com>
	Cc: Himanshu Madhani <himanshu.madhani@oracle.com>
	Cc: Martin Wilck <mwilck@suse.com>
	Cc: Roman Bolshakov <r.bolshakov@yadro.com>
	Reviewed-by: Daniel Wagner <dwagner@suse.de>
	Reviewed-by: Himanshu Madhani <himanshu.madhani@oracle.com>
	Signed-off-by: Bart Van Assche <bvanassche@acm.org>
	Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
(cherry picked from commit 57fec9f24e580d8fe4219ee89572f49758e62c75)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/scsi/qla2xxx/qla_dbg.h
diff --cc drivers/scsi/qla2xxx/qla_dbg.h
index 95b3a8a5de1d,91eb6901815c..000000000000
--- a/drivers/scsi/qla2xxx/qla_dbg.h
+++ b/drivers/scsi/qla2xxx/qla_dbg.h
@@@ -36,23 -36,24 +36,44 @@@ struct qla2300_fw_dump 
  };
  
  struct qla2100_fw_dump {
++<<<<<<< HEAD
 +	uint16_t hccr;
 +	uint16_t pbiu_reg[8];
 +	uint16_t mailbox_reg[32];
 +	uint16_t dma_reg[48];
 +	uint16_t risc_hdw_reg[16];
 +	uint16_t risc_gp0_reg[16];
 +	uint16_t risc_gp1_reg[16];
 +	uint16_t risc_gp2_reg[16];
 +	uint16_t risc_gp3_reg[16];
 +	uint16_t risc_gp4_reg[16];
 +	uint16_t risc_gp5_reg[16];
 +	uint16_t risc_gp6_reg[16];
 +	uint16_t risc_gp7_reg[16];
 +	uint16_t frame_buf_hdw_reg[16];
 +	uint16_t fpm_b0_reg[64];
 +	uint16_t fpm_b1_reg[64];
 +	uint16_t risc_ram[0xf000];
++=======
+ 	__be16 hccr;
+ 	__be16 pbiu_reg[8];
+ 	__be16 mailbox_reg[32];
+ 	__be16 dma_reg[48];
+ 	__be16 risc_hdw_reg[16];
+ 	__be16 risc_gp0_reg[16];
+ 	__be16 risc_gp1_reg[16];
+ 	__be16 risc_gp2_reg[16];
+ 	__be16 risc_gp3_reg[16];
+ 	__be16 risc_gp4_reg[16];
+ 	__be16 risc_gp5_reg[16];
+ 	__be16 risc_gp6_reg[16];
+ 	__be16 risc_gp7_reg[16];
+ 	__be16 frame_buf_hdw_reg[16];
+ 	__be16 fpm_b0_reg[64];
+ 	__be16 fpm_b1_reg[64];
+ 	__be16 risc_ram[0xf000];
+ 	u8	queue_dump[];
++>>>>>>> 57fec9f24e58 (scsi: qla2xxx: Fix a Coverity complaint in qla2100_fw_dump())
  };
  
  struct qla24xx_fw_dump {
diff --git a/drivers/scsi/qla2xxx/qla_dbg.c b/drivers/scsi/qla2xxx/qla_dbg.c
index fbd8cb5647b6..186730cac4ff 100644
--- a/drivers/scsi/qla2xxx/qla_dbg.c
+++ b/drivers/scsi/qla2xxx/qla_dbg.c
@@ -1062,7 +1062,7 @@ qla2100_fw_dump(scsi_qla_host_t *vha)
 	}
 
 	if (rval == QLA_SUCCESS)
-		qla2xxx_copy_queues(ha, &fw->risc_ram[cnt]);
+		qla2xxx_copy_queues(ha, &fw->queue_dump[0]);
 
 	qla2xxx_dump_post_process(base_vha, rval);
 }
* Unmerged path drivers/scsi/qla2xxx/qla_dbg.h
