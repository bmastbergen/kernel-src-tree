net: phylink: update PCS when changing interface during resolution

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-294.el8
commit-author Russell King <rmk+kernel@armlinux.org.uk>
commit 5005b163440f3fe18b434a20e8944dad508a15e8
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-294.el8/5005b163.failed

The only PHYs that are used with phylink which change their interface
are the BCM84881 and MV88X3310 family, both of which only change their
interface modes on link-up events.  This will break when drivers are
converted to split-PCS.  Fix this.

	Reviewed-by: Florian Fainelli <f.fainelli@gmail.com>
	Signed-off-by: Russell King <rmk+kernel@armlinux.org.uk>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 5005b163440f3fe18b434a20e8944dad508a15e8)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/phy/phylink.c
diff --cc drivers/net/phy/phylink.c
index 8ae109f323a0,f1693ec63366..000000000000
--- a/drivers/net/phy/phylink.c
+++ b/drivers/net/phy/phylink.c
@@@ -590,6 -620,26 +590,29 @@@ static void phylink_resolve(struct work
  		}
  	}
  
++<<<<<<< HEAD
++=======
+ 	if (mac_config) {
+ 		if (link_state.interface != pl->link_config.interface) {
+ 			/* The interface has changed, force the link down and
+ 			 * then reconfigure.
+ 			 */
+ 			if (cur_link_state) {
+ 				phylink_link_down(pl);
+ 				cur_link_state = false;
+ 			}
+ 			phylink_pcs_config(pl, false, &link_state);
+ 			pl->link_config.interface = link_state.interface;
+ 		} else {
+ 			/* The interface remains unchanged, only the speed,
+ 			 * duplex or pause settings have changed. Call the
+ 			 * old mac_config() method to configure the MAC/PCS.
+ 			 */
+ 			phylink_mac_config(pl, &link_state);
+ 		}
+ 	}
+ 
++>>>>>>> 5005b163440f (net: phylink: update PCS when changing interface during resolution)
  	if (link_state.link != cur_link_state) {
  		pl->old_link_state = link_state.link;
  		if (!link_state.link)
* Unmerged path drivers/net/phy/phylink.c
