powerpc/watchpoint: Return available watchpoints dynamically

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-294.el8
commit-author Ravi Bangoria <ravi.bangoria@linux.ibm.com>
commit deb2bd9bcc8428d4b65b6ba640ba8b57c1b20b17
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-294.el8/deb2bd9b.failed

So far Book3S Powerpc supported only one watchpoint. Power10 is
introducing 2nd DAWR. Enable 2nd DAWR support for Power10.
Availability of 2nd DAWR will depend on CPU_FTR_DAWR1.

	Signed-off-by: Ravi Bangoria <ravi.bangoria@linux.ibm.com>
	Signed-off-by: Michael Ellerman <mpe@ellerman.id.au>
Link: https://lore.kernel.org/r/20200723090813.303838-10-ravi.bangoria@linux.ibm.com
(cherry picked from commit deb2bd9bcc8428d4b65b6ba640ba8b57c1b20b17)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/powerpc/include/asm/cputable.h
#	arch/powerpc/include/asm/hw_breakpoint.h
diff --cc arch/powerpc/include/asm/cputable.h
index 0aa648a6923f,fdddb822d564..000000000000
--- a/arch/powerpc/include/asm/cputable.h
+++ b/arch/powerpc/include/asm/cputable.h
@@@ -619,7 -627,12 +619,16 @@@ enum 
  };
  #endif /* __powerpc64__ */
  
++<<<<<<< HEAD
 +#define HBP_NUM 1
++=======
+ /*
+  * Maximum number of hw breakpoint supported on powerpc. Number of
+  * breakpoints supported by actual hw might be less than this, which
+  * is decided at run time in nr_wp_slots().
+  */
+ #define HBP_NUM_MAX	2
++>>>>>>> deb2bd9bcc84 (powerpc/watchpoint: Return available watchpoints dynamically)
  
  #endif /* !__ASSEMBLY__ */
  
diff --cc arch/powerpc/include/asm/hw_breakpoint.h
index e2557de224d5,c89250b6ac34..000000000000
--- a/arch/powerpc/include/asm/hw_breakpoint.h
+++ b/arch/powerpc/include/asm/hw_breakpoint.h
@@@ -47,6 -36,21 +49,24 @@@ struct arch_hw_breakpoint 
  #define HW_BRK_TYPE_PRIV_ALL	(HW_BRK_TYPE_USER | HW_BRK_TYPE_KERNEL | \
  				 HW_BRK_TYPE_HYP)
  
++<<<<<<< HEAD
++=======
+ /* Minimum granularity */
+ #ifdef CONFIG_PPC_8xx
+ #define HW_BREAKPOINT_SIZE  0x4
+ #else
+ #define HW_BREAKPOINT_SIZE  0x8
+ #endif
+ 
+ #define DABR_MAX_LEN	8
+ #define DAWR_MAX_LEN	512
+ 
+ static inline int nr_wp_slots(void)
+ {
+ 	return cpu_has_feature(CPU_FTR_DAWR1) ? 2 : 1;
+ }
+ 
++>>>>>>> deb2bd9bcc84 (powerpc/watchpoint: Return available watchpoints dynamically)
  #ifdef CONFIG_HAVE_HW_BREAKPOINT
  #include <linux/kdebug.h>
  #include <asm/reg.h>
* Unmerged path arch/powerpc/include/asm/cputable.h
* Unmerged path arch/powerpc/include/asm/hw_breakpoint.h
