net: phylink: avoid oops during initialisation

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-294.el8
commit-author Russell King <rmk+kernel@armlinux.org.uk>
commit e859a60add1dd3f844c94c7a782c1a16610bd192
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-294.el8/e859a60a.failed

If we intend to use PCS operations, mac_pcs_get_state() will not be
implemented, so will be NULL. If we also intend to register the PCS
operations in mac_prepare() or mac_config(), then this leads to an
attempt to call NULL function pointer during phylink_start(). Avoid
this, but we must report the link is down.

	Signed-off-by: Russell King <rmk+kernel@armlinux.org.uk>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit e859a60add1dd3f844c94c7a782c1a16610bd192)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/phy/phylink.c
diff --cc drivers/net/phy/phylink.c
index ae02f9650b4a,5e4cb12972eb..000000000000
--- a/drivers/net/phy/phylink.c
+++ b/drivers/net/phy/phylink.c
@@@ -446,7 -533,12 +446,16 @@@ static int phylink_get_mac_state(struc
  	state->an_complete = 0;
  	state->link = 1;
  
++<<<<<<< HEAD
 +	return pl->ops->mac_link_state(pl->config, state);
++=======
+ 	if (pl->pcs_ops)
+ 		pl->pcs_ops->pcs_get_state(pl->pcs, state);
+ 	else if (pl->mac_ops->mac_pcs_get_state)
+ 		pl->mac_ops->mac_pcs_get_state(pl->config, state);
+ 	else
+ 		state->link = 0;
++>>>>>>> e859a60add1d (net: phylink: avoid oops during initialisation)
  }
  
  /* The fixed state is... fixed except for the link state,
* Unmerged path drivers/net/phy/phylink.c
