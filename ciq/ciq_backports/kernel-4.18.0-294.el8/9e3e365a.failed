scsi: lpfc: Fix no message shown for lpfc_hdw_queue out of range value

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-294.el8
commit-author Dick Kennedy <dick.kennedy@broadcom.com>
commit 9e3e365a92d329e5e69e3f92037537be6276992b
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-294.el8/9e3e365a.failed

If module parameters override the default configuration settings for
hardware queues or irqs, the driver was not notifying the change from
defaults.

Revise such that any changes will result in a kernel log message.

Link: https://lore.kernel.org/r/20200803210229.23063-3-jsmart2021@gmail.com
	Signed-off-by: Dick Kennedy <dick.kennedy@broadcom.com>
	Signed-off-by: James Smart <jsmart2021@gmail.com>
	Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
(cherry picked from commit 9e3e365a92d329e5e69e3f92037537be6276992b)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/scsi/lpfc/lpfc_init.c
diff --cc drivers/scsi/lpfc/lpfc_init.c
index 2a01f068fcb3,05ace6916b66..000000000000
--- a/drivers/scsi/lpfc/lpfc_init.c
+++ b/drivers/scsi/lpfc/lpfc_init.c
@@@ -8463,8 -8636,9 +8463,14 @@@ lpfc_sli4_read_config(struct lpfc_hba *
  		/* Check to see if there is enough for NVME */
  		if ((phba->cfg_irq_chann > qmin) ||
  		    (phba->cfg_hdw_queue > qmin)) {
++<<<<<<< HEAD
 +			lpfc_printf_log(phba, KERN_ERR, LOG_SLI,
 +					"2005 Reducing Queues: "
++=======
+ 			lpfc_printf_log(phba, KERN_ERR, LOG_TRACE_EVENT,
+ 					"2005 Reducing Queues - "
+ 					"FW resource limitation: "
++>>>>>>> 9e3e365a92d3 (scsi: lpfc: Fix no message shown for lpfc_hdw_queue out of range value)
  					"WQ %d CQ %d EQ %d: min %d: "
  					"IRQ %d HDWQ %d\n",
  					phba->sli4_hba.max_cfg_param.max_wq,
diff --git a/drivers/scsi/lpfc/lpfc_attr.c b/drivers/scsi/lpfc/lpfc_attr.c
index 57ff087a8c38..3a919daf0ee8 100644
--- a/drivers/scsi/lpfc/lpfc_attr.c
+++ b/drivers/scsi/lpfc/lpfc_attr.c
@@ -7406,12 +7406,26 @@ lpfc_get_cfgparam(struct lpfc_hba *phba)
 void
 lpfc_nvme_mod_param_dep(struct lpfc_hba *phba)
 {
-	if (phba->cfg_hdw_queue > phba->sli4_hba.num_present_cpu)
+	int  logit = 0;
+
+	if (phba->cfg_hdw_queue > phba->sli4_hba.num_present_cpu) {
 		phba->cfg_hdw_queue = phba->sli4_hba.num_present_cpu;
-	if (phba->cfg_irq_chann > phba->sli4_hba.num_present_cpu)
+		logit = 1;
+	}
+	if (phba->cfg_irq_chann > phba->sli4_hba.num_present_cpu) {
 		phba->cfg_irq_chann = phba->sli4_hba.num_present_cpu;
-	if (phba->cfg_irq_chann > phba->cfg_hdw_queue)
+		logit = 1;
+	}
+	if (phba->cfg_irq_chann > phba->cfg_hdw_queue) {
 		phba->cfg_irq_chann = phba->cfg_hdw_queue;
+		logit = 1;
+	}
+	if (logit)
+		lpfc_printf_log(phba, KERN_ERR, LOG_SLI,
+				"2006 Reducing Queues - CPU limitation: "
+				"IRQ %d HDWQ %d\n",
+				phba->cfg_irq_chann,
+				phba->cfg_hdw_queue);
 
 	if (phba->cfg_enable_fc4_type & LPFC_ENABLE_NVME &&
 	    phba->nvmet_support) {
* Unmerged path drivers/scsi/lpfc/lpfc_init.c
