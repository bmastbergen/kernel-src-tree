Revert "iommu/arm-smmu: Make arm-smmu explicitly non-modular"

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-294.el8
commit-author Will Deacon <will@kernel.org>
commit b06c076ea96258f31eabd2987a14193883b3641e
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-294.el8/b06c076e.failed

This reverts commit addb672f200f4e99368270da205320b83efe01a0.

Let's get the SMMU driver building as a module, which means putting
back some dead code that we used to carry.

	Signed-off-by: Will Deacon <will@kernel.org>
	Tested-by: John Garry <john.garry@huawei.com> # smmu v3
	Reviewed-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
	Signed-off-by: Joerg Roedel <jroedel@suse.de>
(cherry picked from commit b06c076ea96258f31eabd2987a14193883b3641e)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/iommu/arm-smmu.c
diff --cc drivers/iommu/arm-smmu.c
index ab9a0239376c,7c768f771001..000000000000
--- a/drivers/iommu/arm-smmu.c
+++ b/drivers/iommu/arm-smmu.c
@@@ -38,12 -26,8 +38,11 @@@
  #include <linux/err.h>
  #include <linux/interrupt.h>
  #include <linux/io.h>
 +#include <linux/io-64-nonatomic-hi-lo.h>
 +#include <linux/io-pgtable.h>
 +#include <linux/iommu.h>
  #include <linux/iopoll.h>
- #include <linux/init.h>
- #include <linux/moduleparam.h>
+ #include <linux/module.h>
  #include <linux/of.h>
  #include <linux/of_address.h>
  #include <linux/of_device.h>
@@@ -2476,19 -2268,16 +2478,27 @@@ static const struct dev_pm_ops arm_smmu
  
  static struct platform_driver arm_smmu_driver = {
  	.driver	= {
- 		.name			= "arm-smmu",
- 		.of_match_table		= of_match_ptr(arm_smmu_of_match),
- 		.pm			= &arm_smmu_pm_ops,
- 		.suppress_bind_attrs	= true,
+ 		.name		= "arm-smmu",
+ 		.of_match_table	= of_match_ptr(arm_smmu_of_match),
+ 		.pm		= &arm_smmu_pm_ops,
  	},
  	.probe	= arm_smmu_device_probe,
+ 	.remove	= arm_smmu_device_remove,
  	.shutdown = arm_smmu_device_shutdown,
  };
++<<<<<<< HEAD
 +
 +IOMMU_OF_DECLARE(arm_smmuv1, "arm,smmu-v1");
 +IOMMU_OF_DECLARE(arm_smmuv2, "arm,smmu-v2");
 +IOMMU_OF_DECLARE(arm_mmu400, "arm,mmu-400");
 +IOMMU_OF_DECLARE(arm_mmu401, "arm,mmu-401");
 +IOMMU_OF_DECLARE(arm_mmu500, "arm,mmu-500");
 +IOMMU_OF_DECLARE(cavium_smmuv2, "cavium,smmu-v2");
 +builtin_platform_driver(arm_smmu_driver);
++=======
+ module_platform_driver(arm_smmu_driver);
+ 
+ MODULE_DESCRIPTION("IOMMU API for ARM architected SMMU implementations");
+ MODULE_AUTHOR("Will Deacon <will.deacon@arm.com>");
+ MODULE_LICENSE("GPL v2");
++>>>>>>> b06c076ea962 (Revert "iommu/arm-smmu: Make arm-smmu explicitly non-modular")
* Unmerged path drivers/iommu/arm-smmu.c
