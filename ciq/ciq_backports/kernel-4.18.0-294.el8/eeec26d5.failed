time/namespace: Add max_time_namespaces ucount

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-294.el8
commit-author Dmitry Safonov <dima@arista.com>
commit eeec26d5da8248ea4e240b8795bb4364213d3247
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-294.el8/eeec26d5.failed

Michael noticed that userns limit for number of time namespaces is missing.

Furthermore, time namespace introduced UCOUNT_TIME_NAMESPACES, but didn't
introduce an array member in user_table[]. It would make array's
initialisation OOB write, but by luck the user_table array has an excessive
empty member (all accesses to the array are limited with UCOUNT_COUNTS - so
it silently reuses the last free member.

Fixes user-visible regression: max_inotify_instances by reason of the
missing UCOUNT_ENTRY() has limited max number of namespaces instead of the
number of inotify instances.

Fixes: 769071ac9f20 ("ns: Introduce Time Namespace")
	Reported-by: Michael Kerrisk (man-pages) <mtk.manpages@gmail.com>
	Signed-off-by: Dmitry Safonov <dima@arista.com>
	Signed-off-by: Thomas Gleixner <tglx@linutronix.de>
	Acked-by: Andrei Vagin <avagin@gmail.com>
	Acked-by: Vincenzo Frascino <vincenzo.frascino@arm.com>
	Cc: stable@kernel.org
Link: https://lkml.kernel.org/r/20200406171342.128733-1-dima@arista.com

(cherry picked from commit eeec26d5da8248ea4e240b8795bb4364213d3247)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	Documentation/sysctl/user.txt
diff --cc Documentation/sysctl/user.txt
index a5882865836e,c45824589339..000000000000
--- a/Documentation/sysctl/user.txt
+++ b/Documentation/sysctl/user.txt
@@@ -55,7 -65,14 +55,18 @@@ Currently, these files are in /proc/sys
    The maximum number of pid namespaces that any user in the current
    user namespace may create.
  
++<<<<<<< HEAD:Documentation/sysctl/user.txt
 +- max_user_namespaces
++=======
+ max_time_namespaces
+ ===================
+ 
+   The maximum number of time namespaces that any user in the current
+   user namespace may create.
+ 
+ max_user_namespaces
+ ===================
++>>>>>>> eeec26d5da82 (time/namespace: Add max_time_namespaces ucount):Documentation/admin-guide/sysctl/user.rst
  
    The maximum number of user namespaces that any user in the current
    user namespace may create.
* Unmerged path Documentation/sysctl/user.txt
diff --git a/kernel/ucount.c b/kernel/ucount.c
index 591de5af6755..47d90d1f4376 100644
--- a/kernel/ucount.c
+++ b/kernel/ucount.c
@@ -74,6 +74,7 @@ static struct ctl_table user_table[] = {
 	UCOUNT_ENTRY("max_net_namespaces"),
 	UCOUNT_ENTRY("max_mnt_namespaces"),
 	UCOUNT_ENTRY("max_cgroup_namespaces"),
+	UCOUNT_ENTRY("max_time_namespaces"),
 #ifdef CONFIG_INOTIFY_USER
 	UCOUNT_ENTRY("max_inotify_instances"),
 	UCOUNT_ENTRY("max_inotify_watches"),
