net: stmmac: xgmac: Detect Hash Table size dinamically

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-294.el8
commit-author Jose Abreu <Jose.Abreu@synopsys.com>
commit c11986b9fa74cd3ce218e0ca7e0de88d30e6f497
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-294.el8/c11986b9.failed

Since commit b8ef7020d6e5 ("net: stmmac: add support for hash table size
128/256 in dwmac4"), we can detect the Hash Table dinamically.

Let's implement this feature in XGMAC cores and fix possible setups that
don't support the maximum size for Hash Table.

	Signed-off-by: Jose Abreu <Jose.Abreu@synopsys.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit c11986b9fa74cd3ce218e0ca7e0de88d30e6f497)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/stmicro/stmmac/dwxgmac2.h
#	drivers/net/ethernet/stmicro/stmmac/dwxgmac2_dma.c
diff --cc drivers/net/ethernet/stmicro/stmmac/dwxgmac2.h
index 22cb2a0cfdde,f7eb06f8fb37..000000000000
--- a/drivers/net/ethernet/stmicro/stmmac/dwxgmac2.h
+++ b/drivers/net/ethernet/stmicro/stmmac/dwxgmac2.h
@@@ -120,6 -121,8 +120,11 @@@
  #define XGMAC_HWFEAT_VLHASH		BIT(4)
  #define XGMAC_HWFEAT_GMIISEL		BIT(1)
  #define XGMAC_HW_FEATURE1		0x00000120
++<<<<<<< HEAD
++=======
+ #define XGMAC_HWFEAT_L3L4FNUM		GENMASK(30, 27)
+ #define XGMAC_HWFEAT_HASHTBLSZ		GENMASK(25, 24)
++>>>>>>> c11986b9fa74 (net: stmmac: xgmac: Detect Hash Table size dinamically)
  #define XGMAC_HWFEAT_RSSEN		BIT(20)
  #define XGMAC_HWFEAT_TSOEN		BIT(18)
  #define XGMAC_HWFEAT_SPHEN		BIT(17)
diff --cc drivers/net/ethernet/stmicro/stmmac/dwxgmac2_dma.c
index e77eb0ddf9b5,965cbe3e6f51..000000000000
--- a/drivers/net/ethernet/stmicro/stmmac/dwxgmac2_dma.c
+++ b/drivers/net/ethernet/stmicro/stmmac/dwxgmac2_dma.c
@@@ -378,6 -379,8 +378,11 @@@ static void dwxgmac2_get_hw_feature(voi
  
  	/* MAC HW feature 1 */
  	hw_cap = readl(ioaddr + XGMAC_HW_FEATURE1);
++<<<<<<< HEAD
++=======
+ 	dma_cap->l3l4fnum = (hw_cap & XGMAC_HWFEAT_L3L4FNUM) >> 27;
+ 	dma_cap->hash_tb_sz = (hw_cap & XGMAC_HWFEAT_HASHTBLSZ) >> 24;
++>>>>>>> c11986b9fa74 (net: stmmac: xgmac: Detect Hash Table size dinamically)
  	dma_cap->rssen = (hw_cap & XGMAC_HWFEAT_RSSEN) >> 20;
  	dma_cap->tsoen = (hw_cap & XGMAC_HWFEAT_TSOEN) >> 18;
  	dma_cap->sphen = (hw_cap & XGMAC_HWFEAT_SPHEN) >> 17;
* Unmerged path drivers/net/ethernet/stmicro/stmmac/dwxgmac2.h
* Unmerged path drivers/net/ethernet/stmicro/stmmac/dwxgmac2_dma.c
