net: ena: fix continuous keep-alive resets

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-294.el8
commit-author Arthur Kiyanovski <akiyano@amazon.com>
commit dfdde1345bc124816f0fd42fa91b8748051e758e
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-294.el8/dfdde134.failed

last_keep_alive_jiffies is updated in probe and when a keep-alive
event is received.  In case the driver times-out on a keep-alive event,
it has high chances of continuously timing-out on keep-alive events.
This is because when the driver recovers from the keep-alive-timeout reset
the value of last_keep_alive_jiffies is very old, and if a keep-alive
event is not received before the next timer expires, the value of
last_keep_alive_jiffies will cause another keep-alive-timeout reset
and so forth in a loop.

Solution:
Update last_keep_alive_jiffies whenever the device is restored after
reset.

Fixes: 1738cd3ed342 ("net: ena: Add a driver for Amazon Elastic Network Adapters (ENA)")
	Signed-off-by: Noam Dagan <ndagan@amazon.com>
	Signed-off-by: Arthur Kiyanovski <akiyano@amazon.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit dfdde1345bc124816f0fd42fa91b8748051e758e)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/amazon/ena/ena_netdev.c
diff --cc drivers/net/ethernet/amazon/ena/ena_netdev.c
index 201549e1323b,4647d7656761..000000000000
--- a/drivers/net/ethernet/amazon/ena/ena_netdev.c
+++ b/drivers/net/ethernet/amazon/ena/ena_netdev.c
@@@ -3022,7 -3486,10 +3022,14 @@@ static int ena_restore_device(struct en
  		netif_carrier_on(adapter->netdev);
  
  	mod_timer(&adapter->timer_service, round_jiffies(jiffies + HZ));
++<<<<<<< HEAD
 +	dev_err(&pdev->dev, "Device reset completed successfully\n");
++=======
+ 	adapter->last_keep_alive_jiffies = jiffies;
+ 	dev_err(&pdev->dev,
+ 		"Device reset completed successfully, Driver info: %s\n",
+ 		version);
++>>>>>>> dfdde1345bc1 (net: ena: fix continuous keep-alive resets)
  
  	return rc;
  err_disable_msix:
* Unmerged path drivers/net/ethernet/amazon/ena/ena_netdev.c
