net/sched: act_ct: fix restore the qdisc_skb_cb after defrag

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-294.el8
Rebuild_CHGLOG: - [net] sched: act_ct: fix restore the qdisc_skb_cb after defrag (Ivan Vecera) [1874071]
Rebuild_FUZZ: 96.55%
commit-author wenxu <wenxu@ucloud.cn>
commit ae372cb1750f6c95370f92fe5f5620e0954663ba
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-294.el8/ae372cb1.failed

The fragment packets do defrag in tcf_ct_handle_fragments
will clear the skb->cb which make the qdisc_skb_cb clear
too. So the qdsic_skb_cb should be store before defrag and
restore after that.
It also update the pkt_len after all the
fragments finish the defrag to one packet and make the
following actions counter correct.

Fixes: b57dc7c13ea9 ("net/sched: Introduce action ct")
	Signed-off-by: wenxu <wenxu@ucloud.cn>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit ae372cb1750f6c95370f92fe5f5620e0954663ba)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/sched/act_ct.c
diff --cc net/sched/act_ct.c
index c0253f51149d,5928efb6449c..000000000000
--- a/net/sched/act_ct.c
+++ b/net/sched/act_ct.c
@@@ -703,7 -704,10 +705,14 @@@ static int tcf_ct_handle_fragments(stru
  		err = ip_defrag(net, skb, user);
  		local_bh_enable();
  		if (err && err != -EINPROGRESS)
++<<<<<<< HEAD
 +			return err;
++=======
+ 			goto out_free;
+ 
+ 		if (!err)
+ 			*defrag = true;
++>>>>>>> ae372cb1750f (net/sched: act_ct: fix restore the qdisc_skb_cb after defrag)
  	} else { /* NFPROTO_IPV6 */
  #if IS_ENABLED(CONFIG_NF_DEFRAG_IPV6)
  		enum ip6_defrag_users user = IP6_DEFRAG_CONNTRACK_IN + zone;
* Unmerged path net/sched/act_ct.c
