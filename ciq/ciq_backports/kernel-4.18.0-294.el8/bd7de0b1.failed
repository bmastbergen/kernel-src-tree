scsi: qla2xxx: Add ql2xrdpenable module parameter for RDP

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-294.el8
commit-author Joe Carnuccio <joe.carnuccio@qlogic.com>
commit bd7de0b1c3947e176effb5f5b4a47eab79db771e
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-294.el8/bd7de0b1.failed

This patch provides separate module parameter ql2xrdpenable to turn on/off
RDP capability in the driver. However, if ql2xsmartsan parameter is
enabled, it will also turn on ql2xfdmienable parameter since it is required
for RDP to work.

Link: https://lore.kernel.org/r/20200212214436.25532-9-hmadhani@marvell.com
	Signed-off-by: Joe Carnuccio <joe.carnuccio@qlogic.com>
	Signed-off-by: Himanshu Madhani <hmadhani@marvell.com>
	Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
(cherry picked from commit bd7de0b1c3947e176effb5f5b4a47eab79db771e)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/scsi/qla2xxx/qla_init.c
#	drivers/scsi/qla2xxx/qla_os.c
diff --cc drivers/scsi/qla2xxx/qla_init.c
index f873584077a1,8fee3f5154c7..000000000000
--- a/drivers/scsi/qla2xxx/qla_init.c
+++ b/drivers/scsi/qla2xxx/qla_init.c
@@@ -3744,6 -3714,10 +3750,13 @@@ enable_82xx_npiv
  			    "ISP Firmware failed checksum.\n");
  			goto failed;
  		}
++<<<<<<< HEAD
++=======
+ 
+ 		/* Enable PUREX PASSTHRU */
+ 		if (ql2xrdpenable)
+ 			qla25xx_set_els_cmds_supported(vha);
++>>>>>>> bd7de0b1c394 (scsi: qla2xxx: Add ql2xrdpenable module parameter for RDP)
  	} else
  		goto failed;
  
@@@ -3979,6 -3949,12 +3992,15 @@@ qla24xx_update_fw_options(scsi_qla_host
  		ql_log(ql_log_warn, vha, 0x0104,
  		    "Unable to update Serial Link options (%x).\n", rval);
  	}
++<<<<<<< HEAD
++=======
+ 
+ enable_purex:
+ 	if (ql2xrdpenable)
+ 		ha->fw_options[1] |= ADD_FO1_ENABLE_PUREX_IOCB;
+ 
+ 	qla2x00_set_fw_options(vha, ha->fw_options);
++>>>>>>> bd7de0b1c394 (scsi: qla2xxx: Add ql2xrdpenable module parameter for RDP)
  }
  
  void
@@@ -8728,6 -8688,9 +8750,12 @@@ qla83xx_update_fw_options(scsi_qla_host
  {
  	struct qla_hw_data *ha = vha->hw;
  
++<<<<<<< HEAD
++=======
+ 	if (ql2xrdpenable)
+ 		ha->fw_options[1] |= ADD_FO1_ENABLE_PUREX_IOCB;
+ 
++>>>>>>> bd7de0b1c394 (scsi: qla2xxx: Add ql2xrdpenable module parameter for RDP)
  	qla2x00_set_fw_options(vha, ha->fw_options);
  }
  
diff --cc drivers/scsi/qla2xxx/qla_os.c
index 39ebd7a7f7ff,3e6f7fac1c8e..000000000000
--- a/drivers/scsi/qla2xxx/qla_os.c
+++ b/drivers/scsi/qla2xxx/qla_os.c
@@@ -307,6 -307,22 +308,25 @@@ MODULE_PARM_DESC(ql2xdifbundlinginterna
      "0 (Default). Based on check.\n"
      "1 Force using internal buffers\n");
  
++<<<<<<< HEAD
++=======
+ int ql2xsmartsan;
+ module_param(ql2xsmartsan, int, 0444);
+ module_param_named(smartsan, ql2xsmartsan, int, 0444);
+ MODULE_PARM_DESC(ql2xsmartsan,
+ 		"Send SmartSAN Management Attributes for FDMI Registration."
+ 		" Default is 0 - No SmartSAN registration,"
+ 		" 1 - Register SmartSAN Management Attributes.");
+ 
+ int ql2xrdpenable;
+ module_param(ql2xrdpenable, int, 0444);
+ module_param_named(rdpenable, ql2xrdpenable, int, 0444);
+ MODULE_PARM_DESC(ql2xrdpenable,
+ 		"Enables RDP responses. "
+ 		"0 - no RDP responses (default). "
+ 		"1 - provide RDP responses.");
+ 
++>>>>>>> bd7de0b1c394 (scsi: qla2xxx: Add ql2xrdpenable module parameter for RDP)
  static void qla2x00_clear_drv_active(struct qla_hw_data *);
  static void qla2x00_free_device(scsi_qla_host_t *);
  static int qla2xxx_map_queues(struct Scsi_Host *shost);
diff --git a/drivers/scsi/qla2xxx/qla_gbl.h b/drivers/scsi/qla2xxx/qla_gbl.h
index 793e4bf50456..5544673af97d 100644
--- a/drivers/scsi/qla2xxx/qla_gbl.h
+++ b/drivers/scsi/qla2xxx/qla_gbl.h
@@ -144,6 +144,7 @@ extern int qlport_down_retry;
 extern int ql2xplogiabsentdevice;
 extern int ql2xloginretrycount;
 extern int ql2xfdmienable;
+extern int ql2xrdpenable;
 extern int ql2xsmartsan;
 extern int ql2xallocfwdump;
 extern int ql2xextended_error_logging;
* Unmerged path drivers/scsi/qla2xxx/qla_init.c
* Unmerged path drivers/scsi/qla2xxx/qla_os.c
