bpf: flow_dissector: Check value of unused flags to BPF_PROG_DETACH

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-294.el8
commit-author Lorenz Bauer <lmb@cloudflare.com>
commit 4ac2add65974e4efafb8d4ccd8fc5660417ea312
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-294.el8/4ac2add6.failed

Using BPF_PROG_DETACH on a flow dissector program supports neither
attach_flags nor attach_bpf_fd. Yet no value is enforced for them.

Enforce that attach_flags are zero, and require the current program
to be passed via attach_bpf_fd. This allows us to remove the check
for CAP_SYS_ADMIN, since userspace can now no longer remove
arbitrary flow dissector programs.

Fixes: b27f7bb590ba ("flow_dissector: Move out netns_bpf prog callbacks")
	Signed-off-by: Lorenz Bauer <lmb@cloudflare.com>
	Signed-off-by: Alexei Starovoitov <ast@kernel.org>
Link: https://lore.kernel.org/bpf/20200629095630.7933-3-lmb@cloudflare.com
(cherry picked from commit 4ac2add65974e4efafb8d4ccd8fc5660417ea312)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	include/linux/bpf-netns.h
#	kernel/bpf/net_namespace.c
#	kernel/bpf/syscall.c
diff --cc kernel/bpf/syscall.c
index 9186e511feb3,28c6ef759037..000000000000
--- a/kernel/bpf/syscall.c
+++ b/kernel/bpf/syscall.c
@@@ -2849,7 -2897,7 +2849,11 @@@ static int bpf_prog_detach(const union 
  	case BPF_PROG_TYPE_LIRC_MODE2:
  		return lirc_prog_detach(attr);
  	case BPF_PROG_TYPE_FLOW_DISSECTOR:
++<<<<<<< HEAD
 +		return skb_flow_dissector_bpf_prog_detach(attr);
++=======
+ 		return netns_bpf_prog_detach(attr, ptype);
++>>>>>>> 4ac2add65974 (bpf: flow_dissector: Check value of unused flags to BPF_PROG_DETACH)
  	case BPF_PROG_TYPE_CGROUP_DEVICE:
  	case BPF_PROG_TYPE_CGROUP_SKB:
  	case BPF_PROG_TYPE_CGROUP_SOCK:
* Unmerged path include/linux/bpf-netns.h
* Unmerged path kernel/bpf/net_namespace.c
* Unmerged path include/linux/bpf-netns.h
* Unmerged path kernel/bpf/net_namespace.c
* Unmerged path kernel/bpf/syscall.c
