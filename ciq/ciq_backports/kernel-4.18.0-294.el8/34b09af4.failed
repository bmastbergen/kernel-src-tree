nfsd: fix oops on mixed NFSv4/NFSv3 client access

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-294.el8
commit-author J. Bruce Fields <bfields@redhat.com>
commit 34b09af4f54e6485e28f138ccad159611a240cc1
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-294.el8/34b09af4.failed

If an NFSv2/v3 client breaks an NFSv4 client's delegation, it will hit a
NULL dereference in nfsd_breaker_owns_lease().

Easily reproduceable with for example

	mount -overs=4.2 server:/export /mnt/
	sleep 1h </mnt/file &
	mount -overs=3 server:/export /mnt2/
	touch /mnt2/file

	Reported-by: Robert Dinse <nanook@eskimo.com>
Fixes: 28df3d1539de50 ("nfsd: clients don't need to break their own delegations")
BugLink: https://bugzilla.kernel.org/show_bug.cgi?id=208807
	Signed-off-by: J. Bruce Fields <bfields@redhat.com>
	Signed-off-by: Chuck Lever <chuck.lever@oracle.com>
(cherry picked from commit 34b09af4f54e6485e28f138ccad159611a240cc1)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	fs/nfsd/nfs4state.c
diff --cc fs/nfsd/nfs4state.c
index 9244d8da11af,1ea9bbcc7c24..000000000000
--- a/fs/nfsd/nfs4state.c
+++ b/fs/nfsd/nfs4state.c
@@@ -4533,6 -4588,21 +4533,24 @@@ nfsd_break_deleg_cb(struct file_lock *f
  	return ret;
  }
  
++<<<<<<< HEAD
++=======
+ static bool nfsd_breaker_owns_lease(struct file_lock *fl)
+ {
+ 	struct nfs4_delegation *dl = fl->fl_owner;
+ 	struct svc_rqst *rqst;
+ 	struct nfs4_client *clp;
+ 
+ 	if (!i_am_nfsd())
+ 		return NULL;
+ 	rqst = kthread_data(current);
+ 	if (!rqst->rq_lease_breaker)
+ 		return NULL;
+ 	clp = *(rqst->rq_lease_breaker);
+ 	return dl->dl_stid.sc_client == clp;
+ }
+ 
++>>>>>>> 34b09af4f54e (nfsd: fix oops on mixed NFSv4/NFSv3 client access)
  static int
  nfsd_change_deleg_cb(struct file_lock *onlist, int arg,
  		     struct list_head *dispose)
* Unmerged path fs/nfsd/nfs4state.c
