of: property: Fix create device links for all child-supplier dependencies

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-294.el8
commit-author Nicolas Saenz Julienne <nsaenzjulienne@suse.de>
commit ed3655729182a59b9bef1b564c6fc2dcbbbe954e
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-294.el8/ed365572.failed

Upon adding a new device from a DT node, we scan its properties and its
children's properties in order to create a consumer/supplier
relationship between the device and the property provider.

That said, it's possible for some of the node's children to be disabled,
which will create links that'll never be fulfilled.

To get around this, use the for_each_available_child_of_node() function
instead of for_each_available_node() when iterating over the node's
children.

Fixes: d4387cd11741 ("of: property: Create device links for all child-supplier depencencies")
	Signed-off-by: Nicolas Saenz Julienne <nsaenzjulienne@suse.de>
	Reviewed-by: Saravana Kannan <saravanak@google.com>
	Signed-off-by: Rob Herring <robh@kernel.org>
(cherry picked from commit ed3655729182a59b9bef1b564c6fc2dcbbbe954e)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/of/property.c
diff --cc drivers/of/property.c
index 78ca51dce3b7,9674b3cf500d..000000000000
--- a/drivers/of/property.c
+++ b/drivers/of/property.c
@@@ -1320,10 -1296,10 +1320,15 @@@ static int of_link_to_suppliers(struct 
  
  	for_each_property_of_node(con_np, p)
  		if (of_link_property(dev, con_np, p->name))
 -			ret = -ENODEV;
 +			ret = -EAGAIN;
  
++<<<<<<< HEAD
 +	for_each_child_of_node(con_np, child)
 +		if (of_link_to_suppliers(dev, child))
++=======
+ 	for_each_available_child_of_node(con_np, child)
+ 		if (of_link_to_suppliers(dev, child) && !ret)
++>>>>>>> ed3655729182 (of: property: Fix create device links for all child-supplier dependencies)
  			ret = -EAGAIN;
  
  	return ret;
* Unmerged path drivers/of/property.c
