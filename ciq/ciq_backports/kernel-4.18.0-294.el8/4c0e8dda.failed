gfs2: move setting current->backing_dev_info

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-294.el8
commit-author Christoph Hellwig <hch@lst.de>
commit 4c0e8dda608a51855225c611b5c6b442f95fbc56
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-294.el8/4c0e8dda.failed

Set current->backing_dev_info just around the buffered write calls to
prepare for the next fix.

Fixes: 967bcc91b044 ("gfs2: iomap direct I/O support")
	Cc: stable@vger.kernel.org # v4.19+
	Signed-off-by: Christoph Hellwig <hch@lst.de>
	Signed-off-by: Andreas Gruenbacher <agruenba@redhat.com>
(cherry picked from commit 4c0e8dda608a51855225c611b5c6b442f95fbc56)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	fs/gfs2/file.c
diff --cc fs/gfs2/file.c
index 31149ac3715f,21d032c4b077..000000000000
--- a/fs/gfs2/file.c
+++ b/fs/gfs2/file.c
@@@ -804,9 -868,6 +804,12 @@@ static ssize_t gfs2_file_write_iter(str
  	ret = generic_write_checks(iocb, from);
  	if (ret <= 0)
  		goto out_unlock;
++<<<<<<< HEAD
 +
 +	/* We can write back this queue in page reclaim */
 +	current->backing_dev_info = inode_to_bdi(inode);
++=======
++>>>>>>> 4c0e8dda608a (gfs2: move setting current->backing_dev_info)
  
  	ret = file_remove_privs(file);
  	if (ret)
@@@ -856,8 -921,6 +863,11 @@@
  			iocb->ki_pos += ret;
  	}
  
++<<<<<<< HEAD
 +out2:
 +	current->backing_dev_info = NULL;
++=======
++>>>>>>> 4c0e8dda608a (gfs2: move setting current->backing_dev_info)
  out_unlock:
  	inode_unlock(inode);
  	if (likely(ret > 0)) {
* Unmerged path fs/gfs2/file.c
