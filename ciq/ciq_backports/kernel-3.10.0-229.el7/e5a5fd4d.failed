drm/radeon: Use drm_malloc_ab instead of kmalloc_array

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-229.el7
Rebuild_CHGLOG: - [drm] radeon: Use drm_malloc_ab instead of kmalloc_array (Rob Clark) [1173317]
Rebuild_FUZZ: 96.15%
commit-author Michel Dänzer <michel.daenzer@amd.com>
commit e5a5fd4df21b9c4acb67e815ec949cce594860f8
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-229.el7/e5a5fd4d.failed

Should avoid kmalloc failures due to large number of array entries.

Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=81991
	Reviewed-by: Dave Airlie <airlied@redhat.com>
	Reviewed-by: Christian König <christian.koenig@amd.com>
	Signed-off-by: Michel Dänzer <michel.daenzer@amd.com>
	Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
	Cc: stable@vger.kernel.org
(cherry picked from commit e5a5fd4df21b9c4acb67e815ec949cce594860f8)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/gpu/drm/radeon/radeon_cs.c
#	drivers/gpu/drm/radeon/radeon_ring.c
#	drivers/gpu/drm/radeon/radeon_vm.c
diff --cc drivers/gpu/drm/radeon/radeon_cs.c
index 80285e35bc65,a3e7aed7e680..000000000000
--- a/drivers/gpu/drm/radeon/radeon_cs.c
+++ b/drivers/gpu/drm/radeon/radeon_cs.c
@@@ -339,13 -450,9 +339,19 @@@ static void radeon_cs_parser_fini(struc
  	kfree(parser->track);
  	kfree(parser->relocs);
  	kfree(parser->relocs_ptr);
++<<<<<<< HEAD
 +	for (i = 0; i < parser->nchunks; i++) {
 +		kfree(parser->chunks[i].kdata);
 +		if ((parser->rdev->flags & RADEON_IS_AGP)) {
 +			kfree(parser->chunks[i].kpage[0]);
 +			kfree(parser->chunks[i].kpage[1]);
 +		}
 +	}
++=======
+ 	drm_free_large(parser->vm_bos);
+ 	for (i = 0; i < parser->nchunks; i++)
+ 		drm_free_large(parser->chunks[i].kdata);
++>>>>>>> e5a5fd4df21b (drm/radeon: Use drm_malloc_ab instead of kmalloc_array)
  	kfree(parser->chunks);
  	kfree(parser->chunks_array);
  	radeon_ib_free(parser->rdev, &parser->ib);
diff --cc drivers/gpu/drm/radeon/radeon_ring.c
index b52c08cba7d4,2456f69efd23..000000000000
--- a/drivers/gpu/drm/radeon/radeon_ring.c
+++ b/drivers/gpu/drm/radeon/radeon_ring.c
@@@ -673,8 -355,8 +673,13 @@@ int radeon_ring_restore(struct radeon_d
  		radeon_ring_write(ring, data[i]);
  	}
  
++<<<<<<< HEAD
 +	radeon_ring_unlock_commit(rdev, ring);
 +	kfree(data);
++=======
+ 	radeon_ring_unlock_commit(rdev, ring, false);
+ 	drm_free_large(data);
++>>>>>>> e5a5fd4df21b (drm/radeon: Use drm_malloc_ab instead of kmalloc_array)
  	return 0;
  }
  
* Unmerged path drivers/gpu/drm/radeon/radeon_vm.c
* Unmerged path drivers/gpu/drm/radeon/radeon_cs.c
* Unmerged path drivers/gpu/drm/radeon/radeon_ring.c
* Unmerged path drivers/gpu/drm/radeon/radeon_vm.c
