fuse: restructure ->rename2()

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-229.el7
commit-author Miklos Szeredi <mszeredi@suse.cz>
commit 4237ba43b65aa989674c89fc4f2fe46eebc501ee
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-229.el7/4237ba43.failed

Make ->rename2() universal, i.e. able to handle zero flags.  This is to
make future change of the API easier.

	Signed-off-by: Miklos Szeredi <mszeredi@suse.cz>
(cherry picked from commit 4237ba43b65aa989674c89fc4f2fe46eebc501ee)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	fs/fuse/dir.c
diff --cc fs/fuse/dir.c
index 8353dae6b4a4,0c6048247a34..000000000000
--- a/fs/fuse/dir.c
+++ b/fs/fuse/dir.c
@@@ -811,6 -815,42 +811,45 @@@ static int fuse_rename(struct inode *ol
  	return err;
  }
  
++<<<<<<< HEAD
++=======
+ static int fuse_rename2(struct inode *olddir, struct dentry *oldent,
+ 			struct inode *newdir, struct dentry *newent,
+ 			unsigned int flags)
+ {
+ 	struct fuse_conn *fc = get_fuse_conn(olddir);
+ 	int err;
+ 
+ 	if (flags & ~(RENAME_NOREPLACE | RENAME_EXCHANGE))
+ 		return -EINVAL;
+ 
+ 	if (flags) {
+ 		if (fc->no_rename2 || fc->minor < 23)
+ 			return -EINVAL;
+ 
+ 		err = fuse_rename_common(olddir, oldent, newdir, newent, flags,
+ 					 FUSE_RENAME2,
+ 					 sizeof(struct fuse_rename2_in));
+ 		if (err == -ENOSYS) {
+ 			fc->no_rename2 = 1;
+ 			err = -EINVAL;
+ 		}
+ 	} else {
+ 		err = fuse_rename_common(olddir, oldent, newdir, newent, 0,
+ 					 FUSE_RENAME,
+ 					 sizeof(struct fuse_rename_in));
+ 	}
+ 
+ 	return err;
+ }
+ 
+ static int fuse_rename(struct inode *olddir, struct dentry *oldent,
+ 		       struct inode *newdir, struct dentry *newent)
+ {
+ 	return fuse_rename2(olddir, oldent, newdir, newent, 0);
+ }
+ 
++>>>>>>> 4237ba43b65a (fuse: restructure ->rename2())
  static int fuse_link(struct dentry *entry, struct inode *newdir,
  		     struct dentry *newent)
  {
* Unmerged path fs/fuse/dir.c
