drm/i915: Disable RCS flips on Ivybridge

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-229.el7
Rebuild_CHGLOG: - [drm] i915: Disable RCS flips on Ivybridge (Rob Clark) [1153301]
Rebuild_FUZZ: 94.74%
commit-author Chris Wilson <chris@chris-wilson.co.uk>
commit 2a92d5bca1999b69c78f3c3e97b5484985b094b9
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-229.el7/2a92d5bc.failed

We currently see random GPU hangs when using RCS flips with multiple
pipes on Ivybridge. Now that we have mmio flips, we can fairly cheaply
fallback to using CPU driven flips instead.

	Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>
Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=77104
	Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>
(cherry picked from commit 2a92d5bca1999b69c78f3c3e97b5484985b094b9)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/gpu/drm/i915/intel_display.c
diff --cc drivers/gpu/drm/i915/intel_display.c
index aad6f7bfc589,8728c8885339..000000000000
--- a/drivers/gpu/drm/i915/intel_display.c
+++ b/drivers/gpu/drm/i915/intel_display.c
@@@ -8067,7 -9653,22 +8067,26 @@@ static int intel_crtc_page_flip(struct 
  	atomic_inc(&intel_crtc->unpin_work_count);
  	intel_crtc->reset_counter = atomic_read(&dev_priv->gpu_error.reset_counter);
  
++<<<<<<< HEAD
 +	ret = dev_priv->display.queue_flip(dev, crtc, fb, obj, page_flip_flags);
++=======
+ 	if (INTEL_INFO(dev)->gen >= 5 || IS_G4X(dev))
+ 		work->flip_count = I915_READ(PIPE_FLIPCOUNT_GM45(pipe)) + 1;
+ 
+ 	if (IS_VALLEYVIEW(dev)) {
+ 		ring = &dev_priv->ring[BCS];
+ 	} else if (IS_IVYBRIDGE(dev)) {
+ 		ring = &dev_priv->ring[BCS];
+ 	} else if (INTEL_INFO(dev)->gen >= 7) {
+ 		ring = obj->ring;
+ 		if (ring == NULL || ring->id != RCS)
+ 			ring = &dev_priv->ring[BCS];
+ 	} else {
+ 		ring = &dev_priv->ring[RCS];
+ 	}
+ 
+ 	ret = intel_pin_and_fence_fb_obj(dev, obj, ring);
++>>>>>>> 2a92d5bca199 (drm/i915: Disable RCS flips on Ivybridge)
  	if (ret)
  		goto cleanup_pending;
  
* Unmerged path drivers/gpu/drm/i915/intel_display.c
