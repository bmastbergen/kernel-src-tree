be2net: use adapter->flags to track SRIOV state

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-229.el7
commit-author Vasundhara Volam <vasundhara.volam@emulex.com>
commit f174c7ec10d99e62f7722d0608b2a881ef091d21
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-229.el7/f174c7ec.failed

The driver so far used adapter->num_vfs value to check if SR-IOV is enabled
or not. But, the patch bec84e6("create optimal number of queues on SR-IOV
config") changed this logic. The adapter->num_vfs value is validated and set
much before SR-IOV is enabled. So, we now use an explicit flag to track
SR-IOV enabled state.

	Signed-off-by: Vasundhara Volam <vasundhara.volam@emulex.com>
	Signed-off-by: Sathya Perla <sathya.perla@emulex.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit f174c7ec10d99e62f7722d0608b2a881ef091d21)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/emulex/benet/be.h
diff --cc drivers/net/ethernet/emulex/benet/be.h
index 36d5a8d2df18,25cd3c9007e5..000000000000
--- a/drivers/net/ethernet/emulex/benet/be.h
+++ b/drivers/net/ethernet/emulex/benet/be.h
@@@ -523,9 -526,9 +524,15 @@@ struct be_adapter 
  
  #define be_physfn(adapter)		(!adapter->virtfn)
  #define be_virtfn(adapter)		(adapter->virtfn)
++<<<<<<< HEAD
 +#define	sriov_enabled(adapter)		(adapter->num_vfs > 0)
 +#define sriov_want(adapter)             (be_physfn(adapter) &&	\
 +					 (num_vfs || pci_num_vf(adapter->pdev)))
++=======
+ #define sriov_enabled(adapter)		(adapter->flags &	\
+ 					 BE_FLAGS_SRIOV_ENABLED)
+ 
++>>>>>>> f174c7ec10d9 (be2net: use adapter->flags to track SRIOV state)
  #define for_all_vfs(adapter, vf_cfg, i)					\
  	for (i = 0, vf_cfg = &adapter->vf_cfg[i]; i < adapter->num_vfs;	\
  		i++, vf_cfg++)
* Unmerged path drivers/net/ethernet/emulex/benet/be.h
diff --git a/drivers/net/ethernet/emulex/benet/be_main.c b/drivers/net/ethernet/emulex/benet/be_main.c
index d1cbd832c5a1..d0fd665d4b1d 100644
--- a/drivers/net/ethernet/emulex/benet/be_main.c
+++ b/drivers/net/ethernet/emulex/benet/be_main.c
@@ -2991,6 +2991,7 @@ static void be_vf_clear(struct be_adapter *adapter)
 done:
 	kfree(adapter->vf_cfg);
 	adapter->num_vfs = 0;
+	adapter->flags &= ~BE_FLAGS_SRIOV_ENABLED;
 }
 
 static void be_clear_queues(struct be_adapter *adapter)
@@ -3198,6 +3199,8 @@ static int be_vf_setup(struct be_adapter *adapter)
 			goto err;
 		}
 	}
+
+	adapter->flags |= BE_FLAGS_SRIOV_ENABLED;
 	return 0;
 err:
 	dev_err(dev, "VF setup failed\n");
