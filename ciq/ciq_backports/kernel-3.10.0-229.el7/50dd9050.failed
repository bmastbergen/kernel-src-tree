ALSA: hda - add capture mute led support in led_power_filter

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-229.el7
Rebuild_CHGLOG: - [alsa] hda: add capture mute led support in led_power_filter (Jaroslav Kysela) [1112200]
Rebuild_FUZZ: 92.04%
commit-author Hui Wang <hui.wang@canonical.com>
commit 50dd9050e45ce11c575eabcaee8a914caf78fb74
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-229.el7/50dd9050.failed

Now the led_power_filter() needs to handle 3 situations:
    - only mute_led_nid is set
    - only cap_mute_led_nid is set
    - both mute_led_ind and cap_mute_led_nid are set

BugLink: https://bugs.launchpad.net/bugs/1329580
	Cc: David Henningsson <david.henningsson@canonical.com>
	Cc: Kailang Yang <kailang@realtek.com>
	Signed-off-by: Hui Wang <hui.wang@canonical.com>
	Signed-off-by: Takashi Iwai <tiwai@suse.de>
(cherry picked from commit 50dd9050e45ce11c575eabcaee8a914caf78fb74)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	sound/pci/hda/patch_realtek.c
diff --cc sound/pci/hda/patch_realtek.c
index d244d7cf778f,512582b1f10a..000000000000
--- a/sound/pci/hda/patch_realtek.c
+++ b/sound/pci/hda/patch_realtek.c
@@@ -3512,6 -3522,68 +3513,71 @@@ static void alc269_fixup_hp_gpio_led(st
  	}
  }
  
++<<<<<<< HEAD
++=======
+ /* turn on/off mic-mute LED per capture hook */
+ static void alc269_fixup_hp_cap_mic_mute_hook(struct hda_codec *codec,
+ 					       struct snd_kcontrol *kcontrol,
+ 					       struct snd_ctl_elem_value *ucontrol)
+ {
+ 	struct alc_spec *spec = codec->spec;
+ 	unsigned int pinval, enable, disable;
+ 
+ 	pinval = snd_hda_codec_get_pin_target(codec, spec->cap_mute_led_nid);
+ 	pinval &= ~AC_PINCTL_VREFEN;
+ 	enable  = pinval | AC_PINCTL_VREF_80;
+ 	disable = pinval | AC_PINCTL_VREF_HIZ;
+ 
+ 	if (!ucontrol)
+ 		return;
+ 
+ 	if (ucontrol->value.integer.value[0] ||
+ 	    ucontrol->value.integer.value[1])
+ 		pinval = disable;
+ 	else
+ 		pinval = enable;
+ 
+ 	if (spec->cap_mute_led_nid)
+ 		snd_hda_set_pin_ctl_cache(codec, spec->cap_mute_led_nid, pinval);
+ }
+ 
+ static void alc269_fixup_hp_gpio_mic1_led(struct hda_codec *codec,
+ 				const struct hda_fixup *fix, int action)
+ {
+ 	struct alc_spec *spec = codec->spec;
+ 	static const struct hda_verb gpio_init[] = {
+ 		{ 0x01, AC_VERB_SET_GPIO_MASK, 0x08 },
+ 		{ 0x01, AC_VERB_SET_GPIO_DIRECTION, 0x08 },
+ 		{}
+ 	};
+ 
+ 	if (action == HDA_FIXUP_ACT_PRE_PROBE) {
+ 		spec->gen.vmaster_mute.hook = alc269_fixup_hp_gpio_mute_hook;
+ 		spec->gen.cap_sync_hook = alc269_fixup_hp_cap_mic_mute_hook;
+ 		spec->gpio_led = 0;
+ 		spec->cap_mute_led_nid = 0x18;
+ 		snd_hda_add_verbs(codec, gpio_init);
+ 		codec->power_filter = led_power_filter;
+ 	}
+ }
+ 
+ static void alc269_fixup_hp_line1_mic1_led(struct hda_codec *codec,
+ 				const struct hda_fixup *fix, int action)
+ {
+ 	struct alc_spec *spec = codec->spec;
+ 
+ 	if (action == HDA_FIXUP_ACT_PRE_PROBE) {
+ 		spec->gen.vmaster_mute.hook = alc269_fixup_mic_mute_hook;
+ 		spec->gen.cap_sync_hook = alc269_fixup_hp_cap_mic_mute_hook;
+ 		spec->mute_led_polarity = 0;
+ 		spec->mute_led_nid = 0x1a;
+ 		spec->cap_mute_led_nid = 0x18;
+ 		spec->gen.vmaster_mute_enum = 1;
+ 		codec->power_filter = led_power_filter;
+ 	}
+ }
+ 
++>>>>>>> 50dd9050e45c (ALSA: hda - add capture mute led support in led_power_filter)
  static void alc_headset_mode_unplugged(struct hda_codec *codec)
  {
  	int val;
* Unmerged path sound/pci/hda/patch_realtek.c
