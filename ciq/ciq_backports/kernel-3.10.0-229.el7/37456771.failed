shmem: support RENAME_EXCHANGE

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-229.el7
commit-author Miklos Szeredi <mszeredi@suse.cz>
commit 37456771c58be10dd813fb4510035d0d67a969aa
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-229.el7/37456771.failed

This is really simple in tmpfs since the VFS already takes care of
shuffling the dentries.  Just adjust nlink on parent directories and touch
c & mtimes.

	Signed-off-by: Miklos Szeredi <mszeredi@suse.cz>
	Acked-by: Hugh Dickins <hughd@google.com>
	Signed-off-by: Christoph Hellwig <hch@lst.de>
	Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>
(cherry picked from commit 37456771c58be10dd813fb4510035d0d67a969aa)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	mm/shmem.c
diff --cc mm/shmem.c
index 22692ea1ab67,0f018002dd64..000000000000
--- a/mm/shmem.c
+++ b/mm/shmem.c
@@@ -2063,6 -2081,12 +2085,15 @@@ static int shmem_rename(struct inode *o
  	struct inode *inode = old_dentry->d_inode;
  	int they_are_dirs = S_ISDIR(inode->i_mode);
  
++<<<<<<< HEAD
++=======
+ 	if (flags & ~(RENAME_NOREPLACE | RENAME_EXCHANGE))
+ 		return -EINVAL;
+ 
+ 	if (flags & RENAME_EXCHANGE)
+ 		return shmem_exchange(old_dir, old_dentry, new_dir, new_dentry);
+ 
++>>>>>>> 37456771c58b (shmem: support RENAME_EXCHANGE)
  	if (!simple_empty(new_dentry))
  		return -ENOTEMPTY;
  
* Unmerged path mm/shmem.c
