perf tools: Disable libdw unwind for all but x86 arch

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-229.el7
Rebuild_CHGLOG: - [tools] perf: Disable libdw unwind for all but x86 arch (Jiri Olsa) [1134356]
Rebuild_FUZZ: 94.00%
commit-author Jiri Olsa <jolsa@redhat.com>
commit 4dc549e58b6ebf63554cd466d5ceb0e9c70ab859
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-229.el7/4dc549e5.failed

So far there's only x86 libdw unwind support merged in perf.
Disable it on all other architectures in case libdw unwind
support is detected in system.

	Cc: Arnaldo Carvalho de Melo <acme@ghostprotocols.net>
	Cc: Corey Ashford <cjashfor@linux.vnet.ibm.com>
	Cc: David Ahern <dsahern@gmail.com>
	Cc: Frederic Weisbecker <fweisbec@gmail.com>
	Cc: Ingo Molnar <mingo@kernel.org>
	Cc: Jean Pihet <jean.pihet@linaro.org>
	Cc: Josh Boyer <jwboyer@fedoraproject.org>
	Cc: Namhyung Kim <namhyung@kernel.org>
	Cc: Paul Mackerras <paulus@samba.org>
	Cc: Peter Zijlstra <a.p.zijlstra@chello.nl>
Link: http://lkml.kernel.org/r/1397988006-14158-1-git-send-email-jolsa@redhat.com
	Signed-off-by: Jiri Olsa <jolsa@redhat.com>
(cherry picked from commit 4dc549e58b6ebf63554cd466d5ceb0e9c70ab859)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	tools/perf/config/Makefile
diff --cc tools/perf/config/Makefile
index 8a0483155189,a71fb395e38f..000000000000
--- a/tools/perf/config/Makefile
+++ b/tools/perf/config/Makefile
@@@ -47,6 -12,71 +47,74 @@@ obj-perf := $(abspath $(obj-perf))
  endif
  
  LIB_INCLUDE := $(srctree)/tools/lib/
++<<<<<<< HEAD
++=======
+ CFLAGS := $(EXTRA_CFLAGS) $(EXTRA_WARNINGS)
+ 
+ include $(src-perf)/config/Makefile.arch
+ 
+ NO_PERF_REGS := 1
+ 
+ # Additional ARCH settings for x86
+ ifeq ($(ARCH),x86)
+   ifeq (${IS_X86_64}, 1)
+     CFLAGS += -DHAVE_ARCH_X86_64_SUPPORT
+     ARCH_INCLUDE = ../../arch/x86/lib/memcpy_64.S ../../arch/x86/lib/memset_64.S
+     LIBUNWIND_LIBS = -lunwind -lunwind-x86_64
+   else
+     LIBUNWIND_LIBS = -lunwind -lunwind-x86
+   endif
+   NO_PERF_REGS := 0
+ endif
+ ifeq ($(ARCH),arm)
+   NO_PERF_REGS := 0
+   LIBUNWIND_LIBS = -lunwind -lunwind-arm
+ endif
+ 
+ # So far there's only x86 libdw unwind support merged in perf.
+ # Disable it on all other architectures in case libdw unwind
+ # support is detected in system. Add supported architectures
+ # to the check.
+ ifneq ($(ARCH),x86)
+   NO_LIBDW_DWARF_UNWIND := 1
+ endif
+ 
+ ifeq ($(LIBUNWIND_LIBS),)
+   NO_LIBUNWIND := 1
+ else
+   #
+   # For linking with debug library, run like:
+   #
+   #   make DEBUG=1 LIBUNWIND_DIR=/opt/libunwind/
+   #
+   ifdef LIBUNWIND_DIR
+     LIBUNWIND_CFLAGS  = -I$(LIBUNWIND_DIR)/include
+     LIBUNWIND_LDFLAGS = -L$(LIBUNWIND_DIR)/lib
+   endif
+   LIBUNWIND_LDFLAGS += $(LIBUNWIND_LIBS)
+ 
+   # Set per-feature check compilation flags
+   FEATURE_CHECK_CFLAGS-libunwind = $(LIBUNWIND_CFLAGS)
+   FEATURE_CHECK_LDFLAGS-libunwind = $(LIBUNWIND_LDFLAGS)
+   FEATURE_CHECK_CFLAGS-libunwind-debug-frame = $(LIBUNWIND_CFLAGS)
+   FEATURE_CHECK_LDFLAGS-libunwind-debug-frame = $(LIBUNWIND_LDFLAGS)
+ endif
+ 
+ ifeq ($(NO_PERF_REGS),0)
+   CFLAGS += -DHAVE_PERF_REGS_SUPPORT
+ endif
+ 
+ ifndef NO_LIBELF
+   # for linking with debug library, run like:
+   # make DEBUG=1 LIBDW_DIR=/opt/libdw/
+   ifdef LIBDW_DIR
+     LIBDW_CFLAGS  := -I$(LIBDW_DIR)/include
+     LIBDW_LDFLAGS := -L$(LIBDW_DIR)/lib
+   endif
+   FEATURE_CHECK_CFLAGS-libdw-dwarf-unwind := $(LIBDW_CFLAGS)
+   FEATURE_CHECK_LDFLAGS-libdw-dwarf-unwind := $(LIBDW_LDFLAGS) -ldw
+ endif
++>>>>>>> 4dc549e58b6e (perf tools: Disable libdw unwind for all but x86 arch)
  
  # include ARCH specific config
  -include $(src-perf)/arch/$(ARCH)/Makefile
* Unmerged path tools/perf/config/Makefile
