mpt2sas: Get IOC_FACTS information using handshake protocol only after HBA card gets into READY or Operational state.

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-229.el7
Rebuild_CHGLOG: - [scsi] mpt2sas: Get IOC_FACTS information using handshake protocol only after HBA card gets into READY or Operational state (Tomas Henzl) [1088524]
Rebuild_FUZZ: 99.57%
commit-author Sreekanth Reddy <sreekanth.reddy@avagotech.com>
commit a66dd970c7808f0a3453bbc38b39553f6eafd994
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-229.el7/a66dd970.failed

Driver initialization fails if driver tries to send IOC facts request message when the IOC is in reset or in a fault state.

This patch will make sure that
 1.Driver to send IOC facts request message only if HBA is in operational or ready state.
 2.If IOC is in fault state, a diagnostic reset would be issued.
 3.If IOC is in reset state then driver will wait for 10 seconds to exit out of reset state.
   If the HBA continues to be in reset state, then the HBA wouldn't be claimed by the driver.

	Signed-off-by: Sreekanth Reddy <Sreekanth.Reddy@avagotech.com>
	Reviewed-by: Martin K. Petersen <martin.petersen@oracle.com>
	Signed-off-by: Christoph Hellwig <hch@lst.de>
(cherry picked from commit a66dd970c7808f0a3453bbc38b39553f6eafd994)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/scsi/mpt2sas/mpt2sas_base.c
diff --cc drivers/scsi/mpt2sas/mpt2sas_base.c
index 2f86ba8ae9c2,58e45216d1ec..000000000000
--- a/drivers/scsi/mpt2sas/mpt2sas_base.c
+++ b/drivers/scsi/mpt2sas/mpt2sas_base.c
@@@ -88,6 -92,12 +88,15 @@@ static int disable_discovery = -1
  module_param(disable_discovery, int, 0);
  MODULE_PARM_DESC(disable_discovery, " disable discovery ");
  
++<<<<<<< HEAD
++=======
+ static int
+ _base_get_ioc_facts(struct MPT2SAS_ADAPTER *ioc, int sleep_flag);
+ 
+ static int
+ _base_diag_reset(struct MPT2SAS_ADAPTER *ioc, int sleep_flag);
+ 
++>>>>>>> a66dd970c780 (mpt2sas: Get IOC_FACTS information using handshake protocol only after HBA card gets into READY or Operational state.)
  /**
   * _scsih_set_fwfault_debug - global setting of ioc->fwfault_debug.
   *
* Unmerged path drivers/scsi/mpt2sas/mpt2sas_base.c
