iscsi-target: Fix ABORT_TASK + connection reset iscsi_queue_req memory leak

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-229.el7
Rebuild_CHGLOG: - [target] iscsi: Fix ABORT_TASK + connection reset iscsi_queue_req memory leak (Andy Grover) [1129387]
Rebuild_FUZZ: 95.10%
commit-author Nicholas Bellinger <nab@linux-iscsi.org>
commit bbc050488525e1ab1194c27355f63c66814385b8
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-229.el7/bbc05048.failed

This patch fixes a iscsi_queue_req memory leak when ABORT_TASK response
has been queued by TFO->queue_tm_rsp() -> lio_queue_tm_rsp() after a
long standing I/O completes, but the connection has already reset and
waiting for cleanup to complete in iscsit_release_commands_from_conn()
-> transport_generic_free_cmd() -> transport_wait_for_tasks() code.

It moves iscsit_free_queue_reqs_for_conn() after the per-connection command
list has been released, so that the associated se_cmd tag can be completed +
released by target-core before freeing any remaining iscsi_queue_req memory
for the connection generated by lio_queue_tm_rsp().

	Cc: Thomas Glanzmann <thomas@glanzmann.de>
	Cc: Charalampos Pournaris <charpour@gmail.com>
	Cc: stable@vger.kernel.org # 3.10+
	Signed-off-by: Nicholas Bellinger <nab@linux-iscsi.org>
(cherry picked from commit bbc050488525e1ab1194c27355f63c66814385b8)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/target/iscsi/iscsi_target.c
diff --cc drivers/target/iscsi/iscsi_target.c
index 413f96f68744,e0d98344e4bd..000000000000
--- a/drivers/target/iscsi/iscsi_target.c
+++ b/drivers/target/iscsi/iscsi_target.c
@@@ -4144,7 -4227,9 +4144,13 @@@ int iscsit_close_connection
  	iscsit_stop_timers_for_cmds(conn);
  	iscsit_stop_nopin_response_timer(conn);
  	iscsit_stop_nopin_timer(conn);
++<<<<<<< HEAD
 +	iscsit_free_queue_reqs_for_conn(conn);
++=======
+ 
+ 	if (conn->conn_transport->iscsit_wait_conn)
+ 		conn->conn_transport->iscsit_wait_conn(conn);
++>>>>>>> bbc050488525 (iscsi-target: Fix ABORT_TASK + connection reset iscsi_queue_req memory leak)
  
  	/*
  	 * During Connection recovery drop unacknowledged out of order
* Unmerged path drivers/target/iscsi/iscsi_target.c
