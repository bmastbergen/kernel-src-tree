ipmi: Cleanup error return

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-229.el7
commit-author Corey Minyard <cminyard@mvista.com>
commit d02b3709ff8efebfca0612d0ac2a6e31a91c13f4
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-229.el7/d02b3709.failed

Return proper errors for a lot of IPMI failure cases.  Also call
pci_disable_device when IPMI PCI devices are removed.

	Signed-off-by: Corey Minyard <cminyard@mvista.com>
	Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
(cherry picked from commit d02b3709ff8efebfca0612d0ac2a6e31a91c13f4)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/char/ipmi/ipmi_si_intf.c
diff --cc drivers/char/ipmi/ipmi_si_intf.c
index 2312a8299fc0,671c3852d359..000000000000
--- a/drivers/char/ipmi/ipmi_si_intf.c
+++ b/drivers/char/ipmi/ipmi_si_intf.c
@@@ -2699,6 -2720,63 +2712,66 @@@ static struct platform_driver ipmi_driv
  	.remove		= ipmi_remove,
  };
  
++<<<<<<< HEAD
++=======
+ #ifdef CONFIG_PARISC
+ static int ipmi_parisc_probe(struct parisc_device *dev)
+ {
+ 	struct smi_info *info;
+ 
+ 	info = smi_info_alloc();
+ 
+ 	if (!info) {
+ 		dev_err(&dev->dev,
+ 			"could not allocate memory for PARISC probe\n");
+ 		return -ENOMEM;
+ 	}
+ 
+ 	info->si_type		= SI_KCS;
+ 	info->addr_source	= SI_DEVICETREE;
+ 	info->io_setup		= mem_setup;
+ 	info->io.addr_type	= IPMI_MEM_ADDR_SPACE;
+ 	info->io.addr_data	= dev->hpa.start;
+ 	info->io.regsize	= 1;
+ 	info->io.regspacing	= 1;
+ 	info->io.regshift	= 0;
+ 	info->irq		= 0; /* no interrupt */
+ 	info->irq_setup		= NULL;
+ 	info->dev		= &dev->dev;
+ 
+ 	dev_dbg(&dev->dev, "addr 0x%lx\n", info->io.addr_data);
+ 
+ 	dev_set_drvdata(&dev->dev, info);
+ 
+ 	rv = add_smi(info);
+ 	if (rv) {
+ 		kfree(info);
+ 		return rv;
+ 	}
+ 
+ 	return 0;
+ }
+ 
+ static int ipmi_parisc_remove(struct parisc_device *dev)
+ {
+ 	cleanup_one_si(dev_get_drvdata(&dev->dev));
+ 	return 0;
+ }
+ 
+ static struct parisc_device_id ipmi_parisc_tbl[] = {
+ 	{ HPHW_MC, HVERSION_REV_ANY_ID, 0x004, 0xC0 },
+ 	{ 0, }
+ };
+ 
+ static struct parisc_driver ipmi_parisc_driver = {
+ 	.name =		"ipmi",
+ 	.id_table =	ipmi_parisc_tbl,
+ 	.probe =	ipmi_parisc_probe,
+ 	.remove =	ipmi_parisc_remove,
+ };
+ #endif /* CONFIG_PARISC */
+ 
++>>>>>>> d02b3709ff8e (ipmi: Cleanup error return)
  static int wait_for_msg_done(struct smi_info *smi_info)
  {
  	enum si_sm_result     smi_result;
* Unmerged path drivers/char/ipmi/ipmi_si_intf.c
