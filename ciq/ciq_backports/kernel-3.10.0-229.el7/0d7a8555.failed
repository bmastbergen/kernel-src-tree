vfs: add RENAME_WHITEOUT

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-229.el7
commit-author Miklos Szeredi <mszeredi@suse.cz>
commit 0d7a855526dd672e114aff2ac22b60fc6f155b08
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-229.el7/0d7a8555.failed

This adds a new RENAME_WHITEOUT flag.  This flag makes rename() create a
whiteout of source.  The whiteout creation is atomic relative to the
rename.

	Signed-off-by: Miklos Szeredi <mszeredi@suse.cz>
(cherry picked from commit 0d7a855526dd672e114aff2ac22b60fc6f155b08)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	fs/namei.c
#	include/uapi/linux/fs.h
diff --cc fs/namei.c
index 805c1e534c10,42df664e95e5..000000000000
--- a/fs/namei.c
+++ b/fs/namei.c
@@@ -4145,6 -4208,17 +4145,20 @@@ SYSCALL_DEFINE4(renameat, int, olddfd, 
  	unsigned int lookup_flags = 0;
  	bool should_retry = false;
  	int error;
++<<<<<<< HEAD
++=======
+ 
+ 	if (flags & ~(RENAME_NOREPLACE | RENAME_EXCHANGE | RENAME_WHITEOUT))
+ 		return -EINVAL;
+ 
+ 	if ((flags & (RENAME_NOREPLACE | RENAME_WHITEOUT)) &&
+ 	    (flags & RENAME_EXCHANGE))
+ 		return -EINVAL;
+ 
+ 	if ((flags & RENAME_WHITEOUT) && !capable(CAP_MKNOD))
+ 		return -EPERM;
+ 
++>>>>>>> 0d7a855526dd (vfs: add RENAME_WHITEOUT)
  retry:
  	from = user_path_parent(olddfd, oldname, &oldnd, lookup_flags);
  	if (IS_ERR(from)) {
diff --cc include/uapi/linux/fs.h
index a4ed56cf0eac,3735fa0a6784..000000000000
--- a/include/uapi/linux/fs.h
+++ b/include/uapi/linux/fs.h
@@@ -35,6 -35,10 +35,13 @@@
  #define SEEK_HOLE	4	/* seek to the next hole */
  #define SEEK_MAX	SEEK_HOLE
  
++<<<<<<< HEAD
++=======
+ #define RENAME_NOREPLACE	(1 << 0)	/* Don't overwrite target */
+ #define RENAME_EXCHANGE		(1 << 1)	/* Exchange source and dest */
+ #define RENAME_WHITEOUT		(1 << 2)	/* Whiteout source */
+ 
++>>>>>>> 0d7a855526dd (vfs: add RENAME_WHITEOUT)
  struct fstrim_range {
  	__u64 start;
  	__u64 len;
* Unmerged path fs/namei.c
* Unmerged path include/uapi/linux/fs.h
