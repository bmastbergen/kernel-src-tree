x86/gpu: Add vfunc for Intel graphics stolen memory base address

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-229.el7
Rebuild_CHGLOG: - [x86] quirks: Add vfunc for Intel graphics stolen memory base address (Rob Clark) [1154053]
Rebuild_FUZZ: 91.34%
commit-author Ville Syrj채l채 <ville.syrjala@linux.intel.com>
commit 52ca70454ea5ff29bc39f7871d28f8e6f4713867
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-229.el7/52ca7045.failed

For gen2 devices we're going to need another way to determine
the stolen memory base address. Make that into a vfunc as well.

Also drop the bogus inline keyword from gen8_stolen_size().

	Signed-off-by: Ville Syrj채l채 <ville.syrjala@linux.intel.com>
	Cc: Bjorn Helgaas <bhelgaas@google.com>
Link: http://lkml.kernel.org/r/1391628540-23072-2-git-send-email-ville.syrjala@linux.intel.com
	Signed-off-by: Ingo Molnar <mingo@kernel.org>
(cherry picked from commit 52ca70454ea5ff29bc39f7871d28f8e6f4713867)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/x86/kernel/early-quirks.c
diff --cc arch/x86/kernel/early-quirks.c
index ae491de42508,fddd4d05d1fa..000000000000
--- a/arch/x86/kernel/early-quirks.c
+++ b/arch/x86/kernel/early-quirks.c
@@@ -313,29 -313,60 +313,86 @@@ static size_t __init gen6_stolen_size(i
  	return gmch_ctrl << 25; /* 32 MB units */
  }
  
++<<<<<<< HEAD
 +typedef size_t (*stolen_size_fn)(int num, int slot, int func);
 +
 +static struct pci_device_id intel_stolen_ids[] __initdata = {
 +	INTEL_I915G_IDS(gen3_stolen_size),
 +	INTEL_I915GM_IDS(gen3_stolen_size),
 +	INTEL_I945G_IDS(gen3_stolen_size),
 +	INTEL_I945GM_IDS(gen3_stolen_size),
 +	INTEL_VLV_M_IDS(gen6_stolen_size),
 +	INTEL_VLV_D_IDS(gen6_stolen_size),
 +	INTEL_PINEVIEW_IDS(gen3_stolen_size),
 +	INTEL_I965G_IDS(gen3_stolen_size),
 +	INTEL_G33_IDS(gen3_stolen_size),
 +	INTEL_I965GM_IDS(gen3_stolen_size),
 +	INTEL_GM45_IDS(gen3_stolen_size),
 +	INTEL_G45_IDS(gen3_stolen_size),
 +	INTEL_IRONLAKE_D_IDS(gen3_stolen_size),
 +	INTEL_IRONLAKE_M_IDS(gen3_stolen_size),
 +	INTEL_SNB_D_IDS(gen6_stolen_size),
 +	INTEL_SNB_M_IDS(gen6_stolen_size),
 +	INTEL_IVB_M_IDS(gen6_stolen_size),
 +	INTEL_IVB_D_IDS(gen6_stolen_size),
 +	INTEL_HSW_D_IDS(gen6_stolen_size),
 +	INTEL_HSW_M_IDS(gen6_stolen_size),
++=======
+ static size_t gen8_stolen_size(int num, int slot, int func)
+ {
+ 	u16 gmch_ctrl;
+ 
+ 	gmch_ctrl = read_pci_config_16(num, slot, func, SNB_GMCH_CTRL);
+ 	gmch_ctrl >>= BDW_GMCH_GMS_SHIFT;
+ 	gmch_ctrl &= BDW_GMCH_GMS_MASK;
+ 	return gmch_ctrl << 25; /* 32 MB units */
+ }
+ 
+ 
+ struct intel_stolen_funcs {
+ 	size_t (*size)(int num, int slot, int func);
+ 	u32 (*base)(int num, int slot, int func, size_t size);
+ };
+ 
+ static const struct intel_stolen_funcs gen3_stolen_funcs = {
+ 	.base = intel_stolen_base,
+ 	.size = gen3_stolen_size,
+ };
+ 
+ static const struct intel_stolen_funcs gen6_stolen_funcs = {
+ 	.base = intel_stolen_base,
+ 	.size = gen6_stolen_size,
+ };
+ 
+ static const struct intel_stolen_funcs gen8_stolen_funcs = {
+ 	.base = intel_stolen_base,
+ 	.size = gen8_stolen_size,
+ };
+ 
+ static struct pci_device_id intel_stolen_ids[] __initdata = {
+ 	INTEL_I915G_IDS(&gen3_stolen_funcs),
+ 	INTEL_I915GM_IDS(&gen3_stolen_funcs),
+ 	INTEL_I945G_IDS(&gen3_stolen_funcs),
+ 	INTEL_I945GM_IDS(&gen3_stolen_funcs),
+ 	INTEL_VLV_M_IDS(&gen6_stolen_funcs),
+ 	INTEL_VLV_D_IDS(&gen6_stolen_funcs),
+ 	INTEL_PINEVIEW_IDS(&gen3_stolen_funcs),
+ 	INTEL_I965G_IDS(&gen3_stolen_funcs),
+ 	INTEL_G33_IDS(&gen3_stolen_funcs),
+ 	INTEL_I965GM_IDS(&gen3_stolen_funcs),
+ 	INTEL_GM45_IDS(&gen3_stolen_funcs),
+ 	INTEL_G45_IDS(&gen3_stolen_funcs),
+ 	INTEL_IRONLAKE_D_IDS(&gen3_stolen_funcs),
+ 	INTEL_IRONLAKE_M_IDS(&gen3_stolen_funcs),
+ 	INTEL_SNB_D_IDS(&gen6_stolen_funcs),
+ 	INTEL_SNB_M_IDS(&gen6_stolen_funcs),
+ 	INTEL_IVB_M_IDS(&gen6_stolen_funcs),
+ 	INTEL_IVB_D_IDS(&gen6_stolen_funcs),
+ 	INTEL_HSW_D_IDS(&gen6_stolen_funcs),
+ 	INTEL_HSW_M_IDS(&gen6_stolen_funcs),
+ 	INTEL_BDW_M_IDS(&gen8_stolen_funcs),
+ 	INTEL_BDW_D_IDS(&gen8_stolen_funcs)
++>>>>>>> 52ca70454ea5 (x86/gpu: Add vfunc for Intel graphics stolen memory base address)
  };
  
  static void __init intel_graphics_stolen(int num, int slot, int func)
* Unmerged path arch/x86/kernel/early-quirks.c
