tools/perf/build: Clean up the mmap logic in config/Makefile

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-229.el7
Rebuild_CHGLOG: - [tools] perf/build: Clean up the mmap logic in config/Makefile (Jiri Olsa) [1131394]
Rebuild_FUZZ: 94.74%
commit-author Ingo Molnar <mingo@kernel.org>
commit fb3d333b3faa6bf975f00973c6a6271b2ab93c0c
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-229.el7/fb3d333b.failed

Nest the rules properly. No change in functionality.

	Cc: Arnaldo Carvalho de Melo <acme@redhat.com>
	Cc: Peter Zijlstra <a.p.zijlstra@chello.nl>
	Cc: Namhyung Kim <namhyung@kernel.org>
	Cc: David Ahern <dsahern@gmail.com>
	Cc: Jiri Olsa <jolsa@redhat.com>
Link: http://lkml.kernel.org/n/tip-wwktuHl4Ra5lyrrretkxmxqf@git.kernel.org
	Signed-off-by: Ingo Molnar <mingo@kernel.org>
(cherry picked from commit fb3d333b3faa6bf975f00973c6a6271b2ab93c0c)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	tools/perf/config/Makefile
diff --cc tools/perf/config/Makefile
index 9b9309dee255,8a27de27f7c2..000000000000
--- a/tools/perf/config/Makefile
+++ b/tools/perf/config/Makefile
@@@ -199,37 -199,38 +199,70 @@@ els
  endif # NO_LIBELF
  
  ifndef NO_LIBELF
++<<<<<<< HEAD
 +CFLAGS += -DLIBELF_SUPPORT
 +FLAGS_LIBELF=$(CFLAGS) $(LDFLAGS) $(EXTLIBS)
 +ifeq ($(call try-cc,$(SOURCE_ELF_MMAP),$(FLAGS_LIBELF),-DLIBELF_MMAP),y)
 +  CFLAGS += -DLIBELF_MMAP
 +endif
 +ifeq ($(call try-cc,$(SOURCE_ELF_GETPHDRNUM),$(FLAGS_LIBELF),-DHAVE_ELF_GETPHDRNUM),y)
 +  CFLAGS += -DHAVE_ELF_GETPHDRNUM
 +endif
++=======
+   CFLAGS += -DHAVE_LIBELF_SUPPORT
+   FLAGS_LIBELF=$(CFLAGS) $(LDFLAGS) $(EXTLIBS)
++>>>>>>> fb3d333b3faa (tools/perf/build: Clean up the mmap logic in config/Makefile)
  
- # include ARCH specific config
- -include $(src-perf)/arch/$(ARCH)/Makefile
+   ifeq ($(call try-cc,$(SOURCE_ELF_MMAP),$(FLAGS_LIBELF),-DHAVE_LIBELF_MMAP_SUPPORT),y)
+     CFLAGS += -DHAVE_LIBELF_MMAP_SUPPORT
+   endif
  
++<<<<<<< HEAD
 +ifndef NO_DWARF
 +ifeq ($(origin PERF_HAVE_DWARF_REGS), undefined)
 +  msg := $(warning DWARF register mappings have not been defined for architecture $(ARCH), DWARF support disabled);
 +  NO_DWARF := 1
 +else
 +  CFLAGS += -DDWARF_SUPPORT $(LIBDW_CFLAGS)
 +  LDFLAGS += $(LIBDW_LDFLAGS)
 +  EXTLIBS += -lelf -ldw
 +endif # PERF_HAVE_DWARF_REGS
 +endif # NO_DWARF
++=======
+   ifeq ($(call try-cc,$(SOURCE_ELF_GETPHDRNUM),$(FLAGS_LIBELF),-DHAVE_ELF_GETPHDRNUM_SUPPORT),y)
+     CFLAGS += -DHAVE_ELF_GETPHDRNUM_SUPPORT
+   endif
++>>>>>>> fb3d333b3faa (tools/perf/build: Clean up the mmap logic in config/Makefile)
  
+   # include ARCH specific config
+   -include $(src-perf)/arch/$(ARCH)/Makefile
+ 
+   ifndef NO_DWARF
+     ifeq ($(origin PERF_HAVE_DWARF_REGS), undefined)
+       msg := $(warning DWARF register mappings have not been defined for architecture $(ARCH), DWARF support disabled);
+       NO_DWARF := 1
+     else
+       CFLAGS += -DHAVE_DWARF_SUPPORT $(LIBDW_CFLAGS)
+       LDFLAGS += $(LIBDW_LDFLAGS)
+       EXTLIBS += -lelf -ldw
+     endif # PERF_HAVE_DWARF_REGS
+   endif # NO_DWARF
  endif # NO_LIBELF
  
  ifndef NO_LIBELF
++<<<<<<< HEAD
 +CFLAGS += -DLIBELF_SUPPORT
 +FLAGS_LIBELF=$(CFLAGS) $(LDFLAGS) $(EXTLIBS)
 +ifeq ($(call try-cc,$(SOURCE_ELF_MMAP),$(FLAGS_LIBELF),-DLIBELF_MMAP),y)
 +  CFLAGS += -DLIBELF_MMAP
 +endif # try-cc
++=======
+   CFLAGS += -DHAVE_LIBELF_SUPPORT
+   FLAGS_LIBELF=$(CFLAGS) $(LDFLAGS) $(EXTLIBS)
+   ifeq ($(call try-cc,$(SOURCE_ELF_MMAP),$(FLAGS_LIBELF),-DHAVE_LIBELF_MMAP_SUPPORT),y)
+     CFLAGS += -DHAVE_LIBELF_MMAP_SUPPORT
+   endif # try-cc
++>>>>>>> fb3d333b3faa (tools/perf/build: Clean up the mmap logic in config/Makefile)
  endif # NO_LIBELF
  
  # There's only x86 (both 32 and 64) support for CFI unwind so far
* Unmerged path tools/perf/config/Makefile
