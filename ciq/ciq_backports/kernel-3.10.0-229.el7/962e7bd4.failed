powerpc/pseries/cpuidle: Move processor_idle.c to drivers/cpuidle.

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-229.el7
Rebuild_CHGLOG: - [powerpc] pseries/cpuidle: Move processor_idle.c to drivers/cpuidle (Don Zickus) [1127366]
Rebuild_FUZZ: 92.68%
commit-author Deepthi Dharwar <deepthi@linux.vnet.ibm.com>
commit 962e7bd4976516c34fc9ef51d536aab801980767
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-229.el7/962e7bd4.failed

Move the file from arch specific pseries/processor_idle.c
to drivers/cpuidle/cpuidle-pseries.c
Make the relevant Makefile and Kconfig changes.
Also, introduce Kconfig.powerpc in drivers/cpuidle
for all powerpc cpuidle drivers.

	Signed-off-by: Deepthi Dharwar <deepthi@linux.vnet.ibm.com>
	Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
(cherry picked from commit 962e7bd4976516c34fc9ef51d536aab801980767)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/cpuidle/Kconfig
#	drivers/cpuidle/Makefile
diff --cc drivers/cpuidle/Kconfig
index 077b07066732,f04e25f6c98d..000000000000
--- a/drivers/cpuidle/Kconfig
+++ b/drivers/cpuidle/Kconfig
@@@ -29,11 -30,16 +29,24 @@@ config CPU_IDLE_GOV_MEN
  	bool "Menu governor (for tickless system)"
  	default y
  
++<<<<<<< HEAD
 +config CPU_IDLE_CALXEDA
 +	bool "CPU Idle Driver for Calxeda processors"
 +	depends on ARCH_HIGHBANK
 +	help
 +	  Select this to enable cpuidle on Calxeda processors.
++=======
+ menu "ARM CPU Idle Drivers"
+ depends on ARM
+ source "drivers/cpuidle/Kconfig.arm"
+ endmenu
+ 
+ menu "POWERPC CPU Idle Drivers"
+ depends on PPC
+ source "drivers/cpuidle/Kconfig.powerpc"
+ endmenu
+ 
++>>>>>>> 962e7bd49765 (powerpc/pseries/cpuidle: Move processor_idle.c to drivers/cpuidle.)
  endif
  
  config ARCH_NEEDS_CPU_IDLE_COUPLED
diff --cc drivers/cpuidle/Makefile
index 0d8bd55e776f,a6331ad32738..000000000000
--- a/drivers/cpuidle/Makefile
+++ b/drivers/cpuidle/Makefile
@@@ -5,5 -5,15 +5,20 @@@
  obj-y += cpuidle.o driver.o governor.o sysfs.o governors/
  obj-$(CONFIG_ARCH_NEEDS_CPU_IDLE_COUPLED) += coupled.o
  
++<<<<<<< HEAD
 +obj-$(CONFIG_CPU_IDLE_CALXEDA) += cpuidle-calxeda.o
 +obj-$(CONFIG_ARCH_KIRKWOOD) += cpuidle-kirkwood.o
++=======
+ ##################################################################################
+ # ARM SoC drivers
+ obj-$(CONFIG_ARM_BIG_LITTLE_CPUIDLE)	+= cpuidle-big_little.o
+ obj-$(CONFIG_ARM_HIGHBANK_CPUIDLE)	+= cpuidle-calxeda.o
+ obj-$(CONFIG_ARM_KIRKWOOD_CPUIDLE)	+= cpuidle-kirkwood.o
+ obj-$(CONFIG_ARM_ZYNQ_CPUIDLE)		+= cpuidle-zynq.o
+ obj-$(CONFIG_ARM_U8500_CPUIDLE)         += cpuidle-ux500.o
+ obj-$(CONFIG_ARM_AT91_CPUIDLE)          += cpuidle-at91.o
+ 
+ ###############################################################################
+ # POWERPC drivers
+ obj-$(CONFIG_PSERIES_CPUIDLE)		+= cpuidle-pseries.o
++>>>>>>> 962e7bd49765 (powerpc/pseries/cpuidle: Move processor_idle.c to drivers/cpuidle.)
diff --git a/arch/powerpc/include/asm/processor.h b/arch/powerpc/include/asm/processor.h
index d1c7667742b1..8fd8c0a01a04 100644
--- a/arch/powerpc/include/asm/processor.h
+++ b/arch/powerpc/include/asm/processor.h
@@ -444,7 +444,7 @@ enum idle_boot_override {IDLE_NO_OVERRIDE = 0, IDLE_POWERSAVE_OFF};
 extern int powersave_nap;	/* set if nap mode can be used in idle loop */
 extern void power7_nap(void);
 
-#ifdef CONFIG_PSERIES_IDLE
+#ifdef CONFIG_PSERIES_CPUIDLE
 extern void update_smt_snooze_delay(int cpu, int residency);
 #else
 static inline void update_smt_snooze_delay(int cpu, int residency) {}
diff --git a/arch/powerpc/platforms/pseries/Kconfig b/arch/powerpc/platforms/pseries/Kconfig
index b54e9331422a..b8eac45c3ff7 100644
--- a/arch/powerpc/platforms/pseries/Kconfig
+++ b/arch/powerpc/platforms/pseries/Kconfig
@@ -131,12 +131,3 @@ config DTL
 	  which are accessible through a debugfs file.
 
 	  Say N if you are unsure.
-
-config PSERIES_IDLE
-	bool "Cpuidle driver for pSeries platforms"
-	depends on CPU_IDLE
-	depends on PPC_PSERIES
-	default y
-	help
-	  Select this option to enable processor idle state management
-	  through cpuidle subsystem.
diff --git a/arch/powerpc/platforms/pseries/Makefile b/arch/powerpc/platforms/pseries/Makefile
index fbccac9cd2dc..03480796af9a 100644
--- a/arch/powerpc/platforms/pseries/Makefile
+++ b/arch/powerpc/platforms/pseries/Makefile
@@ -21,7 +21,6 @@ obj-$(CONFIG_HCALL_STATS)	+= hvCall_inst.o
 obj-$(CONFIG_CMM)		+= cmm.o
 obj-$(CONFIG_DTL)		+= dtl.o
 obj-$(CONFIG_IO_EVENT_IRQ)	+= io_event_irq.o
-obj-$(CONFIG_PSERIES_IDLE)	+= processor_idle.o
 obj-$(CONFIG_LPARCFG)		+= lparcfg.o
 
 ifeq ($(CONFIG_PPC_PSERIES),y)
* Unmerged path drivers/cpuidle/Kconfig
diff --git a/drivers/cpuidle/Kconfig.powerpc b/drivers/cpuidle/Kconfig.powerpc
new file mode 100644
index 000000000000..8147de522a96
--- /dev/null
+++ b/drivers/cpuidle/Kconfig.powerpc
@@ -0,0 +1,11 @@
+#
+# POWERPC CPU Idle Drivers
+#
+config PSERIES_CPUIDLE
+	bool "Cpuidle driver for pSeries platforms"
+	depends on CPU_IDLE
+	depends on PPC_PSERIES
+	default y
+	help
+	  Select this option to enable processor idle state management
+	  through cpuidle subsystem.
* Unmerged path drivers/cpuidle/Makefile
diff --git a/arch/powerpc/platforms/pseries/processor_idle.c b/drivers/cpuidle/cpuidle-pseries.c
similarity index 99%
rename from arch/powerpc/platforms/pseries/processor_idle.c
rename to drivers/cpuidle/cpuidle-pseries.c
index a166e38bd683..16dd4c061715 100644
--- a/arch/powerpc/platforms/pseries/processor_idle.c
+++ b/drivers/cpuidle/cpuidle-pseries.c
@@ -1,5 +1,5 @@
 /*
- *  processor_idle - idle state cpuidle driver.
+ *  cpuidle-pseries - idle state cpuidle driver.
  *  Adapted from drivers/idle/intel_idle.c and
  *  drivers/acpi/processor_idle.c
  *
