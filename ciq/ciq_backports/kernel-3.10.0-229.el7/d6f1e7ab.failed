powerpc/pseries: Make CPU hotplug path endian safe

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-229.el7
Rebuild_CHGLOG: - [powerpc] pseries: Make CPU hotplug path endian safe (Steve Best) [1159579]
Rebuild_FUZZ: 91.30%
commit-author Bharata B Rao <bharata@linux.vnet.ibm.com>
commit d6f1e7abdb95a7ea031e7604829e4b5514d7e2c1
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-229.el7/d6f1e7ab.failed

- ibm,rtas-configure-connector should treat the RTAS data as big endian.
- Treat ibm,ppc-interrupt-server#s as big-endian when setting
  smp_processor_id during hotplug.

	Signed-off-by: Bharata B Rao <bharata@linux.vnet.ibm.com>
	Signed-off-by: Thomas Falcon <tlfalcon@linux.vnet.ibm.com>
	Acked-by: Nathan Fontenot <nfont@linux.vnet.ibm.com>
	Signed-off-by: Michael Ellerman <mpe@ellerman.id.au>
(cherry picked from commit d6f1e7abdb95a7ea031e7604829e4b5514d7e2c1)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/powerpc/platforms/pseries/dlpar.c
diff --cc arch/powerpc/platforms/pseries/dlpar.c
index 0d050ce52c91,6ad83bd11fe2..000000000000
--- a/arch/powerpc/platforms/pseries/dlpar.c
+++ b/arch/powerpc/platforms/pseries/dlpar.c
@@@ -402,27 -403,20 +402,33 @@@ out
  static ssize_t dlpar_cpu_probe(const char *buf, size_t count)
  {
  	struct device_node *dn, *parent;
 -	u32 drc_index;
 +	unsigned long drc_index;
  	int rc;
  
 -	rc = kstrtou32(buf, 0, &drc_index);
 -	if (rc)
 -		return -EINVAL;
 +	cpu_hotplug_driver_lock();
 +	rc = strict_strtoul(buf, 0, &drc_index);
 +	if (rc) {
 +		rc = -EINVAL;
 +		goto out;
 +	}
  
  	parent = of_find_node_by_path("/cpus");
 -	if (!parent)
 -		return -ENODEV;
 +	if (!parent) {
 +		rc = -ENODEV;
 +		goto out;
 +	}
  
++<<<<<<< HEAD
 +	dn = dlpar_configure_connector(drc_index, parent);
 +	if (!dn) {
 +		rc = -EINVAL;
 +		goto out;
 +	}
++=======
+ 	dn = dlpar_configure_connector(cpu_to_be32(drc_index), parent);
+ 	if (!dn)
+ 		return -EINVAL;
++>>>>>>> d6f1e7abdb95 (powerpc/pseries: Make CPU hotplug path endian safe)
  
  	of_node_put(parent);
  
* Unmerged path arch/powerpc/platforms/pseries/dlpar.c
diff --git a/arch/powerpc/platforms/pseries/hotplug-cpu.c b/arch/powerpc/platforms/pseries/hotplug-cpu.c
index 9b8e05078a63..a92a9cb41b17 100644
--- a/arch/powerpc/platforms/pseries/hotplug-cpu.c
+++ b/arch/powerpc/platforms/pseries/hotplug-cpu.c
@@ -246,7 +246,7 @@ static int pseries_add_processor(struct device_node *np)
 	unsigned int cpu;
 	cpumask_var_t candidate_mask, tmp;
 	int err = -ENOSPC, len, nthreads, i;
-	const u32 *intserv;
+	const __be32 *intserv;
 
 	intserv = of_get_property(np, "ibm,ppc-interrupt-server#s", &len);
 	if (!intserv)
@@ -292,7 +292,7 @@ static int pseries_add_processor(struct device_node *np)
 	for_each_cpu(cpu, tmp) {
 		BUG_ON(cpu_present(cpu));
 		set_cpu_present(cpu, true);
-		set_hard_smp_processor_id(cpu, *intserv++);
+		set_hard_smp_processor_id(cpu, be32_to_cpu(*intserv++));
 	}
 	err = 0;
 out_unlock:
diff --git a/arch/powerpc/platforms/pseries/pseries.h b/arch/powerpc/platforms/pseries/pseries.h
index 361add62abf1..1796c5438cc6 100644
--- a/arch/powerpc/platforms/pseries/pseries.h
+++ b/arch/powerpc/platforms/pseries/pseries.h
@@ -56,7 +56,8 @@ extern void hvc_vio_init_early(void);
 /* Dynamic logical Partitioning/Mobility */
 extern void dlpar_free_cc_nodes(struct device_node *);
 extern void dlpar_free_cc_property(struct property *);
-extern struct device_node *dlpar_configure_connector(u32, struct device_node *);
+extern struct device_node *dlpar_configure_connector(__be32,
+						struct device_node *);
 extern int dlpar_attach_node(struct device_node *);
 extern int dlpar_detach_node(struct device_node *);
 
