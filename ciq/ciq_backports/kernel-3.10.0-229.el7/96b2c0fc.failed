drivers/base: Use attribute groups to create sysfs memory files

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-229.el7
Rebuild_CHGLOG: - [base] Use attribute groups to create sysfs memory files (Myron Stowe) [1114228]
Rebuild_FUZZ: 87.50%
commit-author Nathan Fontenot <nfont@linux.vnet.ibm.com>
commit 96b2c0fc8e74a615888e2bedfe55b439aa4695e1
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-229.el7/96b2c0fc.failed

Update the sysfs memory code to create/delete files at the time of device
and subsystem registration.

The current code creates files in the root memory directory explicitly through
the use of init_* routines. The files for each memory block are created and
deleted explicitly using the mem_[create|delete]_simple_file macros.

This patch creates attribute groups for the memory root files and files in
each memory block directory so that they are created and deleted implicitly
at subsys and device register and unregister time.

This did necessitate moving the register_memory() updating it to set the
dev.groups field.

	Signed-off-by: Nathan Fontenot <nfont@linux.vnet.ibm.com>
	Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
(cherry picked from commit 96b2c0fc8e74a615888e2bedfe55b439aa4695e1)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/base/memory.c
diff --cc drivers/base/memory.c
index 9fca083e2270,e315051cfeeb..000000000000
--- a/drivers/base/memory.c
+++ b/drivers/base/memory.c
@@@ -82,23 -77,6 +82,26 @@@ static void memory_block_release(struc
  	kfree(mem);
  }
  
++<<<<<<< HEAD
 +/*
 + * register_memory - Setup a sysfs device for a memory block
 + */
 +static
 +int register_memory(struct memory_block *memory)
 +{
 +	int error;
 +
 +	memory->dev.bus = &memory_subsys;
 +	memory->dev.id = memory->start_section_nr / sections_per_block;
 +	memory->dev.release = memory_block_release;
 +	memory->dev.offline = memory->state == MEM_OFFLINE;
 +
 +	error = device_register(&memory->dev);
 +	return error;
 +}
 +
++=======
++>>>>>>> 96b2c0fc8e74 (drivers/base: Use attribute groups to create sysfs memory files)
  unsigned long __weak memory_block_size_bytes(void)
  {
  	return MIN_MEMORY_BLOCK_SIZE;
* Unmerged path drivers/base/memory.c
