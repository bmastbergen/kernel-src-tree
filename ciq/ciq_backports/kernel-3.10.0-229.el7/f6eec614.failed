openvswitch: Enable tunnel GSO for OVS bridge.

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-229.el7
Rebuild_CHGLOG: - [net] openvswitch: Enable tunnel GSO for OVS bridge (Jiri Benc) [1110384]
Rebuild_FUZZ: 98.90%
commit-author Pravin B Shelar <pshelar@nicira.com>
commit f6eec614d2252a99b861e288b6301599d2d58da4
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-229.el7/f6eec614.failed

Following patch enables all available tunnel GSO features for OVS
bridge device so that ovs can use hardware offloads available to
underling device.

	Signed-off-by: Pravin B Shelar <pshelar@nicira.com>
	Acked-by: Andy Zhou <azhou@nicira.com>
(cherry picked from commit f6eec614d2252a99b861e288b6301599d2d58da4)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	include/linux/netdev_features.h
diff --cc include/linux/netdev_features.h
index df4b6812aa29,dcfdecbfa0b7..000000000000
--- a/include/linux/netdev_features.h
+++ b/include/linux/netdev_features.h
@@@ -165,4 -169,19 +165,22 @@@ enum 
  /* changeable features with no special hardware requirements */
  #define NETIF_F_SOFT_FEATURES	(NETIF_F_GSO | NETIF_F_GRO)
  
++<<<<<<< HEAD
++=======
+ #define NETIF_F_VLAN_FEATURES	(NETIF_F_HW_VLAN_CTAG_FILTER | \
+ 				 NETIF_F_HW_VLAN_CTAG_RX | \
+ 				 NETIF_F_HW_VLAN_CTAG_TX | \
+ 				 NETIF_F_HW_VLAN_STAG_FILTER | \
+ 				 NETIF_F_HW_VLAN_STAG_RX | \
+ 				 NETIF_F_HW_VLAN_STAG_TX)
+ 
+ #define NETIF_F_GSO_ENCAP_ALL	(NETIF_F_GSO_GRE |			\
+ 				 NETIF_F_GSO_GRE_CSUM |			\
+ 				 NETIF_F_GSO_IPIP |			\
+ 				 NETIF_F_GSO_SIT |			\
+ 				 NETIF_F_GSO_UDP_TUNNEL |		\
+ 				 NETIF_F_GSO_UDP_TUNNEL_CSUM |		\
+ 				 NETIF_F_GSO_MPLS)
+ 
++>>>>>>> f6eec614d225 (openvswitch: Enable tunnel GSO for OVS bridge.)
  #endif	/* _LINUX_NETDEV_FEATURES_H */
* Unmerged path include/linux/netdev_features.h
diff --git a/net/openvswitch/vport-internal_dev.c b/net/openvswitch/vport-internal_dev.c
index 729c68763fe7..c472c5c7864d 100644
--- a/net/openvswitch/vport-internal_dev.c
+++ b/net/openvswitch/vport-internal_dev.c
@@ -134,11 +134,14 @@ static void do_setup(struct net_device *netdev)
 	netdev->tx_queue_len = 0;
 
 	netdev->features = NETIF_F_LLTX | NETIF_F_SG | NETIF_F_FRAGLIST |
-			   NETIF_F_HIGHDMA | NETIF_F_HW_CSUM | NETIF_F_GSO_SOFTWARE;
+			   NETIF_F_HIGHDMA | NETIF_F_HW_CSUM |
+			   NETIF_F_GSO_SOFTWARE | NETIF_F_GSO_ENCAP_ALL;
 
 	netdev->vlan_features = netdev->features;
+	netdev->hw_enc_features = netdev->features;
 	netdev->features |= NETIF_F_HW_VLAN_CTAG_TX;
 	netdev->hw_features = netdev->features & ~NETIF_F_LLTX;
+
 	eth_hw_addr_random(netdev);
 }
 
