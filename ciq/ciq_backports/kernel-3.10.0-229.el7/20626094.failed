KVM: mmu: remove uninteresting MMU "free" callbacks

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-229.el7
Rebuild_CHGLOG: - [virt] kvm/mmu: remove uninteresting MMU "free" callbacks (Paolo Bonzini) [1116936]
Rebuild_FUZZ: 97.03%
commit-author Paolo Bonzini <pbonzini@redhat.com>
commit 206260941fd4b6f25f28ecf4e267b2f9a0ba72d7
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-229.el7/20626094.failed

The free MMU callback has been a wrapper for mmu_free_roots since mmu_free_roots
itself was introduced (commit 17ac10a, [PATCH] KVM: MU: Special treatment
for shadow pae root pages, 2007-01-05), and has always been the same for all
MMU cases.  Remove the indirection as it is useless.

	Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>
	Signed-off-by: Gleb Natapov <gleb@redhat.com>
(cherry picked from commit 206260941fd4b6f25f28ecf4e267b2f9a0ba72d7)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/x86/kvm/mmu.c
diff --cc arch/x86/kvm/mmu.c
index 94dde056e31c,1c4d580ba347..000000000000
--- a/arch/x86/kvm/mmu.c
+++ b/arch/x86/kvm/mmu.c
@@@ -3767,6 -3783,32 +3753,35 @@@ int kvm_init_shadow_mmu(struct kvm_vcp
  }
  EXPORT_SYMBOL_GPL(kvm_init_shadow_mmu);
  
++<<<<<<< HEAD
++=======
+ int kvm_init_shadow_ept_mmu(struct kvm_vcpu *vcpu, struct kvm_mmu *context,
+ 		bool execonly)
+ {
+ 	ASSERT(vcpu);
+ 	ASSERT(!VALID_PAGE(vcpu->arch.mmu.root_hpa));
+ 
+ 	context->shadow_root_level = kvm_x86_ops->get_tdp_level();
+ 
+ 	context->nx = true;
+ 	context->new_cr3 = paging_new_cr3;
+ 	context->page_fault = ept_page_fault;
+ 	context->gva_to_gpa = ept_gva_to_gpa;
+ 	context->sync_page = ept_sync_page;
+ 	context->invlpg = ept_invlpg;
+ 	context->update_pte = ept_update_pte;
+ 	context->root_level = context->shadow_root_level;
+ 	context->root_hpa = INVALID_PAGE;
+ 	context->direct_map = false;
+ 
+ 	update_permission_bitmask(vcpu, context, true);
+ 	reset_rsvds_bits_mask_ept(vcpu, context, execonly);
+ 
+ 	return 0;
+ }
+ EXPORT_SYMBOL_GPL(kvm_init_shadow_ept_mmu);
+ 
++>>>>>>> 206260941fd4 (KVM: mmu: remove uninteresting MMU "free" callbacks)
  static int init_kvm_softmmu(struct kvm_vcpu *vcpu)
  {
  	int r = kvm_init_shadow_mmu(vcpu, vcpu->arch.walk_mmu);
diff --git a/arch/x86/include/asm/kvm_host.h b/arch/x86/include/asm/kvm_host.h
index e785612376c0..cb998d546fab 100644
--- a/arch/x86/include/asm/kvm_host.h
+++ b/arch/x86/include/asm/kvm_host.h
@@ -261,7 +261,6 @@ struct kvm_mmu {
 			  bool prefault);
 	void (*inject_page_fault)(struct kvm_vcpu *vcpu,
 				  struct x86_exception *fault);
-	void (*free)(struct kvm_vcpu *vcpu);
 	gpa_t (*gva_to_gpa)(struct kvm_vcpu *vcpu, gva_t gva, u32 access,
 			    struct x86_exception *exception);
 	gpa_t (*translate_gpa)(struct kvm_vcpu *vcpu, gpa_t gpa, u32 access);
* Unmerged path arch/x86/kvm/mmu.c
