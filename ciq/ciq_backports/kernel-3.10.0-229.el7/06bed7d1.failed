LOCKD: Fix a race when initialising nlmsvc_timeout

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-229.el7
commit-author Trond Myklebust <trond.myklebust@primarydata.com>
commit 06bed7d18c2c07b3e3eeadf4bd357f6e806618cc
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-229.el7/06bed7d1.failed

This commit fixes a race whereby nlmclnt_init() first starts the lockd
daemon, and then calls nlm_bind_host() with the expectation that
nlmsvc_timeout has already been initialised. Unfortunately, there is no
no synchronisation between lockd() and lockd_up() to guarantee that this
is the case.

Fix is to move the initialisation of nlmsvc_timeout into lockd_create_svc

Fixes: 9a1b6bf818e74 ("LOCKD: Don't call utsname()->nodename...")
	Cc: Bruce Fields <bfields@fieldses.org>
	Cc: stable@vger.kernel.org # 3.10.x
	Signed-off-by: Trond Myklebust <trond.myklebust@primarydata.com>
(cherry picked from commit 06bed7d18c2c07b3e3eeadf4bd357f6e806618cc)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	fs/lockd/svc.c
diff --cc fs/lockd/svc.c
index d56a9904e52a,55505cbe11af..000000000000
--- a/fs/lockd/svc.c
+++ b/fs/lockd/svc.c
@@@ -348,7 -346,11 +344,15 @@@ static struct svc_serv *lockd_create_sv
  		printk(KERN_WARNING
  			"lockd_up: no pid, %d users??\n", nlmsvc_users);
  
++<<<<<<< HEAD
 +	serv = svc_create(&nlmsvc_program, LOCKD_BUFSIZE, NULL);
++=======
+ 	if (!nlm_timeout)
+ 		nlm_timeout = LOCKD_DFLT_TIMEO;
+ 	nlmsvc_timeout = nlm_timeout * HZ;
+ 
+ 	serv = svc_create(&nlmsvc_program, LOCKD_BUFSIZE, svc_rpcb_cleanup);
++>>>>>>> 06bed7d18c2c (LOCKD: Fix a race when initialising nlmsvc_timeout)
  	if (!serv) {
  		printk(KERN_WARNING "lockd_up: create service failed\n");
  		return ERR_PTR(-ENOMEM);
* Unmerged path fs/lockd/svc.c
