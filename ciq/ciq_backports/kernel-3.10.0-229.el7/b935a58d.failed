perf tools: Fix traceevent plugin path definitions

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-229.el7
Rebuild_CHGLOG: - [tools] perf: Fix traceevent plugin path definitions (Jiri Olsa) [1133083]
Rebuild_FUZZ: 93.62%
commit-author Josh Boyer <jwboyer@fedoraproject.org>
commit b935a58dbff457c27fd63e1e1bb29db20b2ee6a8
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-229.el7/b935a58d.failed

The plugindir_SQ definition contains $(prefix) which is not needed as
the $(libdir) definition already contains prefix in it.  This leads to
the path including an extra prefix in it, e.g. /usr/usr/lib64.

The -DPLUGIN_DIR defintion includes DESTDIR.  This is incorrect, as it
sets the plugin search path to include the value of DESTDIR.  DESTDIR is
a mechanism to install in a non-standard location such as a chroot or an
RPM build root.  In the RPM case, this leads to the search path being
incorrect after the resulting RPM is installed (or in some cases an RPM
build failure).

Remove both of these unnecessary inclusions.

	Signed-off-by: Josh Boyer <jwboyer@fedoraproject.org>
	Acked-by: Jiri Olsa <jolsa@redhat.com>
	Cc: Ingo Molnar <mingo@elte.hu>
	Cc: Jiri Olsa <jolsa@redhat.com>
	Cc: Steven Rostedt <rostedt@goodmis.org>
Link: http://lkml.kernel.org/r/20140122150147.GK16455@hansolo.jdub.homelinux.org
	Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>
(cherry picked from commit b935a58dbff457c27fd63e1e1bb29db20b2ee6a8)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	tools/lib/traceevent/Makefile
#	tools/perf/config/Makefile
diff --cc tools/lib/traceevent/Makefile
index 60ab4a6089ac,005c9cc06935..000000000000
--- a/tools/lib/traceevent/Makefile
+++ b/tools/lib/traceevent/Makefile
@@@ -43,6 -43,32 +43,35 @@@ man_dir_SQ = '$(subst ','\'',$(man_dir)
  export man_dir man_dir_SQ INSTALL
  export DESTDIR DESTDIR_SQ
  
++<<<<<<< HEAD
++=======
+ set_plugin_dir := 1
+ 
+ # Set plugin_dir to preffered global plugin location
+ # If we install under $HOME directory we go under
+ # $(HOME)/.traceevent/plugins
+ #
+ # We dont set PLUGIN_DIR in case we install under $HOME
+ # directory, because by default the code looks under:
+ # $(HOME)/.traceevent/plugins by default.
+ #
+ ifeq ($(plugin_dir),)
+ ifeq ($(prefix),$(HOME))
+ override plugin_dir = $(HOME)/.traceevent/plugins
+ set_plugin_dir := 0
+ else
+ override plugin_dir = $(prefix)/lib/traceevent/plugins
+ endif
+ endif
+ 
+ ifeq ($(set_plugin_dir),1)
+ PLUGIN_DIR = -DPLUGIN_DIR="$(plugin_dir)"
+ PLUGIN_DIR_SQ = '$(subst ','\'',$(PLUGIN_DIR))'
+ endif
+ 
+ include $(if $(BUILD_SRC),$(BUILD_SRC)/)../../scripts/Makefile.include
+ 
++>>>>>>> b935a58dbff4 (perf tools: Fix traceevent plugin path definitions)
  # copy a bit from Linux kbuild
  
  ifeq ("$(origin V)", "command line")
diff --cc tools/perf/config/Makefile
index 374f88fe17c5,c48d44958172..000000000000
--- a/tools/perf/config/Makefile
+++ b/tools/perf/config/Makefile
@@@ -539,3 -594,11 +539,14 @@@ els
  perfexec_instdir = $(prefix)/$(perfexecdir)
  endif
  perfexec_instdir_SQ = $(subst ','\'',$(perfexec_instdir))
++<<<<<<< HEAD
++=======
+ 
+ # If we install to $(HOME) we keep the traceevent default:
+ # $(HOME)/.traceevent/plugins
+ # Otherwise we install plugins into the global $(libdir).
+ ifdef DESTDIR
+ plugindir=$(libdir)/traceevent/plugins
+ plugindir_SQ= $(subst ','\'',$(plugindir))
+ endif
++>>>>>>> b935a58dbff4 (perf tools: Fix traceevent plugin path definitions)
* Unmerged path tools/lib/traceevent/Makefile
* Unmerged path tools/perf/config/Makefile
