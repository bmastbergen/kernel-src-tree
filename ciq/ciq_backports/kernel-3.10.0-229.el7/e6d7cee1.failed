perf tools: Remove stackprotector feature check

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-229.el7
Rebuild_CHGLOG: - [tools] perf: Remove stackprotector feature check (Jiri Olsa) [1133083]
Rebuild_FUZZ: 93.18%
commit-author Jiri Olsa <jolsa@redhat.com>
commit e6d7cee1ecac099786d3ba7a71b1e69cf0ae9a7b
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-229.el7/e6d7cee1.failed

We use -fstack-protector-all option to enable stack protecting for all
available functions. There's no reason for enabling -Wstack-protector to
get warning for unprotected functions.

Removing stackprotector feature check which was used to enable the
-Wstack-protector option.

	Signed-off-by: Jiri Olsa <jolsa@redhat.com>
	Cc: Corey Ashford <cjashfor@linux.vnet.ibm.com>
	Cc: David Ahern <dsahern@gmail.com>
	Cc: Frederic Weisbecker <fweisbec@gmail.com>
	Cc: Ingo Molnar <mingo@elte.hu>
	Cc: Namhyung Kim <namhyung@kernel.org>
	Cc: Paul Mackerras <paulus@samba.org>
	Cc: Peter Zijlstra <a.p.zijlstra@chello.nl>
	Cc: Steven Rostedt <rostedt@goodmis.org>
Link: http://lkml.kernel.org/r/1386076182-14484-2-git-send-email-jolsa@redhat.com
	Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>
(cherry picked from commit e6d7cee1ecac099786d3ba7a71b1e69cf0ae9a7b)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	tools/perf/config/Makefile
#	tools/perf/config/feature-checks/Makefile
diff --cc tools/perf/config/Makefile
index 374f88fe17c5,0761d57e5fb6..000000000000
--- a/tools/perf/config/Makefile
+++ b/tools/perf/config/Makefile
@@@ -102,20 -113,47 +102,50 @@@ ende
  #
  # Build the feature check binaries in parallel, ignore errors, ignore return value and suppress output:
  #
 +$(info )
 +$(info Auto-detecting system features:)
  
++<<<<<<< HEAD
 +FEATURE_TESTS =				\
 +	hello				\
++=======
+ #
+ # Note that this is not a complete list of all feature tests, just
+ # those that are typically built on a fully configured system.
+ #
+ # [ Feature tests not mentioned here have to be built explicitly in
+ #   the rule that uses them - an example for that is the 'bionic'
+ #   feature check. ]
+ #
+ CORE_FEATURE_TESTS =			\
+ 	backtrace			\
+ 	dwarf				\
+ 	fortify-source			\
+ 	glibc				\
+ 	gtk2				\
+ 	gtk2-infobar			\
+ 	libaudit			\
+ 	libbfd				\
+ 	libelf				\
+ 	libelf-getphdrnum		\
+ 	libelf-mmap			\
+ 	libnuma				\
+ 	libperl				\
+ 	libpython			\
+ 	libpython-version		\
+ 	libslang			\
+ 	libunwind			\
+ 	on-exit				\
++>>>>>>> e6d7cee1ecac (perf tools: Remove stackprotector feature check)
  	stackprotector-all		\
 -	timerfd
 -
 -#
 -# So here we detect whether test-all was rebuilt, to be able
 -# to skip the print-out of the long features list if the file
 -# existed before and after it was built:
 -#
 -ifeq ($(wildcard $(OUTPUT)config/feature-checks/test-all),)
 -  test-all-failed := 1
 -else
 -  test-all-failed := 0
 -endif
 +	stackprotector			\
 +	volatile-register-var		\
 +	fortify-source			\
 +	bionic				\
 +	libelf				\
 +	glibc				\
 +	dwarf				\
 +	libnuma
  
  #
  # Special fast-path for the 'all features are available' case:
@@@ -152,14 -208,6 +182,17 @@@ ifeq ($(feature-stackprotector-all), 1
    CFLAGS += -fstack-protector-all
  endif
  
++<<<<<<< HEAD
 +ifeq ($(feature-stackprotector), 1)
 +  CFLAGS += -Wstack-protector
 +endif
 +
 +ifeq ($(feature-volatile-register-var), 1)
 +  CFLAGS += -Wvolatile-register-var
 +endif
 +
++=======
++>>>>>>> e6d7cee1ecac (perf tools: Remove stackprotector feature check)
  ifeq ($(DEBUG),0)
    ifeq ($(feature-fortify-source), 1)
      CFLAGS += -D_FORTIFY_SOURCE=2
diff --cc tools/perf/config/feature-checks/Makefile
index 5910d275aba0,b8bb749c3392..000000000000
--- a/tools/perf/config/feature-checks/Makefile
+++ b/tools/perf/config/feature-checks/Makefile
@@@ -1,15 -1,32 +1,19 @@@
  
  FILES=					\
 -	test-all			\
 -	test-backtrace			\
 -	test-bionic			\
 -	test-dwarf			\
 -	test-fortify-source		\
 -	test-glibc			\
 -	test-gtk2			\
 -	test-gtk2-infobar		\
  	test-hello			\
 -	test-libaudit			\
 -	test-libbfd			\
 -	test-liberty			\
 -	test-liberty-z			\
 -	test-cplus-demangle		\
 -	test-libelf			\
 -	test-libelf-getphdrnum		\
 -	test-libelf-mmap		\
 -	test-libnuma			\
 -	test-libperl			\
 -	test-libpython			\
 -	test-libpython-version		\
 -	test-libslang			\
 -	test-libunwind			\
 -	test-libunwind-debug-frame	\
 -	test-on-exit			\
  	test-stackprotector-all		\
++<<<<<<< HEAD
 +	test-stackprotector		\
 +	test-volatile-register-var	\
 +	test-fortify-source		\
 +	test-bionic			\
 +	test-libelf			\
 +	test-glibc			\
 +	test-dwarf			\
 +	test-libnuma
++=======
+ 	test-timerfd
++>>>>>>> e6d7cee1ecac (perf tools: Remove stackprotector feature check)
  
  CC := $(CC) -MD
  
@@@ -20,7 -37,7 +24,11 @@@ BUILD = $(CC) -o $(OUTPUT)$@ $@.
  ###############################
  
  test-all:
++<<<<<<< HEAD
 +	$(BUILD) -Werror -fstack-protector -fstack-protector-all -Wvolatile-register-var -O2 -Werror -D_FORTIFY_SOURCE=2 -ldw -lelf -lnuma -lunwind -lunwind-x86_64 -lelf -laudit -I/usr/include/slang -lslang $(shell pkg-config --libs --cflags gtk+-2.0 2>/dev/null) $(FLAGS_PERL_EMBED) $(FLAGS_PYTHON_EMBED) -DPACKAGE='perf' -DPACKAGE=perf -lbfd -ldl
++=======
+ 	$(BUILD) -Werror -fstack-protector-all -O2 -Werror -D_FORTIFY_SOURCE=2 -ldw -lelf -lnuma $(LIBUNWIND_LIBS) -lelf -laudit -I/usr/include/slang -lslang $(shell pkg-config --libs --cflags gtk+-2.0 2>/dev/null) $(FLAGS_PERL_EMBED) $(FLAGS_PYTHON_EMBED) -DPACKAGE='"perf"' -lbfd -ldl
++>>>>>>> e6d7cee1ecac (perf tools: Remove stackprotector feature check)
  
  test-hello:
  	$(BUILD)
@@@ -28,12 -45,6 +36,15 @@@
  test-stackprotector-all:
  	$(BUILD) -Werror -fstack-protector-all
  
++<<<<<<< HEAD
 +test-stackprotector:
 +	$(BUILD) -Werror -fstack-protector -Wstack-protector
 +
 +test-volatile-register-var:
 +	$(BUILD) -Werror -Wvolatile-register-var
 +
++=======
++>>>>>>> e6d7cee1ecac (perf tools: Remove stackprotector feature check)
  test-fortify-source:
  	$(BUILD) -O2 -Werror -D_FORTIFY_SOURCE=2
  
* Unmerged path tools/perf/config/Makefile
* Unmerged path tools/perf/config/feature-checks/Makefile
diff --git a/tools/perf/config/feature-checks/test-stackprotector.c b/tools/perf/config/feature-checks/test-stackprotector.c
deleted file mode 100644
index c9f398d87868..000000000000
--- a/tools/perf/config/feature-checks/test-stackprotector.c
+++ /dev/null
@@ -1,6 +0,0 @@
-#include <stdio.h>
-
-int main(void)
-{
-	return puts("hi");
-}
