tools/perf/build: Split out feature check: 'libaudit'

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-229.el7
Rebuild_CHGLOG: - [tools] perf/build: split out feature check 'libaudit' (Jiri Olsa) [1131394]
Rebuild_FUZZ: 92.93%
commit-author Ingo Molnar <mingo@kernel.org>
commit d795a658eb0ab5ab0b86cda5abe28954b0a08471
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-229.el7/d795a658.failed

	Cc: Arnaldo Carvalho de Melo <acme@redhat.com>
	Cc: Peter Zijlstra <a.p.zijlstra@chello.nl>
	Cc: Namhyung Kim <namhyung@kernel.org>
	Cc: David Ahern <dsahern@gmail.com>
	Cc: Jiri Olsa <jolsa@redhat.com>
Link: http://lkml.kernel.org/n/tip-orhejqtjao3vf4wxwBUdzhaz@git.kernel.org
	Signed-off-by: Ingo Molnar <mingo@kernel.org>
(cherry picked from commit d795a658eb0ab5ab0b86cda5abe28954b0a08471)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	tools/perf/config/Makefile
#	tools/perf/config/feature-checks/Makefile
diff --cc tools/perf/config/Makefile
index 3d5ba297ad91,d4f18f4c8d51..000000000000
--- a/tools/perf/config/Makefile
+++ b/tools/perf/config/Makefile
@@@ -111,6 -111,10 +111,13 @@@ FEATURE_TESTS =				
  	libelf				\
  	glibc				\
  	dwarf				\
++<<<<<<< HEAD
++=======
+ 	libelf-mmap			\
+ 	libelf-getphdrnum		\
+ 	libunwind			\
+ 	libaudit			\
++>>>>>>> d795a658eb0a (tools/perf/build: Split out feature check: 'libaudit')
  	libnuma
  
  $(foreach test,$(FEATURE_TESTS),$(call feature_check,$(test),$(test)))
@@@ -257,11 -263,10 +264,10 @@@ ifndef NO_LIBUNWIN
    EXTLIBS += $(LIBUNWIND_LIBS)
    CFLAGS += $(LIBUNWIND_CFLAGS)
    LDFLAGS += $(LIBUNWIND_LDFLAGS)
 -endif
 +endif # NO_LIBUNWIND
  
  ifndef NO_LIBAUDIT
-   FLAGS_LIBAUDIT = $(CFLAGS) $(LDFLAGS) -laudit
-   ifneq ($(call try-cc,$(SOURCE_LIBAUDIT),$(FLAGS_LIBAUDIT),libaudit),y)
+   ifneq ($(feature-libaudit), 1)
      msg := $(warning No libaudit.h found, disables 'trace' tool, please install audit-libs-devel or libaudit-dev);
      NO_LIBAUDIT := 1
    else
diff --cc tools/perf/config/feature-checks/Makefile
index 566a71dd6168,8e49fa0c922b..000000000000
--- a/tools/perf/config/feature-checks/Makefile
+++ b/tools/perf/config/feature-checks/Makefile
@@@ -9,6 -9,10 +9,13 @@@ FILES=					
  	test-libelf			\
  	test-glibc			\
  	test-dwarf			\
++<<<<<<< HEAD
++=======
+ 	test-libelf-mmap		\
+ 	test-libelf-getphdrnum		\
+ 	test-libunwind			\
+ 	test-libaudit			\
++>>>>>>> d795a658eb0a (tools/perf/build: Split out feature check: 'libaudit')
  	test-libnuma
  
  CC := $(CC) -MD
@@@ -49,6 -53,18 +56,15 @@@ test-dwarf
  test-libnuma:
  	$(BUILD) -lnuma
  
++<<<<<<< HEAD
++=======
+ test-libunwind:
+ 	$(BUILD) -lunwind -lunwind-x86_64 -lelf
+ 
+ test-libaudit:
+ 	$(BUILD) -laudit
+ 
++>>>>>>> d795a658eb0a (tools/perf/build: Split out feature check: 'libaudit')
  -include *.d */*.d
  
  ###############################
* Unmerged path tools/perf/config/Makefile
* Unmerged path tools/perf/config/feature-checks/Makefile
diff --git a/tools/perf/config/feature-checks/test-libaudit.c b/tools/perf/config/feature-checks/test-libaudit.c
new file mode 100644
index 000000000000..854a65d3cc78
--- /dev/null
+++ b/tools/perf/config/feature-checks/test-libaudit.c
@@ -0,0 +1,7 @@
+#include <libaudit.h>
+
+int main(void)
+{
+	printf("error message: %s\n", audit_errno_to_name(0));
+	return audit_open();
+}
