i40e: limit GLLAN_TXPRE_QDIS to QINDX 0-127

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-229.el7
commit-author Christopher Pau <christopher.pau@intel.com>
commit 24a768cfc4f8cbbb3eaf56284610e652ef05fc5b
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-229.el7/24a768cf.failed

Prevent writing to reserved bits, queue index is 0-127

Change-ID: Ic923e1c92012a265983414acd8f547c4bdac2e34
	Signed-off-by: Christopher Pau <christopher.pau@intel.com>
	Signed-off-by: Jeff Kirsher <jeffrey.t.kirsher@intel.com>
(cherry picked from commit 24a768cfc4f8cbbb3eaf56284610e652ef05fc5b)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/intel/i40e/i40e_common.c
diff --cc drivers/net/ethernet/intel/i40e/i40e_common.c
index 1866f4096b38,9d09ab31ec89..000000000000
--- a/drivers/net/ethernet/intel/i40e/i40e_common.c
+++ b/drivers/net/ethernet/intel/i40e/i40e_common.c
@@@ -287,6 -655,38 +287,41 @@@ i40e_status i40e_get_mac_addr(struct i4
  }
  
  /**
++<<<<<<< HEAD
++=======
+  * i40e_pre_tx_queue_cfg - pre tx queue configure
+  * @hw: pointer to the HW structure
+  * @queue: target pf queue index
+  * @enable: state change request
+  *
+  * Handles hw requirement to indicate intention to enable
+  * or disable target queue.
+  **/
+ void i40e_pre_tx_queue_cfg(struct i40e_hw *hw, u32 queue, bool enable)
+ {
+ 	u32 abs_queue_idx = hw->func_caps.base_queue + queue;
+ 	u32 reg_block = 0;
+ 	u32 reg_val;
+ 
+ 	if (abs_queue_idx >= 128) {
+ 		reg_block = abs_queue_idx / 128;
+ 		abs_queue_idx %= 128;
+ 	}
+ 
+ 	reg_val = rd32(hw, I40E_GLLAN_TXPRE_QDIS(reg_block));
+ 	reg_val &= ~I40E_GLLAN_TXPRE_QDIS_QINDX_MASK;
+ 	reg_val |= (abs_queue_idx << I40E_GLLAN_TXPRE_QDIS_QINDX_SHIFT);
+ 
+ 	if (enable)
+ 		reg_val |= I40E_GLLAN_TXPRE_QDIS_CLEAR_QDIS_MASK;
+ 	else
+ 		reg_val |= I40E_GLLAN_TXPRE_QDIS_SET_QDIS_MASK;
+ 
+ 	wr32(hw, I40E_GLLAN_TXPRE_QDIS(reg_block), reg_val);
+ }
+ 
+ /**
++>>>>>>> 24a768cfc4f8 (i40e: limit GLLAN_TXPRE_QDIS to QINDX 0-127)
   * i40e_get_media_type - Gets media type
   * @hw: pointer to the hardware structure
   **/
* Unmerged path drivers/net/ethernet/intel/i40e/i40e_common.c
