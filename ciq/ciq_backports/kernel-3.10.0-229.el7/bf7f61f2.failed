powerpc/pseries/cpuidle: Remove MAX_IDLE_STATE macro.

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-229.el7
Rebuild_CHGLOG: - [powerpc] pseries/cpuidle: Remove MAX_IDLE_STATE macro (Don Zickus) [1127366]
Rebuild_FUZZ: 90.72%
commit-author Deepthi Dharwar <deepthi@linux.vnet.ibm.com>
commit bf7f61f2dfc5c5764e862bee317a5a227091d0d2
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-229.el7/bf7f61f2.failed

This patch removes the usage of MAX_IDLE_STATE macro
and dead code around it. The number of states
are determined at run time based on the cpuidle
state table selected on a given platform

	Signed-off-by: Deepthi Dharwar <deepthi@linux.vnet.ibm.com>
	Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
(cherry picked from commit bf7f61f2dfc5c5764e862bee317a5a227091d0d2)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/powerpc/platforms/pseries/processor_idle.c
diff --cc arch/powerpc/platforms/pseries/processor_idle.c
index a166e38bd683,bb56091685d3..000000000000
--- a/arch/powerpc/platforms/pseries/processor_idle.c
+++ b/arch/powerpc/platforms/pseries/processor_idle.c
@@@ -25,10 -24,7 +25,14 @@@ struct cpuidle_driver pseries_idle_driv
  	.owner            = THIS_MODULE,
  };
  
++<<<<<<< HEAD:arch/powerpc/platforms/pseries/processor_idle.c
 +#define MAX_IDLE_STATE_COUNT	2
 +
 +static int max_idle_state = MAX_IDLE_STATE_COUNT - 1;
 +static struct cpuidle_device __percpu *pseries_cpuidle_devices;
++=======
+ static int max_idle_state;
++>>>>>>> bf7f61f2dfc5 (powerpc/pseries/cpuidle: Remove MAX_IDLE_STATE macro.):drivers/cpuidle/cpuidle-pseries.c
  static struct cpuidle_state *cpuidle_state_table;
  
  static inline void idle_loop_prolog(unsigned long *in_purr)
@@@ -305,15 -247,16 +305,28 @@@ static int pseries_idle_probe(void
  	if (cpuidle_disable != IDLE_NO_OVERRIDE)
  		return -ENODEV;
  
++<<<<<<< HEAD:arch/powerpc/platforms/pseries/processor_idle.c
 +	if (max_idle_state == 0) {
 +		printk(KERN_DEBUG "pseries processor idle disabled.\n");
 +		return -EPERM;
 +	}
 +
 +	if (lppaca_shared_proc(get_lppaca()))
 +		cpuidle_state_table = shared_states;
 +	else
 +		cpuidle_state_table = dedicated_states;
++=======
+ 	if (firmware_has_feature(FW_FEATURE_SPLPAR)) {
+ 		if (lppaca_shared_proc(get_lppaca())) {
+ 			cpuidle_state_table = shared_states;
+ 			max_idle_state = ARRAY_SIZE(shared_states);
+ 		} else {
+ 			cpuidle_state_table = dedicated_states;
+ 			max_idle_state = ARRAY_SIZE(dedicated_states);
+ 		}
+ 	} else
+ 		return -ENODEV;
++>>>>>>> bf7f61f2dfc5 (powerpc/pseries/cpuidle: Remove MAX_IDLE_STATE macro.):drivers/cpuidle/cpuidle-pseries.c
  
  	return 0;
  }
* Unmerged path arch/powerpc/platforms/pseries/processor_idle.c
