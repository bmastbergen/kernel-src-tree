powerpc: modules: implement stubs for ELFv2 ABI.

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-229.el7
Rebuild_CHGLOG: - [powerpc] modules: implement stubs for ELFv2 ABI (Don Zickus) [1127366]
Rebuild_FUZZ: 88.37%
commit-author Rusty Russell <rusty@rustcorp.com.au>
commit 008d7a914efee6ee5afe59bcc46d3d6b60657598
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-229.el7/008d7a91.failed

ELFv2 doesn't use function descriptors, because it doesn't need to
load a new r2 when calling into a function.  On the other hand, you're
supposed to use a local entry point for R_PPC_REL24 branches.

	Signed-off-by: Rusty Russell <rusty@rustcorp.com.au>
(cherry picked from commit 008d7a914efee6ee5afe59bcc46d3d6b60657598)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/powerpc/kernel/module_64.c
diff --cc arch/powerpc/kernel/module_64.c
index 4adacda2c7fd,042360135260..000000000000
--- a/arch/powerpc/kernel/module_64.c
+++ b/arch/powerpc/kernel/module_64.c
@@@ -213,6 -263,24 +263,27 @@@ static void dedotify(Elf64_Sym *syms, u
  	}
  }
  
++<<<<<<< HEAD
++=======
+ static Elf64_Sym *find_dot_toc(Elf64_Shdr *sechdrs,
+ 			       const char *strtab,
+ 			       unsigned int symindex)
+ {
+ 	unsigned int i, numsyms;
+ 	Elf64_Sym *syms;
+ 
+ 	syms = (Elf64_Sym *)sechdrs[symindex].sh_addr;
+ 	numsyms = sechdrs[symindex].sh_size / sizeof(Elf64_Sym);
+ 
+ 	for (i = 1; i < numsyms; i++) {
+ 		if (syms[i].st_shndx == SHN_UNDEF
+ 		    && strcmp(strtab + syms[i].st_name, "TOC.") == 0)
+ 			return &syms[i];
+ 	}
+ 	return NULL;
+ }
+ 
++>>>>>>> 008d7a914efe (powerpc: modules: implement stubs for ELFv2 ABI.)
  int module_frob_arch_sections(Elf64_Ehdr *hdr,
  			      Elf64_Shdr *sechdrs,
  			      char *secstrings,
* Unmerged path arch/powerpc/kernel/module_64.c
