drm/i915: Fix lock dropping in intel_tv_detect()

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-229.el7
Rebuild_CHGLOG: - [drm] i915: Fix lock dropping in intel_tv_detect() (Rob Clark) [1153301]
Rebuild_FUZZ: 95.65%
commit-author Ville Syrjälä <ville.syrjala@linux.intel.com>
commit bbfb44e8b688e778964275ab0862f67463ba4f84
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-229.el7/bbfb44e8.failed

When intel_tv_detect() fails to do load detection it would forget to
drop the locks and clean up the acquire context. Fix it up.

This is a regression from:
 commit 208bf9fdcd3575aa4a5d48b3e0295f7cdaf6fc44
 Author: Ville Syrjälä <ville.syrjala@linux.intel.com>
 Date:   Mon Aug 11 13:15:35 2014 +0300

    drm/i915: Fix locking for intel_enable_pipe_a()

v2: Make the code more readable (Chris)
v3: Drop WARN_ON(type < 0) (Chris)

	Cc: stable@vger.kernel.org
	Cc: Tibor Billes <tbilles@gmx.com>
	Reported-by: Tibor Billes <tbilles@gmx.com>
	Tested-by: Tibor Billes <tbilles@gmx.com>
	Reviewed-by: Chris Wilson <chris@chris-wilson.co.uk>
	Signed-off-by: Ville Syrjälä <ville.syrjala@linux.intel.com>
	Signed-off-by: Jani Nikula <jani.nikula@intel.com>
(cherry picked from commit bbfb44e8b688e778964275ab0862f67463ba4f84)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/gpu/drm/i915/intel_tv.c
diff --cc drivers/gpu/drm/i915/intel_tv.c
index dd6f84bf6c22,c69d3ce1b3d6..000000000000
--- a/drivers/gpu/drm/i915/intel_tv.c
+++ b/drivers/gpu/drm/i915/intel_tv.c
@@@ -1316,12 -1322,21 +1317,22 @@@ intel_tv_detect(struct drm_connector *c
  
  	if (force) {
  		struct intel_load_detect_pipe tmp;
 -		struct drm_modeset_acquire_ctx ctx;
 -
 -		drm_modeset_acquire_init(&ctx, 0);
  
 -		if (intel_get_load_detect_pipe(connector, &mode, &tmp, &ctx)) {
 +		if (intel_get_load_detect_pipe(connector, &mode, &tmp)) {
  			type = intel_tv_detect_type(intel_tv, connector);
  			intel_release_load_detect_pipe(connector, &tmp);
+ 			status = type < 0 ?
+ 				connector_status_disconnected :
+ 				connector_status_connected;
  		} else
++<<<<<<< HEAD
 +			return connector_status_unknown;
++=======
+ 			status = connector_status_unknown;
+ 
+ 		drm_modeset_drop_locks(&ctx);
+ 		drm_modeset_acquire_fini(&ctx);
++>>>>>>> bbfb44e8b688 (drm/i915: Fix lock dropping in intel_tv_detect())
  	} else
  		return connector->status;
  
* Unmerged path drivers/gpu/drm/i915/intel_tv.c
