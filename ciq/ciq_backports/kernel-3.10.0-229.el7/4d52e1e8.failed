qlcnic: Fix to send INIT_NIC_FUNC as first mailbox.

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-229.el7
Rebuild_CHGLOG: - [ethernet] qlcnic: Fix to send INIT_NIC_FUNC as first mailbox (Chad Dupuis) [1089352]
Rebuild_FUZZ: 99.01%
commit-author Sucheta Chakraborty <sucheta.chakraborty@qlogic.com>
commit 4d52e1e8d1e198962dcbfabf9c06425c38eb23d0
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-229.el7/4d52e1e8.failed

o INIT_NIC_FUNC should be first mailbox sent. Sending DCB capability and
  parameter query commands after that command.

	Signed-off-by: Sucheta Chakraborty <sucheta.chakraborty@qlogic.com>
	Signed-off-by: Shahed Shaikh <shahed.shaikh@qlogic.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 4d52e1e8d1e198962dcbfabf9c06425c38eb23d0)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/qlogic/qlcnic/qlcnic_main.c
diff --cc drivers/net/ethernet/qlogic/qlcnic/qlcnic_main.c
index 3b17c83155ba,84d011ed7ec2..000000000000
--- a/drivers/net/ethernet/qlogic/qlcnic/qlcnic_main.c
+++ b/drivers/net/ethernet/qlogic/qlcnic/qlcnic_main.c
@@@ -2365,7 -2547,10 +2365,14 @@@ qlcnic_probe(struct pci_dev *pdev, cons
  			 "Device does not support MSI interrupts\n");
  
  	if (qlcnic_82xx_check(adapter)) {
++<<<<<<< HEAD
 +		err = qlcnic_setup_intr(adapter, 0, 0);
++=======
+ 		qlcnic_dcb_enable(adapter->dcb);
+ 		qlcnic_dcb_get_info(adapter->dcb);
+ 		err = qlcnic_setup_intr(adapter);
+ 
++>>>>>>> 4d52e1e8d1e1 (qlcnic: Fix to send INIT_NIC_FUNC as first mailbox.)
  		if (err) {
  			dev_err(&pdev->dev, "Failed to setup interrupt\n");
  			goto err_out_disable_msi;
diff --git a/drivers/net/ethernet/qlogic/qlcnic/qlcnic_83xx_init.c b/drivers/net/ethernet/qlogic/qlcnic/qlcnic_83xx_init.c
index 643b617cb82d..f78bcf0a7518 100644
--- a/drivers/net/ethernet/qlogic/qlcnic/qlcnic_83xx_init.c
+++ b/drivers/net/ethernet/qlogic/qlcnic/qlcnic_83xx_init.c
@@ -2237,7 +2237,9 @@ int qlcnic_83xx_init(struct qlcnic_adapter *adapter, int pci_using_dac)
 		goto disable_mbx_intr;
 
 	qlcnic_83xx_clear_function_resources(adapter);
+	qlcnic_dcb_enable(adapter->dcb);
 	qlcnic_83xx_initialize_nic(adapter, 1);
+	qlcnic_dcb_get_info(adapter->dcb);
 
 	/* Configure default, SR-IOV or Virtual NIC mode of operation */
 	err = qlcnic_83xx_configure_opmode(adapter);
diff --git a/drivers/net/ethernet/qlogic/qlcnic/qlcnic_dcb.c b/drivers/net/ethernet/qlogic/qlcnic/qlcnic_dcb.c
index 14aa6ea13d71..91a5256262e4 100644
--- a/drivers/net/ethernet/qlogic/qlcnic/qlcnic_dcb.c
+++ b/drivers/net/ethernet/qlogic/qlcnic/qlcnic_dcb.c
@@ -327,8 +327,6 @@ static int __qlcnic_dcb_attach(struct qlcnic_dcb *dcb)
 		goto out_free_cfg;
 	}
 
-	qlcnic_dcb_get_info(dcb);
-
 	return 0;
 out_free_cfg:
 	kfree(dcb->cfg);
* Unmerged path drivers/net/ethernet/qlogic/qlcnic/qlcnic_main.c
