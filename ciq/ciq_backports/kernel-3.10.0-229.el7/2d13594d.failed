cpufreq: stats: free table and remove sysfs entry in a single routine

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-229.el7
Rebuild_CHGLOG: - [cpufreq] stats: free table and remove sysfs entry in a single routine (Prarit Bhargava) [1134369]
Rebuild_FUZZ: 93.02%
commit-author Viresh Kumar <viresh.kumar@linaro.org>
commit 2d13594dcb7eaa41fa180e8a3b27a8f10845381f
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-229.el7/2d13594d.failed

We don't have code paths now where we need to do these two things
separately, so it is better do them in a single routine. Just as
they are allocated in a single routine.

	Acked-by: Nicolas Pitre <nico@linaro.org>
	Tested-by: Nicolas Pitre <nico@linaro.org>
	Signed-off-by: Viresh Kumar <viresh.kumar@linaro.org>
	Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>
(cherry picked from commit 2d13594dcb7eaa41fa180e8a3b27a8f10845381f)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/cpufreq/cpufreq_stats.c
diff --cc drivers/cpufreq/cpufreq_stats.c
index ee6a6db3cbe4,9dd58835456e..000000000000
--- a/drivers/cpufreq/cpufreq_stats.c
+++ b/drivers/cpufreq/cpufreq_stats.c
@@@ -292,10 -282,13 +284,20 @@@ static int cpufreq_stat_notifier_policy
  	table = cpufreq_frequency_get_table(cpu);
  	if (!table)
  		return 0;
++<<<<<<< HEAD
 +	ret = cpufreq_stats_create_table(policy, table);
 +	if (ret)
 +		return ret;
 +	return 0;
++=======
+ 
+ 	if (val == CPUFREQ_CREATE_POLICY)
+ 		ret = cpufreq_stats_create_table(policy, table);
+ 	else if (val == CPUFREQ_REMOVE_POLICY)
+ 		__cpufreq_stats_free_table(policy);
+ 
+ 	return ret;
++>>>>>>> 2d13594dcb7e (cpufreq: stats: free table and remove sysfs entry in a single routine)
  }
  
  static int cpufreq_stat_notifier_trans(struct notifier_block *nb,
@@@ -401,11 -366,8 +403,13 @@@ static void __exit cpufreq_stats_exit(v
  			CPUFREQ_POLICY_NOTIFIER);
  	cpufreq_unregister_notifier(&notifier_trans_block,
  			CPUFREQ_TRANSITION_NOTIFIER);
++<<<<<<< HEAD
 +	unregister_hotcpu_notifier(&cpufreq_stat_cpu_notifier);
 +	for_each_online_cpu(cpu) {
++=======
+ 	for_each_online_cpu(cpu)
++>>>>>>> 2d13594dcb7e (cpufreq: stats: free table and remove sysfs entry in a single routine)
  		cpufreq_stats_free_table(cpu);
- 		cpufreq_stats_free_sysfs(cpu);
- 	}
  }
  
  MODULE_AUTHOR("Zou Nan hai <nanhai.zou@intel.com>");
* Unmerged path drivers/cpufreq/cpufreq_stats.c
