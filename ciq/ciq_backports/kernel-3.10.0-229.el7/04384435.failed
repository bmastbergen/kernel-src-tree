drm/nouveau/kms: restore acceleration before fb_set_suspend() resumes

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-229.el7
Rebuild_CHGLOG: - [drm] nouveau/kms: restore acceleration before fb_set_suspend() resumes (Rob Clark) [1173317]
Rebuild_FUZZ: 97.01%
commit-author Ben Skeggs <bskeggs@redhat.com>
commit 04384435fbcd2c5cb70b2e58c8b643822d7e337f
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-229.el7/04384435.failed

This *should* be safe these days.

	Signed-off-by: Ben Skeggs <bskeggs@redhat.com>
(cherry picked from commit 04384435fbcd2c5cb70b2e58c8b643822d7e337f)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/gpu/drm/nouveau/nouveau_fbcon.c
diff --cc drivers/gpu/drm/nouveau/nouveau_fbcon.c
index fa81047bd1be,9364ad4fcc1d..000000000000
--- a/drivers/gpu/drm/nouveau/nouveau_fbcon.c
+++ b/drivers/gpu/drm/nouveau/nouveau_fbcon.c
@@@ -528,11 -551,13 +528,21 @@@ nouveau_fbcon_set_suspend(struct drm_de
  	struct nouveau_drm *drm = nouveau_drm(dev);
  	if (drm->fbcon) {
  		console_lock();
++<<<<<<< HEAD
 +		if (state == 0)
 +			nouveau_fbcon_save_disable_accel(dev);
 +		fb_set_suspend(drm->fbcon->helper.fbdev, state);
 +		if (state == 1)
 +			nouveau_fbcon_restore_accel(dev);
++=======
+ 		if (state == 0) {
+ 			nouveau_fbcon_accel_restore(dev);
+ 			nouveau_fbcon_zfill(dev, drm->fbcon);
+ 		}
+ 		fb_set_suspend(drm->fbcon->helper.fbdev, state);
+ 		if (state == 1)
+ 			nouveau_fbcon_accel_save_disable(dev);
++>>>>>>> 04384435fbcd (drm/nouveau/kms: restore acceleration before fb_set_suspend() resumes)
  		console_unlock();
  	}
  }
* Unmerged path drivers/gpu/drm/nouveau/nouveau_fbcon.c
