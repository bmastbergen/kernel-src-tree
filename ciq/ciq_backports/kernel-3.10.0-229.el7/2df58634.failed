perf probe: Unify show_available_functions for uprobes/kprobes

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-229.el7
Rebuild_CHGLOG: - [tools] perf/probe: Unify show_available_functions for uprobes/kprobes (Jiri Olsa) [1134356]
Rebuild_FUZZ: 98.39%
commit-author Masami Hiramatsu <masami.hiramatsu.pt@hitachi.com>
commit 2df58634cd2ad33d7c7ca2e02e1a44db6c8cf68d
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-229.el7/2df58634.failed

Unify show_available_functions for uprobes/kprobes to cleanup and reduce
the code. This also improves error messages.

	Signed-off-by: Masami Hiramatsu <masami.hiramatsu.pt@hitachi.com>
	Cc: David Ahern <dsahern@gmail.com>
	Cc: "David A. Long" <dave.long@linaro.org>
	Cc: Ingo Molnar <mingo@redhat.com>
	Cc: Namhyung Kim <namhyung@kernel.org>
	Cc: Oleg Nesterov <oleg@redhat.com>
	Cc: Srikar Dronamraju <srikar@linux.vnet.ibm.com>
	Cc: Steven Rostedt <rostedt@goodmis.org>
	Cc: yrl.pp-manager.tt@hitachi.com
Link: http://lkml.kernel.org/r/20140206053211.29635.20563.stgit@kbuild-fedora.yrl.intra.hitachi.co.jp
	Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>
(cherry picked from commit 2df58634cd2ad33d7c7ca2e02e1a44db6c8cf68d)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	tools/perf/util/probe-event.c
diff --cc tools/perf/util/probe-event.c
index 3a0eb48e3a0a,ace3ba37c880..000000000000
--- a/tools/perf/util/probe-event.c
+++ b/tools/perf/util/probe-event.c
@@@ -2215,53 -2352,17 +2235,60 @@@ int show_available_funcs(const char *ta
  	if (!dso__sorted_by_name(map->dso, map->type))
  		dso__sort_by_name(map->dso, map->type);
  
++<<<<<<< HEAD
 +	dso__fprintf_symbols_by_name(map->dso, map->type, stdout);
 +	return 0;
 +}
 +
 +static int available_kernel_funcs(const char *module)
 +{
 +	struct map *map;
 +	int ret;
 +
 +	ret = init_vmlinux();
 +	if (ret < 0)
 +		return ret;
 +
 +	map = kernel_get_module_map(module);
 +	if (!map) {
 +		pr_err("Failed to find %s map.\n", (module) ? : "kernel");
 +		return -EINVAL;
 +	}
 +	return __show_available_funcs(map);
 +}
 +
 +static int available_user_funcs(const char *target)
 +{
 +	struct map *map;
 +	int ret;
 +
 +	ret = init_user_exec();
 +	if (ret < 0)
 +		return ret;
 +
 +	map = dso__new_map(target);
 +	ret = __show_available_funcs(map);
 +	dso__delete(map->dso);
 +	map__delete(map);
 +	return ret;
 +}
 +
 +int show_available_funcs(const char *target, struct strfilter *_filter,
 +					bool user)
 +{
++=======
+ 	/* Show all (filtered) symbols */
++>>>>>>> 2df58634cd2a (perf probe: Unify show_available_functions for uprobes/kprobes)
  	setup_pager();
- 	available_func_filter = _filter;
- 
- 	if (!user)
- 		return available_kernel_funcs(target);
+ 	dso__fprintf_symbols_by_name(map->dso, map->type, stdout);
+ end:
+ 	if (user) {
+ 		dso__delete(map->dso);
+ 		map__delete(map);
+ 	}
+ 	exit_symbol_maps();
  
- 	return available_user_funcs(target);
+ 	return ret;
  }
  
  /*
* Unmerged path tools/perf/util/probe-event.c
