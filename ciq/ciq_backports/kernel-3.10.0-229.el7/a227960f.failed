locking/mutex: Fix debug_mutexes

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-229.el7
commit-author Peter Zijlstra <peterz@infradead.org>
commit a227960fe0cafcc229a8d6bb8b454a3a0b33719d
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-229.el7/a227960f.failed

debug_mutex_unlock() would bail when !debug_locks and forgets to
actually unlock.

	Reported-by: "Michael L. Semon" <mlsemon35@gmail.com>
	Reported-by: "Kirill A. Shutemov" <kirill@shutemov.name>
	Reported-by: Valdis Kletnieks <Valdis.Kletnieks@vt.edu>
Fixes: 6f008e72cd11 ("locking/mutex: Fix debug checks")
	Tested-by: Dave Jones <davej@redhat.com>
	Cc: Jason Low <jason.low2@hp.com>
	Signed-off-by: Peter Zijlstra <peterz@infradead.org>
Link: http://lkml.kernel.org/r/20140410141559.GE13658@twins.programming.kicks-ass.net
	Signed-off-by: Ingo Molnar <mingo@kernel.org>
(cherry picked from commit a227960fe0cafcc229a8d6bb8b454a3a0b33719d)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	kernel/mutex-debug.c
diff --cc kernel/mutex-debug.c
index 43ef6b7975a2,5cf6731b98e9..000000000000
--- a/kernel/mutex-debug.c
+++ b/kernel/mutex-debug.c
@@@ -71,13 -71,17 +71,24 @@@ void mutex_remove_waiter(struct mutex *
  
  void debug_mutex_unlock(struct mutex *lock)
  {
- 	if (unlikely(!debug_locks))
- 		return;
+ 	if (likely(debug_locks)) {
+ 		DEBUG_LOCKS_WARN_ON(lock->magic != lock);
  
++<<<<<<< HEAD:kernel/mutex-debug.c
 +	DEBUG_LOCKS_WARN_ON(lock->magic != lock);
 +	DEBUG_LOCKS_WARN_ON(lock->owner != current);
 +	DEBUG_LOCKS_WARN_ON(!lock->wait_list.prev && !lock->wait_list.next);
 +	mutex_clear_owner(lock);
++=======
+ 		if (!lock->owner)
+ 			DEBUG_LOCKS_WARN_ON(!lock->owner);
+ 		else
+ 			DEBUG_LOCKS_WARN_ON(lock->owner != current);
+ 
+ 		DEBUG_LOCKS_WARN_ON(!lock->wait_list.prev && !lock->wait_list.next);
+ 		mutex_clear_owner(lock);
+ 	}
++>>>>>>> a227960fe0ca (locking/mutex: Fix debug_mutexes):kernel/locking/mutex-debug.c
  
  	/*
  	 * __mutex_slowpath_needs_to_unlock() is explicitly 0 for debug
* Unmerged path kernel/mutex-debug.c
