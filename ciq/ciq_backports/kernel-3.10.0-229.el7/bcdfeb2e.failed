ceph: remove xattr when null value is given to setxattr()

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-229.el7
commit-author Yan, Zheng <zheng.z.yan@intel.com>
commit bcdfeb2eb4e42b811950b9cd226109291051732a
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-229.el7/bcdfeb2e.failed

For the setxattr request, introduce a new flag CEPH_XATTR_REMOVE
to distinguish null value case from the zero-length value case.

	Signed-off-by: Yan, Zheng <zheng.z.yan@intel.com>
(cherry picked from commit bcdfeb2eb4e42b811950b9cd226109291051732a)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	fs/ceph/xattr.c
diff --cc fs/ceph/xattr.c
index 19ac346408a1,231c02b16c0c..000000000000
--- a/fs/ceph/xattr.c
+++ b/fs/ceph/xattr.c
@@@ -11,6 -12,21 +11,24 @@@
  #define XATTR_CEPH_PREFIX "ceph."
  #define XATTR_CEPH_PREFIX_LEN (sizeof (XATTR_CEPH_PREFIX) - 1)
  
++<<<<<<< HEAD
++=======
+ static int __remove_xattr(struct ceph_inode_info *ci,
+ 			  struct ceph_inode_xattr *xattr);
+ 
+ /*
+  * List of handlers for synthetic system.* attributes. Other
+  * attributes are handled directly.
+  */
+ const struct xattr_handler *ceph_xattr_handlers[] = {
+ #ifdef CONFIG_CEPH_FS_POSIX_ACL
+ 	&posix_acl_access_xattr_handler,
+ 	&posix_acl_default_xattr_handler,
+ #endif
+ 	NULL,
+ };
+ 
++>>>>>>> bcdfeb2eb4e4 (ceph: remove xattr when null value is given to setxattr())
  static bool ceph_is_valid_xattr(const char *name)
  {
  	return !strncmp(name, XATTR_CEPH_PREFIX, XATTR_CEPH_PREFIX_LEN) ||
* Unmerged path fs/ceph/xattr.c
diff --git a/include/linux/ceph/ceph_fs.h b/include/linux/ceph/ceph_fs.h
index 2623cffc73a1..25bfb0eff772 100644
--- a/include/linux/ceph/ceph_fs.h
+++ b/include/linux/ceph/ceph_fs.h
@@ -373,8 +373,9 @@ extern const char *ceph_mds_op_name(int op);
 /*
  * Ceph setxattr request flags.
  */
-#define CEPH_XATTR_CREATE  1
-#define CEPH_XATTR_REPLACE 2
+#define CEPH_XATTR_CREATE  (1 << 0)
+#define CEPH_XATTR_REPLACE (1 << 1)
+#define CEPH_XATTR_REMOVE  (1 << 31)
 
 union ceph_mds_request_args {
 	struct {
