drm/i915/dp: only use training pattern 3 on platforms that support it

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-229.el7
Rebuild_CHGLOG: - [drm] i915/dp: only use training pattern 3 on platforms that support it (Rob Clark) [1173317]
Rebuild_FUZZ: 97.01%
commit-author Jani Nikula <jani.nikula@intel.com>
commit 7809a61176b385ebb3299ea43c58b1bb31ffb8c0
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-229.el7/7809a611.failed

Ivybridge + 30" monitor prints a drm error on every modeset, since IVB
doesn't support DP3 we should even bother trying to use it.

This regression has been introduced in

commit 06ea66b6bb445043dc25a9626254d5c130093199
Author: Todd Previte <tprevite@gmail.com>
Date:   Mon Jan 20 10:19:39 2014 -0700

    drm/i915: Enable 5.4Ghz (HBR2) link rate for Displayport 1.2-capable
devices

	Reported-by: Dave Airlie <airlied@redhat.com>
Reference: http://mid.gmane.org/1414566170-9868-1-git-send-email-airlied@gmail.com
	Cc: Todd Previte <tprevite@gmail.com>
	Cc: stable@vger.kernel.org (3.15+)
	Reviewed-by: Ville Syrjälä <ville.syrjala@linux.intel.com>
	Signed-off-by: Jani Nikula <jani.nikula@intel.com>
(cherry picked from commit 7809a61176b385ebb3299ea43c58b1bb31ffb8c0)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/gpu/drm/i915/intel_dp.c
diff --cc drivers/gpu/drm/i915/intel_dp.c
index a4f2fedc61d6,5ad45bfff3fe..000000000000
--- a/drivers/gpu/drm/i915/intel_dp.c
+++ b/drivers/gpu/drm/i915/intel_dp.c
@@@ -2604,11 -3721,25 +2604,33 @@@ intel_dp_get_dpcd(struct intel_dp *inte
  
  	/* Check if the panel supports PSR */
  	memset(intel_dp->psr_dpcd, 0, sizeof(intel_dp->psr_dpcd));
++<<<<<<< HEAD
 +	intel_dp_aux_native_read_retry(intel_dp, DP_PSR_SUPPORT,
 +				       intel_dp->psr_dpcd,
 +				       sizeof(intel_dp->psr_dpcd));
 +	if (is_edp_psr(intel_dp))
 +		DRM_DEBUG_KMS("Detected EDP PSR Panel.\n");
++=======
+ 	if (is_edp(intel_dp)) {
+ 		intel_dp_dpcd_read_wake(&intel_dp->aux, DP_PSR_SUPPORT,
+ 					intel_dp->psr_dpcd,
+ 					sizeof(intel_dp->psr_dpcd));
+ 		if (intel_dp->psr_dpcd[0] & DP_PSR_IS_SUPPORTED) {
+ 			dev_priv->psr.sink_support = true;
+ 			DRM_DEBUG_KMS("Detected EDP PSR Panel.\n");
+ 		}
+ 	}
+ 
+ 	/* Training Pattern 3 support, both source and sink */
+ 	if (intel_dp->dpcd[DP_DPCD_REV] >= 0x12 &&
+ 	    intel_dp->dpcd[DP_MAX_LANE_COUNT] & DP_TPS3_SUPPORTED &&
+ 	    (IS_HASWELL(dev_priv) || INTEL_INFO(dev_priv)->gen >= 8)) {
+ 		intel_dp->use_tps3 = true;
+ 		DRM_DEBUG_KMS("Displayport TPS3 supported\n");
+ 	} else
+ 		intel_dp->use_tps3 = false;
+ 
++>>>>>>> 7809a61176b3 (drm/i915/dp: only use training pattern 3 on platforms that support it)
  	if (!(intel_dp->dpcd[DP_DOWNSTREAMPORT_PRESENT] &
  	      DP_DWN_STRM_PORT_PRESENT))
  		return true; /* native DP sink */
* Unmerged path drivers/gpu/drm/i915/intel_dp.c
