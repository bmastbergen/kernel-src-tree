perf symbols: Check return value of filename__read_debuglink()

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-229.el7
Rebuild_CHGLOG: - [tools] perf/symbols: Check return value of filename__read_debuglink() (Jiri Olsa) [1134356]
Rebuild_FUZZ: 98.39%
commit-author Stephane Eranian <eranian@google.com>
commit 0d3dc5e8b85a144aaeb5dc26f7f2113e4c4e7e81
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-229.el7/0d3dc5e8.failed

When dso__read_binary_type_filename() called, it doesn't check the
return value of filename__read_debuglink() so that it'll try to open the
debuglink file even if it doesn't exist.

Also fix return value of the filename__read_debuglink() as it always
return -1 regardless of the result.

	Signed-off-by: Namhyung Kim <namhyung@kernel.org>
	Cc: Cody P Schafer <cody@linux.vnet.ibm.com>
	Cc: Ingo Molnar <mingo@kernel.org>
	Cc: Namhyung Kim <namhyung.kim@lge.com>
	Cc: Namhyung Kim <namhyung@kernel.org>
	Cc: Paul Mackerras <paulus@samba.org>
	Cc: Peter Zijlstra <a.p.zijlstra@chello.nl>
Link: http://lkml.kernel.org/r/1392859976-32760-3-git-send-email-namhyung@kernel.org
	Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>
(cherry picked from commit 0d3dc5e8b85a144aaeb5dc26f7f2113e4c4e7e81)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	tools/perf/util/dso.c
diff --cc tools/perf/util/dso.c
index f2c00bf6c5e6,64453d63b971..000000000000
--- a/tools/perf/util/dso.c
+++ b/tools/perf/util/dso.c
@@@ -44,8 -45,8 +44,13 @@@ int dso__binary_type_file(struct dso *d
  			debuglink--;
  		if (*debuglink == '/')
  			debuglink++;
++<<<<<<< HEAD
 +		filename__read_debuglink(dso->long_name, debuglink,
 +					 size - (debuglink - file));
++=======
+ 		ret = filename__read_debuglink(dso->long_name, debuglink,
+ 					       size - (debuglink - filename));
++>>>>>>> 0d3dc5e8b85a (perf symbols: Check return value of filename__read_debuglink())
  		}
  		break;
  	case DSO_BINARY_TYPE__BUILD_ID_CACHE:
* Unmerged path tools/perf/util/dso.c
diff --git a/tools/perf/util/symbol-elf.c b/tools/perf/util/symbol-elf.c
index cb805ba81fd4..b8c7c8ec6578 100644
--- a/tools/perf/util/symbol-elf.c
+++ b/tools/perf/util/symbol-elf.c
@@ -507,6 +507,8 @@ int filename__read_debuglink(const char *filename, char *debuglink,
 	/* the start of this section is a zero-terminated string */
 	strncpy(debuglink, data->d_buf, size);
 
+	err = 0;
+
 out_elf_end:
 	elf_end(elf);
 out_close:
