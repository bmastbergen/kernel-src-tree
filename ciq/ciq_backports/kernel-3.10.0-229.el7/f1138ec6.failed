tools/perf/build: Speed up auto-detection

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-229.el7
Rebuild_CHGLOG: - [tools] perf/build: Speed up auto-detection (Jiri Olsa) [1131394]
Rebuild_FUZZ: 92.11%
commit-author Ingo Molnar <mingo@kernel.org>
commit f1138ec66e839ce90c58af0c264db33271d73466
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-229.el7/f1138ec6.failed

The detection of certain rarely detected features can be delayed
to when they are actually needed.

So speed up the common case of auto-detection by pre-building only
a core set of features and populating only their feature-flags.

[ Features not listed in CORE_FEATURES need to built explicitly
  via the feature_check() function. ]

(Also order the feature names alphabetically, while at it.)

	Cc: Arnaldo Carvalho de Melo <acme@redhat.com>
	Cc: Peter Zijlstra <a.p.zijlstra@chello.nl>
	Cc: Namhyung Kim <namhyung@kernel.org>
	Cc: David Ahern <dsahern@gmail.com>
	Cc: Jiri Olsa <jolsa@redhat.com>
Link: http://lkml.kernel.org/n/tip-xQkuveknd0gqla1dfxrqKpkl@git.kernel.org
	Signed-off-by: Ingo Molnar <mingo@kernel.org>
(cherry picked from commit f1138ec66e839ce90c58af0c264db33271d73466)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	tools/perf/config/Makefile
#	tools/perf/config/feature-checks/Makefile
diff --cc tools/perf/config/Makefile
index 5de26b96afcf,581a94211fea..000000000000
--- a/tools/perf/config/Makefile
+++ b/tools/perf/config/Makefile
@@@ -105,17 -105,36 +105,40 @@@ ende
  $(info )
  $(info Auto-detecting system features:)
  
- FEATURE_TESTS =				\
- 	hello				\
- 	stackprotector-all		\
- 	stackprotector			\
- 	volatile-register-var		\
- 	fortify-source			\
- 	bionic				\
- 	libelf				\
- 	glibc				\
+ #
+ # Note that this is not a complete list of all feature tests, just
+ # those that are typically built on a fully configured system.
+ #
+ # [ Feature tests not mentioned here have to be built explicitly in
+ #   the rule that uses them - an example for that is the 'bionic'
+ #   feature check. ]
+ #
+ CORE_FEATURE_TESTS =			\
+ 	backtrace			\
  	dwarf				\
++<<<<<<< HEAD
 +	libnuma
++=======
+ 	fortify-source			\
+ 	glibc				\
+ 	gtk2				\
+ 	gtk2-infobar			\
+ 	libaudit			\
+ 	libbfd				\
+ 	libelf				\
+ 	libelf-getphdrnum		\
+ 	libelf-mmap			\
+ 	libnuma				\
+ 	libperl				\
+ 	libpython			\
+ 	libpython-version		\
+ 	libslang			\
+ 	libunwind			\
+ 	on-exit				\
+ 	stackprotector			\
+ 	stackprotector-all		\
+ 	volatile-register-var
++>>>>>>> f1138ec66e83 (tools/perf/build: Speed up auto-detection)
  
  #
  # Special fast-path for the 'all features are available' case:
diff --cc tools/perf/config/feature-checks/Makefile
index 19082b9c3ca6,d4c55acc82bb..000000000000
--- a/tools/perf/config/feature-checks/Makefile
+++ b/tools/perf/config/feature-checks/Makefile
@@@ -1,15 -1,29 +1,33 @@@
  
  FILES=					\
- 	test-hello			\
- 	test-stackprotector-all		\
- 	test-stackprotector		\
- 	test-volatile-register-var	\
- 	test-fortify-source		\
+ 	test-all			\
+ 	test-backtrace			\
  	test-bionic			\
- 	test-libelf			\
- 	test-glibc			\
  	test-dwarf			\
++<<<<<<< HEAD
 +	test-libnuma
++=======
+ 	test-fortify-source		\
+ 	test-glibc			\
+ 	test-gtk2			\
+ 	test-gtk2-infobar		\
+ 	test-hello			\
+ 	test-libaudit			\
+ 	test-libbfd			\
+ 	test-libelf			\
+ 	test-libelf-getphdrnum		\
+ 	test-libelf-mmap		\
+ 	test-libnuma			\
+ 	test-libperl			\
+ 	test-libpython			\
+ 	test-libpython-version		\
+ 	test-libslang			\
+ 	test-libunwind			\
+ 	test-on-exit			\
+ 	test-stackprotector-all		\
+ 	test-stackprotector		\
+ 	test-volatile-register-var
++>>>>>>> f1138ec66e83 (tools/perf/build: Speed up auto-detection)
  
  CC := $(CC) -MD
  
* Unmerged path tools/perf/config/Makefile
* Unmerged path tools/perf/config/feature-checks/Makefile
