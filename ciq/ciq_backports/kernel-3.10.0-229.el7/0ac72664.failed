iommu/vt-d: use dmar_insert_dev_info() from dma_add_dev_info()

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-229.el7
Rebuild_CHGLOG: - [iommu] vt-d: use dmar_insert_dev_info() from dma_add_dev_info() (Myron Stowe) [1129880 1087643]
Rebuild_FUZZ: 94.92%
commit-author David Woodhouse <David.Woodhouse@intel.com>
commit 0ac72664853b3181a437afb02a86d7c6f792e031
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-229.el7/0ac72664.failed

	Signed-off-by: David Woodhouse <David.Woodhouse@intel.com>
(cherry picked from commit 0ac72664853b3181a437afb02a86d7c6f792e031)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/iommu/intel-iommu.c
diff --cc drivers/iommu/intel-iommu.c
index 2d7348365b6d,7d3d33f5c8dc..000000000000
--- a/drivers/iommu/intel-iommu.c
+++ b/drivers/iommu/intel-iommu.c
@@@ -2347,21 -2457,11 +2348,29 @@@ static int domain_add_dev_info(struct d
  	unsigned long flags;
  	int ret;
  
++<<<<<<< HEAD
 +	info = alloc_devinfo_mem();
 +	if (!info)
 +		return -ENOMEM;
 +
 +	info->segment = pci_domain_nr(pdev->bus);
 +	info->bus = pdev->bus->number;
 +	info->devfn = pdev->devfn;
 +	info->dev = pdev;
 +	info->domain = domain;
 +
 +	spin_lock_irqsave(&device_domain_lock, flags);
 +	list_add(&info->link, &domain->devices);
 +	list_add(&info->global, &device_domain_list);
 +	pdev->dev.archdata.iommu = info;
 +	spin_unlock_irqrestore(&device_domain_lock, flags);
++=======
+ 	ndomain = dmar_insert_dev_info(pci_domain_nr(pdev->bus),
+ 				       pdev->bus->number, pdev->devfn,
+ 				       &pdev->dev, domain);
+ 	if (ndomain != domain)
+ 		return -EBUSY;
++>>>>>>> 0ac72664853b (iommu/vt-d: use dmar_insert_dev_info() from dma_add_dev_info())
  
  	ret = domain_context_mapping(domain, pdev, translation);
  	if (ret) {
* Unmerged path drivers/iommu/intel-iommu.c
