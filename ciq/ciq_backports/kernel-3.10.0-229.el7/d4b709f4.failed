iommu/vt-d: Make get_valid_domain_for_dev() take struct device

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-229.el7
Rebuild_CHGLOG: - [iommu] vt-d: Make get_valid_domain_for_dev() take struct device (Myron Stowe) [1129880 1087643]
Rebuild_FUZZ: 94.92%
commit-author David Woodhouse <David.Woodhouse@intel.com>
commit d4b709f48ed44d42ed90c1a85dda7fd053d36ce1
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-229.el7/d4b709f4.failed

	Signed-off-by: David Woodhouse <David.Woodhouse@intel.com>
(cherry picked from commit d4b709f48ed44d42ed90c1a85dda7fd053d36ce1)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/iommu/intel-iommu.c
diff --cc drivers/iommu/intel-iommu.c
index 144c54a1b81e,e18b93cc1224..000000000000
--- a/drivers/iommu/intel-iommu.c
+++ b/drivers/iommu/intel-iommu.c
@@@ -2755,22 -2867,19 +2755,30 @@@ static struct dmar_domain *__get_valid_
  	struct dmar_domain *domain;
  	int ret;
  
++<<<<<<< HEAD
 +	domain = get_domain_for_dev(pdev,
 +			DEFAULT_DOMAIN_ADDRESS_WIDTH);
++=======
+ 	domain = get_domain_for_dev(dev, DEFAULT_DOMAIN_ADDRESS_WIDTH);
++>>>>>>> d4b709f48ed4 (iommu/vt-d: Make get_valid_domain_for_dev() take struct device)
  	if (!domain) {
- 		printk(KERN_ERR
- 			"Allocating domain for %s failed", pci_name(pdev));
+ 		printk(KERN_ERR "Allocating domain for %s failed",
+ 		       dev_name(dev));
  		return NULL;
  	}
  
  	/* make sure context mapping is ok */
++<<<<<<< HEAD
 +	if (unlikely(!domain_context_mapped(pdev))) {
 +		ret = domain_context_mapping(domain, pdev,
 +					     CONTEXT_TT_MULTI_LEVEL);
++=======
+ 	if (unlikely(!domain_context_mapped(dev))) {
+ 		ret = domain_context_mapping(domain, dev, CONTEXT_TT_MULTI_LEVEL);
++>>>>>>> d4b709f48ed4 (iommu/vt-d: Make get_valid_domain_for_dev() take struct device)
  		if (ret) {
- 			printk(KERN_ERR
- 				"Domain context map for %s failed",
- 				pci_name(pdev));
+ 			printk(KERN_ERR "Domain context map for %s failed",
+ 			       dev_name(dev));
  			return NULL;
  		}
  	}
* Unmerged path drivers/iommu/intel-iommu.c
