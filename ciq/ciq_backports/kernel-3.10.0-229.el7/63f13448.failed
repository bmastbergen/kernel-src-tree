powerpc: add little endian flag to syscall_get_arch()

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-229.el7
Rebuild_CHGLOG: - [powerpc] add little endian flag to syscall_get_arch() (Richard Guy Briggs) [1169461]
Rebuild_FUZZ: 90.72%
commit-author Richard Guy Briggs <rgb@redhat.com>
commit 63f13448d81c910a284b096149411a719cbed501
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-229.el7/63f13448.failed

Since both ppc and ppc64 have LE variants which are now reported by uname, add
that flag (__AUDIT_ARCH_LE) to syscall_get_arch() and add AUDIT_ARCH_PPC64LE
variant.

Without this,  perf trace and auditctl fail.

Mainline kernel reports ppc64le (per a058801) but there is no matching
AUDIT_ARCH_PPC64LE.

Since 32-bit PPC LE is not supported by audit, don't advertise it in
AUDIT_ARCH_PPC* variants.

See:
	https://www.redhat.com/archives/linux-audit/2014-August/msg00082.html
	https://www.redhat.com/archives/linux-audit/2014-December/msg00004.html

	Signed-off-by: Richard Guy Briggs <rgb@redhat.com>
	Acked-by: Paul Moore <paul@paul-moore.com>
	Signed-off-by: Michael Ellerman <mpe@ellerman.id.au>
(cherry picked from commit 63f13448d81c910a284b096149411a719cbed501)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/powerpc/include/asm/syscall.h
diff --cc arch/powerpc/include/asm/syscall.h
index b54b2add07be,ff21b7a2f0cc..000000000000
--- a/arch/powerpc/include/asm/syscall.h
+++ b/arch/powerpc/include/asm/syscall.h
@@@ -86,4 -88,12 +86,15 @@@ static inline void syscall_set_argument
  	memcpy(&regs->gpr[3 + i], args, n * sizeof(args[0]));
  }
  
++<<<<<<< HEAD
++=======
+ static inline int syscall_get_arch(void)
+ {
+ 	int arch = is_32bit_task() ? AUDIT_ARCH_PPC : AUDIT_ARCH_PPC64;
+ #ifdef __LITTLE_ENDIAN__
+ 	arch |= __AUDIT_ARCH_LE;
+ #endif
+ 	return arch;
+ }
++>>>>>>> 63f13448d81c (powerpc: add little endian flag to syscall_get_arch())
  #endif	/* _ASM_SYSCALL_H */
* Unmerged path arch/powerpc/include/asm/syscall.h
diff --git a/include/uapi/linux/audit.h b/include/uapi/linux/audit.h
index 9539ea9c6108..9b6e3a0c2e23 100644
--- a/include/uapi/linux/audit.h
+++ b/include/uapi/linux/audit.h
@@ -345,7 +345,9 @@ enum {
 #define AUDIT_ARCH_PARISC	(EM_PARISC)
 #define AUDIT_ARCH_PARISC64	(EM_PARISC|__AUDIT_ARCH_64BIT)
 #define AUDIT_ARCH_PPC		(EM_PPC)
+/* do not define AUDIT_ARCH_PPCLE since it is not supported by audit */
 #define AUDIT_ARCH_PPC64	(EM_PPC64|__AUDIT_ARCH_64BIT)
+#define AUDIT_ARCH_PPC64LE	(EM_PPC64|__AUDIT_ARCH_64BIT|__AUDIT_ARCH_LE)
 #define AUDIT_ARCH_S390		(EM_S390)
 #define AUDIT_ARCH_S390X	(EM_S390|__AUDIT_ARCH_64BIT)
 #define AUDIT_ARCH_SH		(EM_SH)
