null_blk: fix softirq completions for queue_mode == 1

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-229.el7
commit-author Jens Axboe <axboe@fb.com>
commit d891fa70876b37941a5c5bed813e73beb53ebcf7
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-229.el7/d891fa70.failed

Only blk-mq completions have payload attached to the request, for
request_fn mode we have stored it in req->special. This fixes an
oops with queue_mode=1 and softirq completions.

	Signed-off-by: Jens Axboe <axboe@fb.com>
(cherry picked from commit d891fa70876b37941a5c5bed813e73beb53ebcf7)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/block/null_blk.c
diff --cc drivers/block/null_blk.c
index 3ae5f19b54ef,a3b042c4d448..000000000000
--- a/drivers/block/null_blk.c
+++ b/drivers/block/null_blk.c
@@@ -226,7 -227,10 +226,14 @@@ static void null_cmd_end_timer(struct n
  
  static void null_softirq_done_fn(struct request *rq)
  {
++<<<<<<< HEAD
 +	end_cmd(rq->special);
++=======
+ 	if (queue_mode == NULL_Q_MQ)
+ 		end_cmd(blk_mq_rq_to_pdu(rq));
+ 	else
+ 		end_cmd(rq->special);
++>>>>>>> d891fa70876b (null_blk: fix softirq completions for queue_mode == 1)
  }
  
  static inline void null_handle_cmd(struct nullb_cmd *cmd)
* Unmerged path drivers/block/null_blk.c
