iwlwifi: mvm: treat EAPOLs like mgmt frames wrt rate

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-229.el7
Rebuild_CHGLOG: - [wireless] iwlwifi/mvm: treat EAPOLs like mgmt frames wrt rate (Stanislaw Gruszka) [1155538]
Rebuild_FUZZ: 97.09%
commit-author Eyal Shapira <eyal@wizery.com>
commit aa11bbf3df026d6b1c6b528bef634fd9de7c2619
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-229.el7/aa11bbf3.failed

Using the LQ table which is initially set according to
the rssi could lead to EAPOLs being sent in high legacy
rates like 54mbps.
It's better to avoid sending EAPOLs in high rates as it reduces
the chances of a successful 4-Way handshake.
Avoid this and treat them like other mgmt frames which would
initially get sent at the basic rate.

	Cc: <stable@vger.kernel.org> [3.13+]
	Signed-off-by: Eyal Shapira <eyalx.shapira@intel.com>
	Reviewed-by: Johannes Berg <johannes.berg@intel.com>
	Signed-off-by: Emmanuel Grumbach <emmanuel.grumbach@intel.com>
(cherry picked from commit aa11bbf3df026d6b1c6b528bef634fd9de7c2619)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/wireless/iwlwifi/mvm/tx.c
diff --cc drivers/net/wireless/iwlwifi/mvm/tx.c
index a2e6112e91e9,9ee410bf6da2..000000000000
--- a/drivers/net/wireless/iwlwifi/mvm/tx.c
+++ b/drivers/net/wireless/iwlwifi/mvm/tx.c
@@@ -171,11 -167,15 +171,20 @@@ static void iwl_mvm_set_tx_cmd_rate(str
  	}
  
  	/*
++<<<<<<< HEAD
 +	 * for data packets, rate info comes from the table inside he fw. This
 +	 * table is controlled by LINK_QUALITY commands
++=======
+ 	 * for data packets, rate info comes from the table inside the fw. This
+ 	 * table is controlled by LINK_QUALITY commands. Exclude ctrl port
+ 	 * frames like EAPOLs which should be treated as mgmt frames. This
+ 	 * avoids them being sent initially in high rates which increases the
+ 	 * chances for completion of the 4-Way handshake.
++>>>>>>> aa11bbf3df02 (iwlwifi: mvm: treat EAPOLs like mgmt frames wrt rate)
  	 */
  
- 	if (ieee80211_is_data(fc) && sta) {
+ 	if (ieee80211_is_data(fc) && sta &&
+ 	    !(info->control.flags & IEEE80211_TX_CTRL_PORT_CTRL_PROTO)) {
  		tx_cmd->initial_rate_index = 0;
  		tx_cmd->tx_flags |= cpu_to_le32(TX_CMD_FLG_STA_RATE);
  		return;
* Unmerged path drivers/net/wireless/iwlwifi/mvm/tx.c
