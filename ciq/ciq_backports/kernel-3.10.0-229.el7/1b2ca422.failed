kvm, cpuid: Fix sparse warning

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-229.el7
Rebuild_CHGLOG: - [virt] kvm/cpuid: Fix sparse warning (Paolo Bonzini) [1116936]
Rebuild_FUZZ: 94.92%
commit-author Borislav Petkov <bp@suse.de>
commit 1b2ca42267fe8c4e909312f2b83dfef882cf6234
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-229.el7/1b2ca422.failed

We need to copy padding to kernel space first before looking at it.

	Reported-by: kbuild test robot <fengguang.wu@intel.com>
	Signed-off-by: Borislav Petkov <bp@suse.de>
	Signed-off-by: Gleb Natapov <gleb@redhat.com>
(cherry picked from commit 1b2ca42267fe8c4e909312f2b83dfef882cf6234)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/x86/kvm/cpuid.c
diff --cc arch/x86/kvm/cpuid.c
index 6d0f9c267421,c6976257eff5..000000000000
--- a/arch/x86/kvm/cpuid.c
+++ b/arch/x86/kvm/cpuid.c
@@@ -535,8 -560,36 +535,41 @@@ static bool is_centaur_cpu(const struc
  	return boot_cpu_data.x86_vendor == X86_VENDOR_CENTAUR;
  }
  
++<<<<<<< HEAD
 +int kvm_dev_ioctl_get_supported_cpuid(struct kvm_cpuid2 *cpuid,
 +				      struct kvm_cpuid_entry2 __user *entries)
++=======
+ static bool sanity_check_entries(struct kvm_cpuid_entry2 __user *entries,
+ 				 __u32 num_entries, unsigned int ioctl_type)
+ {
+ 	int i;
+ 	__u32 pad[3];
+ 
+ 	if (ioctl_type != KVM_GET_EMULATED_CPUID)
+ 		return false;
+ 
+ 	/*
+ 	 * We want to make sure that ->padding is being passed clean from
+ 	 * userspace in case we want to use it for something in the future.
+ 	 *
+ 	 * Sadly, this wasn't enforced for KVM_GET_SUPPORTED_CPUID and so we
+ 	 * have to give ourselves satisfied only with the emulated side. /me
+ 	 * sheds a tear.
+ 	 */
+ 	for (i = 0; i < num_entries; i++) {
+ 		if (copy_from_user(pad, entries[i].padding, sizeof(pad)))
+ 			return true;
+ 
+ 		if (pad[0] || pad[1] || pad[2])
+ 			return true;
+ 	}
+ 	return false;
+ }
+ 
+ int kvm_dev_ioctl_get_cpuid(struct kvm_cpuid2 *cpuid,
+ 			    struct kvm_cpuid_entry2 __user *entries,
+ 			    unsigned int type)
++>>>>>>> 1b2ca42267fe (kvm, cpuid: Fix sparse warning)
  {
  	struct kvm_cpuid_entry2 *cpuid_entries;
  	int limit, nent = 0, r = -E2BIG, i;
* Unmerged path arch/x86/kvm/cpuid.c
