Move cper.c from drivers/acpi/apei to drivers/firmware/efi

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-229.el7
Rebuild_CHGLOG: - [firmware] efi: Move cper.c from drivers/acpi/apei to drivers/firmware/efi (Rui Wang) [1076655]
Rebuild_FUZZ: 95.87%
commit-author Tony Luck <tony.luck@intel.com>
commit 7ea6c6c15ee16f4c7f5eeaa62f77e696f85ae0d1
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-229.el7/7ea6c6c1.failed

cper.c contains code to decode and print "Common Platform Error Records".
Originally added under drivers/acpi/apei because the only user was in that
same directory - but now we have another consumer, and we shouldn't have
to force CONFIG_ACPI_APEI get access to this code.

Since CPER is defined in the UEFI specification - the logical home for
this code is under drivers/firmware/efi/

	Acked-by: Matt Fleming <matt.fleming@intel.com>
	Acked-by: Ingo Molnar <mingo@kernel.org>
	Signed-off-by: Tony Luck <tony.luck@intel.com>
(cherry picked from commit 7ea6c6c15ee16f4c7f5eeaa62f77e696f85ae0d1)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/acpi/Kconfig
diff --cc drivers/acpi/Kconfig
index 100bd724f648,08eadb4a57cb..000000000000
--- a/drivers/acpi/Kconfig
+++ b/drivers/acpi/Kconfig
@@@ -396,4 -372,25 +396,28 @@@ config ACPI_BGR
  
  source "drivers/acpi/apei/Kconfig"
  
++<<<<<<< HEAD
++=======
+ config ACPI_EXTLOG
+ 	tristate "Extended Error Log support"
+ 	depends on X86_MCE
+ 	select EFI
+ 	select UEFI_CPER
+ 	default n
+ 	help
+ 	  Certain usages such as Predictive Failure Analysis (PFA) require
+ 	  more information about the error than what can be described in
+ 	  processor machine check banks. Most server processors log
+ 	  additional information about the error in processor uncore
+ 	  registers. Since the addresses and layout of these registers vary
+ 	  widely from one processor to another, system software cannot
+ 	  readily make use of them. To complicate matters further, some of
+ 	  the additional error information cannot be constructed without
+ 	  detailed knowledge about platform topology.
+ 
+ 	  Enhanced MCA Logging allows firmware to provide additional error
+ 	  information to system software, synchronous with MCE or CMCI. This
+ 	  driver adds support for that functionality.
+ 
++>>>>>>> 7ea6c6c15ee1 (Move cper.c from drivers/acpi/apei to drivers/firmware/efi)
  endif	# ACPI
* Unmerged path drivers/acpi/Kconfig
diff --git a/drivers/acpi/apei/Kconfig b/drivers/acpi/apei/Kconfig
index f0c1ce95a0ec..786294bb682c 100644
--- a/drivers/acpi/apei/Kconfig
+++ b/drivers/acpi/apei/Kconfig
@@ -2,6 +2,8 @@ config ACPI_APEI
 	bool "ACPI Platform Error Interface (APEI)"
 	select MISC_FILESYSTEMS
 	select PSTORE
+	select EFI
+	select UEFI_CPER
 	depends on X86
 	help
 	  APEI allows to report errors (for example from the chipset)
diff --git a/drivers/acpi/apei/Makefile b/drivers/acpi/apei/Makefile
index d1d1bc0a4ee1..5d575a955940 100644
--- a/drivers/acpi/apei/Makefile
+++ b/drivers/acpi/apei/Makefile
@@ -3,4 +3,4 @@ obj-$(CONFIG_ACPI_APEI_GHES)	+= ghes.o
 obj-$(CONFIG_ACPI_APEI_EINJ)	+= einj.o
 obj-$(CONFIG_ACPI_APEI_ERST_DEBUG) += erst-dbg.o
 
-apei-y := apei-base.o hest.o cper.o erst.o
+apei-y := apei-base.o hest.o erst.o
diff --git a/drivers/firmware/efi/Kconfig b/drivers/firmware/efi/Kconfig
index b0fc7c79dfbb..3150aa4874e8 100644
--- a/drivers/firmware/efi/Kconfig
+++ b/drivers/firmware/efi/Kconfig
@@ -36,4 +36,7 @@ config EFI_VARS_PSTORE_DEFAULT_DISABLE
 	  backend for pstore by default. This setting can be overridden
 	  using the efivars module's pstore_disable parameter.
 
+config UEFI_CPER
+	def_bool n
+
 endmenu
diff --git a/drivers/firmware/efi/Makefile b/drivers/firmware/efi/Makefile
index 99245ab5a79c..9ba156d3c775 100644
--- a/drivers/firmware/efi/Makefile
+++ b/drivers/firmware/efi/Makefile
@@ -4,3 +4,4 @@
 obj-y					+= efi.o vars.o
 obj-$(CONFIG_EFI_VARS)			+= efivars.o
 obj-$(CONFIG_EFI_VARS_PSTORE)		+= efi-pstore.o
+obj-$(CONFIG_UEFI_CPER)			+= cper.o
diff --git a/drivers/acpi/apei/cper.c b/drivers/firmware/efi/cper.c
similarity index 100%
rename from drivers/acpi/apei/cper.c
rename to drivers/firmware/efi/cper.c
