cpufreq: Return error if ->get() failed in cpufreq_update_policy()

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-229.el7
Rebuild_CHGLOG: - [cpufreq] Return error if ->get() failed in cpufreq_update_policy() (Prarit Bhargava) [1134369]
Rebuild_FUZZ: 92.68%
commit-author Viresh Kumar <viresh.kumar@linaro.org>
commit bd0fa9bb455d9b58ec2d7a36cd08afed9e3411b4
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-229.el7/bd0fa9bb.failed

cpufreq_update_policy() calls cpufreq_driver->get() to get current
frequency of a CPU and it is not supposed to fail or return zero.
Return error in case that happens.

	Signed-off-by: Viresh Kumar <viresh.kumar@linaro.org>
	Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>
(cherry picked from commit bd0fa9bb455d9b58ec2d7a36cd08afed9e3411b4)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/cpufreq/cpufreq.c
diff --cc drivers/cpufreq/cpufreq.c
index c8bc717e8458,56b7b1be352d..000000000000
--- a/drivers/cpufreq/cpufreq.c
+++ b/drivers/cpufreq/cpufreq.c
@@@ -1937,14 -2138,19 +1937,24 @@@ int cpufreq_update_policy(unsigned int 
  	 * -> ask driver for current freq and notify governors about a change
  	 */
  	if (cpufreq_driver->get) {
++<<<<<<< HEAD
 +		policy.cur = cpufreq_driver->get(cpu);
 +		if (!data->cur) {
++=======
+ 		new_policy.cur = cpufreq_driver->get(cpu);
+ 		if (WARN_ON(!new_policy.cur)) {
+ 			ret = -EIO;
+ 			goto no_policy;
+ 		}
+ 
+ 		if (!policy->cur) {
++>>>>>>> bd0fa9bb455d (cpufreq: Return error if ->get() failed in cpufreq_update_policy())
  			pr_debug("Driver did not initialize current freq");
 -			policy->cur = new_policy.cur;
 +			data->cur = policy.cur;
  		} else {
 -			if (policy->cur != new_policy.cur && has_target())
 -				cpufreq_out_of_sync(cpu, policy->cur,
 -								new_policy.cur);
 +			if (data->cur != policy.cur && cpufreq_driver->target)
 +				cpufreq_out_of_sync(cpu, data->cur,
 +								policy.cur);
  		}
  	}
  
* Unmerged path drivers/cpufreq/cpufreq.c
