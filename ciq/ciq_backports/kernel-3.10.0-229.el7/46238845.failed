mac80211: properly flush delayed scan work on interface removal

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-229.el7
commit-author Johannes Berg <johannes@sipsolutions.net>
commit 46238845bd609a5c0fbe076e1b82b4c5b33360b2
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-229.el7/46238845.failed

When an interface is deleted, an ongoing hardware scan is canceled and
the driver must abort the scan, at the very least reporting completion
while the interface is removed.

However, if it scheduled the work that might only run after everything
is said and done, which leads to cfg80211 warning that the scan isn't
reported as finished yet; this is no fault of the driver, it already
did, but mac80211 hasn't processed it.

To fix this situation, flush the delayed work when the interface being
removed is the one that was executing the scan.

	Cc: stable@vger.kernel.org
	Reported-by: Sujith Manoharan <sujith@msujith.org>
	Tested-by: Sujith Manoharan <sujith@msujith.org>
	Signed-off-by: Johannes Berg <johannes.berg@intel.com>
(cherry picked from commit 46238845bd609a5c0fbe076e1b82b4c5b33360b2)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/mac80211/iface.c
diff --cc net/mac80211/iface.c
index 514e90f470bf,653f5eb07a27..000000000000
--- a/net/mac80211/iface.c
+++ b/net/mac80211/iface.c
@@@ -727,6 -765,8 +727,11 @@@ static void ieee80211_do_stop(struct ie
  	u32 hw_reconf_flags = 0;
  	int i, flushed;
  	struct ps_data *ps;
++<<<<<<< HEAD
++=======
+ 	struct cfg80211_chan_def chandef;
+ 	bool cancel_scan;
++>>>>>>> 46238845bd60 (mac80211: properly flush delayed scan work on interface removal)
  
  	clear_bit(SDATA_STATE_RUNNING, &sdata->state);
  
* Unmerged path net/mac80211/iface.c
