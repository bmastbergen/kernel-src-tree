ppc/kvm: Set the runlatch bit of a CPU just before starting guest

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-229.el7
Rebuild_CHGLOG: - [virt] kvm/ppc: Set the runlatch bit of a CPU just before starting guest (Don Zickus) [1127366]
Rebuild_FUZZ: 93.85%
commit-author Preeti U Murthy <preeti@linux.vnet.ibm.com>
commit fd17dc7b9a8d57150ee0121c4c83edbb7e26eece
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-229.el7/fd17dc7b.failed

The secondary threads in the core are kept offline before launching guests
in kvm on powerpc: "371fefd6f2dc4666:KVM: PPC: Allow book3s_hv guests to use
SMT processor modes."

Hence their runlatch bits are cleared. When the secondary threads are called
in to start a guest, their runlatch bits need to be set to indicate that they
are busy. The primary thread has its runlatch bit set though, but there is no
harm in setting this bit once again. Hence set the runlatch bit for all
threads before they start guest.

	Signed-off-by: Preeti U Murthy <preeti@linux.vnet.ibm.com>
	Acked-by: Paul Mackerras <paulus@samba.org>
	Reviewed-by: Srivatsa S. Bhat <srivatsa.bhat@linux.vnet.ibm.com>
	Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
(cherry picked from commit fd17dc7b9a8d57150ee0121c4c83edbb7e26eece)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/powerpc/kvm/book3s_hv_rmhandlers.S
diff --cc arch/powerpc/kvm/book3s_hv_rmhandlers.S
index 0ae4c28ae4b6,b25407533618..000000000000
--- a/arch/powerpc/kvm/book3s_hv_rmhandlers.S
+++ b/arch/powerpc/kvm/book3s_hv_rmhandlers.S
@@@ -162,8 -242,12 +162,17 @@@ END_FTR_SECTION_IFSET(CPU_FTR_ARCH_206
   */
  	.globl	kvm_start_guest
  kvm_start_guest:
++<<<<<<< HEAD
 +	ld	r1,PACAEMERGSP(r13)
 +	subi	r1,r1,STACK_FRAME_OVERHEAD
++=======
+ 
+ 	/* Set runlatch bit the minute you wake up from nap */
+ 	mfspr	r1, SPRN_CTRLF
+ 	ori 	r1, r1, 1
+ 	mtspr	SPRN_CTRLT, r1
+ 
++>>>>>>> fd17dc7b9a8d (ppc/kvm: Set the runlatch bit of a CPU just before starting guest)
  	ld	r2,PACATOC(r13)
  
  	li	r0,KVM_HWTHREAD_IN_KVM
* Unmerged path arch/powerpc/kvm/book3s_hv_rmhandlers.S
