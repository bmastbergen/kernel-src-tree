drm/radeon/dpm: fix resume on mullins

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-229.el7
Rebuild_CHGLOG: - [drm] radeon/dpm: fix resume on mullins (Rob Clark) [1173317]
Rebuild_FUZZ: 94.29%
commit-author Alex Deucher <alexander.deucher@amd.com>
commit 39da038479a81a35a7f8af3ab2c90effd5c8eff1
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-229.el7/39da0384.failed

Need to properly disable nb dpm on dpm disable.

	Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
	Cc: stable@vger.kernel.org
(cherry picked from commit 39da038479a81a35a7f8af3ab2c90effd5c8eff1)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/gpu/drm/radeon/kv_dpm.c
diff --cc drivers/gpu/drm/radeon/kv_dpm.c
index b41905573cd2,67cb472d188c..000000000000
--- a/drivers/gpu/drm/radeon/kv_dpm.c
+++ b/drivers/gpu/drm/radeon/kv_dpm.c
@@@ -1250,13 -1295,11 +1252,16 @@@ int kv_dpm_enable(struct radeon_device 
  
  void kv_dpm_disable(struct radeon_device *rdev)
  {
 +	cik_update_cg(rdev, (RADEON_CG_BLOCK_GFX |
 +			     RADEON_CG_BLOCK_SDMA |
 +			     RADEON_CG_BLOCK_BIF |
 +			     RADEON_CG_BLOCK_HDP), false);
 +
  	kv_smc_bapm_enable(rdev, false);
  
+ 	if (rdev->family == CHIP_MULLINS)
+ 		kv_enable_nb_dpm(rdev, false);
+ 
  	/* powerup blocks */
  	kv_dpm_powergate_acp(rdev, false);
  	kv_dpm_powergate_samu(rdev, false);
@@@ -1817,8 -1876,9 +1831,13 @@@ int kv_dpm_set_power_state(struct radeo
  				DRM_ERROR("kv_update_vce_dpm failed\n");
  				return ret;
  			}
 +#endif
  			kv_update_sclk_t(rdev);
++<<<<<<< HEAD
++=======
+ 			if (rdev->family == CHIP_MULLINS)
+ 				kv_enable_nb_dpm(rdev, true);
++>>>>>>> 39da038479a8 (drm/radeon/dpm: fix resume on mullins)
  		}
  	} else {
  		if (pi->enable_dpm) {
@@@ -1842,10 -1901,9 +1861,10 @@@
  				DRM_ERROR("kv_update_vce_dpm failed\n");
  				return ret;
  			}
 +#endif
  			kv_update_acp_boot_level(rdev);
  			kv_update_sclk_t(rdev);
- 			kv_enable_nb_dpm(rdev);
+ 			kv_enable_nb_dpm(rdev, true);
  		}
  	}
  
* Unmerged path drivers/gpu/drm/radeon/kv_dpm.c
