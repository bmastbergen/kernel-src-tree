rbd: set the remaining discard properties to enable support

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-229.el7
commit-author Josh Durgin <josh.durgin@inktank.com>
commit b76f82398c1017e303d87760e22125714010207f
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-229.el7/b76f8239.failed

max_discard_sectors must be set for the queue to support discard.
Operations implementing discard for rbd zero data, so report that.

	Signed-off-by: Josh Durgin <josh.durgin@inktank.com>
(cherry picked from commit b76f82398c1017e303d87760e22125714010207f)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/block/rbd.c
diff --cc drivers/block/rbd.c
index 0c349c7388a9,7712ae65753c..000000000000
--- a/drivers/block/rbd.c
+++ b/drivers/block/rbd.c
@@@ -3676,6 -3760,13 +3676,16 @@@ static int rbd_init_disk(struct rbd_dev
  	blk_queue_io_min(q, segment_size);
  	blk_queue_io_opt(q, segment_size);
  
++<<<<<<< HEAD
++=======
+ 	/* enable the discard support */
+ 	queue_flag_set_unlocked(QUEUE_FLAG_DISCARD, q);
+ 	q->limits.discard_granularity = segment_size;
+ 	q->limits.discard_alignment = segment_size;
+ 	q->limits.max_discard_sectors = segment_size / SECTOR_SIZE;
+ 	q->limits.discard_zeroes_data = 1;
+ 
++>>>>>>> b76f82398c10 (rbd: set the remaining discard properties to enable support)
  	blk_queue_merge_bvec(q, rbd_merge_bvec);
  	disk->queue = q;
  
* Unmerged path drivers/block/rbd.c
