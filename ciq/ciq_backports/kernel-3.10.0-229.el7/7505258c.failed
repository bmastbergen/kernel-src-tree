KVM: PPC: Book3S HV: Fix KVM hang with CONFIG_KVM_XICS=n

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-229.el7
Rebuild_CHGLOG: - [virt] kvm/ppc: book3s/hv - Fix KVM hang with CONFIG_KVM_XICS=n (David Gibson) [1123145 1123133 1123367]
Rebuild_FUZZ: 92.86%
commit-author Anton Blanchard <anton@samba.org>
commit 7505258c5fcb0a1cc3c76a47b4cf9506d21d10e6
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-229.el7/7505258c.failed

I noticed KVM is broken when KVM in-kernel XICS emulation
(CONFIG_KVM_XICS) is disabled.

The problem was introduced in 48eaef05 (KVM: PPC: Book3S HV: use
xics_wake_cpu only when defined). It used CONFIG_KVM_XICS to wrap
xics_wake_cpu, where CONFIG_PPC_ICP_NATIVE should have been
used.

	Signed-off-by: Anton Blanchard <anton@samba.org>
	Cc: stable@vger.kernel.org
	Signed-off-by: Paul Mackerras <paulus@samba.org>
	Acked-by: Scott Wood <scottwood@freescale.com>
(cherry picked from commit 7505258c5fcb0a1cc3c76a47b4cf9506d21d10e6)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/powerpc/kvm/book3s_hv.c
diff --cc arch/powerpc/kvm/book3s_hv.c
index 14588bcd5db5,e0a535cdf07b..000000000000
--- a/arch/powerpc/kvm/book3s_hv.c
+++ b/arch/powerpc/kvm/book3s_hv.c
@@@ -1166,11 -1359,10 +1166,18 @@@ static void kvmppc_start_thread(struct 
  	vcpu->cpu = vc->pcpu;
  	smp_wmb();
  #if defined(CONFIG_PPC_ICP_NATIVE) && defined(CONFIG_SMP)
++<<<<<<< HEAD
 +	if (vcpu->arch.ptid) {
 +#ifdef CONFIG_KVM_XICS
 +		xics_wake_cpu(cpu);
 +#endif
 +		++vc->n_woken;
++=======
+ 	if (cpu != smp_processor_id()) {
+ 		xics_wake_cpu(cpu);
+ 		if (vcpu->arch.ptid)
+ 			++vc->n_woken;
++>>>>>>> 7505258c5fcb (KVM: PPC: Book3S HV: Fix KVM hang with CONFIG_KVM_XICS=n)
  	}
  #endif
  }
* Unmerged path arch/powerpc/kvm/book3s_hv.c
