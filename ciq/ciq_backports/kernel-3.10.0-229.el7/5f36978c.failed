tools/perf/build: Simplify the libelf logic

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-229.el7
Rebuild_CHGLOG: - [tools] perf/build: Simplify the libelf logic (Jiri Olsa) [1131394]
Rebuild_FUZZ: 92.50%
commit-author Ingo Molnar <mingo@kernel.org>
commit 5f36978ca5b12b1e35535dedb8c999694fc0dfcf
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-229.el7/5f36978c.failed

Ulrich Drepper and Namhyung Kim reported that the libelf logic in
config/Makefile is duplicated in part.

Remove the duplication, and also remove the now unused FLAGS_LIBELF
variable.

	Reported-by: Ulrich Drepper <drepper@gmail.com>
	Reported-by: Namhyung Kim <namhyung@kernel.org>
	Cc: Arnaldo Carvalho de Melo <acme@redhat.com>
	Cc: Peter Zijlstra <a.p.zijlstra@chello.nl>
	Cc: David Ahern <dsahern@gmail.com>
	Cc: Jiri Olsa <jolsa@redhat.com>
	Signed-off-by: Ingo Molnar <mingo@kernel.org>
	Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>
(cherry picked from commit 5f36978ca5b12b1e35535dedb8c999694fc0dfcf)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	tools/perf/config/Makefile
diff --cc tools/perf/config/Makefile
index 111386e0ab08,d2079220ff87..000000000000
--- a/tools/perf/config/Makefile
+++ b/tools/perf/config/Makefile
@@@ -228,39 -279,31 +228,46 @@@ els
  endif # NO_LIBELF
  
  ifndef NO_LIBELF
++<<<<<<< HEAD
 +CFLAGS += -DLIBELF_SUPPORT
 +FLAGS_LIBELF=$(CFLAGS) $(LDFLAGS) $(EXTLIBS)
 +ifeq ($(call try-cc,$(SOURCE_ELF_MMAP),$(FLAGS_LIBELF),-DLIBELF_MMAP),y)
 +  CFLAGS += -DLIBELF_MMAP
 +endif
 +ifeq ($(call try-cc,$(SOURCE_ELF_GETPHDRNUM),$(FLAGS_LIBELF),-DHAVE_ELF_GETPHDRNUM),y)
 +  CFLAGS += -DHAVE_ELF_GETPHDRNUM
 +endif
++=======
+   CFLAGS += -DHAVE_LIBELF_SUPPORT
++>>>>>>> 5f36978ca5b1 (tools/perf/build: Simplify the libelf logic)
  
 -  ifeq ($(feature-libelf-mmap), 1)
 -    CFLAGS += -DHAVE_LIBELF_MMAP_SUPPORT
 -  endif
 +# include ARCH specific config
 +-include $(src-perf)/arch/$(ARCH)/Makefile
  
 -  ifeq ($(feature-libelf-getphdrnum), 1)
 -    CFLAGS += -DHAVE_ELF_GETPHDRNUM_SUPPORT
 -  endif
 +ifndef NO_DWARF
 +ifeq ($(origin PERF_HAVE_DWARF_REGS), undefined)
 +  msg := $(warning DWARF register mappings have not been defined for architecture $(ARCH), DWARF support disabled);
 +  NO_DWARF := 1
 +else
 +  CFLAGS += -DDWARF_SUPPORT $(LIBDW_CFLAGS)
 +  LDFLAGS += $(LIBDW_LDFLAGS)
 +  EXTLIBS += -lelf -ldw
 +endif # PERF_HAVE_DWARF_REGS
 +endif # NO_DWARF
  
 -  # include ARCH specific config
 -  -include $(src-perf)/arch/$(ARCH)/Makefile
 +endif # NO_LIBELF
  
 -  ifndef NO_DWARF
 -    ifeq ($(origin PERF_HAVE_DWARF_REGS), undefined)
 -      msg := $(warning DWARF register mappings have not been defined for architecture $(ARCH), DWARF support disabled);
 -      NO_DWARF := 1
 -    else
 -      CFLAGS += -DHAVE_DWARF_SUPPORT $(LIBDW_CFLAGS)
 -      LDFLAGS += $(LIBDW_LDFLAGS)
 -      EXTLIBS += -lelf -ldw
 -    endif # PERF_HAVE_DWARF_REGS
 -  endif # NO_DWARF
++<<<<<<< HEAD
 +ifndef NO_LIBELF
 +CFLAGS += -DLIBELF_SUPPORT
 +FLAGS_LIBELF=$(CFLAGS) $(LDFLAGS) $(EXTLIBS)
 +ifeq ($(call try-cc,$(SOURCE_ELF_MMAP),$(FLAGS_LIBELF),-DLIBELF_MMAP),y)
 +  CFLAGS += -DLIBELF_MMAP
 +endif # try-cc
  endif # NO_LIBELF
  
++=======
++>>>>>>> 5f36978ca5b1 (tools/perf/build: Simplify the libelf logic)
  # There's only x86 (both 32 and 64) support for CFI unwind so far
  ifneq ($(ARCH),x86)
    NO_LIBUNWIND := 1
* Unmerged path tools/perf/config/Makefile
