hwrng: Pass entropy to add_hwgenerator_randomness() in bits, not bytes

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-229.el7
Rebuild_CHGLOG: - [hwrng] Pass entropy to add_hwgenerator_randomness() in bits, not bytes (Amit Shah) [1129195]
Rebuild_FUZZ: 94.74%
commit-author Stephen Boyd <sboyd@codeaurora.org>
commit e02b876597777ab26288dd2611a97b597d14d661
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-229.el7/e02b8765.failed

rng_get_data() returns the number of bytes read from the hardware.
The entropy argument to add_hwgenerator_randomness() is passed
directly to credit_entropy_bits() so we should be passing the
number of bits, not bytes here.

Fixes: be4000bc464 "hwrng: create filler thread"
	Acked-by: Torsten Duwe <duwe@suse.de>
	Signed-off-by: Stephen Boyd <sboyd@codeaurora.org>
	Signed-off-by: Theodore Ts'o <tytso@mit.edu>
(cherry picked from commit e02b876597777ab26288dd2611a97b597d14d661)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/char/hw_random/core.c
diff --cc drivers/char/hw_random/core.c
index 74ee3bd1a2d8,33fd6633586d..000000000000
--- a/drivers/char/hw_random/core.c
+++ b/drivers/char/hw_random/core.c
@@@ -320,6 -327,36 +320,39 @@@ err_misc_dereg
  	goto out;
  }
  
++<<<<<<< HEAD
++=======
+ static int hwrng_fillfn(void *unused)
+ {
+ 	long rc;
+ 
+ 	while (!kthread_should_stop()) {
+ 		if (!current_rng)
+ 			break;
+ 		rc = rng_get_data(current_rng, rng_fillbuf,
+ 				  rng_buffer_size(), 1);
+ 		if (rc <= 0) {
+ 			pr_warn("hwrng: no data available\n");
+ 			msleep_interruptible(10000);
+ 			continue;
+ 		}
+ 		add_hwgenerator_randomness((void *)rng_fillbuf, rc,
+ 					   rc * current_quality * 8 >> 10);
+ 	}
+ 	hwrng_fill = NULL;
+ 	return 0;
+ }
+ 
+ static void start_khwrngd(void)
+ {
+ 	hwrng_fill = kthread_run(hwrng_fillfn, NULL, "hwrng");
+ 	if (hwrng_fill == ERR_PTR(-ENOMEM)) {
+ 		pr_err("hwrng_fill thread creation failed");
+ 		hwrng_fill = NULL;
+ 	}
+ }
+ 
++>>>>>>> e02b87659777 (hwrng: Pass entropy to add_hwgenerator_randomness() in bits, not bytes)
  int hwrng_register(struct hwrng *rng)
  {
  	int err = -EINVAL;
* Unmerged path drivers/char/hw_random/core.c
