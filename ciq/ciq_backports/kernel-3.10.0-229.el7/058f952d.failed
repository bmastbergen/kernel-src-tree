tools/perf/build: Split out feature check: 'libunwind'

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-229.el7
Rebuild_CHGLOG: - [tools] perf/build: split out feature check 'libunwind' (Jiri Olsa) [1131394]
Rebuild_FUZZ: 93.07%
commit-author Ingo Molnar <mingo@kernel.org>
commit 058f952de9b3075cd888dc3cea60691db0ec4d3f
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-229.el7/058f952d.failed

	Cc: Arnaldo Carvalho de Melo <acme@redhat.com>
	Cc: Peter Zijlstra <a.p.zijlstra@chello.nl>
	Cc: Namhyung Kim <namhyung@kernel.org>
	Cc: David Ahern <dsahern@gmail.com>
	Cc: Jiri Olsa <jolsa@redhat.com>
Link: http://lkml.kernel.org/n/tip-vTiatsVyva3tfgh3vhxaidxl@git.kernel.org
	Signed-off-by: Ingo Molnar <mingo@kernel.org>
(cherry picked from commit 058f952de9b3075cd888dc3cea60691db0ec4d3f)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	tools/perf/config/Makefile
#	tools/perf/config/feature-checks/Makefile
diff --cc tools/perf/config/Makefile
index 3d5ba297ad91,d684a292536e..000000000000
--- a/tools/perf/config/Makefile
+++ b/tools/perf/config/Makefile
@@@ -111,6 -111,9 +111,12 @@@ FEATURE_TESTS =				
  	libelf				\
  	glibc				\
  	dwarf				\
++<<<<<<< HEAD
++=======
+ 	libelf-mmap			\
+ 	libelf-getphdrnum		\
+ 	libunwind			\
++>>>>>>> 058f952de9b3 (tools/perf/build: Split out feature check: 'libunwind')
  	libnuma
  
  $(foreach test,$(FEATURE_TESTS),$(call feature_check,$(test),$(test)))
diff --cc tools/perf/config/feature-checks/Makefile
index 566a71dd6168,d6d9570a038f..000000000000
--- a/tools/perf/config/feature-checks/Makefile
+++ b/tools/perf/config/feature-checks/Makefile
@@@ -9,6 -9,9 +9,12 @@@ FILES=					
  	test-libelf			\
  	test-glibc			\
  	test-dwarf			\
++<<<<<<< HEAD
++=======
+ 	test-libelf-mmap		\
+ 	test-libelf-getphdrnum		\
+ 	test-libunwind			\
++>>>>>>> 058f952de9b3 (tools/perf/build: Split out feature check: 'libunwind')
  	test-libnuma
  
  CC := $(CC) -MD
* Unmerged path tools/perf/config/Makefile
* Unmerged path tools/perf/config/feature-checks/Makefile
diff --git a/tools/perf/config/feature-checks/test-libunwind.c b/tools/perf/config/feature-checks/test-libunwind.c
new file mode 100644
index 000000000000..562274695c76
--- /dev/null
+++ b/tools/perf/config/feature-checks/test-libunwind.c
@@ -0,0 +1,20 @@
+#include <libunwind.h>
+#include <stdlib.h>
+
+extern int UNW_OBJ(dwarf_search_unwind_table) (unw_addr_space_t as,
+                                      unw_word_t ip,
+                                      unw_dyn_info_t *di,
+                                      unw_proc_info_t *pi,
+                                      int need_unwind_info, void *arg);
+
+
+#define dwarf_search_unwind_table UNW_OBJ(dwarf_search_unwind_table)
+
+int main(void)
+{
+	unw_addr_space_t addr_space;
+	addr_space = unw_create_addr_space(NULL, 0);
+	unw_init_remote(NULL, addr_space, NULL);
+	dwarf_search_unwind_table(addr_space, 0, NULL, NULL, 0, NULL);
+	return 0;
+}
