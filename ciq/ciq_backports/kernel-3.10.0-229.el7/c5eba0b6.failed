openvswitch: distinguish between the dropped and consumed skb

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-229.el7
commit-author Li RongQing <roy.qing.li@gmail.com>
commit c5eba0b6f84eb4f0fdc1d8a4abc1c7d40db6e8a6
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-229.el7/c5eba0b6.failed

distinguish between the dropped and consumed skb, not assume the skb
is consumed always

	Cc: Thomas Graf <tgraf@noironetworks.com>
	Cc: Pravin Shelar <pshelar@nicira.com>
	Signed-off-by: Li RongQing <roy.qing.li@gmail.com>
	Acked-by: Pravin B Shelar <pshelar@nicira.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit c5eba0b6f84eb4f0fdc1d8a4abc1c7d40db6e8a6)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/openvswitch/datapath.c
diff --cc net/openvswitch/datapath.c
index d0df53822f74,91d66b7e64ac..000000000000
--- a/net/openvswitch/datapath.c
+++ b/net/openvswitch/datapath.c
@@@ -241,9 -264,12 +241,18 @@@ void ovs_dp_process_received_packet(str
  		upcall.cmd = OVS_PACKET_CMD_MISS;
  		upcall.key = &key;
  		upcall.userdata = NULL;
++<<<<<<< HEAD
 +		upcall.portid = p->upcall_portid;
 +		ovs_dp_upcall(dp, skb, &upcall);
 +		consume_skb(skb);
++=======
+ 		upcall.portid = ovs_vport_find_upcall_portid(p, skb);
+ 		error = ovs_dp_upcall(dp, skb, &upcall);
+ 		if (unlikely(error))
+ 			kfree_skb(skb);
+ 		else
+ 			consume_skb(skb);
++>>>>>>> c5eba0b6f84e (openvswitch: distinguish between the dropped and consumed skb)
  		stats_counter = &stats->n_missed;
  		goto out;
  	}
* Unmerged path net/openvswitch/datapath.c
