perf tools: Move arch setup into seprate Makefile

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-229.el7
Rebuild_CHGLOG: - [tools] perf: Move arch setup into seprate Makefile (Jiri Olsa) [1133083]
Rebuild_FUZZ: 93.48%
commit-author Jiri Olsa <jolsa@redhat.com>
commit a6cf5f39236c2ea6008a2f5cb908c3181c123096
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-229.el7/a6cf5f39.failed

I need to use arch related setup in the tests/make, so moving arch setup
into Makefile.arch.

	Signed-off-by: Jiri Olsa <jolsa@redhat.com>
	Cc: Corey Ashford <cjashfor@linux.vnet.ibm.com>
	Cc: David Ahern <dsahern@gmail.com>
	Cc: Frederic Weisbecker <fweisbec@gmail.com>
	Cc: Ingo Molnar <mingo@elte.hu>
	Cc: Namhyung Kim <namhyung@kernel.org>
	Cc: Paul Mackerras <paulus@samba.org>
	Cc: Peter Zijlstra <a.p.zijlstra@chello.nl>
Link: http://lkml.kernel.org/r/1388759553-12974-1-git-send-email-jolsa@redhat.com
	Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>
(cherry picked from commit a6cf5f39236c2ea6008a2f5cb908c3181c123096)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	tools/perf/config/Makefile
diff --cc tools/perf/config/Makefile
index 374f88fe17c5,f2bc659d20af..000000000000
--- a/tools/perf/config/Makefile
+++ b/tools/perf/config/Makefile
@@@ -1,53 -1,67 +1,42 @@@
- uname_M := $(shell uname -m 2>/dev/null || echo not)
  
- ARCH ?= $(shell echo $(uname_M) | sed -e s/i.86/i386/ -e s/sun4u/sparc64/ \
-                                   -e s/arm.*/arm/ -e s/sa110/arm/ \
-                                   -e s/s390x/s390/ -e s/parisc64/parisc/ \
-                                   -e s/ppc.*/powerpc/ -e s/mips.*/mips/ \
-                                   -e s/sh[234].*/sh/ -e s/aarch64.*/arm64/ )
- NO_PERF_REGS := 1
- CFLAGS := $(EXTRA_CFLAGS) $(EXTRA_WARNINGS)
+ ifeq ($(src-perf),)
+ src-perf := $(srctree)/tools/perf
+ endif
  
- # Additional ARCH settings for x86
- ifeq ($(ARCH),i386)
-   override ARCH := x86
-   NO_PERF_REGS := 0
-   LIBUNWIND_LIBS = -lunwind -lunwind-x86
+ ifeq ($(obj-perf),)
+ obj-perf := $(OUTPUT)
  endif
  
- ifeq ($(ARCH),x86_64)
-   override ARCH := x86
-   IS_X86_64 := 0
-   ifeq (, $(findstring m32,$(CFLAGS)))
-     IS_X86_64 := $(shell echo __x86_64__ | ${CC} -E -x c - | tail -n 1)
-   endif
+ ifneq ($(obj-perf),)
+ obj-perf := $(abspath $(obj-perf))/
+ endif
+ 
+ LIB_INCLUDE := $(srctree)/tools/lib/
+ CFLAGS := $(EXTRA_CFLAGS) $(EXTRA_WARNINGS)
+ 
+ include $(src-perf)/config/Makefile.arch
+ 
+ NO_PERF_REGS := 1
+ 
+ # Additional ARCH settings for x86
+ ifeq ($(ARCH),x86)
    ifeq (${IS_X86_64}, 1)
++<<<<<<< HEAD
 +    RAW_ARCH := x86_64
 +    CFLAGS += -DARCH_X86_64
++=======
+     CFLAGS += -DHAVE_ARCH_X86_64_SUPPORT
++>>>>>>> a6cf5f39236c (perf tools: Move arch setup into seprate Makefile)
      ARCH_INCLUDE = ../../arch/x86/lib/memcpy_64.S ../../arch/x86/lib/memset_64.S
 -    LIBUNWIND_LIBS = -lunwind -lunwind-x86_64
 -  else
 -    LIBUNWIND_LIBS = -lunwind -lunwind-x86
    endif
    NO_PERF_REGS := 0
 -endif
 -ifeq ($(ARCH),arm)
 -  NO_PERF_REGS := 0
 -  LIBUNWIND_LIBS = -lunwind -lunwind-arm
 -endif
 -
 -ifeq ($(LIBUNWIND_LIBS),)
 -  NO_LIBUNWIND := 1
 -else
 -  #
 -  # For linking with debug library, run like:
 -  #
 -  #   make DEBUG=1 LIBUNWIND_DIR=/opt/libunwind/
 -  #
 -  ifdef LIBUNWIND_DIR
 -    LIBUNWIND_CFLAGS  = -I$(LIBUNWIND_DIR)/include
 -    LIBUNWIND_LDFLAGS = -L$(LIBUNWIND_DIR)/lib
 -  endif
 -  LIBUNWIND_LDFLAGS += $(LIBUNWIND_LIBS)
 -
 -  # Set per-feature check compilation flags
 -  FEATURE_CHECK_CFLAGS-libunwind = $(LIBUNWIND_CFLAGS)
 -  FEATURE_CHECK_LDFLAGS-libunwind = $(LIBUNWIND_LDFLAGS)
 -  FEATURE_CHECK_CFLAGS-libunwind-debug-frame = $(LIBUNWIND_CFLAGS)
 -  FEATURE_CHECK_LDFLAGS-libunwind-debug-frame = $(LIBUNWIND_LDFLAGS)
 -  #  and the flags for the test-all case
 -  FEATURE_CHECK_CFLAGS-all += $(LIBUNWIND_CFLAGS)
 -  FEATURE_CHECK_LDFLAGS-all += $(LIBUNWIND_LDFLAGS)
 +  LIBUNWIND_LIBS = -lunwind -lunwind-x86_64
  endif
  
  ifeq ($(NO_PERF_REGS),0)
 -  CFLAGS += -DHAVE_PERF_REGS_SUPPORT
 +  CFLAGS += -DHAVE_PERF_REGS
  endif
  
- ifeq ($(src-perf),)
- src-perf := $(srctree)/tools/perf
- endif
- 
- ifeq ($(obj-perf),)
- obj-perf := $(OUTPUT)
- endif
- 
- ifneq ($(obj-perf),)
- obj-perf := $(abspath $(obj-perf))/
- endif
- 
- LIB_INCLUDE := $(srctree)/tools/lib/
- 
  # include ARCH specific config
  -include $(src-perf)/arch/$(ARCH)/Makefile
  
* Unmerged path tools/perf/config/Makefile
diff --git a/tools/perf/config/Makefile.arch b/tools/perf/config/Makefile.arch
new file mode 100644
index 000000000000..fef8ae922800
--- /dev/null
+++ b/tools/perf/config/Makefile.arch
@@ -0,0 +1,22 @@
+
+uname_M := $(shell uname -m 2>/dev/null || echo not)
+
+ARCH ?= $(shell echo $(uname_M) | sed -e s/i.86/i386/ -e s/sun4u/sparc64/ \
+                                  -e s/arm.*/arm/ -e s/sa110/arm/ \
+                                  -e s/s390x/s390/ -e s/parisc64/parisc/ \
+                                  -e s/ppc.*/powerpc/ -e s/mips.*/mips/ \
+                                  -e s/sh[234].*/sh/ -e s/aarch64.*/arm64/ )
+
+# Additional ARCH settings for x86
+ifeq ($(ARCH),i386)
+  override ARCH := x86
+endif
+
+ifeq ($(ARCH),x86_64)
+  override ARCH := x86
+  IS_X86_64 := 0
+  ifeq (, $(findstring m32,$(CFLAGS)))
+    IS_X86_64 := $(shell echo __x86_64__ | ${CC} -E -x c - | tail -n 1)
+    RAW_ARCH := x86_64
+  endif
+endif
