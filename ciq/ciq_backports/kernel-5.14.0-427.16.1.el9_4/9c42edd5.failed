EDAC/amd64: Add support for AMD heterogeneous Family 19h Model 30h-3Fh

jira LE-1907
Rebuild_History Non-Buildable kernel-5.14.0-427.16.1.el9_4
commit-author Muralidhara M K <muralidhara.mk@amd.com>
commit 9c42edd571aa4f8b2125b71e3924eeb0f6a54af1
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-5.14.0-427.16.1.el9_4/9c42edd5.failed

AMD Family 19h Model 30h-3Fh systems can be connected to AMD MI200
accelerator/GPU devices such that the CPU and GPU data fabrics are
connected together. In this configuration, the CPU manages error logging
and reporting for MCA banks located on the GPUs. This includes HBM memory
errors reported from Unified Memory Controllers (UMCs) on the GPUs.
The GPU memory errors are handled like CPU memory errors.

AMD CPU UMC support in EDAC can be re-used for GPU UMC support. However,
keeping them separate means drastic changes in one path (e.g. to support
newer products) should have less impact on the other path.

Also, simplify the "gpu_" helper functions where possible. GPU product
configuration, like memory type and channel count, is fixed compared to
CPU products.

GPU UMCs each have four physical connections (phys) connected to eight
channels. There is a single "chip select". This differs from CPUs where
each UMC has one physical connection connected to one channel, and each
channel has up to four "chip selects".

Enumerate each UMC "phy" as an EDAC CSROW, since there is only a single
chip select for each physical connection. This is similar to how a CPU
UMC "phy" is enumerated as an EDAC CHANNEL, since there is only a single
channel for each physical connection.

	Signed-off-by: Muralidhara M K <muralidhara.mk@amd.com>
Co-developed-by: Naveen Krishna Chatradhi <naveenkrishna.chatradhi@amd.com>
	Signed-off-by: Naveen Krishna Chatradhi <naveenkrishna.chatradhi@amd.com>
Co-developed-by: Yazen Ghannam <yazen.ghannam@amd.com>
	Signed-off-by: Yazen Ghannam <yazen.ghannam@amd.com>
	Signed-off-by: Borislav Petkov (AMD) <bp@alien8.de>
Link: https://lore.kernel.org/r/20230515113537.1052146-5-muralimk@amd.com
(cherry picked from commit 9c42edd571aa4f8b2125b71e3924eeb0f6a54af1)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/edac/amd64_edac.c
diff --cc drivers/edac/amd64_edac.c
index 1a04fd81d40a,28155b01f144..000000000000
--- a/drivers/edac/amd64_edac.c
+++ b/drivers/edac/amd64_edac.c
@@@ -3817,13 -4045,18 +4049,28 @@@ static int per_family_init(struct amd64
  		case 0x20 ... 0x2f:
  			pvt->ctl_name			= "F19h_M20h";
  			break;
++<<<<<<< HEAD
 +		case 0x60 ... 0x6f:
 +			pvt->ctl_name                   = "F19h_M60h";
 +			pvt->flags.zn_regs_v2           = 1;
 +			break;
 +		case 0x70 ... 0x7f:
 +			pvt->ctl_name                   = "F19h_M70h";
 +			pvt->flags.zn_regs_v2           = 1;
++=======
+ 		case 0x30 ... 0x3f:
+ 			if (pvt->F3->device == PCI_DEVICE_ID_AMD_MI200_DF_F3) {
+ 				pvt->ctl_name		= "MI200";
+ 				pvt->max_mcs		= 4;
+ 				pvt->ops		= &gpu_ops;
+ 			} else {
+ 				pvt->ctl_name		= "F19h_M30h";
+ 				pvt->max_mcs		= 8;
+ 			}
+ 			break;
+ 		case 0x50 ... 0x5f:
+ 			pvt->ctl_name			= "F19h_M50h";
++>>>>>>> 9c42edd571aa (EDAC/amd64: Add support for AMD heterogeneous Family 19h Model 30h-3Fh)
  			break;
  		case 0xa0 ... 0xaf:
  			pvt->ctl_name			= "F19h_MA0h";
* Unmerged path drivers/edac/amd64_edac.c
