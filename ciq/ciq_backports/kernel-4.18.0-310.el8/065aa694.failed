i40e: use minimal Tx and Rx pairs for kdump

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-310.el8
commit-author Coiby Xu <coxu@redhat.com>
commit 065aa694a76e213d5774eeb70a9c11b8cf0dfdb7
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-310.el8/065aa694.failed

Set the number of the MSI-X vectors to 1. When MSI-X is enabled,
it's not allowed to use more TC queue pairs than MSI-X vectors
(pf->num_lan_msix) exist. Thus the number of Tx and Rx pairs
(vsi->num_queue_pairs) will be equal to the number of MSI-X vectors,
i.e., 1.

	Signed-off-by: Coiby Xu <coxu@redhat.com>
	Tested-by: Dave Switzer <david.switzer@intel.com>
	Signed-off-by: Tony Nguyen <anthony.l.nguyen@intel.com>
(cherry picked from commit 065aa694a76e213d5774eeb70a9c11b8cf0dfdb7)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/intel/i40e/i40e_main.c
diff --cc drivers/net/ethernet/intel/i40e/i40e_main.c
index 99c2dc6d9d6f,b51b8e25501d..000000000000
--- a/drivers/net/ethernet/intel/i40e/i40e_main.c
+++ b/drivers/net/ethernet/intel/i40e/i40e_main.c
@@@ -15181,6 -15507,22 +15182,25 @@@ static int i40e_probe(struct pci_dev *p
  	if (err)
  		goto err_switch_setup;
  
++<<<<<<< HEAD
++=======
+ 	/* Reduce Tx and Rx pairs for kdump
+ 	 * When MSI-X is enabled, it's not allowed to use more TC queue
+ 	 * pairs than MSI-X vectors (pf->num_lan_msix) exist. Thus
+ 	 * vsi->num_queue_pairs will be equal to pf->num_lan_msix, i.e., 1.
+ 	 */
+ 	if (is_kdump_kernel())
+ 		pf->num_lan_msix = 1;
+ 
+ 	pf->udp_tunnel_nic.set_port = i40e_udp_tunnel_set_port;
+ 	pf->udp_tunnel_nic.unset_port = i40e_udp_tunnel_unset_port;
+ 	pf->udp_tunnel_nic.flags = UDP_TUNNEL_NIC_INFO_MAY_SLEEP;
+ 	pf->udp_tunnel_nic.shared = &pf->udp_tunnel_shared;
+ 	pf->udp_tunnel_nic.tables[0].n_entries = I40E_MAX_PF_UDP_OFFLOAD_PORTS;
+ 	pf->udp_tunnel_nic.tables[0].tunnel_types = UDP_TUNNEL_TYPE_VXLAN |
+ 						    UDP_TUNNEL_TYPE_GENEVE;
+ 
++>>>>>>> 065aa694a76e (i40e: use minimal Tx and Rx pairs for kdump)
  	/* The number of VSIs reported by the FW is the minimum guaranteed
  	 * to us; HW supports far more and we share the remaining pool with
  	 * the other PFs. We allocate space for more than the guarantee with
* Unmerged path drivers/net/ethernet/intel/i40e/i40e_main.c
