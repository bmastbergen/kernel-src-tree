dm table: fix zoned iterate_devices based device capability checks

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-310.el8
commit-author Jeffle Xu <jefflexu@linux.alibaba.com>
commit 24f6b6036c9eec21191646930ad42808e6180510
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-310.el8/24f6b603.failed

Fix dm_table_supports_zoned_model() and invert logic of both
iterate_devices_callout_fn so that all devices' zoned capabilities are
properly checked.

Add one more parameter to dm_table_any_dev_attr(), which is actually
used as the @data parameter of iterate_devices_callout_fn, so that
dm_table_matches_zone_sectors() can be replaced by
dm_table_any_dev_attr().

Fixes: dd88d313bef02 ("dm table: add zoned block devices validation")
	Cc: stable@vger.kernel.org
	Signed-off-by: Jeffle Xu <jefflexu@linux.alibaba.com>
	Signed-off-by: Mike Snitzer <snitzer@redhat.com>
(cherry picked from commit 24f6b6036c9eec21191646930ad42808e6180510)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/md/dm-table.c
diff --cc drivers/md/dm-table.c
index 27df037ce2ef,77086db8b920..000000000000
--- a/drivers/md/dm-table.c
+++ b/drivers/md/dm-table.c
@@@ -1879,10 -1836,10 +1862,15 @@@ void dm_table_set_restrictions(struct d
  	 * them as well.  Only targets that support iterate_devices are considered:
  	 * don't want error, zero, etc to require stable pages.
  	 */
++<<<<<<< HEAD
 +	if (dm_table_any_dev_attr(t, device_requires_stable_pages))
 +		q->backing_dev_info->capabilities |= BDI_CAP_STABLE_WRITES;
++=======
+ 	if (dm_table_any_dev_attr(t, device_requires_stable_pages, NULL))
+ 		blk_queue_flag_set(QUEUE_FLAG_STABLE_WRITES, q);
++>>>>>>> 24f6b6036c9e (dm table: fix zoned iterate_devices based device capability checks)
  	else
 -		blk_queue_flag_clear(QUEUE_FLAG_STABLE_WRITES, q);
 +		q->backing_dev_info->capabilities &= ~BDI_CAP_STABLE_WRITES;
  
  	/*
  	 * Determine whether or not this queue's I/O timings contribute
* Unmerged path drivers/md/dm-table.c
