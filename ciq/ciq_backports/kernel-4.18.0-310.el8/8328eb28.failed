block: remove the disk argument to delete_partition

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-310.el8
commit-author Christoph Hellwig <hch@lst.de>
commit 8328eb28369a7dbfab6ff26366dbe8094425acc4
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-310.el8/8328eb28.failed

We can trivially derive the gendisk from the hd_struct.

	Signed-off-by: Christoph Hellwig <hch@lst.de>
	Signed-off-by: Jens Axboe <axboe@kernel.dk>
(cherry picked from commit 8328eb28369a7dbfab6ff26366dbe8094425acc4)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	block/partitions/core.c
diff --cc block/partitions/core.c
index 9e97e6d9a3bd,dd6811422a87..000000000000
--- a/block/partitions/core.c
+++ b/block/partitions/core.c
@@@ -323,7 -330,11 +324,15 @@@ void delete_partition(struct hd_struct 
  	struct disk_part_tbl *ptbl =
  		rcu_dereference_protected(disk->part_tbl, 1);
  
++<<<<<<< HEAD
 +	get_device(disk_to_dev(part_to_disk(part)));
++=======
+ 	/*
+ 	 * ->part_tbl is referenced in this part's release handler, so
+ 	 *  we have to hold the disk device
+ 	 */
+ 	get_device(disk_to_dev(disk));
++>>>>>>> 8328eb28369a (block: remove the disk argument to delete_partition)
  	rcu_assign_pointer(ptbl->part[part->partno], NULL);
  	kobject_put(part->holder_dir);
  	device_del(part_to_dev(part));
diff --git a/block/blk.h b/block/blk.h
index ab5a1d796429..a436ae11b4ea 100644
--- a/block/blk.h
+++ b/block/blk.h
@@ -351,7 +351,7 @@ char *disk_name(struct gendisk *hd, int partno, char *buf);
 #define ADDPART_FLAG_NONE	0
 #define ADDPART_FLAG_RAID	1
 #define ADDPART_FLAG_WHOLEDISK	2
-void delete_partition(struct gendisk *disk, struct hd_struct *part);
+void delete_partition(struct hd_struct *part);
 int bdev_add_partition(struct block_device *bdev, int partno,
 		sector_t start, sector_t length);
 int bdev_del_partition(struct block_device *bdev, int partno);
diff --git a/block/genhd.c b/block/genhd.c
index 8e5e6135fdc2..221dedb749b1 100644
--- a/block/genhd.c
+++ b/block/genhd.c
@@ -898,7 +898,7 @@ void del_gendisk(struct gendisk *disk)
 			     DISK_PITER_INCL_EMPTY | DISK_PITER_REVERSE);
 	while ((part = disk_part_iter_next(&piter))) {
 		invalidate_partition(disk, part->partno);
-		delete_partition(disk, part);
+		delete_partition(part);
 	}
 	disk_part_iter_exit(&piter);
 
* Unmerged path block/partitions/core.c
