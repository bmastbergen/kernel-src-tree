nvme: fix incorrect behavior when BLKROSET is called by the user

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-310.el8
commit-author Sagi Grimberg <sagi@grimberg.me>
commit 65c5a055b0d567b7e7639d942c0605da9cc54c5e
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-310.el8/65c5a055.failed

The offending commit breaks BLKROSET ioctl because a device
revalidation will blindly override BLKROSET setting. Hence,
we remove the disk rw setting in case NVME_NS_ATTR_RO is cleared
from by the controller.

Fixes: 1293477f4f32 ("nvme: set gendisk read only based on nsattr")
	Signed-off-by: Sagi Grimberg <sagi@grimberg.me>
	Signed-off-by: Christoph Hellwig <hch@lst.de>
(cherry picked from commit 65c5a055b0d567b7e7639d942c0605da9cc54c5e)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/nvme/host/core.c
diff --cc drivers/nvme/host/core.c
index f7db72db297a,9b01afcb7777..000000000000
--- a/drivers/nvme/host/core.c
+++ b/drivers/nvme/host/core.c
@@@ -2037,10 -2060,6 +2037,13 @@@ static void nvme_update_disk_info(struc
  
  	if (id->nsattr & NVME_NS_ATTR_RO)
  		set_disk_ro(disk, true);
++<<<<<<< HEAD
 +	else
 +		set_disk_ro(disk, false);
 +
 +	blk_mq_unfreeze_queue(disk->queue);
++=======
++>>>>>>> 65c5a055b0d5 (nvme: fix incorrect behavior when BLKROSET is called by the user)
  }
  
  static inline bool nvme_first_scan(struct gendisk *disk)
* Unmerged path drivers/nvme/host/core.c
