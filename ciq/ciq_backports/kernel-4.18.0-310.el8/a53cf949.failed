net/mlx5: E-switch, Read controller number from device

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-310.el8
commit-author Parav Pandit <parav@nvidia.com>
commit a53cf9497a1683ae49f870d066b693ceea5e517f
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-310.el8/a53cf949.failed

ECPF supports one external host controller. Read controller number
from the device.

	Signed-off-by: Parav Pandit <parav@nvidia.com>
	Reviewed-by: Roi Dayan <roid@nvidia.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit a53cf9497a1683ae49f870d066b693ceea5e517f)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/mellanox/mlx5/core/eswitch_offloads.c
diff --cc drivers/net/ethernet/mellanox/mlx5/core/eswitch_offloads.c
index e5a3f150d717,b381cbca5852..000000000000
--- a/drivers/net/ethernet/mellanox/mlx5/core/eswitch_offloads.c
+++ b/drivers/net/ethernet/mellanox/mlx5/core/eswitch_offloads.c
@@@ -2142,12 -2142,9 +2160,18 @@@ int esw_offloads_enable(struct mlx5_esw
  	mutex_init(&esw->offloads.termtbl_mutex);
  	mlx5_rdma_enable_roce(esw->dev);
  
++<<<<<<< HEAD
 +	if (esw_use_vport_metadata(esw))
 +		esw->flags |= MLX5_ESWITCH_VPORT_MATCH_METADATA;
 +
 +	err = esw_offloads_metadata_init(esw);
 +	if (err)
 +		goto err_metadata;
++=======
+ 	err = mlx5_esw_host_number_init(esw);
+ 	if (err)
+ 		goto err_vport_metadata;
++>>>>>>> a53cf9497a16 (net/mlx5: E-switch, Read controller number from device)
  
  	err = esw_set_passing_vport_metadata(esw, true);
  	if (err)
diff --git a/drivers/net/ethernet/mellanox/mlx5/core/eswitch.h b/drivers/net/ethernet/mellanox/mlx5/core/eswitch.h
index 26684f1d82ab..441c7a95ec39 100644
--- a/drivers/net/ethernet/mellanox/mlx5/core/eswitch.h
+++ b/drivers/net/ethernet/mellanox/mlx5/core/eswitch.h
@@ -217,6 +217,7 @@ struct mlx5_esw_offload {
 	atomic64_t num_flows;
 	enum devlink_eswitch_encap_mode encap;
 	struct ida vport_metadata_ida;
+	unsigned int host_number; /* ECPF supports one external host */
 };
 
 /* E-Switch MC FDB table hash node */
* Unmerged path drivers/net/ethernet/mellanox/mlx5/core/eswitch_offloads.c
