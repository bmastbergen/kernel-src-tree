devlink: have genetlink code to parse the attrs during dumpit

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-310.el8
commit-author Jiri Pirko <jiri@mellanox.com>
commit ee85da535fe30e02908d30ec6b8960c4a991cb2d
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-310.el8/ee85da53.failed

Benefit from the fact that the generic netlink code can parse the attrs
for dumpit op and avoid need to parse it in the op callback.

	Signed-off-by: Jiri Pirko <jiri@mellanox.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit ee85da535fe30e02908d30ec6b8960c4a991cb2d)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/core/devlink.c
diff --cc net/core/devlink.c
index f205b9e289c8,22f59461b0c1..000000000000
--- a/net/core/devlink.c
+++ b/net/core/devlink.c
@@@ -4475,12 -3943,14 +4475,22 @@@ static int devlink_nl_region_read_snaps
  static int devlink_nl_cmd_region_read_dumpit(struct sk_buff *skb,
  					     struct netlink_callback *cb)
  {
++<<<<<<< HEAD
 +	u64 ret_offset, start_offset, end_offset = U64_MAX;
++=======
+ 	const struct genl_dumpit_info *info = genl_dumpit_info(cb);
+ 	u64 ret_offset, start_offset, end_offset = 0;
+ 	struct nlattr **attrs = info->attrs;
++>>>>>>> ee85da535fe3 (devlink: have genetlink code to parse the attrs during dumpit)
  	struct devlink_region *region;
  	struct nlattr *chunks_attr;
  	const char *region_name;
  	struct devlink *devlink;
++<<<<<<< HEAD
 +	struct nlattr **attrs;
++=======
+ 	bool dump = true;
++>>>>>>> ee85da535fe3 (devlink: have genetlink code to parse the attrs during dumpit)
  	void *hdr;
  	int err;
  
@@@ -7339,9 -6126,12 +7321,10 @@@ static const struct genl_ops devlink_nl
  	},
  	{
  		.cmd = DEVLINK_CMD_REGION_READ,
- 		.validate = GENL_DONT_VALIDATE_STRICT | GENL_DONT_VALIDATE_DUMP,
+ 		.validate = GENL_DONT_VALIDATE_STRICT |
+ 			    GENL_DONT_VALIDATE_DUMP_STRICT,
  		.dumpit = devlink_nl_cmd_region_read_dumpit,
  		.flags = GENL_ADMIN_PERM,
 -		.internal_flags = DEVLINK_NL_FLAG_NEED_DEVLINK,
  	},
  	{
  		.cmd = DEVLINK_CMD_INFO_GET,
* Unmerged path net/core/devlink.c
