dm: simplify target code conditional on CONFIG_BLK_DEV_ZONED

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-310.el8
commit-author Mike Snitzer <snitzer@redhat.com>
commit e3290b9491ff5b7ee40f9e0a4c06821988a2a2bf
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-310.el8/e3290b94.failed

Allow removal of CONFIG_BLK_DEV_ZONED conditionals in target_type
definition of various targets.

	Suggested-by: Eric Biggers <ebiggers@google.com>
	Signed-off-by: Mike Snitzer <snitzer@redhat.com>
(cherry picked from commit e3290b9491ff5b7ee40f9e0a4c06821988a2a2bf)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/md/dm-crypt.c
#	drivers/md/dm-flakey.c
#	drivers/md/dm-linear.c
#	include/linux/device-mapper.h
diff --cc drivers/md/dm-crypt.c
index 4df101bfae0f,ae0f0a4e3689..000000000000
--- a/drivers/md/dm-crypt.c
+++ b/drivers/md/dm-crypt.c
@@@ -2913,6 -3133,21 +2913,24 @@@ static int crypt_ctr_optional(struct dm
  	return 0;
  }
  
++<<<<<<< HEAD
++=======
+ #ifdef CONFIG_BLK_DEV_ZONED
+ static int crypt_report_zones(struct dm_target *ti,
+ 		struct dm_report_zones_args *args, unsigned int nr_zones)
+ {
+ 	struct crypt_config *cc = ti->private;
+ 	sector_t sector = cc->start + dm_target_offset(ti, args->next_sector);
+ 
+ 	args->start = cc->start;
+ 	return blkdev_report_zones(cc->dev->bdev, sector, nr_zones,
+ 				   dm_report_zones_cb, args);
+ }
+ #else
+ #define crypt_report_zones NULL
+ #endif
+ 
++>>>>>>> e3290b9491ff (dm: simplify target code conditional on CONFIG_BLK_DEV_ZONED)
  /*
   * Construct an encryption mapping:
   * <cipher> [<key>|:<key_size>:<user|logon>:<key_description>] <iv_offset> <dev_path> <start>
@@@ -3329,6 -3580,8 +3347,11 @@@ static struct target_type crypt_target 
  	.module = THIS_MODULE,
  	.ctr    = crypt_ctr,
  	.dtr    = crypt_dtr,
++<<<<<<< HEAD
++=======
+ 	.features = DM_TARGET_ZONED_HM,
+ 	.report_zones = crypt_report_zones,
++>>>>>>> e3290b9491ff (dm: simplify target code conditional on CONFIG_BLK_DEV_ZONED)
  	.map    = crypt_map,
  	.status = crypt_status,
  	.postsuspend = crypt_postsuspend,
diff --cc drivers/md/dm-flakey.c
index a2cc9e45cbba,b7fee9936f05..000000000000
--- a/drivers/md/dm-flakey.c
+++ b/drivers/md/dm-flakey.c
@@@ -481,10 -483,8 +483,15 @@@ static int flakey_iterate_devices(struc
  static struct target_type flakey_target = {
  	.name   = "flakey",
  	.version = {1, 5, 0},
++<<<<<<< HEAD
 +#ifdef CONFIG_BLK_DEV_ZONED
 +	.features = DM_TARGET_ZONED_HM,
 +	.report_zones = flakey_report_zones,
 +#endif
++=======
+ 	.features = DM_TARGET_ZONED_HM | DM_TARGET_PASSES_CRYPTO,
+ 	.report_zones = flakey_report_zones,
++>>>>>>> e3290b9491ff (dm: simplify target code conditional on CONFIG_BLK_DEV_ZONED)
  	.module = THIS_MODULE,
  	.ctr    = flakey_ctr,
  	.dtr    = flakey_dtr,
diff --cc drivers/md/dm-linear.c
index 00774b5d7668,92db0f5e7f28..000000000000
--- a/drivers/md/dm-linear.c
+++ b/drivers/md/dm-linear.c
@@@ -227,13 -229,9 +229,15 @@@ static int linear_dax_zero_page_range(s
  static struct target_type linear_target = {
  	.name   = "linear",
  	.version = {1, 4, 0},
- #ifdef CONFIG_BLK_DEV_ZONED
  	.features = DM_TARGET_PASSES_INTEGRITY | DM_TARGET_NOWAIT |
 -		    DM_TARGET_ZONED_HM | DM_TARGET_PASSES_CRYPTO,
 +		    DM_TARGET_ZONED_HM,
  	.report_zones = linear_report_zones,
++<<<<<<< HEAD
 +#else
 +	.features = DM_TARGET_PASSES_INTEGRITY | DM_TARGET_NOWAIT,
 +#endif
++=======
++>>>>>>> e3290b9491ff (dm: simplify target code conditional on CONFIG_BLK_DEV_ZONED)
  	.module = THIS_MODULE,
  	.ctr    = linear_ctr,
  	.dtr    = linear_dtr,
diff --cc include/linux/device-mapper.h
index b7b09d593b1e,c98d847b0f0b..000000000000
--- a/include/linux/device-mapper.h
+++ b/include/linux/device-mapper.h
@@@ -186,9 -196,7 +195,11 @@@ struct target_type 
  	dm_status_fn status;
  	dm_message_fn message;
  	dm_prepare_ioctl_fn prepare_ioctl;
++<<<<<<< HEAD
 +#if 1 /* CONFIG_BLK_DEV_ZONED */
++=======
++>>>>>>> e3290b9491ff (dm: simplify target code conditional on CONFIG_BLK_DEV_ZONED)
  	dm_report_zones_fn report_zones;
- #endif
  	dm_busy_fn busy;
  	dm_iterate_devices_fn iterate_devices;
  	dm_io_hints_fn io_hints;
* Unmerged path drivers/md/dm-crypt.c
* Unmerged path drivers/md/dm-flakey.c
* Unmerged path drivers/md/dm-linear.c
* Unmerged path include/linux/device-mapper.h
