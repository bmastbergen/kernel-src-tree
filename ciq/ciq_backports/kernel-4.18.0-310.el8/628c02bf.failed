RDMA: Remove uverbs cmds from drivers that don't use them

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-310.el8
commit-author Jason Gunthorpe <jgg@nvidia.com>
commit 628c02bf38aa42c09c3dde61284ba348290e6650
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-310.el8/628c02bf.failed

Allowing userspace to invoke these commands is probably going to crash
these drivers as they are not tested and not expecting to use them on a
user object.

For example pvrdma touches cq->ring_state which is not initialized for
user QPs.

These commands are effected:

- IB_USER_VERBS_CMD_REQ_NOTIFY_CQ is ibv_cmd_req_notify_cq() in
  rdma-core, only hfi1, ipath and rxe calls it.

- IB_USER_VERBS_CMD_POLL_CQ is ibv_cmd_poll_cq() in rdma-core, only
  ipath and hfi1 calls it.

- IB_USER_VERBS_CMD_POST_SEND/RECV is ibv_cmd_post_send/recv() in
  rdma-core, only ipath and hfi1 call them.

- IB_USER_VERBS_CMD_POST_SRQ_RECV is ibv_cmd_post_srq_recv() in
  rdma-core, only ipath and hfi1 calls it.

- IB_USER_VERBS_CMD_PEEK_CQ isn't even implemented anywhere

- IB_USER_VERBS_CMD_CREATE/DESTROY_AH is ibv_cmd_create/destroy_ah() in
  rdma-core, only bnxt_re, efa, hfi1, ipath, mlx5, orcrdma, and rxe call
  it.

Link: https://lore.kernel.org/r/10-v1-caa70ba3d1ab+1436e-ucmd_mask_jgg@nvidia.com
	Signed-off-by: Jason Gunthorpe <jgg@nvidia.com>
(cherry picked from commit 628c02bf38aa42c09c3dde61284ba348290e6650)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/infiniband/hw/cxgb4/provider.c
#	drivers/infiniband/hw/hns/hns_roce_main.c
#	drivers/infiniband/hw/i40iw/i40iw_verbs.c
#	drivers/infiniband/hw/ocrdma/ocrdma_main.c
#	drivers/infiniband/hw/qedr/main.c
#	drivers/infiniband/hw/vmw_pvrdma/pvrdma_main.c
#	drivers/infiniband/sw/rxe/rxe_verbs.c
#	drivers/infiniband/sw/siw/siw_main.c
diff --cc drivers/infiniband/hw/cxgb4/provider.c
index 14acc29b648f,8a3c0a0041a8..000000000000
--- a/drivers/infiniband/hw/cxgb4/provider.c
+++ b/drivers/infiniband/hw/cxgb4/provider.c
@@@ -531,28 -531,6 +531,31 @@@ void c4iw_register_device(struct work_s
  	if (fastreg_support)
  		dev->device_cap_flags |= IB_DEVICE_MEM_MGT_EXTENSIONS;
  	dev->ibdev.local_dma_lkey = 0;
++<<<<<<< HEAD
 +	dev->ibdev.uverbs_cmd_mask =
 +	    (1ull << IB_USER_VERBS_CMD_GET_CONTEXT) |
 +	    (1ull << IB_USER_VERBS_CMD_QUERY_DEVICE) |
 +	    (1ull << IB_USER_VERBS_CMD_QUERY_PORT) |
 +	    (1ull << IB_USER_VERBS_CMD_ALLOC_PD) |
 +	    (1ull << IB_USER_VERBS_CMD_DEALLOC_PD) |
 +	    (1ull << IB_USER_VERBS_CMD_REG_MR) |
 +	    (1ull << IB_USER_VERBS_CMD_DEREG_MR) |
 +	    (1ull << IB_USER_VERBS_CMD_CREATE_COMP_CHANNEL) |
 +	    (1ull << IB_USER_VERBS_CMD_CREATE_CQ) |
 +	    (1ull << IB_USER_VERBS_CMD_DESTROY_CQ) |
 +	    (1ull << IB_USER_VERBS_CMD_REQ_NOTIFY_CQ) |
 +	    (1ull << IB_USER_VERBS_CMD_CREATE_QP) |
 +	    (1ull << IB_USER_VERBS_CMD_MODIFY_QP) |
 +	    (1ull << IB_USER_VERBS_CMD_QUERY_QP) |
 +	    (1ull << IB_USER_VERBS_CMD_POLL_CQ) |
 +	    (1ull << IB_USER_VERBS_CMD_DESTROY_QP) |
 +	    (1ull << IB_USER_VERBS_CMD_POST_SEND) |
 +	    (1ull << IB_USER_VERBS_CMD_POST_RECV) |
 +	    (1ull << IB_USER_VERBS_CMD_CREATE_SRQ) |
 +	    (1ull << IB_USER_VERBS_CMD_MODIFY_SRQ) |
 +	    (1ull << IB_USER_VERBS_CMD_DESTROY_SRQ);
++=======
++>>>>>>> 628c02bf38aa (RDMA: Remove uverbs cmds from drivers that don't use them)
  	dev->ibdev.node_type = RDMA_NODE_RNIC;
  	BUILD_BUG_ON(sizeof(C4IW_NODE_DESC) > IB_DEVICE_NODE_DESC_MAX);
  	memcpy(dev->ibdev.node_desc, C4IW_NODE_DESC, sizeof(C4IW_NODE_DESC));
diff --cc drivers/infiniband/hw/hns/hns_roce_main.c
index 8b1f50f7c10f,6d2c383c4d64..000000000000
--- a/drivers/infiniband/hw/hns/hns_roce_main.c
+++ b/drivers/infiniband/hw/hns/hns_roce_main.c
@@@ -470,34 -485,28 +470,50 @@@ static int hns_roce_register_device(str
  
  	ib_dev = &hr_dev->ib_dev;
  
 -	ib_dev->node_type = RDMA_NODE_IB_CA;
 -	ib_dev->dev.parent = dev;
 -
 -	ib_dev->phys_port_cnt = hr_dev->caps.num_ports;
 -	ib_dev->local_dma_lkey = hr_dev->caps.reserved_lkey;
 -	ib_dev->num_comp_vectors = hr_dev->caps.num_comp_vectors;
 -
 -	if (hr_dev->caps.flags & HNS_ROCE_CAP_FLAG_REREG_MR)
 +	ib_dev->node_type		= RDMA_NODE_IB_CA;
 +	ib_dev->dev.parent		= dev;
 +
 +	ib_dev->phys_port_cnt		= hr_dev->caps.num_ports;
 +	ib_dev->local_dma_lkey		= hr_dev->caps.reserved_lkey;
 +	ib_dev->num_comp_vectors	= hr_dev->caps.num_comp_vectors;
 +	ib_dev->uverbs_cmd_mask		=
 +		(1ULL << IB_USER_VERBS_CMD_GET_CONTEXT) |
 +		(1ULL << IB_USER_VERBS_CMD_QUERY_DEVICE) |
 +		(1ULL << IB_USER_VERBS_CMD_QUERY_PORT) |
 +		(1ULL << IB_USER_VERBS_CMD_ALLOC_PD) |
 +		(1ULL << IB_USER_VERBS_CMD_DEALLOC_PD) |
 +		(1ULL << IB_USER_VERBS_CMD_REG_MR) |
 +		(1ULL << IB_USER_VERBS_CMD_DEREG_MR) |
 +		(1ULL << IB_USER_VERBS_CMD_CREATE_COMP_CHANNEL) |
 +		(1ULL << IB_USER_VERBS_CMD_CREATE_CQ) |
 +		(1ULL << IB_USER_VERBS_CMD_DESTROY_CQ) |
 +		(1ULL << IB_USER_VERBS_CMD_CREATE_QP) |
 +		(1ULL << IB_USER_VERBS_CMD_MODIFY_QP) |
 +		(1ULL << IB_USER_VERBS_CMD_QUERY_QP) |
 +		(1ULL << IB_USER_VERBS_CMD_DESTROY_QP);
 +
 +	ib_dev->uverbs_ex_cmd_mask |=
 +		(1ULL << IB_USER_VERBS_EX_CMD_MODIFY_CQ);
 +
 +	if (hr_dev->caps.flags & HNS_ROCE_CAP_FLAG_REREG_MR) {
 +		ib_dev->uverbs_cmd_mask |= (1ULL << IB_USER_VERBS_CMD_REREG_MR);
  		ib_set_device_ops(ib_dev, &hns_roce_dev_mr_ops);
++<<<<<<< HEAD
++=======
+ 
+ 	/* MW */
+ 	if (hr_dev->caps.flags & HNS_ROCE_CAP_FLAG_MW)
+ 		ib_set_device_ops(ib_dev, &hns_roce_dev_mw_ops);
+ 
+ 	/* FRMR */
+ 	if (hr_dev->caps.flags & HNS_ROCE_CAP_FLAG_FRMR)
+ 		ib_set_device_ops(ib_dev, &hns_roce_dev_frmr_ops);
+ 
+ 	/* SRQ */
+ 	if (hr_dev->caps.flags & HNS_ROCE_CAP_FLAG_SRQ) {
+ 		ib_set_device_ops(ib_dev, &hns_roce_dev_srq_ops);
+ 		ib_set_device_ops(ib_dev, hr_dev->hw->hns_roce_dev_srq_ops);
++>>>>>>> 628c02bf38aa (RDMA: Remove uverbs cmds from drivers that don't use them)
  	}
  
  	ib_set_device_ops(ib_dev, hr_dev->hw->hns_roce_dev_ops);
diff --cc drivers/infiniband/hw/i40iw/i40iw_verbs.c
index f03d9769941c,85d40686588e..000000000000
--- a/drivers/infiniband/hw/i40iw/i40iw_verbs.c
+++ b/drivers/infiniband/hw/i40iw/i40iw_verbs.c
@@@ -2688,27 -2690,6 +2688,30 @@@ static struct i40iw_ib_device *i40iw_in
  	iwibdev->ibdev.node_type = RDMA_NODE_RNIC;
  	ether_addr_copy((u8 *)&iwibdev->ibdev.node_guid, netdev->dev_addr);
  
++<<<<<<< HEAD
 +	iwibdev->ibdev.uverbs_cmd_mask =
 +	    (1ull << IB_USER_VERBS_CMD_GET_CONTEXT) |
 +	    (1ull << IB_USER_VERBS_CMD_QUERY_DEVICE) |
 +	    (1ull << IB_USER_VERBS_CMD_QUERY_PORT) |
 +	    (1ull << IB_USER_VERBS_CMD_ALLOC_PD) |
 +	    (1ull << IB_USER_VERBS_CMD_DEALLOC_PD) |
 +	    (1ull << IB_USER_VERBS_CMD_REG_MR) |
 +	    (1ull << IB_USER_VERBS_CMD_DEREG_MR) |
 +	    (1ull << IB_USER_VERBS_CMD_CREATE_COMP_CHANNEL) |
 +	    (1ull << IB_USER_VERBS_CMD_CREATE_CQ) |
 +	    (1ull << IB_USER_VERBS_CMD_DESTROY_CQ) |
 +	    (1ull << IB_USER_VERBS_CMD_REQ_NOTIFY_CQ) |
 +	    (1ull << IB_USER_VERBS_CMD_CREATE_QP) |
 +	    (1ull << IB_USER_VERBS_CMD_MODIFY_QP) |
 +	    (1ull << IB_USER_VERBS_CMD_QUERY_QP) |
 +	    (1ull << IB_USER_VERBS_CMD_POLL_CQ) |
 +	    (1ull << IB_USER_VERBS_CMD_CREATE_AH) |
 +	    (1ull << IB_USER_VERBS_CMD_DESTROY_AH) |
 +	    (1ull << IB_USER_VERBS_CMD_DESTROY_QP) |
 +	    (1ull << IB_USER_VERBS_CMD_POST_RECV) |
 +	    (1ull << IB_USER_VERBS_CMD_POST_SEND);
++=======
++>>>>>>> 628c02bf38aa (RDMA: Remove uverbs cmds from drivers that don't use them)
  	iwibdev->ibdev.phys_port_cnt = 1;
  	iwibdev->ibdev.num_comp_vectors = iwdev->ceqs_count;
  	iwibdev->ibdev.dev.parent = &pcidev->dev;
diff --cc drivers/infiniband/hw/ocrdma/ocrdma_main.c
index c15cfc6cef81,5e67cd66359a..000000000000
--- a/drivers/infiniband/hw/ocrdma/ocrdma_main.c
+++ b/drivers/infiniband/hw/ocrdma/ocrdma_main.c
@@@ -205,26 -204,6 +205,29 @@@ static int ocrdma_register_device(struc
  	BUILD_BUG_ON(sizeof(OCRDMA_NODE_DESC) > IB_DEVICE_NODE_DESC_MAX);
  	memcpy(dev->ibdev.node_desc, OCRDMA_NODE_DESC,
  	       sizeof(OCRDMA_NODE_DESC));
++<<<<<<< HEAD
 +	dev->ibdev.uverbs_cmd_mask =
 +	    OCRDMA_UVERBS(GET_CONTEXT) |
 +	    OCRDMA_UVERBS(QUERY_DEVICE) |
 +	    OCRDMA_UVERBS(QUERY_PORT) |
 +	    OCRDMA_UVERBS(ALLOC_PD) |
 +	    OCRDMA_UVERBS(DEALLOC_PD) |
 +	    OCRDMA_UVERBS(REG_MR) |
 +	    OCRDMA_UVERBS(DEREG_MR) |
 +	    OCRDMA_UVERBS(CREATE_COMP_CHANNEL) |
 +	    OCRDMA_UVERBS(CREATE_CQ) |
 +	    OCRDMA_UVERBS(RESIZE_CQ) |
 +	    OCRDMA_UVERBS(DESTROY_CQ) |
 +	    OCRDMA_UVERBS(REQ_NOTIFY_CQ) |
 +	    OCRDMA_UVERBS(CREATE_QP) |
 +	    OCRDMA_UVERBS(MODIFY_QP) |
 +	    OCRDMA_UVERBS(QUERY_QP) |
 +	    OCRDMA_UVERBS(DESTROY_QP) |
 +	    OCRDMA_UVERBS(POLL_CQ) |
 +	    OCRDMA_UVERBS(POST_SEND) |
 +	    OCRDMA_UVERBS(POST_RECV);
++=======
++>>>>>>> 628c02bf38aa (RDMA: Remove uverbs cmds from drivers that don't use them)
  
  	dev->ibdev.uverbs_cmd_mask |=
  	    OCRDMA_UVERBS(CREATE_AH) |
@@@ -241,16 -220,9 +244,20 @@@
  
  	ib_set_device_ops(&dev->ibdev, &ocrdma_dev_ops);
  
++<<<<<<< HEAD
 +	if (ocrdma_get_asic_type(dev) == OCRDMA_ASIC_GEN_SKH_R) {
 +		dev->ibdev.uverbs_cmd_mask |=
 +		     OCRDMA_UVERBS(CREATE_SRQ) |
 +		     OCRDMA_UVERBS(MODIFY_SRQ) |
 +		     OCRDMA_UVERBS(QUERY_SRQ) |
 +		     OCRDMA_UVERBS(DESTROY_SRQ) |
 +		     OCRDMA_UVERBS(POST_SRQ_RECV);
 +
++=======
+ 	if (ocrdma_get_asic_type(dev) == OCRDMA_ASIC_GEN_SKH_R)
++>>>>>>> 628c02bf38aa (RDMA: Remove uverbs cmds from drivers that don't use them)
  		ib_set_device_ops(&dev->ibdev, &ocrdma_dev_srq_ops);
- 	}
+ 
  	rdma_set_device_sysfs_group(&dev->ibdev, &ocrdma_attr_group);
  	ret = ib_device_set_netdev(&dev->ibdev, dev->nic_info.netdev, 1);
  	if (ret)
diff --cc drivers/infiniband/hw/qedr/main.c
index bf098224e118,cc711c61d9b3..000000000000
--- a/drivers/infiniband/hw/qedr/main.c
+++ b/drivers/infiniband/hw/qedr/main.c
@@@ -249,31 -245,6 +249,34 @@@ static int qedr_register_device(struct 
  	dev->ibdev.node_guid = dev->attr.node_guid;
  	memcpy(dev->ibdev.node_desc, QEDR_NODE_DESC, sizeof(QEDR_NODE_DESC));
  
++<<<<<<< HEAD
 +	dev->ibdev.uverbs_cmd_mask = QEDR_UVERBS(GET_CONTEXT) |
 +				     QEDR_UVERBS(QUERY_DEVICE) |
 +				     QEDR_UVERBS(QUERY_PORT) |
 +				     QEDR_UVERBS(ALLOC_PD) |
 +				     QEDR_UVERBS(DEALLOC_PD) |
 +				     QEDR_UVERBS(CREATE_COMP_CHANNEL) |
 +				     QEDR_UVERBS(CREATE_CQ) |
 +				     QEDR_UVERBS(RESIZE_CQ) |
 +				     QEDR_UVERBS(DESTROY_CQ) |
 +				     QEDR_UVERBS(REQ_NOTIFY_CQ) |
 +				     QEDR_UVERBS(CREATE_QP) |
 +				     QEDR_UVERBS(MODIFY_QP) |
 +				     QEDR_UVERBS(QUERY_QP) |
 +				     QEDR_UVERBS(DESTROY_QP) |
 +				     QEDR_UVERBS(CREATE_SRQ) |
 +				     QEDR_UVERBS(DESTROY_SRQ) |
 +				     QEDR_UVERBS(QUERY_SRQ) |
 +				     QEDR_UVERBS(MODIFY_SRQ) |
 +				     QEDR_UVERBS(POST_SRQ_RECV) |
 +				     QEDR_UVERBS(REG_MR) |
 +				     QEDR_UVERBS(DEREG_MR) |
 +				     QEDR_UVERBS(POLL_CQ) |
 +				     QEDR_UVERBS(POST_SEND) |
 +				     QEDR_UVERBS(POST_RECV);
 +
++=======
++>>>>>>> 628c02bf38aa (RDMA: Remove uverbs cmds from drivers that don't use them)
  	if (IS_IWARP(dev)) {
  		rc = qedr_iw_register_device(dev);
  		if (rc)
diff --cc drivers/infiniband/hw/vmw_pvrdma/pvrdma_main.c
index 10e67283b9db,a86b4f7c9c6e..000000000000
--- a/drivers/infiniband/hw/vmw_pvrdma/pvrdma_main.c
+++ b/drivers/infiniband/hw/vmw_pvrdma/pvrdma_main.c
@@@ -205,27 -205,6 +205,30 @@@ static int pvrdma_register_device(struc
  	dev->flags = 0;
  	dev->ib_dev.num_comp_vectors = 1;
  	dev->ib_dev.dev.parent = &dev->pdev->dev;
++<<<<<<< HEAD
 +	dev->ib_dev.uverbs_cmd_mask =
 +		(1ull << IB_USER_VERBS_CMD_GET_CONTEXT)		|
 +		(1ull << IB_USER_VERBS_CMD_QUERY_DEVICE)	|
 +		(1ull << IB_USER_VERBS_CMD_QUERY_PORT)		|
 +		(1ull << IB_USER_VERBS_CMD_ALLOC_PD)		|
 +		(1ull << IB_USER_VERBS_CMD_DEALLOC_PD)		|
 +		(1ull << IB_USER_VERBS_CMD_REG_MR)		|
 +		(1ull << IB_USER_VERBS_CMD_DEREG_MR)		|
 +		(1ull << IB_USER_VERBS_CMD_CREATE_COMP_CHANNEL)	|
 +		(1ull << IB_USER_VERBS_CMD_CREATE_CQ)		|
 +		(1ull << IB_USER_VERBS_CMD_POLL_CQ)		|
 +		(1ull << IB_USER_VERBS_CMD_REQ_NOTIFY_CQ)	|
 +		(1ull << IB_USER_VERBS_CMD_DESTROY_CQ)		|
 +		(1ull << IB_USER_VERBS_CMD_CREATE_QP)		|
 +		(1ull << IB_USER_VERBS_CMD_MODIFY_QP)		|
 +		(1ull << IB_USER_VERBS_CMD_QUERY_QP)		|
 +		(1ull << IB_USER_VERBS_CMD_DESTROY_QP)		|
 +		(1ull << IB_USER_VERBS_CMD_POST_SEND)		|
 +		(1ull << IB_USER_VERBS_CMD_POST_RECV)		|
 +		(1ull << IB_USER_VERBS_CMD_CREATE_AH)		|
 +		(1ull << IB_USER_VERBS_CMD_DESTROY_AH);
++=======
++>>>>>>> 628c02bf38aa (RDMA: Remove uverbs cmds from drivers that don't use them)
  
  	dev->ib_dev.node_type = RDMA_NODE_IB_CA;
  	dev->ib_dev.phys_port_cnt = dev->dsr->caps.phys_port_cnt;
@@@ -249,13 -228,6 +252,16 @@@
  
  	/* Check if SRQ is supported by backend */
  	if (dev->dsr->caps.max_srq) {
++<<<<<<< HEAD
 +		dev->ib_dev.uverbs_cmd_mask |=
 +			(1ull << IB_USER_VERBS_CMD_CREATE_SRQ)	|
 +			(1ull << IB_USER_VERBS_CMD_MODIFY_SRQ)	|
 +			(1ull << IB_USER_VERBS_CMD_QUERY_SRQ)	|
 +			(1ull << IB_USER_VERBS_CMD_DESTROY_SRQ)	|
 +			(1ull << IB_USER_VERBS_CMD_POST_SRQ_RECV);
 +
++=======
++>>>>>>> 628c02bf38aa (RDMA: Remove uverbs cmds from drivers that don't use them)
  		ib_set_device_ops(&dev->ib_dev, &pvrdma_dev_srq_ops);
  
  		dev->srq_tbl = kcalloc(dev->dsr->caps.max_srq,
diff --cc drivers/infiniband/sw/rxe/rxe_verbs.c
index 6f655b55dded,b3323c305a63..000000000000
--- a/drivers/infiniband/sw/rxe/rxe_verbs.c
+++ b/drivers/infiniband/sw/rxe/rxe_verbs.c
@@@ -1126,38 -1137,12 +1126,43 @@@ int rxe_register_device(struct rxe_dev 
  	dev->local_dma_lkey = 0;
  	addrconf_addr_eui48((unsigned char *)&dev->node_guid,
  			    rxe->ndev->dev_addr);
 +	dev->dev.dma_ops = &dma_virt_ops;
  	dev->dev.dma_parms = &rxe->dma_parms;
 -	dma_set_max_seg_size(&dev->dev, UINT_MAX);
 -	dma_set_coherent_mask(&dev->dev, dma_get_required_mask(&dev->dev));
 -
 +	rxe->dma_parms = (struct device_dma_parameters)
 +		{ .max_segment_size = SZ_2G };
 +	dma_coerce_mask_and_coherent(&dev->dev,
 +				     dma_get_required_mask(&dev->dev));
 +
++<<<<<<< HEAD
 +	dev->uverbs_cmd_mask = BIT_ULL(IB_USER_VERBS_CMD_GET_CONTEXT)
 +	    | BIT_ULL(IB_USER_VERBS_CMD_CREATE_COMP_CHANNEL)
 +	    | BIT_ULL(IB_USER_VERBS_CMD_QUERY_DEVICE)
 +	    | BIT_ULL(IB_USER_VERBS_CMD_QUERY_PORT)
 +	    | BIT_ULL(IB_USER_VERBS_CMD_ALLOC_PD)
 +	    | BIT_ULL(IB_USER_VERBS_CMD_DEALLOC_PD)
 +	    | BIT_ULL(IB_USER_VERBS_CMD_CREATE_SRQ)
 +	    | BIT_ULL(IB_USER_VERBS_CMD_MODIFY_SRQ)
 +	    | BIT_ULL(IB_USER_VERBS_CMD_QUERY_SRQ)
 +	    | BIT_ULL(IB_USER_VERBS_CMD_DESTROY_SRQ)
 +	    | BIT_ULL(IB_USER_VERBS_CMD_POST_SRQ_RECV)
 +	    | BIT_ULL(IB_USER_VERBS_CMD_CREATE_QP)
 +	    | BIT_ULL(IB_USER_VERBS_CMD_MODIFY_QP)
 +	    | BIT_ULL(IB_USER_VERBS_CMD_QUERY_QP)
 +	    | BIT_ULL(IB_USER_VERBS_CMD_DESTROY_QP)
 +	    | BIT_ULL(IB_USER_VERBS_CMD_POST_SEND)
 +	    | BIT_ULL(IB_USER_VERBS_CMD_POST_RECV)
 +	    | BIT_ULL(IB_USER_VERBS_CMD_CREATE_CQ)
 +	    | BIT_ULL(IB_USER_VERBS_CMD_RESIZE_CQ)
 +	    | BIT_ULL(IB_USER_VERBS_CMD_DESTROY_CQ)
 +	    | BIT_ULL(IB_USER_VERBS_CMD_POLL_CQ)
 +	    | BIT_ULL(IB_USER_VERBS_CMD_PEEK_CQ)
 +	    | BIT_ULL(IB_USER_VERBS_CMD_REQ_NOTIFY_CQ)
 +	    | BIT_ULL(IB_USER_VERBS_CMD_REG_MR)
 +	    | BIT_ULL(IB_USER_VERBS_CMD_DEREG_MR)
++=======
+ 	dev->uverbs_cmd_mask |=
+ 	    BIT_ULL(IB_USER_VERBS_CMD_REQ_NOTIFY_CQ)
++>>>>>>> 628c02bf38aa (RDMA: Remove uverbs cmds from drivers that don't use them)
  	    | BIT_ULL(IB_USER_VERBS_CMD_CREATE_AH)
  	    | BIT_ULL(IB_USER_VERBS_CMD_MODIFY_AH)
  	    | BIT_ULL(IB_USER_VERBS_CMD_QUERY_AH)
diff --cc drivers/infiniband/sw/siw/siw_main.c
index 3b707def889f,e49faefdee92..000000000000
--- a/drivers/infiniband/sw/siw/siw_main.c
+++ b/drivers/infiniband/sw/siw/siw_main.c
@@@ -346,30 -346,6 +346,33 @@@ static struct siw_device *siw_device_cr
  		addrconf_addr_eui48((unsigned char *)&base_dev->node_guid,
  				    addr);
  	}
++<<<<<<< HEAD
 +	base_dev->uverbs_cmd_mask =
 +		(1ull << IB_USER_VERBS_CMD_QUERY_DEVICE) |
 +		(1ull << IB_USER_VERBS_CMD_QUERY_PORT) |
 +		(1ull << IB_USER_VERBS_CMD_GET_CONTEXT) |
 +		(1ull << IB_USER_VERBS_CMD_ALLOC_PD) |
 +		(1ull << IB_USER_VERBS_CMD_DEALLOC_PD) |
 +		(1ull << IB_USER_VERBS_CMD_REG_MR) |
 +		(1ull << IB_USER_VERBS_CMD_DEREG_MR) |
 +		(1ull << IB_USER_VERBS_CMD_CREATE_COMP_CHANNEL) |
 +		(1ull << IB_USER_VERBS_CMD_CREATE_CQ) |
 +		(1ull << IB_USER_VERBS_CMD_POLL_CQ) |
 +		(1ull << IB_USER_VERBS_CMD_REQ_NOTIFY_CQ) |
 +		(1ull << IB_USER_VERBS_CMD_DESTROY_CQ) |
 +		(1ull << IB_USER_VERBS_CMD_CREATE_QP) |
 +		(1ull << IB_USER_VERBS_CMD_QUERY_QP) |
 +		(1ull << IB_USER_VERBS_CMD_MODIFY_QP) |
 +		(1ull << IB_USER_VERBS_CMD_DESTROY_QP) |
 +		(1ull << IB_USER_VERBS_CMD_POST_SEND) |
 +		(1ull << IB_USER_VERBS_CMD_POST_RECV) |
 +		(1ull << IB_USER_VERBS_CMD_CREATE_SRQ) |
 +		(1ull << IB_USER_VERBS_CMD_POST_SRQ_RECV) |
 +		(1ull << IB_USER_VERBS_CMD_MODIFY_SRQ) |
 +		(1ull << IB_USER_VERBS_CMD_QUERY_SRQ) |
 +		(1ull << IB_USER_VERBS_CMD_DESTROY_SRQ);
++=======
++>>>>>>> 628c02bf38aa (RDMA: Remove uverbs cmds from drivers that don't use them)
  
  	base_dev->node_type = RDMA_NODE_RNIC;
  	memcpy(base_dev->node_desc, SIW_NODE_DESC_COMMON,
* Unmerged path drivers/infiniband/hw/cxgb4/provider.c
* Unmerged path drivers/infiniband/hw/hns/hns_roce_main.c
* Unmerged path drivers/infiniband/hw/i40iw/i40iw_verbs.c
* Unmerged path drivers/infiniband/hw/ocrdma/ocrdma_main.c
* Unmerged path drivers/infiniband/hw/qedr/main.c
* Unmerged path drivers/infiniband/hw/vmw_pvrdma/pvrdma_main.c
* Unmerged path drivers/infiniband/sw/rxe/rxe_verbs.c
* Unmerged path drivers/infiniband/sw/siw/siw_main.c
