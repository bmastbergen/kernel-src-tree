KVM: nSVM: do not copy vmcb01->control blindly to vmcb02->control

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-310.el8
commit-author Paolo Bonzini <pbonzini@redhat.com>
commit 7c3ecfcd31936e85aa6eb90156d07308b899a76f
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-310.el8/7c3ecfcd.failed

Most fields were going to be overwritten by vmcb12 control fields, or
do not matter at all because they are filled by the processor on vmexit.
Therefore, we need not copy them from vmcb01 to vmcb02 on vmentry.

	Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>
(cherry picked from commit 7c3ecfcd31936e85aa6eb90156d07308b899a76f)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/x86/kvm/svm/nested.c
diff --cc arch/x86/kvm/svm/nested.c
index 93c8c786ad5c,366147fb3c68..000000000000
--- a/arch/x86/kvm/svm/nested.c
+++ b/arch/x86/kvm/svm/nested.c
@@@ -400,6 -428,28 +400,31 @@@ static void nested_prepare_vmcb_control
  {
  	const u32 mask = V_INTR_MASKING_MASK | V_GIF_ENABLE_MASK | V_GIF_MASK;
  
++<<<<<<< HEAD
++=======
+ 	/*
+ 	 * Filled at exit: exit_code, exit_code_hi, exit_info_1, exit_info_2,
+ 	 * exit_int_info, exit_int_info_err, next_rip, insn_len, insn_bytes.
+ 	 */
+ 
+ 	/*
+ 	 * Also covers avic_vapic_bar, avic_backing_page, avic_logical_id,
+ 	 * avic_physical_id.
+ 	 */
+ 	WARN_ON(svm->vmcb01.ptr->control.int_ctl & AVIC_ENABLE_MASK);
+ 
+ 	/* Copied from vmcb01.  msrpm_base can be overwritten later.  */
+ 	svm->vmcb->control.nested_ctl = svm->vmcb01.ptr->control.nested_ctl;
+ 	svm->vmcb->control.iopm_base_pa = svm->vmcb01.ptr->control.iopm_base_pa;
+ 	svm->vmcb->control.msrpm_base_pa = svm->vmcb01.ptr->control.msrpm_base_pa;
+ 
+ 	/* Done at vmrun: asid.  */
+ 
+ 	/* Also overwritten later if necessary.  */
+ 	svm->vmcb->control.tlb_ctl = TLB_CONTROL_DO_NOTHING;
+ 
+ 	/* nested_cr3.  */
++>>>>>>> 7c3ecfcd3193 (KVM: nSVM: do not copy vmcb01->control blindly to vmcb02->control)
  	if (nested_npt_enabled(svm))
  		nested_svm_init_mmu_context(&svm->vcpu);
  
* Unmerged path arch/x86/kvm/svm/nested.c
