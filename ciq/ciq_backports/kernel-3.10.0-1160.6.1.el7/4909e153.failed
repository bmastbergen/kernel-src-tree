scsi: qedf: Stop sending fipvlan request on unload

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1160.6.1.el7
commit-author Saurav Kashyap <skashyap@marvell.com>
commit 4909e153e608360702ad34f76f72190bfaec3d9d
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1160.6.1.el7/4909e153.failed

 - On some setups fipvlan can be retried for long duration and the
   connection to switch was not there so it was not getting any reply.

 - During unload this thread was hanging.

Problem Resolution:

Check if unload is in progress, then quit from fipvlan thread.

	Signed-off-by: Saurav Kashyap <skashyap@marvell.com>
	Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
(cherry picked from commit 4909e153e608360702ad34f76f72190bfaec3d9d)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/scsi/qedf/qedf_main.c
diff --cc drivers/scsi/qedf/qedf_main.c
index f7957aae36d3,2d69860d1f06..000000000000
--- a/drivers/scsi/qedf/qedf_main.c
+++ b/drivers/scsi/qedf/qedf_main.c
@@@ -131,8 -128,16 +131,19 @@@ static bool qedf_initiate_fipvlan_req(s
  			return false;
  		}
  
++<<<<<<< HEAD
 +		if (qedf->vlan_id > 0)
++=======
+ 		if (test_bit(QEDF_UNLOADING, &qedf->flags)) {
+ 			QEDF_ERR(&qedf->dbg_ctx, "Driver unloading.\n");
+ 			return false;
+ 		}
+ 
+ 		if (qedf->vlan_id > 0) {
+ 			QEDF_INFO(&qedf->dbg_ctx, QEDF_LOG_DISC,
+ 				  "vlan = 0x%x already set.\n", qedf->vlan_id);
++>>>>>>> 4909e153e608 (scsi: qedf: Stop sending fipvlan request on unload)
  			return true;
 -		}
  
  		QEDF_INFO(&(qedf->dbg_ctx), QEDF_LOG_DISC,
  			   "Retry %d.\n", qedf->fipvlan_retries);
* Unmerged path drivers/scsi/qedf/qedf_main.c
