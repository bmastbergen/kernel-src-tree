ALSA: hda/realtek - Fix speakers on Acer Predator Helios 500 Ryzen laptops

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-147.el8
commit-author Bernhard Rosenkraenzer <bero@lindev.ch>
commit e2a829b3da01b9b32c4d0291d042b8a6e2a98ca3
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-147.el8/e2a829b3.failed

On an Acer Predator Helios 500 (Ryzen version), the laptop's speakers
don't work out of the box.

The problem can be worked around with hdajackretask, remapping the
"Black Headphone, Right side" pin (0x21) to the Internal speaker.

This patch adds a quirk to change this mapping by default.

[ corrected ALC299_FIXUP_PREDATOR_SPK definition and adapted for the
  latest tree by tiwai ]

	Signed-off-by: Bernhard Rosenkraenzer <bero@lindev.ch>
	Signed-off-by: Takashi Iwai <tiwai@suse.de>
(cherry picked from commit e2a829b3da01b9b32c4d0291d042b8a6e2a98ca3)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	sound/pci/hda/patch_realtek.c
diff --cc sound/pci/hda/patch_realtek.c
index 0befe0bf47fe,a3fb3d4c5730..000000000000
--- a/sound/pci/hda/patch_realtek.c
+++ b/sound/pci/hda/patch_realtek.c
@@@ -5692,6 -5684,12 +5692,15 @@@ enum 
  	ALC285_FIXUP_LENOVO_PC_BEEP_IN_NOISE,
  	ALC255_FIXUP_ACER_HEADSET_MIC,
  	ALC295_FIXUP_CHROME_BOOK,
++<<<<<<< HEAD
++=======
+ 	ALC225_FIXUP_DELL_WYSE_AIO_MIC_NO_PRESENCE,
+ 	ALC225_FIXUP_WYSE_AUTO_MUTE,
+ 	ALC225_FIXUP_WYSE_DISABLE_MIC_VREF,
+ 	ALC286_FIXUP_ACER_AIO_HEADSET_MIC,
+ 	ALC256_FIXUP_ASUS_MIC_NO_PRESENCE,
+ 	ALC299_FIXUP_PREDATOR_SPK,
++>>>>>>> e2a829b3da01 (ALSA: hda/realtek - Fix speakers on Acer Predator Helios 500 Ryzen laptops)
  };
  
  static const struct hda_fixup alc269_fixups[] = {
@@@ -6638,12 -6666,54 +6647,19 @@@
  		.chained = true,
  		.chain_id = ALC255_FIXUP_HEADSET_MODE_NO_HP_MIC
  	},
 -	[ALC225_FIXUP_DELL_WYSE_AIO_MIC_NO_PRESENCE] = {
 -		.type = HDA_FIXUP_PINS,
 -		.v.pins = (const struct hda_pintbl[]) {
 -			{ 0x16, 0x01011020 }, /* Rear Line out */
 -			{ 0x19, 0x01a1913c }, /* use as Front headset mic, without its own jack detect */
 -			{ }
 -		},
 -		.chained = true,
 -		.chain_id = ALC225_FIXUP_WYSE_AUTO_MUTE
 -	},
 -	[ALC225_FIXUP_WYSE_AUTO_MUTE] = {
 -		.type = HDA_FIXUP_FUNC,
 -		.v.func = alc_fixup_auto_mute_via_amp,
 -		.chained = true,
 -		.chain_id = ALC225_FIXUP_WYSE_DISABLE_MIC_VREF
 -	},
 -	[ALC225_FIXUP_WYSE_DISABLE_MIC_VREF] = {
 +	[ALC295_FIXUP_CHROME_BOOK] = {
  		.type = HDA_FIXUP_FUNC,
 -		.v.func = alc_fixup_disable_mic_vref,
 -		.chained = true,
 -		.chain_id = ALC269_FIXUP_HEADSET_MODE_NO_HP_MIC
 -	},
 -	[ALC286_FIXUP_ACER_AIO_HEADSET_MIC] = {
 -		.type = HDA_FIXUP_VERBS,
 -		.v.verbs = (const struct hda_verb[]) {
 -			{ 0x20, AC_VERB_SET_COEF_INDEX, 0x4f },
 -			{ 0x20, AC_VERB_SET_PROC_COEF, 0x5029 },
 -			{ }
 -		},
 -		.chained = true,
 -		.chain_id = ALC286_FIXUP_ACER_AIO_MIC_NO_PRESENCE
 -	},
 -	[ALC256_FIXUP_ASUS_MIC_NO_PRESENCE] = {
 -		.type = HDA_FIXUP_PINS,
 -		.v.pins = (const struct hda_pintbl[]) {
 -			{ 0x19, 0x04a11120 }, /* use as headset mic, without its own jack detect */
 -			{ }
 -		},
 +		.v.func = alc295_fixup_chromebook,
  		.chained = true,
 -		.chain_id = ALC256_FIXUP_ASUS_HEADSET_MODE
 +		.chain_id = ALC225_FIXUP_HEADSET_JACK
  	},
+ 	[ALC299_FIXUP_PREDATOR_SPK] = {
+ 		.type = HDA_FIXUP_PINS,
+ 		.v.pins = (const struct hda_pintbl[]) {
+ 			{ 0x21, 0x90170150 }, /* use as headset mic, without its own jack detect */
+ 			{ }
+ 		}
+ 	},
  };
  
  static const struct snd_pci_quirk alc269_fixup_tbl[] = {
@@@ -6660,9 -6730,13 +6676,19 @@@
  	SND_PCI_QUIRK(0x1025, 0x079b, "Acer Aspire V5-573G", ALC282_FIXUP_ASPIRE_V5_PINS),
  	SND_PCI_QUIRK(0x1025, 0x102b, "Acer Aspire C24-860", ALC286_FIXUP_ACER_AIO_MIC_NO_PRESENCE),
  	SND_PCI_QUIRK(0x1025, 0x106d, "Acer Cloudbook 14", ALC283_FIXUP_CHROME_BOOK),
++<<<<<<< HEAD
 +	SND_PCI_QUIRK(0x1025, 0x128f, "Acer Veriton Z6860G", ALC286_FIXUP_ACER_AIO_MIC_NO_PRESENCE),
 +	SND_PCI_QUIRK(0x1025, 0x1290, "Acer Veriton Z4860G", ALC286_FIXUP_ACER_AIO_MIC_NO_PRESENCE),
 +	SND_PCI_QUIRK(0x1025, 0x1291, "Acer Veriton Z4660G", ALC286_FIXUP_ACER_AIO_MIC_NO_PRESENCE),
++=======
+ 	SND_PCI_QUIRK(0x1025, 0x1099, "Acer Aspire E5-523G", ALC255_FIXUP_ACER_MIC_NO_PRESENCE),
+ 	SND_PCI_QUIRK(0x1025, 0x110e, "Acer Aspire ES1-432", ALC255_FIXUP_ACER_MIC_NO_PRESENCE),
+ 	SND_PCI_QUIRK(0x1025, 0x1246, "Acer Predator Helios 500", ALC299_FIXUP_PREDATOR_SPK),
+ 	SND_PCI_QUIRK(0x1025, 0x128f, "Acer Veriton Z6860G", ALC286_FIXUP_ACER_AIO_HEADSET_MIC),
+ 	SND_PCI_QUIRK(0x1025, 0x1290, "Acer Veriton Z4860G", ALC286_FIXUP_ACER_AIO_HEADSET_MIC),
+ 	SND_PCI_QUIRK(0x1025, 0x1291, "Acer Veriton Z4660G", ALC286_FIXUP_ACER_AIO_HEADSET_MIC),
+ 	SND_PCI_QUIRK(0x1025, 0x1308, "Acer Aspire Z24-890", ALC286_FIXUP_ACER_AIO_HEADSET_MIC),
++>>>>>>> e2a829b3da01 (ALSA: hda/realtek - Fix speakers on Acer Predator Helios 500 Ryzen laptops)
  	SND_PCI_QUIRK(0x1025, 0x1330, "Acer TravelMate X514-51T", ALC255_FIXUP_ACER_HEADSET_MIC),
  	SND_PCI_QUIRK(0x1028, 0x0470, "Dell M101z", ALC269_FIXUP_DELL_M101Z),
  	SND_PCI_QUIRK(0x1028, 0x054b, "Dell XPS one 2710", ALC275_FIXUP_DELL_XPS),
* Unmerged path sound/pci/hda/patch_realtek.c
