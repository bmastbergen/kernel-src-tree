scsi: qla2xxx: Simplification of register address used in qla_tmpl.c

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-147.el8
commit-author Joe Carnuccio <joe.carnuccio@cavium.com>
commit ce0366df542a214be62bb3250e688f7c6d644ad7
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-147.el8/ce0366df.failed

Reduce stack space on each fwdt routine by eliminating local variable reg.

	Signed-off-by: Joe Carnuccio <joe.carnuccio@cavium.com>
	Signed-off-by: Himanshu Madhani <hmadhani@marvell.com>
	Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
(cherry picked from commit ce0366df542a214be62bb3250e688f7c6d644ad7)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/scsi/qla2xxx/qla_tmpl.c
diff --cc drivers/scsi/qla2xxx/qla_tmpl.c
index 70f227f59050,de696a07532e..000000000000
--- a/drivers/scsi/qla2xxx/qla_tmpl.c
+++ b/drivers/scsi/qla2xxx/qla_tmpl.c
@@@ -164,12 -159,14 +160,23 @@@ static struct qla27xx_fwdt_entry 
  qla27xx_fwdt_entry_t256(struct scsi_qla_host *vha,
  	struct qla27xx_fwdt_entry *ent, void *buf, ulong *len)
  {
++<<<<<<< HEAD
 +	struct device_reg_24xx __iomem *reg = qla27xx_isp_reg(vha);
 +
 +	ql_dbg(ql_dbg_misc, vha, 0xd200,
 +	    "%s: rdio t1 [%lx]\n", __func__, *len);
 +	qla27xx_read_window(reg, ent->t256.base_addr, ent->t256.pci_offset,
 +	    ent->t256.reg_count, ent->t256.reg_width, buf, len);
++=======
+ 	ulong addr = le32_to_cpu(ent->t256.base_addr);
+ 	uint offset = ent->t256.pci_offset;
+ 	ulong count = le16_to_cpu(ent->t256.reg_count);
+ 	uint width = ent->t256.reg_width;
+ 
+ 	ql_dbg(ql_dbg_misc, vha, 0xd200,
+ 	    "%s: rdio t1 [%lx]\n", __func__, *len);
+ 	qla27xx_read_window(ISPREG(vha), addr, offset, count, width, buf, len);
++>>>>>>> ce0366df542a (scsi: qla2xxx: Simplification of register address used in qla_tmpl.c)
  
  	return qla27xx_next_entry(ent);
  }
@@@ -178,12 -175,14 +185,23 @@@ static struct qla27xx_fwdt_entry 
  qla27xx_fwdt_entry_t257(struct scsi_qla_host *vha,
  	struct qla27xx_fwdt_entry *ent, void *buf, ulong *len)
  {
++<<<<<<< HEAD
 +	struct device_reg_24xx __iomem *reg = qla27xx_isp_reg(vha);
 +
 +	ql_dbg(ql_dbg_misc, vha, 0xd201,
 +	    "%s: wrio t1 [%lx]\n", __func__, *len);
 +	qla27xx_write_reg(reg, IOBASE_ADDR, ent->t257.base_addr, buf);
 +	qla27xx_write_reg(reg, ent->t257.pci_offset, ent->t257.write_data, buf);
++=======
+ 	ulong addr = le32_to_cpu(ent->t257.base_addr);
+ 	uint offset = ent->t257.pci_offset;
+ 	ulong data = le32_to_cpu(ent->t257.write_data);
+ 
+ 	ql_dbg(ql_dbg_misc, vha, 0xd201,
+ 	    "%s: wrio t1 [%lx]\n", __func__, *len);
+ 	qla27xx_write_reg(ISPREG(vha), IOBASE(vha), addr, buf);
+ 	qla27xx_write_reg(ISPREG(vha), offset, data, buf);
++>>>>>>> ce0366df542a (scsi: qla2xxx: Simplification of register address used in qla_tmpl.c)
  
  	return qla27xx_next_entry(ent);
  }
@@@ -192,13 -191,17 +210,27 @@@ static struct qla27xx_fwdt_entry 
  qla27xx_fwdt_entry_t258(struct scsi_qla_host *vha,
  	struct qla27xx_fwdt_entry *ent, void *buf, ulong *len)
  {
++<<<<<<< HEAD
 +	struct device_reg_24xx __iomem *reg = qla27xx_isp_reg(vha);
 +
 +	ql_dbg(ql_dbg_misc, vha, 0xd202,
 +	    "%s: rdio t2 [%lx]\n", __func__, *len);
 +	qla27xx_write_reg(reg, ent->t258.banksel_offset, ent->t258.bank, buf);
 +	qla27xx_read_window(reg, ent->t258.base_addr, ent->t258.pci_offset,
 +	    ent->t258.reg_count, ent->t258.reg_width, buf, len);
++=======
+ 	uint banksel = ent->t258.banksel_offset;
+ 	ulong bank = le32_to_cpu(ent->t258.bank);
+ 	ulong addr = le32_to_cpu(ent->t258.base_addr);
+ 	uint offset = ent->t258.pci_offset;
+ 	uint count = le16_to_cpu(ent->t258.reg_count);
+ 	uint width = ent->t258.reg_width;
+ 
+ 	ql_dbg(ql_dbg_misc, vha, 0xd202,
+ 	    "%s: rdio t2 [%lx]\n", __func__, *len);
+ 	qla27xx_write_reg(ISPREG(vha), banksel, bank, buf);
+ 	qla27xx_read_window(ISPREG(vha), addr, offset, count, width, buf, len);
++>>>>>>> ce0366df542a (scsi: qla2xxx: Simplification of register address used in qla_tmpl.c)
  
  	return qla27xx_next_entry(ent);
  }
@@@ -207,13 -210,17 +239,27 @@@ static struct qla27xx_fwdt_entry 
  qla27xx_fwdt_entry_t259(struct scsi_qla_host *vha,
  	struct qla27xx_fwdt_entry *ent, void *buf, ulong *len)
  {
++<<<<<<< HEAD
 +	struct device_reg_24xx __iomem *reg = qla27xx_isp_reg(vha);
 +
 +	ql_dbg(ql_dbg_misc, vha, 0xd203,
 +	    "%s: wrio t2 [%lx]\n", __func__, *len);
 +	qla27xx_write_reg(reg, IOBASE_ADDR, ent->t259.base_addr, buf);
 +	qla27xx_write_reg(reg, ent->t259.banksel_offset, ent->t259.bank, buf);
 +	qla27xx_write_reg(reg, ent->t259.pci_offset, ent->t259.write_data, buf);
++=======
+ 	ulong addr = le32_to_cpu(ent->t259.base_addr);
+ 	uint banksel = ent->t259.banksel_offset;
+ 	ulong bank = le32_to_cpu(ent->t259.bank);
+ 	uint offset = ent->t259.pci_offset;
+ 	ulong data = le32_to_cpu(ent->t259.write_data);
+ 
+ 	ql_dbg(ql_dbg_misc, vha, 0xd203,
+ 	    "%s: wrio t2 [%lx]\n", __func__, *len);
+ 	qla27xx_write_reg(ISPREG(vha), IOBASE(vha), addr, buf);
+ 	qla27xx_write_reg(ISPREG(vha), banksel, bank, buf);
+ 	qla27xx_write_reg(ISPREG(vha), offset, data, buf);
++>>>>>>> ce0366df542a (scsi: qla2xxx: Simplification of register address used in qla_tmpl.c)
  
  	return qla27xx_next_entry(ent);
  }
@@@ -222,12 -229,12 +268,21 @@@ static struct qla27xx_fwdt_entry 
  qla27xx_fwdt_entry_t260(struct scsi_qla_host *vha,
  	struct qla27xx_fwdt_entry *ent, void *buf, ulong *len)
  {
++<<<<<<< HEAD
 +	struct device_reg_24xx __iomem *reg = qla27xx_isp_reg(vha);
 +
 +	ql_dbg(ql_dbg_misc, vha, 0xd204,
 +	    "%s: rdpci [%lx]\n", __func__, *len);
 +	qla27xx_insert32(ent->t260.pci_offset, buf, len);
 +	qla27xx_read_reg(reg, ent->t260.pci_offset, buf, len);
++=======
+ 	uint offset = ent->t260.pci_offset;
+ 
+ 	ql_dbg(ql_dbg_misc, vha, 0xd204,
+ 	    "%s: rdpci [%lx]\n", __func__, *len);
+ 	qla27xx_insert32(offset, buf, len);
+ 	qla27xx_read_reg(ISPREG(vha), offset, buf, len);
++>>>>>>> ce0366df542a (scsi: qla2xxx: Simplification of register address used in qla_tmpl.c)
  
  	return qla27xx_next_entry(ent);
  }
@@@ -236,11 -243,12 +291,20 @@@ static struct qla27xx_fwdt_entry 
  qla27xx_fwdt_entry_t261(struct scsi_qla_host *vha,
  	struct qla27xx_fwdt_entry *ent, void *buf, ulong *len)
  {
++<<<<<<< HEAD
 +	struct device_reg_24xx __iomem *reg = qla27xx_isp_reg(vha);
 +
 +	ql_dbg(ql_dbg_misc, vha, 0xd205,
 +	    "%s: wrpci [%lx]\n", __func__, *len);
 +	qla27xx_write_reg(reg, ent->t261.pci_offset, ent->t261.write_data, buf);
++=======
+ 	uint offset = ent->t261.pci_offset;
+ 	ulong data = le32_to_cpu(ent->t261.write_data);
+ 
+ 	ql_dbg(ql_dbg_misc, vha, 0xd205,
+ 	    "%s: wrpci [%lx]\n", __func__, *len);
+ 	qla27xx_write_reg(ISPREG(vha), offset, data, buf);
++>>>>>>> ce0366df542a (scsi: qla2xxx: Simplification of register address used in qla_tmpl.c)
  
  	return qla27xx_next_entry(ent);
  }
@@@ -432,11 -438,12 +494,20 @@@ static struct qla27xx_fwdt_entry 
  qla27xx_fwdt_entry_t267(struct scsi_qla_host *vha,
  	struct qla27xx_fwdt_entry *ent, void *buf, ulong *len)
  {
++<<<<<<< HEAD
 +	struct device_reg_24xx __iomem *reg = qla27xx_isp_reg(vha);
 +
 +	ql_dbg(ql_dbg_misc, vha, 0xd20b,
 +	    "%s: dis intr [%lx]\n", __func__, *len);
 +	qla27xx_write_reg(reg, ent->t267.pci_offset, ent->t267.data, buf);
++=======
+ 	uint offset = ent->t267.pci_offset;
+ 	ulong data = le32_to_cpu(ent->t267.data);
+ 
+ 	ql_dbg(ql_dbg_misc, vha, 0xd20b,
+ 	    "%s: dis intr [%lx]\n", __func__, *len);
+ 	qla27xx_write_reg(ISPREG(vha), offset, data, buf);
++>>>>>>> ce0366df542a (scsi: qla2xxx: Simplification of register address used in qla_tmpl.c)
  
  	return qla27xx_next_entry(ent);
  }
@@@ -532,9 -539,8 +603,14 @@@ static struct qla27xx_fwdt_entry 
  qla27xx_fwdt_entry_t270(struct scsi_qla_host *vha,
  	struct qla27xx_fwdt_entry *ent, void *buf, ulong *len)
  {
++<<<<<<< HEAD
 +	struct device_reg_24xx __iomem *reg = qla27xx_isp_reg(vha);
 +	ulong dwords = ent->t270.count;
 +	ulong addr = ent->t270.addr;
++=======
+ 	ulong addr = le32_to_cpu(ent->t270.addr);
+ 	ulong dwords = le32_to_cpu(ent->t270.count);
++>>>>>>> ce0366df542a (scsi: qla2xxx: Simplification of register address used in qla_tmpl.c)
  
  	ql_dbg(ql_dbg_misc, vha, 0xd20e,
  	    "%s: rdremreg [%lx]\n", __func__, *len);
@@@ -553,9 -559,8 +629,14 @@@ static struct qla27xx_fwdt_entry 
  qla27xx_fwdt_entry_t271(struct scsi_qla_host *vha,
  	struct qla27xx_fwdt_entry *ent, void *buf, ulong *len)
  {
++<<<<<<< HEAD
 +	struct device_reg_24xx __iomem *reg = qla27xx_isp_reg(vha);
 +	ulong addr = ent->t271.addr;
 +	ulong data = ent->t271.data;
++=======
+ 	ulong addr = le32_to_cpu(ent->t271.addr);
+ 	ulong data = le32_to_cpu(ent->t271.data);
++>>>>>>> ce0366df542a (scsi: qla2xxx: Simplification of register address used in qla_tmpl.c)
  
  	ql_dbg(ql_dbg_misc, vha, 0xd20f,
  	    "%s: wrremreg [%lx]\n", __func__, *len);
@@@ -718,13 -734,15 +799,25 @@@ static struct qla27xx_fwdt_entry 
  qla27xx_fwdt_entry_t277(struct scsi_qla_host *vha,
      struct qla27xx_fwdt_entry *ent, void *buf, ulong *len)
  {
++<<<<<<< HEAD
 +	struct device_reg_24xx __iomem *reg = qla27xx_isp_reg(vha);
 +
 +	ql_dbg(ql_dbg_misc + ql_dbg_verbose, vha, 0xd215,
 +	    "%s: rdpep [%lx]\n", __func__, *len);
 +	qla27xx_insert32(ent->t277.wr_cmd_data, buf, len);
 +	qla27xx_write_reg(reg, ent->t277.cmd_addr, ent->t277.wr_cmd_data, buf);
 +	qla27xx_read_reg(reg, ent->t277.data_addr, buf, len);
++=======
+ 	ulong cmd_addr = le32_to_cpu(ent->t277.cmd_addr);
+ 	ulong wr_cmd_data = le32_to_cpu(ent->t277.wr_cmd_data);
+ 	ulong data_addr = le32_to_cpu(ent->t277.data_addr);
+ 
+ 	ql_dbg(ql_dbg_misc + ql_dbg_verbose, vha, 0xd215,
+ 	    "%s: rdpep [%lx]\n", __func__, *len);
+ 	qla27xx_insert32(wr_cmd_data, buf, len);
+ 	qla27xx_write_reg(ISPREG(vha), cmd_addr, wr_cmd_data, buf);
+ 	qla27xx_read_reg(ISPREG(vha), data_addr, buf, len);
++>>>>>>> ce0366df542a (scsi: qla2xxx: Simplification of register address used in qla_tmpl.c)
  
  	return qla27xx_next_entry(ent);
  }
@@@ -733,12 -751,15 +826,24 @@@ static struct qla27xx_fwdt_entry 
  qla27xx_fwdt_entry_t278(struct scsi_qla_host *vha,
      struct qla27xx_fwdt_entry *ent, void *buf, ulong *len)
  {
++<<<<<<< HEAD
 +	struct device_reg_24xx __iomem *reg = qla27xx_isp_reg(vha);
 +
 +	ql_dbg(ql_dbg_misc + ql_dbg_verbose, vha, 0xd216,
 +	    "%s: wrpep [%lx]\n", __func__, *len);
 +	qla27xx_write_reg(reg, ent->t278.data_addr, ent->t278.wr_data, buf);
 +	qla27xx_write_reg(reg, ent->t278.cmd_addr, ent->t278.wr_cmd_data, buf);
++=======
+ 	ulong cmd_addr = le32_to_cpu(ent->t278.cmd_addr);
+ 	ulong wr_cmd_data = le32_to_cpu(ent->t278.wr_cmd_data);
+ 	ulong data_addr = le32_to_cpu(ent->t278.data_addr);
+ 	ulong wr_data = le32_to_cpu(ent->t278.wr_data);
+ 
+ 	ql_dbg(ql_dbg_misc + ql_dbg_verbose, vha, 0xd216,
+ 	    "%s: wrpep [%lx]\n", __func__, *len);
+ 	qla27xx_write_reg(ISPREG(vha), data_addr, wr_data, buf);
+ 	qla27xx_write_reg(ISPREG(vha), cmd_addr, wr_cmd_data, buf);
++>>>>>>> ce0366df542a (scsi: qla2xxx: Simplification of register address used in qla_tmpl.c)
  
  	return qla27xx_next_entry(ent);
  }
* Unmerged path drivers/scsi/qla2xxx/qla_tmpl.c
