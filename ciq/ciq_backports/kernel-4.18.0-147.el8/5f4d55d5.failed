iwlwifi: mvm: change TLC config cmd sent by rs to be async

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-147.el8
commit-author Lior Cohen <lior2.cohen@intel.com>
commit 5f4d55d5791a8b7150dbaba239e92719ae0f94d4
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-147.el8/5f4d55d5.failed

The TLC_MNG_CONFIG sync cmd sent by the rs leads to a kernel warning
of sleeping while in rcu read-side critical section. The fix is to
change the command to be ASYNC (not blocking for the response anymore).

	Signed-off-by: Lior Cohen <lior2.cohen@intel.com>
	Signed-off-by: Luca Coelho <luciano.coelho@intel.com>
	Signed-off-by: Kalle Valo <kvalo@codeaurora.org>
(cherry picked from commit 5f4d55d5791a8b7150dbaba239e92719ae0f94d4)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/wireless/intel/iwlwifi/mvm/rs-fw.c
diff --cc drivers/net/wireless/intel/iwlwifi/mvm/rs-fw.c
index b8b2b819e8e7,be62f499c595..000000000000
--- a/drivers/net/wireless/intel/iwlwifi/mvm/rs-fw.c
+++ b/drivers/net/wireless/intel/iwlwifi/mvm/rs-fw.c
@@@ -292,10 -433,16 +292,21 @@@ void rs_fw_rate_init(struct iwl_mvm *mv
  #ifdef CONFIG_IWLWIFI_DEBUGFS
  	iwl_mvm_reset_frame_stats(mvm);
  #endif
 +	sband = hw->wiphy->bands[band];
  	rs_fw_set_supp_rates(sta, sband, &cfg_cmd);
  
++<<<<<<< HEAD
 +	ret = iwl_mvm_send_cmd_pdu(mvm, cmd_id, 0, sizeof(cfg_cmd), &cfg_cmd);
++=======
+ 	/*
+ 	 * since TLC offload works with one mode we can assume
+ 	 * that only vht/ht is used and also set it as station max amsdu
+ 	 */
+ 	sta->max_amsdu_len = max_amsdu_len;
+ 
+ 	ret = iwl_mvm_send_cmd_pdu(mvm, cmd_id, CMD_ASYNC, sizeof(cfg_cmd),
+ 				   &cfg_cmd);
++>>>>>>> 5f4d55d5791a (iwlwifi: mvm: change TLC config cmd sent by rs to be async)
  	if (ret)
  		IWL_ERR(mvm, "Failed to send rate scale config (%d)\n", ret);
  }
* Unmerged path drivers/net/wireless/intel/iwlwifi/mvm/rs-fw.c
