s390/purgatory: Omit use of bin2c

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-147.el8
commit-author Philipp Rudo <prudo@linux.ibm.com>
commit 4c0f032d496385fa8071e404a1bc33f4abbc2f81
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-147.el8/4c0f032d.failed

Omit use of script/bin2c hack. Directly include into assembler file instead.

	Signed-off-by: Philipp Rudo <prudo@linux.ibm.com>
	Signed-off-by: Martin Schwidefsky <schwidefsky@de.ibm.com>
(cherry picked from commit 4c0f032d496385fa8071e404a1bc33f4abbc2f81)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/s390/purgatory/Makefile
diff --cc arch/s390/purgatory/Makefile
index 8d61218a71aa,b20934d91986..000000000000
--- a/arch/s390/purgatory/Makefile
+++ b/arch/s390/purgatory/Makefile
@@@ -4,7 -4,7 +4,11 @@@ OBJECT_FILES_NON_STANDARD := 
  
  purgatory-y := head.o purgatory.o string.o sha256.o mem.o
  
++<<<<<<< HEAD
 +targets += $(purgatory-y) purgatory.ro kexec-purgatory.c
++=======
+ targets += $(purgatory-y) purgatory.lds purgatory purgatory.ro
++>>>>>>> 4c0f032d4963 (s390/purgatory: Omit use of bin2c)
  PURGATORY_OBJS = $(addprefix $(obj)/,$(purgatory-y))
  
  $(obj)/sha256.o: $(srctree)/lib/sha256.c FORCE
@@@ -25,14 -23,18 +29,26 @@@ KBUILD_CFLAGS += -c -MD -Os -m64 -msoft
  KBUILD_CFLAGS += $(call cc-option,-fno-PIE)
  KBUILD_AFLAGS := $(filter-out -DCC_USING_EXPOLINE,$(KBUILD_AFLAGS))
  
 -LDFLAGS_purgatory := -r --no-undefined -nostdlib -z nodefaultlib -T
 -$(obj)/purgatory: $(obj)/purgatory.lds $(PURGATORY_OBJS) FORCE
 +$(obj)/purgatory.ro: $(PURGATORY_OBJS) FORCE
  		$(call if_changed,ld)
  
++<<<<<<< HEAD
 +CMD_BIN2C = $(objtree)/scripts/basic/bin2c
 +quiet_cmd_bin2c = BIN2C   $@
 +      cmd_bin2c = $(CMD_BIN2C) kexec_purgatory < $< > $@
 +
 +$(obj)/kexec-purgatory.c: $(obj)/purgatory.ro FORCE
 +	$(call if_changed,bin2c)
++=======
+ OBJCOPYFLAGS_purgatory.ro := -O elf64-s390
+ OBJCOPYFLAGS_purgatory.ro += --remove-section='*debug*'
+ OBJCOPYFLAGS_purgatory.ro += --remove-section='.comment'
+ OBJCOPYFLAGS_purgatory.ro += --remove-section='.note.*'
+ $(obj)/purgatory.ro: $(obj)/purgatory FORCE
+ 		$(call if_changed,objcopy)
+ 
+ $(obj)/kexec-purgatory.o: $(obj)/kexec-purgatory.S $(obj)/purgatory.ro FORCE
+ 	$(call if_changed_rule,as_o_S)
++>>>>>>> 4c0f032d4963 (s390/purgatory: Omit use of bin2c)
  
  obj-$(CONFIG_ARCH_HAS_KEXEC_PURGATORY) += kexec-purgatory.o
* Unmerged path arch/s390/purgatory/Makefile
diff --git a/arch/s390/purgatory/kexec-purgatory.S b/arch/s390/purgatory/kexec-purgatory.S
new file mode 100644
index 000000000000..8293753100ae
--- /dev/null
+++ b/arch/s390/purgatory/kexec-purgatory.S
@@ -0,0 +1,14 @@
+/* SPDX-License-Identifier: GPL-2.0 */
+
+	.section .rodata, "a"
+
+	.align	8
+kexec_purgatory:
+	.globl	kexec_purgatory
+	.incbin	"arch/s390/purgatory/purgatory.ro"
+.Lkexec_purgatroy_end:
+
+	.align	8
+kexec_purgatory_size:
+	.globl	kexec_purgatory_size
+	.quad	.Lkexec_purgatroy_end - kexec_purgatory
