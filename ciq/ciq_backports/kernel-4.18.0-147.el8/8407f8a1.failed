drm/vmwgfx: Fix user space handle equal to zero

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-147.el8
commit-author Thomas Hellstrom <thellstrom@vmware.com>
commit 8407f8a1d940fe28c4243ad4f0cb6a44dcee88f6
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-147.el8/8407f8a1.failed

User-space handles equal to zero are interpreted as uninitialized or
illegal by some drm systems (most notably kms). This means that a
dumb buffer or surface with a zero user-space handle can never be
used as a kms frame-buffer.

	Cc: <stable@vger.kernel.org>
Fixes: c7eae62666ad ("drm/vmwgfx: Make the object handles idr-generated")
	Signed-off-by: Thomas Hellstrom <thellstrom@vmware.com>
	Reviewed-by: Deepak Rawat <drawat@vmware.com>
(cherry picked from commit 8407f8a1d940fe28c4243ad4f0cb6a44dcee88f6)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/gpu/drm/ttm/ttm_object.c
diff --cc drivers/gpu/drm/ttm/ttm_object.c
index 74f1b1eb1f8e,16077785ad47..000000000000
--- a/drivers/gpu/drm/ttm/ttm_object.c
+++ b/drivers/gpu/drm/ttm/ttm_object.c
@@@ -172,14 -172,15 +172,18 @@@ int ttm_base_object_init(struct ttm_obj
  	base->ref_obj_release = ref_obj_release;
  	base->object_type = object_type;
  	kref_init(&base->refcount);
 -	idr_preload(GFP_KERNEL);
  	spin_lock(&tdev->object_lock);
++<<<<<<< HEAD:drivers/gpu/drm/ttm/ttm_object.c
 +	ret = drm_ht_just_insert_please_rcu(&tdev->object_hash,
 +					    &base->hash,
 +					    (unsigned long)base, 31, 0, 0);
++=======
+ 	ret = idr_alloc(&tdev->idr, base, 1, 0, GFP_NOWAIT);
++>>>>>>> 8407f8a1d940 (drm/vmwgfx: Fix user space handle equal to zero):drivers/gpu/drm/vmwgfx/ttm_object.c
  	spin_unlock(&tdev->object_lock);
 -	idr_preload_end();
 -	if (ret < 0)
 -		return ret;
 +	if (unlikely(ret != 0))
 +		goto out_err0;
  
 -	base->handle = ret;
  	ret = ttm_ref_object_add(tfile, base, TTM_REF_USAGE, NULL, false);
  	if (unlikely(ret != 0))
  		goto out_err1;
* Unmerged path drivers/gpu/drm/ttm/ttm_object.c
