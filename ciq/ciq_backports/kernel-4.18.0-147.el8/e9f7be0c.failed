scsi: qla2xxx: Fix issue reported by static checker for qla2x00_els_dcmd2_sp_done()

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-147.el8
commit-author Quinn Tran <quinn.tran@cavium.com>
commit e9f7be0c4316a0ea1c47b1e800baa58fb937096c
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-147.el8/e9f7be0c.failed

This patch fixes following Smatch complaint:

drivers/scsi/qla2xxx/qla_iocb.c:2647 qla2x00_els_dcmd2_sp_done()
error: we previously assumed 'e' could be null (see line 2631)

Fixes: 8777e4314d39 ("scsi: qla2xxx: Migrate NVME N2N handling into state machine")
	Reported-by: Dan Carpenter <dan.carpenter@oracle.com>
	Signed-off-by: Quinn Tran <quinn.tran@cavium.com>
	Signed-off-by: Himanshu Madhani <himanshu.madhani@cavium.com>
	Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
(cherry picked from commit e9f7be0c4316a0ea1c47b1e800baa58fb937096c)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/scsi/qla2xxx/qla_iocb.c
diff --cc drivers/scsi/qla2xxx/qla_iocb.c
index dd132658631c,213321295753..000000000000
--- a/drivers/scsi/qla2xxx/qla_iocb.c
+++ b/drivers/scsi/qla2xxx/qla_iocb.c
@@@ -2578,12 -2603,50 +2578,52 @@@ qla2x00_els_dcmd2_sp_done(void *ptr, in
  	fc_port_t *fcport = sp->fcport;
  	struct srb_iocb *lio = &sp->u.iocb_cmd;
  	struct scsi_qla_host *vha = sp->vha;
 -	struct event_arg ea;
 -	struct qla_work_evt *e;
  
 -	ql_dbg(ql_dbg_disc, vha, 0x3072,
 -	    "%s ELS done rc %d hdl=%x, portid=%06x %8phC\n",
 -	    sp->name, res, sp->handle, fcport->d_id.b24, fcport->port_name);
 +	ql_dbg(ql_dbg_io + ql_dbg_disc, vha, 0x3072,
 +	    "%s ELS hdl=%x, portid=%06x done %8phC\n",
 +	    sp->name, sp->handle, fcport->d_id.b24, fcport->port_name);
  
++<<<<<<< HEAD
 +	complete(&lio->u.els_plogi.comp);
++=======
+ 	fcport->flags &= ~(FCF_ASYNC_SENT|FCF_ASYNC_ACTIVE);
+ 	del_timer(&sp->u.iocb_cmd.timer);
+ 
+ 	if (sp->flags & SRB_WAKEUP_ON_COMP)
+ 		complete(&lio->u.els_plogi.comp);
+ 	else {
+ 		if (res) {
+ 			set_bit(RELOGIN_NEEDED, &vha->dpc_flags);
+ 		} else {
+ 			memset(&ea, 0, sizeof(ea));
+ 			ea.fcport = fcport;
+ 			ea.rc = res;
+ 			ea.event = FCME_ELS_PLOGI_DONE;
+ 			qla2x00_fcport_event_handler(vha, &ea);
+ 		}
+ 
+ 		e = qla2x00_alloc_work(vha, QLA_EVT_UNMAP);
+ 		if (!e) {
+ 			struct srb_iocb *elsio = &sp->u.iocb_cmd;
+ 
+ 			if (elsio->u.els_plogi.els_plogi_pyld)
+ 				dma_free_coherent(&sp->vha->hw->pdev->dev,
+ 				    elsio->u.els_plogi.tx_size,
+ 				    elsio->u.els_plogi.els_plogi_pyld,
+ 				    elsio->u.els_plogi.els_plogi_pyld_dma);
+ 
+ 			if (elsio->u.els_plogi.els_resp_pyld)
+ 				dma_free_coherent(&sp->vha->hw->pdev->dev,
+ 				    elsio->u.els_plogi.rx_size,
+ 				    elsio->u.els_plogi.els_resp_pyld,
+ 				    elsio->u.els_plogi.els_resp_pyld_dma);
+ 			sp->free(sp);
+ 			return;
+ 		}
+ 		e->u.iosb.sp = sp;
+ 		qla2x00_post_work(vha, e);
+ 	}
++>>>>>>> e9f7be0c4316 (scsi: qla2xxx: Fix issue reported by static checker for qla2x00_els_dcmd2_sp_done())
  }
  
  int
* Unmerged path drivers/scsi/qla2xxx/qla_iocb.c
