s390/sclp: detect DIRQ facility

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-147.el8
commit-author Sebastian Ott <sebott@linux.ibm.com>
commit 0a9fddfaa8ea0f66564329ce89390c8dd38b2df0
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-147.el8/0a9fddfa.failed

Detect the adapter CPU directed interruption facility.

	Signed-off-by: Sebastian Ott <sebott@linux.ibm.com>
	Signed-off-by: Martin Schwidefsky <schwidefsky@de.ibm.com>
(cherry picked from commit 0a9fddfaa8ea0f66564329ce89390c8dd38b2df0)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/s390/include/asm/sclp.h
#	drivers/s390/char/sclp.h
diff --cc arch/s390/include/asm/sclp.h
index 0cd4bda85eb1,f577c5f6031a..000000000000
--- a/arch/s390/include/asm/sclp.h
+++ b/arch/s390/include/asm/sclp.h
@@@ -78,6 -78,10 +78,13 @@@ struct sclp_info 
  	unsigned char has_skey : 1;
  	unsigned char has_kss : 1;
  	unsigned char has_gisaf : 1;
++<<<<<<< HEAD
++=======
+ 	unsigned char has_diag318 : 1;
+ 	unsigned char has_sipl : 1;
+ 	unsigned char has_sipl_g2 : 1;
+ 	unsigned char has_dirq : 1;
++>>>>>>> 0a9fddfaa8ea (s390/sclp: detect DIRQ facility)
  	unsigned int ibc;
  	unsigned int mtid;
  	unsigned int mtid_cp;
diff --cc drivers/s390/char/sclp.h
index b3fcc24b1182,043f32ba3749..000000000000
--- a/drivers/s390/char/sclp.h
+++ b/drivers/s390/char/sclp.h
@@@ -195,7 -195,11 +195,15 @@@ struct read_info_sccb 
  	u16	hcpua;			/* 120-121 */
  	u8	_pad_122[124 - 122];	/* 122-123 */
  	u32	hmfai;			/* 124-127 */
++<<<<<<< HEAD
 +	u8	_pad_128[4096 - 128];	/* 128-4095 */
++=======
+ 	u8	_pad_128[134 - 128];	/* 128-133 */
+ 	u8	byte_134;			/* 134 */
+ 	u8	cpudirq;		/* 135 */
+ 	u16	cbl;			/* 136-137 */
+ 	u8	_pad_138[4096 - 138];	/* 138-4095 */
++>>>>>>> 0a9fddfaa8ea (s390/sclp: detect DIRQ facility)
  } __packed __aligned(PAGE_SIZE);
  
  struct read_storage_sccb {
* Unmerged path arch/s390/include/asm/sclp.h
* Unmerged path drivers/s390/char/sclp.h
diff --git a/drivers/s390/char/sclp_early.c b/drivers/s390/char/sclp_early.c
index e792cee3b51c..d725868223c8 100644
--- a/drivers/s390/char/sclp_early.c
+++ b/drivers/s390/char/sclp_early.c
@@ -91,6 +91,7 @@ static void __init sclp_early_facilities_detect(struct read_info_sccb *sccb)
 	sclp.mtid_prev = (sccb->fac42 & 0x80) ? (sccb->fac66 & 31) : 0;
 
 	sclp.hmfai = sccb->hmfai;
+	sclp.has_dirq = !!(sccb->cpudirq & 0x80);
 }
 
 /*
