RDMA/core: Verify that memory window type is legal

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-147.el8
commit-author Noa Osherovich <noaos@mellanox.com>
commit d0e02bf6cd6da339a31f7ef6a10aba9ad362a4d9
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-147.el8/d0e02bf6.failed

Before calling the provider's alloc_mw function, verify that the
given memory type is either IB_MW_TYPE_1 or IB_MW_TYPE_2.

	Signed-off-by: Noa Osherovich <noaos@mellanox.com>
	Signed-off-by: Leon Romanovsky <leonro@mellanox.com>
	Signed-off-by: Jason Gunthorpe <jgg@mellanox.com>
(cherry picked from commit d0e02bf6cd6da339a31f7ef6a10aba9ad362a4d9)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/infiniband/core/uverbs_cmd.c
diff --cc drivers/infiniband/core/uverbs_cmd.c
index 300532a4cde8,6fcfaca82332..000000000000
--- a/drivers/infiniband/core/uverbs_cmd.c
+++ b/drivers/infiniband/core/uverbs_cmd.c
@@@ -870,12 -885,12 +870,21 @@@ ssize_t ib_uverbs_alloc_mw(struct ib_uv
  		goto err_free;
  	}
  
++<<<<<<< HEAD
 +	ib_uverbs_init_udata(&udata, buf + sizeof(cmd),
 +		   u64_to_user_ptr(cmd.response) + sizeof(resp),
 +		   in_len - sizeof(cmd) - sizeof(struct ib_uverbs_cmd_hdr),
 +		   out_len - sizeof(resp));
 +
 +	mw = pd->device->alloc_mw(pd, cmd.mw_type, &udata);
++=======
+ 	if (cmd.mw_type != IB_MW_TYPE_1 && cmd.mw_type != IB_MW_TYPE_2) {
+ 		ret = -EINVAL;
+ 		goto err_put;
+ 	}
+ 
+ 	mw = pd->device->ops.alloc_mw(pd, cmd.mw_type, &attrs->driver_udata);
++>>>>>>> d0e02bf6cd6d (RDMA/core: Verify that memory window type is legal)
  	if (IS_ERR(mw)) {
  		ret = PTR_ERR(mw);
  		goto err_put;
* Unmerged path drivers/infiniband/core/uverbs_cmd.c
