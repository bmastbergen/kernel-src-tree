get_maintainer: allow option --mpath <directory> to read all files in <directory>

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-147.el8
commit-author Joe Perches <joe@perches.com>
commit 0fbd75fd7feedd9e38fc1d3a01317aa23b83d29e
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-147.el8/0fbd75fd.failed

There is an external use case for multiple private MAINTAINER style files
in a separate directory.  Allow it.

--mpath has a default of "./MAINTAINERS".

The value entered can be either a file or a directory.

The behaviors are now:

--mpath <file>          Read only the specific file as <MAINTAINER_TYPE> file
--mpath <directory>     Read all files in <directory> as <MAINTAINER_TYPE> files
--mpath <directory> --find-maintainer-files
                        Recurse through <directory> and read all files named MAINTAINERS

Link: http://lkml.kernel.org/r/991b2f20112d53863cd79e61d908f1d26d3e1971.camel@perches.com
	Signed-off-by: Joe Perches <joe@perches.com>
	Tested-by: Don Zickus <dzickus@redhat.com>
	Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
	Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
(cherry picked from commit 0fbd75fd7feedd9e38fc1d3a01317aa23b83d29e)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	scripts/get_maintainer.pl
diff --cc scripts/get_maintainer.pl
index 69307c28248e,c1c088ef1420..000000000000
--- a/scripts/get_maintainer.pl
+++ b/scripts/get_maintainer.pl
@@@ -388,52 -387,36 +388,81 @@@ sub find_ignore_git 
  read_all_maintainer_files();
  
  sub read_all_maintainer_files {
++<<<<<<< HEAD
 +	my $conf = which_conf(".get_maintainer.MAINTAINERS");
 +	if ( -f $conf) {
 +	    my @conf_args;
 +	    my $add = 0;
 +	    open(my $conffile, '<', "$conf")
 +		or warn "$P: Can't find a readable .get_maintainer.MAINTAINERS file $!\n";
 +	    while (<$conffile>) {
 +		my $line = $_;
 +		if ($line =~ m/^\+/ ) {
 +		    $add = 1;
 +		}
 +		next if ($line =~ m/^\s*#/);
 +		$line =~ s/^\+//g;
 +		$line =~ s/^\-//g;
 +		$line =~ s/\s*\n?$//;
 +		push(@mfiles, $line);
 +	    }
 +	    close($conffile);
 +	    if ($add eq 0) {
 +		foreach my $file (@mfiles) {
 +		     read_maintainer_file("$file");
 +		}
 +		return;
 +	    }
 +	}
 +
 +    if (-d "${lk_path}MAINTAINERS") {
 +        opendir(DIR, "${lk_path}MAINTAINERS") or die $!;
 +        my @files = readdir(DIR);
 +        closedir(DIR);
 +        foreach my $file (@files) {
 +            push(@mfiles, "${lk_path}MAINTAINERS/$file") if ($file !~ /^\./);
 +        }
++=======
+     my $path = "${lk_path}MAINTAINERS";
+     if (defined $maintainer_path) {
+ 	$path = $maintainer_path;
+ 	# Perl Cookbook tilde expansion if necessary
+ 	$path =~ s@^~([^/]*)@ $1 ? (getpwnam($1))[7] : ( $ENV{HOME} || $ENV{LOGDIR} || (getpwuid($<))[7])@ex;
+     }
+ 
+     if (-d $path) {
+ 	$path .= '/' if ($path !~ m@/$@);
+ 	if ($find_maintainer_files) {
+ 	    find( { wanted => \&find_is_maintainer_file,
+ 		    preprocess => \&find_ignore_git,
+ 		    no_chdir => 1,
+ 		}, "$path");
+ 	} else {
+ 	    opendir(DIR, "$path") or die $!;
+ 	    my @files = readdir(DIR);
+ 	    closedir(DIR);
+ 	    foreach my $file (@files) {
+ 		push(@mfiles, "$path$file") if ($file !~ /^\./);
+ 	    }
+ 	}
+     } elsif (-f "$path") {
+ 	push(@mfiles, "$path");
+     } else {
+ 	die "$P: MAINTAINER file not found '$path'\n";
++>>>>>>> 0fbd75fd7fee (get_maintainer: allow option --mpath <directory> to read all files in <directory>)
 +    }
 +
 +    if ($find_maintainer_files) {
 +        find( { wanted => \&find_is_maintainer_file,
 +                preprocess => \&find_ignore_git,
 +                no_chdir => 1,
 +        }, "${lk_path}");
 +    } else {
 +        push(@mfiles, "${lk_path}MAINTAINERS") if -f "${lk_path}MAINTAINERS";
      }
 -    die "$P: No MAINTAINER files found in '$path'\n" if (scalar(@mfiles) == 0);
 +
      foreach my $file (@mfiles) {
 -	read_maintainer_file("$file");
 +        read_maintainer_file("$file");
      }
  }
  
* Unmerged path scripts/get_maintainer.pl
