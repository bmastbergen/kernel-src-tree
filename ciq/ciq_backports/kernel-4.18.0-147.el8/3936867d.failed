drm/i915: Disable read only ppgtt support for gen11

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-147.el8
commit-author Mika Kuoppala <mika.kuoppala@linux.intel.com>
commit 3936867dbc1eb8790aa5985a68d53e4303b3616f
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-147.el8/3936867d.failed

On gen11 writing to read only ppgtt page causes a gpu hang.
This behaviour is different than with previous gen where
read only ppgtt access is supported. On those, the write
is just dropped without visible side effects.

Disable ro ppgtt support on gen11 until a solution can
be found to bring it into line with its predecessors.

References: HSDES#1807136187
References: https://bugzilla.freedesktop.org/show_bug.cgi?id=108569
	Cc: Chris Wilson <chris@chris-wilson.co.uk>
	Signed-off-by: Mika Kuoppala <mika.kuoppala@linux.intel.com>
	Acked-by: Chris Wilson <chris@chris-wilson.co.uk>
	Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>
Link: https://patchwork.freedesktop.org/patch/msgid/20190411083034.28311-1-mika.kuoppala@linux.intel.com
(cherry picked from commit 3936867dbc1eb8790aa5985a68d53e4303b3616f)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/gpu/drm/i915/i915_gem_gtt.c
diff --cc drivers/gpu/drm/i915/i915_gem_gtt.c
index 996ab2ad6c45,8f460cc4cc1f..000000000000
--- a/drivers/gpu/drm/i915/i915_gem_gtt.c
+++ b/drivers/gpu/drm/i915/i915_gem_gtt.c
@@@ -1233,6 -1225,11 +1233,14 @@@ static int gen8_init_scratch(struct i91
  	if (ret)
  		return ret;
  
++<<<<<<< HEAD
++=======
+ 	vm->scratch_pte =
+ 		gen8_pte_encode(vm->scratch_page.daddr,
+ 				I915_CACHE_LLC,
+ 				vm->has_read_only);
+ 
++>>>>>>> 3936867dbc1e (drm/i915: Disable read only ppgtt support for gen11)
  	vm->scratch_pt = alloc_pt(vm);
  	if (IS_ERR(vm->scratch_pt)) {
  		ret = PTR_ERR(vm->scratch_pt);
@@@ -1601,15 -1537,24 +1609,31 @@@ unwind
   * space.
   *
   */
 -static struct i915_hw_ppgtt *gen8_ppgtt_create(struct drm_i915_private *i915)
 +static int gen8_ppgtt_init(struct i915_hw_ppgtt *ppgtt)
  {
 -	struct i915_hw_ppgtt *ppgtt;
 -	int err;
 +	struct i915_address_space *vm = &ppgtt->base;
 +	struct drm_i915_private *dev_priv = vm->i915;
 +	int ret;
  
++<<<<<<< HEAD
 +	ppgtt->base.total = USES_FULL_48BIT_PPGTT(dev_priv) ?
 +		1ULL << 48 :
 +		1ULL << 32;
++=======
+ 	ppgtt = kzalloc(sizeof(*ppgtt), GFP_KERNEL);
+ 	if (!ppgtt)
+ 		return ERR_PTR(-ENOMEM);
+ 
+ 	ppgtt_init(i915, ppgtt);
+ 
+ 	/*
+ 	 * From bdw, there is hw support for read-only pages in the PPGTT.
+ 	 *
+ 	 * Gen11 has HSDES#:1807136187 unresolved. Disable ro support
+ 	 * for now.
+ 	 */
+ 	ppgtt->vm.has_read_only = INTEL_GEN(i915) != 11;
++>>>>>>> 3936867dbc1e (drm/i915: Disable read only ppgtt support for gen11)
  
  	/* There are only few exceptions for gen >=6. chv and bxt.
  	 * And we are not sure about the latter so play safe for now.
* Unmerged path drivers/gpu/drm/i915/i915_gem_gtt.c
