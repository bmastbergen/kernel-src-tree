KVM: nVMX: Allow restore nested-state to enable eVMCS when vCPU in SMM

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-147.el8
commit-author Liran Alon <liran.alon@oracle.com>
commit 65b712f1560abdd9ebec005e9bd17c21ecacc849
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-147.el8/65b712f1.failed

As comment in code specifies, SMM temporarily disables VMX so we cannot
be in guest mode, nor can VMLAUNCH/VMRESUME be pending.

However, code currently assumes that these are the only flags that can be
set on kvm_state->flags. This is not true as KVM_STATE_NESTED_EVMCS
can also be set on this field to signal that eVMCS should be enabled.

Therefore, fix code to check for guest-mode and pending VMLAUNCH/VMRESUME
explicitly.

	Reviewed-by: Joao Martins <joao.m.martins@oracle.com>
	Signed-off-by: Liran Alon <liran.alon@oracle.com>
	Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>
(cherry picked from commit 65b712f1560abdd9ebec005e9bd17c21ecacc849)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/x86/kvm/vmx/nested.c
* Unmerged path arch/x86/kvm/vmx/nested.c
* Unmerged path arch/x86/kvm/vmx/nested.c
