selinux: implement the kernfs_init_security hook

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-147.el8
commit-author Ondrej Mosnacek <omosnace@redhat.com>
commit ec882da5cda911e799b8a5ede94d099fdc0c656b
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-147.el8/ec882da5.failed

The hook applies the same logic as selinux_determine_inode_label(), with
the exception of the super_block handling, which will be enforced on the
actual inodes later by other hooks.

	Signed-off-by: Ondrej Mosnacek <omosnace@redhat.com>
[PM: minor merge fixes]
	Signed-off-by: Paul Moore <paul@paul-moore.com>
(cherry picked from commit ec882da5cda911e799b8a5ede94d099fdc0c656b)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	security/selinux/hooks.c
diff --cc security/selinux/hooks.c
index d1c6a482b68b,ab4b049daf17..000000000000
--- a/security/selinux/hooks.c
+++ b/security/selinux/hooks.c
@@@ -88,6 -89,9 +88,12 @@@
  #include <linux/msg.h>
  #include <linux/shm.h>
  #include <linux/bpf.h>
++<<<<<<< HEAD
++=======
+ #include <linux/kernfs.h>
+ #include <linux/stringhash.h>	/* for hashlen_string() */
+ #include <uapi/linux/mount.h>
++>>>>>>> ec882da5cda9 (selinux: implement the kernfs_init_security hook)
  
  #include "avc.h"
  #include "objsec.h"
@@@ -7001,9 -6794,10 +7069,11 @@@ static struct security_hook_list selinu
  	LSM_HOOK_INIT(inode_copy_up, selinux_inode_copy_up),
  	LSM_HOOK_INIT(inode_copy_up_xattr, selinux_inode_copy_up_xattr),
  
+ 	LSM_HOOK_INIT(kernfs_init_security, selinux_kernfs_init_security),
+ 
  	LSM_HOOK_INIT(file_permission, selinux_file_permission),
  	LSM_HOOK_INIT(file_alloc_security, selinux_file_alloc_security),
 +	LSM_HOOK_INIT(file_free_security, selinux_file_free_security),
  	LSM_HOOK_INIT(file_ioctl, selinux_file_ioctl),
  	LSM_HOOK_INIT(mmap_file, selinux_mmap_file),
  	LSM_HOOK_INIT(mmap_addr, selinux_mmap_addr),
* Unmerged path security/selinux/hooks.c
