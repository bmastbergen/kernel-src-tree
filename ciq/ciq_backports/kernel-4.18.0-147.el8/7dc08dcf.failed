IB/core: Expose ib_ucontext from a given ib_uverbs_file

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-147.el8
commit-author Yishai Hadas <yishaih@mellanox.com>
commit 7dc08dcfc8c86cb4457e383734ff6844ddaff876
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-147.el8/7dc08dcf.failed

Drivers that use the IOCTL API may have the ib_uverbs_file and need a
way to get the related ib_ucontext from it, this is enabled by this
patch.

Downstream patches from this series will use it.

	Signed-off-by: Yishai Hadas <yishaih@mellanox.com>
	Signed-off-by: Leon Romanovsky <leonro@mellanox.com>
	Signed-off-by: Jason Gunthorpe <jgg@mellanox.com>
(cherry picked from commit 7dc08dcfc8c86cb4457e383734ff6844ddaff876)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	include/rdma/ib_verbs.h
diff --cc include/rdma/ib_verbs.h
index 5a7db1b1060e,995d517c0a76..000000000000
--- a/include/rdma/ib_verbs.h
+++ b/include/rdma/ib_verbs.h
@@@ -4120,15 -4120,6 +4120,19 @@@ ib_get_vector_affinity(struct ib_devic
   */
  void rdma_roce_rescan_device(struct ib_device *ibdev);
  
++<<<<<<< HEAD
 +struct net_device *rdma_alloc_netdev(struct ib_device *device, u8 port_num,
 +				     enum rdma_netdev_t type, const char *name,
 +				     unsigned char name_assign_type,
 +				     void (*setup)(struct net_device *));
 +
 +int rdma_init_netdev(struct ib_device *device, u8 port_num,
 +		     enum rdma_netdev_t type, const char *name,
 +		     unsigned char name_assign_type,
 +		     void (*setup)(struct net_device *),
 +		     struct net_device *netdev);
++=======
+ struct ib_ucontext *ib_uverbs_get_ucontext(struct ib_uverbs_file *ufile);
++>>>>>>> 7dc08dcfc8c8 (IB/core: Expose ib_ucontext from a given ib_uverbs_file)
  
  #endif /* IB_VERBS_H */
diff --git a/drivers/infiniband/core/uverbs_main.c b/drivers/infiniband/core/uverbs_main.c
index 92d8469e28f3..b042c1477507 100644
--- a/drivers/infiniband/core/uverbs_main.c
+++ b/drivers/infiniband/core/uverbs_main.c
@@ -138,6 +138,12 @@ static int (*uverbs_ex_cmd_table[])(struct ib_uverbs_file *file,
 static void ib_uverbs_add_one(struct ib_device *device);
 static void ib_uverbs_remove_one(struct ib_device *device, void *client_data);
 
+struct ib_ucontext *ib_uverbs_get_ucontext(struct ib_uverbs_file *ufile)
+{
+	return ufile->ucontext;
+}
+EXPORT_SYMBOL(ib_uverbs_get_ucontext);
+
 int uverbs_dealloc_mw(struct ib_mw *mw)
 {
 	struct ib_pd *pd = mw->pd;
* Unmerged path include/rdma/ib_verbs.h
