net: sched: cls_u32: simplify the hell out u32_delete() emptiness check

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-147.el8
Rebuild_CHGLOG: - [net] sched: cls_u32: simplify the hell out u32_delete() emptiness check (Ivan Vecera) [1688236 1687456]
Rebuild_FUZZ: 96.35%
commit-author Al Viro <viro@zeniv.linux.org.uk>
commit a030598690c604c17b5288160d9d7b40274b2f79
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-147.el8/a0305986.failed

Now that we have the knode count, we can instantly check if
any hnodes are non-empty.  And that kills the check for extra
references to root hnode - those could happen only if there was
a knode to carry such a link.

	Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>
	Signed-off-by: Jamal Hadi Salim <jhs@mojatatu.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit a030598690c604c17b5288160d9d7b40274b2f79)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/sched/cls_u32.c
diff --cc net/sched/cls_u32.c
index 496fa7ede72f,ac79a40a0392..000000000000
--- a/net/sched/cls_u32.c
+++ b/net/sched/cls_u32.c
@@@ -703,38 -687,7 +688,42 @@@ static int u32_delete(struct tcf_proto 
  	}
  
  out:
++<<<<<<< HEAD
 +	*last = true;
 +	if (root_ht) {
 +		if (root_ht->refcnt > 2) {
 +			*last = false;
 +			goto ret;
 +		}
 +		if (root_ht->refcnt == 2) {
 +			if (!ht_empty(root_ht)) {
 +				*last = false;
 +				goto ret;
 +			}
 +		}
 +	}
 +
 +	if (tp_c->refcnt > 1) {
 +		*last = false;
 +		goto ret;
 +	}
 +
 +	if (tp_c->refcnt == 1) {
 +		struct tc_u_hnode *ht;
 +
 +		for (ht = rtnl_dereference(tp_c->hlist);
 +		     ht;
 +		     ht = rtnl_dereference(ht->next))
 +			if (!ht_empty(ht)) {
 +				*last = false;
 +				break;
 +			}
 +	}
 +
 +ret:
++=======
+ 	*last = tp_c->refcnt == 1 && tp_c->knodes == 0;
++>>>>>>> a030598690c6 (net: sched: cls_u32: simplify the hell out u32_delete() emptiness check)
  	return ret;
  }
  
* Unmerged path net/sched/cls_u32.c
