RDMA/iwcm: Fix string truncation error

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-147.el8
commit-author Leon Romanovsky <leon@kernel.org>
commit 1882ab867863531ab9caab81fd6ac5fee6d1a314
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-147.el8/1882ab86.failed

The strlen() check at the beginning of iw_cm_map() ensures that devname
and ifname strings are less than destinations to which they are supposed
to be copied. Change strncpy() call to be strcpy(), because we are
protected from overflow. Zero the entire string buffer to avoid copying
uninitialized kernel stack memory to userspace.

This fixes the compilation warning below:

In file included from ./include/linux/dma-mapping.h:6,
                 from drivers/infiniband/core/iwcm.c:38:
In function _strncpy_,
    inlined from _iw_cm_map_ at drivers/infiniband/core/iwcm.c:519:2:
./include/linux/string.h:253:9: warning: ___builtin_strncpy_ specified
bound 32 equals destination size [-Wstringop-truncation]
  return __builtin_strncpy(p, q, size);
         ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Fixes: d53ec8af56d5 ("RDMA/iwcm: Don't copy past the end of dev_name() string")
	Signed-off-by: Leon Romanovsky <leonro@mellanox.com>
	Signed-off-by: Jason Gunthorpe <jgg@mellanox.com>
(cherry picked from commit 1882ab867863531ab9caab81fd6ac5fee6d1a314)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/infiniband/core/iwcm.c
diff --cc drivers/infiniband/core/iwcm.c
index 5d676cff41f4,732637c913d9..000000000000
--- a/drivers/infiniband/core/iwcm.c
+++ b/drivers/infiniband/core/iwcm.c
@@@ -502,17 -503,21 +502,28 @@@ static void iw_cm_check_wildcard(struc
   */
  static int iw_cm_map(struct iw_cm_id *cm_id, bool active)
  {
++<<<<<<< HEAD
 +	struct iwpm_dev_data pm_reg_msg;
++=======
+ 	const char *devname = dev_name(&cm_id->device->dev);
+ 	const char *ifname = cm_id->device->iwcm->ifname;
+ 	struct iwpm_dev_data pm_reg_msg = {};
++>>>>>>> 1882ab867863 (RDMA/iwcm: Fix string truncation error)
  	struct iwpm_sa_data pm_msg;
  	int status;
  
  	cm_id->m_local_addr = cm_id->local_addr;
  	cm_id->m_remote_addr = cm_id->remote_addr;
  
++<<<<<<< HEAD
 +	memcpy(pm_reg_msg.dev_name, cm_id->device->name,
 +	       sizeof(pm_reg_msg.dev_name));
 +	memcpy(pm_reg_msg.if_name, cm_id->device->iwcm->ifname,
 +	       sizeof(pm_reg_msg.if_name));
++=======
+ 	strcpy(pm_reg_msg.dev_name, devname);
+ 	strcpy(pm_reg_msg.if_name, ifname);
++>>>>>>> 1882ab867863 (RDMA/iwcm: Fix string truncation error)
  
  	if (iwpm_register_pid(&pm_reg_msg, RDMA_NL_IWCM) ||
  	    !iwpm_valid_pid())
* Unmerged path drivers/infiniband/core/iwcm.c
