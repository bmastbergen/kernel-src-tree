ice: Disable sniffing VF traffic on PF

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-147.el8
commit-author Michal Swiatkowski <michal.swiatkowski@intel.com>
commit 64439f8f0bc4e9da1c6cb31c2ee642e3139f5731
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-147.el8/64439f8f.failed

Delete code that add default Tx rule on PF. With this rule PF can see
Tx VF traffic that should go outside. For traffic from VF to another
VF default Tx rule on PF doesn't apply because of lower priority than
VF mac rule.

With this change on PF in promisc mode we can see only Rx traffic that
doesn't match any other rule (mac etc.). We can't see Tx traffic from
other VSI.

	Signed-off-by: Michal Swiatkowski <michal.swiatkowski@intel.com>
	Signed-off-by: Anirudh Venkataramanan <anirudh.venkataramanan@intel.com>
	Tested-by: Andrew Bowers <andrewx.bowers@intel.com>
	Signed-off-by: Jeff Kirsher <jeffrey.t.kirsher@intel.com>
(cherry picked from commit 64439f8f0bc4e9da1c6cb31c2ee642e3139f5731)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/intel/ice/ice_main.c
diff --cc drivers/net/ethernet/intel/ice/ice_main.c
index d40e0a3f6481,7843abf4d44d..000000000000
--- a/drivers/net/ethernet/intel/ice/ice_main.c
+++ b/drivers/net/ethernet/intel/ice/ice_main.c
@@@ -257,17 -317,7 +257,21 @@@ static int ice_vsi_sync_fltr(struct ice
  	    test_bit(ICE_VSI_FLAG_PROMISC_CHANGED, vsi->flags)) {
  		clear_bit(ICE_VSI_FLAG_PROMISC_CHANGED, vsi->flags);
  		if (vsi->current_netdev_flags & IFF_PROMISC) {
++<<<<<<< HEAD
 +			/* Apply TX filter rule to get traffic from VMs */
 +			status = ice_cfg_dflt_vsi(hw, vsi->idx, true,
 +						  ICE_FLTR_TX);
 +			if (status) {
 +				netdev_err(netdev, "Error setting default VSI %i tx rule\n",
 +					   vsi->vsi_num);
 +				vsi->current_netdev_flags &= ~IFF_PROMISC;
 +				err = -EIO;
 +				goto out_promisc;
 +			}
 +			/* Apply RX filter rule to get traffic from wire */
++=======
+ 			/* Apply Rx filter rule to get traffic from wire */
++>>>>>>> 64439f8f0bc4 (ice: Disable sniffing VF traffic on PF)
  			status = ice_cfg_dflt_vsi(hw, vsi->idx, true,
  						  ICE_FLTR_RX);
  			if (status) {
@@@ -278,17 -328,7 +282,21 @@@
  				goto out_promisc;
  			}
  		} else {
++<<<<<<< HEAD
 +			/* Clear TX filter rule to stop traffic from VMs */
 +			status = ice_cfg_dflt_vsi(hw, vsi->idx, false,
 +						  ICE_FLTR_TX);
 +			if (status) {
 +				netdev_err(netdev, "Error clearing default VSI %i tx rule\n",
 +					   vsi->vsi_num);
 +				vsi->current_netdev_flags |= IFF_PROMISC;
 +				err = -EIO;
 +				goto out_promisc;
 +			}
 +			/* Clear RX filter to remove traffic from wire */
++=======
+ 			/* Clear Rx filter to remove traffic from wire */
++>>>>>>> 64439f8f0bc4 (ice: Disable sniffing VF traffic on PF)
  			status = ice_cfg_dflt_vsi(hw, vsi->idx, false,
  						  ICE_FLTR_RX);
  			if (status) {
* Unmerged path drivers/net/ethernet/intel/ice/ice_main.c
