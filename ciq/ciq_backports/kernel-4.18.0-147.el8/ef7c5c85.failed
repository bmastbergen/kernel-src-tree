crypto: talitos - Forbid 2-key 3DES in FIPS mode

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-147.el8
commit-author Herbert Xu <herbert@gondor.apana.org.au>
commit ef7c5c854859d25157aae950d8112c04eb9cc96d
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-147.el8/ef7c5c85.failed

This patch forbids the use of 2-key 3DES (K1 == K3) in FIPS mode.

	Signed-off-by: Herbert Xu <herbert@gondor.apana.org.au>
(cherry picked from commit ef7c5c854859d25157aae950d8112c04eb9cc96d)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/crypto/talitos.c
diff --cc drivers/crypto/talitos.c
index cf14f099ce4a,1d429fc073d1..000000000000
--- a/drivers/crypto/talitos.c
+++ b/drivers/crypto/talitos.c
@@@ -1535,19 -1575,6 +1583,22 @@@ static int ablkcipher_setkey(struct cry
  {
  	struct talitos_ctx *ctx = crypto_ablkcipher_ctx(cipher);
  	struct device *dev = ctx->dev;
++<<<<<<< HEAD
 +	u32 tmp[DES_EXPKEY_WORDS];
 +
 +	if (keylen > TALITOS_MAX_KEY_SIZE) {
 +		crypto_ablkcipher_set_flags(cipher, CRYPTO_TFM_RES_BAD_KEY_LEN);
 +		return -EINVAL;
 +	}
 +
 +	if (unlikely(crypto_ablkcipher_get_flags(cipher) &
 +		     CRYPTO_TFM_REQ_WEAK_KEY) &&
 +	    !des_ekey(tmp, key)) {
 +		crypto_ablkcipher_set_flags(cipher, CRYPTO_TFM_RES_WEAK_KEY);
 +		return -EINVAL;
 +	}
++=======
++>>>>>>> ef7c5c854859 (crypto: talitos - Forbid 2-key 3DES in FIPS mode)
  
  	if (ctx->keylen)
  		dma_unmap_single(dev, ctx->dma_key, ctx->keylen, DMA_TO_DEVICE);
@@@ -3164,10 -3224,10 +3260,11 @@@ static struct talitos_crypto_alg *talit
  		alg->cra_init = talitos_cra_init;
  		alg->cra_exit = talitos_cra_exit;
  		alg->cra_type = &crypto_ablkcipher_type;
- 		alg->cra_ablkcipher.setkey = ablkcipher_setkey;
+ 		alg->cra_ablkcipher.setkey = alg->cra_ablkcipher.setkey ?:
+ 					     ablkcipher_setkey;
  		alg->cra_ablkcipher.encrypt = ablkcipher_encrypt;
  		alg->cra_ablkcipher.decrypt = ablkcipher_decrypt;
 +		alg->cra_ablkcipher.geniv = "eseqiv";
  		break;
  	case CRYPTO_ALG_TYPE_AEAD:
  		alg = &t_alg->algt.alg.aead.base;
* Unmerged path drivers/crypto/talitos.c
