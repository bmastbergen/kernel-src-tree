KVM: PPC: Book3S HV: XIVE: Activate XIVE exploitation mode

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-147.el8
commit-author Cédric Le Goater <clg@kaod.org>
commit 3fab2d10588e09abd4bd7b9bacce5e4e435993f6
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-147.el8/3fab2d10.failed

Full support for the XIVE native exploitation mode is now available,
advertise the capability KVM_CAP_PPC_IRQ_XIVE for guests running on
PowerNV KVM Hypervisors only. Support for nested guests (pseries KVM
Hypervisor) is not yet available. XIVE should also have been activated
which is default setting on POWER9 systems running a recent Linux
kernel.

	Signed-off-by: Cédric Le Goater <clg@kaod.org>
	Reviewed-by: David Gibson <david@gibson.dropbear.id.au>
	Signed-off-by: Paul Mackerras <paulus@ozlabs.org>
(cherry picked from commit 3fab2d10588e09abd4bd7b9bacce5e4e435993f6)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/powerpc/kvm/powerpc.c
diff --cc arch/powerpc/kvm/powerpc.c
index 1a65db7bb1ae,f54926c78320..000000000000
--- a/arch/powerpc/kvm/powerpc.c
+++ b/arch/powerpc/kvm/powerpc.c
@@@ -571,6 -570,16 +571,19 @@@ int kvm_vm_ioctl_check_extension(struc
  	case KVM_CAP_PPC_GET_CPU_CHAR:
  		r = 1;
  		break;
++<<<<<<< HEAD
++=======
+ #ifdef CONFIG_KVM_XIVE
+ 	case KVM_CAP_PPC_IRQ_XIVE:
+ 		/*
+ 		 * We need XIVE to be enabled on the platform (implies
+ 		 * a POWER9 processor) and the PowerNV platform, as
+ 		 * nested is not yet supported.
+ 		 */
+ 		r = xive_enabled() && !!cpu_has_feature(CPU_FTR_HVMODE);
+ 		break;
+ #endif
++>>>>>>> 3fab2d10588e (KVM: PPC: Book3S HV: XIVE: Activate XIVE exploitation mode)
  
  	case KVM_CAP_PPC_ALLOC_HTAB:
  		r = hv_enabled;
* Unmerged path arch/powerpc/kvm/powerpc.c
