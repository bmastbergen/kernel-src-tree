x86/tsc: Force inlining of cyc2ns bits

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-147.el8
commit-author Peter Zijlstra <peterz@infradead.org>
commit 4907c68abd3f60f650f98d5a69d4ec77c0bde44f
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-147.el8/4907c68a.failed

Looking at the asm for native_sched_clock() I noticed we don't inline
enough. Mostly caused by sharing code with cyc2ns_read_begin(), which
we didn't used to do. So mark all that __force_inline to make it DTRT.

Fixes: 59eaef78bfea ("x86/tsc: Remodel cyc2ns to use seqcount_latch()")
	Reported-by: Eric Dumazet <edumazet@google.com>
	Signed-off-by: Peter Zijlstra (Intel) <peterz@infradead.org>
	Signed-off-by: Thomas Gleixner <tglx@linutronix.de>
	Cc: hpa@zytor.com
	Cc: eric.dumazet@gmail.com
	Cc: bp@alien8.de
	Cc: stable@vger.kernel.org
Link: https://lkml.kernel.org/r/20181011104019.695196158@infradead.org

(cherry picked from commit 4907c68abd3f60f650f98d5a69d4ec77c0bde44f)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/x86/kernel/tsc.c
diff --cc arch/x86/kernel/tsc.c
index f12b20ec01d0,6d5dc5dabfd7..000000000000
--- a/arch/x86/kernel/tsc.c
+++ b/arch/x86/kernel/tsc.c
@@@ -106,24 -104,7 +106,28 @@@ void __always_inline cyc2ns_read_end(vo
   *                      -johnstul@us.ibm.com "math is hard, lets go shopping!"
   */
  
++<<<<<<< HEAD
 +static void cyc2ns_data_init(struct cyc2ns_data *data)
 +{
 +	data->cyc2ns_mul = 0;
 +	data->cyc2ns_shift = 0;
 +	data->cyc2ns_offset = 0;
 +}
 +
 +static void __init cyc2ns_init(int cpu)
 +{
 +	struct cyc2ns *c2n = &per_cpu(cyc2ns, cpu);
 +
 +	cyc2ns_data_init(&c2n->data[0]);
 +	cyc2ns_data_init(&c2n->data[1]);
 +
 +	seqcount_init(&c2n->seq);
 +}
 +
 +static inline unsigned long long cycles_2_ns(unsigned long long cyc)
++=======
+ static __always_inline unsigned long long cycles_2_ns(unsigned long long cyc)
++>>>>>>> 4907c68abd3f (x86/tsc: Force inlining of cyc2ns bits)
  {
  	struct cyc2ns_data data;
  	unsigned long long ns;
* Unmerged path arch/x86/kernel/tsc.c
