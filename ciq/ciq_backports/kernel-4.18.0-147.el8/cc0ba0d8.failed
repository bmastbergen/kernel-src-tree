drm/vmwgfx: Use the backdoor port if the HB port is not available

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-147.el8
commit-author Thomas Hellstrom <thellstrom@vmware.com>
commit cc0ba0d8624f210995924bb57a8b181ce8976606
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-147.el8/cc0ba0d8.failed

The HB port may not be available for various reasons. Either it has been
disabled by a config option or by the hypervisor for other reasons.
In that case, make sure we have a backup plan and use the backdoor port
instead with a performance penalty.

	Cc: stable@vger.kernel.org
Fixes: 89da76fde68d ("drm/vmwgfx: Add VMWare host messaging capability")
	Signed-off-by: Thomas Hellstrom <thellstrom@vmware.com>
	Reviewed-by: Deepak Rawat <drawat@vmware.com>
(cherry picked from commit cc0ba0d8624f210995924bb57a8b181ce8976606)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/gpu/drm/vmwgfx/vmwgfx_msg.c
diff --cc drivers/gpu/drm/vmwgfx/vmwgfx_msg.c
index 21d746bdc922,e4e09d47c5c0..000000000000
--- a/drivers/gpu/drm/vmwgfx/vmwgfx_msg.c
+++ b/drivers/gpu/drm/vmwgfx/vmwgfx_msg.c
@@@ -232,9 -331,8 +330,14 @@@ static int vmw_recv_msg(struct rpc_chan
  			VMW_HYPERVISOR_MAGIC,
  			eax, ebx, ecx, edx, si, di);
  
++<<<<<<< HEAD
 +		if ((HIGH_WORD(ecx) & MESSAGE_STATUS_SUCCESS) == 0 ||
 +		    (HIGH_WORD(ecx) & MESSAGE_STATUS_HB) == 0) {
 +			DRM_ERROR("Failed to get reply size\n");
++=======
+ 		if ((HIGH_WORD(ecx) & MESSAGE_STATUS_SUCCESS) == 0) {
+ 			DRM_ERROR("Failed to get reply size for host message.\n");
++>>>>>>> cc0ba0d8624f (drm/vmwgfx: Use the backdoor port if the HB port is not available)
  			return -EINVAL;
  		}
  
* Unmerged path drivers/gpu/drm/vmwgfx/vmwgfx_msg.c
