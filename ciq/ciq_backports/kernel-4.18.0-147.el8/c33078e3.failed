net/ipv4: Update inet_dump_ifaddr for strict data checking

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-147.el8
Rebuild_CHGLOG: - [net] ipv4: Update inet_dump_ifaddr for strict data checking (Petr Oros) [1700306]
Rebuild_FUZZ: 96.43%
commit-author David Ahern <dsahern@gmail.com>
commit c33078e3dfb194489b2f0875f078dc76647cfecf
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-147.el8/c33078e3.failed

Update inet_dump_ifaddr for strict data checking. If the flag is set,
the dump request is expected to have an ifaddrmsg struct as the header
potentially followed by one or more attributes. Any data passed in the
header or as an attribute is taken as a request to influence the data
returned. Only values supported by the dump handler are allowed to be
non-0 or set in the request. At the moment only the IFA_TARGET_NETNSID
attribute is supported. Follow on patches can support for other fields
(e.g., honor ifa_index and only return data for the given device index).

	Signed-off-by: David Ahern <dsahern@gmail.com>
	Acked-by: Christian Brauner <christian@brauner.io>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit c33078e3dfb194489b2f0875f078dc76647cfecf)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/ipv4/devinet.c
diff --cc net/ipv4/devinet.c
index 75de6e329fa1,6f2bbd04e950..000000000000
--- a/net/ipv4/devinet.c
+++ b/net/ipv4/devinet.c
@@@ -1683,16 -1737,13 +1736,20 @@@ static int inet_dump_ifaddr(struct sk_b
  	s_idx = idx = cb->args[1];
  	s_ip_idx = ip_idx = cb->args[2];
  
++<<<<<<< HEAD
 +	if (nlmsg_parse(cb->nlh, sizeof(struct ifaddrmsg), tb, IFA_MAX,
 +			ifa_ipv4_policy, NULL) >= 0) {
 +		if (tb[IFA_TARGET_NETNSID]) {
 +			fillargs.netnsid = nla_get_s32(tb[IFA_TARGET_NETNSID]);
- 
- 			tgt_net = rtnl_get_net_ns_capable(skb->sk,
- 							  fillargs.netnsid);
- 			if (IS_ERR(tgt_net))
- 				return PTR_ERR(tgt_net);
- 		}
++=======
+ 	if (cb->strict_check) {
+ 		int err;
++>>>>>>> c33078e3dfb1 (net/ipv4: Update inet_dump_ifaddr for strict data checking)
+ 
+ 		err = inet_valid_dump_ifaddr_req(nlh, &fillargs, &tgt_net,
+ 						 skb->sk, cb->extack);
+ 		if (err < 0)
+ 			return err;
  	}
  
  	for (h = s_h; h < NETDEV_HASHENTRIES; h++, s_idx = 0) {
* Unmerged path net/ipv4/devinet.c
