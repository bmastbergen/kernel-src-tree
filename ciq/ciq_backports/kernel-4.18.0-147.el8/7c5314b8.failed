perf/x86/intel: Add quirk for Goldmont Plus

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-147.el8
commit-author Kan Liang <kan.liang@linux.intel.com>
commit 7c5314b88da6d5af98239786772a1c44cc5eb67d
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-147.el8/7c5314b8.failed

A ucode patch is needed for Goldmont Plus while counter freezing feature
is enabled. Otherwise, there will be some issues, e.g. PMI flood with
some events.

Add a quirk to check microcode version. If the system starts with the
wrong ucode, leave the counter-freezing feature permanently disabled.

	Signed-off-by: Kan Liang <kan.liang@linux.intel.com>
	Signed-off-by: Peter Zijlstra (Intel) <peterz@infradead.org>
	Cc: Alexander Shishkin <alexander.shishkin@linux.intel.com>
	Cc: Arnaldo Carvalho de Melo <acme@redhat.com>
	Cc: Jiri Olsa <jolsa@redhat.com>
	Cc: Linus Torvalds <torvalds@linux-foundation.org>
	Cc: Peter Zijlstra <peterz@infradead.org>
	Cc: Stephane Eranian <eranian@google.com>
	Cc: Thomas Gleixner <tglx@linutronix.de>
	Cc: Vince Weaver <vincent.weaver@maine.edu>
	Cc: acme@kernel.org
Link: http://lkml.kernel.org/r/1533712328-2834-3-git-send-email-kan.liang@linux.intel.com
	Signed-off-by: Ingo Molnar <mingo@kernel.org>
(cherry picked from commit 7c5314b88da6d5af98239786772a1c44cc5eb67d)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/x86/events/intel/core.c
diff --cc arch/x86/events/intel/core.c
index c3ae994239fd,ab01ef9ddd77..000000000000
--- a/arch/x86/events/intel/core.c
+++ b/arch/x86/events/intel/core.c
@@@ -4290,7 -4221,8 +4324,12 @@@ __init int intel_pmu_init(void
  		name = "goldmont";
  		break;
  
++<<<<<<< HEAD
 +	case INTEL_FAM6_ATOM_GEMINI_LAKE:
++=======
+ 	case INTEL_FAM6_ATOM_GOLDMONT_PLUS:
+ 		x86_add_quirk(intel_glp_counter_freezing_quirk);
++>>>>>>> 7c5314b88da6 (perf/x86/intel: Add quirk for Goldmont Plus)
  		memcpy(hw_cache_event_ids, glp_hw_cache_event_ids,
  		       sizeof(hw_cache_event_ids));
  		memcpy(hw_cache_extra_regs, glp_hw_cache_extra_regs,
* Unmerged path arch/x86/events/intel/core.c
