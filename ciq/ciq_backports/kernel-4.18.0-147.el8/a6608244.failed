crypto: bcm - Forbid 2-key 3DES in FIPS mode

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-147.el8
commit-author Herbert Xu <herbert@gondor.apana.org.au>
commit a66082441369339033841ba554ef41150bb900e2
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-147.el8/a6608244.failed

This patch forbids the use of 2-key 3DES (K1 == K3) in FIPS mode.

	Signed-off-by: Herbert Xu <herbert@gondor.apana.org.au>
(cherry picked from commit a66082441369339033841ba554ef41150bb900e2)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/crypto/bcm/cipher.c
diff --cc drivers/crypto/bcm/cipher.c
index 309c67c7012f,8862200d4a0b..000000000000
--- a/drivers/crypto/bcm/cipher.c
+++ b/drivers/crypto/bcm/cipher.c
@@@ -2905,13 -2886,13 +2906,18 @@@ static int aead_authenc_setkey(struct c
  		break;
  	case CIPHER_ALG_3DES:
  		if (ctx->enckeylen == (DES_KEY_SIZE * 3)) {
++<<<<<<< HEAD
 +			const u32 *K = (const u32 *)key;
 +			u32 flags = CRYPTO_TFM_RES_BAD_KEY_SCHED;
++=======
+ 			u32 flags;
++>>>>>>> a66082441369 (crypto: bcm - Forbid 2-key 3DES in FIPS mode)
  
- 			if (!((K[0] ^ K[2]) | (K[1] ^ K[3])) ||
- 			    !((K[2] ^ K[4]) | (K[3] ^ K[5]))) {
+ 			flags = crypto_aead_get_flags(cipher);
+ 			ret = __des3_verify_key(&flags, keys.enckey);
+ 			if (unlikely(ret)) {
  				crypto_aead_set_flags(cipher, flags);
- 				return -EINVAL;
+ 				return ret;
  			}
  
  			ctx->cipher_type = CIPHER_TYPE_3DES;
* Unmerged path drivers/crypto/bcm/cipher.c
