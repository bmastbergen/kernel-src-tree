crypto: rockchip - Forbid 2-key 3DES in FIPS mode

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-147.el8
commit-author Herbert Xu <herbert@gondor.apana.org.au>
commit 1ad2267cb6202002f318103e12233fea7a60671a
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-147.el8/1ad2267c.failed

This patch forbids the use of 2-key 3DES (K1 == K3) in FIPS mode.

It also removes a couple of unnecessary key length checks that
are already performed by the crypto API.

	Signed-off-by: Herbert Xu <herbert@gondor.apana.org.au>
(cherry picked from commit 1ad2267cb6202002f318103e12233fea7a60671a)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/crypto/rockchip/rk3288_crypto_ablkcipher.c
diff --cc drivers/crypto/rockchip/rk3288_crypto_ablkcipher.c
index 639c15c5364b,7d02c97be18d..000000000000
--- a/drivers/crypto/rockchip/rk3288_crypto_ablkcipher.c
+++ b/drivers/crypto/rockchip/rk3288_crypto_ablkcipher.c
@@@ -58,12 -59,23 +59,32 @@@ static int rk_des_setkey(struct crypto_
  		return -EINVAL;
  	}
  
++<<<<<<< HEAD
 +	if (keylen == DES_KEY_SIZE) {
 +		if (!des_ekey(tmp, key) &&
 +		    (tfm->crt_flags & CRYPTO_TFM_REQ_WEAK_KEY)) {
 +			tfm->crt_flags |= CRYPTO_TFM_RES_WEAK_KEY;
 +			return -EINVAL;
 +		}
++=======
+ 	ctx->keylen = keylen;
+ 	memcpy_toio(ctx->dev->reg + RK_CRYPTO_TDES_KEY1_0, key, keylen);
+ 	return 0;
+ }
+ 
+ static int rk_tdes_setkey(struct crypto_ablkcipher *cipher,
+ 			  const u8 *key, unsigned int keylen)
+ {
+ 	struct rk_cipher_ctx *ctx = crypto_ablkcipher_ctx(cipher);
+ 	u32 flags;
+ 	int err;
+ 
+ 	flags = crypto_ablkcipher_get_flags(cipher);
+ 	err = __des3_verify_key(&flags, key);
+ 	if (unlikely(err)) {
+ 		crypto_ablkcipher_set_flags(cipher, flags);
+ 		return err;
++>>>>>>> 1ad2267cb620 (crypto: rockchip - Forbid 2-key 3DES in FIPS mode)
  	}
  
  	ctx->keylen = keylen;
* Unmerged path drivers/crypto/rockchip/rk3288_crypto_ablkcipher.c
