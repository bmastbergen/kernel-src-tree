scsi: qla2xxx: Return switch command on a timeout

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-147.el8
commit-author Himanshu Madhani <himanshu.madhani@cavium.com>
commit ef801f07e7b3cc1786d8ab1b4fdf069cc2a136d2
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-147.el8/ef801f07.failed

This patch fixes commit bcc71cc3cde1 ("scsi: qla2xxx: Fix for double
free of SRB structure") which placed code in wrong routines.

Also updated the use of WARN_ON() to WARN_ON_ONCE() to prevent
flooding log messages.

Fixes: bcc71cc3cde1 ("scsi: qla2xxx: Fix for double free of SRB structure")
	Signed-off-by: Himanshu Madhani <himanshu.madhani@cavium.com>
	Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
(cherry picked from commit ef801f07e7b3cc1786d8ab1b4fdf069cc2a136d2)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/scsi/qla2xxx/qla_init.c
diff --cc drivers/scsi/qla2xxx/qla_init.c
index 92877aa6a237,c72d8012fe2a..000000000000
--- a/drivers/scsi/qla2xxx/qla_init.c
+++ b/drivers/scsi/qla2xxx/qla_init.c
@@@ -659,6 -792,10 +659,13 @@@ qla24xx_async_gnl_sp_done(void *s, int 
  	    sp->name, res, sp->u.iocb_cmd.u.mbx.in_mb[1],
  	    sp->u.iocb_cmd.u.mbx.in_mb[2]);
  
++<<<<<<< HEAD
++=======
+ 	if (res == QLA_FUNCTION_TIMEOUT)
+ 		return;
+ 
+ 	sp->fcport->flags &= ~(FCF_ASYNC_SENT|FCF_ASYNC_ACTIVE);
++>>>>>>> ef801f07e7b3 (scsi: qla2xxx: Return switch command on a timeout)
  	memset(&ea, 0, sizeof(ea));
  	ea.sp = sp;
  	ea.rc = res;
* Unmerged path drivers/scsi/qla2xxx/qla_init.c
