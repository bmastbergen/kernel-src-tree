net/mlx5: FW tracer, Enable tracing

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-147.el8
commit-author Feras Daoud <ferasda@mellanox.com>
commit 244069532fa25183c37305e002d6e26396dadeb0
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-147.el8/24406953.failed

Add the tracer file to the makefile and add the init
function to the load one flow.

	Signed-off-by: Feras Daoud <ferasda@mellanox.com>
	Signed-off-by: Saeed Mahameed <saeedm@mellanox.com>
(cherry picked from commit 244069532fa25183c37305e002d6e26396dadeb0)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/mellanox/mlx5/core/Makefile
#	drivers/net/ethernet/mellanox/mlx5/core/diag/fw_tracer.h
#	drivers/net/ethernet/mellanox/mlx5/core/main.c
diff --cc drivers/net/ethernet/mellanox/mlx5/core/Makefile
index a094c09dfaa9,55d5a5c2e9d8..000000000000
--- a/drivers/net/ethernet/mellanox/mlx5/core/Makefile
+++ b/drivers/net/ethernet/mellanox/mlx5/core/Makefile
@@@ -14,48 -5,29 +14,53 @@@ obj-$(CONFIG_MLX5_CORE) += mlx5_core.
  mlx5_core-y :=	main.o cmd.o debugfs.o fw.o eq.o uar.o pagealloc.o \
  		health.o mcg.o cq.o srq.o alloc.o qp.o port.o mr.o pd.o \
  		mad.o transobj.o vport.o sriov.o fs_cmd.o fs_core.o \
++<<<<<<< HEAD
 +		fs_counters.o rl.o lag.o dev.o wq.o lib/gid.o  \
 +		diag/fs_tracepoint.o
++=======
+ 		fs_counters.o rl.o lag.o dev.o wq.o lib/gid.o lib/clock.o \
+ 		diag/fs_tracepoint.o diag/fw_tracer.o
++>>>>>>> 244069532fa2 (net/mlx5: FW tracer, Enable tracing)
  
 -mlx5_core-$(CONFIG_MLX5_ACCEL) += accel/ipsec.o accel/tls.o
 -
 -mlx5_core-$(CONFIG_MLX5_FPGA) += fpga/cmd.o fpga/core.o fpga/conn.o fpga/sdk.o \
 -		fpga/ipsec.o fpga/tls.o
 -
 +#
 +# Netdev basic
 +#
  mlx5_core-$(CONFIG_MLX5_CORE_EN) += en_main.o en_common.o en_fs.o en_ethtool.o \
 -		en_tx.o en_rx.o en_dim.o en_txrx.o en_accel/rxtx.o en_stats.o  \
 -		vxlan.o en_arfs.o en_fs_ethtool.o en_selftest.o en/port.o
 +		en_tx.o en_rx.o en_dim.o en_txrx.o en/xdp.o en_stats.o \
 +		en_selftest.o en/port.o
  
 -mlx5_core-$(CONFIG_MLX5_MPFS) += lib/mpfs.o
 +#
 +# Netdev extra
 +#
 +mlx5_core-$(CONFIG_MLX5_EN_ARFS)     += en_arfs.o
 +mlx5_core-$(CONFIG_MLX5_EN_RXNFC)    += en_fs_ethtool.o
 +mlx5_core-$(CONFIG_MLX5_CORE_EN_DCB) += en_dcbnl.o en/port_buffer.o
 +mlx5_core-$(CONFIG_MLX5_ESWITCH)     += en_rep.o en_tc.o
  
 -mlx5_core-$(CONFIG_MLX5_ESWITCH) += eswitch.o eswitch_offloads.o en_rep.o en_tc.o
 -
 -mlx5_core-$(CONFIG_MLX5_CORE_EN_DCB) +=  en_dcbnl.o en/port_buffer.o
 +#
 +# Core extra
 +#
 +mlx5_core-$(CONFIG_MLX5_ESWITCH)   += eswitch.o eswitch_offloads.o
 +mlx5_core-$(CONFIG_MLX5_MPFS)      += lib/mpfs.o
 +mlx5_core-$(CONFIG_VXLAN)          += lib/vxlan.o
 +mlx5_core-$(CONFIG_PTP_1588_CLOCK) += lib/clock.o
  
 +#
 +# Ipoib netdev
 +#
  mlx5_core-$(CONFIG_MLX5_CORE_IPOIB) += ipoib/ipoib.o ipoib/ethtool.o ipoib/ipoib_vlan.o
  
 +#
 +# Accelerations & FPGA
 +#
 +mlx5_core-$(CONFIG_MLX5_ACCEL) += accel/ipsec.o accel/tls.o
 +
 +mlx5_core-$(CONFIG_MLX5_FPGA) += fpga/cmd.o fpga/core.o fpga/conn.o fpga/sdk.o \
 +				 fpga/ipsec.o fpga/tls.o
 +
  mlx5_core-$(CONFIG_MLX5_EN_IPSEC) += en_accel/ipsec.o en_accel/ipsec_rxtx.o \
 -		en_accel/ipsec_stats.o
 +				     en_accel/ipsec_stats.o
  
 -mlx5_core-$(CONFIG_MLX5_EN_TLS) +=  en_accel/tls.o en_accel/tls_rxtx.o en_accel/tls_stats.o
 +mlx5_core-$(CONFIG_MLX5_EN_TLS) += en_accel/tls.o en_accel/tls_rxtx.o en_accel/tls_stats.o
  
  CFLAGS_tracepoint.o := -I$(src)
diff --cc drivers/net/ethernet/mellanox/mlx5/core/main.c
index 6b26f884f287,6ddbb70e95de..000000000000
--- a/drivers/net/ethernet/mellanox/mlx5/core/main.c
+++ b/drivers/net/ethernet/mellanox/mlx5/core/main.c
@@@ -62,7 -62,7 +62,11 @@@
  #include "accel/ipsec.h"
  #include "accel/tls.h"
  #include "lib/clock.h"
++<<<<<<< HEAD
 +#include "lib/vxlan.h"
++=======
+ #include "diag/fw_tracer.h"
++>>>>>>> 244069532fa2 (net/mlx5: FW tracer, Enable tracing)
  
  MODULE_AUTHOR("Eli Cohen <eli@mellanox.com>");
  MODULE_DESCRIPTION("Mellanox 5th generation network adapters (ConnectX series) core driver");
* Unmerged path drivers/net/ethernet/mellanox/mlx5/core/diag/fw_tracer.h
* Unmerged path drivers/net/ethernet/mellanox/mlx5/core/Makefile
* Unmerged path drivers/net/ethernet/mellanox/mlx5/core/diag/fw_tracer.h
* Unmerged path drivers/net/ethernet/mellanox/mlx5/core/main.c
