KVM: arm64: Add a capability to advertise SVE support

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-147.el8
commit-author Dave Martin <Dave.Martin@arm.com>
commit 555f3d03e7fb43a539050aee91337978da14a25e
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-147.el8/555f3d03.failed

To provide a uniform way to check for KVM SVE support amongst other
features, this patch adds a suitable capability KVM_CAP_ARM_SVE,
and reports it as present when SVE is available.

	Signed-off-by: Dave Martin <Dave.Martin@arm.com>
	Reviewed-by: Julien Thierry <julien.thierry@arm.com>
	Tested-by: zhang.lei <zhang.lei@jp.fujitsu.com>
	Signed-off-by: Marc Zyngier <marc.zyngier@arm.com>
(cherry picked from commit 555f3d03e7fb43a539050aee91337978da14a25e)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	include/uapi/linux/kvm.h
diff --cc include/uapi/linux/kvm.h
index f0694ccb9051,1d564445b515..000000000000
--- a/include/uapi/linux/kvm.h
+++ b/include/uapi/linux/kvm.h
@@@ -964,7 -981,14 +964,13 @@@ struct kvm_ppc_resize_hpt 
  #define KVM_CAP_ARM_INJECT_SERROR_ESR 158
  #define KVM_CAP_MSR_PLATFORM_INFO 159
  #define KVM_CAP_PPC_NESTED_HV 160
 -#define KVM_CAP_HYPERV_SEND_IPI 161
 -#define KVM_CAP_COALESCED_PIO 162
 -#define KVM_CAP_HYPERV_ENLIGHTENED_VMCS 163
 -#define KVM_CAP_EXCEPTION_PAYLOAD 164
  #define KVM_CAP_ARM_VM_IPA_SIZE 165
++<<<<<<< HEAD
++=======
+ #define KVM_CAP_MANUAL_DIRTY_LOG_PROTECT 166
+ #define KVM_CAP_HYPERV_CPUID 167
+ #define KVM_CAP_ARM_SVE 168
++>>>>>>> 555f3d03e7fb (KVM: arm64: Add a capability to advertise SVE support)
  
  #ifdef KVM_CAP_IRQ_ROUTING
  
diff --git a/arch/arm64/kvm/reset.c b/arch/arm64/kvm/reset.c
index 9b8e8bd8b60b..bdbf9245f3cf 100644
--- a/arch/arm64/kvm/reset.c
+++ b/arch/arm64/kvm/reset.c
@@ -88,6 +88,9 @@ int kvm_arch_vm_ioctl_check_extension(struct kvm *kvm, long ext)
 	case KVM_CAP_ARM_VM_IPA_SIZE:
 		r = kvm_ipa_limit;
 		break;
+	case KVM_CAP_ARM_SVE:
+		r = system_supports_sve();
+		break;
 	default:
 		r = 0;
 	}
* Unmerged path include/uapi/linux/kvm.h
