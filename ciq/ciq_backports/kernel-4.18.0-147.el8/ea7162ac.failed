net/mlx5e: Refactor VXLAN tunnel encap offloading code

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-147.el8
commit-author Oz Shlomo <ozsh@mellanox.com>
commit ea7162ac3a33a44a7bb0b5793057015d25617e68
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-147.el8/ea7162ac.failed

Separates the vxlan header encap logic from the general ipv4/6
encapsulation methods, thus allowing the common IP encap/decap code to
branch in downstream patch to multiple IP tunnels.

Code refactoring with no functional change.

	Signed-off-by: Oz Shlomo <ozsh@mellanox.com>
	Reviewed-by: Eli Britstein <elibr@mellanox.com>
	Reviewed-by: Or Gerlitz <ogerlitz@mellanox.com>
	Signed-off-by: Saeed Mahameed <saeedm@mellanox.com>
(cherry picked from commit ea7162ac3a33a44a7bb0b5793057015d25617e68)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/mellanox/mlx5/core/en_tc.c
diff --cc drivers/net/ethernet/mellanox/mlx5/core/en_tc.c
index c9ee89f4edb1,ed04ab8287e9..000000000000
--- a/drivers/net/ethernet/mellanox/mlx5/core/en_tc.c
+++ b/drivers/net/ethernet/mellanox/mlx5/core/en_tc.c
@@@ -2531,15 -2688,11 +2488,21 @@@ static int mlx5e_attach_encap(struct ml
  	uintptr_t hash_key;
  	bool found = false;
  
++<<<<<<< HEAD
 +	/* udp dst port must be set */
 +	if (!memchr_inv(&key->tp_dst, 0, sizeof(key->tp_dst)))
 +		goto vxlan_encap_offload_err;
 +
 +	/* setting udp src port isn't supported */
 +	if (memchr_inv(&key->tp_src, 0, sizeof(key->tp_src))) {
 +vxlan_encap_offload_err:
++=======
+ 	if (!MLX5_CAP_ESW(priv->mdev, vxlan_encap_decap)) {
+ 		NL_SET_ERR_MSG_MOD(extack,
+ 				   "vxlan HW offloading is not supported");
++>>>>>>> ea7162ac3a33 (net/mlx5e: Refactor VXLAN tunnel encap offloading code)
  		netdev_warn(priv->netdev,
- 			    "must set udp dst port and not set udp src port\n");
+ 			    "vxlan HW offloading is not supported\n");
  		return -EOPNOTSUPP;
  	}
  
* Unmerged path drivers/net/ethernet/mellanox/mlx5/core/en_tc.c
