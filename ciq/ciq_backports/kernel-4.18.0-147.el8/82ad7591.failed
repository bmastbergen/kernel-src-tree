ASoC: tlv320aic3x: fix reset gpio reference counting

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-147.el8
Rebuild_CHGLOG: - [sound] ALSA: ASoC: tlv320aic3x: fix reset gpio reference counting (Jaroslav Kysela) [1683051]
Rebuild_FUZZ: 94.55%
commit-author Philipp Puschmann <philipp.puschmann@emlix.com>
commit 82ad759143ed77673db0d93d53c1cde7b99917ee
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-147.el8/82ad7591.failed

This patch fixes a bug that prevents freeing the reset gpio on unloading
the module.

aic3x_i2c_probe is called when loading the module and it calls list_add
with a probably uninitialized list entry aic3x->list (next = prev = NULL)).
So even if list_del is called it does nothing and in the end the gpio_reset
is not freed. Then a repeated module probing fails silently because
gpio_request fails.

When moving INIT_LIST_HEAD to aic3x_i2c_probe we also have to move
list_del to aic3x_i2c_remove because aic3x_remove may be called
multiple times without aic3x_i2c_remove being called which leads to
a NULL pointer dereference.

	Signed-off-by: Philipp Puschmann <philipp.puschmann@emlix.com>
	Signed-off-by: Mark Brown <broonie@kernel.org>
(cherry picked from commit 82ad759143ed77673db0d93d53c1cde7b99917ee)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	sound/soc/codecs/tlv320aic3x.c
diff --cc sound/soc/codecs/tlv320aic3x.c
index 283583d1db60,cea3ebecdb12..000000000000
--- a/sound/soc/codecs/tlv320aic3x.c
+++ b/sound/soc/codecs/tlv320aic3x.c
@@@ -1680,6 -1678,22 +1679,25 @@@ static int aic3x_probe(struct snd_soc_c
  	aic3x_add_widgets(component);
  
  	return 0;
++<<<<<<< HEAD
++=======
+ 
+ err_notif:
+ 	while (i--)
+ 		regulator_unregister_notifier(aic3x->supplies[i].consumer,
+ 					      &aic3x->disable_nb[i].nb);
+ 	return ret;
+ }
+ 
+ static void aic3x_remove(struct snd_soc_component *component)
+ {
+ 	struct aic3x_priv *aic3x = snd_soc_component_get_drvdata(component);
+ 	int i;
+ 
+ 	for (i = 0; i < ARRAY_SIZE(aic3x->supplies); i++)
+ 		regulator_unregister_notifier(aic3x->supplies[i].consumer,
+ 					      &aic3x->disable_nb[i].nb);
++>>>>>>> 82ad759143ed (ASoC: tlv320aic3x: fix reset gpio reference counting)
  }
  
  static const struct snd_soc_component_driver soc_component_dev_aic3x = {
* Unmerged path sound/soc/codecs/tlv320aic3x.c
