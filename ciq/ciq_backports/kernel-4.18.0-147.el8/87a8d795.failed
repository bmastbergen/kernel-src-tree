x86/hyper-v: Stop caring about EOI for direct stimers

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-147.el8
commit-author Vitaly Kuznetsov <vkuznets@redhat.com>
commit 87a8d795b2f1d926b4e831d27144d3e6ab7e33dc
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-147.el8/87a8d795.failed

Turns out we over-engineered Direct Mode for stimers a bit: unlike
traditional stimers where we may want to try to re-inject the message upon
EOI, Direct Mode stimers just set the irq in APIC and kvm_apic_set_irq()
fails only when APIC is disabled (see APIC_DM_FIXED case in
__apic_accept_irq()). Remove the redundant part.

	Suggested-by: Roman Kagan <rkagan@virtuozzo.com>
	Signed-off-by: Vitaly Kuznetsov <vkuznets@redhat.com>
	Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>
(cherry picked from commit 87a8d795b2f1d926b4e831d27144d3e6ab7e33dc)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/x86/kvm/hyperv.c
diff --cc arch/x86/kvm/hyperv.c
index bd5751b7365c,c90a5352d158..000000000000
--- a/arch/x86/kvm/hyperv.c
+++ b/arch/x86/kvm/hyperv.c
@@@ -514,15 -514,18 +514,24 @@@ static int stimer_start(struct kvm_vcpu
  static int stimer_set_config(struct kvm_vcpu_hv_stimer *stimer, u64 config,
  			     bool host)
  {
++<<<<<<< HEAD
 +	union hv_stimer_config new_config = {.as_uint64 = config};
++=======
+ 	union hv_stimer_config new_config = {.as_uint64 = config},
+ 		old_config = {.as_uint64 = stimer->config.as_uint64};
++>>>>>>> 87a8d795b2f1 (x86/hyper-v: Stop caring about EOI for direct stimers)
  
  	trace_kvm_hv_stimer_set_config(stimer_to_vcpu(stimer)->vcpu_id,
  				       stimer->index, config, host);
  
  	stimer_cleanup(stimer);
 -	if (old_config.enable &&
 -	    !new_config.direct_mode && new_config.sintx == 0)
 +	if (stimer->config.enable && new_config.sintx == 0)
  		new_config.enable = 0;
  	stimer->config.as_uint64 = new_config.as_uint64;
++<<<<<<< HEAD
++=======
+ 
++>>>>>>> 87a8d795b2f1 (x86/hyper-v: Stop caring about EOI for direct stimers)
  	stimer_mark_pending(stimer, false);
  	return 0;
  }
* Unmerged path arch/x86/kvm/hyperv.c
