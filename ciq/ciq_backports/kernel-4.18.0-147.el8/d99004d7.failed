drm/crc-debugfs: Also sprinkle irqrestore over early exits

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-147.el8
commit-author Daniel Vetter <daniel.vetter@ffwll.ch>
commit d99004d7201aa653658ff2390d6e516567c96ebc
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-147.el8/d99004d7.failed

I. was. blind.

Caught with vkms, which has some really slow crc computation function.

Fixes: 1882018a70e0 ("drm/crc-debugfs: User irqsafe spinlock in drm_crtc_add_crc_entry")
	Cc: Rodrigo Siqueira <rodrigosiqueiramelo@gmail.com>
	Cc: Tomeu Vizoso <tomeu.vizoso@collabora.com>
	Cc: Emil Velikov <emil.velikov@collabora.com>
	Cc: Benjamin Gaignard <benjamin.gaignard@linaro.org>
	Cc: Ville Syrjälä <ville.syrjala@linux.intel.com>
	Reviewed-by: Emil Velikov <emil.velikov@collabora.com>
	Reviewed-by: Benjamin Gaignard <benjamin.gaignard@linaro.org>
	Signed-off-by: Daniel Vetter <daniel.vetter@intel.com>
Link: https://patchwork.freedesktop.org/patch/msgid/20190606211544.5389-1-daniel.vetter@ffwll.ch
(cherry picked from commit d99004d7201aa653658ff2390d6e516567c96ebc)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/gpu/drm/drm_debugfs_crc.c
diff --cc drivers/gpu/drm/drm_debugfs_crc.c
index e4cf2f7f8ed3,d2f102f01515..000000000000
--- a/drivers/gpu/drm/drm_debugfs_crc.c
+++ b/drivers/gpu/drm/drm_debugfs_crc.c
@@@ -392,8 -410,14 +392,19 @@@ int drm_crtc_add_crc_entry(struct drm_c
  	tail = crc->tail;
  
  	if (CIRC_SPACE(head, tail, DRM_CRC_ENTRIES_NR) < 1) {
++<<<<<<< HEAD
 +		spin_unlock(&crc->lock);
 +		DRM_ERROR("Overflow of CRC buffer, userspace reads too slow.\n");
++=======
+ 		bool was_overflow = crc->overflow;
+ 
+ 		crc->overflow = true;
+ 		spin_unlock_irqrestore(&crc->lock, flags);
+ 
+ 		if (!was_overflow)
+ 			DRM_ERROR("Overflow of CRC buffer, userspace reads too slow.\n");
+ 
++>>>>>>> d99004d7201a (drm/crc-debugfs: Also sprinkle irqrestore over early exits)
  		return -ENOBUFS;
  	}
  
* Unmerged path drivers/gpu/drm/drm_debugfs_crc.c
