drm/amd/display: Set stream->mode_changed when connectors change

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-147.el8
commit-author Nicholas Kazlauskas <nicholas.kazlauskas@amd.com>
commit b9952f93cd2cf5fca82b06a8179c0f5f7b769e83
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-147.el8/b9952f93.failed

[Why]
The kms_plane@plane-position-covered-pipe-*-planes subtests can produce
a sequence of atomic commits such that neither active_changed nor
mode_changed but connectors_changed.

When this happens we remove the old stream from the context and add
a new stream but the new stream doesn't have mode_changed=true set.

This incorrect programming sequence causes CRC mismatches to occur in
the test.

The stream->mode_changed value should be set whenever a new stream
is created.

[How]
A new stream is created whenever drm_atomic_crtc_needs_modeset is true.
We previously covered the active_changed and mode_changed conditions
for the CRTC but connectors_changed is also checked within
drm_atomic_crtc_needs_modeset.

So just use drm_atomic_crtc_needs_modeset directly to determine the
mode_changed flag.

	Signed-off-by: Nicholas Kazlauskas <nicholas.kazlauskas@amd.com>
	Reviewed-by: Sun peng Li <Sunpeng.Li@amd.com>
	Acked-by: Bhawanpreet Lakha <Bhawanpreet.Lakha@amd.com>
	Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
(cherry picked from commit b9952f93cd2cf5fca82b06a8179c0f5f7b769e83)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/gpu/drm/amd/display/amdgpu_dm/amdgpu_dm.c
diff --cc drivers/gpu/drm/amd/display/amdgpu_dm/amdgpu_dm.c
index d656073f676c,b7cc14683065..000000000000
--- a/drivers/gpu/drm/amd/display/amdgpu_dm/amdgpu_dm.c
+++ b/drivers/gpu/drm/amd/display/amdgpu_dm/amdgpu_dm.c
@@@ -4203,7 -4922,7 +4203,11 @@@ static void amdgpu_dm_commit_planes(str
  static void amdgpu_dm_crtc_copy_transient_flags(struct drm_crtc_state *crtc_state,
  						struct dc_stream_state *stream_state)
  {
++<<<<<<< HEAD
 +	stream_state->mode_changed = crtc_state->mode_changed;
++=======
+ 	stream_state->mode_changed = drm_atomic_crtc_needs_modeset(crtc_state);
++>>>>>>> b9952f93cd2c (drm/amd/display: Set stream->mode_changed when connectors change)
  }
  
  static int amdgpu_dm_atomic_commit(struct drm_device *dev,
* Unmerged path drivers/gpu/drm/amd/display/amdgpu_dm/amdgpu_dm.c
