s390/head: avoid doubling early boot stack size under KASAN

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-147.el8
commit-author Vasily Gorbik <gor@linux.ibm.com>
commit 19733fe8721b8d91b799c91082ebb9c139ca6710
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-147.el8/19733fe8.failed

Early boot stack uses predefined 4 pages of memory 0x8000-0xC000. This
stack is used to run not instumented decompressor/facilities
verification C code. It doesn't make sense to double its size when
the kernel is built with KASAN support. BOOT_STACK_ORDER is introduced
to avoid that.

	Signed-off-by: Vasily Gorbik <gor@linux.ibm.com>
	Signed-off-by: Martin Schwidefsky <schwidefsky@de.ibm.com>
(cherry picked from commit 19733fe8721b8d91b799c91082ebb9c139ca6710)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/s390/include/asm/thread_info.h
diff --cc arch/s390/include/asm/thread_info.h
index 3c883c368eb0,27248f42a03c..000000000000
--- a/arch/s390/include/asm/thread_info.h
+++ b/arch/s390/include/asm/thread_info.h
@@@ -11,13 -11,15 +11,18 @@@
  #include <linux/const.h>
  
  /*
 - * General size of kernel stacks
 + * Size of kernel stack for each process
   */
 -#ifdef CONFIG_KASAN
 -#define THREAD_SIZE_ORDER 3
 -#else
  #define THREAD_SIZE_ORDER 2
++<<<<<<< HEAD
 +#define ASYNC_ORDER  2
 +
++=======
+ #endif
+ #define BOOT_STACK_ORDER  2
++>>>>>>> 19733fe8721b (s390/head: avoid doubling early boot stack size under KASAN)
  #define THREAD_SIZE (PAGE_SIZE << THREAD_SIZE_ORDER)
 +#define ASYNC_SIZE  (PAGE_SIZE << ASYNC_ORDER)
  
  #ifndef __ASSEMBLY__
  #include <asm/lowcore.h>
diff --git a/arch/s390/boot/head.S b/arch/s390/boot/head.S
index e209cfe69bb9..ce2cbbc41742 100644
--- a/arch/s390/boot/head.S
+++ b/arch/s390/boot/head.S
@@ -315,7 +315,7 @@ ENTRY(startup_kdump)
 	brasl	%r14,startup_kernel
 
 .Lstack:
-	.long	0x8000 + THREAD_SIZE - STACK_FRAME_OVERHEAD
+	.long	0x8000 + (1<<(PAGE_SHIFT+BOOT_STACK_ORDER)) - STACK_FRAME_OVERHEAD
 	.align	8
 6:	.long	0x7fffffff,0xffffffff
 
* Unmerged path arch/s390/include/asm/thread_info.h
