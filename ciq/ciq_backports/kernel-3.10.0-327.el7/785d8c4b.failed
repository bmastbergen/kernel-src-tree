ALSA: hda - add hda_intel_trace.h

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-327.el7
Rebuild_CHGLOG: - [alsa] hda - add hda_intel_trace.h (Jaroslav Kysela) [1197064]
Rebuild_FUZZ: 90.00%
commit-author Libin Yang <libin.yang@intel.com>
commit 785d8c4be82b45d10ff0d5cebfddadb1e1f6ae15
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-327.el7/785d8c4b.failed

This patch creates hda_intel_trace.h to add some pm trace functions
used in hda_intel.c

	Signed-off-by: Libin Yang <libin.yang@intel.com>
	Signed-off-by: Takashi Iwai <tiwai@suse.de>
(cherry picked from commit 785d8c4be82b45d10ff0d5cebfddadb1e1f6ae15)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	sound/pci/hda/hda_intel_trace.h
diff --cc sound/pci/hda/hda_intel_trace.h
index 7b5e4c2cf9d5,0922d8b1b17d..000000000000
--- a/sound/pci/hda/hda_intel_trace.h
+++ b/sound/pci/hda/hda_intel_trace.h
@@@ -7,53 -7,44 +7,94 @@@
  
  #include <linux/tracepoint.h>
  
++<<<<<<< HEAD
 +struct azx;
 +struct azx_dev;
 +
 +TRACE_EVENT(azx_pcm_trigger,
 +
 +	TP_PROTO(struct azx *chip, struct azx_dev *dev, int cmd),
 +
 +	TP_ARGS(chip, dev, cmd),
 +
 +	TP_STRUCT__entry(
 +		__field( int, card )
 +		__field( int, idx )
 +		__field( int, cmd )
 +	),
 +
 +	TP_fast_assign(
 +		__entry->card = (chip)->card->number;
 +		__entry->idx = (dev)->index;
 +		__entry->cmd = cmd;
 +	),
 +
 +	TP_printk("[%d:%d] cmd=%d", __entry->card, __entry->idx, __entry->cmd)
 +);
 +
 +TRACE_EVENT(azx_get_position,
 +
 +    TP_PROTO(struct azx *chip, struct azx_dev *dev, unsigned int pos, unsigned int delay),
 +
 +	    TP_ARGS(chip, dev, pos, delay),
 +
 +	TP_STRUCT__entry(
 +		__field( int, card )
 +		__field( int, idx )
 +		__field( unsigned int, pos )
 +		__field( unsigned int, delay )
 +	),
 +
 +	TP_fast_assign(
 +		__entry->card = (chip)->card->number;
 +		__entry->idx = (dev)->index;
 +		__entry->pos = pos;
 +		__entry->delay = delay;
 +	),
 +
 +	TP_printk("[%d:%d] pos=%u, delay=%u", __entry->card, __entry->idx, __entry->pos, __entry->delay)
 +);
 +
++=======
+ DECLARE_EVENT_CLASS(hda_pm,
+ 	TP_PROTO(struct azx *chip),
+ 
+ 	TP_ARGS(chip),
+ 
+ 	TP_STRUCT__entry(
+ 		__field(int, dev_index)
+ 	),
+ 
+ 	TP_fast_assign(
+ 		__entry->dev_index = (chip)->dev_index;
+ 	),
+ 
+ 	TP_printk("card index: %d", __entry->dev_index)
+ );
+ 
+ DEFINE_EVENT(hda_pm, azx_suspend,
+ 	TP_PROTO(struct azx *chip),
+ 	TP_ARGS(chip)
+ );
+ 
+ DEFINE_EVENT(hda_pm, azx_resume,
+ 	TP_PROTO(struct azx *chip),
+ 	TP_ARGS(chip)
+ );
+ 
+ #ifdef CONFIG_PM
+ DEFINE_EVENT(hda_pm, azx_runtime_suspend,
+ 	TP_PROTO(struct azx *chip),
+ 	TP_ARGS(chip)
+ );
+ 
+ DEFINE_EVENT(hda_pm, azx_runtime_resume,
+ 	TP_PROTO(struct azx *chip),
+ 	TP_ARGS(chip)
+ );
+ #endif
+ 
++>>>>>>> 785d8c4be82b (ALSA: hda - add hda_intel_trace.h)
  #endif /* _TRACE_HDA_INTEL_H */
  
  /* This part must be outside protection */
diff --git a/sound/pci/hda/Makefile b/sound/pci/hda/Makefile
index 96caaebfc19d..941c619e7f31 100644
--- a/sound/pci/hda/Makefile
+++ b/sound/pci/hda/Makefile
@@ -12,6 +12,7 @@ snd-hda-codec-$(CONFIG_SND_HDA_INPUT_BEEP) += hda_beep.o
 # for trace-points
 CFLAGS_hda_codec.o := -I$(src)
 CFLAGS_hda_controller.o := -I$(src)
+CFLAGS_hda_intel.o := -I$(src)
 
 snd-hda-codec-generic-objs :=	hda_generic.o
 snd-hda-codec-realtek-objs :=	patch_realtek.o
diff --git a/sound/pci/hda/hda_intel.c b/sound/pci/hda/hda_intel.c
index e1c964381edc..7d344d52029b 100644
--- a/sound/pci/hda/hda_intel.c
+++ b/sound/pci/hda/hda_intel.c
@@ -65,6 +65,9 @@
 #include "hda_priv.h"
 #include "hda_intel.h"
 
+#define CREATE_TRACE_POINTS
+#include "hda_intel_trace.h"
+
 /* position fix mode */
 enum {
 	POS_FIX_AUTO,
@@ -813,6 +816,8 @@ static int azx_suspend(struct device *dev)
 		pci_disable_msi(chip->pci);
 	if (chip->driver_caps & AZX_DCAPS_I915_POWERWELL)
 		hda_display_power(hda, false);
+
+	trace_azx_suspend(chip);
 	return 0;
 }
 
@@ -845,6 +850,8 @@ static int azx_resume(struct device *dev)
 	hda_intel_init_chip(chip, true);
 
 	snd_power_change_state(card, SNDRV_CTL_POWER_D0);
+
+	trace_azx_resume(chip);
 	return 0;
 }
 #endif /* CONFIG_PM_SLEEP || SUPPORT_VGA_SWITCHEROO */
@@ -877,6 +884,7 @@ static int azx_runtime_suspend(struct device *dev)
 	if (chip->driver_caps & AZX_DCAPS_I915_POWERWELL)
 		hda_display_power(hda, false);
 
+	trace_azx_runtime_suspend(chip);
 	return 0;
 }
 
@@ -926,6 +934,7 @@ static int azx_runtime_resume(struct device *dev)
 	azx_writew(chip, WAKEEN, azx_readw(chip, WAKEEN) &
 			~STATESTS_INT_MASK);
 
+	trace_azx_runtime_resume(chip);
 	return 0;
 }
 
* Unmerged path sound/pci/hda/hda_intel_trace.h
