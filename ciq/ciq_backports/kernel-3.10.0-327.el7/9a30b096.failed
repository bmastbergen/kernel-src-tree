blk-mq: fix use of incorrect goto label in blk_mq_init_queue error path

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-327.el7
commit-author Mike Snitzer <snitzer@redhat.com>
commit 9a30b096b543932de218dd3501b5562e00a8792d
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-327.el7/9a30b096.failed

If percpu_ref_init() fails the allocated q and hctxs must get cleaned
up; using 'err_map' doesn't allow that to happen.

	Signed-off-by: Mike Snitzer <snitzer@redhat.com>
	Reviewed-by: Ming Lei <ming.lei@canonical.com>
	Cc: stable@kernel.org
	Signed-off-by: Jens Axboe <axboe@fb.com>
(cherry picked from commit 9a30b096b543932de218dd3501b5562e00a8792d)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	block/blk-mq.c
diff --cc block/blk-mq.c
index 77afc91943c8,b7b8933ec241..000000000000
--- a/block/blk-mq.c
+++ b/block/blk-mq.c
@@@ -1811,8 -1932,13 +1811,18 @@@ struct request_queue *blk_mq_init_queue
  	if (!q)
  		goto err_hctxs;
  
++<<<<<<< HEAD
 +	if (percpu_ref_init(&q->mq_usage_counter, blk_mq_usage_counter_release))
 +		goto err_map;
++=======
+ 	/*
+ 	 * Init percpu_ref in atomic mode so that it's faster to shutdown.
+ 	 * See blk_register_queue() for details.
+ 	 */
+ 	if (percpu_ref_init(&q->mq_usage_counter, blk_mq_usage_counter_release,
+ 			    PERCPU_REF_INIT_ATOMIC, GFP_KERNEL))
+ 		goto err_mq_usage;
++>>>>>>> 9a30b096b543 (blk-mq: fix use of incorrect goto label in blk_mq_init_queue error path)
  
  	setup_timer(&q->timeout, blk_mq_rq_timer, (unsigned long) q);
  	blk_queue_rq_timeout(q, 30000);
@@@ -1870,9 -1993,7 +1880,13 @@@
  
  	return q;
  
++<<<<<<< HEAD
 +err_hw_queues:
 +	blk_mq_exit_hw_queues(q, set, set->nr_hw_queues);
 +err_hw:
++=======
+ err_mq_usage:
++>>>>>>> 9a30b096b543 (blk-mq: fix use of incorrect goto label in blk_mq_init_queue error path)
  	blk_cleanup_queue(q);
  err_hctxs:
  	kfree(map);
* Unmerged path block/blk-mq.c
