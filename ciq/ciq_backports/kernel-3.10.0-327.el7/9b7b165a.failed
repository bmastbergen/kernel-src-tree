bonding: drop read_lock in bond_fix_features

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-327.el7
commit-author nikolay@redhat.com <nikolay@redhat.com>
commit 9b7b165ac1adf5169f0ee03d107423ce7f5805d9
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-327.el7/9b7b165a.failed

We're protected by RTNL so nothing can happen and we can safely drop the
read bond->lock.

	Signed-off-by: Nikolay Aleksandrov <nikolay@redhat.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 9b7b165ac1adf5169f0ee03d107423ce7f5805d9)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/bonding/bond_main.c
diff --cc drivers/net/bonding/bond_main.c
index 0def7e7abf50,c5ebdc57948f..000000000000
--- a/drivers/net/bonding/bond_main.c
+++ b/drivers/net/bonding/bond_main.c
@@@ -1311,15 -1084,18 +1311,25 @@@ static void bond_netpoll_cleanup(struc
  /*---------------------------------- IOCTL ----------------------------------*/
  
  static netdev_features_t bond_fix_features(struct net_device *dev,
- 	netdev_features_t features)
+ 					   netdev_features_t features)
  {
- 	struct slave *slave;
  	struct bonding *bond = netdev_priv(dev);
  	netdev_features_t mask;
++<<<<<<< HEAD
 +	int i;
 +
 +	read_lock(&bond->lock);
 +
++=======
+ 	struct slave *slave;
+ 
+ 	if (list_empty(&bond->slave_list)) {
+ 		/* Disable adding VLANs to empty bond. But why? --mq */
+ 		features |= NETIF_F_VLAN_CHALLENGED;
+ 		return features;
+ 	}
+ 
++>>>>>>> 9b7b165ac1ad (bonding: drop read_lock in bond_fix_features)
  	mask = features;
  	features &= ~NETIF_F_ONE_FOR_ALL;
  	features |= NETIF_F_ALL_FOR_ALL;
@@@ -1331,7 -1107,6 +1341,10 @@@
  	}
  	features = netdev_add_tso_features(features, mask);
  
++<<<<<<< HEAD
 +	read_unlock(&bond->lock);
++=======
++>>>>>>> 9b7b165ac1ad (bonding: drop read_lock in bond_fix_features)
  	return features;
  }
  
* Unmerged path drivers/net/bonding/bond_main.c
