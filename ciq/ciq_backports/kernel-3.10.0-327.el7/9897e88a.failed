KVM: PPC: Remove kvmppc_bad_hva()

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-327.el7
Rebuild_CHGLOG: - [kvm] ppc: Remove kvmppc_bad_hva() (Thomas Huth) [1226884 1227323]
Rebuild_FUZZ: 91.80%
commit-author Alexander Graf <agraf@suse.de>
commit 9897e88a79e1c6a3c5bbe74eccd64c4ba32a3b19
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-327.el7/9897e88a.failed

We have a proper define for invalid HVA numbers. Use those instead of the
ppc specific kvmppc_bad_hva().

	Signed-off-by: Alexander Graf <agraf@suse.de>
(cherry picked from commit 9897e88a79e1c6a3c5bbe74eccd64c4ba32a3b19)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/powerpc/kvm/powerpc.c
diff --cc arch/powerpc/kvm/powerpc.c
index bf2571061516,3d59730a7802..000000000000
--- a/arch/powerpc/kvm/powerpc.c
+++ b/arch/powerpc/kvm/powerpc.c
@@@ -310,6 -309,82 +310,85 @@@ int kvmppc_emulate_mmio(struct kvm_run 
  }
  EXPORT_SYMBOL_GPL(kvmppc_emulate_mmio);
  
++<<<<<<< HEAD
++=======
+ static hva_t kvmppc_pte_to_hva(struct kvm_vcpu *vcpu, struct kvmppc_pte *pte)
+ {
+ 	hva_t hpage;
+ 
+ 	hpage = gfn_to_hva(vcpu->kvm, pte->raddr >> PAGE_SHIFT);
+ 	if (kvm_is_error_hva(hpage))
+ 		goto err;
+ 
+ 	return hpage | (pte->raddr & ~PAGE_MASK);
+ err:
+ 	return KVM_HVA_ERR_BAD;
+ }
+ 
+ int kvmppc_st(struct kvm_vcpu *vcpu, ulong *eaddr, int size, void *ptr,
+ 	      bool data)
+ {
+ 	struct kvmppc_pte pte;
+ 	int r;
+ 
+ 	vcpu->stat.st++;
+ 
+ 	r = kvmppc_xlate(vcpu, *eaddr, data ? XLATE_DATA : XLATE_INST,
+ 			 XLATE_WRITE, &pte);
+ 	if (r < 0)
+ 		return r;
+ 
+ 	*eaddr = pte.raddr;
+ 
+ 	if (!pte.may_write)
+ 		return -EPERM;
+ 
+ 	if (kvm_write_guest(vcpu->kvm, pte.raddr, ptr, size))
+ 		return EMULATE_DO_MMIO;
+ 
+ 	return EMULATE_DONE;
+ }
+ EXPORT_SYMBOL_GPL(kvmppc_st);
+ 
+ int kvmppc_ld(struct kvm_vcpu *vcpu, ulong *eaddr, int size, void *ptr,
+ 		      bool data)
+ {
+ 	struct kvmppc_pte pte;
+ 	hva_t hva = *eaddr;
+ 	int rc;
+ 
+ 	vcpu->stat.ld++;
+ 
+ 	rc = kvmppc_xlate(vcpu, *eaddr, data ? XLATE_DATA : XLATE_INST,
+ 			  XLATE_READ, &pte);
+ 	if (rc)
+ 		return rc;
+ 
+ 	*eaddr = pte.raddr;
+ 
+ 	if (!pte.may_read)
+ 		return -EPERM;
+ 
+ 	if (!data && !pte.may_execute)
+ 		return -ENOEXEC;
+ 
+ 	hva = kvmppc_pte_to_hva(vcpu, &pte);
+ 	if (kvm_is_error_hva(hva))
+ 		goto mmio;
+ 
+ 	if (copy_from_user(ptr, (void __user *)hva, size)) {
+ 		printk(KERN_INFO "kvmppc_ld at 0x%lx failed\n", hva);
+ 		goto mmio;
+ 	}
+ 
+ 	return EMULATE_DONE;
+ 
+ mmio:
+ 	return EMULATE_DO_MMIO;
+ }
+ EXPORT_SYMBOL_GPL(kvmppc_ld);
+ 
++>>>>>>> 9897e88a79e1 (KVM: PPC: Remove kvmppc_bad_hva())
  int kvm_arch_hardware_enable(void *garbage)
  {
  	return 0;
* Unmerged path arch/powerpc/kvm/powerpc.c
