powerpc/eeh: Tag reset state for user owned PE

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-327.el7
Rebuild_CHGLOG: - [powerpc] eeh: Tag reset state for user owned PE (Laurent Vivier) [1213675]
Rebuild_FUZZ: 90.48%
commit-author Gavin Shan <gwshan@linux.vnet.ibm.com>
commit 93e8b36d7bf5c54f1c52d8b78e34f88e52a3dfa2
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-327.el7/93e8b36d.failed

PE would be owned by userland, which probably request PE reset
done in host side. During the reset, we should drop the PCI
config accesses to the PE with help of flag EEH_PE_RESET.

	Signed-off-by: Gavin Shan <gwshan@linux.vnet.ibm.com>
	Signed-off-by: Michael Ellerman <mpe@ellerman.id.au>
(cherry picked from commit 93e8b36d7bf5c54f1c52d8b78e34f88e52a3dfa2)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/powerpc/kernel/eeh.c
diff --cc arch/powerpc/kernel/eeh.c
index 582df14babaf,693690827785..000000000000
--- a/arch/powerpc/kernel/eeh.c
+++ b/arch/powerpc/kernel/eeh.c
@@@ -1483,6 -1471,14 +1484,17 @@@ int eeh_pe_reset(struct eeh_pe *pe, in
  		break;
  	case EEH_RESET_HOT:
  	case EEH_RESET_FUNDAMENTAL:
++<<<<<<< HEAD
++=======
+ 		/*
+ 		 * Proactively freeze the PE to drop all MMIO access
+ 		 * during reset, which should be banned as it's always
+ 		 * cause recursive EEH error.
+ 		 */
+ 		eeh_ops->set_option(pe, EEH_OPT_FREEZE_PE);
+ 
+ 		eeh_pe_state_mark(pe, EEH_PE_RESET);
++>>>>>>> 93e8b36d7bf5 (powerpc/eeh: Tag reset state for user owned PE)
  		ret = eeh_ops->reset(pe, option);
  		break;
  	default:
* Unmerged path arch/powerpc/kernel/eeh.c
