tick/powerclamp: Remove tick_nohz_idle abuse

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-327.el7
Rebuild_CHGLOG: - [thermal] powerclamp: Remove tick_nohz_idle abuse (Steve Best) [1255864]
Rebuild_FUZZ: 93.98%
commit-author Thomas Gleixner <tglx@linutronix.de>
commit a5fd9733a30d18d7ac23f17080e7e07bb3205b69
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-327.el7/a5fd9733.failed

commit 4dbd27711cd9 "tick: export nohz tick idle symbols for module
use" was merged via the thermal tree without an explicit ack from the
relevant maintainers.

The exports are abused by the intel powerclamp driver which implements
a fake idle state from a sched FIFO task. This causes all kinds of
wreckage in the NOHZ core code which rightfully assumes that
tick_nohz_idle_enter/exit() are only called from the idle task itself.

Recent changes in the NOHZ core lead to a failure of the powerclamp
driver and now people try to hack completely broken and backwards
workarounds into the NOHZ core code. This is completely unacceptable
and just papers over the real problem. There are way more subtle
issues lurking around the corner.

The real solution is to fix the powerclamp driver by rewriting it with
a sane concept, but that's beyond the scope of this.

So the only solution for now is to remove the calls into the core NOHZ
code from the powerclamp trainwreck along with the exports. 

Fixes: d6d71ee4a14a "PM: Introduce Intel PowerClamp Driver"
	Signed-off-by: Thomas Gleixner <tglx@linutronix.de>
	Cc: Preeti U Murthy <preeti@linux.vnet.ibm.com>
	Cc: Viresh Kumar <viresh.kumar@linaro.org>
	Cc: Frederic Weisbecker <fweisbec@gmail.com>
	Cc: Fengguang Wu <fengguang.wu@intel.com>
	Cc: Frederic Weisbecker <frederic@kernel.org>
	Cc: Pan Jacob jun <jacob.jun.pan@intel.com>
	Cc: LKP <lkp@01.org>
	Cc: Peter Zijlstra <peterz@infradead.org>
	Cc: Zhang Rui <rui.zhang@intel.com>
	Cc: stable@vger.kernel.org
Link: http://lkml.kernel.org/r/alpine.DEB.2.11.1412181110110.17382@nanos
	Signed-off-by: Thomas Gleixner <tglx@linutronix.de>
(cherry picked from commit a5fd9733a30d18d7ac23f17080e7e07bb3205b69)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/thermal/intel_powerclamp.c
diff --cc drivers/thermal/intel_powerclamp.c
index c5321f2be26a,6cb78497076a..000000000000
--- a/drivers/thermal/intel_powerclamp.c
+++ b/drivers/thermal/intel_powerclamp.c
@@@ -457,8 -450,7 +456,12 @@@ static int clamp_thread(void *arg
  			start_critical_timings();
  			atomic_inc(&idle_wakeup_counter);
  		}
++<<<<<<< HEAD
 +		tick_nohz_idle_exit();
 +		preempt_enable_no_resched();
++=======
+ 		preempt_enable();
++>>>>>>> a5fd9733a30d (tick/powerclamp: Remove tick_nohz_idle abuse)
  	}
  	del_timer_sync(&wakeup_timer);
  	clear_bit(cpunr, cpu_clamping_mask);
* Unmerged path drivers/thermal/intel_powerclamp.c
diff --git a/kernel/time/tick-sched.c b/kernel/time/tick-sched.c
index 411c7f4f2e87..12343b50278e 100644
--- a/kernel/time/tick-sched.c
+++ b/kernel/time/tick-sched.c
@@ -822,7 +822,6 @@ void tick_nohz_idle_enter(void)
 
 	local_irq_enable();
 }
-EXPORT_SYMBOL_GPL(tick_nohz_idle_enter);
 
 /**
  * tick_nohz_irq_exit - update next tick event from interrupt exit
@@ -923,7 +922,6 @@ void tick_nohz_idle_exit(void)
 
 	local_irq_enable();
 }
-EXPORT_SYMBOL_GPL(tick_nohz_idle_exit);
 
 /*
  * The nohz low res interrupt handler
