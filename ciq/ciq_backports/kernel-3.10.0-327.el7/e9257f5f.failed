tools/power turbostat: correct dumped pkg-cstate-limit value

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-327.el7
Rebuild_CHGLOG: - [tools] turbostat: correct dumped pkg-cstate-limit value (Prarit Bhargava) [1187329]
Rebuild_FUZZ: 88.89%
commit-author Len Brown <len.brown@intel.com>
commit e9257f5fa48cc296d7eed35acf9f2ad195184122
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-327.el7/e9257f5f.failed

HSW expanded MSR_PKG_CST_CONFIG_CONTROL.Package-C-State-Limit,
from bits[2:0] used by previous implementations, to [3:0].
The value 1000b is unlimited, and is used by BDW and SKL too.

	Signed-off-by: Len Brown <len.brown@intel.com>
(cherry picked from commit e9257f5fa48cc296d7eed35acf9f2ad195184122)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	tools/power/x86/turbostat/turbostat.c
diff --cc tools/power/x86/turbostat/turbostat.c
index a636659b8e99,bac98ca3d4ca..000000000000
--- a/tools/power/x86/turbostat/turbostat.c
+++ b/tools/power/x86/turbostat/turbostat.c
@@@ -1015,7 -1111,41 +1015,45 @@@ int get_counters(struct thread_data *t
  	return 0;
  }
  
++<<<<<<< HEAD
 +void print_verbose_header(void)
++=======
+ /*
+  * MSR_PKG_CST_CONFIG_CONTROL decoding for pkg_cstate_limit:
+  * If you change the values, note they are used both in comparisons
+  * (>= PCL__7) and to index pkg_cstate_limit_strings[].
+  */
+ 
+ #define PCLUKN 0 /* Unknown */
+ #define PCLRSV 1 /* Reserved */
+ #define PCL__0 2 /* PC0 */
+ #define PCL__1 3 /* PC1 */
+ #define PCL__2 4 /* PC2 */
+ #define PCL__3 5 /* PC3 */
+ #define PCL__4 6 /* PC4 */
+ #define PCL__6 7 /* PC6 */
+ #define PCL_6N 8 /* PC6 No Retention */
+ #define PCL_6R 9 /* PC6 Retention */
+ #define PCL__7 10 /* PC7 */
+ #define PCL_7S 11 /* PC7 Shrink */
+ #define PCL__8 12 /* PC8 */
+ #define PCL__9 13 /* PC9 */
+ #define PCLUNL 14 /* Unlimited */
+ 
+ int pkg_cstate_limit = PCLUKN;
+ char *pkg_cstate_limit_strings[] = { "reserved", "unknown", "pc0", "pc1", "pc2",
+ 	"pc3", "pc4", "pc6", "pc6n", "pc6r", "pc7", "pc7s", "pc8", "pc9", "unlimited"};
+ 
+ int nhm_pkg_cstate_limits[16] = {PCL__0, PCL__1, PCL__3, PCL__6, PCL__7, PCLRSV, PCLRSV, PCLUNL, PCLRSV, PCLRSV, PCLRSV, PCLRSV, PCLRSV, PCLRSV, PCLRSV, PCLRSV};
+ int snb_pkg_cstate_limits[16] = {PCL__0, PCL__2, PCL_6N, PCL_6R, PCL__7, PCL_7S, PCLRSV, PCLUNL, PCLRSV, PCLRSV, PCLRSV, PCLRSV, PCLRSV, PCLRSV, PCLRSV, PCLRSV};
+ int hsw_pkg_cstate_limits[16] = {PCL__0, PCL__2, PCL__3, PCL__6, PCL__7, PCL_7S, PCL__8, PCL__9, PCLUNL, PCLRSV, PCLRSV, PCLRSV, PCLRSV, PCLRSV, PCLRSV, PCLRSV};
+ int slv_pkg_cstate_limits[16] = {PCL__0, PCL__1, PCLRSV, PCLRSV, PCL__4, PCLRSV, PCL__6, PCL__7, PCLRSV, PCLRSV, PCLRSV, PCLRSV, PCLRSV, PCLRSV, PCLRSV, PCLRSV};
+ int amt_pkg_cstate_limits[16] = {PCL__0, PCL__1, PCL__2, PCLRSV, PCLRSV, PCLRSV, PCL__6, PCL__7, PCLRSV, PCLRSV, PCLRSV, PCLRSV, PCLRSV, PCLRSV, PCLRSV, PCLRSV};
+ int phi_pkg_cstate_limits[16] = {PCL__0, PCL__2, PCL_6N, PCL_6R, PCLRSV, PCLRSV, PCLRSV, PCLUNL, PCLRSV, PCLRSV, PCLRSV, PCLRSV, PCLRSV, PCLRSV, PCLRSV, PCLRSV};
+ 
+ static void
+ dump_nhm_platform_info(void)
++>>>>>>> e9257f5fa48c (tools/power turbostat: correct dumped pkg-cstate-limit value)
  {
  	unsigned long long msr;
  	unsigned int ratio;
@@@ -1545,6 -1704,11 +1583,14 @@@ int has_nhm_msrs(unsigned int family, u
  	default:
  		return 0;
  	}
++<<<<<<< HEAD
++=======
+ 	get_msr(0, MSR_NHM_SNB_PKG_CST_CFG_CTL, &msr);
+ 
+ 	pkg_cstate_limit = pkg_cstate_limits[msr & 0xF];
+ 
+ 	return 1;
++>>>>>>> e9257f5fa48c (tools/power turbostat: correct dumped pkg-cstate-limit value)
  }
  int has_nhm_turbo_ratio_limit(unsigned int family, unsigned int model)
  {
@@@ -2469,6 -2869,11 +2515,14 @@@ int get_and_dump_counters(void
  	return status;
  }
  
++<<<<<<< HEAD
++=======
+ void print_version() {
+ 	fprintf(stderr, "turbostat version 4.5 2 Apr, 2015"
+ 		" - Len Brown <lenb@kernel.org>\n");
+ }
+ 
++>>>>>>> e9257f5fa48c (tools/power turbostat: correct dumped pkg-cstate-limit value)
  void cmdline(int argc, char **argv)
  {
  	int opt;
* Unmerged path tools/power/x86/turbostat/turbostat.c
