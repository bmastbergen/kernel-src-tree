pidns: kill the unnecessary CLONE_NEWPID in copy_process()

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-327.el7
commit-author Oleg Nesterov <oleg@redhat.com>
commit 5167246a8ad617df55717c2d901da5e2aedffcfa
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-327.el7/5167246a.failed

Commit 8382fcac1b81 ("pidns: Outlaw thread creation after
unshare(CLONE_NEWPID)") nacks CLONE_NEWPID if the forking process
unshared pid_ns.  This is correct but unnecessary, copy_pid_ns() does
the same check.

Remove the CLONE_NEWPID check to cleanup the code and prepare for the
next change.

Test-case:

	static int child(void *arg)
	{
		return 0;
	}

	static char stack[16 * 1024];

	int main(void)
	{
		pid_t pid;

		assert(unshare(CLONE_NEWUSER | CLONE_NEWPID) == 0);

		pid = clone(child, stack + sizeof(stack) / 2,
				CLONE_NEWPID | SIGCHLD, NULL);
		assert(pid < 0 && errno == EINVAL);

		return 0;
	}

clone(CLONE_NEWPID) correctly fails with or without this change.

	Signed-off-by: Oleg Nesterov <oleg@redhat.com>
	Acked-by: Andy Lutomirski <luto@amacapital.net>
	Cc: "Eric W. Biederman" <ebiederm@xmission.com>
	Cc: Colin Walters <walters@redhat.com>
	Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
	Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
(cherry picked from commit 5167246a8ad617df55717c2d901da5e2aedffcfa)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	kernel/fork.c
diff --cc kernel/fork.c
index 0b12f8b68265,68d508f2bfba..000000000000
--- a/kernel/fork.c
+++ b/kernel/fork.c
@@@ -1190,8 -1177,8 +1190,13 @@@ static struct task_struct *copy_process
  	 * allow it to share a thread group or signal handlers with the
  	 * forking task.
  	 */
++<<<<<<< HEAD
 +	if ((clone_flags & (CLONE_SIGHAND | CLONE_NEWPID)) &&
 +	    (task_active_pid_ns(current) != current->nsproxy->pid_ns))
++=======
+ 	if ((clone_flags & CLONE_SIGHAND) && (task_active_pid_ns(current) !=
+ 					current->nsproxy->pid_ns_for_children))
++>>>>>>> 5167246a8ad6 (pidns: kill the unnecessary CLONE_NEWPID in copy_process())
  		return ERR_PTR(-EINVAL);
  
  	retval = security_task_create(clone_flags);
* Unmerged path kernel/fork.c
