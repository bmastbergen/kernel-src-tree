tools lib api: Undefine _FORTIFY_SOURCE before setting it

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-327.el7
commit-author Bobby Powers <bobbypowers@gmail.com>
commit de28c15daf60e9625bece22f13a091fac8d05f1d
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-327.el7/de28c15d.failed

Some toolchains (like Hardened Gentoo) define _FORTIFY_SOURCE in the
built-in, default args.  This causes perf builds to fail with:

<command-line>:0:0: error: "_FORTIFY_SOURCE" redefined [-Werror]
<built-in>: note: this is the location of the previous definition cc1:
all warnings being treated as errors

To avoid this, undefine _FORTIFY_SOURCE before (possibly re-)defining it
in tools/lib/api.

v2 applies cleanly on top of already pulled kbuild changes for 4.1-rc1.

	Signed-off-by: Bobby Powers <bobbypowers@gmail.com>
	Acked-by: Jiri Olsa <jolsa@kernel.org>
	Cc: Dirk Gouders <dirk@gouders.net>
	Cc: Michal Marek <mmarek@suse.cz>
	Cc: Paul Mackerras <paulus@samba.org>
	Cc: Peter Zijlstra <a.p.zijlstra@chello.nl>
	Cc: linux-kbuild@vger.kernel.org
Link: http://lkml.kernel.org/r/1429658381-3039-1-git-send-email-bobbypowers@gmail.com
	Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>
(cherry picked from commit de28c15daf60e9625bece22f13a091fac8d05f1d)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	tools/lib/api/Makefile
diff --cc tools/lib/api/Makefile
index 5e752b4c653f,8bd960658463..000000000000
--- a/tools/lib/api/Makefile
+++ b/tools/lib/api/Makefile
@@@ -1,31 -1,23 +1,37 @@@
  include ../../scripts/Makefile.include
  include ../../perf/config/utilities.mak		# QUIET_CLEAN
  
 -ifeq ($(srctree),)
 -srctree := $(patsubst %/,%,$(dir $(shell pwd)))
 -srctree := $(patsubst %/,%,$(dir $(srctree)))
 -srctree := $(patsubst %/,%,$(dir $(srctree)))
 -#$(info Determined 'srctree' to be $(srctree))
 -endif
 -
 -CC = $(CROSS_COMPILE)gcc
 -AR = $(CROSS_COMPILE)ar
 -
 -MAKEFLAGS += --no-print-directory
 -
 -LIBFILE = $(OUTPUT)libapi.a
 -
 +# guard against environment variables
 +LIB_H=
 +LIB_OBJS=
 +
 +LIB_H += fs/debugfs.h
 +LIB_H += fs/tracefs.h
 +LIB_H += fs/findfs.h
 +LIB_H += fs/fs.h
 +# See comment below about piggybacking...
 +LIB_H += fd/array.h
 +
 +LIB_OBJS += $(OUTPUT)fs/debugfs.o
 +LIB_OBJS += $(OUTPUT)fs/tracefs.o
 +LIB_OBJS += $(OUTPUT)fs/findfs.o
 +LIB_OBJS += $(OUTPUT)fs/fs.o
 +# XXX piggybacking here, need to introduce libapikfd, or rename this
 +# to plain libapik.a and make it have it all api goodies
 +LIB_OBJS += $(OUTPUT)fd/array.o
 +
 +LIBFILE = libapikfs.a
 +
++<<<<<<< HEAD
 +CFLAGS = -ggdb3 -Wall -Wextra -std=gnu99 -Werror -O6 -D_FORTIFY_SOURCE=2 $(EXTRA_WARNINGS) $(EXTRA_CFLAGS) -fPIC
 +EXTLIBS = -lelf -lpthread -lrt -lm
 +ALL_CFLAGS = $(CFLAGS) $(BASIC_CFLAGS) -D_LARGEFILE64_SOURCE -D_FILE_OFFSET_BITS=64
 +ALL_LDFLAGS = $(LDFLAGS)
++=======
+ CFLAGS := $(EXTRA_WARNINGS) $(EXTRA_CFLAGS)
+ CFLAGS += -ggdb3 -Wall -Wextra -std=gnu99 -Werror -O6 -U_FORTIFY_SOURCE -D_FORTIFY_SOURCE=2 -fPIC
+ CFLAGS += -D_LARGEFILE64_SOURCE -D_FILE_OFFSET_BITS=64
++>>>>>>> de28c15daf60 (tools lib api: Undefine _FORTIFY_SOURCE before setting it)
  
  RM = rm -f
  
* Unmerged path tools/lib/api/Makefile
