sfc: do not allow VFs to be destroyed if assigned to guests

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-327.el7
commit-author Daniel Pieczko <dpieczko@solarflare.com>
commit 71158bf2e748e2710616f59a823619af3c5505a7
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-327.el7/71158bf2.failed

	Signed-off-by: Shradha Shah <sshah@solarflare.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 71158bf2e748e2710616f59a823619af3c5505a7)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/sfc/ef10_sriov.c
diff --cc drivers/net/ethernet/sfc/ef10_sriov.c
index 9e6a3e197e01,083c534bc4ec..000000000000
--- a/drivers/net/ethernet/sfc/ef10_sriov.c
+++ b/drivers/net/ethernet/sfc/ef10_sriov.c
@@@ -33,11 -417,20 +33,25 @@@ static int efx_ef10_pci_sriov_disable(s
  {
  	struct pci_dev *dev = efx->pci_dev;
  
++<<<<<<< HEAD
++=======
+ 	if (!efx->vf_count)
+ 		return 0;
+ 
+ 	if (pci_vfs_assigned(dev)) {
+ 		netif_err(efx, drv, efx->net_dev, "VFs are assigned to guests; "
+ 			  "please detach them before disabling SR-IOV\n");
+ 		return -EBUSY;
+ 	}
+ 
+ 	pci_disable_sriov(dev);
+ 	efx_ef10_sriov_free_vf_vswitching(efx);
++>>>>>>> 71158bf2e748 (sfc: do not allow VFs to be destroyed if assigned to guests)
  	efx->vf_count = 0;
 +	pci_disable_sriov(dev);
  	return 0;
  }
 +#endif
  
  int efx_ef10_sriov_configure(struct efx_nic *efx, int num_vfs)
  {
* Unmerged path drivers/net/ethernet/sfc/ef10_sriov.c
