xfs: replace on-stack xfs_trans_res with pointer in xfs_create()

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-327.el7
commit-author Brian Foster <bfoster@redhat.com>
commit 062647a8b41928f4fb97f967b24092be68f5f0f0
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-327.el7/062647a8.failed

There's no need to store a full struct xfs_trans_res on the stack in
xfs_create() and copy the fields. Use a pointer to the appropriate
structures embedded in the xfs_mount.

	Signed-off-by: Brian Foster <bfoster@redhat.com>
	Reviewed-by: Christoph Hellwig <hch@lst.de>
	Signed-off-by: Dave Chinner <david@fromorbit.com>

(cherry picked from commit 062647a8b41928f4fb97f967b24092be68f5f0f0)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	fs/xfs/xfs_inode.c
diff --cc fs/xfs/xfs_inode.c
index f0c92c3ecc50,2ffb80267e37..000000000000
--- a/fs/xfs/xfs_inode.c
+++ b/fs/xfs/xfs_inode.c
@@@ -1198,17 -1121,16 +1196,22 @@@ xfs_create
  	 * the case we'll drop the one we have and get a more
  	 * appropriate transaction later.
  	 */
++<<<<<<< HEAD
 +	tres.tr_logflags = XFS_TRANS_PERM_LOG_RES;
 +	error = xfs_trans_reserve(tp, &tres, resblks, 0);
 +	if (error == ENOSPC) {
++=======
+ 	error = xfs_trans_reserve(tp, tres, resblks, 0);
+ 	if (error == -ENOSPC) {
++>>>>>>> 062647a8b419 (xfs: replace on-stack xfs_trans_res with pointer in xfs_create())
  		/* flush outstanding delalloc blocks and retry */
  		xfs_flush_inodes(mp);
- 		error = xfs_trans_reserve(tp, &tres, resblks, 0);
+ 		error = xfs_trans_reserve(tp, tres, resblks, 0);
  	}
 -	if (error == -ENOSPC) {
 +	if (error == ENOSPC) {
  		/* No space at all so try a "no-allocation" reservation */
  		resblks = 0;
- 		error = xfs_trans_reserve(tp, &tres, 0, 0);
+ 		error = xfs_trans_reserve(tp, tres, 0, 0);
  	}
  	if (error) {
  		cancel_flags = 0;
* Unmerged path fs/xfs/xfs_inode.c
