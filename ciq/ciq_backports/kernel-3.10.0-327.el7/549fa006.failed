xfs: consolidate xfs_inumbers

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-327.el7
commit-author Jie Liu <jeff.liu@oracle.com>
commit 549fa00679dd14beaaa685486549c637e8e02182
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-327.el7/549fa006.failed

From: Jie Liu <jeff.liu@oracle.com>

Consolidate xfs_inumbers() to make the formatter function return correct
error and make the source code looks a bit neat.

	Signed-off-by: Jie Liu <jeff.liu@oracle.com>
	Reviewed-by: Dave Chinner <dchinner@redhat.com>
	Signed-off-by: Dave Chinner <david@fromorbit.com>

(cherry picked from commit 549fa00679dd14beaaa685486549c637e8e02182)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	fs/xfs/xfs_itable.c
diff --cc fs/xfs/xfs_itable.c
index 2e7b3970ae2e,df7605183aa2..000000000000
--- a/fs/xfs/xfs_itable.c
+++ b/fs/xfs/xfs_itable.c
@@@ -657,10 -605,9 +653,14 @@@ xfs_inumbers
  		left--;
  		if (bufidx == bcount) {
  			long written;
++<<<<<<< HEAD
 +			if (formatter(ubuffer, buffer, bufidx, &written)) {
 +				error = XFS_ERROR(EFAULT);
++=======
+ 			error = formatter(ubuffer, buffer, bufidx, &written);
+ 			if (error)
++>>>>>>> 549fa00679dd (xfs: consolidate xfs_inumbers)
  				break;
- 			}
  			ubuffer += written;
  			*count += bufidx;
  			bufidx = 0;
@@@ -684,9 -631,8 +684,14 @@@
  	if (!error) {
  		if (bufidx) {
  			long written;
++<<<<<<< HEAD
 +			if (formatter(ubuffer, buffer, bufidx, &written))
 +				error = XFS_ERROR(EFAULT);
 +			else
++=======
+ 			error = formatter(ubuffer, buffer, bufidx, &written);
+ 			if (!error)
++>>>>>>> 549fa00679dd (xfs: consolidate xfs_inumbers)
  				*count += bufidx;
  		}
  		*lastino = XFS_AGINO_TO_INO(mp, agno, agino);
diff --git a/fs/xfs/xfs_ioctl32.c b/fs/xfs/xfs_ioctl32.c
index 944d5baa710a..0904aa09020c 100644
--- a/fs/xfs/xfs_ioctl32.c
+++ b/fs/xfs/xfs_ioctl32.c
@@ -102,7 +102,7 @@ xfs_compat_growfs_rt_copyin(
 STATIC int
 xfs_inumbers_fmt_compat(
 	void			__user *ubuffer,
-	const xfs_inogrp_t	*buffer,
+	const struct xfs_inogrp	*buffer,
 	long			count,
 	long			*written)
 {
* Unmerged path fs/xfs/xfs_itable.c
