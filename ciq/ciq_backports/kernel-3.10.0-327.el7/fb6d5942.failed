perf probe ppc: Use the right prefix when ignoring SyS symbols on ppc

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-327.el7
Rebuild_CHGLOG: - [perf] probe: ppc: Use the right prefix when ignoring SyS symbols on ppc (Gustavo Duarte) [1223850]
Rebuild_FUZZ: 95.52%
commit-author Naveen N. Rao <naveen.n.rao@linux.vnet.ibm.com>
commit fb6d59423115b10125f5db6acb8471f6f0af4ad7
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-327.el7/fb6d5942.failed

Use the proper prefix when ignoring SyS symbols on ppc ABIv1. While at
it, generalize symbol selection so architectures can implement their own
logic.

	Signed-off-by: Naveen N. Rao <naveen.n.rao@linux.vnet.ibm.com>
	Reviewed-by: Srikar Dronamraju <srikar@linux.vnet.ibm.com>
	Cc: Ananth N Mavinakayanahalli <ananth@in.ibm.com>
	Cc: Masami Hiramatsu <masami.hiramatsu.pt@hitachi.com>
	Cc: Michael Ellerman <mpe@ellerman.id.au>
	Cc: Sukadev Bhattiprolu <sukadev@linux.vnet.ibm.com>
	Cc: linuxppc-dev@lists.ozlabs.org
Link: http://lkml.kernel.org/r/adf1f98b121ecaf292777fe5cc69fe1038feabce.1430217967.git.naveen.n.rao@linux.vnet.ibm.com
	Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>
(cherry picked from commit fb6d59423115b10125f5db6acb8471f6f0af4ad7)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	tools/perf/arch/powerpc/util/sym-handling.c
#	tools/perf/util/symbol.h
diff --cc tools/perf/util/symbol.h
index b0bb802f2d95,bd50ba0dde63..000000000000
--- a/tools/perf/util/symbol.h
+++ b/tools/perf/util/symbol.h
@@@ -301,4 -303,13 +301,16 @@@ int setup_list(struct strlist **list, c
  int setup_intlist(struct intlist **list, const char *list_str,
  		  const char *list_name);
  
++<<<<<<< HEAD
++=======
+ #ifdef HAVE_LIBELF_SUPPORT
+ bool elf__needs_adjust_symbols(GElf_Ehdr ehdr);
+ #endif
+ 
+ #define SYMBOL_A 0
+ #define SYMBOL_B 1
+ 
+ int arch__choose_best_symbol(struct symbol *syma, struct symbol *symb);
+ 
++>>>>>>> fb6d59423115 (perf probe ppc: Use the right prefix when ignoring SyS symbols on ppc)
  #endif /* __PERF_SYMBOL */
* Unmerged path tools/perf/arch/powerpc/util/sym-handling.c
* Unmerged path tools/perf/arch/powerpc/util/sym-handling.c
diff --git a/tools/perf/util/symbol.c b/tools/perf/util/symbol.c
index 0fa6cd829f65..93c59759dcf0 100644
--- a/tools/perf/util/symbol.c
+++ b/tools/perf/util/symbol.c
@@ -84,8 +84,17 @@ static int prefix_underscores_count(const char *str)
 	return tail - str;
 }
 
-#define SYMBOL_A 0
-#define SYMBOL_B 1
+int __weak arch__choose_best_symbol(struct symbol *syma,
+				    struct symbol *symb __maybe_unused)
+{
+	/* Avoid "SyS" kernel syscall aliases */
+	if (strlen(syma->name) >= 3 && !strncmp(syma->name, "SyS", 3))
+		return SYMBOL_B;
+	if (strlen(syma->name) >= 10 && !strncmp(syma->name, "compat_SyS", 10))
+		return SYMBOL_B;
+
+	return SYMBOL_A;
+}
 
 static int choose_best_symbol(struct symbol *syma, struct symbol *symb)
 {
@@ -133,13 +142,7 @@ static int choose_best_symbol(struct symbol *syma, struct symbol *symb)
 	else if (na < nb)
 		return SYMBOL_B;
 
-	/* Avoid "SyS" kernel syscall aliases */
-	if (na >= 3 && !strncmp(syma->name, "SyS", 3))
-		return SYMBOL_B;
-	if (na >= 10 && !strncmp(syma->name, "compat_SyS", 10))
-		return SYMBOL_B;
-
-	return SYMBOL_A;
+	return arch__choose_best_symbol(syma, symb);
 }
 
 void symbols__fixup_duplicate(struct rb_root *symbols)
* Unmerged path tools/perf/util/symbol.h
