drm/i915/audio: add codec wakeup override enabled/disable callback

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-327.el7
commit-author Lu, Han <han.lu@intel.com>
commit 632f3ab95fe2ffebf09969a57ab21be409ed7dcc
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-327.el7/632f3ab9.failed

Add support for enabling codec wakeup override signal to allow
re-enumeration of the controller on SKL after resume from low power state.

In SKL, HDMI/DP codec and PCH HD Audio Controller are in different power
wells, so it's necessary to reset display audio codecs when power well on,
otherwise display audio codecs will disappear when resume from low power
state.
Reset steps when power on:
    enable codec wakeup -> azx_init_chip() -> disable codec wakeup

v3 by Jani: Simplify to only support toggling the appropriate chicken bit.

v4 by Han: add explanation and specify the hw swquence.

	Signed-off-by: Lu, Han <han.lu@intel.com>
	Signed-off-by: Jani Nikula <jani.nikula@intel.com>
	Acked-by: Daniel Vetter <daniel.vetter@ffwll.ch>
	Signed-off-by: Takashi Iwai <tiwai@suse.de>
(cherry picked from commit 632f3ab95fe2ffebf09969a57ab21be409ed7dcc)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/gpu/drm/i915/intel_audio.c
#	drivers/gpu/drm/nouveau/core/engine/fifo/gk20a.c
diff --cc drivers/gpu/drm/nouveau/core/engine/fifo/gk20a.c
index 327456eae963,c9a8b64aa33b..000000000000
--- a/drivers/gpu/drm/nouveau/core/engine/fifo/gk20a.c
+++ b/drivers/gpu/drm/nouveau/core/engine/fifo/gk20a.c
@@@ -16,20 -17,23 +16,36 @@@
   * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL
   * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
   * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
 - * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
 - * IN THE SOFTWARE.
 + * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER
 + * DEALINGS IN THE SOFTWARE.
   */
  
 -#ifndef _I915_COMPONENT_H_
 -#define _I915_COMPONENT_H_
 +#include "nve0.h"
  
++<<<<<<< HEAD:drivers/gpu/drm/nouveau/core/engine/fifo/gk20a.c
 +struct nouveau_oclass *
 +gk20a_fifo_oclass = &(struct nve0_fifo_impl) {
 +	.base.handle = NV_ENGINE(FIFO, 0xea),
 +	.base.ofuncs = &(struct nouveau_ofuncs) {
 +		.ctor = nve0_fifo_ctor,
 +		.dtor = nve0_fifo_dtor,
 +		.init = nve0_fifo_init,
 +		.fini = nve0_fifo_fini,
 +	},
 +	.channels = 128,
 +}.base;
++=======
+ struct i915_audio_component {
+ 	struct device *dev;
+ 
+ 	const struct i915_audio_component_ops {
+ 		struct module *owner;
+ 		void (*get_power)(struct device *);
+ 		void (*put_power)(struct device *);
+ 		void (*codec_wake_override)(struct device *, bool enable);
+ 		int (*get_cdclk_freq)(struct device *);
+ 	} *ops;
+ };
+ 
+ #endif /* _I915_COMPONENT_H_ */
++>>>>>>> 632f3ab95fe2 (drm/i915/audio: add codec wakeup override enabled/disable callback):include/drm/i915_component.h
* Unmerged path drivers/gpu/drm/i915/intel_audio.c
diff --git a/drivers/gpu/drm/i915/i915_reg.h b/drivers/gpu/drm/i915/i915_reg.h
index a2d35d927e98..5074d7bff08a 100644
--- a/drivers/gpu/drm/i915/i915_reg.h
+++ b/drivers/gpu/drm/i915/i915_reg.h
@@ -5701,6 +5701,9 @@ enum punit_power_well {
 #define   AUDIO_CP_READY_B		(1<<5)
 #define   AUDIO_CP_READY_C		(1<<9)
 
+#define HSW_AUD_CHICKENBIT			0x65f10
+#define   SKL_AUD_CODEC_WAKE_SIGNAL		(1 << 15)
+
 /* HSW Power Wells */
 #define HSW_PWR_WELL_BIOS			0x45400 /* CTL1 */
 #define HSW_PWR_WELL_DRIVER			0x45404 /* CTL2 */
* Unmerged path drivers/gpu/drm/i915/intel_audio.c
* Unmerged path drivers/gpu/drm/nouveau/core/engine/fifo/gk20a.c
