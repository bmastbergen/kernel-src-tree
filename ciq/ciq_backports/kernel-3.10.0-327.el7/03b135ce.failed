ALSA: hda - remove controller dependency on i915 power well for SKL

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-327.el7
Rebuild_CHGLOG: - [alsa] hda - remove controller dependency on i915 power well for SKL (Jaroslav Kysela) [1197064]
Rebuild_FUZZ: 95.31%
commit-author Libin Yang <libin.yang@intel.com>
commit 03b135cebc47d75ea2dc346770374ab741966955
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-327.el7/03b135ce.failed

For SKL, only the HDMI codec is in the display power well while the
HD-A controller isn't. So the controller flag 'need_i915_power' is
not set to release the display power after probe, and the codec flag
'link_power_control' is set to request/release the display power via
bus link_power ops.

	Signed-off-by: Libin Yang <libin.yang@intel.com>
	Signed-off-by: Takashi Iwai <tiwai@suse.de>
(cherry picked from commit 03b135cebc47d75ea2dc346770374ab741966955)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	sound/pci/hda/hda_intel.c
#	sound/pci/hda/patch_hdmi.c
diff --cc sound/pci/hda/hda_intel.c
index e1c964381edc,7933fb00da4f..000000000000
--- a/sound/pci/hda/hda_intel.c
+++ b/sound/pci/hda/hda_intel.c
@@@ -1889,13 -1973,23 +1894,21 @@@ static int azx_probe_continue(struct az
  	int dev = chip->dev_index;
  	int err;
  
 -	hda->probe_continued = 1;
 -
 -	/* Request display power well for the HDA controller or codec. For
 -	 * Haswell/Broadwell, both the display HDA controller and codec need
 -	 * this power. For other platforms, like Baytrail/Braswell, only the
 -	 * display codec needs the power and it can be released after probe.
 -	 */
 +	/* Request power well for Haswell HDA controller and codec */
  	if (chip->driver_caps & AZX_DCAPS_I915_POWERWELL) {
++<<<<<<< HEAD
 +#ifdef CONFIG_SND_HDA_I915
 +		err = hda_i915_init(hda);
++=======
+ 		/* HSW/BDW controllers need this power */
+ 		if (CONTROLLER_IN_GPU(pci))
+ 			hda->need_i915_power = 1;
+ 
+ 		err = snd_hdac_i915_init(bus);
++>>>>>>> 03b135cebc47 (ALSA: hda - remove controller dependency on i915 power well for SKL)
  		if (err < 0)
 -			goto i915_power_fail;
 -
 -		err = snd_hdac_display_power(bus, true);
 +			goto out_free;
 +		err = hda_display_power(hda, true);
  		if (err < 0) {
  			dev_err(chip->card->dev,
  				"Cannot turn on display power on i915\n");
diff --cc sound/pci/hda/patch_hdmi.c
index 194cb90573c7,407978b6db66..000000000000
--- a/sound/pci/hda/patch_hdmi.c
+++ b/sound/pci/hda/patch_hdmi.c
@@@ -2334,6 -2333,15 +2334,18 @@@ static int patch_generic_hdmi(struct hd
  		intel_haswell_fixup_enable_dp12(codec);
  	}
  
++<<<<<<< HEAD
++=======
+ 	/* For Valleyview/Cherryview, only the display codec is in the display
+ 	 * power well and can use link_power ops to request/release the power.
+ 	 * For Haswell/Broadwell, the controller is also in the power well and
+ 	 * can cover the codec power request, and so need not set this flag.
+ 	 * For previous platforms, there is no such power well feature.
+ 	 */
+ 	if (is_valleyview_plus(codec) || is_skylake(codec))
+ 		codec->core.link_power_control = 1;
+ 
++>>>>>>> 03b135cebc47 (ALSA: hda - remove controller dependency on i915 power well for SKL)
  	if (is_haswell_plus(codec) || is_valleyview_plus(codec))
  		codec->depop_delay = 0;
  
* Unmerged path sound/pci/hda/hda_intel.c
* Unmerged path sound/pci/hda/patch_hdmi.c
