ixgbe: fix issue with SFP events with new X550 devices

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-327.el7
commit-author Don Skidmore <donald.c.skidmore@intel.com>
commit 4ccc650cc845476885f73660b2e6335852f0f75c
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-327.el7/4ccc650c.failed

Add checks for systems that don't have SFP's to avoid incorrectly
acting on interrupts that are falsely interpreted as SFP events.
This also includes a modified check generating the EICR mask to be
more forward-looking.

	Signed-off-by: Don Skidmore <donald.c.skidmore@intel.com>
	Signed-off-by: Jeff Kirsher <jeffrey.t.kirsher@intel.com>
(cherry picked from commit 4ccc650cc845476885f73660b2e6335852f0f75c)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/intel/ixgbe/ixgbe_main.c
diff --cc drivers/net/ethernet/intel/ixgbe/ixgbe_main.c
index 9c071e440192,b9267e20e269..000000000000
--- a/drivers/net/ethernet/intel/ixgbe/ixgbe_main.c
+++ b/drivers/net/ethernet/intel/ixgbe/ixgbe_main.c
@@@ -2423,19 -2474,49 +2423,38 @@@ static void ixgbe_check_overtemp_event(
  static void ixgbe_check_sfp_event(struct ixgbe_adapter *adapter, u32 eicr)
  {
  	struct ixgbe_hw *hw = &adapter->hw;
+ 	u32 eicr_mask = IXGBE_EICR_GPI_SDP2(hw);
  
++<<<<<<< HEAD
 +	if (eicr & IXGBE_EICR_GPI_SDP2) {
 +		/* Clear the interrupt */
 +		IXGBE_WRITE_REG(hw, IXGBE_EICR, IXGBE_EICR_GPI_SDP2);
++=======
+ 	if (!ixgbe_is_sfp(hw))
+ 		return;
+ 
+ 	/* Later MAC's use different SDP */
+ 	if (hw->mac.type >= ixgbe_mac_X540)
+ 		eicr_mask = IXGBE_EICR_GPI_SDP0_X540;
+ 
+ 	if (eicr & eicr_mask) {
+ 		/* Clear the interrupt */
+ 		IXGBE_WRITE_REG(hw, IXGBE_EICR, eicr_mask);
++>>>>>>> 4ccc650cc845 (ixgbe: fix issue with SFP events with new X550 devices)
  		if (!test_bit(__IXGBE_DOWN, &adapter->state)) {
  			adapter->flags2 |= IXGBE_FLAG2_SFP_NEEDS_RESET;
  			ixgbe_service_event_schedule(adapter);
  		}
  	}
  
++<<<<<<< HEAD
 +	if (eicr & IXGBE_EICR_GPI_SDP1) {
++=======
+ 	if (adapter->hw.mac.type == ixgbe_mac_82599EB &&
+ 	    (eicr & IXGBE_EICR_GPI_SDP1(hw))) {
++>>>>>>> 4ccc650cc845 (ixgbe: fix issue with SFP events with new X550 devices)
  		/* Clear the interrupt */
 -		IXGBE_WRITE_REG(hw, IXGBE_EICR, IXGBE_EICR_GPI_SDP1(hw));
 +		IXGBE_WRITE_REG(hw, IXGBE_EICR, IXGBE_EICR_GPI_SDP1);
  		if (!test_bit(__IXGBE_DOWN, &adapter->state)) {
  			adapter->flags |= IXGBE_FLAG_NEED_LINK_CONFIG;
  			ixgbe_service_event_schedule(adapter);
* Unmerged path drivers/net/ethernet/intel/ixgbe/ixgbe_main.c
