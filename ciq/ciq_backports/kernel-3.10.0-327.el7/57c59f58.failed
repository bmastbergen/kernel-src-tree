audit: fix filename matching in __audit_inode() and __audit_inode_child()

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-327.el7
commit-author Paul Moore <pmoore@redhat.com>
commit 57c59f5837bdfd0b4fee3b02a44857e263a09bfa
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-327.el7/57c59f58.failed

In all likelihood there were some subtle, and perhaps not so subtle,
bugs with filename matching in audit_inode() and audit_inode_child()
for some time, however, recent changes to the audit filename code have
definitely broken the filename matching code.  The breakage could
result in duplicate filenames in the audit log and other odd audit
record entries.  This patch fixes the filename matching code and
restores some sanity to the filename audit records.

CC: viro@zeniv.linux.org.uk
CC: linux-fsdevel@vger.kernel.org
	Signed-off-by: Paul Moore <pmoore@redhat.com>
	Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>
(cherry picked from commit 57c59f5837bdfd0b4fee3b02a44857e263a09bfa)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	kernel/auditsc.c
diff --cc kernel/auditsc.c
index 01f5de1b9bd4,4f521964ccaa..000000000000
--- a/kernel/auditsc.c
+++ b/kernel/auditsc.c
@@@ -1802,8 -1864,17 +1803,22 @@@ void __audit_inode(struct filename *nam
  	}
  
  	list_for_each_entry_reverse(n, &context->names_list, list) {
++<<<<<<< HEAD
 +		/* does the name pointer match? */
 +		if (!n->name || n->name->name != name->name)
++=======
+ 		if (n->ino) {
+ 			/* valid inode number, use that for the comparison */
+ 			if (n->ino != inode->i_ino ||
+ 			    n->dev != inode->i_sb->s_dev)
+ 				continue;
+ 		} else if (n->name) {
+ 			/* inode number has not been set, check the name */
+ 			if (strcmp(n->name->name, name->name))
+ 				continue;
+ 		} else
+ 			/* no inode and no name (?!) ... this is odd ... */
++>>>>>>> 57c59f5837bd (audit: fix filename matching in __audit_inode() and __audit_inode_child())
  			continue;
  
  		/* match the correct record type */
* Unmerged path kernel/auditsc.c
