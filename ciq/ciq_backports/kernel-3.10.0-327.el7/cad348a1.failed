Bluetooth: Implement .activate, .shutdown and .carrier_raised methods

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-327.el7
Rebuild_CHGLOG: - [bluetooth] Implement .activate, .shutdown and .carrier_raised methods (Lubomir Rintel) [1241844]
Rebuild_FUZZ: 91.34%
commit-author Gianluca Anzolin <gianluca@sottospazio.it>
commit cad348a17e170451ea8688b532a6ca3e98c63b60
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-327.el7/cad348a1.failed

Implement .activate, .shutdown and .carrier_raised methods of tty_port
to manage the dlc, moving the code from rfcomm_tty_install() and
rfcomm_tty_cleanup() functions.

At the same time the tty .open()/.close() and .hangup() methods are
changed to use the tty_port helpers that properly call the
aforementioned tty_port methods.

	Signed-off-by: Gianluca Anzolin <gianluca@sottospazio.it>
	Reviewed-by: Peter Hurley <peter@hurleysoftware.com>
	Signed-off-by: Gustavo Padovan <gustavo.padovan@collabora.co.uk>
(cherry picked from commit cad348a17e170451ea8688b532a6ca3e98c63b60)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/bluetooth/rfcomm/tty.c
diff --cc net/bluetooth/rfcomm/tty.c
index b997cfb78eb2,583f7135c811..000000000000
--- a/net/bluetooth/rfcomm/tty.c
+++ b/net/bluetooth/rfcomm/tty.c
@@@ -559,10 -592,14 +588,19 @@@ static void rfcomm_dev_state_change(str
  	BT_DBG("dlc %p dev %p err %d", dlc, dev, err);
  
  	dev->err = err;
- 	wake_up_interruptible(&dev->wait);
+ 	if (dlc->state == BT_CONNECTED) {
+ 		device_move(dev->tty_dev, rfcomm_get_device(dev),
+ 			    DPM_ORDER_DEV_AFTER_PARENT);
  
++<<<<<<< HEAD
 +	if (dlc->state == BT_CLOSED) {
 +		if (!dev->port.tty) {
++=======
+ 		wake_up_interruptible(&dev->port.open_wait);
+ 	} else if (dlc->state == BT_CLOSED) {
+ 		tty = tty_port_tty_get(&dev->port);
+ 		if (!tty) {
++>>>>>>> cad348a17e17 (Bluetooth: Implement .activate, .shutdown and .carrier_raised methods)
  			if (test_bit(RFCOMM_RELEASE_ONHUP, &dev->flags)) {
  				/* Drop DLC lock here to avoid deadlock
  				 * 1. rfcomm_dev_get will take rfcomm_dev_lock
* Unmerged path net/bluetooth/rfcomm/tty.c
