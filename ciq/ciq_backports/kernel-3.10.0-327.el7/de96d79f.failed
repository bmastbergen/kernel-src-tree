kernel/module.c: Free lock-classes if parse_args failed

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-327.el7
Rebuild_CHGLOG: - [kernel] module: Free lock-classes if parse_args failed (Jerome Marchand) [1183891]
Rebuild_FUZZ: 91.09%
commit-author Andrey Tsyvarev <tsyvarev@ispras.ru>
commit de96d79f343321d26ff920af25fcefe6895ca544
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-327.el7/de96d79f.failed

parse_args call module parameters' .set handlers, which may use locks defined in the module.
So, these classes should be freed in case parse_args returns error(e.g. due to incorrect parameter passed).

	Signed-off-by: Andrey Tsyvarev <tsyvarev@ispras.ru>
	Signed-off-by: Rusty Russell <rusty@rustcorp.com.au>
(cherry picked from commit de96d79f343321d26ff920af25fcefe6895ca544)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	kernel/module.c
diff --cc kernel/module.c
index 336b40bdf589,441ed3fc9c89..000000000000
--- a/kernel/module.c
+++ b/kernel/module.c
@@@ -3438,8 -3356,8 +3438,13 @@@ static int load_module(struct load_inf
  	module_bug_cleanup(mod);
  	mutex_unlock(&module_mutex);
  
++<<<<<<< HEAD
 +	blocking_notifier_call_chain(&module_notify_list,
 +				     MODULE_STATE_GOING, mod);
++=======
+ 	/* Free lock-classes: */
+ 	lockdep_free_key_range(mod->module_core, mod->core_size);
++>>>>>>> de96d79f3433 (kernel/module.c: Free lock-classes if parse_args failed)
  
  	/* we can't deallocate the module until we clear memory protection */
  	unset_module_init_ro_nx(mod);
* Unmerged path kernel/module.c
