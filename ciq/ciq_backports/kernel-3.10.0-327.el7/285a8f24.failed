tools lib api: Rename libapikfs.a to libapi.a

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-327.el7
commit-author Jiri Olsa <jolsa@kernel.org>
commit 285a8f247b08c2aff83633fb82c217f91455d10b
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-327.el7/285a8f24.failed

Renaming libapikfs.a to libapi.a, because it's not just 'fs' specific
library now.

	Signed-off-by: Jiri Olsa <jolsa@kernel.org>
	Tested-by: Sukadev Bhattiprolu <sukadev@linux.vnet.ibm.com>
	Tested-by: Will Deacon <will.deacon@arm.com>
	Cc: Alexis Berlemont <alexis.berlemont@gmail.com>
	Cc: Borislav Petkov <bp@alien8.de>
	Cc: Corey Ashford <cjashfor@linux.vnet.ibm.com>
	Cc: David Ahern <dsahern@gmail.com>
	Cc: Frederic Weisbecker <fweisbec@gmail.com>
	Cc: Namhyung Kim <namhyung@kernel.org>
	Cc: Paul Mackerras <paulus@samba.org>
	Cc: Peter Zijlstra <peterz@infradead.org>
	Cc: Stephane Eranian <eranian@google.com>
Link: http://lkml.kernel.org/n/tip-g1mk5oj2ayq4vn653ovfg3gv@git.kernel.org
	Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>
(cherry picked from commit 285a8f247b08c2aff83633fb82c217f91455d10b)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	tools/lib/api/Build
#	tools/lib/api/Makefile
#	tools/lib/api/fd/Build
#	tools/lib/api/fs/Build
#	tools/perf/Makefile.perf
diff --cc tools/lib/api/Makefile
index 5e752b4c653f,d8fe29fc19a4..000000000000
--- a/tools/lib/api/Makefile
+++ b/tools/lib/api/Makefile
@@@ -1,50 -1,43 +1,71 @@@
  include ../../scripts/Makefile.include
  include ../../perf/config/utilities.mak		# QUIET_CLEAN
  
 -ifeq ($(srctree),)
 -srctree := $(patsubst %/,%,$(dir $(shell pwd)))
 -srctree := $(patsubst %/,%,$(dir $(srctree)))
 -srctree := $(patsubst %/,%,$(dir $(srctree)))
 -#$(info Determined 'srctree' to be $(srctree))
 -endif
 +# guard against environment variables
 +LIB_H=
 +LIB_OBJS=
  
 -CC = $(CROSS_COMPILE)gcc
 -AR = $(CROSS_COMPILE)ar
 +LIB_H += fs/debugfs.h
 +LIB_H += fs/tracefs.h
 +LIB_H += fs/findfs.h
 +LIB_H += fs/fs.h
 +# See comment below about piggybacking...
 +LIB_H += fd/array.h
  
 -MAKEFLAGS += --no-print-directory
 +LIB_OBJS += $(OUTPUT)fs/debugfs.o
 +LIB_OBJS += $(OUTPUT)fs/tracefs.o
 +LIB_OBJS += $(OUTPUT)fs/findfs.o
 +LIB_OBJS += $(OUTPUT)fs/fs.o
 +# XXX piggybacking here, need to introduce libapikfd, or rename this
 +# to plain libapik.a and make it have it all api goodies
 +LIB_OBJS += $(OUTPUT)fd/array.o
  
++<<<<<<< HEAD
 +LIBFILE = libapikfs.a
++=======
+ LIBFILE = $(OUTPUT)libapi.a
++>>>>>>> 285a8f247b08 (tools lib api: Rename libapikfs.a to libapi.a)
  
 -CFLAGS := $(EXTRA_WARNINGS) $(EXTRA_CFLAGS)
 -CFLAGS += -ggdb3 -Wall -Wextra -std=gnu99 -Werror -O6 -D_FORTIFY_SOURCE=2 -fPIC
 -CFLAGS += -D_LARGEFILE64_SOURCE -D_FILE_OFFSET_BITS=64
 +CFLAGS = -ggdb3 -Wall -Wextra -std=gnu99 -Werror -O6 -D_FORTIFY_SOURCE=2 $(EXTRA_WARNINGS) $(EXTRA_CFLAGS) -fPIC
 +EXTLIBS = -lelf -lpthread -lrt -lm
 +ALL_CFLAGS = $(CFLAGS) $(BASIC_CFLAGS) -D_LARGEFILE64_SOURCE -D_FILE_OFFSET_BITS=64
 +ALL_LDFLAGS = $(LDFLAGS)
  
  RM = rm -f
  
++<<<<<<< HEAD
 +$(LIBFILE): $(LIB_OBJS)
 +	$(QUIET_AR)$(RM) $@ && $(AR) rcs $(OUTPUT)$@ $(LIB_OBJS)
++=======
+ build  := -f $(srctree)/tools/build/Makefile.build dir=. obj
+ API_IN := $(OUTPUT)libapi-in.o
++>>>>>>> 285a8f247b08 (tools lib api: Rename libapikfs.a to libapi.a)
  
 -export srctree OUTPUT CC LD CFLAGS V
 +$(LIB_OBJS): $(LIB_H)
  
 -all: $(LIBFILE)
 +libapi_dirs:
 +	$(QUIET_MKDIR)mkdir -p $(OUTPUT)fd $(OUTPUT)fs
  
++<<<<<<< HEAD
 +$(OUTPUT)%.o: %.c libapi_dirs
 +	$(QUIET_CC)$(CC) -o $@ -c $(ALL_CFLAGS) $<
 +$(OUTPUT)%.s: %.c libapi_dirs
 +	$(QUIET_CC)$(CC) -S $(ALL_CFLAGS) $<
 +$(OUTPUT)%.o: %.S libapi_dirs
 +	$(QUIET_CC)$(CC) -o $@ -c $(ALL_CFLAGS) $<
 +
 +clean:
 +	$(call QUIET_CLEAN, libapi) $(RM) $(LIB_OBJS) $(LIBFILE)
++=======
+ $(API_IN): FORCE
+ 	@$(MAKE) $(build)=libapi
+ 
+ $(LIBFILE): $(API_IN)
+ 	$(QUIET_AR)$(RM) $@ && $(AR) rcs $@ $(API_IN)
+ 
+ clean:
+ 	$(call QUIET_CLEAN, libapi) $(RM) $(LIBFILE); \
+ 	find $(if $(OUTPUT),$(OUTPUT),.) -name \*.o | xargs $(RM)
++>>>>>>> 285a8f247b08 (tools lib api: Rename libapikfs.a to libapi.a)
  
 -FORCE:
 -
 -.PHONY: clean FORCE
 +.PHONY: clean
diff --cc tools/perf/Makefile.perf
index 9842afffa808,c9088400e138..000000000000
--- a/tools/perf/Makefile.perf
+++ b/tools/perf/Makefile.perf
@@@ -211,221 -212,9 +211,225 @@@ endi
  
  export PERL_PATH
  
 +$(OUTPUT)util/parse-events-flex.c: util/parse-events.l $(OUTPUT)util/parse-events-bison.c
 +	$(QUIET_FLEX)$(FLEX) -o $@ --header-file=$(OUTPUT)util/parse-events-flex.h $(PARSER_DEBUG_FLEX) util/parse-events.l
 +
 +$(OUTPUT)util/parse-events-bison.c: util/parse-events.y
 +	$(QUIET_BISON)$(BISON) -v util/parse-events.y -d $(PARSER_DEBUG_BISON) -o $(OUTPUT)util/parse-events-bison.c -p parse_events_
 +
 +$(OUTPUT)util/pmu-flex.c: util/pmu.l $(OUTPUT)util/pmu-bison.c
 +	$(QUIET_FLEX)$(FLEX) -o $@ --header-file=$(OUTPUT)util/pmu-flex.h util/pmu.l
 +
 +$(OUTPUT)util/pmu-bison.c: util/pmu.y
 +	$(QUIET_BISON)$(BISON) -v util/pmu.y -d -o $(OUTPUT)util/pmu-bison.c -p perf_pmu_
 +
 +$(OUTPUT)util/parse-events.o: $(OUTPUT)util/parse-events-flex.c $(OUTPUT)util/parse-events-bison.c
 +$(OUTPUT)util/pmu.o: $(OUTPUT)util/pmu-flex.c $(OUTPUT)util/pmu-bison.c
 +
  LIB_FILE=$(OUTPUT)libperf.a
  
++<<<<<<< HEAD
 +LIB_H += ../lib/symbol/kallsyms.h
 +LIB_H += ../../include/uapi/linux/perf_event.h
 +LIB_H += ../../include/linux/rbtree.h
 +LIB_H += ../../include/linux/list.h
 +LIB_H += ../../include/uapi/linux/const.h
 +LIB_H += ../include/linux/hash.h
 +LIB_H += ../../include/linux/stringify.h
 +LIB_H += util/include/linux/bitmap.h
 +LIB_H += ../include/linux/bitops.h
 +LIB_H += ../include/asm-generic/bitops/arch_hweight.h
 +LIB_H += ../include/asm-generic/bitops/atomic.h
 +LIB_H += ../include/asm-generic/bitops/const_hweight.h
 +LIB_H += ../include/asm-generic/bitops/find.h
 +LIB_H += ../include/asm-generic/bitops/fls64.h
 +LIB_H += ../include/asm-generic/bitops/fls.h
 +LIB_H += ../include/asm-generic/bitops/__ffs.h
 +LIB_H += ../include/asm-generic/bitops/__fls.h
 +LIB_H += ../include/asm-generic/bitops/hweight.h
 +LIB_H += ../include/asm-generic/bitops.h
 +LIB_H += ../include/linux/compiler.h
 +LIB_H += ../include/linux/log2.h
 +LIB_H += util/include/linux/const.h
 +LIB_H += util/include/linux/ctype.h
 +LIB_H += util/include/linux/kernel.h
 +LIB_H += util/include/linux/list.h
 +LIB_H += ../include/linux/export.h
 +LIB_H += util/include/linux/poison.h
 +LIB_H += util/include/linux/rbtree.h
 +LIB_H += util/include/linux/rbtree_augmented.h
 +LIB_H += util/include/linux/string.h
 +LIB_H += ../include/linux/types.h
 +LIB_H += util/include/linux/linkage.h
 +LIB_H += util/include/asm/asm-offsets.h
 +LIB_H += ../include/asm/bug.h
 +LIB_H += util/include/asm/byteorder.h
 +LIB_H += util/include/asm/swab.h
 +LIB_H += util/include/asm/system.h
 +LIB_H += util/include/asm/uaccess.h
 +LIB_H += util/include/dwarf-regs.h
 +LIB_H += util/include/asm/dwarf2.h
 +LIB_H += util/include/asm/cpufeature.h
 +LIB_H += util/include/asm/unistd_32.h
 +LIB_H += util/include/asm/unistd_64.h
 +LIB_H += perf.h
 +LIB_H += util/annotate.h
 +LIB_H += util/cache.h
 +LIB_H += util/callchain.h
 +LIB_H += util/build-id.h
 +LIB_H += util/db-export.h
 +LIB_H += util/debug.h
 +LIB_H += util/pmu.h
 +LIB_H += util/event.h
 +LIB_H += util/evsel.h
 +LIB_H += util/evlist.h
 +LIB_H += util/exec_cmd.h
 +LIB_H += util/find-vdso-map.c
 +LIB_H += util/levenshtein.h
 +LIB_H += util/machine.h
 +LIB_H += util/map.h
 +LIB_H += util/parse-options.h
 +LIB_H += util/parse-events.h
 +LIB_H += util/quote.h
 +LIB_H += util/util.h
 +LIB_H += util/xyarray.h
 +LIB_H += util/header.h
 +LIB_H += util/help.h
 +LIB_H += util/session.h
 +LIB_H += util/strbuf.h
 +LIB_H += util/strlist.h
 +LIB_H += util/strfilter.h
 +LIB_H += util/svghelper.h
 +LIB_H += util/tool.h
 +LIB_H += util/run-command.h
 +LIB_H += util/sigchain.h
 +LIB_H += util/dso.h
 +LIB_H += util/symbol.h
 +LIB_H += util/color.h
 +LIB_H += util/values.h
 +LIB_H += util/sort.h
 +LIB_H += util/hist.h
 +LIB_H += util/comm.h
 +LIB_H += util/thread.h
 +LIB_H += util/thread_map.h
 +LIB_H += util/trace-event.h
 +LIB_H += util/probe-finder.h
 +LIB_H += util/dwarf-aux.h
 +LIB_H += util/probe-event.h
 +LIB_H += util/pstack.h
 +LIB_H += util/cpumap.h
 +LIB_H += util/top.h
 +LIB_H += $(ARCH_INCLUDE)
 +LIB_H += util/cgroup.h
 +LIB_H += $(LIB_INCLUDE)traceevent/event-parse.h
 +LIB_H += util/target.h
 +LIB_H += util/rblist.h
 +LIB_H += util/intlist.h
 +LIB_H += util/perf_regs.h
 +LIB_H += util/unwind.h
 +LIB_H += util/vdso.h
 +LIB_H += util/tsc.h
 +LIB_H += ui/helpline.h
 +LIB_H += ui/progress.h
 +LIB_H += ui/util.h
 +LIB_H += ui/ui.h
 +LIB_H += util/data.h
 +LIB_H += util/kvm-stat.h
 +LIB_H += util/thread-stack.h
 +
 +LIB_OBJS += $(OUTPUT)util/abspath.o
 +LIB_OBJS += $(OUTPUT)util/alias.o
 +LIB_OBJS += $(OUTPUT)util/annotate.o
 +LIB_OBJS += $(OUTPUT)util/build-id.o
 +LIB_OBJS += $(OUTPUT)util/config.o
 +LIB_OBJS += $(OUTPUT)util/ctype.o
 +LIB_OBJS += $(OUTPUT)util/db-export.o
 +LIB_OBJS += $(OUTPUT)util/pmu.o
 +LIB_OBJS += $(OUTPUT)util/environment.o
 +LIB_OBJS += $(OUTPUT)util/event.o
 +LIB_OBJS += $(OUTPUT)util/evlist.o
 +LIB_OBJS += $(OUTPUT)util/evsel.o
 +LIB_OBJS += $(OUTPUT)util/exec_cmd.o
 +LIB_OBJS += $(OUTPUT)util/find_next_bit.o
 +LIB_OBJS += $(OUTPUT)util/help.o
 +LIB_OBJS += $(OUTPUT)util/kallsyms.o
 +LIB_OBJS += $(OUTPUT)util/levenshtein.o
 +LIB_OBJS += $(OUTPUT)util/parse-options.o
 +LIB_OBJS += $(OUTPUT)util/parse-events.o
 +LIB_OBJS += $(OUTPUT)util/path.o
 +LIB_OBJS += $(OUTPUT)util/rbtree.o
 +LIB_OBJS += $(OUTPUT)util/bitmap.o
 +LIB_OBJS += $(OUTPUT)util/hweight.o
 +LIB_OBJS += $(OUTPUT)util/run-command.o
 +LIB_OBJS += $(OUTPUT)util/quote.o
 +LIB_OBJS += $(OUTPUT)util/strbuf.o
 +LIB_OBJS += $(OUTPUT)util/string.o
 +LIB_OBJS += $(OUTPUT)util/strlist.o
 +LIB_OBJS += $(OUTPUT)util/strfilter.o
 +LIB_OBJS += $(OUTPUT)util/top.o
 +LIB_OBJS += $(OUTPUT)util/usage.o
 +LIB_OBJS += $(OUTPUT)util/wrapper.o
 +LIB_OBJS += $(OUTPUT)util/sigchain.o
 +LIB_OBJS += $(OUTPUT)util/dso.o
 +LIB_OBJS += $(OUTPUT)util/symbol.o
 +LIB_OBJS += $(OUTPUT)util/symbol-elf.o
 +LIB_OBJS += $(OUTPUT)util/color.o
 +LIB_OBJS += $(OUTPUT)util/pager.o
 +LIB_OBJS += $(OUTPUT)util/header.o
 +LIB_OBJS += $(OUTPUT)util/callchain.o
 +LIB_OBJS += $(OUTPUT)util/values.o
 +LIB_OBJS += $(OUTPUT)util/debug.o
 +LIB_OBJS += $(OUTPUT)util/machine.o
 +LIB_OBJS += $(OUTPUT)util/map.o
 +LIB_OBJS += $(OUTPUT)util/pstack.o
 +LIB_OBJS += $(OUTPUT)util/session.o
 +LIB_OBJS += $(OUTPUT)util/comm.o
 +LIB_OBJS += $(OUTPUT)util/thread.o
 +LIB_OBJS += $(OUTPUT)util/thread_map.o
 +LIB_OBJS += $(OUTPUT)util/trace-event-parse.o
 +LIB_OBJS += $(OUTPUT)util/parse-events-flex.o
 +LIB_OBJS += $(OUTPUT)util/parse-events-bison.o
 +LIB_OBJS += $(OUTPUT)util/pmu-flex.o
 +LIB_OBJS += $(OUTPUT)util/pmu-bison.o
 +LIB_OBJS += $(OUTPUT)util/trace-event-read.o
 +LIB_OBJS += $(OUTPUT)util/trace-event-info.o
 +LIB_OBJS += $(OUTPUT)util/trace-event-scripting.o
 +LIB_OBJS += $(OUTPUT)util/trace-event.o
 +LIB_OBJS += $(OUTPUT)util/svghelper.o
 +LIB_OBJS += $(OUTPUT)util/sort.o
 +LIB_OBJS += $(OUTPUT)util/hist.o
 +LIB_OBJS += $(OUTPUT)util/probe-event.o
 +LIB_OBJS += $(OUTPUT)util/util.o
 +LIB_OBJS += $(OUTPUT)util/xyarray.o
 +LIB_OBJS += $(OUTPUT)util/cpumap.o
 +LIB_OBJS += $(OUTPUT)util/cgroup.o
 +LIB_OBJS += $(OUTPUT)util/target.o
 +LIB_OBJS += $(OUTPUT)util/rblist.o
 +LIB_OBJS += $(OUTPUT)util/intlist.o
 +LIB_OBJS += $(OUTPUT)util/vdso.o
 +LIB_OBJS += $(OUTPUT)util/stat.o
 +LIB_OBJS += $(OUTPUT)util/record.o
 +LIB_OBJS += $(OUTPUT)util/srcline.o
 +LIB_OBJS += $(OUTPUT)util/data.o
 +LIB_OBJS += $(OUTPUT)util/tsc.o
 +LIB_OBJS += $(OUTPUT)util/cloexec.o
 +LIB_OBJS += $(OUTPUT)util/thread-stack.o
 +
 +LIB_OBJS += $(OUTPUT)ui/setup.o
 +LIB_OBJS += $(OUTPUT)ui/helpline.o
 +LIB_OBJS += $(OUTPUT)ui/progress.o
 +LIB_OBJS += $(OUTPUT)ui/util.o
 +LIB_OBJS += $(OUTPUT)ui/hist.o
 +LIB_OBJS += $(OUTPUT)ui/stdio/hist.o
 +
 +LIB_OBJS += $(OUTPUT)arch/common.o
 +
 +BUILTIN_OBJS += $(OUTPUT)builtin-probe.o
 +
 +PERFLIBS = $(LIB_FILE) $(LIBAPIKFS) $(LIBTRACEEVENT)
++=======
+ PERFLIBS = $(LIB_FILE) $(LIBAPI) $(LIBTRACEEVENT)
++>>>>>>> 285a8f247b08 (tools lib api: Rename libapikfs.a to libapi.a)
  
  # We choose to avoid "if .. else if .. else .. endif endif"
  # because maintaining the nesting to match is a pain.  If
@@@ -721,20 -375,12 +725,28 @@@ $(LIBTRACEEVENT)-clean
  install-traceevent-plugins: $(LIBTRACEEVENT)
  	$(QUIET_SUBDIR0)$(TRACE_EVENT_DIR) $(LIBTRACEEVENT_FLAGS) install_plugins
  
++<<<<<<< HEAD
 +LIBAPIKFS_SOURCES = $(wildcard $(LIB_PATH)fs/*.[ch] $(LIB_PATH)fd/*.[ch])
 +
 +# if subdir is set, we've been called from above so target has been built
 +# already
 +$(LIBAPIKFS): $(LIBAPIKFS_SOURCES)
 +ifeq ($(subdir),)
 +	$(QUIET_SUBDIR0)$(LIB_DIR) $(QUIET_SUBDIR1) O=$(OUTPUT) libapikfs.a
 +endif
 +
 +$(LIBAPIKFS)-clean:
 +ifeq ($(subdir),)
 +	$(call QUIET_CLEAN, libapikfs)
++=======
+ $(LIBAPI): FORCE
+ 	@$(MAKE) -C $(LIB_DIR) O=$(OUTPUT) $(OUTPUT)libapi.a
+ 
+ $(LIBAPI)-clean:
+ 	$(call QUIET_CLEAN, libapi)
++>>>>>>> 285a8f247b08 (tools lib api: Rename libapikfs.a to libapi.a)
  	@$(MAKE) -C $(LIB_DIR) O=$(OUTPUT) clean >/dev/null
 +endif
  
  help:
  	@echo 'Perf make targets:'
@@@ -885,8 -520,8 +897,13 @@@ config-clean
  	$(call QUIET_CLEAN, config)
  	@$(MAKE) -C config/feature-checks clean >/dev/null
  
++<<<<<<< HEAD
 +clean: $(LIBTRACEEVENT)-clean $(LIBAPIKFS)-clean config-clean
 +	$(call QUIET_CLEAN, core-objs)  $(RM) $(LIB_OBJS) $(BUILTIN_OBJS) $(LIB_FILE) $(OUTPUT)perf-archive $(OUTPUT)perf-with-kcore $(OUTPUT)perf.o $(LANG_BINDINGS) $(GTK_OBJS)
++=======
+ clean: $(LIBTRACEEVENT)-clean $(LIBAPI)-clean config-clean
+ 	$(call QUIET_CLEAN, core-objs)  $(RM) $(LIB_FILE) $(OUTPUT)perf-archive $(OUTPUT)perf-with-kcore $(LANG_BINDINGS)
++>>>>>>> 285a8f247b08 (tools lib api: Rename libapikfs.a to libapi.a)
  	@find . -name '*.o' -delete -o -name '\.*.cmd' -delete -o -name '\.*.d' -delete
  	@$(RM) .config-detected
  	$(call QUIET_CLEAN, core-progs) $(RM) $(ALL_PROGRAMS) perf perf-read-vdso32 perf-read-vdsox32
* Unmerged path tools/lib/api/Build
* Unmerged path tools/lib/api/fd/Build
* Unmerged path tools/lib/api/fs/Build
* Unmerged path tools/lib/api/Build
* Unmerged path tools/lib/api/Makefile
* Unmerged path tools/lib/api/fd/Build
* Unmerged path tools/lib/api/fs/Build
* Unmerged path tools/perf/Makefile.perf
diff --git a/tools/perf/util/setup.py b/tools/perf/util/setup.py
index d0aee4b9dfd4..1833103768cb 100644
--- a/tools/perf/util/setup.py
+++ b/tools/perf/util/setup.py
@@ -25,7 +25,7 @@ cflags += ['-fno-strict-aliasing', '-Wno-write-strings', '-Wno-unused-parameter'
 build_lib = getenv('PYTHON_EXTBUILD_LIB')
 build_tmp = getenv('PYTHON_EXTBUILD_TMP')
 libtraceevent = getenv('LIBTRACEEVENT')
-libapikfs = getenv('LIBAPIKFS')
+libapikfs = getenv('LIBAPI')
 
 ext_sources = [f.strip() for f in file('util/python-ext-sources')
 				if len(f.strip()) > 0 and f[0] != '#']
