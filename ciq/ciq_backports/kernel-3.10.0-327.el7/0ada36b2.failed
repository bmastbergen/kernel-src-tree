CIFS: Separate page reading from user read

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-327.el7
commit-author Pavel Shilovsky <pshilovsky@samba.org>
commit 0ada36b244e8316bb47b46b84b33c5a507bed7a4
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-327.el7/0ada36b2.failed

	Reviewed-by: Shirish Pargaonkar <spargaonkar@suse.com>
	Signed-off-by: Pavel Shilovsky <pshilovsky@samba.org>
	Signed-off-by: Steve French <smfrench@gmail.com>
(cherry picked from commit 0ada36b244e8316bb47b46b84b33c5a507bed7a4)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	fs/cifs/file.c
diff --cc fs/cifs/file.c
index 73059488e983,7df4e4658d74..000000000000
--- a/fs/cifs/file.c
+++ b/fs/cifs/file.c
@@@ -2875,40 -2932,16 +2875,53 @@@ cifs_uncached_read_into_pages(struct TC
  	return total_read > 0 && result != -EAGAIN ? total_read : result;
  }
  
++<<<<<<< HEAD
 +ssize_t cifs_user_readv(struct kiocb *iocb, const struct iovec *iov,
 +			       unsigned long nr_segs, loff_t pos)
 +{
 +	struct file *file = iocb->ki_filp;
 +	ssize_t rc;
 +	size_t len, cur_len;
 +	ssize_t total_read = 0;
 +	loff_t offset = pos;
 +	unsigned int npages;
 +	struct cifs_sb_info *cifs_sb;
 +	struct cifs_tcon *tcon;
 +	struct cifsFileInfo *open_file;
 +	struct cifs_readdata *rdata, *tmp;
 +	struct list_head rdata_list;
 +	struct iov_iter to;
 +	pid_t pid;
 +
 +	if (!nr_segs)
 +		return 0;
 +
 +	len = iov_length(iov, nr_segs);
 +	if (!len)
 +		return 0;
 +
 +	iov_iter_init(&to, iov, nr_segs, len, 0);
 +
 +	INIT_LIST_HEAD(&rdata_list);
 +	cifs_sb = CIFS_SB(file->f_path.dentry->d_sb);
 +	open_file = file->private_data;
 +	tcon = tlink_tcon(open_file->tlink);
 +
 +	if (!tcon->ses->server->ops->async_readv)
 +		return -ENOSYS;
 +
++=======
+ static int
+ cifs_send_async_read(loff_t offset, size_t len, struct cifsFileInfo *open_file,
+ 		     struct cifs_sb_info *cifs_sb, struct list_head *rdata_list)
+ {
+ 	struct cifs_readdata *rdata;
+ 	unsigned int npages;
+ 	size_t cur_len;
+ 	int rc;
+ 	pid_t pid;
+ 
++>>>>>>> 0ada36b244e8 (CIFS: Separate page reading from user read)
  	if (cifs_sb->mnt_cifs_flags & CIFS_MOUNT_RWPIDFORWARD)
  		pid = open_file->pid;
  	else
* Unmerged path fs/cifs/file.c
