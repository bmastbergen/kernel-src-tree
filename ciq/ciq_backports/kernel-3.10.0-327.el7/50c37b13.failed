md: don't require sync_min to be a multiple of chunk_size.

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-327.el7
Rebuild_CHGLOG: - [md] don't require sync_min to be a multiple of chunk_size (Jes Sorensen) [1150149 1173510 1194720]
Rebuild_FUZZ: 95.50%
commit-author NeilBrown <neilb@suse.de>
commit 50c37b136a3807eda44afe16529b5af701ec49f5
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-327.el7/50c37b13.failed

There is really no need for sync_min to be a multiple of
chunk_size, and values read from here often aren't.
That means you cannot read a value and expect to be able
to write it back later.

So remove the chunk_size check, and round down to a multiple
of 4K, to be sure everything works with 4K-sector devices.

	Signed-off-by: NeilBrown <neilb@suse.de>
(cherry picked from commit 50c37b136a3807eda44afe16529b5af701ec49f5)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/md/md.c
diff --cc drivers/md/md.c
index 5d8c7c589a1e,3724a29eaf0e..000000000000
--- a/drivers/md/md.c
+++ b/drivers/md/md.c
@@@ -4413,22 -4426,27 +4413,33 @@@ static ssize_
  min_sync_store(struct mddev *mddev, const char *buf, size_t len)
  {
  	unsigned long long min;
++<<<<<<< HEAD
++=======
+ 	int err;
+ 
++>>>>>>> 50c37b136a38 (md: don't require sync_min to be a multiple of chunk_size.)
  	if (kstrtoull(buf, 10, &min))
  		return -EINVAL;
 -
 -	spin_lock(&mddev->lock);
 -	err = -EINVAL;
  	if (min > mddev->resync_max)
 -		goto out_unlock;
 -
 -	err = -EBUSY;
 +		return -EINVAL;
  	if (test_bit(MD_RECOVERY_RUNNING, &mddev->recovery))
 -		goto out_unlock;
 +		return -EBUSY;
  
++<<<<<<< HEAD
 +	/* Must be a multiple of chunk_size */
 +	if (mddev->chunk_sectors) {
 +		sector_t temp = min;
 +		if (sector_div(temp, mddev->chunk_sectors))
 +			return -EINVAL;
 +	}
 +	mddev->resync_min = min;
++=======
+ 	/* Round down to multiple of 4K for safety */
+ 	mddev->resync_min = round_down(min, 8);
+ 	err = 0;
++>>>>>>> 50c37b136a38 (md: don't require sync_min to be a multiple of chunk_size.)
  
 -out_unlock:
 -	spin_unlock(&mddev->lock);
 -	return err ?: len;
 +	return len;
  }
  
  static struct md_sysfs_entry md_min_sync =
* Unmerged path drivers/md/md.c
