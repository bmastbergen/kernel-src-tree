net: Verify permission to dest_net in newlink

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-327.el7
Rebuild_CHGLOG: - [net] Verify permission to dest_net in newlink (Jiri Benc) [1210260]
Rebuild_FUZZ: 94.12%
commit-author Eric W. Biederman <ebiederm@xmission.com>
commit 505ce4154ac86c250aa4a84a536dd9fc56479bb5
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-327.el7/505ce415.failed

When applicable verify that the caller has permision to create a
network device in another network namespace.  This check is already
present when moving a network device between network namespaces in
setlink so all that is needed is to duplicate that check in newlink.

This change almost backports cleanly, but there are context conflicts
as the code that follows was added in v4.0-rc1

Fixes: b51642f6d77b net: Enable a userns root rtnl calls that are safe for unprivilged users
	Signed-off-by: "Eric W. Biederman" <ebiederm@xmission.com>
	Acked-by: Nicolas Dichtel <nicolas.dichtel@6wind.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 505ce4154ac86c250aa4a84a536dd9fc56479bb5)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/core/rtnetlink.c
diff --cc net/core/rtnetlink.c
index 187818c8949a,b237959c7497..000000000000
--- a/net/core/rtnetlink.c
+++ b/net/core/rtnetlink.c
@@@ -1911,7 -2122,22 +1911,26 @@@ replay
  		if (IS_ERR(dest_net))
  			return PTR_ERR(dest_net);
  
++<<<<<<< HEAD
 +		dev = rtnl_create_link(dest_net, ifname, ops, tb);
++=======
+ 		err = -EPERM;
+ 		if (!netlink_ns_capable(skb, dest_net->user_ns, CAP_NET_ADMIN))
+ 			goto out;
+ 
+ 		if (tb[IFLA_LINK_NETNSID]) {
+ 			int id = nla_get_s32(tb[IFLA_LINK_NETNSID]);
+ 
+ 			link_net = get_net_ns_by_id(dest_net, id);
+ 			if (!link_net) {
+ 				err =  -EINVAL;
+ 				goto out;
+ 			}
+ 		}
+ 
+ 		dev = rtnl_create_link(link_net ? : dest_net, ifname,
+ 				       name_assign_type, ops, tb);
++>>>>>>> 505ce4154ac8 (net: Verify permission to dest_net in newlink)
  		if (IS_ERR(dev)) {
  			err = PTR_ERR(dev);
  			goto out;
* Unmerged path net/core/rtnetlink.c
