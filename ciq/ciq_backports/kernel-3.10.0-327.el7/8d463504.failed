vlan: Add features for stacked vlan device

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-327.el7
commit-author Toshiaki Makita <makita.toshiaki@lab.ntt.co.jp>
commit 8d463504c191c2126d097ac94fb258aabe6d3e62
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-327.el7/8d463504.failed

Stacked vlan devices curretly have few features (GRO, HIGHDMA, LLTX).
Since we have software fallbacks in case the NIC can not handle some
features for multiple vlans, we can add the same features as the lower
vlan devices for stacked vlan devices.

This allows stacked vlan devices to create large (GSO) packets and not to
segment packets. Those packets will be segmented by software on the real
device, or even can be segmented by the NIC once TSO for multiple vlans
becomes enabled by the following patches.

The exception is those related to FCoE, which does not have a software
fallback.

	Signed-off-by: Toshiaki Makita <makita.toshiaki@lab.ntt.co.jp>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 8d463504c191c2126d097ac94fb258aabe6d3e62)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/8021q/vlan_dev.c
diff --cc net/8021q/vlan_dev.c
index 72c85a5b3db3,8b5ab9033b41..000000000000
--- a/net/8021q/vlan_dev.c
+++ b/net/8021q/vlan_dev.c
@@@ -573,8 -548,13 +573,15 @@@ static int vlan_dev_init(struct net_dev
  			   NETIF_F_HIGHDMA | NETIF_F_SCTP_CSUM |
  			   NETIF_F_ALL_FCOE;
  
 -	dev->features |= real_dev->vlan_features | NETIF_F_LLTX |
 -			 NETIF_F_GSO_SOFTWARE;
 +	dev->features |= real_dev->vlan_features | NETIF_F_LLTX;
  	dev->gso_max_size = real_dev->gso_max_size;
++<<<<<<< HEAD
++=======
+ 	if (dev->features & NETIF_F_VLAN_FEATURES)
+ 		netdev_warn(real_dev, "VLAN features are set incorrectly.  Q-in-Q configurations may not work correctly.\n");
+ 
+ 	dev->vlan_features = real_dev->vlan_features & ~NETIF_F_ALL_FCOE;
++>>>>>>> 8d463504c191 (vlan: Add features for stacked vlan device)
  
  	/* ipv6 shared card related stuff */
  	dev->dev_id = real_dev->dev_id;
* Unmerged path net/8021q/vlan_dev.c
