KVM: nVMX: Disable unrestricted mode if ept=0

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-327.el7
Rebuild_CHGLOG: - [kvm] nvmx: Disable unrestricted mode if ept=0 (Bandan Das) [1209995]
Rebuild_FUZZ: 94.12%
commit-author Bandan Das <bsd@redhat.com>
commit 78051e3b7e35722ad3f31dd611f1b34770bddab8
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-327.el7/78051e3b.failed

If L0 has disabled EPT, don't advertise unrestricted
mode at all since it depends on EPT to run real mode code.

Fixes: 92fbc7b195b824e201d9f06f2b93105f72384d65
	Cc: stable@vger.kernel.org
	Reviewed-by: Jan Kiszka <jan.kiszka@siemens.com>
	Signed-off-by: Bandan Das <bsd@redhat.com>
	Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>
(cherry picked from commit 78051e3b7e35722ad3f31dd611f1b34770bddab8)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/x86/kvm/vmx.c
diff --cc arch/x86/kvm/vmx.c
index 24b8ccc9c673,feb852b04598..000000000000
--- a/arch/x86/kvm/vmx.c
+++ b/arch/x86/kvm/vmx.c
@@@ -2386,8 -2399,8 +2386,13 @@@ static __init void nested_vmx_setup_ctl
  	nested_vmx_secondary_ctls_low = 0;
  	nested_vmx_secondary_ctls_high &=
  		SECONDARY_EXEC_VIRTUALIZE_APIC_ACCESSES |
++<<<<<<< HEAD
 +		SECONDARY_EXEC_UNRESTRICTED_GUEST |
 +		SECONDARY_EXEC_WBINVD_EXITING;
++=======
+ 		SECONDARY_EXEC_WBINVD_EXITING |
+ 		SECONDARY_EXEC_XSAVES;
++>>>>>>> 78051e3b7e35 (KVM: nVMX: Disable unrestricted mode if ept=0)
  
  	if (enable_ept) {
  		/* nested EPT: emulate EPT also to L1 */
* Unmerged path arch/x86/kvm/vmx.c
