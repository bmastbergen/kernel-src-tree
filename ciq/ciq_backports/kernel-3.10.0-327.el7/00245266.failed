drm/i915/ppgtt: Break loop in gen8_ppgtt_clear_range failure path

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-327.el7
Rebuild_CHGLOG: - [drm] i915/ppgtt: Break loop in gen8_ppgtt_clear_range failure path (Rob Clark) [1249805]
Rebuild_FUZZ: 96.83%
commit-author Michel Thierry <michel.thierry@intel.com>
commit 00245266b4be4fbe989ee073663f56716da6c1f3
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-327.el7/00245266.failed

If for some reason [1], the page directory/table does not exist, clear_range
would end up in an infinite while loop.

Introduced by commit 06fda602dbca ("drm/i915: Create page table allocators").

[1] This is already being addressed in one of Mika's patches:
http://mid.gmane.org/1432314314-23530-17-git-send-email-mika.kuoppala@intel.com

	Cc: Mika Kuoppala <mika.kuoppala@linux.intel.com>
	Cc: stable@vger.kernel.org
	Reported-by: John Harrison <john.c.harrison@intel.com>
	Signed-off-by: Michel Thierry <michel.thierry@intel.com>
	Reviewed-by: Mika Kuoppala <mika.kuoppala@intel.com>
	Signed-off-by: Jani Nikula <jani.nikula@intel.com>
(cherry picked from commit 00245266b4be4fbe989ee073663f56716da6c1f3)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/gpu/drm/i915/i915_gem_gtt.c
diff --cc drivers/gpu/drm/i915/i915_gem_gtt.c
index aa20a2a9996c,9daa2883ac18..000000000000
--- a/drivers/gpu/drm/i915/i915_gem_gtt.c
+++ b/drivers/gpu/drm/i915/i915_gem_gtt.c
@@@ -273,11 -511,28 +273,32 @@@ static void gen8_ppgtt_clear_range(stru
  				      I915_CACHE_LLC, use_scratch);
  
  	while (num_entries) {
++<<<<<<< HEAD
 +		struct page *page_table = ppgtt->gen8_pt_pages[pdpe][pde];
++=======
+ 		struct i915_page_directory *pd;
+ 		struct i915_page_table *pt;
+ 		struct page *page_table;
+ 
+ 		if (WARN_ON(!ppgtt->pdp.page_directory[pdpe]))
+ 			break;
+ 
+ 		pd = ppgtt->pdp.page_directory[pdpe];
+ 
+ 		if (WARN_ON(!pd->page_table[pde]))
+ 			break;
+ 
+ 		pt = pd->page_table[pde];
+ 
+ 		if (WARN_ON(!pt->page))
+ 			break;
+ 
+ 		page_table = pt->page;
++>>>>>>> 00245266b4be (drm/i915/ppgtt: Break loop in gen8_ppgtt_clear_range failure path)
  
  		last_pte = pte + num_entries;
 -		if (last_pte > GEN8_PTES)
 -			last_pte = GEN8_PTES;
 +		if (last_pte > GEN8_PTES_PER_PAGE)
 +			last_pte = GEN8_PTES_PER_PAGE;
  
  		pt_vaddr = kmap_atomic(page_table);
  
* Unmerged path drivers/gpu/drm/i915/i915_gem_gtt.c
