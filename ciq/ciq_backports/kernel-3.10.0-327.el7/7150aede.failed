IPv6: Fixed support for blackhole and prohibit routes

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-327.el7
commit-author Kamala R <kamala@aristanetworks.com>
commit 7150aede5dd241539686e17d9592f5ebd28a2cda
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-327.el7/7150aede.failed

The behaviour of blackhole and prohibit routes has been corrected by setting
the input and output pointers of the dst variable appropriately. For
blackhole routes, they are set to dst_discard and to ip6_pkt_discard and
ip6_pkt_discard_out respectively for prohibit routes.

ipv6: ip6_pkt_prohibit(_out) should not depend on
CONFIG_IPV6_MULTIPLE_TABLES

We need ip6_pkt_prohibit(_out) available without
CONFIG_IPV6_MULTIPLE_TABLES

	Signed-off-by: Kamala R <kamala@aristanetworks.com>
	Acked-by: Hannes Frederic Sowa <hannes@stressinduktion.org>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 7150aede5dd241539686e17d9592f5ebd28a2cda)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/ipv6/route.c
diff --cc net/ipv6/route.c
index 2f320d61d648,ddb9d41c8eea..000000000000
--- a/net/ipv6/route.c
+++ b/net/ipv6/route.c
@@@ -84,7 -83,9 +84,13 @@@ static void		ip6_dst_ifdown(struct dst_
  static int		 ip6_dst_gc(struct dst_ops *ops);
  
  static int		ip6_pkt_discard(struct sk_buff *skb);
++<<<<<<< HEAD
 +static int		ip6_pkt_discard_out(struct sock *sk, struct sk_buff *skb);
++=======
+ static int		ip6_pkt_discard_out(struct sk_buff *skb);
+ static int		ip6_pkt_prohibit(struct sk_buff *skb);
+ static int		ip6_pkt_prohibit_out(struct sk_buff *skb);
++>>>>>>> 7150aede5dd2 (IPv6: Fixed support for blackhole and prohibit routes)
  static void		ip6_link_failure(struct sk_buff *skb);
  static void		ip6_rt_update_pmtu(struct dst_entry *dst, struct sock *sk,
  					   struct sk_buff *skb, u32 mtu);
@@@ -234,9 -236,6 +240,12 @@@ static const struct rt6_info ip6_null_e
  
  #ifdef CONFIG_IPV6_MULTIPLE_TABLES
  
++<<<<<<< HEAD
 +static int ip6_pkt_prohibit(struct sk_buff *skb);
 +static int ip6_pkt_prohibit_out(struct sock *sk, struct sk_buff *skb);
 +
++=======
++>>>>>>> 7150aede5dd2 (IPv6: Fixed support for blackhole and prohibit routes)
  static const struct rt6_info ip6_prohibit_entry_template = {
  	.dst = {
  		.__refcnt	= ATOMIC_INIT(1),
* Unmerged path net/ipv6/route.c
