powerpc/powernv: Don't map M64 segments using M32DT

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-327.el7
Rebuild_CHGLOG: - [powerpc] powernv: Don't map M64 segments using M32DT (Laurent Vivier) [1213675]
Rebuild_FUZZ: 91.49%
commit-author Gavin Shan <gwshan@linux.vnet.ibm.com>
commit 027fa02f84e851e21daffdf8900d6117071890f8
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-327.el7/027fa02f.failed

If M64 has been supported, the prefetchable 64-bits memory resources
shouldn't be mapped to the corresponding PE# via M32DT. Unfortunately,
we're doing that in pnv_ioda_setup_pe_seg() wrongly. The issue was
introduced by commit 262af55 ("powerpc/powernv: Enable M64 aperatus
for PHB3"). The patch fixes the issue by simply skipping M64 resources
when updating to M32DT.

	Cc: <stable@vger.kernel.org>  # v3.17+
	Signed-off-by: Gavin Shan <gwshan@linux.vnet.ibm.com>
	Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
(cherry picked from commit 027fa02f84e851e21daffdf8900d6117071890f8)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/powerpc/platforms/powernv/pci-ioda.c
diff --cc arch/powerpc/platforms/powernv/pci-ioda.c
index 5dc950667f50,76b344125cef..000000000000
--- a/arch/powerpc/platforms/powernv/pci-ioda.c
+++ b/arch/powerpc/platforms/powernv/pci-ioda.c
@@@ -1041,10 -1777,8 +1041,15 @@@ static void pnv_ioda_setup_pe_seg(struc
  				region.start += phb->ioda.io_segsize;
  				index++;
  			}
++<<<<<<< HEAD
 +		} else if (res->flags & IORESOURCE_MEM) {
 +			/* WARNING: Assumes M32 is mem region 0 in PHB. We need to
 +			 * harden that algorithm when we start supporting M64
 +			 */
++=======
+ 		} else if ((res->flags & IORESOURCE_MEM) &&
+ 			   !pnv_pci_is_mem_pref_64(res->flags)) {
++>>>>>>> 027fa02f84e8 (powerpc/powernv: Don't map M64 segments using M32DT)
  			region.start = res->start -
  				       hose->mem_offset[0] -
  				       phb->ioda.m32_pci_base;
* Unmerged path arch/powerpc/platforms/powernv/pci-ioda.c
