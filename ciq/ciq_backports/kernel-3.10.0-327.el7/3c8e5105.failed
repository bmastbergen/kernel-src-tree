s390/kdump: fix REGSET_VX_LOW vector register ELF notes

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-327.el7
Rebuild_CHGLOG: - [s390] kdump: fix REGSET_VX_LOW vector register ELF notes (Hendrik Brueckner) [1236566]
Rebuild_FUZZ: 95.24%
commit-author Michael Holzheu <holzheu@linux.vnet.ibm.com>
commit 3c8e5105e759e7b2d88ea8a85b1285e535bc7500
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-327.el7/3c8e5105.failed

The REGSET_VX_LOW ELF notes should contain the lower 64 bit halfes of the
first sixteen 128 bit vector registers. Unfortunately currently we copy
the upper halfes.

Fix this and correctly copy the lower halfes.

Fixes: a62bc0739253 ("s390/kdump: add support for vector extension")
	Cc: stable@vger.kernel.org # 3.18+
	Signed-off-by: Michael Holzheu <holzheu@linux.vnet.ibm.com>
	Signed-off-by: Martin Schwidefsky <schwidefsky@de.ibm.com>
(cherry picked from commit 3c8e5105e759e7b2d88ea8a85b1285e535bc7500)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/s390/kernel/crash_dump.c
diff --cc arch/s390/kernel/crash_dump.c
index 826f57dff94f,f56cd733b6e1..000000000000
--- a/arch/s390/kernel/crash_dump.c
+++ b/arch/s390/kernel/crash_dump.c
@@@ -383,9 -387,45 +383,48 @@@ static void *nt_s390_prefix(void *ptr, 
  }
  
  /*
++<<<<<<< HEAD
++=======
+  * Initialize vxrs high note (full 128 bit VX registers 16-31)
+  */
+ static void *nt_s390_vx_high(void *ptr, __vector128 *vx_regs)
+ {
+ 	return nt_init(ptr, NT_S390_VXRS_HIGH, &vx_regs[16],
+ 		       16 * sizeof(__vector128), KEXEC_CORE_NOTE_NAME);
+ }
+ 
+ /*
+  * Initialize vxrs low note (lower halves of VX registers 0-15)
+  */
+ static void *nt_s390_vx_low(void *ptr, __vector128 *vx_regs)
+ {
+ 	Elf64_Nhdr *note;
+ 	u64 len;
+ 	int i;
+ 
+ 	note = (Elf64_Nhdr *)ptr;
+ 	note->n_namesz = strlen(KEXEC_CORE_NOTE_NAME) + 1;
+ 	note->n_descsz = 16 * 8;
+ 	note->n_type = NT_S390_VXRS_LOW;
+ 	len = sizeof(Elf64_Nhdr);
+ 
+ 	memcpy(ptr + len, KEXEC_CORE_NOTE_NAME, note->n_namesz);
+ 	len = roundup(len + note->n_namesz, 4);
+ 
+ 	ptr += len;
+ 	/* Copy lower halves of SIMD registers 0-15 */
+ 	for (i = 0; i < 16; i++) {
+ 		memcpy(ptr, &vx_regs[i].u[2], 8);
+ 		ptr += 8;
+ 	}
+ 	return ptr;
+ }
+ 
+ /*
++>>>>>>> 3c8e5105e759 (s390/kdump: fix REGSET_VX_LOW vector register ELF notes)
   * Fill ELF notes for one CPU with save area registers
   */
 -void *fill_cpu_elf_notes(void *ptr, struct save_area *sa, __vector128 *vx_regs)
 +void *fill_cpu_elf_notes(void *ptr, struct save_area *sa)
  {
  	ptr = nt_prstatus(ptr, sa);
  	ptr = nt_fpregset(ptr, sa);
* Unmerged path arch/s390/kernel/crash_dump.c
