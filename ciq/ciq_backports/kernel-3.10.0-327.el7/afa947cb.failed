xfs: bulkstat btree walk doesn't terminate

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-327.el7
commit-author Dave Chinner <dchinner@redhat.com>
commit afa947cb52a8e73fe71915a0b0af6fcf98dfbe1a
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-327.el7/afa947cb.failed

The bulkstat code has several different ways of detecting the end of
an AG when doing a walk. They are not consistently detected, and the
code that checks for the end of AG conditions is not consistently
coded. Hence the are conditions where the walk code can get stuck in
an endless loop making no progress and not triggering any
termination conditions.

Convert all the "tmp/i" status return codes from btree operations
to a common name (stat) and apply end-of-ag detection to these
operations consistently.

cc: <stable@vger.kernel.org> # 3.17
	Signed-off-by: Dave Chinner <dchinner@redhat.com>
	Reviewed-by: Brian Foster <bfoster@redhat.com>
	Signed-off-by: Dave Chinner <david@fromorbit.com>
(cherry picked from commit afa947cb52a8e73fe71915a0b0af6fcf98dfbe1a)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	fs/xfs/xfs_itable.c
diff --cc fs/xfs/xfs_itable.c
index 00889cf40587,16737cbbee17..000000000000
--- a/fs/xfs/xfs_itable.c
+++ b/fs/xfs/xfs_itable.c
@@@ -300,7 -369,7 +298,11 @@@ xfs_bulkstat
  	int			ubleft;	/* bytes left in user's buffer */
  	char			__user *ubufp;	/* pointer into user's buffer */
  	int			ubelem;	/* spaces used in user's buffer */
++<<<<<<< HEAD
 +	int			ubused;	/* bytes used by formatter */
++=======
+ 	int			stat;
++>>>>>>> afa947cb52a8 (xfs: bulkstat btree walk doesn't terminate)
  
  	/*
  	 * Get the last inode value, see if there's nothing to do.
* Unmerged path fs/xfs/xfs_itable.c
