irq_work: Introduce arch_irq_work_has_interrupt()

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-327.el7
commit-author Peter Zijlstra <peterz@infradead.org>
commit c5c38ef3d70377dc504a6a3f611a3ec814bc757b
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-327.el7/c5c38ef3.failed

The nohz full code needs irq work to trigger its own interrupt so that
the subsystem can work even when the tick is stopped.

Lets introduce arch_irq_work_has_interrupt() that archs can override to
tell about their support for this ability.

	Signed-off-by: Peter Zijlstra <peterz@infradead.org>
	Cc: Ingo Molnar <mingo@kernel.org>
	Cc: Paul E. McKenney <paulmck@linux.vnet.ibm.com>
	Cc: Peter Zijlstra <peterz@infradead.org>
	Cc: Thomas Gleixner <tglx@linutronix.de>
	Signed-off-by: Frederic Weisbecker <fweisbec@gmail.com>
(cherry picked from commit c5c38ef3d70377dc504a6a3f611a3ec814bc757b)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/alpha/include/asm/Kbuild
#	arch/arm64/include/asm/Kbuild
#	arch/avr32/include/asm/Kbuild
#	arch/cris/include/asm/Kbuild
#	arch/frv/include/asm/Kbuild
#	arch/ia64/include/asm/Kbuild
#	arch/m32r/include/asm/Kbuild
#	arch/microblaze/include/asm/Kbuild
#	arch/mips/include/asm/Kbuild
#	arch/mn10300/include/asm/Kbuild
#	arch/parisc/include/asm/Kbuild
#	arch/powerpc/include/asm/Kbuild
#	arch/s390/include/asm/Kbuild
#	arch/score/include/asm/Kbuild
#	arch/sparc/include/asm/Kbuild
#	arch/tile/include/asm/Kbuild
#	arch/um/include/asm/Kbuild
#	arch/x86/include/asm/Kbuild
diff --cc arch/alpha/include/asm/Kbuild
index 7fda94c98345,a52cbf178c3a..000000000000
--- a/arch/alpha/include/asm/Kbuild
+++ b/arch/alpha/include/asm/Kbuild
@@@ -1,6 -1,11 +1,14 @@@
  
 -
  generic-y += clkdev.h
 -generic-y += cputime.h
 +
  generic-y += exec.h
++<<<<<<< HEAD
++=======
+ generic-y += hash.h
+ generic-y += irq_work.h
+ generic-y += mcs_spinlock.h
+ generic-y += preempt.h
+ generic-y += scatterlist.h
++>>>>>>> c5c38ef3d703 (irq_work: Introduce arch_irq_work_has_interrupt())
  generic-y += trace_clock.h
 +generic-y += hash.h
diff --cc arch/arm64/include/asm/Kbuild
index 30d14b0af23d,d617789b1ebd..000000000000
--- a/arch/arm64/include/asm/Kbuild
+++ b/arch/arm64/include/asm/Kbuild
@@@ -9,6 -9,7 +9,10 @@@ generic-y += current.
  generic-y += delay.h
  generic-y += div64.h
  generic-y += dma.h
++<<<<<<< HEAD
++=======
+ generic-y += early_ioremap.h
++>>>>>>> c5c38ef3d703 (irq_work: Introduce arch_irq_work_has_interrupt())
  generic-y += emergency-restart.h
  generic-y += errno.h
  generic-y += ftrace.h
diff --cc arch/avr32/include/asm/Kbuild
index e51ee334b1b1,2a71b1cb9848..000000000000
--- a/arch/avr32/include/asm/Kbuild
+++ b/arch/avr32/include/asm/Kbuild
@@@ -1,6 -1,24 +1,32 @@@
  
++<<<<<<< HEAD
 +generic-y	+= clkdev.h
 +generic-y	+= exec.h
 +generic-y	+= trace_clock.h
 +generic-y	+= param.h
 +generic-y	+= hash.h
++=======
+ generic-y += clkdev.h
+ generic-y += cputime.h
+ generic-y += delay.h
+ generic-y += device.h
+ generic-y += div64.h
+ generic-y += emergency-restart.h
+ generic-y += exec.h
+ generic-y += futex.h
+ generic-y += hash.h
+ generic-y += irq_regs.h
+ generic-y += irq_work.h
+ generic-y += local.h
+ generic-y += local64.h
+ generic-y += mcs_spinlock.h
+ generic-y += param.h
+ generic-y += percpu.h
+ generic-y += preempt.h
+ generic-y += scatterlist.h
+ generic-y += sections.h
+ generic-y += topology.h
+ generic-y += trace_clock.h
+ generic-y += vga.h
+ generic-y += xor.h
++>>>>>>> c5c38ef3d703 (irq_work: Introduce arch_irq_work_has_interrupt())
diff --cc arch/cris/include/asm/Kbuild
index 8541589b8cb9,802b94c4ca86..000000000000
--- a/arch/cris/include/asm/Kbuild
+++ b/arch/cris/include/asm/Kbuild
@@@ -3,8 -3,18 +3,16 @@@ header-y += arch-v10
  header-y += arch-v32/
  
  
 -generic-y += barrier.h
  generic-y += clkdev.h
 -generic-y += cputime.h
  generic-y += exec.h
++<<<<<<< HEAD
++=======
+ generic-y += hash.h
+ generic-y += irq_work.h
+ generic-y += kvm_para.h
+ generic-y += linkage.h
+ generic-y += mcs_spinlock.h
++>>>>>>> c5c38ef3d703 (irq_work: Introduce arch_irq_work_has_interrupt())
  generic-y += module.h
 -generic-y += preempt.h
 -generic-y += scatterlist.h
  generic-y += trace_clock.h
 -generic-y += vga.h
 -generic-y += xor.h
 +generic-y += hash.h
diff --cc arch/frv/include/asm/Kbuild
index a76bafc39fac,3caf05cabfc5..000000000000
--- a/arch/frv/include/asm/Kbuild
+++ b/arch/frv/include/asm/Kbuild
@@@ -1,5 -1,10 +1,13 @@@
  
  generic-y += clkdev.h
 -generic-y += cputime.h
  generic-y += exec.h
++<<<<<<< HEAD
++=======
+ generic-y += hash.h
+ generic-y += irq_work.h
+ generic-y += mcs_spinlock.h
+ generic-y += preempt.h
+ generic-y += scatterlist.h
++>>>>>>> c5c38ef3d703 (irq_work: Introduce arch_irq_work_has_interrupt())
  generic-y += trace_clock.h
 +generic-y += hash.h
diff --cc arch/ia64/include/asm/Kbuild
index c6d81f469ba4,747320be9d0e..000000000000
--- a/arch/ia64/include/asm/Kbuild
+++ b/arch/ia64/include/asm/Kbuild
@@@ -1,6 -1,11 +1,11 @@@
  
  generic-y += clkdev.h
  generic-y += exec.h
++<<<<<<< HEAD
++=======
+ generic-y += hash.h
+ generic-y += irq_work.h
++>>>>>>> c5c38ef3d703 (irq_work: Introduce arch_irq_work_has_interrupt())
  generic-y += kvm_para.h
 -generic-y += mcs_spinlock.h
 -generic-y += preempt.h
 -generic-y += scatterlist.h
  generic-y += trace_clock.h
 -generic-y += vtime.h
 +generic-y += hash.h
diff --cc arch/m32r/include/asm/Kbuild
index b55ed90103d4,e02448b0648b..000000000000
--- a/arch/m32r/include/asm/Kbuild
+++ b/arch/m32r/include/asm/Kbuild
@@@ -1,6 -1,11 +1,12 @@@
  
  generic-y += clkdev.h
 -generic-y += cputime.h
  generic-y += exec.h
++<<<<<<< HEAD
++=======
+ generic-y += hash.h
+ generic-y += irq_work.h
+ generic-y += mcs_spinlock.h
++>>>>>>> c5c38ef3d703 (irq_work: Introduce arch_irq_work_has_interrupt())
  generic-y += module.h
 -generic-y += preempt.h
 -generic-y += scatterlist.h
  generic-y += trace_clock.h
 +generic-y += hash.h
diff --cc arch/microblaze/include/asm/Kbuild
index 26448b429a1e,448143b8cabd..000000000000
--- a/arch/microblaze/include/asm/Kbuild
+++ b/arch/microblaze/include/asm/Kbuild
@@@ -1,6 -1,13 +1,15 @@@
  
 -generic-y += barrier.h
  generic-y += clkdev.h
 -generic-y += cputime.h
 -generic-y += device.h
  generic-y += exec.h
++<<<<<<< HEAD
++=======
+ generic-y += hash.h
+ generic-y += irq_work.h
+ generic-y += mcs_spinlock.h
+ generic-y += preempt.h
+ generic-y += scatterlist.h
+ generic-y += syscalls.h
++>>>>>>> c5c38ef3d703 (irq_work: Introduce arch_irq_work_has_interrupt())
  generic-y += trace_clock.h
 +generic-y += syscalls.h
 +generic-y += hash.h
diff --cc arch/mips/include/asm/Kbuild
index cea0442fb63e,57012ef1f51e..000000000000
--- a/arch/mips/include/asm/Kbuild
+++ b/arch/mips/include/asm/Kbuild
@@@ -1,3 -1,20 +1,21 @@@
  # MIPS headers
++<<<<<<< HEAD
++=======
+ generic-y += cputime.h
+ generic-y += current.h
+ generic-y += emergency-restart.h
+ generic-y += hash.h
+ generic-y += irq_work.h
+ generic-y += local64.h
+ generic-y += mcs_spinlock.h
+ generic-y += mutex.h
+ generic-y += parport.h
+ generic-y += percpu.h
+ generic-y += preempt.h
+ generic-y += scatterlist.h
+ generic-y += sections.h
+ generic-y += segment.h
+ generic-y += serial.h
++>>>>>>> c5c38ef3d703 (irq_work: Introduce arch_irq_work_has_interrupt())
  generic-y += trace_clock.h
 -generic-y += ucontext.h
 -generic-y += user.h
 -generic-y += xor.h
 +generic-y += hash.h
diff --cc arch/mn10300/include/asm/Kbuild
index a76bafc39fac,77eb1a68d13b..000000000000
--- a/arch/mn10300/include/asm/Kbuild
+++ b/arch/mn10300/include/asm/Kbuild
@@@ -1,5 -1,11 +1,13 @@@
  
 -generic-y += barrier.h
  generic-y += clkdev.h
 -generic-y += cputime.h
  generic-y += exec.h
++<<<<<<< HEAD
++=======
+ generic-y += hash.h
+ generic-y += irq_work.h
+ generic-y += mcs_spinlock.h
+ generic-y += preempt.h
+ generic-y += scatterlist.h
++>>>>>>> c5c38ef3d703 (irq_work: Introduce arch_irq_work_has_interrupt())
  generic-y += trace_clock.h
 +generic-y += hash.h
diff --cc arch/parisc/include/asm/Kbuild
index 123694773c32,ffb024b8423f..000000000000
--- a/arch/parisc/include/asm/Kbuild
+++ b/arch/parisc/include/asm/Kbuild
@@@ -1,7 -1,30 +1,34 @@@
  
++<<<<<<< HEAD
 +generic-y += word-at-a-time.h auxvec.h user.h cputime.h emergency-restart.h \
 +	  segment.h topology.h vga.h device.h percpu.h hw_irq.h mutex.h \
 +	  div64.h irq_regs.h kdebug.h kvm_para.h local64.h local.h param.h \
 +	  poll.h xor.h clkdev.h exec.h
++=======
+ generic-y += auxvec.h
+ generic-y += barrier.h
+ generic-y += clkdev.h
+ generic-y += cputime.h
+ generic-y += device.h
+ generic-y += div64.h
+ generic-y += emergency-restart.h
+ generic-y += exec.h
+ generic-y += hash.h
+ generic-y += hw_irq.h
+ generic-y += irq_regs.h
+ generic-y += irq_work.h
+ generic-y += kdebug.h
+ generic-y += kvm_para.h
+ generic-y += local.h
+ generic-y += local64.h
+ generic-y += mcs_spinlock.h
+ generic-y += mutex.h
+ generic-y += param.h
+ generic-y += percpu.h
+ generic-y += poll.h
+ generic-y += preempt.h
+ generic-y += segment.h
+ generic-y += topology.h
++>>>>>>> c5c38ef3d703 (irq_work: Introduce arch_irq_work_has_interrupt())
  generic-y += trace_clock.h
 -generic-y += user.h
 -generic-y += vga.h
 -generic-y += word-at-a-time.h
 -generic-y += xor.h
 +generic-y += hash.h
diff --cc arch/powerpc/include/asm/Kbuild
index a7c6597f1ee5,31e8f59aff38..000000000000
--- a/arch/powerpc/include/asm/Kbuild
+++ b/arch/powerpc/include/asm/Kbuild
@@@ -1,6 -1,10 +1,13 @@@
  
  generic-y += clkdev.h
++<<<<<<< HEAD
++=======
+ generic-y += hash.h
+ generic-y += irq_work.h
+ generic-y += mcs_spinlock.h
+ generic-y += preempt.h
++>>>>>>> c5c38ef3d703 (irq_work: Introduce arch_irq_work_has_interrupt())
  generic-y += rwsem.h
 -generic-y += scatterlist.h
  generic-y += trace_clock.h
  generic-y += vtime.h
 +generic-y += hash.h
diff --cc arch/s390/include/asm/Kbuild
index d92c4ae7816c,773f86676588..000000000000
--- a/arch/s390/include/asm/Kbuild
+++ b/arch/s390/include/asm/Kbuild
@@@ -1,5 -1,9 +1,13 @@@
  
  
  generic-y += clkdev.h
++<<<<<<< HEAD
++=======
+ generic-y += hash.h
+ generic-y += irq_work.h
+ generic-y += mcs_spinlock.h
+ generic-y += preempt.h
+ generic-y += scatterlist.h
++>>>>>>> c5c38ef3d703 (irq_work: Introduce arch_irq_work_has_interrupt())
  generic-y += trace_clock.h
 +generic-y += hash.h
diff --cc arch/score/include/asm/Kbuild
index c1bb40e7c595,1909d2a5b82f..000000000000
--- a/arch/score/include/asm/Kbuild
+++ b/arch/score/include/asm/Kbuild
@@@ -1,6 -1,14 +1,15 @@@
  
  header-y +=
  
 -
 -generic-y += barrier.h
  generic-y += clkdev.h
++<<<<<<< HEAD
++=======
+ generic-y += cputime.h
+ generic-y += hash.h
+ generic-y += irq_work.h
+ generic-y += mcs_spinlock.h
+ generic-y += preempt.h
+ generic-y += scatterlist.h
++>>>>>>> c5c38ef3d703 (irq_work: Introduce arch_irq_work_has_interrupt())
  generic-y += trace_clock.h
 -generic-y += xor.h
 +generic-y += hash.h
diff --cc arch/sparc/include/asm/Kbuild
index 4fd8c9f6c973,f5f94ce1692c..000000000000
--- a/arch/sparc/include/asm/Kbuild
+++ b/arch/sparc/include/asm/Kbuild
@@@ -6,12 -6,17 +6,18 @@@ generic-y += cputime.
  generic-y += div64.h
  generic-y += emergency-restart.h
  generic-y += exec.h
++<<<<<<< HEAD
++=======
+ generic-y += hash.h
+ generic-y += irq_regs.h
+ generic-y += irq_work.h
++>>>>>>> c5c38ef3d703 (irq_work: Introduce arch_irq_work_has_interrupt())
  generic-y += linkage.h
 -generic-y += local.h
  generic-y += local64.h
 -generic-y += mcs_spinlock.h
 -generic-y += module.h
  generic-y += mutex.h
 -generic-y += preempt.h
 -generic-y += scatterlist.h
 +generic-y += irq_regs.h
 +generic-y += local.h
 +generic-y += module.h
  generic-y += serial.h
  generic-y += trace_clock.h
  generic-y += types.h
diff --cc arch/tile/include/asm/Kbuild
index 21beade3f584,e6462b8a6284..000000000000
--- a/arch/tile/include/asm/Kbuild
+++ b/arch/tile/include/asm/Kbuild
@@@ -15,8 -17,10 +15,12 @@@ generic-y += ioctl.
  generic-y += ioctls.h
  generic-y += ipcbuf.h
  generic-y += irq_regs.h
++<<<<<<< HEAD
 +generic-y += kdebug.h
++=======
+ generic-y += irq_work.h
++>>>>>>> c5c38ef3d703 (irq_work: Introduce arch_irq_work_has_interrupt())
  generic-y += local.h
 -generic-y += local64.h
 -generic-y += mcs_spinlock.h
  generic-y += msgbuf.h
  generic-y += mutex.h
  generic-y += param.h
diff --cc arch/um/include/asm/Kbuild
index b3a361a31487,244b12c8cb39..000000000000
--- a/arch/um/include/asm/Kbuild
+++ b/arch/um/include/asm/Kbuild
@@@ -1,6 -1,30 +1,37 @@@
++<<<<<<< HEAD
 +generic-y += bug.h cputime.h device.h emergency-restart.h futex.h hardirq.h
 +generic-y += hw_irq.h irq_regs.h kdebug.h percpu.h sections.h topology.h xor.h
 +generic-y += ftrace.h pci.h io.h param.h delay.h mutex.h current.h exec.h
 +generic-y += switch_to.h clkdev.h
++=======
+ generic-y += barrier.h
+ generic-y += bug.h
+ generic-y += clkdev.h
+ generic-y += cputime.h
+ generic-y += current.h
+ generic-y += delay.h
+ generic-y += device.h
+ generic-y += emergency-restart.h
+ generic-y += exec.h
+ generic-y += ftrace.h
+ generic-y += futex.h
+ generic-y += hardirq.h
+ generic-y += hash.h
+ generic-y += hw_irq.h
+ generic-y += io.h
+ generic-y += irq_regs.h
+ generic-y += irq_work.h
+ generic-y += kdebug.h
+ generic-y += mcs_spinlock.h
+ generic-y += mutex.h
+ generic-y += param.h
+ generic-y += pci.h
+ generic-y += percpu.h
+ generic-y += preempt.h
+ generic-y += scatterlist.h
+ generic-y += sections.h
+ generic-y += switch_to.h
+ generic-y += topology.h
++>>>>>>> c5c38ef3d703 (irq_work: Introduce arch_irq_work_has_interrupt())
  generic-y += trace_clock.h
 -generic-y += xor.h
 +generic-y += hash.h
diff --cc arch/x86/include/asm/Kbuild
index 7f669853317a,8fa909cc6553..000000000000
--- a/arch/x86/include/asm/Kbuild
+++ b/arch/x86/include/asm/Kbuild
@@@ -5,3 -5,8 +5,11 @@@ genhdr-y += unistd_64.
  genhdr-y += unistd_x32.h
  
  generic-y += clkdev.h
++<<<<<<< HEAD
++=======
+ generic-y += cputime.h
+ generic-y += early_ioremap.h
+ generic-y += irq_work.h
+ generic-y += mcs_spinlock.h
+ generic-y += scatterlist.h
++>>>>>>> c5c38ef3d703 (irq_work: Introduce arch_irq_work_has_interrupt())
* Unmerged path arch/alpha/include/asm/Kbuild
diff --git a/arch/arc/include/asm/Kbuild b/arch/arc/include/asm/Kbuild
index b29d2fc2bd31..ca55378f2845 100644
--- a/arch/arc/include/asm/Kbuild
+++ b/arch/arc/include/asm/Kbuild
@@ -16,6 +16,7 @@ generic-y += ioctl.h
 generic-y += ioctls.h
 generic-y += ipcbuf.h
 generic-y += irq_regs.h
+generic-y += irq_work.h
 generic-y += kmap_types.h
 generic-y += kvm_para.h
 generic-y += local.h
diff --git a/arch/arm/include/asm/Kbuild b/arch/arm/include/asm/Kbuild
index 129e6c4cc1da..d9e150be320b 100644
--- a/arch/arm/include/asm/Kbuild
+++ b/arch/arm/include/asm/Kbuild
@@ -10,6 +10,7 @@ generic-y += exec.h
 generic-y += ioctl.h
 generic-y += ipcbuf.h
 generic-y += irq_regs.h
+generic-y += irq_work.h
 generic-y += kdebug.h
 generic-y += local.h
 generic-y += local64.h
* Unmerged path arch/arm64/include/asm/Kbuild
* Unmerged path arch/avr32/include/asm/Kbuild
diff --git a/arch/blackfin/include/asm/Kbuild b/arch/blackfin/include/asm/Kbuild
index dbc0568b415e..69f67b6de06e 100644
--- a/arch/blackfin/include/asm/Kbuild
+++ b/arch/blackfin/include/asm/Kbuild
@@ -14,6 +14,7 @@ generic-y += hw_irq.h
 generic-y += ioctl.h
 generic-y += ipcbuf.h
 generic-y += irq_regs.h
+generic-y += irq_work.h
 generic-y += kdebug.h
 generic-y += kmap_types.h
 generic-y += kvm_para.h
diff --git a/arch/c6x/include/asm/Kbuild b/arch/c6x/include/asm/Kbuild
index d4b5008c77c2..c80cd8e71e6e 100644
--- a/arch/c6x/include/asm/Kbuild
+++ b/arch/c6x/include/asm/Kbuild
@@ -21,6 +21,7 @@ generic-y += ioctl.h
 generic-y += ioctls.h
 generic-y += ipcbuf.h
 generic-y += irq_regs.h
+generic-y += irq_work.h
 generic-y += kdebug.h
 generic-y += kmap_types.h
 generic-y += local.h
* Unmerged path arch/cris/include/asm/Kbuild
* Unmerged path arch/frv/include/asm/Kbuild
diff --git a/arch/hexagon/include/asm/Kbuild b/arch/hexagon/include/asm/Kbuild
index 487f63fc1b75..20ffec34bc04 100644
--- a/arch/hexagon/include/asm/Kbuild
+++ b/arch/hexagon/include/asm/Kbuild
@@ -21,6 +21,7 @@ generic-y += ioctls.h
 generic-y += iomap.h
 generic-y += ipcbuf.h
 generic-y += irq_regs.h
+generic-y += irq_work.h
 generic-y += kdebug.h
 generic-y += kmap_types.h
 generic-y += local64.h
* Unmerged path arch/ia64/include/asm/Kbuild
* Unmerged path arch/m32r/include/asm/Kbuild
diff --git a/arch/m68k/include/asm/Kbuild b/arch/m68k/include/asm/Kbuild
index d30e51c9a58d..fc2b208be159 100644
--- a/arch/m68k/include/asm/Kbuild
+++ b/arch/m68k/include/asm/Kbuild
@@ -10,6 +10,7 @@ generic-y += hw_irq.h
 generic-y += ioctl.h
 generic-y += ipcbuf.h
 generic-y += irq_regs.h
+generic-y += irq_work.h
 generic-y += kdebug.h
 generic-y += kmap_types.h
 generic-y += kvm_para.h
diff --git a/arch/metag/include/asm/Kbuild b/arch/metag/include/asm/Kbuild
index 4b30e67688ca..b36f56b6c50b 100644
--- a/arch/metag/include/asm/Kbuild
+++ b/arch/metag/include/asm/Kbuild
@@ -18,6 +18,7 @@ generic-y += ioctl.h
 generic-y += ioctls.h
 generic-y += ipcbuf.h
 generic-y += irq_regs.h
+generic-y += irq_work.h
 generic-y += kdebug.h
 generic-y += kmap_types.h
 generic-y += kvm_para.h
* Unmerged path arch/microblaze/include/asm/Kbuild
* Unmerged path arch/mips/include/asm/Kbuild
* Unmerged path arch/mn10300/include/asm/Kbuild
diff --git a/arch/openrisc/include/asm/Kbuild b/arch/openrisc/include/asm/Kbuild
index 1bdda92f4639..84f12033fb8c 100644
--- a/arch/openrisc/include/asm/Kbuild
+++ b/arch/openrisc/include/asm/Kbuild
@@ -30,6 +30,7 @@ generic-y += ioctl.h
 generic-y += ioctls.h
 generic-y += ipcbuf.h
 generic-y += irq_regs.h
+generic-y += irq_work.h
 generic-y += kdebug.h
 generic-y += kmap_types.h
 generic-y += kvm_para.h
* Unmerged path arch/parisc/include/asm/Kbuild
* Unmerged path arch/powerpc/include/asm/Kbuild
* Unmerged path arch/s390/include/asm/Kbuild
* Unmerged path arch/score/include/asm/Kbuild
diff --git a/arch/sh/include/asm/Kbuild b/arch/sh/include/asm/Kbuild
index 91aff61aa137..a5ef0dc636ad 100644
--- a/arch/sh/include/asm/Kbuild
+++ b/arch/sh/include/asm/Kbuild
@@ -11,6 +11,7 @@ generic-y += fcntl.h
 generic-y += ioctl.h
 generic-y += ipcbuf.h
 generic-y += irq_regs.h
+generic-y += irq_work.h
 generic-y += kvm_para.h
 generic-y += local.h
 generic-y += local64.h
* Unmerged path arch/sparc/include/asm/Kbuild
* Unmerged path arch/tile/include/asm/Kbuild
* Unmerged path arch/um/include/asm/Kbuild
diff --git a/arch/unicore32/include/asm/Kbuild b/arch/unicore32/include/asm/Kbuild
index 67bf9b8dea75..25655012d4a1 100644
--- a/arch/unicore32/include/asm/Kbuild
+++ b/arch/unicore32/include/asm/Kbuild
@@ -21,6 +21,7 @@ generic-y += ioctl.h
 generic-y += ioctls.h
 generic-y += ipcbuf.h
 generic-y += irq_regs.h
+generic-y += irq_work.h
 generic-y += kdebug.h
 generic-y += kmap_types.h
 generic-y += local.h
* Unmerged path arch/x86/include/asm/Kbuild
diff --git a/arch/xtensa/include/asm/Kbuild b/arch/xtensa/include/asm/Kbuild
index 774981019ca8..0a6a422901b4 100644
--- a/arch/xtensa/include/asm/Kbuild
+++ b/arch/xtensa/include/asm/Kbuild
@@ -12,6 +12,7 @@ generic-y += futex.h
 generic-y += hardirq.h
 generic-y += ioctl.h
 generic-y += irq_regs.h
+generic-y += irq_work.h
 generic-y += kdebug.h
 generic-y += kmap_types.h
 generic-y += kvm_para.h
diff --git a/include/asm-generic/irq_work.h b/include/asm-generic/irq_work.h
new file mode 100644
index 000000000000..a44f452c6590
--- /dev/null
+++ b/include/asm-generic/irq_work.h
@@ -0,0 +1,10 @@
+#ifndef __ASM_IRQ_WORK_H
+#define __ASM_IRQ_WORK_H
+
+static inline bool arch_irq_work_has_interrupt(void)
+{
+	return false;
+}
+
+#endif /* __ASM_IRQ_WORK_H */
+
diff --git a/include/linux/irq_work.h b/include/linux/irq_work.h
index bf9422c3aefe..6b47b2ede405 100644
--- a/include/linux/irq_work.h
+++ b/include/linux/irq_work.h
@@ -42,6 +42,8 @@ void irq_work_run(void);
 void irq_work_sync(struct irq_work *work);
 
 #ifdef CONFIG_IRQ_WORK
+#include <asm/irq_work.h>
+
 bool irq_work_needs_cpu(void);
 #else
 static inline bool irq_work_needs_cpu(void) { return false; }
