vxlan: advertise link netns in fdb messages

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-327.el7
commit-author Nicolas Dichtel <nicolas.dichtel@6wind.com>
commit 4967082b469320eeba54ffbca632af1962858fb7
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-327.el7/4967082b.failed

Previous commit is based on a wrong assumption, fdb messages are always sent
into the netns where the interface stands (see vxlan_fdb_notify()).

These fdb messages doesn't embed the rtnl attribute IFLA_LINK_NETNSID, thus we
need to add it (useful to interpret NDA_IFINDEX or NDA_DST for example).

Note also that vxlan_nlmsg_size() was not updated.

Fixes: 193523bf9373 ("vxlan: advertise netns of vxlan dev in fdb msg")
	Signed-off-by: Nicolas Dichtel <nicolas.dichtel@6wind.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 4967082b469320eeba54ffbca632af1962858fb7)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/vxlan.c
#	include/uapi/linux/neighbour.h
diff --cc drivers/net/vxlan.c
index 1f7710467383,31bac2a21ce3..000000000000
--- a/drivers/net/vxlan.c
+++ b/drivers/net/vxlan.c
@@@ -344,6 -340,11 +344,14 @@@ static int vxlan_fdb_info(struct sk_buf
  	ndm->ndm_flags = fdb->flags;
  	ndm->ndm_type = RTN_UNICAST;
  
++<<<<<<< HEAD
++=======
+ 	if (!net_eq(dev_net(vxlan->dev), vxlan->net) &&
+ 	    nla_put_s32(skb, NDA_LINK_NETNSID,
+ 			peernet2id(dev_net(vxlan->dev), vxlan->net)))
+ 		goto nla_put_failure;
+ 
++>>>>>>> 4967082b4693 (vxlan: advertise link netns in fdb messages)
  	if (send_eth && nla_put(skb, NDA_LLADDR, ETH_ALEN, &fdb->eth_addr))
  		goto nla_put_failure;
  
diff --cc include/uapi/linux/neighbour.h
index bfe6283064ff,3873a35509aa..000000000000
--- a/include/uapi/linux/neighbour.h
+++ b/include/uapi/linux/neighbour.h
@@@ -25,6 -25,7 +25,10 @@@ enum 
  	NDA_VNI,
  	NDA_IFINDEX,
  	NDA_MASTER,
++<<<<<<< HEAD
++=======
+ 	NDA_LINK_NETNSID,
++>>>>>>> 4967082b4693 (vxlan: advertise link netns in fdb messages)
  	__NDA_MAX
  };
  
* Unmerged path drivers/net/vxlan.c
* Unmerged path include/uapi/linux/neighbour.h
