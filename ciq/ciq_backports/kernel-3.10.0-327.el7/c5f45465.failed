livepatch: kernel: add TAINT_LIVEPATCH

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-327.el7
commit-author Seth Jennings <sjenning@redhat.com>
commit c5f4546593e9911800f0926c1090959b58bc5c93
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-327.el7/c5f45465.failed

This adds a new taint flag to indicate when the kernel or a kernel
module has been live patched.  This will provide a clean indication in
bug reports that live patching was used.

Additionally, if the crash occurs in a live patched function, the live
patch module will appear beside the patched function in the backtrace.

	Signed-off-by: Seth Jennings <sjenning@redhat.com>
	Acked-by: Josh Poimboeuf <jpoimboe@redhat.com>
	Reviewed-by: Miroslav Benes <mbenes@suse.cz>
	Reviewed-by: Petr Mladek <pmladek@suse.cz>
	Reviewed-by: Masami Hiramatsu <masami.hiramatsu.pt@hitachi.com>
	Signed-off-by: Jiri Kosina <jkosina@suse.cz>
(cherry picked from commit c5f4546593e9911800f0926c1090959b58bc5c93)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	Documentation/oops-tracing.txt
#	Documentation/sysctl/kernel.txt
#	include/linux/kernel.h
#	kernel/panic.c
diff --cc Documentation/oops-tracing.txt
index 13032c0140d4,f3ac05cc23e4..000000000000
--- a/Documentation/oops-tracing.txt
+++ b/Documentation/oops-tracing.txt
@@@ -265,6 -265,13 +265,16 @@@ characters, each representing a particu
  
   13: 'O' if an externally-built ("out-of-tree") module has been loaded.
  
++<<<<<<< HEAD
++=======
+  14: 'E' if an unsigned module has been loaded in a kernel supporting
+      module signature.
+ 
+  15: 'L' if a soft lockup has previously occurred on the system.
+ 
+  16: 'K' if the kernel has been live patched.
+ 
++>>>>>>> c5f4546593e9 (livepatch: kernel: add TAINT_LIVEPATCH)
  The primary reason for the 'Tainted: ' string is to tell kernel
  debuggers if this is a clean kernel or if anything unusual has
  occurred.  Tainting is permanent: even if an offending module is
diff --cc Documentation/sysctl/kernel.txt
index bd58bf7cb155,83ab25660fc9..000000000000
--- a/Documentation/sysctl/kernel.txt
+++ b/Documentation/sysctl/kernel.txt
@@@ -770,6 -840,10 +770,13 @@@ can be ORed together
  1024 - A module from drivers/staging was loaded.
  2048 - The system is working around a severe firmware bug.
  4096 - An out-of-tree module has been loaded.
++<<<<<<< HEAD
++=======
+ 8192 - An unsigned module has been loaded in a kernel supporting module
+        signature.
+ 16384 - A soft lockup has previously occurred on the system.
+ 32768 - The kernel has been live patched.
++>>>>>>> c5f4546593e9 (livepatch: kernel: add TAINT_LIVEPATCH)
  
  ==============================================================
  
diff --cc include/linux/kernel.h
index 69701437f09a,d03e3deee091..000000000000
--- a/include/linux/kernel.h
+++ b/include/linux/kernel.h
@@@ -469,29 -469,9 +469,35 @@@ extern enum system_states 
  #define TAINT_CRAP			10
  #define TAINT_FIRMWARE_WORKAROUND	11
  #define TAINT_OOT_MODULE		12
++<<<<<<< HEAD
 +#define TAINT_13			13
 +#define TAINT_14			14
 +#define TAINT_15			15
 +#define TAINT_16			16
 +#define TAINT_17			17
 +#define TAINT_18			18
 +#define TAINT_19			19
 +#define TAINT_20			20
 +#define TAINT_21			21
 +#define TAINT_22			22
 +#define TAINT_23			23
 +#define TAINT_24			24
 +#define TAINT_25			25
 +#define TAINT_26			26
 +#define TAINT_27			27
 +/* Reserving bits for vendor specific uses */
 +#define TAINT_HARDWARE_UNSUPPORTED	28
 +#define TAINT_TECH_PREVIEW		29
 +/* Bits 30 - 31 are reserved for Red Hat use only */
 +#define TAINT_RESERVED30		30
 +#define TAINT_RESERVED31		31
 +
 +
++=======
+ #define TAINT_UNSIGNED_MODULE		13
+ #define TAINT_SOFTLOCKUP		14
+ #define TAINT_LIVEPATCH			15
++>>>>>>> c5f4546593e9 (livepatch: kernel: add TAINT_LIVEPATCH)
  
  extern const char hex_asc[];
  #define hex_asc_lo(x)	hex_asc[((x) & 0x0f)]
diff --cc kernel/panic.c
index 503284be73c3,8136ad76e5fd..000000000000
--- a/kernel/panic.c
+++ b/kernel/panic.c
@@@ -207,23 -224,9 +207,29 @@@ static const struct tnt tnts[] = 
  	{ TAINT_CRAP,			'C', ' ' },
  	{ TAINT_FIRMWARE_WORKAROUND,	'I', ' ' },
  	{ TAINT_OOT_MODULE,		'O', ' ' },
++<<<<<<< HEAD
 +	{ TAINT_14,			'?', '-' },
 +	{ TAINT_15,			'?', '-' },
 +	{ TAINT_16,			'?', '-' },
 +	{ TAINT_17,			'?', '-' },
 +	{ TAINT_18,			'?', '-' },
 +	{ TAINT_19,			'?', '-' },
 +	{ TAINT_20,			'?', '-' },
 +	{ TAINT_21,			'?', '-' },
 +	{ TAINT_22,			'?', '-' },
 +	{ TAINT_23,			'?', '-' },
 +	{ TAINT_24,			'?', '-' },
 +	{ TAINT_25,			'?', '-' },
 +	{ TAINT_26,			'?', '-' },
 +	{ TAINT_27,			'?', '-' },
 +	{ TAINT_HARDWARE_UNSUPPORTED,	'H', ' ' },
 +	{ TAINT_TECH_PREVIEW,		'T', ' ' },
 +
++=======
+ 	{ TAINT_UNSIGNED_MODULE,	'E', ' ' },
+ 	{ TAINT_SOFTLOCKUP,		'L', ' ' },
+ 	{ TAINT_LIVEPATCH,		'K', ' ' },
++>>>>>>> c5f4546593e9 (livepatch: kernel: add TAINT_LIVEPATCH)
  };
  
  /**
@@@ -242,6 -245,9 +248,12 @@@
   *  'C' - modules from drivers/staging are loaded.
   *  'I' - Working around severe firmware bug.
   *  'O' - Out-of-tree module has been loaded.
++<<<<<<< HEAD
++=======
+  *  'E' - Unsigned module has been loaded.
+  *  'L' - A soft lockup has previously occurred.
+  *  'K' - Kernel has been live patched.
++>>>>>>> c5f4546593e9 (livepatch: kernel: add TAINT_LIVEPATCH)
   *
   *	The string is overwritten by the next call to print_tainted().
   */
* Unmerged path Documentation/oops-tracing.txt
* Unmerged path Documentation/sysctl/kernel.txt
* Unmerged path include/linux/kernel.h
* Unmerged path kernel/panic.c
