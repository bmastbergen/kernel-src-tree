crypto: 842 - change 842 alg to use software

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-327.el7
Rebuild_CHGLOG: - [crypto] 842 - change 842 alg to use software (Gustavo Duarte) [1221925]
Rebuild_FUZZ: 90.00%
commit-author Dan Streetman <ddstreet@ieee.org>
commit 2062c5b6da758ca2bb64b698d7f9c5c45a06fcf9
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-327.el7/2062c5b6.failed

Change the crypto 842 compression alg to use the software 842 compression
and decompression library.  Add the crypto driver_name as "842-generic".
Remove the fallback to LZO compression.

Previously, this crypto compression alg attemped 842 compression using
PowerPC hardware, and fell back to LZO compression and decompression if
the 842 PowerPC hardware was unavailable or failed.  This should not
fall back to any other compression method, however; users of this crypto
compression alg can fallback if desired, and transparent fallback tricks
callers into thinking they are getting 842 compression when they actually
get LZO compression - the failure of the 842 hardware should not be
transparent to the caller.

The crypto compression alg for a hardware device also should not be located
in crypto/ so this is now a software-only implementation that uses the 842
software compression/decompression library.

	Signed-off-by: Dan Streetman <ddstreet@ieee.org>
	Signed-off-by: Herbert Xu <herbert@gondor.apana.org.au>
(cherry picked from commit 2062c5b6da758ca2bb64b698d7f9c5c45a06fcf9)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	crypto/842.c
diff --cc crypto/842.c
index 65c7a89cfa09,98e387efb8c8..000000000000
--- a/crypto/842.c
+++ b/crypto/842.c
@@@ -174,9 -74,10 +74,14 @@@ static void __exit crypto842_mod_exit(v
  {
  	crypto_unregister_alg(&alg);
  }
- 
- module_init(nx842_mod_init);
- module_exit(nx842_mod_exit);
+ module_exit(crypto842_mod_exit);
  
  MODULE_LICENSE("GPL");
++<<<<<<< HEAD
 +MODULE_DESCRIPTION("842 Compression Algorithm");
++=======
+ MODULE_DESCRIPTION("842 Software Compression Algorithm");
+ MODULE_ALIAS_CRYPTO("842");
+ MODULE_ALIAS_CRYPTO("842-generic");
+ MODULE_AUTHOR("Dan Streetman <ddstreet@ieee.org>");
++>>>>>>> 2062c5b6da75 (crypto: 842 - change 842 alg to use software)
diff --git a/MAINTAINERS b/MAINTAINERS
index 858c0c752599..dbf7366d8213 100644
--- a/MAINTAINERS
+++ b/MAINTAINERS
@@ -4043,6 +4043,7 @@ S:	Supported
 F:	drivers/crypto/nx/nx-842.c
 F:	include/linux/nx842.h
 F:	include/linux/sw842.h
+F:	crypto/842.c
 F:	lib/842/
 
 IBM Power Linux RAID adapter
* Unmerged path crypto/842.c
diff --git a/crypto/Kconfig b/crypto/Kconfig
index 99949704c0f0..5a629d54985f 100644
--- a/crypto/Kconfig
+++ b/crypto/Kconfig
@@ -1404,10 +1404,9 @@ config CRYPTO_LZO
 
 config CRYPTO_842
 	tristate "842 compression algorithm"
-	depends on CRYPTO_DEV_NX_COMPRESS
-	# 842 uses lzo if the hardware becomes unavailable
-	select LZO_COMPRESS
-	select LZO_DECOMPRESS
+	select CRYPTO_ALGAPI
+	select 842_COMPRESS
+	select 842_DECOMPRESS
 	help
 	  This is the 842 algorithm.
 
