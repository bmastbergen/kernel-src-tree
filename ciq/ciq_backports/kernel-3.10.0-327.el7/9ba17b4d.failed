ALSA: hda - Implement uncached version of parameter reads

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-327.el7
Rebuild_CHGLOG: - [alsa] hda - Implement uncached version of parameter reads (Jaroslav Kysela) [1197064]
Rebuild_FUZZ: 94.44%
commit-author Takashi Iwai <tiwai@suse.de>
commit 9ba17b4d132f56a680fa1ba0bc2a8f98b6263d93
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-327.el7/9ba17b4d.failed

Sometimes we need the uncached reads, e.g. for refreshing the tree.
This patch provides the helper function for that and uses it for
refreshing widgets, reading subtrees and the whole proc reads.

	Signed-off-by: Takashi Iwai <tiwai@suse.de>
(cherry picked from commit 9ba17b4d132f56a680fa1ba0bc2a8f98b6263d93)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	include/sound/hdaudio.h
#	sound/hda/hdac_device.c
#	sound/pci/hda/hda_codec.c
#	sound/pci/hda/hda_proc.c
diff --cc sound/pci/hda/hda_codec.c
index 05cb5f57659a,39b5660653f0..000000000000
--- a/sound/pci/hda/hda_codec.c
+++ b/sound/pci/hda/hda_codec.c
@@@ -843,15 -581,13 +843,22 @@@ static int read_widget_caps(struct hda_
  	int i;
  	hda_nid_t nid;
  
 -	codec->wcaps = kmalloc(codec->core.num_nodes * 4, GFP_KERNEL);
 +	codec->num_nodes = snd_hda_get_sub_nodes(codec, fg_node,
 +						 &codec->start_nid);
 +	codec->wcaps = kmalloc(codec->num_nodes * 4, GFP_KERNEL);
  	if (!codec->wcaps)
  		return -ENOMEM;
++<<<<<<< HEAD
 +	nid = codec->start_nid;
 +	for (i = 0; i < codec->num_nodes; i++, nid++)
 +		codec->wcaps[i] = snd_hda_param_read(codec, nid,
 +						     AC_PAR_AUDIO_WIDGET_CAP);
++=======
+ 	nid = codec->core.start_nid;
+ 	for (i = 0; i < codec->core.num_nodes; i++, nid++)
+ 		codec->wcaps[i] = snd_hdac_read_parm_uncached(&codec->core,
+ 					nid, AC_PAR_AUDIO_WIDGET_CAP);
++>>>>>>> 9ba17b4d132f (ALSA: hda - Implement uncached version of parameter reads)
  	return 0;
  }
  
diff --cc sound/pci/hda/hda_proc.c
index dacfe74a2a1f,ee6230767c64..000000000000
--- a/sound/pci/hda/hda_proc.c
+++ b/sound/pci/hda/hda_proc.c
@@@ -597,7 -598,7 +598,11 @@@ static void print_gpio(struct snd_info_
  		       struct hda_codec *codec, hda_nid_t nid)
  {
  	unsigned int gpio =
++<<<<<<< HEAD
 +		snd_hda_param_read(codec, codec->afg, AC_PAR_GPIO_CAP);
++=======
+ 		param_read(codec, codec->core.afg, AC_PAR_GPIO_CAP);
++>>>>>>> 9ba17b4d132f (ALSA: hda - Implement uncached version of parameter reads)
  	unsigned int enable, direction, wake, unsol, sticky, data;
  	int i, max;
  	snd_iprintf(buffer, "GPIO: io=%d, o=%d, i=%d, "
* Unmerged path include/sound/hdaudio.h
* Unmerged path sound/hda/hdac_device.c
* Unmerged path include/sound/hdaudio.h
* Unmerged path sound/hda/hdac_device.c
* Unmerged path sound/pci/hda/hda_codec.c
* Unmerged path sound/pci/hda/hda_proc.c
