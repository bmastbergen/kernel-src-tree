Revert "dm: only run the queue on completion if congested or no requests pending"

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-327.el7
commit-author Mike Snitzer <snitzer@redhat.com>
commit 621739b00e16ca2d80411dc9b111cb15b91f3ba9
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-327.el7/621739b0.failed

This reverts commit 9a0e609e3fd8a95c96629b9fbde6b8c5b9a1456a.
(Resolved a conflict during revert due to commit bfebd1cdb4 that came
after)

This revert is motivated by a couple failure reports on request-based DM
multipath testbeds:
1) Netapp reported that their multipath fault injection test under heavy
   IO load can stall longer than 300 seconds.
2) IBM reported elevated lock contention in their testbed (likely due to
   increased back pressure due to IO not being dispatched as quickly):
   https://www.redhat.com/archives/dm-devel/2015-July/msg00057.html

	Signed-off-by: Mike Snitzer <snitzer@redhat.com>
	Cc: stable@vger.kernel.org # 4.1+
(cherry picked from commit 621739b00e16ca2d80411dc9b111cb15b91f3ba9)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/md/dm.c
diff --cc drivers/md/dm.c
index f0d4f8bb8d41,de703778d39f..000000000000
--- a/drivers/md/dm.c
+++ b/drivers/md/dm.c
@@@ -1051,8 -1080,9 +1048,14 @@@ static void rq_completed(struct mapped_
  	 * queue lock again.
  	 */
  	if (run_queue) {
++<<<<<<< HEAD
 +		if (!nr_requests_pending ||
 +		    (nr_requests_pending >= md->queue->nr_congestion_on))
++=======
+ 		if (md->queue->mq_ops)
+ 			blk_mq_run_hw_queues(md->queue, true);
+ 		else
++>>>>>>> 621739b00e16 (Revert "dm: only run the queue on completion if congested or no requests pending")
  			blk_run_queue_async(md->queue);
  	}
  
* Unmerged path drivers/md/dm.c
