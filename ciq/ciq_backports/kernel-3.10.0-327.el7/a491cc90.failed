x86, mpparse: Simplify arch/x86/include/asm/mpspec.h

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-327.el7
Rebuild_CHGLOG: - [x86] mpparse: Simplify arch/x86/include/asm/mpspec.h (Steve Best) [1231358]
Rebuild_FUZZ: 94.95%
commit-author Jiang Liu <jiang.liu@linux.intel.com>
commit a491cc902ca495365e9cd45154b60d8c702d86da
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-327.el7/a491cc90.failed

Simplify arch/x86/include/asm/mpspec.h by
1) Change max_physical_apicid to static as it's only used in apic.c.
2) Kill declaration of mpc_default_type, it's never defined.
3) Delete default_acpi_madt_oem_check(), it has already been declared
   in apic.h.
4) Make default_acpi_madt_oem_check() depends on CONFIG_X86_LOCAL_APIC
   instead of CONFIG_X86_64 to support i386.
5) Change mp_override_legacy_irq(), mp_config_acpi_legacy_irqs() and
   mp_register_gsi() as static because they are only used in acpi/boot.c.

	Signed-off-by: Jiang Liu <jiang.liu@linux.intel.com>
	Acked-by: David Rientjes <rientjes@google.com>
	Cc: Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>
	Cc: Tony Luck <tony.luck@intel.com>
	Cc: Joerg Roedel <joro@8bytes.org>
	Cc: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
	Cc: H. Peter Anvin <hpa@linux.intel.com>
	Cc: Benjamin Herrenschmidt <benh@kernel.crashing.org>
	Cc: Grant Likely <grant.likely@linaro.org>
	Cc: Rafael J. Wysocki <rjw@rjwysocki.net>
	Cc: Bjorn Helgaas <bhelgaas@google.com>
	Cc: Randy Dunlap <rdunlap@infradead.org>
	Cc: Yinghai Lu <yinghai@kernel.org>
	Cc: Len Brown <len.brown@intel.com>
	Cc: Pavel Machek <pavel@ucw.cz>
	Cc: Seiji Aguchi <seiji.aguchi@hds.com>
	Cc: HATAYAMA Daisuke <d.hatayama@jp.fujitsu.com>
	Cc: Paul Gortmaker <paul.gortmaker@windriver.com>
	Cc: Richard Weinberger <richard@nod.at>
	Cc: Andi Kleen <ak@linux.intel.com>
Link: http://lkml.kernel.org/r/1402302011-23642-4-git-send-email-jiang.liu@linux.intel.com
	Signed-off-by: Thomas Gleixner <tglx@linutronix.de>
(cherry picked from commit a491cc902ca495365e9cd45154b60d8c702d86da)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/x86/include/asm/mpspec.h
#	arch/x86/kernel/acpi/boot.c
diff --cc arch/x86/include/asm/mpspec.h
index 4723d6ceec80,7bef40a01a1d..000000000000
--- a/arch/x86/include/asm/mpspec.h
+++ b/arch/x86/include/asm/mpspec.h
@@@ -93,16 -85,7 +91,20 @@@ static inline void early_reserve_e820_m
  #define default_get_smp_config x86_init_uint_noop
  #endif
  
++<<<<<<< HEAD
 +void generic_processor_info(int apicid, int version);
 +#ifdef CONFIG_ACPI
 +extern void mp_register_ioapic(int id, u32 address, u32 gsi_base);
 +extern void mp_override_legacy_irq(u8 bus_irq, u8 polarity, u8 trigger,
 +				   u32 gsi);
 +extern void mp_config_acpi_legacy_irqs(void);
 +struct device;
 +extern int mp_register_gsi(struct device *dev, u32 gsi, int edge_level,
 +				 int active_high_low);
 +#endif /* CONFIG_ACPI */
++=======
+ int generic_processor_info(int apicid, int version);
++>>>>>>> a491cc902ca4 (x86, mpparse: Simplify arch/x86/include/asm/mpspec.h)
  
  #define PHYSID_ARRAY_SIZE	BITS_TO_LONGS(MAX_LOCAL_APIC)
  
diff --cc arch/x86/kernel/acpi/boot.c
index 45a51de24266,b41b47021f53..000000000000
--- a/arch/x86/kernel/acpi/boot.c
+++ b/arch/x86/kernel/acpi/boot.c
@@@ -965,11 -907,8 +969,16 @@@ static int __init acpi_parse_madt_lapic
  #ifdef	CONFIG_X86_IO_APIC
  #define MP_ISA_BUS		0
  
++<<<<<<< HEAD
 +#ifdef CONFIG_X86_ES7000
 +extern int es7000_plat;
 +#endif
 +
 +void __init mp_override_legacy_irq(u8 bus_irq, u8 polarity, u8 trigger, u32 gsi)
++=======
+ static void __init mp_override_legacy_irq(u8 bus_irq, u8 polarity, u8 trigger,
+ 					  u32 gsi)
++>>>>>>> a491cc902ca4 (x86, mpparse: Simplify arch/x86/include/asm/mpspec.h)
  {
  	int ioapic;
  	int pin;
diff --git a/arch/x86/include/asm/apic.h b/arch/x86/include/asm/apic.h
index 1d2091a226bc..66ae3547605b 100644
--- a/arch/x86/include/asm/apic.h
+++ b/arch/x86/include/asm/apic.h
@@ -507,8 +507,6 @@ static inline unsigned default_get_apic_id(unsigned long x)
 #define DEFAULT_TRAMPOLINE_PHYS_HIGH		0x469
 
 #ifdef CONFIG_X86_64
-extern int default_acpi_madt_oem_check(char *, char *);
-
 extern void apic_send_IPI_self(int vector);
 
 DECLARE_PER_CPU(int, x2apic_extra_bits);
@@ -564,6 +562,8 @@ static inline int default_apic_id_valid(int apicid)
 	return (apicid < 255);
 }
 
+extern int default_acpi_madt_oem_check(char *, char *);
+
 extern void default_setup_apic_routing(void);
 
 extern struct apic apic_noop;
diff --git a/arch/x86/include/asm/io_apic.h b/arch/x86/include/asm/io_apic.h
index 459e50a424d1..677e599c275e 100644
--- a/arch/x86/include/asm/io_apic.h
+++ b/arch/x86/include/asm/io_apic.h
@@ -118,9 +118,6 @@ extern int mp_irq_entries;
 /* MP IRQ source entries */
 extern struct mpc_intsrc mp_irqs[MAX_IRQ_SOURCES];
 
-/* non-0 if default (table-less) MP configuration */
-extern int mpc_default_type;
-
 /* Older SiS APIC requires we rewrite the index register */
 extern int sis_apic_bug;
 
* Unmerged path arch/x86/include/asm/mpspec.h
* Unmerged path arch/x86/kernel/acpi/boot.c
diff --git a/arch/x86/kernel/apic/apic.c b/arch/x86/kernel/apic/apic.c
index 8adf12d3dcdd..f38ad685dd4e 100644
--- a/arch/x86/kernel/apic/apic.c
+++ b/arch/x86/kernel/apic/apic.c
@@ -67,7 +67,7 @@ EXPORT_SYMBOL_GPL(boot_cpu_physical_apicid);
 /*
  * The highest APIC ID seen during enumeration.
  */
-unsigned int max_physical_apicid;
+static unsigned int max_physical_apicid;
 
 /*
  * Bitmask of physically existing CPUs:
