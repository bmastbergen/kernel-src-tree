xfs: Fix incorrect positive ENOMEM return

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-327.el7
commit-author Joe Perches <joe@perches.com>
commit 5e9383f97e773e9a5385144ef5561f2ac0ee1349
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-327.el7/5e9383f9.failed

added a positive error return value.

This value filters up through the return layers and should be
negative as the other return values are in the same function.

	Signed-off-by: Joe Perches <joe@perches.com>
	Reviewed-by: Dave Chinner <dchinner@redhat.com>
	Signed-off-by: Dave Chinner <david@fromorbit.com>

(cherry picked from commit 5e9383f97e773e9a5385144ef5561f2ac0ee1349)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	fs/xfs/xfs_super.c
diff --cc fs/xfs/xfs_super.c
index 034bb42c48e9,194291381252..000000000000
--- a/fs/xfs/xfs_super.c
+++ b/fs/xfs/xfs_super.c
@@@ -1420,6 -1390,51 +1420,54 @@@ xfs_finish_flags
  	return 0;
  }
  
++<<<<<<< HEAD
++=======
+ static int
+ xfs_init_percpu_counters(
+ 	struct xfs_mount	*mp)
+ {
+ 	int		error;
+ 
+ 	error = percpu_counter_init(&mp->m_icount, 0, GFP_KERNEL);
+ 	if (error)
+ 		return -ENOMEM;
+ 
+ 	error = percpu_counter_init(&mp->m_ifree, 0, GFP_KERNEL);
+ 	if (error)
+ 		goto free_icount;
+ 
+ 	error = percpu_counter_init(&mp->m_fdblocks, 0, GFP_KERNEL);
+ 	if (error)
+ 		goto free_ifree;
+ 
+ 	return 0;
+ 
+ free_ifree:
+ 	percpu_counter_destroy(&mp->m_ifree);
+ free_icount:
+ 	percpu_counter_destroy(&mp->m_icount);
+ 	return -ENOMEM;
+ }
+ 
+ void
+ xfs_reinit_percpu_counters(
+ 	struct xfs_mount	*mp)
+ {
+ 	percpu_counter_set(&mp->m_icount, mp->m_sb.sb_icount);
+ 	percpu_counter_set(&mp->m_ifree, mp->m_sb.sb_ifree);
+ 	percpu_counter_set(&mp->m_fdblocks, mp->m_sb.sb_fdblocks);
+ }
+ 
+ static void
+ xfs_destroy_percpu_counters(
+ 	struct xfs_mount	*mp)
+ {
+ 	percpu_counter_destroy(&mp->m_icount);
+ 	percpu_counter_destroy(&mp->m_ifree);
+ 	percpu_counter_destroy(&mp->m_fdblocks);
+ }
+ 
++>>>>>>> 5e9383f97e77 (xfs: Fix incorrect positive ENOMEM return)
  STATIC int
  xfs_fs_fill_super(
  	struct super_block	*sb,
* Unmerged path fs/xfs/xfs_super.c
