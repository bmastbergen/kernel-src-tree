cxgb4: Use device node in page allocation

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-327.el7
commit-author Hariprasad Shenai <hariprasad@chelsio.com>
commit d52ce9203746254e010dc7f0f3c260d5a5f4b640
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-327.el7/d52ce920.failed

	Signed-off-by: Hariprasad Shenai <hariprasad@chelsio.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit d52ce9203746254e010dc7f0f3c260d5a5f4b640)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/chelsio/cxgb4/sge.c
diff --cc drivers/net/ethernet/chelsio/cxgb4/sge.c
index 20caa4c0687c,6af4bab6059c..000000000000
--- a/drivers/net/ethernet/chelsio/cxgb4/sge.c
+++ b/drivers/net/ethernet/chelsio/cxgb4/sge.c
@@@ -581,8 -592,10 +581,14 @@@ static unsigned int refill_fl(struct ad
  	unsigned int cred = q->avail;
  	__be64 *d = &q->desc[q->pidx];
  	struct rx_sw_desc *sd = &q->sdesc[q->pidx];
+ 	int node;
  
++<<<<<<< HEAD
 +	gfp |= __GFP_NOWARN | __GFP_COLD;
++=======
+ 	gfp |= __GFP_NOWARN;
+ 	node = dev_to_node(adap->pdev_dev);
++>>>>>>> d52ce9203746 (cxgb4: Use device node in page allocation)
  
  	if (s->fl_pg_order == 0)
  		goto alloc_small_pages;
@@@ -591,7 -604,7 +597,11 @@@
  	 * Prefer large buffers
  	 */
  	while (n) {
++<<<<<<< HEAD
 +		pg = alloc_pages(gfp | __GFP_COMP, s->fl_pg_order);
++=======
+ 		pg = alloc_pages_node(node, gfp | __GFP_COMP, s->fl_pg_order);
++>>>>>>> d52ce9203746 (cxgb4: Use device node in page allocation)
  		if (unlikely(!pg)) {
  			q->large_alloc_failed++;
  			break;       /* fall back to single pages */
@@@ -621,7 -634,7 +631,11 @@@
  
  alloc_small_pages:
  	while (n--) {
++<<<<<<< HEAD
 +		pg = __skb_alloc_page(gfp, NULL);
++=======
+ 		pg = alloc_pages_node(node, gfp, 0);
++>>>>>>> d52ce9203746 (cxgb4: Use device node in page allocation)
  		if (unlikely(!pg)) {
  			q->alloc_failed++;
  			break;
* Unmerged path drivers/net/ethernet/chelsio/cxgb4/sge.c
