openvswitch: Fix serialization of non-masked set actions.

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-327.el7
Rebuild_CHGLOG: - [net] openvswitch: Fix serialization of non-masked set actions (Jiri Benc) [1156461 1211348]
Rebuild_FUZZ: 99.12%
commit-author Joe Stringer <joestringer@nicira.com>
commit f4f8e73850589008095b1da3c8c17cf68bd1c62a
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-327.el7/f4f8e738.failed

Set actions consist of a regular OVS_KEY_ATTR_* attribute nested inside
of a OVS_ACTION_ATTR_SET action attribute. When converting masked actions
back to regular set actions, the inner attribute length was not changed,
ie, double the length being serialized. This patch fixes the bug.

Fixes: 83d2b9b ("net: openvswitch: Support masked set actions.")
	Signed-off-by: Joe Stringer <joestringer@nicira.com>
	Acked-by: Jarno Rajahalme <jrajahalme@nicira.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit f4f8e73850589008095b1da3c8c17cf68bd1c62a)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/openvswitch/flow_netlink.c
diff --cc net/openvswitch/flow_netlink.c
index d35e6f9713da,22b18c145c92..000000000000
--- a/net/openvswitch/flow_netlink.c
+++ b/net/openvswitch/flow_netlink.c
@@@ -1856,6 -2249,27 +1856,30 @@@ static int set_action_to_attr(const str
  	return 0;
  }
  
++<<<<<<< HEAD
++=======
+ static int masked_set_action_to_set_action_attr(const struct nlattr *a,
+ 						struct sk_buff *skb)
+ {
+ 	const struct nlattr *ovs_key = nla_data(a);
+ 	struct nlattr *nla;
+ 	size_t key_len = nla_len(ovs_key) / 2;
+ 
+ 	/* Revert the conversion we did from a non-masked set action to
+ 	 * masked set action.
+ 	 */
+ 	nla = nla_nest_start(skb, OVS_ACTION_ATTR_SET);
+ 	if (!nla)
+ 		return -EMSGSIZE;
+ 
+ 	if (nla_put(skb, nla_type(ovs_key), key_len, nla_data(ovs_key)))
+ 		return -EMSGSIZE;
+ 
+ 	nla_nest_end(skb, nla);
+ 	return 0;
+ }
+ 
++>>>>>>> f4f8e7385058 (openvswitch: Fix serialization of non-masked set actions.)
  int ovs_nla_put_actions(const struct nlattr *attr, int len, struct sk_buff *skb)
  {
  	const struct nlattr *a;
* Unmerged path net/openvswitch/flow_netlink.c
