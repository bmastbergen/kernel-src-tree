ALSA: line6: Create sysfs via snd_card_add_dev_attr()

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-327.el7
Rebuild_CHGLOG: - [alsa] line6: Create sysfs via snd_card_add_dev_attr() (Jaroslav Kysela) [1197064]
Rebuild_FUZZ: 94.00%
commit-author Takashi Iwai <tiwai@suse.de>
commit 02fc76f6a7dbc6cdc3613957f5f1ed435eab5959
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-327.el7/02fc76f6.failed

Use the new helper function to create sysfs entries in the card more
gracefully without races.

	Signed-off-by: Takashi Iwai <tiwai@suse.de>
(cherry picked from commit 02fc76f6a7dbc6cdc3613957f5f1ed435eab5959)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/staging/line6/pod.c
diff --cc drivers/staging/line6/pod.c
index 711d2c74641b,69aa3c42d5e8..000000000000
--- a/drivers/staging/line6/pod.c
+++ b/drivers/staging/line6/pod.c
@@@ -268,12 -326,22 +268,24 @@@ static void pod_startup4(struct work_st
  }
  
  /* POD special files: */
 -static DEVICE_ATTR_RO(device_id);
 -static DEVICE_ATTR_RO(firmware_version);
 -static DEVICE_ATTR_RO(serial_number);
 +static DEVICE_ATTR(device_id, S_IRUGO, pod_get_device_id, line6_nop_write);
 +static DEVICE_ATTR(firmware_version, S_IRUGO, pod_get_firmware_version,
 +		   line6_nop_write);
 +static DEVICE_ATTR(serial_number, S_IRUGO, pod_get_serial_number,
 +		   line6_nop_write);
  
+ static struct attribute *pod_dev_attrs[] = {
+ 	&dev_attr_device_id.attr,
+ 	&dev_attr_firmware_version.attr,
+ 	&dev_attr_serial_number.attr,
+ 	NULL
+ };
+ 
+ static const struct attribute_group pod_dev_attr_group = {
+ 	.name = "pod",
+ 	.attrs = pod_dev_attrs,
+ };
+ 
  /* control info callback */
  static int snd_pod_control_monitor_info(struct snd_kcontrol *kcontrol,
  					struct snd_ctl_elem_info *uinfo)
@@@ -323,55 -392,34 +335,66 @@@ static struct snd_kcontrol_new pod_cont
  };
  
  /*
 -	POD device disconnected.
 +	POD destructor.
  */
 -static void line6_pod_disconnect(struct usb_line6 *line6)
 +static void pod_destruct(struct usb_interface *interface)
  {
 -	struct usb_line6_pod *pod = (struct usb_line6_pod *)line6;
 -	struct device *dev = line6->ifcdev;
 +	struct usb_line6_pod *pod = usb_get_intfdata(interface);
 +
++<<<<<<< HEAD:drivers/staging/line6/pod.c
 +	if (pod == NULL)
 +		return;
 +	line6_cleanup_audio(&pod->line6);
  
 +	del_timer(&pod->startup_timer);
++=======
+ 	del_timer_sync(&pod->startup_timer);
++>>>>>>> 02fc76f6a7db (ALSA: line6: Create sysfs via snd_card_add_dev_attr()):sound/usb/line6/pod.c
  	cancel_work_sync(&pod->startup_work);
  }
  
  /*
 -	 Try to init POD device.
++<<<<<<< HEAD:drivers/staging/line6/pod.c
 +	Create sysfs entries.
  */
 -static int pod_init(struct usb_line6 *line6,
 -		    const struct usb_device_id *id)
 +static int pod_create_files2(struct device *dev)
  {
  	int err;
 -	struct usb_line6_pod *pod = (struct usb_line6_pod *) line6;
  
 -	line6->process_message = line6_pod_process_message;
 -	line6->disconnect = line6_pod_disconnect;
 +	CHECK_RETURN(device_create_file(dev, &dev_attr_device_id));
 +	CHECK_RETURN(device_create_file(dev, &dev_attr_firmware_version));
 +	CHECK_RETURN(device_create_file(dev, &dev_attr_serial_number));
 +	return 0;
 +}
 +
 +/*
++=======
++>>>>>>> 02fc76f6a7db (ALSA: line6: Create sysfs via snd_card_add_dev_attr()):sound/usb/line6/pod.c
 +	 Try to init POD device.
 +*/
 +static int pod_try_init(struct usb_interface *interface,
 +			struct usb_line6_pod *pod)
 +{
 +	int err;
 +	struct usb_line6 *line6 = &pod->line6;
  
  	init_timer(&pod->startup_timer);
  	INIT_WORK(&pod->startup_work, pod_startup4);
  
 +	if ((interface == NULL) || (pod == NULL))
 +		return -ENODEV;
 +
  	/* create sysfs entries: */
++<<<<<<< HEAD:drivers/staging/line6/pod.c
 +	err = pod_create_files2(&interface->dev);
 +	if (err < 0)
 +		return err;
 +
 +	/* initialize audio system: */
 +	err = line6_init_audio(line6);
++=======
+ 	err = snd_card_add_dev_attr(line6->card, &pod_dev_attr_group);
++>>>>>>> 02fc76f6a7db (ALSA: line6: Create sysfs via snd_card_add_dev_attr()):sound/usb/line6/pod.c
  	if (err < 0)
  		return err;
  
* Unmerged path drivers/staging/line6/pod.c
