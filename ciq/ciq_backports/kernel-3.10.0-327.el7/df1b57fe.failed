virtio_balloon: add legacy_only flag

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-327.el7
Rebuild_CHGLOG: - [virtio] virtio-balloon: add legacy_only flag (Jason Wang) [1227339]
Rebuild_FUZZ: 97.22%
commit-author Michael S. Tsirkin <mst@redhat.com>
commit df1b57fe59bc5b1486fe142e6ee76c493c52c543
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-327.el7/df1b57fe.failed

We have no plans to support virtio 1.0 in balloon driver.  Add an
explicit flag to mark it legacy only.

This will be used by follow-up patches.

	Signed-off-by: Michael S. Tsirkin <mst@redhat.com>




(cherry picked from commit df1b57fe59bc5b1486fe142e6ee76c493c52c543)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	include/linux/virtio.h
diff --cc include/linux/virtio.h
index 8370524524c1,2bbf62697671..000000000000
--- a/include/linux/virtio.h
+++ b/include/linux/virtio.h
@@@ -124,6 -130,9 +124,12 @@@ void virtio_break_device(struct virtio_
   * @id_table: the ids serviced by this driver.
   * @feature_table: an array of feature numbers supported by this driver.
   * @feature_table_size: number of entries in the feature table array.
++<<<<<<< HEAD
++=======
+  * @feature_table_legacy: same as feature_table but when working in legacy mode.
+  * @feature_table_size_legacy: number of entries in feature table legacy array.
+  * @legacy_only: driver does not support virtio 1.0.
++>>>>>>> df1b57fe59bc (virtio_balloon: add legacy_only flag)
   * @probe: the function to call when a device is found.  Returns 0 or -errno.
   * @remove: the function to call when a device is removed.
   * @config_changed: optional function to call when the device configuration
@@@ -134,6 -143,9 +140,12 @@@ struct virtio_driver 
  	const struct virtio_device_id *id_table;
  	const unsigned int *feature_table;
  	unsigned int feature_table_size;
++<<<<<<< HEAD
++=======
+ 	const unsigned int *feature_table_legacy;
+ 	unsigned int feature_table_size_legacy;
+ 	bool legacy_only;
++>>>>>>> df1b57fe59bc (virtio_balloon: add legacy_only flag)
  	int (*probe)(struct virtio_device *dev);
  	void (*scan)(struct virtio_device *dev);
  	void (*remove)(struct virtio_device *dev);
diff --git a/drivers/virtio/virtio_balloon.c b/drivers/virtio/virtio_balloon.c
index 603ba814bace..28adb6e197ad 100644
--- a/drivers/virtio/virtio_balloon.c
+++ b/drivers/virtio/virtio_balloon.c
@@ -547,6 +547,7 @@ static unsigned int features[] = {
 };
 
 static struct virtio_driver virtio_balloon_driver = {
+	.legacy_only = true,
 	.feature_table = features,
 	.feature_table_size = ARRAY_SIZE(features),
 	.driver.name =	KBUILD_MODNAME,
* Unmerged path include/linux/virtio.h
