arm: Tell irq work about self IPI support

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-327.el7
Rebuild_CHGLOG: - [x86] Tell irq work about self IPI support (Rafael Aquini) [1240799]
Rebuild_FUZZ: 93.51%
commit-author Frederic Weisbecker <fweisbec@gmail.com>
commit 09f6edd424218eb69078551b2ecfada1f2d098eb
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-327.el7/09f6edd4.failed

ARM irq work IPI support depends on SMP support. That information is
partly known at early boottime. Lets implement
arch_irq_work_has_interrupt() accordingly.

	Acked-by: Peter Zijlstra (Intel) <peterz@infradead.org>
	Cc: Ingo Molnar <mingo@kernel.org>
	Cc: Paul E. McKenney <paulmck@linux.vnet.ibm.com>
	Cc: Peter Zijlstra <peterz@infradead.org>
	Cc: Russell King <linux@arm.linux.org.uk>
	Cc: Thomas Gleixner <tglx@linutronix.de>
	Signed-off-by: Frederic Weisbecker <fweisbec@gmail.com>
(cherry picked from commit 09f6edd424218eb69078551b2ecfada1f2d098eb)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/arm/kernel/smp.c
diff --cc arch/arm/kernel/smp.c
index 5919eb451bb9,bbe22fcb78f6..000000000000
--- a/arch/arm/kernel/smp.c
+++ b/arch/arm/kernel/smp.c
@@@ -491,10 -485,28 +491,35 @@@ u64 smp_irq_stat_cpu(unsigned int cpu
  	return sum;
  }
  
++<<<<<<< HEAD
 +/*
 + * Timer (local or broadcast) support
 + */
 +static DEFINE_PER_CPU(struct clock_event_device, percpu_clockevent);
++=======
+ void arch_send_call_function_ipi_mask(const struct cpumask *mask)
+ {
+ 	smp_cross_call(mask, IPI_CALL_FUNC);
+ }
+ 
+ void arch_send_wakeup_ipi_mask(const struct cpumask *mask)
+ {
+ 	smp_cross_call(mask, IPI_WAKEUP);
+ }
+ 
+ void arch_send_call_function_single_ipi(int cpu)
+ {
+ 	smp_cross_call(cpumask_of(cpu), IPI_CALL_FUNC_SINGLE);
+ }
+ 
+ #ifdef CONFIG_IRQ_WORK
+ void arch_irq_work_raise(void)
+ {
+ 	if (arch_irq_work_has_interrupt())
+ 		smp_cross_call(cpumask_of(smp_processor_id()), IPI_IRQ_WORK);
+ }
+ #endif
++>>>>>>> 09f6edd42421 (arm: Tell irq work about self IPI support)
  
  #ifdef CONFIG_GENERIC_CLOCKEVENTS_BROADCAST
  void tick_broadcast(const struct cpumask *mask)
diff --git a/arch/arm/include/asm/irq_work.h b/arch/arm/include/asm/irq_work.h
new file mode 100644
index 000000000000..712d03e5973a
--- /dev/null
+++ b/arch/arm/include/asm/irq_work.h
@@ -0,0 +1,11 @@
+#ifndef __ASM_ARM_IRQ_WORK_H
+#define __ASM_ARM_IRQ_WORK_H
+
+#include <asm/smp_plat.h>
+
+static inline bool arch_irq_work_has_interrupt(void)
+{
+	return is_smp();
+}
+
+#endif /* _ASM_ARM_IRQ_WORK_H */
* Unmerged path arch/arm/kernel/smp.c
