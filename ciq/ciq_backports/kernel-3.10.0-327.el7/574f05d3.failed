hpsa: factor out hpsa_ciss_submit function

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-327.el7
commit-author Stephen Cameron <stephenmcameron@gmail.com>
commit 574f05d37484038caa989d457fa60c1db4e81683
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-327.el7/574f05d3.failed

Factor out the bottom part of the queuecommand function
which is the part that builds commands for submitting down
the "normal' RAID stack path of a Smart Array.

Need to factor this out to improve how commands that
were initially sent down one of the "ioaccellerated"
paths but which have some sort of error condition are
retried down the "normal" path.

	Reviewed-by: Scott Teel <scott.teel@pmcs.com>
	Signed-off-by: Don Brace <don.brace@pmcs.com>
	Signed-off-by: Christoph Hellwig <hch@lst.de>
(cherry picked from commit 574f05d37484038caa989d457fa60c1db4e81683)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/scsi/hpsa.c
diff --cc drivers/scsi/hpsa.c
index 3e784c38914c,cc3128ff5dab..000000000000
--- a/drivers/scsi/hpsa.c
+++ b/drivers/scsi/hpsa.c
@@@ -2041,10 -2032,10 +2041,15 @@@ static int hpsa_scsi_do_inquiry(struct 
  	struct CommandList *c;
  	struct ErrorInfo *ei;
  
 -	c = cmd_alloc(h);
 +	c = cmd_special_alloc(h);
  
++<<<<<<< HEAD
 +	if (c == NULL) {			/* trouble... */
 +		dev_warn(&h->pdev->dev, "cmd_special_alloc returned NULL!\n");
++=======
+ 	if (c == NULL) {
+ 		dev_warn(&h->pdev->dev, "cmd_alloc returned NULL!\n");
++>>>>>>> 574f05d37484 (hpsa: factor out hpsa_ciss_submit function)
  		return -ENOMEM;
  	}
  
* Unmerged path drivers/scsi/hpsa.c
