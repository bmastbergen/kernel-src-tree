net: remove some unless free on failure in alloc_netdev_mqs()

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-327.el7
Rebuild_CHGLOG: - [net] remove some unless free on failure in alloc_netdev_mqs() (Jason Wang) [1231604]
Rebuild_FUZZ: 95.73%
commit-author WANG Cong <xiyou.wangcong@gmail.com>
commit 92ff71b8fe9cd9c673615fc6f3870af7376d7c84
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-327.el7/92ff71b8.failed

When we jump to free_pcpu on failure in alloc_netdev_mqs()
rx and tx queues are not yet allocated, so no need to free them.

	Cc: David S. Miller <davem@davemloft.net>
	Signed-off-by: Cong Wang <xiyou.wangcong@gmail.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 92ff71b8fe9cd9c673615fc6f3870af7376d7c84)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/core/dev.c
diff --cc net/core/dev.c
index c33def8a553a,1ba2cfe3f8e8..000000000000
--- a/net/core/dev.c
+++ b/net/core/dev.c
@@@ -5914,13 -6503,8 +5914,18 @@@ free_all
  
  free_pcpu:
  	free_percpu(dev->pcpu_refcnt);
++<<<<<<< HEAD
 +	netif_free_tx_queues(dev);
 +#ifdef CONFIG_RPS
 +	kfree(dev->_rx);
 +#endif
 +
 +free_p:
 +	kfree(p);
++=======
+ free_dev:
+ 	netdev_freemem(dev);
++>>>>>>> 92ff71b8fe9c (net: remove some unless free on failure in alloc_netdev_mqs())
  	return NULL;
  }
  EXPORT_SYMBOL(alloc_netdev_mqs);
* Unmerged path net/core/dev.c
