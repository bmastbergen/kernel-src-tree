tools/power turbostat: Skip printing disabled package C-states

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-327.el7
Rebuild_CHGLOG: - [tools] turbostat: Skip printing disabled package C-states (Prarit Bhargava) [1187329]
Rebuild_FUZZ: 89.29%
commit-author Len Brown <len.brown@intel.com>
commit ee7e38e3d8805ba6471bddd088fae92ce5ab1ef5
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-327.el7/ee7e38e3.failed

Replaced previously open-coded Package C-state Limit decoding
with table-driven decoding.  In doing so, updated to match January 2015
"Intel(R) 64 and IA-23 Architectures Software Developer's Manual".

In the past, turbostat would print package C-state residency columns
for all package states supported by the model's architecture, even though
a particular SKU may not support them, or they may be disabled by the BIOS.
Now turbostat will skip printing colunns if MSRs indicate that they are not enabled.
eg. many SKUs don't support PC7, and so that column will no longer be printed.

	Signed-off-by: Len Brown <len.brown@intel.com>
(cherry picked from commit ee7e38e3d8805ba6471bddd088fae92ce5ab1ef5)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	tools/power/x86/turbostat/turbostat.c
diff --cc tools/power/x86/turbostat/turbostat.c
index 4941c7e942b5,ba8846b309f7..000000000000
--- a/tools/power/x86/turbostat/turbostat.c
+++ b/tools/power/x86/turbostat/turbostat.c
@@@ -2122,24 -2286,26 +2162,28 @@@ void check_cpuid(
  	has_epb = ecx & (1 << 3);
  
  	if (verbose)
 -		fprintf(stderr, "CPUID(6): %sAPERF, %sDTS, %sPTM, %sEPB\n",
 -			has_aperf ? "" : "No ",
 -			do_dts ? "" : "No ",
 -			do_ptm ? "" : "No ",
 -			has_epb ? "" : "No ");
 +		fprintf(stderr, "CPUID(6): %s%s%s%s\n",
 +			has_aperf ? "APERF" : "No APERF!",
 +			do_dts ? ", DTS" : "",
 +			do_ptm ? ", PTM": "",
 +			has_epb ? ", EPB": "");
 +
 +	if (!has_aperf)
 +		errx(-1, "No APERF");
  
- 	do_nhm_platform_info = do_nhm_cstates = do_smi = has_nhm_msrs(family, model);
+ 	do_nhm_platform_info = do_nhm_cstates = do_smi = probe_nhm_msrs(family, model);
  	do_snb_cstates = has_snb_msrs(family, model);
+ 	do_pc2 = do_snb_cstates && (pkg_cstate_limit >= PCL__2);
+ 	do_pc3 = (pkg_cstate_limit >= PCL__3);
+ 	do_pc6 = (pkg_cstate_limit >= PCL__6);
+ 	do_pc7 = do_snb_cstates && (pkg_cstate_limit >= PCL__7);
  	do_c8_c9_c10 = has_hsw_msrs(family, model);
  	do_slm_cstates = is_slm(family, model);
  	bclk = discover_bclk(family, model);
  
- 	do_nhm_turbo_ratio_limit = has_nhm_turbo_ratio_limit(family, model);
+ 	do_nhm_turbo_ratio_limit = do_nhm_platform_info && has_nhm_turbo_ratio_limit(family, model);
  	do_ivt_turbo_ratio_limit = has_ivt_turbo_ratio_limit(family, model);
  	rapl_probe(family, model);
 -	perf_limit_reasons_probe(family, model);
  
  	return;
  }
@@@ -2506,7 -2675,7 +2550,11 @@@ int main(int argc, char **argv
  	cmdline(argc, argv);
  
  	if (verbose)
++<<<<<<< HEAD
 +		fprintf(stderr, "turbostat v3.8 14-Aug 2014"
++=======
+ 		fprintf(stderr, "turbostat v3.10 9-Feb, 2015"
++>>>>>>> ee7e38e3d880 (tools/power turbostat: Skip printing disabled package C-states)
  			" - Len Brown <lenb@kernel.org>\n");
  
  	turbostat_init();
* Unmerged path tools/power/x86/turbostat/turbostat.c
