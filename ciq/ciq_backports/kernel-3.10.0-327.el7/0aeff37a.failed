ceph: fix setting empty extended attribute

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-327.el7
commit-author Yan, Zheng <zyan@redhat.com>
commit 0aeff37abada9f8c08d2b10481a43d3ae406c823
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-327.el7/0aeff37a.failed

make sure 'value' is not null. otherwise __ceph_setxattr will remove
the extended attribute.

	Signed-off-by: Yan, Zheng <zyan@redhat.com>
	Reviewed-by: Sage Weil <sage@redhat.com>
(cherry picked from commit 0aeff37abada9f8c08d2b10481a43d3ae406c823)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	fs/ceph/xattr.c
diff --cc fs/ceph/xattr.c
index 4f17b39614ac,5a492caf34cb..000000000000
--- a/fs/ceph/xattr.c
+++ b/fs/ceph/xattr.c
@@@ -974,6 -992,21 +974,24 @@@ out
  	return err;
  }
  
++<<<<<<< HEAD
++=======
+ int ceph_setxattr(struct dentry *dentry, const char *name,
+ 		  const void *value, size_t size, int flags)
+ {
+ 	if (ceph_snap(dentry->d_inode) != CEPH_NOSNAP)
+ 		return -EROFS;
+ 
+ 	if (!strncmp(name, XATTR_SYSTEM_PREFIX, XATTR_SYSTEM_PREFIX_LEN))
+ 		return generic_setxattr(dentry, name, value, size, flags);
+ 
+ 	if (size == 0)
+ 		value = "";  /* empty EA, do not remove */
+ 
+ 	return __ceph_setxattr(dentry, name, value, size, flags);
+ }
+ 
++>>>>>>> 0aeff37abada (ceph: fix setting empty extended attribute)
  static int ceph_send_removexattr(struct dentry *dentry, const char *name)
  {
  	struct ceph_fs_client *fsc = ceph_sb_to_client(dentry->d_sb);
* Unmerged path fs/ceph/xattr.c
