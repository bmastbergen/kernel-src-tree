xfrm: Fix NULL pointer dereference on sub policy usage

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-327.el7
commit-author Steffen Klassert <steffen.klassert@secunet.com>
commit 35ea790d7883dd660208f78eae50ebfd6b8bd14a
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-327.el7/35ea790d.failed

xfrm_state_sort() takes the unsorted states from the src array
and stores them into the dst array. We try to get the namespace
from the dst array which is empty at this time, so take the
namespace from the src array instead.

Fixes: 283bc9f35bbbc ("xfrm: Namespacify xfrm state/policy locks")
	Signed-off-by: Steffen Klassert <steffen.klassert@secunet.com>
(cherry picked from commit 35ea790d7883dd660208f78eae50ebfd6b8bd14a)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/xfrm/xfrm_state.c
diff --cc net/xfrm/xfrm_state.c
index 19b6e2fadae2,97d117b80ba4..000000000000
--- a/net/xfrm/xfrm_state.c
+++ b/net/xfrm/xfrm_state.c
@@@ -1440,6 -1451,8 +1440,11 @@@ xfrm_state_sort(struct xfrm_state **dst
  {
  	int err = 0;
  	struct xfrm_state_afinfo *afinfo = xfrm_state_get_afinfo(family);
++<<<<<<< HEAD
++=======
+ 	struct net *net = xs_net(*src);
+ 
++>>>>>>> 35ea790d7883 (xfrm: Fix NULL pointer dereference on sub policy usage)
  	if (!afinfo)
  		return -EAFNOSUPPORT;
  
* Unmerged path net/xfrm/xfrm_state.c
