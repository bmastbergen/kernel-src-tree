Fnic: Fnic Driver crashed with NULL pointer reference

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-327.el7
commit-author Hiral Shah <hishah@cisco.com>
commit 41df7b02db82cf6c14f094757bac3830d10a827f
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-327.el7/41df7b02.failed

When issuing I/O request, if the I/O completes before returning from
fnic_queuecommand(), we may be referencing scsi_cmnd structure that may
be freed by interrupt handler. Acquring IO lock would synchronize
fnic_queuecommand and interrupt handler.

- Increment fnic version from 1.6.0.15 to 1.6.0.16

	Signed-off-by: Hiral Shah <hishah@cisco.com>
	Signed-off-by: Sesidhar Baddela <sebaddel@cisco.com>
	Signed-off-by: Anil Chintalapati <achintal@cisco.com>
	Signed-off-by: Christoph Hellwig <hch@lst.de>
(cherry picked from commit 41df7b02db82cf6c14f094757bac3830d10a827f)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/scsi/fnic/fnic.h
#	drivers/scsi/fnic/fnic_scsi.c
diff --cc drivers/scsi/fnic/fnic.h
index a547c3fee2f5,3b73b96619e2..000000000000
--- a/drivers/scsi/fnic/fnic.h
+++ b/drivers/scsi/fnic/fnic.h
@@@ -39,7 -39,7 +39,11 @@@
  
  #define DRV_NAME		"fnic"
  #define DRV_DESCRIPTION		"Cisco FCoE HBA Driver"
++<<<<<<< HEAD
 +#define DRV_VERSION		"1.5.0.45a"
++=======
+ #define DRV_VERSION		"1.6.0.16"
++>>>>>>> 41df7b02db82 (Fnic: Fnic Driver crashed with NULL pointer reference)
  #define PFX			DRV_NAME ": "
  #define DFX                     DRV_NAME "%d: "
  
diff --cc drivers/scsi/fnic/fnic_scsi.c
index 0521436d05d6,2097de42a147..000000000000
--- a/drivers/scsi/fnic/fnic_scsi.c
+++ b/drivers/scsi/fnic/fnic_scsi.c
@@@ -428,8 -421,10 +428,13 @@@ static int fnic_queuecommand_lck(struc
  	int ret;
  	u64 cmd_trace;
  	int sg_count = 0;
- 	unsigned long flags;
+ 	unsigned long flags = 0;
  	unsigned long ptr;
++<<<<<<< HEAD
++=======
+ 	struct fc_rport_priv *rdata;
+ 	spinlock_t *io_lock = NULL;
++>>>>>>> 41df7b02db82 (Fnic: Fnic Driver crashed with NULL pointer reference)
  
  	if (unlikely(fnic_chk_state_flags_locked(fnic, FNIC_FLAGS_IO_BLOCKED)))
  		return SCSI_MLQUEUE_HOST_BUSY;
* Unmerged path drivers/scsi/fnic/fnic.h
* Unmerged path drivers/scsi/fnic/fnic_scsi.c
