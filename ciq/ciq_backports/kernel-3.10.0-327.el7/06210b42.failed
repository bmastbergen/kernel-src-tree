Drivers: hv: vmbus: remove hv_synic_free_cpu() call from hv_synic_cleanup()

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-327.el7
Rebuild_CHGLOG: - [hv] vmbus: remove hv_synic_free_cpu() call from hv_synic_cleanup() (Vitaly Kuznetsov) [1248352]
Rebuild_FUZZ: 90.51%
commit-author Vitaly Kuznetsov <vkuznets@redhat.com>
commit 06210b42f33ea1c29a90f4db2d88be91c511154b
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-327.el7/06210b42.failed

We already have hv_synic_free() which frees all per-cpu pages for all
CPUs, let's remove the hv_synic_free_cpu() call from hv_synic_cleanup()
so it will be possible to do separate cleanup (writing to MSRs) and final
freeing. This is going to be used to assist kexec.

	Signed-off-by: Vitaly Kuznetsov <vkuznets@redhat.com>
	Signed-off-by: K. Y. Srinivasan <kys@microsoft.com>
	Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
(cherry picked from commit 06210b42f33ea1c29a90f4db2d88be91c511154b)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/hv/hv.c
#	drivers/hv/vmbus_drv.c
diff --cc drivers/hv/hv.c
index d8dedd1fccee,5b870424b502..000000000000
--- a/drivers/hv/hv.c
+++ b/drivers/hv/hv.c
@@@ -421,6 -526,8 +421,13 @@@ void hv_synic_cleanup(void *arg
  
  	wrmsrl(HV_X64_MSR_SIEFP, siefp.as_uint64);
  
++<<<<<<< HEAD
 +	free_page((unsigned long)hv_context.synic_message_page[cpu]);
 +	free_page((unsigned long)hv_context.synic_event_page[cpu]);
++=======
+ 	/* Disable the global synic bit */
+ 	rdmsrl(HV_X64_MSR_SCONTROL, sctrl.as_uint64);
+ 	sctrl.enable = 0;
+ 	wrmsrl(HV_X64_MSR_SCONTROL, sctrl.as_uint64);
++>>>>>>> 06210b42f33e (Drivers: hv: vmbus: remove hv_synic_free_cpu() call from hv_synic_cleanup())
  }
diff --cc drivers/hv/vmbus_drv.c
index ca849c308e2e,00d5158b4ac7..000000000000
--- a/drivers/hv/vmbus_drv.c
+++ b/drivers/hv/vmbus_drv.c
@@@ -840,7 -1116,13 +840,15 @@@ static void __exit vmbus_exit(void
  	}
  	bus_unregister(&hv_bus);
  	hv_cleanup();
++<<<<<<< HEAD
++=======
+ 	for_each_online_cpu(cpu) {
+ 		tasklet_kill(hv_context.event_dpc[cpu]);
+ 		smp_call_function_single(cpu, hv_synic_cleanup, NULL, 1);
+ 	}
+ 	hv_synic_free();
++>>>>>>> 06210b42f33e (Drivers: hv: vmbus: remove hv_synic_free_cpu() call from hv_synic_cleanup())
  	acpi_bus_unregister_driver(&vmbus_acpi_driver);
 -	hv_cpu_hotplug_quirk(false);
  }
  
  
* Unmerged path drivers/hv/hv.c
* Unmerged path drivers/hv/vmbus_drv.c
