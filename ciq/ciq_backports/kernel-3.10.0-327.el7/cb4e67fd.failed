perf build: Add perf.o object building

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-327.el7
Rebuild_CHGLOG: - [perf] build: Add perf.o object building (Jiri Olsa) [1222189]
Rebuild_FUZZ: 92.96%
commit-author Jiri Olsa <jolsa@kernel.org>
commit cb4e67fdee46116d6ec5ad37316cf7ff35ad1d7c
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-327.el7/cb4e67fd.failed

Move the perf object building under build framework to be included in
the perf build object.

	Signed-off-by: Jiri Olsa <jolsa@kernel.org>
	Tested-by: Sukadev Bhattiprolu <sukadev@linux.vnet.ibm.com>
	Tested-by: Will Deacon <will.deacon@arm.com>
	Cc: Alexis Berlemont <alexis.berlemont@gmail.com>
	Cc: Borislav Petkov <bp@alien8.de>
	Cc: Corey Ashford <cjashfor@linux.vnet.ibm.com>
	Cc: David Ahern <dsahern@gmail.com>
	Cc: Frederic Weisbecker <fweisbec@gmail.com>
	Cc: Namhyung Kim <namhyung@kernel.org>
	Cc: Paul Mackerras <paulus@samba.org>
	Cc: Peter Zijlstra <peterz@infradead.org>
	Cc: Stephane Eranian <eranian@google.com>
Link: http://lkml.kernel.org/n/tip-wiiciip2w6ajvj03huqz50xw@git.kernel.org
	Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>
(cherry picked from commit cb4e67fdee46116d6ec5ad37316cf7ff35ad1d7c)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	tools/perf/Build
#	tools/perf/Makefile.perf
diff --cc tools/perf/Build
index 80a944b929da,976e03849f6d..000000000000
--- a/tools/perf/Build
+++ b/tools/perf/Build
@@@ -30,3 -33,11 +32,14 @@@ paths += -DPERF_MAN_PATH="BUILD_STR($(m
  
  CFLAGS_builtin-help.o      += $(paths)
  CFLAGS_builtin-timechart.o += $(paths)
++<<<<<<< HEAD
++=======
+ CFLAGS_perf.o              += -DPERF_HTML_PATH="BUILD_STR($(htmldir_SQ))" -include $(OUTPUT)PERF-VERSION-FILE
+ 
+ libperf-y += util/
+ libperf-y += arch/
+ libperf-y += ui/
+ libperf-y += scripts/
+ 
+ gtk-y += ui/gtk/
++>>>>>>> cb4e67fdee46 (perf build: Add perf.o object building)
diff --cc tools/perf/Makefile.perf
index 9842afffa808,0a669f990b68..000000000000
--- a/tools/perf/Makefile.perf
+++ b/tools/perf/Makefile.perf
@@@ -545,25 -373,20 +545,20 @@@ strip: $(PROGRAMS) $(OUTPUT)per
  
  PERF_IN := $(OUTPUT)perf-in.o
  
 -export srctree OUTPUT RM CC LD AR CFLAGS V BISON FLEX
 +export srctree OUTPUT RM CC LD AR CFLAGS V
  build := -f $(srctree)/tools/build/Makefile.build dir=. obj
  
- $(PERF_IN): $(OUTPUT)common-cmds.h FORCE
+ $(PERF_IN): $(OUTPUT)PERF-VERSION-FILE $(OUTPUT)common-cmds.h FORCE
  	@$(MAKE) $(build)=perf
  
- $(OUTPUT)perf.o: perf.c $(OUTPUT)common-cmds.h $(OUTPUT)PERF-CFLAGS
- 	$(QUIET_CC)$(CC) -include $(OUTPUT)PERF-VERSION-FILE \
- 		'-DPERF_HTML_PATH="$(htmldir_SQ)"' \
- 		$(CFLAGS) -c $(filter %.c,$^) -o $@
- 
- $(OUTPUT)perf: $(OUTPUT)perf.o $(BUILTIN_OBJS) $(PERFLIBS) $(PERF_IN)
- 	$(QUIET_LINK)$(CC) $(CFLAGS) $(LDFLAGS) $(OUTPUT)perf.o \
+ $(OUTPUT)perf: $(BUILTIN_OBJS) $(PERFLIBS) $(PERF_IN)
+ 	$(QUIET_LINK)$(CC) $(CFLAGS) $(LDFLAGS) \
                 $(BUILTIN_OBJS) $(PERF_IN) $(LIBS) -o $@
  
 -$(GTK_IN): FORCE
 -	@$(MAKE) $(build)=gtk
 +$(GTK_OBJS): $(OUTPUT)%.o: %.c $(LIB_H)
 +	$(QUIET_CC)$(CC) -o $@ -c -fPIC $(CFLAGS) $(GTK_CFLAGS) $<
  
 -$(OUTPUT)libperf-gtk.so: $(GTK_IN) $(PERFLIBS)
 +$(OUTPUT)libperf-gtk.so: $(GTK_OBJS) $(PERFLIBS)
  	$(QUIET_LINK)$(CC) -o $@ -shared $(LDFLAGS) $(filter %.o,$^) $(GTK_LIBS)
  
  $(OUTPUT)common-cmds.h: util/generate-cmdlist.sh command-list.txt
@@@ -886,7 -653,7 +880,11 @@@ config-clean
  	@$(MAKE) -C config/feature-checks clean >/dev/null
  
  clean: $(LIBTRACEEVENT)-clean $(LIBAPIKFS)-clean config-clean
++<<<<<<< HEAD
 +	$(call QUIET_CLEAN, core-objs)  $(RM) $(LIB_OBJS) $(BUILTIN_OBJS) $(LIB_FILE) $(OUTPUT)perf-archive $(OUTPUT)perf-with-kcore $(OUTPUT)perf.o $(LANG_BINDINGS) $(GTK_OBJS)
++=======
+ 	$(call QUIET_CLEAN, core-objs)  $(RM) $(LIB_OBJS) $(BUILTIN_OBJS) $(LIB_FILE) $(OUTPUT)perf-archive $(OUTPUT)perf-with-kcore $(LANG_BINDINGS)
++>>>>>>> cb4e67fdee46 (perf build: Add perf.o object building)
  	@find . -name '*.o' -delete -o -name '\.*.cmd' -delete -o -name '\.*.d' -delete
  	@$(RM) .config-detected
  	$(call QUIET_CLEAN, core-progs) $(RM) $(ALL_PROGRAMS) perf perf-read-vdso32 perf-read-vdsox32
* Unmerged path tools/perf/Build
* Unmerged path tools/perf/Makefile.perf
