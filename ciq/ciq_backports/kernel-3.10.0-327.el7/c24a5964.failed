ip_tunnel: Report Rx dropped in ip_tunnel_get_stats64

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-327.el7
commit-author Alexander Duyck <alexander.h.duyck@redhat.com>
commit c24a59649f3c8f4f78adc2d0e31423fa883b012b
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-327.el7/c24a5964.failed

The rx_dropped stat wasn't being reported when ip_tunnel_get_stats64 was
called.  This was leading to some confusing results in my debug as I was
seeing rx_errors increment but no other value which pointed me toward the
type of error being seen.

This change corrects that by using netdev_stats_to_stats64 to copy all
available dev stats instead of just the few that were hand picked.

	Signed-off-by: Alexander Duyck <alexander.h.duyck@redhat.com>
	Signed-off-by: Eric Dumazet <edumazet@google.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit c24a59649f3c8f4f78adc2d0e31423fa883b012b)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/ipv4/ip_tunnel_core.c
diff --cc net/ipv4/ip_tunnel_core.c
index 0782eb93380a,6a51a71a6c67..000000000000
--- a/net/ipv4/ip_tunnel_core.c
+++ b/net/ipv4/ip_tunnel_core.c
@@@ -159,3 -158,35 +159,38 @@@ error
  	return ERR_PTR(err);
  }
  EXPORT_SYMBOL_GPL(iptunnel_handle_offloads);
++<<<<<<< HEAD
++=======
+ 
+ /* Often modified stats are per cpu, other are shared (netdev->stats) */
+ struct rtnl_link_stats64 *ip_tunnel_get_stats64(struct net_device *dev,
+ 						struct rtnl_link_stats64 *tot)
+ {
+ 	int i;
+ 
+ 	netdev_stats_to_stats64(tot, &dev->stats);
+ 
+ 	for_each_possible_cpu(i) {
+ 		const struct pcpu_sw_netstats *tstats =
+ 						   per_cpu_ptr(dev->tstats, i);
+ 		u64 rx_packets, rx_bytes, tx_packets, tx_bytes;
+ 		unsigned int start;
+ 
+ 		do {
+ 			start = u64_stats_fetch_begin_irq(&tstats->syncp);
+ 			rx_packets = tstats->rx_packets;
+ 			tx_packets = tstats->tx_packets;
+ 			rx_bytes = tstats->rx_bytes;
+ 			tx_bytes = tstats->tx_bytes;
+ 		} while (u64_stats_fetch_retry_irq(&tstats->syncp, start));
+ 
+ 		tot->rx_packets += rx_packets;
+ 		tot->tx_packets += tx_packets;
+ 		tot->rx_bytes   += rx_bytes;
+ 		tot->tx_bytes   += tx_bytes;
+ 	}
+ 
+ 	return tot;
+ }
+ EXPORT_SYMBOL_GPL(ip_tunnel_get_stats64);
++>>>>>>> c24a59649f3c (ip_tunnel: Report Rx dropped in ip_tunnel_get_stats64)
* Unmerged path net/ipv4/ip_tunnel_core.c
