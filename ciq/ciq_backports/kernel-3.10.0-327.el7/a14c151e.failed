userfaultfd: buildsystem activation

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-327.el7
commit-author Andrea Arcangeli <aarcange@redhat.com>
commit a14c151e567cb2c3e62611da808a8bdab86fdee5
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-327.el7/a14c151e.failed

This allows to select the userfaultfd during configuration to build it.

	Signed-off-by: Andrea Arcangeli <aarcange@redhat.com>
	Acked-by: Pavel Emelyanov <xemul@parallels.com>
	Cc: Sanidhya Kashyap <sanidhya.gatech@gmail.com>
	Cc: zhang.zhanghailiang@huawei.com
	Cc: "Kirill A. Shutemov" <kirill@shutemov.name>
	Cc: Andres Lagar-Cavilla <andreslc@google.com>
	Cc: Dave Hansen <dave.hansen@intel.com>
	Cc: Paolo Bonzini <pbonzini@redhat.com>
	Cc: Rik van Riel <riel@redhat.com>
	Cc: Mel Gorman <mgorman@suse.de>
	Cc: Andy Lutomirski <luto@amacapital.net>
	Cc: Hugh Dickins <hughd@google.com>
	Cc: Peter Feiner <pfeiner@google.com>
	Cc: "Dr. David Alan Gilbert" <dgilbert@redhat.com>
	Cc: Johannes Weiner <hannes@cmpxchg.org>
	Cc: "Huangpeng (Peter)" <peter.huangpeng@huawei.com>
	Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
	Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
(cherry picked from commit a14c151e567cb2c3e62611da808a8bdab86fdee5)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	init/Kconfig
diff --cc init/Kconfig
index cbaba6dd8f49,161acd8bc56f..000000000000
--- a/init/Kconfig
+++ b/init/Kconfig
@@@ -1419,6 -1566,27 +1419,30 @@@ config AI
  	  by some high performance threaded applications. Disabling
  	  this option saves about 7k.
  
++<<<<<<< HEAD
++=======
+ config ADVISE_SYSCALLS
+ 	bool "Enable madvise/fadvise syscalls" if EXPERT
+ 	default y
+ 	help
+ 	  This option enables the madvise and fadvise syscalls, used by
+ 	  applications to advise the kernel about their future memory or file
+ 	  usage, improving performance. If building an embedded system where no
+ 	  applications use these syscalls, you can disable this option to save
+ 	  space.
+ 
+ config USERFAULTFD
+ 	bool "Enable userfaultfd() system call"
+ 	select ANON_INODES
+ 	default y
+ 	depends on MMU
+ 	help
+ 	  Enable the userfaultfd() system call that allows to intercept and
+ 	  handle page faults in userland.
+ 
+ 	  If unsure, say Y.
+ 
++>>>>>>> a14c151e567c (userfaultfd: buildsystem activation)
  config PCI_QUIRKS
  	default y
  	bool "Enable PCI quirk workarounds" if EXPERT
diff --git a/fs/Makefile b/fs/Makefile
index 2d0e6bd59072..295424de5616 100644
--- a/fs/Makefile
+++ b/fs/Makefile
@@ -28,6 +28,7 @@ obj-$(CONFIG_ANON_INODES)	+= anon_inodes.o
 obj-$(CONFIG_SIGNALFD)		+= signalfd.o
 obj-$(CONFIG_TIMERFD)		+= timerfd.o
 obj-$(CONFIG_EVENTFD)		+= eventfd.o
+obj-$(CONFIG_USERFAULTFD)	+= userfaultfd.o
 obj-$(CONFIG_AIO)               += aio.o
 obj-$(CONFIG_FILE_LOCKING)      += locks.o
 obj-$(CONFIG_COMPAT)		+= compat.o compat_ioctl.o
* Unmerged path init/Kconfig
