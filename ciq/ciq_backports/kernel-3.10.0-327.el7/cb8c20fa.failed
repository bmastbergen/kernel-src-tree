NFS: Move NFS v3 acl functions to nfs3_fs.h

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-327.el7
commit-author Anna Schumaker <Anna.Schumaker@netapp.com>
commit cb8c20fa53ec28602793ee43ddc7e8883be62e69
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-327.el7/cb8c20fa.failed

This code is internal to the v3 module, so other parts of the client
shouldn't have any knowledge of it.

nfs3_getxattr(), nfs3_setxattr(), and nfs3_removexattr() no longer exist
anywhere so I remove the declarations while I'm here.

	Signed-off-by: Anna Schumaker <Anna.Schumaker@Netapp.com>
	Signed-off-by: Trond Myklebust <trond.myklebust@primarydata.com>
(cherry picked from commit cb8c20fa53ec28602793ee43ddc7e8883be62e69)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	include/linux/nfs_fs.h
diff --cc include/linux/nfs_fs.h
index 5642f116d354,28d649054d5f..000000000000
--- a/include/linux/nfs_fs.h
+++ b/include/linux/nfs_fs.h
@@@ -558,29 -533,6 +542,32 @@@ extern int  nfs_readpage_async(struct n
  			       struct page *);
  
  /*
++<<<<<<< HEAD
 + * linux/fs/nfs3proc.c
 + */
 +#ifdef CONFIG_NFS_V3_ACL
 +extern struct posix_acl *nfs3_proc_getacl(struct inode *inode, int type);
 +extern int nfs3_proc_setacl(struct inode *inode, int type,
 +			    struct posix_acl *acl);
 +extern int nfs3_proc_set_default_acl(struct inode *dir, struct inode *inode,
 +		umode_t mode);
 +extern void nfs3_forget_cached_acls(struct inode *inode);
 +#else
 +static inline int nfs3_proc_set_default_acl(struct inode *dir,
 +					    struct inode *inode,
 +					    umode_t mode)
 +{
 +	return 0;
 +}
 +
 +static inline void nfs3_forget_cached_acls(struct inode *inode)
 +{
 +}
 +#endif /* CONFIG_NFS_V3_ACL */
 +
 +/*
++=======
++>>>>>>> cb8c20fa53ec (NFS: Move NFS v3 acl functions to nfs3_fs.h)
   * inline functions
   */
  
diff --git a/fs/nfs/nfs3_fs.h b/fs/nfs/nfs3_fs.h
index 6599e0dcd69f..333ae4068506 100644
--- a/fs/nfs/nfs3_fs.h
+++ b/fs/nfs/nfs3_fs.h
@@ -6,6 +6,25 @@
 #ifndef __LINUX_FS_NFS_NFS3_FS_H
 #define __LINUX_FS_NFS_NFS3_FS_H
 
+/*
+ * nfs3acl.c
+ */
+#ifdef CONFIG_NFS_V3_ACL
+extern struct posix_acl *nfs3_get_acl(struct inode *inode, int type);
+extern int nfs3_set_acl(struct inode *inode, struct posix_acl *acl, int type);
+extern int nfs3_proc_setacls(struct inode *inode, struct posix_acl *acl,
+		struct posix_acl *dfacl);
+extern ssize_t nfs3_listxattr(struct dentry *, char *, size_t);
+extern const struct xattr_handler *nfs3_xattr_handlers[];
+#else
+static inline int nfs3_proc_setacls(struct inode *inode, struct posix_acl *acl,
+		struct posix_acl *dfacl)
+{
+	return 0;
+}
+#define nfs3_listxattr NULL
+#endif /* CONFIG_NFS_V3_ACL */
+
 /* nfs3client.c */
 struct nfs_server *nfs3_create_server(struct nfs_mount_info *, struct nfs_subversion *);
 struct nfs_server *nfs3_clone_server(struct nfs_server *, struct nfs_fh *,
diff --git a/fs/nfs/nfs3super.c b/fs/nfs/nfs3super.c
index cc471c725230..1dc0f5e07fa9 100644
--- a/fs/nfs/nfs3super.c
+++ b/fs/nfs/nfs3super.c
@@ -4,6 +4,7 @@
 #include <linux/module.h>
 #include <linux/nfs_fs.h>
 #include "internal.h"
+#include "nfs3_fs.h"
 #include "nfs.h"
 
 static struct nfs_subversion nfs_v3 = {
* Unmerged path include/linux/nfs_fs.h
