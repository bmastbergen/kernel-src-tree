i40e: enable packet split only when IOMMU present

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-327.el7
commit-author Mitch Williams <mitch.a.williams@intel.com>
commit 2bc7ee8ac5439efec66fa20a8dc01c0a2b5af739
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-327.el7/2bc7ee8a.failed

When an IOMMU is in use, the packet split receive path shows a distinct
advantage over the single-buffer path because it minimizes DMA mapping
and unmapping. However, this is not an advantage for systems with no
IOMMU. At init time, check to see if an IOMMU is enabled and enable
packet split receives.

Change-ID: I4f70d2e9c31bbea3dc8fd0c5734959a6e6602210
	Signed-off-by: Mitch Williams <mitch.a.williams@intel.com>
	Tested-by: Jim Young <james.m.young@intel.com>
	Signed-off-by: Jeff Kirsher <jeffrey.t.kirsher@intel.com>
(cherry picked from commit 2bc7ee8ac5439efec66fa20a8dc01c0a2b5af739)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/intel/i40e/i40e_main.c
diff --cc drivers/net/ethernet/intel/i40e/i40e_main.c
index 0170562f759f,a8824c785b5a..000000000000
--- a/drivers/net/ethernet/intel/i40e/i40e_main.c
+++ b/drivers/net/ethernet/intel/i40e/i40e_main.c
@@@ -7260,8 -7279,12 +7260,17 @@@ static int i40e_sw_init(struct i40e_pf 
  	/* Set default capability flags */
  	pf->flags = I40E_FLAG_RX_CSUM_ENABLED |
  		    I40E_FLAG_MSI_ENABLED     |
++<<<<<<< HEAD
 +		    I40E_FLAG_MSIX_ENABLED    |
 +		    I40E_FLAG_RX_1BUF_ENABLED;
++=======
+ 		    I40E_FLAG_MSIX_ENABLED;
+ 
+ 	if (iommu_present(&pci_bus_type))
+ 		pf->flags |= I40E_FLAG_RX_PS_ENABLED;
+ 	else
+ 		pf->flags |= I40E_FLAG_RX_1BUF_ENABLED;
++>>>>>>> 2bc7ee8ac543 (i40e: enable packet split only when IOMMU present)
  
  	/* Set default ITR */
  	pf->rx_itr_default = I40E_ITR_DYNAMIC | I40E_ITR_RX_DEF;
diff --git a/drivers/net/ethernet/intel/i40e/i40e.h b/drivers/net/ethernet/intel/i40e/i40e.h
index 3ee730dab82d..eb6307edbdd4 100644
--- a/drivers/net/ethernet/intel/i40e/i40e.h
+++ b/drivers/net/ethernet/intel/i40e/i40e.h
@@ -36,6 +36,7 @@
 #include <linux/aer.h>
 #include <linux/netdevice.h>
 #include <linux/ioport.h>
+#include <linux/iommu.h>
 #include <linux/slab.h>
 #include <linux/list.h>
 #include <linux/string.h>
* Unmerged path drivers/net/ethernet/intel/i40e/i40e_main.c
