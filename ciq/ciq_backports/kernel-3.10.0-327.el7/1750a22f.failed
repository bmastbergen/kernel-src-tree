i40e: delay after VF reset

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-327.el7
commit-author Mitch Williams <mitch.a.williams@intel.com>
commit 1750a22fa9ec34d3842a78780c838d6bf88fc6b5
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-327.el7/1750a22f.failed

Delay a minimum of 10ms after VF reset, to allow the hardware's internal
FIFOs to flush.

Change-ID: I8a02ddb28c9f0d7303a1eb21d0b2443e5b4c1cda
	Signed-off-by: Mitch Williams <mitch.a.williams@intel.com>
	Tested-by: Jim Young <james.m.young@intel.com>
	Signed-off-by: Jeff Kirsher <jeffrey.t.kirsher@intel.com>
(cherry picked from commit 1750a22fa9ec34d3842a78780c838d6bf88fc6b5)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/intel/i40e/i40e_virtchnl_pf.c
diff --cc drivers/net/ethernet/intel/i40e/i40e_virtchnl_pf.c
index e70d8982e436,4e4232a58843..000000000000
--- a/drivers/net/ethernet/intel/i40e/i40e_virtchnl_pf.c
+++ b/drivers/net/ethernet/intel/i40e/i40e_virtchnl_pf.c
@@@ -668,13 -668,13 +668,17 @@@ void i40e_reset_vf(struct i40e_vf *vf, 
  	/* poll VPGEN_VFRSTAT reg to make sure
  	 * that reset is complete
  	 */
- 	for (i = 0; i < 100; i++) {
- 		/* vf reset requires driver to first reset the
- 		 * vf and then poll the status register to make sure
- 		 * that the requested op was completed
- 		 * successfully
+ 	for (i = 0; i < 10; i++) {
+ 		/* VF reset requires driver to first reset the VF and then
+ 		 * poll the status register to make sure that the reset
+ 		 * completed successfully. Due to internal HW FIFO flushes,
+ 		 * we must wait 10ms before the register will be valid.
  		 */
++<<<<<<< HEAD
 +		udelay(10);
++=======
+ 		usleep_range(10000, 20000);
++>>>>>>> 1750a22fa9ec (i40e: delay after VF reset)
  		reg = rd32(hw, I40E_VPGEN_VFRSTAT(vf->vf_id));
  		if (reg & I40E_VPGEN_VFRSTAT_VFRD_MASK) {
  			rsd = true;
* Unmerged path drivers/net/ethernet/intel/i40e/i40e_virtchnl_pf.c
