perf/x86/intel: Add Broadwell support for the LBR callstack

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-327.el7
Rebuild_CHGLOG: - [perf] x86/intel: Add Broadwell support for the LBR callstack (Jiri Olsa) [1222189]
Rebuild_FUZZ: 95.58%
commit-author Kan Liang <kan.liang@intel.com>
commit 78d504bcd769cc496f63b626f507039eab2316b7
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-327.el7/78d504bc.failed

Same as Haswell, Broadwell also support the LBR callstack.

	Signed-off-by: Kan Liang <kan.liang@intel.com>
	Signed-off-by: Peter Zijlstra (Intel) <peterz@infradead.org>
	Acked-by: Andi Kleen <ak@linux.intel.com>
Link: http://lkml.kernel.org/r/1427962377-40955-1-git-send-email-kan.liang@intel.com
	Signed-off-by: Ingo Molnar <mingo@kernel.org>
(cherry picked from commit 78d504bcd769cc496f63b626f507039eab2316b7)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/x86/kernel/cpu/perf_event_intel.c
diff --cc arch/x86/kernel/cpu/perf_event_intel.c
index 36d69bdc488f,219d3fb423a1..000000000000
--- a/arch/x86/kernel/cpu/perf_event_intel.c
+++ b/arch/x86/kernel/cpu/perf_event_intel.c
@@@ -2699,7 -3265,17 +2699,21 @@@ __init int intel_pmu_init(void
  		memcpy(hw_cache_event_ids, hsw_hw_cache_event_ids, sizeof(hw_cache_event_ids));
  		memcpy(hw_cache_extra_regs, hsw_hw_cache_extra_regs, sizeof(hw_cache_extra_regs));
  
++<<<<<<< HEAD
 +		intel_pmu_lbr_init_snb();
++=======
+ 		/* L3_MISS_LOCAL_DRAM is BIT(26) in Broadwell */
+ 		hw_cache_extra_regs[C(LL)][C(OP_READ)][C(RESULT_MISS)] = HSW_DEMAND_READ |
+ 									 BDW_L3_MISS|HSW_SNOOP_DRAM;
+ 		hw_cache_extra_regs[C(LL)][C(OP_WRITE)][C(RESULT_MISS)] = HSW_DEMAND_WRITE|BDW_L3_MISS|
+ 									  HSW_SNOOP_DRAM;
+ 		hw_cache_extra_regs[C(NODE)][C(OP_READ)][C(RESULT_ACCESS)] = HSW_DEMAND_READ|
+ 									     BDW_L3_MISS_LOCAL|HSW_SNOOP_DRAM;
+ 		hw_cache_extra_regs[C(NODE)][C(OP_WRITE)][C(RESULT_ACCESS)] = HSW_DEMAND_WRITE|
+ 									      BDW_L3_MISS_LOCAL|HSW_SNOOP_DRAM;
+ 
+ 		intel_pmu_lbr_init_hsw();
++>>>>>>> 78d504bcd769 (perf/x86/intel: Add Broadwell support for the LBR callstack)
  
  		x86_pmu.event_constraints = intel_bdw_event_constraints;
  		x86_pmu.pebs_constraints = intel_hsw_pebs_event_constraints;
* Unmerged path arch/x86/kernel/cpu/perf_event_intel.c
