perf data: Support using -f to override perf.data file ownership for 'convert'

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-327.el7
Rebuild_CHGLOG: - [perf] data: Support using -f to override perf.data file ownership for 'convert' (Jiri Olsa) [1222189]
Rebuild_FUZZ: 96.69%
commit-author Yunlong Song <yunlong.song@huawei.com>
commit bd05954bfa17f03a7bd4454178ba09786b35e383
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-327.el7/bd05954b.failed

Enable perf data convert to use perf.data when it is not owned by
current user or root.

Example:

 # perf record ls
 # chown Yunlong.Song:Yunlong.Song perf.data
 # ls -al perf.data
 -rw------- 1 Yunlong.Song Yunlong.Song 28260 Apr  2 17:35 perf.data
 # id
 uid=0(root) gid=0(root) groups=0(root),64(pkcs11)

Before this patch:

 # perf data convert --to-ctf=./ctf-data/
 File perf.data not owned by current user or root (use -f to override)
 # perf data convert --to-ctf=./ctf-data/ -f
   Error: unknown switch `f'

  usage: perf data convert [<options>]

     -v, --verbose         be more verbose
     -i, --input <file>    input file name
         --to-ctf ...      Convert to CTF format

After this patch:

 # perf data convert --to-ctf=./ctf-data/
 File perf.data not owned by current user or root (use -f to override)
 # perf data convert --to-ctf=./ctf-data/ -f
 # ls ctf-data/
 metadata  perf_stream_0

As shown above, the -f option really works now.

	Signed-off-by: Yunlong Song <yunlong.song@huawei.com>
	Cc: Paul Mackerras <paulus@samba.org>
	Cc: Peter Zijlstra <a.p.zijlstra@chello.nl>
	Cc: Wang Nan <wangnan0@huawei.com>
Link: http://lkml.kernel.org/r/1427982439-27388-11-git-send-email-yunlong.song@huawei.com
	Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>
(cherry picked from commit bd05954bfa17f03a7bd4454178ba09786b35e383)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	tools/perf/builtin-data.c
#	tools/perf/util/data-convert-bt.c
#	tools/perf/util/data-convert-bt.h
diff --cc tools/perf/builtin-data.c
index 175ed8fee51d,d6525bc54d13..000000000000
--- a/tools/perf/builtin-data.c
+++ b/tools/perf/builtin-data.c
@@@ -43,8 -44,53 +43,55 @@@ static void print_usage(void
  	printf("\n");
  }
  
++<<<<<<< HEAD
++=======
+ static const char * const data_convert_usage[] = {
+ 	"perf data convert [<options>]",
+ 	NULL
+ };
+ 
+ static int cmd_data_convert(int argc, const char **argv,
+ 			    const char *prefix __maybe_unused)
+ {
+ 	const char *to_ctf     = NULL;
+ 	bool force = false;
+ 	const struct option options[] = {
+ 		OPT_INCR('v', "verbose", &verbose, "be more verbose"),
+ 		OPT_STRING('i', "input", &input_name, "file", "input file name"),
+ #ifdef HAVE_LIBBABELTRACE_SUPPORT
+ 		OPT_STRING(0, "to-ctf", &to_ctf, NULL, "Convert to CTF format"),
+ #endif
+ 		OPT_BOOLEAN('f', "force", &force, "don't complain, do it"),
+ 		OPT_END()
+ 	};
+ 
+ #ifndef HAVE_LIBBABELTRACE_SUPPORT
+ 	pr_err("No conversion support compiled in.\n");
+ 	return -1;
+ #endif
+ 
+ 	argc = parse_options(argc, argv, options,
+ 			     data_convert_usage, 0);
+ 	if (argc) {
+ 		usage_with_options(data_convert_usage, options);
+ 		return -1;
+ 	}
+ 
+ 	if (to_ctf) {
+ #ifdef HAVE_LIBBABELTRACE_SUPPORT
+ 		return bt_convert__perf2ctf(input_name, to_ctf, force);
+ #else
+ 		pr_err("The libbabeltrace support is not compiled in.\n");
+ 		return -1;
+ #endif
+ 	}
+ 
+ 	return 0;
+ }
+ 
++>>>>>>> bd05954bfa17 (perf data: Support using -f to override perf.data file ownership for 'convert')
  static struct data_cmd data_cmds[] = {
 -	{ "convert", "converts data file between formats", cmd_data_convert },
 -	{ .name = NULL, },
 +	{ NULL },
  };
  
  int cmd_data(int argc, const char **argv, const char *prefix)
* Unmerged path tools/perf/util/data-convert-bt.c
* Unmerged path tools/perf/util/data-convert-bt.h
* Unmerged path tools/perf/builtin-data.c
* Unmerged path tools/perf/util/data-convert-bt.c
* Unmerged path tools/perf/util/data-convert-bt.h
