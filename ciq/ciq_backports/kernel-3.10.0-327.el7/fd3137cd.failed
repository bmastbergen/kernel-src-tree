openvswitch: Only set TUNNEL_VXLAN_OPT if VXLAN-GBP metadata is set

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-327.el7
commit-author Thomas Graf <tgraf@suug.ch>
commit fd3137cd33ae5590c45c81e9a46fe53b6ab5f66e
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-327.el7/fd3137cd.failed

This avoids setting TUNNEL_VXLAN_OPT for VXLAN frames which don't
have any GBP metadata set. It is not invalid to set it but unnecessary.

	Signed-off-by: Thomas Graf <tgraf@suug.ch>
	Acked-by: Pravin B Shelar <pshelar@nicira.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit fd3137cd33ae5590c45c81e9a46fe53b6ab5f66e)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/openvswitch/vport-vxlan.c
diff --cc net/openvswitch/vport-vxlan.c
index 4ee1a688c5a7,3277a7520e31..000000000000
--- a/net/openvswitch/vport-vxlan.c
+++ b/net/openvswitch/vport-vxlan.c
@@@ -59,12 -61,23 +59,21 @@@ static inline struct vxlan_port *vxlan_
  }
  
  /* Called with rcu_read_lock and BH disabled. */
 -static void vxlan_rcv(struct vxlan_sock *vs, struct sk_buff *skb,
 -		      struct vxlan_metadata *md)
 +static void vxlan_rcv(struct vxlan_sock *vs, struct sk_buff *skb, __be32 vx_vni)
  {
  	struct ovs_tunnel_info tun_info;
 -	struct vxlan_port *vxlan_port;
  	struct vport *vport = vs->data;
  	struct iphdr *iph;
 -	struct ovs_vxlan_opts opts = {
 -		.gbp = md->gbp,
 -	};
  	__be64 key;
++<<<<<<< HEAD
++=======
+ 	__be16 flags;
+ 
+ 	flags = TUNNEL_KEY | (udp_hdr(skb)->check != 0 ? TUNNEL_CSUM : 0);
+ 	vxlan_port = vxlan_vport(vport);
+ 	if (vxlan_port->exts & VXLAN_F_GBP && md->gbp)
+ 		flags |= TUNNEL_VXLAN_OPT;
++>>>>>>> fd3137cd33ae (openvswitch: Only set TUNNEL_VXLAN_OPT if VXLAN-GBP metadata is set)
  
  	/* Save outer tunnel values */
  	iph = ip_hdr(skb);
* Unmerged path net/openvswitch/vport-vxlan.c
