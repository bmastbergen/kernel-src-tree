net: pktgen: disable xmit_clone on virtual devices

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-327.el7
Rebuild_CHGLOG: - [net] pktgen: disable xmit_clone on virtual devices (Alexander Duyck) [1205266]
Rebuild_FUZZ: 94.74%
commit-author Eric Dumazet <edumazet@google.com>
commit 52d6c8c6ca125872459054daa70f2f1c698c8e75
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-327.el7/52d6c8c6.failed

Trying to use burst capability (aka xmit_more) on a virtual device
like bonding is not supported.

For example, skb might be queued multiple times on a qdisc, with
various list corruptions.

Fixes: 38b2cf2982dc ("net: pktgen: packet bursting via skb->xmit_more")
	Signed-off-by: Eric Dumazet <edumazet@google.com>
	Cc: Alexei Starovoitov <ast@plumgrid.com>
	Acked-by: Alexei Starovoitov <ast@plumgrid.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 52d6c8c6ca125872459054daa70f2f1c698c8e75)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/core/pktgen.c
diff --cc net/core/pktgen.c
index dc189dd7ca08,508155b283dd..000000000000
--- a/net/core/pktgen.c
+++ b/net/core/pktgen.c
@@@ -1111,6 -1128,19 +1111,22 @@@ static ssize_t pktgen_if_write(struct f
  			pkt_dev->dst_mac_count);
  		return count;
  	}
++<<<<<<< HEAD
++=======
+ 	if (!strcmp(name, "burst")) {
+ 		len = num_arg(&user_buffer[i], 10, &value);
+ 		if (len < 0)
+ 			return len;
+ 
+ 		i += len;
+ 		if ((value > 1) &&
+ 		    (!(pkt_dev->odev->priv_flags & IFF_TX_SKB_SHARING)))
+ 			return -ENOTSUPP;
+ 		pkt_dev->burst = value < 1 ? 1 : value;
+ 		sprintf(pg_result, "OK: burst=%d", pkt_dev->burst);
+ 		return count;
+ 	}
++>>>>>>> 52d6c8c6ca12 (net: pktgen: disable xmit_clone on virtual devices)
  	if (!strcmp(name, "node")) {
  		len = num_arg(&user_buffer[i], 10, &value);
  		if (len < 0)
* Unmerged path net/core/pktgen.c
