ipr: Fix possible error path oops during initialization

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-327.el7
commit-author Brian King <brking@linux.vnet.ibm.com>
commit a65e8f128eca1efafeb16039650ae36b25cfd0dc
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-327.el7/a65e8f12.failed

Fixes a possible oops during adapter initialization in some
memory allocation failure error paths scenarios.

	Reported-by: Dan Carpenter <dan.carpenter@oracle.com>
	Signed-off-by: Brian King <brking@linux.vnet.ibm.com>
	Reviewed-by: Wen Xiong <wenxiong@linux.vnet.ibm.com>
	Reviewed-by: Daniel Kreling <kreling@linux.vnet.ibm.com>
	Signed-off-by: James Bottomley <JBottomley@Odin.com>
(cherry picked from commit a65e8f128eca1efafeb16039650ae36b25cfd0dc)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/scsi/ipr.c
diff --cc drivers/scsi/ipr.c
index 5b27cd19417f,7b2768fbe071..000000000000
--- a/drivers/scsi/ipr.c
+++ b/drivers/scsi/ipr.c
@@@ -9130,13 -9060,15 +9130,23 @@@ static void ipr_free_cmd_blks(struct ip
  {
  	int i;
  
++<<<<<<< HEAD
 +	for (i = 0; i < IPR_NUM_CMD_BLKS; i++) {
 +		if (ioa_cfg->ipr_cmnd_list[i])
 +			pci_pool_free(ioa_cfg->ipr_cmd_pool,
 +				      ioa_cfg->ipr_cmnd_list[i],
 +				      ioa_cfg->ipr_cmnd_list_dma[i]);
- 
- 		ioa_cfg->ipr_cmnd_list[i] = NULL;
++=======
+ 	if (ioa_cfg->ipr_cmnd_list) {
+ 		for (i = 0; i < IPR_NUM_CMD_BLKS; i++) {
+ 			if (ioa_cfg->ipr_cmnd_list[i])
+ 				dma_pool_free(ioa_cfg->ipr_cmd_pool,
+ 					      ioa_cfg->ipr_cmnd_list[i],
+ 					      ioa_cfg->ipr_cmnd_list_dma[i]);
++>>>>>>> a65e8f128eca (ipr: Fix possible error path oops during initialization)
+ 
+ 			ioa_cfg->ipr_cmnd_list[i] = NULL;
+ 		}
  	}
  
  	if (ioa_cfg->ipr_cmd_pool)
* Unmerged path drivers/scsi/ipr.c
