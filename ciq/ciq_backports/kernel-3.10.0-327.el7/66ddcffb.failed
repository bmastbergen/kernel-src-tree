i40e: Fix RSS size at init since default num queue calculation has changed

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-327.el7
commit-author Anjali Singhai Jain <anjali.singhai@intel.com>
commit 66ddcffb1afb009d352115a61e25c237915d9e04
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-327.el7/66ddcffb.failed

With changes to default number of queue pairs that the interface comes up with
from 1 per online CPU to 1 per lan_msix, we need to make sure we recalculate
rss_size. We will now recalculate rss_size based on number of queues enabled in
the VSI.

Without this fix if the max_lan_msix < num_online_cpu we will be coming up
with fewer queues but will be populating rss_size based on num_online_cpus.
This will result in packets getting silently dropped because RSS LUT has queues
that are not enabled.

Change-ID: Ifac8796ce1be1758bb0c34f38dbf4a3a76621e76
	Signed-off-by: Anjali Singhai Jain <anjali.singhai@intel.com>
	Signed-off-by: Jeff Kirsher <jeffrey.t.kirsher@intel.com>
(cherry picked from commit 66ddcffb1afb009d352115a61e25c237915d9e04)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/intel/i40e/i40e_main.c
diff --cc drivers/net/ethernet/intel/i40e/i40e_main.c
index 2c181081a1ad,f9da8e805842..000000000000
--- a/drivers/net/ethernet/intel/i40e/i40e_main.c
+++ b/drivers/net/ethernet/intel/i40e/i40e_main.c
@@@ -7199,11 -7206,8 +7199,16 @@@ static int i40e_setup_misc_vector(struc
   **/
  static int i40e_config_rss(struct i40e_pf *pf)
  {
++<<<<<<< HEAD
 +	/* Set of random keys generated using kernel random number generator */
 +	static const u32 seed[I40E_PFQF_HKEY_MAX_INDEX + 1] = {0x41b01687,
 +				0x183cfd8c, 0xce880440, 0x580cbc3c, 0x35897377,
 +				0x328b25e1, 0x4fa98922, 0xb7d90c14, 0xd5bad70d,
 +				0xcd15a2c1, 0xe8580225, 0x4a1e9d11, 0xfe5731be};
++=======
+ 	u32 rss_key[I40E_PFQF_HKEY_MAX_INDEX + 1];
+ 	struct i40e_vsi *vsi = pf->vsi[pf->lan_vsi];
++>>>>>>> 66ddcffb1afb (i40e: Fix RSS size at init since default num queue calculation has changed)
  	struct i40e_hw *hw = &pf->hw;
  	u32 lut = 0;
  	int i, j;
diff --git a/drivers/net/ethernet/intel/i40e/i40e.h b/drivers/net/ethernet/intel/i40e/i40e.h
index aa1b586d25c0..3b9992b94835 100644
--- a/drivers/net/ethernet/intel/i40e/i40e.h
+++ b/drivers/net/ethernet/intel/i40e/i40e.h
@@ -471,6 +471,7 @@ struct i40e_vsi {
 	u16 tx_itr_setting;
 
 	u16 rss_table_size;
+	u16 rss_size;
 
 	u16 max_frame;
 	u16 rx_hdr_len;
* Unmerged path drivers/net/ethernet/intel/i40e/i40e_main.c
