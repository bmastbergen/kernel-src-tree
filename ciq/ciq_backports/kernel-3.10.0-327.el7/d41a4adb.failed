iommu/vt-d: Simplify intel_unmap_sg() and kill duplicated code

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-327.el7
Rebuild_CHGLOG: - [iommu] vt-d: Simplify intel_unmap_sg() and kill duplicated code (Myron Stowe) [1225193]
Rebuild_FUZZ: 94.92%
commit-author Jiang Liu <jiang.liu@linux.intel.com>
commit d41a4adb1b9208a0ee59e6b4752853c1dd27cc2c
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-327.el7/d41a4adb.failed

Introduce intel_unmap() to reduce duplicated code in intel_unmap_sg()
and intel_unmap_page().

Also let dma_pte_free_pagetable() to call dma_pte_clear_range() directly,
so caller only needs to call dma_pte_free_pagetable().

	Signed-off-by: Jiang Liu <jiang.liu@linux.intel.com>
	Signed-off-by: Joerg Roedel <jroedel@suse.de>
(cherry picked from commit d41a4adb1b9208a0ee59e6b4752853c1dd27cc2c)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/iommu/intel-iommu.c
diff --cc drivers/iommu/intel-iommu.c
index c659177eec97,0852b7021e4a..000000000000
--- a/drivers/iommu/intel-iommu.c
+++ b/drivers/iommu/intel-iommu.c
@@@ -3258,8 -3259,9 +3267,14 @@@ static void intel_free_coherent(struct 
  	size = PAGE_ALIGN(size);
  	order = get_order(size);
  
++<<<<<<< HEAD
 +	intel_unmap_page(dev, dma_handle, size, DMA_BIDIRECTIONAL, NULL);
 +	free_pages((unsigned long)vaddr, order);
++=======
+ 	intel_unmap(dev, dma_handle);
+ 	if (!dma_release_from_contiguous(dev, page, size >> PAGE_SHIFT))
+ 		__free_pages(page, order);
++>>>>>>> d41a4adb1b92 (iommu/vt-d: Simplify intel_unmap_sg() and kill duplicated code)
  }
  
  static void intel_unmap_sg(struct device *dev, struct scatterlist *sglist,
* Unmerged path drivers/iommu/intel-iommu.c
