ACPI / LPSS: allow to use specific PM domain during ->probe()

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-327.el7
Rebuild_CHGLOG: - [acpi] lpss: allow to use specific PM domain during ->probe() (Prarit Bhargava) [1178891]
Rebuild_FUZZ: 93.91%
commit-author Andy Shevchenko <andriy.shevchenko@linux.intel.com>
commit 01ac170ba29a9903ee590e1ef2d8e6b27b49a16c
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-327.el7/01ac170b.failed

The LPSS DMA controller would like to use the specific PM domain callbacks
during early stage, namely in ->probe(). This patch moves the specific PM
domain assignment early to be accessible during a whole life time of the device
in the system.

	Suggested-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>
	Signed-off-by: Andy Shevchenko <andriy.shevchenko@linux.intel.com>
	Tested-by: Scott Ashcroft <scott.ashcroft@talk21.com>
	Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>
(cherry picked from commit 01ac170ba29a9903ee590e1ef2d8e6b27b49a16c)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/acpi/acpi_lpss.c
diff --cc drivers/acpi/acpi_lpss.c
index 65baff6911fd,4804ae31b057..000000000000
--- a/drivers/acpi/acpi_lpss.c
+++ b/drivers/acpi/acpi_lpss.c
@@@ -462,12 -658,23 +462,30 @@@ static int acpi_lpss_platform_notify(st
  		return 0;
  	}
  
++<<<<<<< HEAD
 +	if (action == BUS_NOTIFY_ADD_DEVICE)
 +		ret = sysfs_create_group(&pdev->dev.kobj, &lpss_attr_group);
 +	else if (action == BUS_NOTIFY_DEL_DEVICE)
 +		sysfs_remove_group(&pdev->dev.kobj, &lpss_attr_group);
++=======
+ 	switch (action) {
+ 	case BUS_NOTIFY_ADD_DEVICE:
+ 		pdev->dev.pm_domain = &acpi_lpss_pm_domain;
+ 		if (pdata->dev_desc->flags & LPSS_LTR)
+ 			return sysfs_create_group(&pdev->dev.kobj,
+ 						  &lpss_attr_group);
+ 		break;
+ 	case BUS_NOTIFY_DEL_DEVICE:
+ 		if (pdata->dev_desc->flags & LPSS_LTR)
+ 			sysfs_remove_group(&pdev->dev.kobj, &lpss_attr_group);
+ 		pdev->dev.pm_domain = NULL;
+ 		break;
+ 	default:
+ 		break;
+ 	}
++>>>>>>> 01ac170ba29a (ACPI / LPSS: allow to use specific PM domain during ->probe())
  
 -	return 0;
 +	return ret;
  }
  
  static struct notifier_block acpi_lpss_nb = {
* Unmerged path drivers/acpi/acpi_lpss.c
