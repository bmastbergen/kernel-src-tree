mlxsw: spectrum_router: Use loopback RIF for unresolved nexthops

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-331.el8
commit-author Ido Schimmel <idosch@nvidia.com>
commit 919f6aaa3ae95f98ca57c1c1dd4158a30a3bf3ea
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-331.el8/919f6aaa.failed

Now that the driver creates a loopback RIF during its initialization, it
can be used to program the adjacency entries for unresolved nexthops
instead of other RIFs. The loopback RIF is guaranteed to exist for the
entire life time of the driver, unlike other RIFs that come and go.

	Signed-off-by: Ido Schimmel <idosch@nvidia.com>
	Reviewed-by: Jiri Pirko <jiri@nvidia.com>
	Signed-off-by: Jakub Kicinski <kuba@kernel.org>
(cherry picked from commit 919f6aaa3ae95f98ca57c1c1dd4158a30a3bf3ea)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/mellanox/mlxsw/spectrum_router.c
diff --cc drivers/net/ethernet/mellanox/mlxsw/spectrum_router.c
index c1c74fade86b,53d04e7993f6..000000000000
--- a/drivers/net/ethernet/mellanox/mlxsw/spectrum_router.c
+++ b/drivers/net/ethernet/mellanox/mlxsw/spectrum_router.c
@@@ -4546,12 -5049,10 +4547,19 @@@ static int mlxsw_sp_fib_entry_op_remote
  	 */
  	if (mlxsw_sp_fib_entry_should_offload(fib_entry)) {
  		trap_action = MLXSW_REG_RALUE_TRAP_ACTION_NOP;
++<<<<<<< HEAD
 +		adjacency_index = fib_entry->nh_group->adj_index;
 +		ecmp_size = fib_entry->nh_group->ecmp_size;
 +	} else if (!nh_group->adj_index_valid && nh_group->count &&
 +		   nh_group->nh_rif) {
 +		err = mlxsw_sp_adj_discard_write(mlxsw_sp,
 +						 nh_group->nh_rif->rif_index);
++=======
+ 		adjacency_index = nhgi->adj_index;
+ 		ecmp_size = nhgi->ecmp_size;
+ 	} else if (!nhgi->adj_index_valid && nhgi->count && nhgi->nh_rif) {
+ 		err = mlxsw_sp_adj_discard_write(mlxsw_sp);
++>>>>>>> 919f6aaa3ae9 (mlxsw: spectrum_router: Use loopback RIF for unresolved nexthops)
  		if (err)
  			return err;
  		trap_action = MLXSW_REG_RALUE_TRAP_ACTION_NOP;
* Unmerged path drivers/net/ethernet/mellanox/mlxsw/spectrum_router.c
