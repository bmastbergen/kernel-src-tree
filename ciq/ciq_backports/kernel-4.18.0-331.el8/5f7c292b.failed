KVM: Move prototypes for MMU notifier callbacks to generic code

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-331.el8
commit-author Sean Christopherson <seanjc@google.com>
commit 5f7c292b8975c9146063abbb91c0b9cdc1a5e9c5
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-331.el8/5f7c292b.failed

Move the prototypes for the MMU notifier callbacks out of arch code and
into common code.  There is no benefit to having each arch replicate the
prototypes since any deviation from the invocation in common code will
explode.

No functional change intended.

	Signed-off-by: Sean Christopherson <seanjc@google.com>
Message-Id: <20210326021957.1424875-9-seanjc@google.com>
	Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>
(cherry picked from commit 5f7c292b8975c9146063abbb91c0b9cdc1a5e9c5)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/arm64/include/asm/kvm_host.h
#	arch/mips/include/asm/kvm_host.h
#	arch/powerpc/include/asm/kvm_host.h
#	arch/x86/include/asm/kvm_host.h
diff --cc arch/arm64/include/asm/kvm_host.h
index 04d35753372e,72e6b4600264..000000000000
--- a/arch/arm64/include/asm/kvm_host.h
+++ b/arch/arm64/include/asm/kvm_host.h
@@@ -465,11 -582,6 +465,14 @@@ int __kvm_arm_vcpu_set_events(struct kv
  			      struct kvm_vcpu_events *events);
  
  #define KVM_ARCH_WANT_MMU_NOTIFIER
++<<<<<<< HEAD
 +int kvm_unmap_hva_range(struct kvm *kvm,
 +			unsigned long start, unsigned long end);
 +int kvm_set_spte_hva(struct kvm *kvm, unsigned long hva, pte_t pte);
 +int kvm_age_hva(struct kvm *kvm, unsigned long start, unsigned long end);
 +int kvm_test_age_hva(struct kvm *kvm, unsigned long hva);
++=======
++>>>>>>> 5f7c292b8975 (KVM: Move prototypes for MMU notifier callbacks to generic code)
  
  void kvm_arm_halt_guest(struct kvm *kvm);
  void kvm_arm_resume_guest(struct kvm *kvm);
diff --cc arch/mips/include/asm/kvm_host.h
index 8a0560f44399,feaa77036b67..000000000000
--- a/arch/mips/include/asm/kvm_host.h
+++ b/arch/mips/include/asm/kvm_host.h
@@@ -933,11 -967,6 +933,14 @@@ enum kvm_mips_fault_result kvm_trap_emu
  						   bool write);
  
  #define KVM_ARCH_WANT_MMU_NOTIFIER
++<<<<<<< HEAD
 +int kvm_unmap_hva_range(struct kvm *kvm,
 +			unsigned long start, unsigned long end);
 +int kvm_set_spte_hva(struct kvm *kvm, unsigned long hva, pte_t pte);
 +int kvm_age_hva(struct kvm *kvm, unsigned long start, unsigned long end);
 +int kvm_test_age_hva(struct kvm *kvm, unsigned long hva);
++=======
++>>>>>>> 5f7c292b8975 (KVM: Move prototypes for MMU notifier callbacks to generic code)
  
  /* Emulation */
  int kvm_get_inst(u32 *opc, struct kvm_vcpu *vcpu, u32 *out);
diff --cc arch/powerpc/include/asm/kvm_host.h
index c3ea5f06ae95,1e83359f286b..000000000000
--- a/arch/powerpc/include/asm/kvm_host.h
+++ b/arch/powerpc/include/asm/kvm_host.h
@@@ -67,12 -56,6 +67,15 @@@
  
  #define KVM_ARCH_WANT_MMU_NOTIFIER
  
++<<<<<<< HEAD
 +extern int kvm_unmap_hva_range(struct kvm *kvm,
 +			       unsigned long start, unsigned long end);
 +extern int kvm_age_hva(struct kvm *kvm, unsigned long start, unsigned long end);
 +extern int kvm_test_age_hva(struct kvm *kvm, unsigned long hva);
 +extern int kvm_set_spte_hva(struct kvm *kvm, unsigned long hva, pte_t pte);
 +
++=======
++>>>>>>> 5f7c292b8975 (KVM: Move prototypes for MMU notifier callbacks to generic code)
  #define HPTEG_CACHE_NUM			(1 << 15)
  #define HPTEG_HASH_BITS_PTE		13
  #define HPTEG_HASH_BITS_PTE_LONG	12
diff --cc arch/x86/include/asm/kvm_host.h
index 0593c3295757,99778ac51243..000000000000
--- a/arch/x86/include/asm/kvm_host.h
+++ b/arch/x86/include/asm/kvm_host.h
@@@ -1768,10 -1718,7 +1768,14 @@@ asmlinkage void kvm_spurious_fault(void
  	_ASM_EXTABLE(666b, 667b)
  
  #define KVM_ARCH_WANT_MMU_NOTIFIER
 -
++<<<<<<< HEAD
 +int kvm_unmap_hva_range(struct kvm *kvm, unsigned long start, unsigned long end);
 +int kvm_age_hva(struct kvm *kvm, unsigned long start, unsigned long end);
 +int kvm_test_age_hva(struct kvm *kvm, unsigned long hva);
 +int kvm_set_spte_hva(struct kvm *kvm, unsigned long hva, pte_t pte);
++=======
++
++>>>>>>> 5f7c292b8975 (KVM: Move prototypes for MMU notifier callbacks to generic code)
  int kvm_cpu_has_injectable_intr(struct kvm_vcpu *v);
  int kvm_cpu_has_interrupt(struct kvm_vcpu *vcpu);
  int kvm_cpu_has_extint(struct kvm_vcpu *v);
* Unmerged path arch/arm64/include/asm/kvm_host.h
* Unmerged path arch/mips/include/asm/kvm_host.h
* Unmerged path arch/powerpc/include/asm/kvm_host.h
* Unmerged path arch/x86/include/asm/kvm_host.h
diff --git a/include/linux/kvm_host.h b/include/linux/kvm_host.h
index 709b6acf1647..d33b460beb17 100644
--- a/include/linux/kvm_host.h
+++ b/include/linux/kvm_host.h
@@ -221,6 +221,14 @@ bool kvm_setup_async_pf(struct kvm_vcpu *vcpu, gpa_t cr2_or_gpa,
 int kvm_async_pf_wakeup_all(struct kvm_vcpu *vcpu);
 #endif
 
+#ifdef KVM_ARCH_WANT_MMU_NOTIFIER
+int kvm_unmap_hva_range(struct kvm *kvm,
+			unsigned long start, unsigned long end, unsigned flags);
+int kvm_set_spte_hva(struct kvm *kvm, unsigned long hva, pte_t pte);
+int kvm_age_hva(struct kvm *kvm, unsigned long start, unsigned long end);
+int kvm_test_age_hva(struct kvm *kvm, unsigned long hva);
+#endif
+
 enum {
 	OUTSIDE_GUEST_MODE,
 	IN_GUEST_MODE,
