mlxsw: spectrum_router: Set FIB entry's type based on nexthop group

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-331.el8
commit-author Ido Schimmel <idosch@nvidia.com>
commit c0351b7c25ffd52408c1297fbe552f185d5aac3f
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-331.el8/c0351b7c.failed

The previous patch associated a nexthop group with the FIB entry before
the entry's type is determined.

Make use of the nexthop group when determining the entry's type instead
of relying on helpers that assume that the nexthop info is not a nexthop
object (i.e., 'struct nexthop').

	Signed-off-by: Ido Schimmel <idosch@nvidia.com>
	Reviewed-by: Jiri Pirko <jiri@nvidia.com>
	Signed-off-by: Jakub Kicinski <kuba@kernel.org>
(cherry picked from commit c0351b7c25ffd52408c1297fbe552f185d5aac3f)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/mellanox/mlxsw/spectrum_router.c
diff --cc drivers/net/ethernet/mellanox/mlxsw/spectrum_router.c
index 2a07ce188ef8,4f5c135bc587..000000000000
--- a/drivers/net/ethernet/mellanox/mlxsw/spectrum_router.c
+++ b/drivers/net/ethernet/mellanox/mlxsw/spectrum_router.c
@@@ -4741,12 -4778,12 +4741,19 @@@ mlxsw_sp_fib4_entry_type_set(struct mlx
  			     const struct fib_entry_notifier_info *fen_info,
  			     struct mlxsw_sp_fib_entry *fib_entry)
  {
++<<<<<<< HEAD
 +	union mlxsw_sp_l3addr dip = { .addr4 = htonl(fen_info->dst) };
 +	struct mlxsw_sp_router *router = mlxsw_sp->router;
 +	u32 tb_id = mlxsw_sp_fix_tb_id(fen_info->tb_id);
 +	struct net_device *dev = fen_info->fi->fib_dev;
++=======
+ 	struct mlxsw_sp_nexthop_group_info *nhgi = fib_entry->nh_group->nhgi;
+ 	union mlxsw_sp_l3addr dip = { .addr4 = htonl(fen_info->dst) };
+ 	struct mlxsw_sp_router *router = mlxsw_sp->router;
+ 	u32 tb_id = mlxsw_sp_fix_tb_id(fen_info->tb_id);
+ 	int ifindex = nhgi->nexthops[0].ifindex;
++>>>>>>> c0351b7c25ff (mlxsw: spectrum_router: Set FIB entry's type based on nexthop group)
  	struct mlxsw_sp_ipip_entry *ipip_entry;
- 	struct fib_info *fi = fen_info->fi;
  
  	switch (fen_info->type) {
  	case RTN_LOCAL:
* Unmerged path drivers/net/ethernet/mellanox/mlxsw/spectrum_router.c
