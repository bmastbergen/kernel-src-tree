cifs: Make extract_sharename function public

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-331.el8
commit-author Samuel Cabrero <scabrero@suse.de>
commit e73a42e07a2246ecd8b0cad70824d26ab07985c2
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-331.el8/e73a42e0.failed

Move the function to misc.c

	Signed-off-by: Samuel Cabrero <scabrero@suse.de>
	Reviewed-by: Aurelien Aptel <aaptel@suse.com>
	Signed-off-by: Steve French <stfrench@microsoft.com>
(cherry picked from commit e73a42e07a2246ecd8b0cad70824d26ab07985c2)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	fs/cifs/cifsproto.h
#	fs/cifs/misc.c
diff --cc fs/cifs/cifsproto.h
index aa66a6b9aaf5,b80b57a66804..000000000000
--- a/fs/cifs/cifsproto.h
+++ b/fs/cifs/cifsproto.h
@@@ -621,6 -617,8 +621,11 @@@ int smb2_parse_query_directory(struct c
  struct super_block *cifs_get_tcp_super(struct TCP_Server_Info *server);
  void cifs_put_tcp_super(struct super_block *sb);
  int update_super_prepath(struct cifs_tcon *tcon, char *prefix);
++<<<<<<< HEAD
++=======
+ char *extract_hostname(const char *unc);
+ char *extract_sharename(const char *unc);
++>>>>>>> e73a42e07a22 (cifs: Make extract_sharename function public)
  
  #ifdef CONFIG_CIFS_DFS_UPCALL
  static inline int get_dfs_path(const unsigned int xid, struct cifs_ses *ses,
diff --cc fs/cifs/misc.c
index b2d1e7cb6869,f0a1c24751b2..000000000000
--- a/fs/cifs/misc.c
+++ b/fs/cifs/misc.c
@@@ -1196,3 -1195,59 +1196,62 @@@ out
  	cifs_put_tcon_super(sb);
  	return rc;
  }
++<<<<<<< HEAD
++=======
+ 
+ /* extract the host portion of the UNC string */
+ char *extract_hostname(const char *unc)
+ {
+ 	const char *src;
+ 	char *dst, *delim;
+ 	unsigned int len;
+ 
+ 	/* skip double chars at beginning of string */
+ 	/* BB: check validity of these bytes? */
+ 	if (strlen(unc) < 3)
+ 		return ERR_PTR(-EINVAL);
+ 	for (src = unc; *src && *src == '\\'; src++)
+ 		;
+ 	if (!*src)
+ 		return ERR_PTR(-EINVAL);
+ 
+ 	/* delimiter between hostname and sharename is always '\\' now */
+ 	delim = strchr(src, '\\');
+ 	if (!delim)
+ 		return ERR_PTR(-EINVAL);
+ 
+ 	len = delim - src;
+ 	dst = kmalloc((len + 1), GFP_KERNEL);
+ 	if (dst == NULL)
+ 		return ERR_PTR(-ENOMEM);
+ 
+ 	memcpy(dst, src, len);
+ 	dst[len] = '\0';
+ 
+ 	return dst;
+ }
+ 
+ char *extract_sharename(const char *unc)
+ {
+ 	const char *src;
+ 	char *delim, *dst;
+ 	int len;
+ 
+ 	/* skip double chars at the beginning */
+ 	src = unc + 2;
+ 
+ 	/* share name is always preceded by '\\' now */
+ 	delim = strchr(src, '\\');
+ 	if (!delim)
+ 		return ERR_PTR(-EINVAL);
+ 	delim++;
+ 	len = strlen(delim);
+ 
+ 	/* caller has to free the memory */
+ 	dst = kstrndup(delim, len, GFP_KERNEL);
+ 	if (!dst)
+ 		return ERR_PTR(-ENOMEM);
+ 
+ 	return dst;
+ }
++>>>>>>> e73a42e07a22 (cifs: Make extract_sharename function public)
diff --git a/fs/cifs/cache.c b/fs/cifs/cache.c
index 0f2adecb94f2..488fe0ffc1ef 100644
--- a/fs/cifs/cache.c
+++ b/fs/cifs/cache.c
@@ -53,30 +53,6 @@ const struct fscache_cookie_def cifs_fscache_server_index_def = {
 	.type = FSCACHE_COOKIE_TYPE_INDEX,
 };
 
-char *extract_sharename(const char *treename)
-{
-	const char *src;
-	char *delim, *dst;
-	int len;
-
-	/* skip double chars at the beginning */
-	src = treename + 2;
-
-	/* share name is always preceded by '\\' now */
-	delim = strchr(src, '\\');
-	if (!delim)
-		return ERR_PTR(-EINVAL);
-	delim++;
-	len = strlen(delim);
-
-	/* caller has to free the memory */
-	dst = kstrndup(delim, len, GFP_KERNEL);
-	if (!dst)
-		return ERR_PTR(-ENOMEM);
-
-	return dst;
-}
-
 static enum
 fscache_checkaux cifs_fscache_super_check_aux(void *cookie_netfs_data,
 					      const void *data,
* Unmerged path fs/cifs/cifsproto.h
diff --git a/fs/cifs/fscache.c b/fs/cifs/fscache.c
index da688185403c..20d24af33ee2 100644
--- a/fs/cifs/fscache.c
+++ b/fs/cifs/fscache.c
@@ -22,6 +22,7 @@
 #include "cifsglob.h"
 #include "cifs_debug.h"
 #include "cifs_fs_sb.h"
+#include "cifsproto.h"
 
 /*
  * Key layout of CIFS server cache index object
diff --git a/fs/cifs/fscache.h b/fs/cifs/fscache.h
index 1091633d2adb..e811f2dd7619 100644
--- a/fs/cifs/fscache.h
+++ b/fs/cifs/fscache.h
@@ -57,7 +57,6 @@ extern const struct fscache_cookie_def cifs_fscache_inode_object_def;
 
 extern int cifs_fscache_register(void);
 extern void cifs_fscache_unregister(void);
-extern char *extract_sharename(const char *);
 
 /*
  * fscache.c
* Unmerged path fs/cifs/misc.c
