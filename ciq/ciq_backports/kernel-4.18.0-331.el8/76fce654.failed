gfs2: Move function gfs2_ail_empty_tr

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-331.el8
commit-author Andreas Gruenbacher <agruenba@redhat.com>
commit 76fce6548961a0c6246c4796e71800cdc63d5851
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-331.el8/76fce654.failed

Move this function further up in log.c so that we can use it in the next patch.

	Signed-off-by: Andreas Gruenbacher <agruenba@redhat.com>
(cherry picked from commit 76fce6548961a0c6246c4796e71800cdc63d5851)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	fs/gfs2/log.c
diff --cc fs/gfs2/log.c
index 1a5aad0b1fab,6fd4ded1e357..000000000000
--- a/fs/gfs2/log.c
+++ b/fs/gfs2/log.c
@@@ -211,6 -242,45 +211,23 @@@ static void gfs2_ail1_start(struct gfs2
  	return gfs2_ail1_flush(sdp, &wbc);
  }
  
 -static void gfs2_log_update_flush_tail(struct gfs2_sbd *sdp)
 -{
 -	unsigned int new_flush_tail = sdp->sd_log_head;
 -	struct gfs2_trans *tr;
 -
 -	if (!list_empty(&sdp->sd_ail1_list)) {
 -		tr = list_last_entry(&sdp->sd_ail1_list,
 -				     struct gfs2_trans, tr_list);
 -		new_flush_tail = tr->tr_first;
 -	}
 -	sdp->sd_log_flush_tail = new_flush_tail;
 -}
 -
 -static void gfs2_log_update_head(struct gfs2_sbd *sdp)
 -{
 -	unsigned int new_head = sdp->sd_log_flush_head;
 -
 -	if (sdp->sd_log_flush_tail == sdp->sd_log_head)
 -		sdp->sd_log_flush_tail = new_head;
 -	sdp->sd_log_head = new_head;
 -}
 -
+ /**
+  * gfs2_ail_empty_tr - empty one of the ail lists of a transaction
+  */
+ 
+ static void gfs2_ail_empty_tr(struct gfs2_sbd *sdp, struct gfs2_trans *tr,
+ 			      struct list_head *head)
+ {
+ 	struct gfs2_bufdata *bd;
+ 
+ 	while (!list_empty(head)) {
+ 		bd = list_first_entry(head, struct gfs2_bufdata,
+ 				      bd_ail_st_list);
+ 		gfs2_assert(sdp, bd->bd_tr == tr);
+ 		gfs2_remove_from_ail(bd);
+ 	}
+ }
+ 
  /**
   * gfs2_ail1_empty_one - Check whether or not a trans in the AIL has been synced
   * @sdp: the filesystem
@@@ -319,21 -390,13 +336,31 @@@ static void gfs2_ail1_wait(struct gfs2_
  	spin_unlock(&sdp->sd_ail_lock);
  }
  
++<<<<<<< HEAD
 +/**
 + * gfs2_ail_empty_tr - empty one of the ail lists for a transaction
 + */
 +
 +static void gfs2_ail_empty_tr(struct gfs2_sbd *sdp, struct gfs2_trans *tr,
 +			      struct list_head *head)
 +{
 +	struct gfs2_bufdata *bd;
 +
 +	while (!list_empty(head)) {
 +		bd = list_first_entry(head, struct gfs2_bufdata,
 +				      bd_ail_st_list);
 +		gfs2_assert(sdp, bd->bd_tr == tr);
 +		gfs2_remove_from_ail(bd);
 +	}
++=======
+ static void __ail2_empty(struct gfs2_sbd *sdp, struct gfs2_trans *tr)
+ {
+ 	gfs2_ail_empty_tr(sdp, tr, &tr->tr_ail2_list);
+ 	list_del(&tr->tr_list);
+ 	gfs2_assert_warn(sdp, list_empty(&tr->tr_ail1_list));
+ 	gfs2_assert_warn(sdp, list_empty(&tr->tr_ail2_list));
+ 	gfs2_trans_free(sdp, tr);
++>>>>>>> 76fce6548961 (gfs2: Move function gfs2_ail_empty_tr)
  }
  
  static void ail2_empty(struct gfs2_sbd *sdp, unsigned int new_tail)
* Unmerged path fs/gfs2/log.c
