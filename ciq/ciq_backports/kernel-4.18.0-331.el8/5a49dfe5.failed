mlxsw: spectrum_router: Move IPv4 FIB info into a union in nexthop group struct

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-331.el8
commit-author Ido Schimmel <idosch@nvidia.com>
commit 5a49dfe51f2291c19e97ad7fd23cc00c4c1aca26
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-331.el8/5a49dfe5.failed

Instead of storing the FIB info as 'priv' when the nexthop group
represents an IPv4 nexthop group, simply store it as a FIB info with a
proper comment.

When nexthop objects are supported, this field will become a union with
the nexthop object's identifier.

	Signed-off-by: Ido Schimmel <idosch@nvidia.com>
	Reviewed-by: Jiri Pirko <jiri@nvidia.com>
	Signed-off-by: Jakub Kicinski <kuba@kernel.org>
(cherry picked from commit 5a49dfe51f2291c19e97ad7fd23cc00c4c1aca26)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/mellanox/mlxsw/spectrum_router.c
diff --cc drivers/net/ethernet/mellanox/mlxsw/spectrum_router.c
index 336976120ae8,6612951b6911..000000000000
--- a/drivers/net/ethernet/mellanox/mlxsw/spectrum_router.c
+++ b/drivers/net/ethernet/mellanox/mlxsw/spectrum_router.c
@@@ -2865,10 -2867,13 +2865,14 @@@ enum mlxsw_sp_nexthop_group_type 
  };
  
  struct mlxsw_sp_nexthop_group {
- 	void *priv;
+ 	union {
+ 		struct {
+ 			struct fib_info *fi;
+ 		} ipv4;
+ 	};
  	struct rhash_head ht_node;
  	struct list_head fib_list; /* list of fib entries that use this group */
 +	struct neigh_table *neigh_tbl;
  	enum mlxsw_sp_nexthop_group_type type;
  	u8 adj_index_valid:1,
  	   gateway:1; /* routes using the group use a gateway */
@@@ -4094,17 -4096,15 +4092,21 @@@ mlxsw_sp_nexthop4_group_create(struct m
  	int i;
  	int err;
  
 -	nh_grp = kzalloc(struct_size(nh_grp, nexthops, nhs), GFP_KERNEL);
 +	nh_grp = kzalloc(struct_size(nh_grp, nexthops, fi->fib_nhs),
 +			 GFP_KERNEL);
  	if (!nh_grp)
  		return ERR_PTR(-ENOMEM);
- 	nh_grp->priv = fi;
  	INIT_LIST_HEAD(&nh_grp->fib_list);
 +	nh_grp->neigh_tbl = &arp_tbl;
  	nh_grp->type = MLXSW_SP_NEXTHOP_GROUP_TYPE_IPV4;
  
  	nh_grp->gateway = mlxsw_sp_fi_is_gateway(mlxsw_sp, fi);
++<<<<<<< HEAD
 +	nh_grp->count = fi->fib_nhs;
++=======
+ 	nh_grp->count = nhs;
+ 	nh_grp->ipv4.fi = fi;
++>>>>>>> 5a49dfe51f22 (mlxsw: spectrum_router: Move IPv4 FIB info into a union in nexthop group struct)
  	fib_info_hold(fi);
  	for (i = 0; i < nh_grp->count; i++) {
  		nh = &nh_grp->nexthops[i];
* Unmerged path drivers/net/ethernet/mellanox/mlxsw/spectrum_router.c
