mlxsw: spectrum_router: Associate neighbour table with nexthop instead of group

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-331.el8
commit-author Ido Schimmel <idosch@nvidia.com>
commit 02d8fdcad7cbaf4b786fbd694b62686ed8d8935b
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-331.el8/02d8fdca.failed

As explained in the previous patch, nexthop objects can have both IPv4
and IPv6 nexthops in the same group. Therefore, move the neighbour table
to be a property of the nexthop instead of the nexthop group.

	Signed-off-by: Ido Schimmel <idosch@nvidia.com>
	Reviewed-by: Jiri Pirko <jiri@nvidia.com>
	Signed-off-by: Jakub Kicinski <kuba@kernel.org>
(cherry picked from commit 02d8fdcad7cbaf4b786fbd694b62686ed8d8935b)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/mellanox/mlxsw/spectrum_router.c
diff --cc drivers/net/ethernet/mellanox/mlxsw/spectrum_router.c
index cb09fed063dd,462ddab11c07..000000000000
--- a/drivers/net/ethernet/mellanox/mlxsw/spectrum_router.c
+++ b/drivers/net/ethernet/mellanox/mlxsw/spectrum_router.c
@@@ -3965,7 -3965,8 +3963,12 @@@ static int mlxsw_sp_nexthop4_init(struc
  #else
  	nh->nh_weight = 1;
  #endif
++<<<<<<< HEAD
 +	memcpy(&nh->gw_addr, &fib_nh->nh_gw, sizeof(fib_nh->nh_gw));
++=======
+ 	memcpy(&nh->gw_addr, &fib_nh->fib_nh_gw4, sizeof(fib_nh->fib_nh_gw4));
+ 	nh->neigh_tbl = &arp_tbl;
++>>>>>>> 02d8fdcad7cb (mlxsw: spectrum_router: Associate neighbour table with nexthop instead of group)
  	err = mlxsw_sp_nexthop_insert(mlxsw_sp, nh);
  	if (err)
  		return err;
@@@ -5364,11 -5366,14 +5366,19 @@@ static int mlxsw_sp_nexthop6_init(struc
  				  struct mlxsw_sp_nexthop *nh,
  				  const struct fib6_info *rt)
  {
 -	struct net_device *dev = rt->fib6_nh->fib_nh_dev;
 +	struct net_device *dev = rt->fib6_nh.nh_dev;
  
  	nh->nh_grp = nh_grp;
++<<<<<<< HEAD
 +	nh->nh_weight = rt->fib6_nh.nh_weight;
 +	memcpy(&nh->gw_addr, &rt->fib6_nh.nh_gw, sizeof(nh->gw_addr));
++=======
+ 	nh->nh_weight = rt->fib6_nh->fib_nh_weight;
+ 	memcpy(&nh->gw_addr, &rt->fib6_nh->fib_nh_gw6, sizeof(nh->gw_addr));
+ #if IS_ENABLED(CONFIG_IPV6)
+ 	nh->neigh_tbl = &nd_tbl;
+ #endif
++>>>>>>> 02d8fdcad7cb (mlxsw: spectrum_router: Associate neighbour table with nexthop instead of group)
  	mlxsw_sp_nexthop_counter_alloc(mlxsw_sp, nh);
  
  	list_add_tail(&nh->router_list_node, &mlxsw_sp->router->nexthop_list);
* Unmerged path drivers/net/ethernet/mellanox/mlxsw/spectrum_router.c
