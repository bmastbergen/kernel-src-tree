stmmac: intel: Fix clock handling on error and remove paths

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-331.el8
commit-author Andy Shevchenko <andriy.shevchenko@linux.intel.com>
commit 09f012e64e4b8126ed6f02d0a85a57c3a0465cf9
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-331.el8/09f012e6.failed

clk_prepare_enable() might fail, we have to check its returned value.
Besides that we have to call clk_disable_unprepare() on the error and
remove paths. Do above in the dwmac-intel driver.

While at it, remove leftover in stmmac_pci and remove unneeded condition
for NULL-aware clk_unregister_fixed_rate() call.

Fixes: 58da0cfa6cf1 ("net: stmmac: create dwmac-intel.c to contain all Intel platform")
	Cc: Voon Weifeng <weifeng.voon@intel.com>
	Signed-off-by: Andy Shevchenko <andriy.shevchenko@linux.intel.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 09f012e64e4b8126ed6f02d0a85a57c3a0465cf9)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/stmicro/stmmac/dwmac-intel.c
#	drivers/net/ethernet/stmicro/stmmac/stmmac_pci.c
diff --cc drivers/net/ethernet/stmicro/stmmac/stmmac_pci.c
index a272b2f8bda7,272cb47af9f2..000000000000
--- a/drivers/net/ethernet/stmicro/stmmac/stmmac_pci.c
+++ b/drivers/net/ethernet/stmicro/stmmac/stmmac_pci.c
@@@ -543,10 -221,7 +541,14 @@@ static void stmmac_pci_remove(struct pc
  
  	stmmac_dvr_remove(&pdev->dev);
  
++<<<<<<< HEAD
 +	if (priv->plat->stmmac_clk)
 +		clk_unregister_fixed_rate(priv->plat->stmmac_clk);
 +
 +	for (i = 0; i <= PCI_STD_RESOURCE_END; i++) {
++=======
+ 	for (i = 0; i < PCI_STD_NUM_BARS; i++) {
++>>>>>>> 09f012e64e4b (stmmac: intel: Fix clock handling on error and remove paths)
  		if (pci_resource_len(pdev, i) == 0)
  			continue;
  		pcim_iounmap_regions(pdev, BIT(i));
* Unmerged path drivers/net/ethernet/stmicro/stmmac/dwmac-intel.c
* Unmerged path drivers/net/ethernet/stmicro/stmmac/dwmac-intel.c
* Unmerged path drivers/net/ethernet/stmicro/stmmac/stmmac_pci.c
