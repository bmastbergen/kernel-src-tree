cpufreq: intel_pstate: Fix active mode setting from command line

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-331.el8
commit-author Rafael J. Wysocki <rafael.j.wysocki@intel.com>
commit 39a188b88332545073b8e07633f5e3298e066b61
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-331.el8/39a188b8.failed

If intel_pstate starts in the passive mode by default (that happens
when the processor in the system doesn't support HWP), passing
intel_pstate=active in the kernel command line doesn't work, so
fix that.

Fixes: 33aa46f252c7 ("cpufreq: intel_pstate: Use passive mode by default without HWP")
	Reported-by: Doug Smythies <dsmythies@telus.net>
	Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>
	Acked-by: Doug Smythies <dsmythies@telus.net>
(cherry picked from commit 39a188b88332545073b8e07633f5e3298e066b61)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/cpufreq/intel_pstate.c
diff --cc drivers/cpufreq/intel_pstate.c
index fa89e8c3e3fd,7e0f7880b21a..000000000000
--- a/drivers/cpufreq/intel_pstate.c
+++ b/drivers/cpufreq/intel_pstate.c
@@@ -3071,12 -2758,7 +3071,16 @@@ static int __init intel_pstate_init(voi
  			hwp_active++;
  			hwp_mode_bdw = id->driver_data;
  			intel_pstate.attr = hwp_cpufreq_attrs;
++<<<<<<< HEAD
 +			intel_cpufreq.attr = hwp_cpufreq_attrs;
 +			intel_cpufreq.flags |= CPUFREQ_NEED_UPDATE_LIMITS;
 +			intel_cpufreq.adjust_perf = intel_cpufreq_adjust_perf;
 +			if (!default_driver)
 +				default_driver = &intel_pstate;
 +
++=======
+ 			default_driver = &intel_pstate;
++>>>>>>> 39a188b88332 (cpufreq: intel_pstate: Fix active mode setting from command line)
  			goto hwp_cpu_matched;
  		}
  	} else {
@@@ -3093,6 -2775,9 +3097,12 @@@
  		pr_info("Invalid MSRs\n");
  		return -ENODEV;
  	}
++<<<<<<< HEAD
++=======
+ 	/* Without HWP start in the passive mode. */
+ 	if (!default_driver)
+ 		default_driver = &intel_cpufreq;
++>>>>>>> 39a188b88332 (cpufreq: intel_pstate: Fix active mode setting from command line)
  
  hwp_cpu_matched:
  	/*
@@@ -3146,12 -2820,14 +3156,18 @@@ static int __init intel_pstate_setup(ch
  	if (!str)
  		return -EINVAL;
  
 -	if (!strcmp(str, "disable")) {
 +	if (!strcmp(str, "disable"))
  		no_load = 1;
++<<<<<<< HEAD
 +	else if (!strcmp(str, "passive"))
 +		pr_info("Passive mode enabled\n");
++=======
+ 	} else if (!strcmp(str, "active")) {
+ 		default_driver = &intel_pstate;
+ 	} else if (!strcmp(str, "passive")) {
++>>>>>>> 39a188b88332 (cpufreq: intel_pstate: Fix active mode setting from command line)
  		default_driver = &intel_cpufreq;
 -		no_hwp = 1;
 -	}
 +
  	if (!strcmp(str, "no_hwp")) {
  		pr_info("HWP disabled\n");
  		no_hwp = 1;
* Unmerged path drivers/cpufreq/intel_pstate.c
