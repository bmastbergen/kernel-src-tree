powerpc/numa: remove unreachable topology timer code

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-331.el8
commit-author Nathan Lynch <nathanl@linux.ibm.com>
commit 50e0cf3742a01e72f4ea4a8fe9221b152e22871b
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-331.el8/50e0cf37.failed

Since vphn_enabled is always 0, we can stub out
timed_topology_update() and remove the code which becomes unreachable.

	Signed-off-by: Nathan Lynch <nathanl@linux.ibm.com>
	Reviewed-by: Srikar Dronamraju <srikar@linux.vnet.ibm.com>
	Signed-off-by: Michael Ellerman <mpe@ellerman.id.au>
Link: https://lore.kernel.org/r/20200612051238.1007764-7-nathanl@linux.ibm.com
(cherry picked from commit 50e0cf3742a01e72f4ea4a8fe9221b152e22871b)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/powerpc/mm/numa.c
diff --cc arch/powerpc/mm/numa.c
index 25c8877a4b95,6207297490a8..000000000000
--- a/arch/powerpc/mm/numa.c
+++ b/arch/powerpc/mm/numa.c
@@@ -1197,9 -1129,6 +1197,12 @@@ struct topology_update_data 
  	int new_nid;
  };
  
++<<<<<<< HEAD
 +#define TOPOLOGY_DEF_TIMER_SECS	60
 +
 +static u8 vphn_cpu_change_counts[NR_CPUS][MAX_DISTANCE_REF_POINTS];
++=======
++>>>>>>> 50e0cf3742a0 (powerpc/numa: remove unreachable topology timer code)
  static cpumask_t cpu_associativity_changes_mask;
  static const int vphn_enabled;
  static const int prrn_enabled;
@@@ -1557,53 -1425,6 +1549,56 @@@ static void topology_schedule_update(vo
  	schedule_work(&topology_work);
  }
  
++<<<<<<< HEAD
 +static void topology_timer_fn(struct timer_list *unused)
 +{
 +	if (prrn_enabled && cpumask_weight(&cpu_associativity_changes_mask))
 +		topology_schedule_update();
 +	else if (vphn_enabled) {
 +		if (update_cpu_associativity_changes_mask() > 0)
 +			topology_schedule_update();
 +		reset_topology_timer();
 +	}
 +}
 +static struct timer_list topology_timer;
 +
 +static void reset_topology_timer(void)
 +{
 +	if (vphn_enabled)
 +		mod_timer(&topology_timer, jiffies + topology_timer_secs * HZ);
 +}
 +
 +#ifdef CONFIG_SMP
 +
 +static int dt_update_callback(struct notifier_block *nb,
 +				unsigned long action, void *data)
 +{
 +	struct of_reconfig_data *update = data;
 +	int rc = NOTIFY_DONE;
 +
 +	switch (action) {
 +	case OF_RECONFIG_UPDATE_PROPERTY:
 +		if (!of_prop_cmp(update->dn->type, "cpu") &&
 +		    !of_prop_cmp(update->prop->name, "ibm,associativity")) {
 +			u32 core_id;
 +			of_property_read_u32(update->dn, "reg", &core_id);
 +			rc = dlpar_cpu_readd(core_id);
 +			rc = NOTIFY_OK;
 +		}
 +		break;
 +	}
 +
 +	return rc;
 +}
 +
 +static struct notifier_block dt_update_nb = {
 +	.notifier_call = dt_update_callback,
 +};
 +
 +#endif
 +
++=======
++>>>>>>> 50e0cf3742a0 (powerpc/numa: remove unreachable topology timer code)
  /*
   * Start polling for associativity changes.
   */
* Unmerged path arch/powerpc/mm/numa.c
