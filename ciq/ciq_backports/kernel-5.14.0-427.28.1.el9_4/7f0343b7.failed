wifi: ath11k: restore country code during resume

jira LE-1907
Rebuild_History Non-Buildable kernel-5.14.0-427.28.1.el9_4
commit-author Baochen Qiang <quic_bqiang@quicinc.com>
commit 7f0343b7b8710436c1e6355c71782d32ada47e0c
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-5.14.0-427.28.1.el9_4/7f0343b7.failed

We got report that regdomain is not correct after
return from hibernation:

Before hibernation:
% iw reg get
[...]
phy#0 (self-managed)
country CH: DFS-ETSI
        (2402 - 2482 @ 40), (N/A, 20), (N/A)
        (5170 - 5250 @ 80), (N/A, 23), (N/A), NO-OUTDOOR, AUTO-BW
        (5250 - 5330 @ 80), (N/A, 23), (0 ms), NO-OUTDOOR, DFS, AUTO-BW
        (5490 - 5590 @ 80), (N/A, 30), (0 ms), DFS, AUTO-BW
        (5590 - 5650 @ 40), (N/A, 30), (600000 ms), DFS, AUTO-BW
        (5650 - 5730 @ 80), (N/A, 30), (0 ms), DFS, AUTO-BW
        (5735 - 5875 @ 80), (N/A, 14), (N/A), AUTO-BW

After hibernation:
% iw reg get
[...]
phy#0 (self-managed)
country na: DFS-UNSET
        (2402 - 2472 @ 40), (N/A, 20), (N/A)
        (2457 - 2482 @ 20), (N/A, 20), (N/A), PASSIVE-SCAN
        (5170 - 5330 @ 160), (N/A, 20), (N/A), AUTO-BW, PASSIVE-SCAN
        (5490 - 5730 @ 160), (N/A, 20), (N/A), AUTO-BW, PASSIVE-SCAN
        (5735 - 5895 @ 160), (N/A, 20), (N/A), AUTO-BW, PASSIVE-SCAN
        (5945 - 7125 @ 160), (N/A, 30), (N/A), AUTO-BW, PASSIVE-SCAN

The reason is, during resume, firmware is reinitialized but host does
not send current country code to firmware. So default reg rules with
country code set to 'na' is uploaded to host, as shown above.

Fix it by restoring country code to firmware during resume.

Tested-on: WCN6855 hw2.0 PCI WLAN.HSP.1.1-03125-QCAHSPSWPL_V1_V2_SILICONZ_LITE-3.6510.30

Fixes: 166a490f59ac ("wifi: ath11k: support hibernation")
	Signed-off-by: Baochen Qiang <quic_bqiang@quicinc.com>
	Signed-off-by: Kalle Valo <quic_kvalo@quicinc.com>
Link: https://msgid.link/20240520024148.5472-3-quic_bqiang@quicinc.com
(cherry picked from commit 7f0343b7b8710436c1e6355c71782d32ada47e0c)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/wireless/ath/ath11k/core.c
diff --cc drivers/net/wireless/ath/ath11k/core.c
index 9d8b4641f819,3772e64d4976..000000000000
--- a/drivers/net/wireless/ath/ath11k/core.c
+++ b/drivers/net/wireless/ath/ath11k/core.c
@@@ -846,29 -1002,29 +846,41 @@@ int ath11k_core_resume(struct ath11k_ba
  	if (!ar || ar->state != ATH11K_STATE_OFF)
  		return 0;
  
 -	time_left = wait_for_completion_timeout(&ab->restart_completed,
 -						ATH11K_RESET_TIMEOUT_HZ);
 -	if (time_left == 0) {
 -		ath11k_warn(ab, "timeout while waiting for restart complete");
 -		return -ETIMEDOUT;
 +	ret = ath11k_hif_resume(ab);
 +	if (ret) {
 +		ath11k_warn(ab, "failed to resume hif during resume: %d\n", ret);
 +		return ret;
  	}
  
++<<<<<<< HEAD
 +	ath11k_hif_ce_irq_enable(ab);
 +	ath11k_hif_irq_enable(ab);
++=======
+ 	if (ab->hw_params.current_cc_support &&
+ 	    ar->alpha2[0] != 0 && ar->alpha2[1] != 0) {
+ 		ret = ath11k_reg_set_cc(ar);
+ 		if (ret) {
+ 			ath11k_warn(ab, "failed to set country code during resume: %d\n",
+ 				    ret);
+ 			return ret;
+ 		}
+ 	}
++>>>>>>> 7f0343b7b871 (wifi: ath11k: restore country code during resume)
  
  	ret = ath11k_dp_rx_pktlog_start(ab);
 -	if (ret)
 +	if (ret) {
  		ath11k_warn(ab, "failed to start rx pktlog during resume: %d\n",
  			    ret);
 +		return ret;
 +	}
  
 -	return ret;
 +	ret = ath11k_wow_wakeup(ab);
 +	if (ret) {
 +		ath11k_warn(ab, "failed to wakeup wow during resume: %d\n", ret);
 +		return ret;
 +	}
 +
 +	return 0;
  }
  EXPORT_SYMBOL(ath11k_core_resume);
  
* Unmerged path drivers/net/wireless/ath/ath11k/core.c
