kasan: rename CONFIG_TEST_KASAN_MODULE

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-365.el8
commit-author Andrey Konovalov <andreyknvl@google.com>
commit 5d92bdffd2d53f98de683229c0ad7d028703fdba
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-365.el8/5d92bdff.failed

Rename CONFIG_TEST_KASAN_MODULE to CONFIG_KASAN_MODULE_TEST.

This naming is more consistent with the existing CONFIG_KASAN_KUNIT_TEST.

Link: https://linux-review.googlesource.com/id/Id347dfa5fe8788b7a1a189863e039f409da0ae5f
Link: https://lkml.kernel.org/r/f08250246683981bcf8a094fbba7c361995624d2.1610733117.git.andreyknvl@google.com
	Signed-off-by: Andrey Konovalov <andreyknvl@google.com>
	Reviewed-by: Marco Elver <elver@google.com>
	Reviewed-by: Alexander Potapenko <glider@google.com>
	Cc: Andrey Ryabinin <aryabinin@virtuozzo.com>
	Cc: Branislav Rankov <Branislav.Rankov@arm.com>
	Cc: Catalin Marinas <catalin.marinas@arm.com>
	Cc: Dmitry Vyukov <dvyukov@google.com>
	Cc: Evgenii Stepanov <eugenis@google.com>
	Cc: Kevin Brodsky <kevin.brodsky@arm.com>
	Cc: Peter Collingbourne <pcc@google.com>
	Cc: Vincenzo Frascino <vincenzo.frascino@arm.com>
	Cc: Will Deacon <will.deacon@arm.com>
	Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
	Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
(cherry picked from commit 5d92bdffd2d53f98de683229c0ad7d028703fdba)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	Documentation/dev-tools/kasan.rst
#	lib/Kconfig.kasan
#	lib/Makefile
diff --cc Documentation/dev-tools/kasan.rst
index 19b982c535c7,cde14aeefca7..000000000000
--- a/Documentation/dev-tools/kasan.rst
+++ b/Documentation/dev-tools/kasan.rst
@@@ -282,17 -358,24 +282,33 @@@ unmapped. This will require changes in 
  This allows ``VMAP_STACK`` support on x86, and can simplify support of
  architectures that do not have a fixed module region.
  
- CONFIG_KASAN_KUNIT_TEST & CONFIG_TEST_KASAN_MODULE
- --------------------------------------------------
+ CONFIG_KASAN_KUNIT_TEST and CONFIG_KASAN_MODULE_TEST
+ ----------------------------------------------------
  
++<<<<<<< HEAD
 +``CONFIG_KASAN_KUNIT_TEST`` utilizes the KUnit Test Framework for testing.
 +This means each test focuses on a small unit of functionality and
 +there are a few ways these tests can be run.
++=======
+ KASAN tests consist of two parts:
++>>>>>>> 5d92bdffd2d5 (kasan: rename CONFIG_TEST_KASAN_MODULE)
  
 -1. Tests that are integrated with the KUnit Test Framework. Enabled with
 -``CONFIG_KASAN_KUNIT_TEST``. These tests can be run and partially verified
 -automatically in a few different ways, see the instructions below.
 +Each test will print the KASAN report if an error is detected and then
 +print the number of the test and the status of the test:
  
++<<<<<<< HEAD
 +pass::
++=======
+ 2. Tests that are currently incompatible with KUnit. Enabled with
+ ``CONFIG_KASAN_MODULE_TEST`` and can only be run as a module. These tests can
+ only be verified manually, by loading the kernel module and inspecting the
+ kernel log for KASAN reports.
+ 
+ Each KUnit-compatible KASAN test prints a KASAN report if an error is detected.
+ Then the test prints its number and status.
+ 
+ When a test passes::
++>>>>>>> 5d92bdffd2d5 (kasan: rename CONFIG_TEST_KASAN_MODULE)
  
          ok 28 - kmalloc_double_kzfree
  
diff --cc lib/Kconfig.kasan
index d2430e949a1c,624ae1df7984..000000000000
--- a/lib/Kconfig.kasan
+++ b/lib/Kconfig.kasan
@@@ -188,12 -180,24 +188,26 @@@ config KASAN_VMALLO
  	  for KASAN to detect more sorts of errors (and to support vmapped
  	  stacks), but at the cost of higher memory usage.
  
 -config KASAN_KUNIT_TEST
 -	tristate "KUnit-compatible tests of KASAN bug detection capabilities" if !KUNIT_ALL_TESTS
 -	depends on KASAN && KUNIT
 -	default KUNIT_ALL_TESTS
 +config TEST_KASAN
 +	tristate "Module for testing KASAN for bug detection"
 +	depends on m
  	help
 -	  This is a KUnit test suite doing various nasty things like
 -	  out of bounds and use after free accesses. It is useful for testing
 +	  This is a test module doing various nasty things like
 +	  out of bounds accesses, use after free. It is useful for testing
  	  kernel debugging features like KASAN.
  
++<<<<<<< HEAD
++=======
+ 	  For more information on KUnit and unit tests in general, please refer
+ 	  to the KUnit documentation in Documentation/dev-tools/kunit.
+ 
+ config KASAN_MODULE_TEST
+ 	tristate "KUnit-incompatible tests of KASAN bug detection capabilities"
+ 	depends on m && KASAN && !KASAN_HW_TAGS
+ 	help
+ 	  This is a part of the KASAN test suite that is incompatible with
+ 	  KUnit. Currently includes tests that do bad copy_from/to_user
+ 	  accesses.
+ 
++>>>>>>> 5d92bdffd2d5 (kasan: rename CONFIG_TEST_KASAN_MODULE)
  endif # KASAN
diff --cc lib/Makefile
index bb1847ed69d0,b5307d3eec1a..000000000000
--- a/lib/Makefile
+++ b/lib/Makefile
@@@ -64,9 -61,15 +64,15 @@@ obj-$(CONFIG_TEST_FIRMWARE) += test_fir
  obj-$(CONFIG_TEST_SYSCTL) += test_sysctl.o
  obj-$(CONFIG_TEST_HASH) += test_hash.o test_siphash.o
  obj-$(CONFIG_TEST_IDA) += test_ida.o
 -obj-$(CONFIG_KASAN_KUNIT_TEST) += test_kasan.o
 +obj-$(CONFIG_TEST_KASAN) += test_kasan.o
  CFLAGS_test_kasan.o += -fno-builtin
++<<<<<<< HEAD
++=======
+ CFLAGS_test_kasan.o += $(call cc-disable-warning, vla)
+ obj-$(CONFIG_KASAN_MODULE_TEST) += test_kasan_module.o
+ CFLAGS_test_kasan_module.o += -fno-builtin
++>>>>>>> 5d92bdffd2d5 (kasan: rename CONFIG_TEST_KASAN_MODULE)
  obj-$(CONFIG_TEST_UBSAN) += test_ubsan.o
 -CFLAGS_test_ubsan.o += $(call cc-disable-warning, vla)
  UBSAN_SANITIZE_test_ubsan.o := y
  obj-$(CONFIG_TEST_KSTRTOX) += test-kstrtox.o
  obj-$(CONFIG_TEST_LIST_SORT) += test_list_sort.o
* Unmerged path Documentation/dev-tools/kasan.rst
* Unmerged path lib/Kconfig.kasan
* Unmerged path lib/Makefile
