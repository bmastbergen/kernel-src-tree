drm/i915/fb: Factor out functions to remap contiguous FB obj pages

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-365.el8
commit-author Imre Deak <imre.deak@intel.com>
commit dd5ba4ff4e924b14cb3c91335636baa6bacaf817
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-365.el8/dd5ba4ff.failed

Factor out functions needed to map contiguous FB obj pages to a GTT/DPT
VMA view in the next patch.

While at it s/4096/I915_GTT_PAGE_SIZE/ in add_padding_pages().

No functional changes.

v2: s/4096/I915_GTT_PAGE_SIZE/ (Matthew)

	Signed-off-by: Imre Deak <imre.deak@intel.com>
	Reviewed-by: Matthew Auld <matthew.auld@intel.com>
	Reviewed-by: Juha-Pekka Heikkila <juhapekka.heikkila@gmail.com>
Link: https://patchwork.freedesktop.org/patch/msgid/20211026225105.2783797-4-imre.deak@intel.com
(cherry picked from commit dd5ba4ff4e924b14cb3c91335636baa6bacaf817)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/gpu/drm/i915/gt/intel_ggtt.c
diff --cc drivers/gpu/drm/i915/gt/intel_ggtt.c
index 700588bc9d57,d2f45bca05d1..000000000000
--- a/drivers/gpu/drm/i915/gt/intel_ggtt.c
+++ b/drivers/gpu/drm/i915/gt/intel_ggtt.c
@@@ -1317,13 -1388,39 +1317,46 @@@ err_st_alloc
  }
  
  static struct scatterlist *
++<<<<<<< HEAD
 +remap_pages(struct drm_i915_gem_object *obj, unsigned int offset,
++=======
+ add_padding_pages(unsigned int count,
+ 		  struct sg_table *st, struct scatterlist *sg)
+ {
+ 	st->nents++;
+ 
+ 	/*
+ 	 * The DE ignores the PTEs for the padding tiles, the sg entry
+ 	 * here is just a convenience to indicate how many padding PTEs
+ 	 * to insert at this spot.
+ 	 */
+ 	sg_set_page(sg, NULL, count * I915_GTT_PAGE_SIZE, 0);
+ 	sg_dma_address(sg) = 0;
+ 	sg_dma_len(sg) = count * I915_GTT_PAGE_SIZE;
+ 	sg = sg_next(sg);
+ 
+ 	return sg;
+ }
+ 
+ static struct scatterlist *
+ remap_pages(struct drm_i915_gem_object *obj,
+ 	    unsigned int offset, unsigned int alignment_pad,
++>>>>>>> dd5ba4ff4e92 (drm/i915/fb: Factor out functions to remap contiguous FB obj pages)
  	    unsigned int width, unsigned int height,
 -	    unsigned int src_stride, unsigned int dst_stride,
 +	    unsigned int stride,
  	    struct sg_table *st, struct scatterlist *sg)
  {
  	unsigned int row;
  
++<<<<<<< HEAD
++=======
+ 	if (!width || !height)
+ 		return sg;
+ 
+ 	if (alignment_pad)
+ 		sg = add_padding_pages(alignment_pad, st, sg);
+ 
++>>>>>>> dd5ba4ff4e92 (drm/i915/fb: Factor out functions to remap contiguous FB obj pages)
  	for (row = 0; row < height; row++) {
  		unsigned int left = width * I915_GTT_PAGE_SIZE;
  
@@@ -1352,7 -1449,14 +1385,18 @@@
  			left -= length;
  		}
  
++<<<<<<< HEAD
 +		offset += stride - width;
++=======
+ 		offset += src_stride - width;
+ 
+ 		left = (dst_stride - width) * I915_GTT_PAGE_SIZE;
+ 
+ 		if (!left)
+ 			continue;
+ 
+ 		sg = add_padding_pages(left >> PAGE_SHIFT, st, sg);
++>>>>>>> dd5ba4ff4e92 (drm/i915/fb: Factor out functions to remap contiguous FB obj pages)
  	}
  
  	return sg;
* Unmerged path drivers/gpu/drm/i915/gt/intel_ggtt.c
