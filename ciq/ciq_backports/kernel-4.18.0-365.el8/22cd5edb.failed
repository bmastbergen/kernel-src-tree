arm64: Use simpler arithmetics for the linear map macros

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-365.el8
commit-author Catalin Marinas <catalin.marinas@arm.com>
commit 22cd5edb2d9c6d68b6ac0fc9584104d88710fa57
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-365.el8/22cd5edb.failed

Because of the tagged addresses, the __is_lm_address() and
__lm_to_phys() macros grew to some harder to understand bitwise
operations using PAGE_OFFSET. Since these macros only accept untagged
addresses, use a simple subtract operation.

	Signed-off-by: Catalin Marinas <catalin.marinas@arm.com>
	Acked-by: Ard Biesheuvel <ardb@kernel.org>
	Cc: Will Deacon <will@kernel.org>
	Cc: Mark Rutland <mark.rutland@arm.com>
Link: https://lore.kernel.org/r/20210201190634.22942-3-catalin.marinas@arm.com
(cherry picked from commit 22cd5edb2d9c6d68b6ac0fc9584104d88710fa57)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/arm64/include/asm/memory.h
diff --cc arch/arm64/include/asm/memory.h
index 630eaf618e50,ff4732785c32..000000000000
--- a/arch/arm64/include/asm/memory.h
+++ b/arch/arm64/include/asm/memory.h
@@@ -268,13 -247,13 +268,17 @@@ static inline const void *__tag_set(con
  
  
  /*
 - * Check whether an arbitrary address is within the linear map, which
 - * lives in the [PAGE_OFFSET, PAGE_END) interval at the bottom of the
 - * kernel's TTBR1 address range.
 + * The linear kernel range starts in the middle of the virtual adddress
 + * space. Testing the top bit for the start of the region is a
 + * sufficient check.
   */
++<<<<<<< HEAD
 +#define __is_lm_address(addr)	(!((addr) & BIT(VA_BITS - 1)))
++=======
+ #define __is_lm_address(addr)	(((u64)(addr) - PAGE_OFFSET) < (PAGE_END - PAGE_OFFSET))
++>>>>>>> 22cd5edb2d9c (arm64: Use simpler arithmetics for the linear map macros)
  
- #define __lm_to_phys(addr)	(((addr) & ~PAGE_OFFSET) + PHYS_OFFSET)
+ #define __lm_to_phys(addr)	(((addr) - PAGE_OFFSET) + PHYS_OFFSET)
  #define __kimg_to_phys(addr)	((addr) - kimage_voffset)
  
  #define __virt_to_phys_nodebug(x) ({					\
* Unmerged path arch/arm64/include/asm/memory.h
