igc: use XDP helpers

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-365.el8
commit-author Matteo Croce <mcroce@microsoft.com>
commit 082294f294f6de4b50be0af354adb83e45816db4
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-365.el8/082294f2.failed

Make use of the xdp_{init,prepare}_buff() helpers instead of
an open-coded version.

	Signed-off-by: Matteo Croce <mcroce@microsoft.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 082294f294f6de4b50be0af354adb83e45816db4)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/intel/igc/igc_main.c
diff --cc drivers/net/ethernet/intel/igc/igc_main.c
index 261f28037c1a,92c0701e2a36..000000000000
--- a/drivers/net/ethernet/intel/igc/igc_main.c
+++ b/drivers/net/ethernet/intel/igc/igc_main.c
@@@ -1928,8 -2150,31 +1928,36 @@@ static int igc_clean_rx_irq(struct igc_
  			size -= IGC_TS_HDR_LEN;
  		}
  
++<<<<<<< HEAD
 +		/* retrieve a buffer from the ring */
 +		if (skb)
++=======
+ 		if (!skb) {
+ 			xdp_init_buff(&xdp, truesize, &rx_ring->xdp_rxq);
+ 			xdp_prepare_buff(&xdp, pktbuf - igc_rx_offset(rx_ring),
+ 					 igc_rx_offset(rx_ring) + pkt_offset, size, false);
+ 
+ 			skb = igc_xdp_run_prog(adapter, &xdp);
+ 		}
+ 
+ 		if (IS_ERR(skb)) {
+ 			unsigned int xdp_res = -PTR_ERR(skb);
+ 
+ 			switch (xdp_res) {
+ 			case IGC_XDP_CONSUMED:
+ 				rx_buffer->pagecnt_bias++;
+ 				break;
+ 			case IGC_XDP_TX:
+ 			case IGC_XDP_REDIRECT:
+ 				igc_rx_buffer_flip(rx_buffer, truesize);
+ 				xdp_status |= xdp_res;
+ 				break;
+ 			}
+ 
+ 			total_packets++;
+ 			total_bytes += size;
+ 		} else if (skb)
++>>>>>>> 082294f294f6 (igc: use XDP helpers)
  			igc_add_rx_frag(rx_ring, rx_buffer, skb, size);
  		else if (ring_uses_build_skb(rx_ring))
  			skb = igc_build_skb(rx_ring, rx_buffer, rx_desc, size);
* Unmerged path drivers/net/ethernet/intel/igc/igc_main.c
