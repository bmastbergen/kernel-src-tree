sock_map: Simplify sock_map_link() a bit

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-365.el8
commit-author Cong Wang <cong.wang@bytedance.com>
commit 2004fdbd8a2b56757691717639f86d0eea3ab5b4
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-365.el8/2004fdbd.failed

sock_map_link() passes down map progs, but it is confusing
to see both map progs and psock progs. Make the map progs
more obvious by retrieving it directly with sock_map_progs()
inside sock_map_link(). Now it is aligned with
sock_map_link_no_progs() too.

	Signed-off-by: Cong Wang <cong.wang@bytedance.com>
	Signed-off-by: Alexei Starovoitov <ast@kernel.org>
	Acked-by: John Fastabend <john.fastabend@gmail.com>
Link: https://lore.kernel.org/bpf/20210331023237.41094-8-xiyou.wangcong@gmail.com
(cherry picked from commit 2004fdbd8a2b56757691717639f86d0eea3ab5b4)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/core/sock_map.c
diff --cc net/core/sock_map.c
index f2963865e78e,d06face0f16c..000000000000
--- a/net/core/sock_map.c
+++ b/net/core/sock_map.c
@@@ -26,6 -24,10 +26,13 @@@ struct bpf_stab 
  #define SOCK_CREATE_FLAG_MASK				\
  	(BPF_F_NUMA_NODE | BPF_F_RDONLY | BPF_F_WRONLY)
  
++<<<<<<< HEAD
++=======
+ static int sock_map_prog_update(struct bpf_map *map, struct bpf_prog *prog,
+ 				struct bpf_prog *old, u32 which);
+ static struct sk_psock_progs *sock_map_progs(struct bpf_map *map);
+ 
++>>>>>>> 2004fdbd8a2b (sock_map: Simplify sock_map_link() a bit)
  static struct bpf_map *sock_map_alloc(union bpf_attr *attr)
  {
  	struct bpf_stab *stab;
@@@ -225,10 -225,10 +232,14 @@@ out
  	return psock;
  }
  
- static int sock_map_link(struct bpf_map *map, struct sk_psock_progs *progs,
- 			 struct sock *sk)
+ static int sock_map_link(struct bpf_map *map, struct sock *sk)
  {
++<<<<<<< HEAD
 +	struct bpf_prog *msg_parser, *skb_parser, *skb_verdict;
++=======
+ 	struct bpf_prog *msg_parser, *stream_parser, *stream_verdict;
+ 	struct sk_psock_progs *progs = sock_map_progs(map);
++>>>>>>> 2004fdbd8a2b (sock_map: Simplify sock_map_link() a bit)
  	struct sk_psock *psock;
  	int ret;
  
* Unmerged path net/core/sock_map.c
