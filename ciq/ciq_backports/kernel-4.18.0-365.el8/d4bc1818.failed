drm/i915/display/adl_p: Correctly program MBUS DBOX A credits

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-365.el8
commit-author José Roberto de Souza <jose.souza@intel.com>
commit d4bc18183ee1453e550a3f4cbec0c1ea15999e61
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-365.el8/d4bc1818.failed

Alderlake-P have different values for MBUS DBOX A credits depending
if MBUS join is enabled or not.

BSpec: 50343
BSpec: 54369
	Cc: Matt Atwood <matthew.s.atwood@intel.com>
	Signed-off-by: José Roberto de Souza <jose.souza@intel.com>
	Reviewed-by: Matt Roper <matthew.d.roper@intel.com>
Link: https://patchwork.freedesktop.org/patch/msgid/20210708211827.288601-6-jose.souza@intel.com
(cherry picked from commit d4bc18183ee1453e550a3f4cbec0c1ea15999e61)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/gpu/drm/i915/display/intel_display.c
diff --cc drivers/gpu/drm/i915/display/intel_display.c
index 105a65e966a7,122f091e0a1e..000000000000
--- a/drivers/gpu/drm/i915/display/intel_display.c
+++ b/drivers/gpu/drm/i915/display/intel_display.c
@@@ -5392,9 -3448,13 +5392,13 @@@ static void icl_pipe_mbus_enable(struc
  	enum pipe pipe = crtc->pipe;
  	u32 val;
  
- 	val = MBUS_DBOX_A_CREDIT(2);
+ 	/* Wa_22010947358:adl-p */
+ 	if (IS_ALDERLAKE_P(dev_priv))
+ 		val = joined_mbus ? MBUS_DBOX_A_CREDIT(6) : MBUS_DBOX_A_CREDIT(4);
+ 	else
+ 		val = MBUS_DBOX_A_CREDIT(2);
  
 -	if (DISPLAY_VER(dev_priv) >= 12) {
 +	if (INTEL_GEN(dev_priv) >= 12) {
  		val |= MBUS_DBOX_BW_CREDIT(2);
  		val |= MBUS_DBOX_B_CREDIT(12);
  	} else {
@@@ -5543,13 -3608,15 +5547,22 @@@ static void hsw_crtc_enable(struct inte
  	if (dev_priv->display.initial_watermarks)
  		dev_priv->display.initial_watermarks(state, crtc);
  
++<<<<<<< HEAD
 +	if (INTEL_GEN(dev_priv) >= 11)
 +		icl_pipe_mbus_enable(crtc);
++=======
+ 	if (DISPLAY_VER(dev_priv) >= 11) {
+ 		const struct intel_dbuf_state *dbuf_state =
+ 				intel_atomic_get_new_dbuf_state(state);
+ 
+ 		icl_pipe_mbus_enable(crtc, dbuf_state->joined_mbus);
+ 	}
++>>>>>>> d4bc18183ee1 (drm/i915/display/adl_p: Correctly program MBUS DBOX A credits)
  
 -	if (new_crtc_state->bigjoiner_slave)
 +	if (new_crtc_state->bigjoiner_slave) {
 +		trace_intel_pipe_enable(crtc);
  		intel_crtc_vblank_on(new_crtc_state);
 +	}
  
  	intel_encoders_enable(state, crtc);
  
* Unmerged path drivers/gpu/drm/i915/display/intel_display.c
