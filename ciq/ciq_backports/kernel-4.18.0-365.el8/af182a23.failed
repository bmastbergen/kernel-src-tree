drm/i915: add HAS_ASYNC_FLIPS feature macro

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-365.el8
commit-author Jani Nikula <jani.nikula@intel.com>
commit af182a236a142965fc6de7e48fd1c92a3607f5bd
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-365.el8/af182a23.failed

This will be needed in multiple places soon.

	Reviewed-by: Rodrigo Vivi <rodrigo.vivi@intel.com>
	Signed-off-by: Jani Nikula <jani.nikula@intel.com>
Link: https://patchwork.freedesktop.org/patch/msgid/08bf0f72435a4f9acb0ef31b82ca312b048c6bf6.1629721467.git.jani.nikula@intel.com
(cherry picked from commit af182a236a142965fc6de7e48fd1c92a3607f5bd)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/gpu/drm/i915/display/intel_display.c
diff --cc drivers/gpu/drm/i915/display/intel_display.c
index 19f6e7572c75,d93a2d675ae2..000000000000
--- a/drivers/gpu/drm/i915/display/intel_display.c
+++ b/drivers/gpu/drm/i915/display/intel_display.c
@@@ -1321,11 -977,6 +1321,14 @@@ static unsigned int intel_linear_alignm
  		return 0;
  }
  
++<<<<<<< HEAD
 +static bool has_async_flips(struct drm_i915_private *i915)
 +{
 +	return INTEL_GEN(i915) >= 5;
 +}
 +
++=======
++>>>>>>> af182a236a14 (drm/i915: add HAS_ASYNC_FLIPS feature macro)
  unsigned int intel_surf_alignment(const struct drm_framebuffer *fb,
  				  int color_plane)
  {
@@@ -14803,11 -12154,9 +14806,11 @@@ static void intel_mode_config_init(stru
  	mode_config->preferred_depth = 24;
  	mode_config->prefer_shadow = 1;
  
 +	mode_config->allow_fb_modifiers = true;
 +
  	mode_config->funcs = &intel_mode_funcs;
  
- 	mode_config->async_page_flip = has_async_flips(i915);
+ 	mode_config->async_page_flip = HAS_ASYNC_FLIPS(i915);
  
  	/*
  	 * Maximum framebuffer dimensions, chosen to match
* Unmerged path drivers/gpu/drm/i915/display/intel_display.c
diff --git a/drivers/gpu/drm/i915/i915_drv.h b/drivers/gpu/drm/i915/i915_drv.h
index 886740d42b42..b3e8715daf69 100644
--- a/drivers/gpu/drm/i915/i915_drv.h
+++ b/drivers/gpu/drm/i915/i915_drv.h
@@ -1723,6 +1723,8 @@ IS_SUBPLATFORM(const struct drm_i915_private *i915,
 
 #define HAS_VRR(i915)	(INTEL_GEN(i915) >= 12)
 
+#define HAS_ASYNC_FLIPS(i915)		(DISPLAY_VER(i915) >= 5)
+
 /* Only valid when HAS_DISPLAY() is true */
 #define INTEL_DISPLAY_ENABLED(dev_priv) \
 	(drm_WARN_ON(&(dev_priv)->drm, !HAS_DISPLAY(dev_priv)), !(dev_priv)->params.disable_display)
