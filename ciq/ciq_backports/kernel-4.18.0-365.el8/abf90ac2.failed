bnxt_en: Log if an invalid signal detected on TSIO pin

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-365.el8
commit-author Pavan Chebbi <pavan.chebbi@broadcom.com>
commit abf90ac2c292410c22bbce4dfedeb49b9b0295ff
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-365.el8/abf90ac2.failed

FW can report to driver via ASYNC event if it encountered an
invalid signal on any TSIO PIN. Driver will log this event
for the user to take corrective action.

	Reviewed-by: Somnath Kotur <somnath.kotur@broadcom.com>
	Reviewed-by: Arvind Susarla <arvind.susarla@broadcom.com>
	Reviewed-by: Edwin Peer <edwin.peer@broadcom.com>
	Signed-off-by: Pavan Chebbi <pavan.chebbi@broadcom.com>
	Signed-off-by: Michael Chan <michael.chan@broadcom.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit abf90ac2c292410c22bbce4dfedeb49b9b0295ff)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/broadcom/bnxt/bnxt.c
diff --cc drivers/net/ethernet/broadcom/bnxt/bnxt.c
index df2601759f4a,4a92ea7fa7d2..000000000000
--- a/drivers/net/ethernet/broadcom/bnxt/bnxt.c
+++ b/drivers/net/ethernet/broadcom/bnxt/bnxt.c
@@@ -278,6 -277,8 +278,11 @@@ static const u16 bnxt_async_events_arr[
  	ASYNC_EVENT_CMPL_EVENT_ID_DEBUG_NOTIFICATION,
  	ASYNC_EVENT_CMPL_EVENT_ID_RING_MONITOR_MSG,
  	ASYNC_EVENT_CMPL_EVENT_ID_ECHO_REQUEST,
++<<<<<<< HEAD
++=======
+ 	ASYNC_EVENT_CMPL_EVENT_ID_PPS_TIMESTAMP,
+ 	ASYNC_EVENT_CMPL_EVENT_ID_ERROR_REPORT,
++>>>>>>> abf90ac2c292 (bnxt_en: Log if an invalid signal detected on TSIO pin)
  };
  
  static struct workqueue_struct *bnxt_pf_wq;
@@@ -2203,6 -2217,14 +2221,17 @@@ static int bnxt_async_event_process(str
  		}
  		goto async_event_process_exit;
  	}
++<<<<<<< HEAD
++=======
+ 	case ASYNC_EVENT_CMPL_EVENT_ID_PPS_TIMESTAMP: {
+ 		bnxt_ptp_pps_event(bp, data1, data2);
+ 		goto async_event_process_exit;
+ 	}
+ 	case ASYNC_EVENT_CMPL_EVENT_ID_ERROR_REPORT: {
+ 		bnxt_event_error_report(bp, data1, data2);
+ 		goto async_event_process_exit;
+ 	}
++>>>>>>> abf90ac2c292 (bnxt_en: Log if an invalid signal detected on TSIO pin)
  	default:
  		goto async_event_process_exit;
  	}
* Unmerged path drivers/net/ethernet/broadcom/bnxt/bnxt.c
diff --git a/drivers/net/ethernet/broadcom/bnxt/bnxt.h b/drivers/net/ethernet/broadcom/bnxt/bnxt.h
index 660ce7fc0d26..30465e287ce4 100644
--- a/drivers/net/ethernet/broadcom/bnxt/bnxt.h
+++ b/drivers/net/ethernet/broadcom/bnxt/bnxt.h
@@ -493,6 +493,16 @@ struct rx_tpa_end_cmp_ext {
 	!!((data1) &							\
 	   ASYNC_EVENT_CMPL_ERROR_RECOVERY_EVENT_DATA1_FLAGS_RECOVERY_ENABLED)
 
+#define BNXT_EVENT_ERROR_REPORT_TYPE(data1)				\
+	(((data1) &							\
+	  ASYNC_EVENT_CMPL_ERROR_REPORT_BASE_EVENT_DATA1_ERROR_TYPE_MASK) >>\
+	 ASYNC_EVENT_CMPL_ERROR_REPORT_BASE_EVENT_DATA1_ERROR_TYPE_SFT)
+
+#define BNXT_EVENT_INVALID_SIGNAL_DATA(data2)				\
+	(((data2) &							\
+	  ASYNC_EVENT_CMPL_ERROR_REPORT_INVALID_SIGNAL_EVENT_DATA2_PIN_ID_MASK) >>\
+	 ASYNC_EVENT_CMPL_ERROR_REPORT_INVALID_SIGNAL_EVENT_DATA2_PIN_ID_SFT)
+
 struct nqe_cn {
 	__le16	type;
 	#define NQ_CN_TYPE_MASK           0x3fUL
