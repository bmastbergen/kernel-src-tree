platform/x86: dell-wmi-sysman: Use firmware_attributes_class helper

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-365.el8
commit-author Mark Pearson <markpearson@lenovo.com>
commit 8a1c379c5a03281295c436faf21b0e4716e5b8a8
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-365.el8/8a1c379c.failed

Update Dell WMI sysman driver to use newly implemented helper module.

	Reviewed-by: Hans de Goede <hdegoede@redhat.com>
	Signed-off-by: Mark Pearson <markpearson@lenovo.com>
Link: https://lore.kernel.org/r/20210530223111.25929-2-markpearson@lenovo.com
	Signed-off-by: Hans de Goede <hdegoede@redhat.com>
(cherry picked from commit 8a1c379c5a03281295c436faf21b0e4716e5b8a8)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/platform/x86/dell-wmi-sysman/sysman.c
#	drivers/platform/x86/dell/Kconfig
diff --cc drivers/platform/x86/dell-wmi-sysman/sysman.c
index cb81010ba1a2,1378c1878658..000000000000
--- a/drivers/platform/x86/dell-wmi-sysman/sysman.c
+++ b/drivers/platform/x86/dell-wmi-sysman/sysman.c
@@@ -513,22 -527,24 +511,22 @@@ static int __init sysman_init(void
  	}
  
  	ret = init_bios_attr_set_interface();
 -	if (ret)
 -		return ret;
 +	if (ret || !wmi_priv.bios_attr_wdev) {
 +		pr_debug("failed to initialize set interface\n");
 +		goto fail_set_interface;
 +	}
  
  	ret = init_bios_attr_pass_interface();
 -	if (ret)
 -		goto err_exit_bios_attr_set_interface;
 -
 -	if (!wmi_priv.bios_attr_wdev || !wmi_priv.password_attr_wdev) {
 -		pr_debug("failed to find set or pass interface\n");
 -		ret = -ENODEV;
 -		goto err_exit_bios_attr_pass_interface;
 +	if (ret || !wmi_priv.password_attr_wdev) {
 +		pr_debug("failed to initialize pass interface\n");
 +		goto fail_pass_interface;
  	}
  
- 	ret = class_register(&firmware_attributes_class);
+ 	ret = fw_attributes_class_get(&fw_attr_class);
  	if (ret)
 -		goto err_exit_bios_attr_pass_interface;
 +		goto fail_class;
  
- 	wmi_priv.class_dev = device_create(&firmware_attributes_class, NULL, MKDEV(0, 0),
+ 	wmi_priv.class_dev = device_create(fw_attr_class, NULL, MKDEV(0, 0),
  				  NULL, "%s", DRIVER_NAME);
  	if (IS_ERR(wmi_priv.class_dev)) {
  		ret = PTR_ERR(wmi_priv.class_dev);
@@@ -581,34 -597,21 +579,42 @@@
  
  	return 0;
  
 -err_release_attributes_data:
 +fail_create_group:
  	release_attributes_data();
  
++<<<<<<< HEAD:drivers/platform/x86/dell-wmi-sysman/sysman.c
 +fail_reset_bios:
 +	if (wmi_priv.authentication_dir_kset) {
 +		kset_unregister(wmi_priv.authentication_dir_kset);
 +		wmi_priv.authentication_dir_kset = NULL;
 +	}
 +
 +fail_authentication_kset:
 +	if (wmi_priv.main_dir_kset) {
 +		kset_unregister(wmi_priv.main_dir_kset);
 +		wmi_priv.main_dir_kset = NULL;
 +	}
 +
 +fail_main_kset:
 +	device_destroy(&firmware_attributes_class, MKDEV(0, 0));
 +
 +fail_classdev:
 +	class_unregister(&firmware_attributes_class);
++=======
+ err_destroy_classdev:
+ 	device_destroy(fw_attr_class, MKDEV(0, 0));
+ 
+ err_unregister_class:
+ 	fw_attributes_class_put();
++>>>>>>> 8a1c379c5a03 (platform/x86: dell-wmi-sysman: Use firmware_attributes_class helper):drivers/platform/x86/dell/dell-wmi-sysman/sysman.c
  
 -err_exit_bios_attr_pass_interface:
 +fail_class:
  	exit_bios_attr_pass_interface();
  
 -err_exit_bios_attr_set_interface:
 +fail_pass_interface:
  	exit_bios_attr_set_interface();
  
 +fail_set_interface:
  	return ret;
  }
  
* Unmerged path drivers/platform/x86/dell/Kconfig
* Unmerged path drivers/platform/x86/dell-wmi-sysman/sysman.c
* Unmerged path drivers/platform/x86/dell/Kconfig
