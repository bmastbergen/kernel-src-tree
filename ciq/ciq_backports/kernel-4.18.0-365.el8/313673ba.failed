KVM: arm64: selftests: get-reg-list: Split base and pmu registers

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-365.el8
commit-author Andrew Jones <drjones@redhat.com>
commit 313673bad871750c0c829def53d037868af75b67
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-365.el8/313673ba.failed

Since KVM commit 11663111cd49 ("KVM: arm64: Hide PMU registers from
userspace when not available") the get-reg-list* tests have been
failing with

  ...
  ... There are 74 missing registers.
  The following lines are missing registers:
  ...

where the 74 missing registers are all PMU registers. This isn't a
bug in KVM that the selftest found, even though it's true that a
KVM userspace that wasn't setting the KVM_ARM_VCPU_PMU_V3 VCPU
flag, but still expecting the PMU registers to be in the reg-list,
would suddenly no longer have their expectations met. In that case,
the expectations were wrong, though, so that KVM userspace needs to
be fixed, and so does this selftest. The fix for this selftest is to
pull the PMU registers out of the base register sublist into their
own sublist and then create new, pmu-enabled vcpu configs which can
be tested.

	Signed-off-by: Andrew Jones <drjones@redhat.com>
	Reviewed-by: Ricardo Koller <ricarkol@google.com>
	Signed-off-by: Marc Zyngier <maz@kernel.org>
Link: https://lore.kernel.org/r/20210531103344.29325-6-drjones@redhat.com
(cherry picked from commit 313673bad871750c0c829def53d037868af75b67)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	tools/testing/selftests/kvm/aarch64/get-reg-list.c
diff --cc tools/testing/selftests/kvm/aarch64/get-reg-list.c
index 03e041d97a18,a16c8f05366c..000000000000
--- a/tools/testing/selftests/kvm/aarch64/get-reg-list.c
+++ b/tools/testing/selftests/kvm/aarch64/get-reg-list.c
@@@ -1024,8 -1047,19 +1037,23 @@@ static struct vcpu_config sve_config = 
  	{0},
  	},
  };
+ static struct vcpu_config sve_pmu_config = {
+ 	.sublists = {
+ 	BASE_SUBLIST,
+ 	SVE_SUBLIST,
+ 	PMU_SUBLIST,
+ 	{0},
+ 	},
+ };
  
  static struct vcpu_config *vcpu_configs[] = {
++<<<<<<< HEAD
 +	reg_list_sve() ? &sve_config : &vregs_config,
++=======
+ 	&vregs_config,
+ 	&vregs_pmu_config,
+ 	&sve_config,
+ 	&sve_pmu_config,
++>>>>>>> 313673bad871 (KVM: arm64: selftests: get-reg-list: Split base and pmu registers)
  };
  static int vcpu_configs_n = ARRAY_SIZE(vcpu_configs);
* Unmerged path tools/testing/selftests/kvm/aarch64/get-reg-list.c
