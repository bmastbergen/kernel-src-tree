drm/i915/adl_p: Load DMC

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-365.el8
commit-author Anusha Srivatsa <anusha.srivatsa@intel.com>
commit dac0f8ad653a2e944566f109456cd51c151c14c5
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-365.el8/dac0f8ad.failed

Load DMC v2.10 on ADLP. The release notes mention that
this version enables few power savings features.

v2: Add DMC_PATH() for ADLP (Lucas)

	Cc: Lucas De Marchi <lucas.demarchi@intel.com>
	Cc: Clint Taylor <clinton.a.taylor@intel.com>
	Signed-off-by: Anusha Srivatsa <anusha.srivatsa@intel.com>
	Reviewed-by: Lucas De Marchi <lucas.demarchi@intel.com>
Link: https://patchwork.freedesktop.org/patch/msgid/20210621191415.29823-5-anusha.srivatsa@intel.com
(cherry picked from commit dac0f8ad653a2e944566f109456cd51c151c14c5)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/gpu/drm/i915/display/intel_csr.c
diff --cc drivers/gpu/drm/i915/display/intel_csr.c
index 67dc64df78a5,f8789d4543bf..000000000000
--- a/drivers/gpu/drm/i915/display/intel_csr.c
+++ b/drivers/gpu/drm/i915/display/intel_csr.c
@@@ -38,51 -37,65 +38,61 @@@
   * low-power state and comes back to normal.
   */
  
 -#define DMC_PATH(platform, major, minor) \
 -	"i915/"				 \
 -	__stringify(platform) "_dmc_ver" \
 -	__stringify(major) "_"		 \
 -	__stringify(minor) ".bin"
 +#define GEN12_CSR_MAX_FW_SIZE		ICL_CSR_MAX_FW_SIZE
  
 -#define GEN12_DMC_MAX_FW_SIZE		ICL_DMC_MAX_FW_SIZE
 +#define DG1_CSR_PATH			"i915/dg1_dmc_ver2_02.bin"
 +#define DG1_CSR_VERSION_REQUIRED	CSR_VERSION(2, 2)
 +MODULE_FIRMWARE(DG1_CSR_PATH);
  
++<<<<<<< HEAD:drivers/gpu/drm/i915/display/intel_csr.c
 +#define RKL_CSR_PATH			"i915/rkl_dmc_ver2_02.bin"
 +#define RKL_CSR_VERSION_REQUIRED	CSR_VERSION(2, 2)
 +MODULE_FIRMWARE(RKL_CSR_PATH);
++=======
+ #define ADLP_DMC_PATH			DMC_PATH(adlp, 2, 10)
+ #define ADLP_DMC_VERSION_REQUIRED	DMC_VERSION(2, 10)
+ MODULE_FIRMWARE(ADLP_DMC_PATH);
+ 
+ #define ADLS_DMC_PATH			DMC_PATH(adls, 2, 01)
+ #define ADLS_DMC_VERSION_REQUIRED	DMC_VERSION(2, 1)
+ MODULE_FIRMWARE(ADLS_DMC_PATH);
 -
 -#define DG1_DMC_PATH			DMC_PATH(dg1, 2, 02)
 -#define DG1_DMC_VERSION_REQUIRED	DMC_VERSION(2, 2)
 -MODULE_FIRMWARE(DG1_DMC_PATH);
 -
 -#define RKL_DMC_PATH			DMC_PATH(rkl, 2, 02)
 -#define RKL_DMC_VERSION_REQUIRED	DMC_VERSION(2, 2)
 -MODULE_FIRMWARE(RKL_DMC_PATH);
 -
 -#define TGL_DMC_PATH			DMC_PATH(tgl, 2, 08)
 -#define TGL_DMC_VERSION_REQUIRED	DMC_VERSION(2, 8)
 -MODULE_FIRMWARE(TGL_DMC_PATH);
 -
 -#define ICL_DMC_PATH			DMC_PATH(icl, 1, 09)
 -#define ICL_DMC_VERSION_REQUIRED	DMC_VERSION(1, 9)
 -#define ICL_DMC_MAX_FW_SIZE		0x6000
 -MODULE_FIRMWARE(ICL_DMC_PATH);
 -
 -#define CNL_DMC_PATH			DMC_PATH(cnl, 1, 07)
 -#define CNL_DMC_VERSION_REQUIRED	DMC_VERSION(1, 7)
 -#define CNL_DMC_MAX_FW_SIZE		GLK_DMC_MAX_FW_SIZE
 -MODULE_FIRMWARE(CNL_DMC_PATH);
 -
 -#define GLK_DMC_PATH			DMC_PATH(glk, 1, 04)
 -#define GLK_DMC_VERSION_REQUIRED	DMC_VERSION(1, 4)
 -#define GLK_DMC_MAX_FW_SIZE		0x4000
 -MODULE_FIRMWARE(GLK_DMC_PATH);
 -
 -#define KBL_DMC_PATH			DMC_PATH(kbl, 1, 04)
 -#define KBL_DMC_VERSION_REQUIRED	DMC_VERSION(1, 4)
 -#define KBL_DMC_MAX_FW_SIZE		BXT_DMC_MAX_FW_SIZE
 -MODULE_FIRMWARE(KBL_DMC_PATH);
 -
 -#define SKL_DMC_PATH			DMC_PATH(skl, 1, 27)
 -#define SKL_DMC_VERSION_REQUIRED	DMC_VERSION(1, 27)
 -#define SKL_DMC_MAX_FW_SIZE		BXT_DMC_MAX_FW_SIZE
 -MODULE_FIRMWARE(SKL_DMC_PATH);
 -
 -#define BXT_DMC_PATH			DMC_PATH(bxt, 1, 07)
 -#define BXT_DMC_VERSION_REQUIRED	DMC_VERSION(1, 7)
 -#define BXT_DMC_MAX_FW_SIZE		0x3000
 -MODULE_FIRMWARE(BXT_DMC_PATH);
 -
 -#define DMC_DEFAULT_FW_OFFSET		0xFFFFFFFF
++>>>>>>> dac0f8ad653a (drm/i915/adl_p: Load DMC):drivers/gpu/drm/i915/display/intel_dmc.c
 +
 +#define TGL_CSR_PATH			"i915/tgl_dmc_ver2_08.bin"
 +#define TGL_CSR_VERSION_REQUIRED	CSR_VERSION(2, 8)
 +MODULE_FIRMWARE(TGL_CSR_PATH);
 +
 +#define ICL_CSR_PATH			"i915/icl_dmc_ver1_09.bin"
 +#define ICL_CSR_VERSION_REQUIRED	CSR_VERSION(1, 9)
 +#define ICL_CSR_MAX_FW_SIZE		0x6000
 +MODULE_FIRMWARE(ICL_CSR_PATH);
 +
 +#define CNL_CSR_PATH			"i915/cnl_dmc_ver1_07.bin"
 +#define CNL_CSR_VERSION_REQUIRED	CSR_VERSION(1, 7)
 +#define CNL_CSR_MAX_FW_SIZE		GLK_CSR_MAX_FW_SIZE
 +MODULE_FIRMWARE(CNL_CSR_PATH);
 +
 +#define GLK_CSR_PATH			"i915/glk_dmc_ver1_04.bin"
 +#define GLK_CSR_VERSION_REQUIRED	CSR_VERSION(1, 4)
 +#define GLK_CSR_MAX_FW_SIZE		0x4000
 +MODULE_FIRMWARE(GLK_CSR_PATH);
 +
 +#define KBL_CSR_PATH			"i915/kbl_dmc_ver1_04.bin"
 +#define KBL_CSR_VERSION_REQUIRED	CSR_VERSION(1, 4)
 +#define KBL_CSR_MAX_FW_SIZE		BXT_CSR_MAX_FW_SIZE
 +MODULE_FIRMWARE(KBL_CSR_PATH);
 +
 +#define SKL_CSR_PATH			"i915/skl_dmc_ver1_27.bin"
 +#define SKL_CSR_VERSION_REQUIRED	CSR_VERSION(1, 27)
 +#define SKL_CSR_MAX_FW_SIZE		BXT_CSR_MAX_FW_SIZE
 +MODULE_FIRMWARE(SKL_CSR_PATH);
 +
 +#define BXT_CSR_PATH			"i915/bxt_dmc_ver1_07.bin"
 +#define BXT_CSR_VERSION_REQUIRED	CSR_VERSION(1, 7)
 +#define BXT_CSR_MAX_FW_SIZE		0x3000
 +MODULE_FIRMWARE(BXT_CSR_PATH);
 +
 +#define CSR_DEFAULT_FW_OFFSET		0xFFFFFFFF
  #define PACKAGE_MAX_FW_INFO_ENTRIES	20
  #define PACKAGE_V2_MAX_FW_INFO_ENTRIES	32
  #define DMC_V1_MAX_MMIO_COUNT		8
@@@ -684,35 -723,43 +694,50 @@@ void intel_csr_ucode_init(struct drm_i9
  	 * runtime-suspend.
  	 *
  	 * On error, we return with the rpm wakeref held to prevent runtime
 -	 * suspend as runtime suspend *requires* a working DMC for whatever
 +	 * suspend as runtime suspend *requires* a working CSR for whatever
  	 * reason.
  	 */
 -	intel_dmc_runtime_pm_get(dev_priv);
 -
 +	intel_csr_runtime_pm_get(dev_priv);
 +
++<<<<<<< HEAD:drivers/gpu/drm/i915/display/intel_csr.c
 +	if (IS_DG1(dev_priv)) {
 +		csr->fw_path = DG1_CSR_PATH;
 +		csr->required_version = DG1_CSR_VERSION_REQUIRED;
 +		csr->max_fw_size = GEN12_CSR_MAX_FW_SIZE;
++=======
+ 	if (IS_ALDERLAKE_P(dev_priv)) {
+ 		dmc->fw_path = ADLP_DMC_PATH;
+ 		dmc->required_version = ADLP_DMC_VERSION_REQUIRED;
+ 		dmc->max_fw_size = GEN12_DMC_MAX_FW_SIZE;
+ 	} else if (IS_ALDERLAKE_S(dev_priv)) {
+ 		dmc->fw_path = ADLS_DMC_PATH;
+ 		dmc->required_version = ADLS_DMC_VERSION_REQUIRED;
+ 		dmc->max_fw_size = GEN12_DMC_MAX_FW_SIZE;
+ 	} else if (IS_DG1(dev_priv)) {
+ 		dmc->fw_path = DG1_DMC_PATH;
+ 		dmc->required_version = DG1_DMC_VERSION_REQUIRED;
+ 		dmc->max_fw_size = GEN12_DMC_MAX_FW_SIZE;
++>>>>>>> dac0f8ad653a (drm/i915/adl_p: Load DMC):drivers/gpu/drm/i915/display/intel_dmc.c
  	} else if (IS_ROCKETLAKE(dev_priv)) {
 -		dmc->fw_path = RKL_DMC_PATH;
 -		dmc->required_version = RKL_DMC_VERSION_REQUIRED;
 -		dmc->max_fw_size = GEN12_DMC_MAX_FW_SIZE;
 -	} else if (DISPLAY_VER(dev_priv) >= 12) {
 -		dmc->fw_path = TGL_DMC_PATH;
 -		dmc->required_version = TGL_DMC_VERSION_REQUIRED;
 -		dmc->max_fw_size = GEN12_DMC_MAX_FW_SIZE;
 -	} else if (DISPLAY_VER(dev_priv) == 11) {
 -		dmc->fw_path = ICL_DMC_PATH;
 -		dmc->required_version = ICL_DMC_VERSION_REQUIRED;
 -		dmc->max_fw_size = ICL_DMC_MAX_FW_SIZE;
 +		csr->fw_path = RKL_CSR_PATH;
 +		csr->required_version = RKL_CSR_VERSION_REQUIRED;
 +		csr->max_fw_size = GEN12_CSR_MAX_FW_SIZE;
 +	} else if (INTEL_GEN(dev_priv) >= 12) {
 +		csr->fw_path = TGL_CSR_PATH;
 +		csr->required_version = TGL_CSR_VERSION_REQUIRED;
 +		csr->max_fw_size = GEN12_CSR_MAX_FW_SIZE;
 +	} else if (IS_GEN(dev_priv, 11)) {
 +		csr->fw_path = ICL_CSR_PATH;
 +		csr->required_version = ICL_CSR_VERSION_REQUIRED;
 +		csr->max_fw_size = ICL_CSR_MAX_FW_SIZE;
  	} else if (IS_CANNONLAKE(dev_priv)) {
 -		dmc->fw_path = CNL_DMC_PATH;
 -		dmc->required_version = CNL_DMC_VERSION_REQUIRED;
 -		dmc->max_fw_size = CNL_DMC_MAX_FW_SIZE;
 +		csr->fw_path = CNL_CSR_PATH;
 +		csr->required_version = CNL_CSR_VERSION_REQUIRED;
 +		csr->max_fw_size = CNL_CSR_MAX_FW_SIZE;
  	} else if (IS_GEMINILAKE(dev_priv)) {
 -		dmc->fw_path = GLK_DMC_PATH;
 -		dmc->required_version = GLK_DMC_VERSION_REQUIRED;
 -		dmc->max_fw_size = GLK_DMC_MAX_FW_SIZE;
 +		csr->fw_path = GLK_CSR_PATH;
 +		csr->required_version = GLK_CSR_VERSION_REQUIRED;
 +		csr->max_fw_size = GLK_CSR_MAX_FW_SIZE;
  	} else if (IS_KABYLAKE(dev_priv) ||
  		   IS_COFFEELAKE(dev_priv) ||
  		   IS_COMETLAKE(dev_priv)) {
* Unmerged path drivers/gpu/drm/i915/display/intel_csr.c
