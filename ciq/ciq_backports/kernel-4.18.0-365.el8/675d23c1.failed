drm/i915/tc: Don't keep legacy TypeC ports in connected state w/o a sink

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-365.el8
commit-author Imre Deak <imre.deak@intel.com>
commit 675d23c14821fbaef3df5cbad94b42ec2e3a858a
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-365.el8/675d23c1.failed

A follow-up patch will disconnect/reconnect PHYs around AUX transfers
and modeset enable/disables. To prepare for that and make things
consistent for all TypeC modes stop connecting the PHY in legacy mode
without a sink being connected. This was done before since in legacy
mode the PHY is dedicated to display usage, so there was no point in
disconnecting it. However after the follow-up changes the TC-cold
blocking power domains will be held as long as the PHY is in the
connected state, so we'll need to disconnect/re-connect the PHY in all
TypeC modes to allow for power saving.

	Cc: José Roberto de Souza <jose.souza@intel.com>
	Signed-off-by: Imre Deak <imre.deak@intel.com>
	Reviewed-by: José Roberto de Souza <jose.souza@intel.com>
Link: https://patchwork.freedesktop.org/patch/msgid/20210921002313.1132357-7-imre.deak@intel.com
(cherry picked from commit 675d23c14821fbaef3df5cbad94b42ec2e3a858a)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/gpu/drm/i915/display/intel_tc.c
diff --cc drivers/gpu/drm/i915/display/intel_tc.c
index 2cefc13535a0,6d0a1b376767..000000000000
--- a/drivers/gpu/drm/i915/display/intel_tc.c
+++ b/drivers/gpu/drm/i915/display/intel_tc.c
@@@ -377,10 -527,8 +377,8 @@@ static void icl_tc_phy_disconnect(struc
  {
  	switch (dig_port->tc_mode) {
  	case TC_PORT_LEGACY:
- 		/* Nothing to do, we never disconnect from legacy mode */
- 		break;
  	case TC_PORT_DP_ALT:
 -		tc_phy_take_ownership(dig_port, false);
 +		icl_tc_phy_set_safe_mode(dig_port, true);
  		dig_port->tc_mode = TC_PORT_TBT_ALT;
  		break;
  	case TC_PORT_TBT_ALT:
@@@ -443,9 -594,7 +441,13 @@@ intel_tc_port_get_target_mode(struct in
  	if (live_status_mask)
  		return fls(live_status_mask) - 1;
  
++<<<<<<< HEAD
 +	return icl_tc_phy_status_complete(dig_port) &&
 +	       dig_port->tc_legacy_port ? TC_PORT_LEGACY :
 +					  TC_PORT_TBT_ALT;
++=======
+ 	return TC_PORT_TBT_ALT;
++>>>>>>> 675d23c14821 (drm/i915/tc: Don't keep legacy TypeC ports in connected state w/o a sink)
  }
  
  static void intel_tc_port_reset_mode(struct intel_digital_port *dig_port,
* Unmerged path drivers/gpu/drm/i915/display/intel_tc.c
