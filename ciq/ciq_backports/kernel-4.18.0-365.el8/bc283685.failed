ACPI: PM: Do not turn off power resources in unknown state

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-365.el8
commit-author Rafael J. Wysocki <rafael.j.wysocki@intel.com>
commit bc28368596436e6e81ffc48c815b8225d96121c0
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-365.el8/bc283685.failed

Commit 6381195ad7d0 ("ACPI: power: Rework turning off unused power
resources") caused power resources in unknown state with reference
counters equal to zero to be turned off too, but that caused issues
to appear in the field, so modify the code to only turn off power
resources that are known to be "on".

Link: https://lore.kernel.org/linux-acpi/6faf4b92-78d5-47a4-63df-cc2bab7769d0@molgen.mpg.de/
Fixes: 6381195ad7d0 ("ACPI: power: Rework turning off unused power resources")
	Reported-by: Andreas K. Huettel <andreas.huettel@ur.de>
	Tested-by: Andreas K. Huettel <andreas.huettel@ur.de>
	Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>
	Cc: 5.14+ <stable@vger.kernel.org> # 5.14+
(cherry picked from commit bc28368596436e6e81ffc48c815b8225d96121c0)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/acpi/power.c
diff --cc drivers/acpi/power.c
index 3fdfde3a851a,f0ed4414edb1..000000000000
--- a/drivers/acpi/power.c
+++ b/drivers/acpi/power.c
@@@ -1069,7 -1035,11 +1069,15 @@@ void acpi_turn_off_unused_power_resourc
  	list_for_each_entry_reverse(resource, &acpi_power_resource_list, list_node) {
  		mutex_lock(&resource->resource_lock);
  
++<<<<<<< HEAD
 +		acpi_power_turn_off_if_unused(resource, init);
++=======
+ 		if (!resource->ref_count &&
+ 		    resource->state == ACPI_POWER_RESOURCE_STATE_ON) {
+ 			acpi_handle_debug(resource->device.handle, "Turning OFF\n");
+ 			__acpi_power_off(resource);
+ 		}
++>>>>>>> bc2836859643 (ACPI: PM: Do not turn off power resources in unknown state)
  
  		mutex_unlock(&resource->resource_lock);
  	}
* Unmerged path drivers/acpi/power.c
