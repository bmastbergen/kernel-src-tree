netfilter: nft_dynset: dump expressions when set definition contains no expressions

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-365.el8
commit-author Pablo Neira Ayuso <pablo@netfilter.org>
commit ce5379963b2884e9d23bea0c5674a7251414c84b
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-365.el8/ce537996.failed

If the set definition provides no stateful expressions, then include the
stateful expression in the ruleset listing. Without this fix, the dynset
rule listing shows the stateful expressions provided by the set
definition.

Fixes: 65038428b2c6 ("netfilter: nf_tables: allow to specify stateful expression in set definition")
	Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
(cherry picked from commit ce5379963b2884e9d23bea0c5674a7251414c84b)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/netfilter/nft_dynset.c
diff --cc net/netfilter/nft_dynset.c
index abb6d9645c0c,d164ef9e6843..000000000000
--- a/net/netfilter/nft_dynset.c
+++ b/net/netfilter/nft_dynset.c
@@@ -268,8 -384,26 +268,31 @@@ static int nft_dynset_dump(struct sk_bu
  			 nf_jiffies64_to_msecs(priv->timeout),
  			 NFTA_DYNSET_PAD))
  		goto nla_put_failure;
++<<<<<<< HEAD
 +	if (priv->expr && nft_expr_dump(skb, NFTA_DYNSET_EXPR, priv->expr))
 +		goto nla_put_failure;
++=======
+ 	if (priv->set->num_exprs == 0) {
+ 		if (priv->num_exprs == 1) {
+ 			if (nft_expr_dump(skb, NFTA_DYNSET_EXPR,
+ 					  priv->expr_array[0]))
+ 				goto nla_put_failure;
+ 		} else if (priv->num_exprs > 1) {
+ 			struct nlattr *nest;
+ 
+ 			nest = nla_nest_start_noflag(skb, NFTA_DYNSET_EXPRESSIONS);
+ 			if (!nest)
+ 				goto nla_put_failure;
+ 
+ 			for (i = 0; i < priv->num_exprs; i++) {
+ 				if (nft_expr_dump(skb, NFTA_LIST_ELEM,
+ 						  priv->expr_array[i]))
+ 					goto nla_put_failure;
+ 			}
+ 			nla_nest_end(skb, nest);
+ 		}
+ 	}
++>>>>>>> ce5379963b28 (netfilter: nft_dynset: dump expressions when set definition contains no expressions)
  	if (nla_put_be32(skb, NFTA_DYNSET_FLAGS, htonl(flags)))
  		goto nla_put_failure;
  	return 0;
* Unmerged path net/netfilter/nft_dynset.c
