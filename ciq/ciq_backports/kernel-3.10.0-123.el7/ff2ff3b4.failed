i40e: release NVM resource reservation on startup

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-123.el7
commit-author Shannon Nelson <shannon.nelson@intel.com>
commit ff2ff3b45eba19ce87dda2ee577201ea733f24e2
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-123.el7/ff2ff3b4.failed

Call AQ to release any reservation held by this PF on the NVM resource
lock on startup, in order to clear anything that might have been left over from
a previous run.  The lock is only cleared by the requestor calling for it to be
cleared, on power-on, or firmware reset.  This should help limit the need for
rebooting a customer machine if something goes wrong on a firmware update or
some other action.

Change-ID: I8c8473e601d4ef512dda7baa77a6e75f2e5fea49
	Signed-off-by: Shannon Nelson <shannon.nelson@intel.com>
	Signed-off-by: Jesse Brandeburg <jesse.brandeburg@intel.com>
	Tested-by: Kavindya Deegala <kavindya.s.deegala@intel.com>
	Signed-off-by: Jeff Kirsher <jeffrey.t.kirsher@intel.com>
(cherry picked from commit ff2ff3b45eba19ce87dda2ee577201ea733f24e2)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/intel/i40e/i40e_adminq.c
diff --cc drivers/net/ethernet/intel/i40e/i40e_adminq.c
index 50dfa9575155,2b76aba0b6cd..000000000000
--- a/drivers/net/ethernet/intel/i40e/i40e_adminq.c
+++ b/drivers/net/ethernet/intel/i40e/i40e_adminq.c
@@@ -581,6 -577,15 +581,18 @@@ i40e_status i40e_init_adminq(struct i40
  	i40e_read_nvm_word(hw, I40E_SR_NVM_EETRACK_HI, &eetrack_hi);
  	hw->nvm.eetrack = (eetrack_hi << 16) | eetrack_lo;
  
++<<<<<<< HEAD
++=======
+ 	if (hw->aq.api_maj_ver != I40E_FW_API_VERSION_MAJOR ||
+ 	    hw->aq.api_min_ver > I40E_FW_API_VERSION_MINOR) {
+ 		ret_code = I40E_ERR_FIRMWARE_API_VERSION;
+ 		goto init_adminq_free_arq;
+ 	}
+ 
+ 	/* pre-emptive resource lock release */
+ 	i40e_aq_release_resource(hw, I40E_NVM_RESOURCE_ID, 0, NULL);
+ 
++>>>>>>> ff2ff3b45eba (i40e: release NVM resource reservation on startup)
  	ret_code = i40e_aq_set_hmc_resource_profile(hw,
  						    I40E_HMC_PROFILE_DEFAULT,
  						    0,
* Unmerged path drivers/net/ethernet/intel/i40e/i40e_adminq.c
