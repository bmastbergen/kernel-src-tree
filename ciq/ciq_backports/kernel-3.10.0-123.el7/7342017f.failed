ALSA: hda - hdmi: Re-setup pin and infoframe on plug-in on all codecs

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-123.el7
Rebuild_CHGLOG: - [alsa] hda/hdmi: Re-setup pin and infoframe on plug-in on all codecs (Jaroslav Kysela) [1044022]
Rebuild_FUZZ: 92.31%
commit-author Anssi Hannula <anssi.hannula@iki.fi>
commit 7342017f4a0f129d277f78b8761f2732661ba30a
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-123.el7/7342017f.failed

hdmi_setup_audio_infoframe() does not set up pin and infoframe if there
is no connected sink. If a sink is connected while audio playback is
already in progress, the pin and infoframe will not be properly set up,
causing no audio or wrongly mapped audio.

On Intel Haswell codecs the hdmi_setup_audio_infoframe() is already
called again from hdmi_present_sense() when an ELD appears because
transcoder:port mapping may have changed.

Make the call non-Haswell-specific so that audio will be properly set up
if the playback was started before a sink was connected.

Tested on non-Haswell Intel HDMI codec by plugging sink in during
playback.

	Signed-off-by: Anssi Hannula <anssi.hannula@iki.fi>
	Signed-off-by: Takashi Iwai <tiwai@suse.de>
(cherry picked from commit 7342017f4a0f129d277f78b8761f2732661ba30a)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	sound/pci/hda/patch_hdmi.c
diff --cc sound/pci/hda/patch_hdmi.c
index f36275527fe5,772827b9fb20..000000000000
--- a/sound/pci/hda/patch_hdmi.c
+++ b/sound/pci/hda/patch_hdmi.c
@@@ -1359,8 -1533,16 +1359,20 @@@ static void hdmi_present_sense(struct h
  			       eld->eld_size);
  		pin_eld->eld_size = eld->eld_size;
  		pin_eld->info = eld->info;
++<<<<<<< HEAD
++=======
+ 
+ 		/*
+ 		 * Re-setup pin and infoframe. This is needed e.g. when
+ 		 * - sink is first plugged-in (infoframe is not set up if !monitor_present)
+ 		 * - transcoder can change during stream playback on Haswell
+ 		 */
+ 		if (eld->eld_valid && !old_eld_valid && per_pin->setup)
+ 			hdmi_setup_audio_infoframe(codec, per_pin,
+ 						   per_pin->non_pcm);
++>>>>>>> 7342017f4a0f (ALSA: hda - hdmi: Re-setup pin and infoframe on plug-in on all codecs)
  	}
 +	mutex_unlock(&pin_eld->lock);
  
  	if (eld_changed)
  		snd_ctl_notify(codec->bus->card,
* Unmerged path sound/pci/hda/patch_hdmi.c
