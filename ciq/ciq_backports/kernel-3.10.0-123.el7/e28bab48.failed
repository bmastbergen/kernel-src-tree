Drivers: hv: vmbus: Specify the target CPU that should receive notification

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-123.el7
Rebuild_CHGLOG: - [virt] hv/vmbus: Specify the target CPU that should receive notification (Jason Wang) [1037957]
Rebuild_FUZZ: 91.43%
commit-author K. Y. Srinivasan <kys@microsoft.com>
commit e28bab4828354583bb66ac09021ca69b341a7db4
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-123.el7/e28bab48.failed

During the initial VMBUS connect phase, starting with WS2012 R2, we should
specify the VPCU in the guest that should receive the notification. Fix this
issue. This fix is required to properly connect to the host in the kexeced
kernel.

	Signed-off-by: K. Y. Srinivasan <kys@microsoft.com>
	Cc: <stable@vger.kernel.org>        [3.9+]
	Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
(cherry picked from commit e28bab4828354583bb66ac09021ca69b341a7db4)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/hv/connection.c
diff --cc drivers/hv/connection.c
index 07edba90f5f0,855bbda9964d..000000000000
--- a/drivers/hv/connection.c
+++ b/drivers/hv/connection.c
@@@ -76,10 -76,10 +76,17 @@@ static int vmbus_negotiate_version(stru
  	msg->header.msgtype = CHANNELMSG_INITIATE_CONTACT;
  	msg->vmbus_version_requested = version;
  	msg->interrupt_page = virt_to_phys(vmbus_connection.int_page);
++<<<<<<< HEAD
 +	msg->monitor_page1 = virt_to_phys(vmbus_connection.monitor_pages);
 +	msg->monitor_page2 = virt_to_phys(
 +			(void *)((unsigned long)vmbus_connection.monitor_pages +
 +				 PAGE_SIZE));
++=======
+ 	msg->monitor_page1 = virt_to_phys(vmbus_connection.monitor_pages[0]);
+ 	msg->monitor_page2 = virt_to_phys(vmbus_connection.monitor_pages[1]);
+ 	if (version == VERSION_WIN8)
+ 		msg->target_vcpu = hv_context.vp_index[smp_processor_id()];
++>>>>>>> e28bab482835 (Drivers: hv: vmbus: Specify the target CPU that should receive notification)
  
  	/*
  	 * Add to list before we send the request since we may
* Unmerged path drivers/hv/connection.c
diff --git a/include/linux/hyperv.h b/include/linux/hyperv.h
index 1d9d87d1f0c4..bb46b5626105 100644
--- a/include/linux/hyperv.h
+++ b/include/linux/hyperv.h
@@ -905,7 +905,7 @@ struct vmbus_channel_relid_released {
 struct vmbus_channel_initiate_contact {
 	struct vmbus_channel_message_header header;
 	u32 vmbus_version_requested;
-	u32 padding2;
+	u32 target_vcpu; /* The VCPU the host should respond to */
 	u64 interrupt_page;
 	u64 monitor_page1;
 	u64 monitor_page2;
