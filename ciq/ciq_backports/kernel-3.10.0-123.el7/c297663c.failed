mm: numa: initialise numa balancing after jump label initialisation

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-123.el7
Rebuild_CHGLOG: - [mm] numa: initialise numa balancing after jump label initialisation (Rik van Riel) [1059459]
Rebuild_FUZZ: 96.92%
commit-author Mel Gorman <mgorman@suse.de>
commit c297663c0b3930491a3cb2aba4b6e5a7159c3503
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-123.el7/c297663c.failed

The command line parsing takes place before jump labels are initialised
which generates a warning if numa_balancing= is specified and
CONFIG_JUMP_LABEL is set.

On older kernels before commit c4b2c0c5f647 ("static_key: WARN on usage
before jump_label_init was called") the kernel would have crashed.  This
patch enables automatic numa balancing later in the initialisation
process if numa_balancing= is specified.

	Signed-off-by: Mel Gorman <mgorman@suse.de>
	Acked-by: Rik van Riel <riel@redhat.com>
	Cc: stable <stable@vger.kernel.org>
	Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
	Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
(cherry picked from commit c297663c0b3930491a3cb2aba4b6e5a7159c3503)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	mm/mempolicy.c
diff --cc mm/mempolicy.c
index f05aa4c2c73c,79cea01f9f78..000000000000
--- a/mm/mempolicy.c
+++ b/mm/mempolicy.c
@@@ -2553,9 -2663,15 +2553,20 @@@ static void __init check_numabalancing_
  	if (IS_ENABLED(CONFIG_NUMA_BALANCING_DEFAULT_ENABLED))
  		numabalancing_default = true;
  
+ 	/* Parsed by setup_numabalancing. override == 1 enables, -1 disables */
+ 	if (numabalancing_override)
+ 		set_numabalancing_state(numabalancing_override == 1);
+ 
  	if (nr_node_ids > 1 && !numabalancing_override) {
++<<<<<<< HEAD
 +		printk(KERN_INFO "Enabling automatic NUMA balancing. "
 +			"Configure with numa_balancing= or sysctl");
++=======
+ 		printk(KERN_INFO "%s automatic NUMA balancing. "
+ 			"Configure with numa_balancing= or the "
+ 			"kernel.numa_balancing sysctl",
+ 			numabalancing_default ? "Enabling" : "Disabling");
++>>>>>>> c297663c0b39 (mm: numa: initialise numa balancing after jump label initialisation)
  		set_numabalancing_state(numabalancing_default);
  	}
  }
* Unmerged path mm/mempolicy.c
