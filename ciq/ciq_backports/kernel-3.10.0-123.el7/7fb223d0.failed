scsi: qla2xxx: Fix a memory leak in an error path of qla2x00_process_els()

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-123.el7
Rebuild_CHGLOG: - [scsi] qla2xxx: Fix a memory leak in an error path of qla2x00_process_els() (Chad Dupuis) [725014]
Rebuild_FUZZ: 95.77%
commit-author Joy Gu <jgu@purestorage.com>
commit 7fb223d0ad801f633c78cbe42b1d1b55f5d163ad
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-123.el7/7fb223d0.failed

Commit 8c0eb596baa5 ("[SCSI] qla2xxx: Fix a memory leak in an error path of
qla2x00_process_els()"), intended to change:

        bsg_job->request->msgcode == FC_BSG_HST_ELS_NOLOGIN

to:

        bsg_job->request->msgcode != FC_BSG_RPT_ELS

but changed it to:

        bsg_job->request->msgcode == FC_BSG_RPT_ELS

instead.

Change the == to a != to avoid leaking the fcport structure or freeing
unallocated memory.

Link: https://lore.kernel.org/r/20211012191834.90306-2-jgu@purestorage.com
Fixes: 8c0eb596baa5 ("[SCSI] qla2xxx: Fix a memory leak in an error path of qla2x00_process_els()")
	Reviewed-by: Bart Van Assche <bvanassche@acm.org>
	Signed-off-by: Joy Gu <jgu@purestorage.com>
	Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
(cherry picked from commit 7fb223d0ad801f633c78cbe42b1d1b55f5d163ad)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/scsi/qla2xxx/qla_bsg.c
diff --cc drivers/scsi/qla2xxx/qla_bsg.c
index b85f0021db3b,655cf5de604b..000000000000
--- a/drivers/scsi/qla2xxx/qla_bsg.c
+++ b/drivers/scsi/qla2xxx/qla_bsg.c
@@@ -399,8 -431,8 +399,13 @@@ done_unmap_sg
  	goto done_free_fcport;
  
  done_free_fcport:
++<<<<<<< HEAD
 +	if (bsg_job->request->msgcode == FC_BSG_HST_ELS_NOLOGIN)
 +		kfree(fcport);
++=======
+ 	if (bsg_request->msgcode != FC_BSG_RPT_ELS)
+ 		qla2x00_free_fcport(fcport);
++>>>>>>> 7fb223d0ad80 (scsi: qla2xxx: Fix a memory leak in an error path of qla2x00_process_els())
  done:
  	return rval;
  }
* Unmerged path drivers/scsi/qla2xxx/qla_bsg.c
