xfs: remove the dquot log format from the dquot log item

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-123.el7
commit-author Christoph Hellwig <hch@infradead.org>
commit ce8e962939ca12218092f8eb3c8cfb196cd8cc51
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-123.el7/ce8e9629.failed

No need to keep the dquot log format around all the time, we can
easily generate it at iop_format time.

	Signed-off-by: Christoph Hellwig <hch@lst.de>
	Reviewed-by: Dave Chinner <dchinner@redhat.com>
	Signed-off-by: Dave Chinner <david@fromorbit.com>
(cherry picked from commit ce8e962939ca12218092f8eb3c8cfb196cd8cc51)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	fs/xfs/xfs_dquot_item.c
diff --cc fs/xfs/xfs_dquot_item.c
index e838d84b4e85,d4fffa90036a..000000000000
--- a/fs/xfs/xfs_dquot_item.c
+++ b/fs/xfs/xfs_dquot_item.c
@@@ -61,20 -57,24 +61,38 @@@ xfs_qm_dquot_logitem_size
  STATIC void
  xfs_qm_dquot_logitem_format(
  	struct xfs_log_item	*lip,
 -	struct xfs_log_vec	*lv)
 +	struct xfs_log_iovec	*logvec)
  {
  	struct xfs_dq_logitem	*qlip = DQUOT_ITEM(lip);
++<<<<<<< HEAD
 +
 +	logvec->i_addr = &qlip->qli_format;
 +	logvec->i_len  = sizeof(xfs_dq_logformat_t);
 +	logvec->i_type = XLOG_REG_TYPE_QFORMAT;
 +	logvec++;
 +	logvec->i_addr = &qlip->qli_dquot->q_core;
 +	logvec->i_len  = sizeof(xfs_disk_dquot_t);
 +	logvec->i_type = XLOG_REG_TYPE_DQUOT;
++=======
+ 	struct xfs_log_iovec	*vecp = NULL;
+ 	struct xfs_dq_logformat	*qlf;
++>>>>>>> ce8e962939ca (xfs: remove the dquot log format from the dquot log item)
  
- 	qlip->qli_format.qlf_size = 2;
+ 	qlf = xlog_prepare_iovec(lv, &vecp, XLOG_REG_TYPE_QFORMAT);
+ 	qlf->qlf_type = XFS_LI_DQUOT;
+ 	qlf->qlf_size = 2;
+ 	qlf->qlf_id = be32_to_cpu(qlip->qli_dquot->q_core.d_id);
+ 	qlf->qlf_blkno = qlip->qli_dquot->q_blkno;
+ 	qlf->qlf_len = 1;
+ 	qlf->qlf_boffset = qlip->qli_dquot->q_bufoffset;
+ 	xlog_finish_iovec(lv, vecp, sizeof(struct xfs_dq_logformat));
  
++<<<<<<< HEAD
++=======
+ 	xlog_copy_iovec(lv, &vecp, XLOG_REG_TYPE_DQUOT,
+ 			&qlip->qli_dquot->q_core,
+ 			sizeof(struct xfs_disk_dquot));
++>>>>>>> ce8e962939ca (xfs: remove the dquot log format from the dquot log item)
  }
  
  /*
* Unmerged path fs/xfs/xfs_dquot_item.c
diff --git a/fs/xfs/xfs_dquot_item.h b/fs/xfs/xfs_dquot_item.h
index 5acae2ada70b..925cbe948c67 100644
--- a/fs/xfs/xfs_dquot_item.h
+++ b/fs/xfs/xfs_dquot_item.h
@@ -27,7 +27,6 @@ typedef struct xfs_dq_logitem {
 	xfs_log_item_t		 qli_item;	   /* common portion */
 	struct xfs_dquot	*qli_dquot;	   /* dquot ptr */
 	xfs_lsn_t		 qli_flush_lsn;	   /* lsn at last flush */
-	xfs_dq_logformat_t	 qli_format;	   /* logged structure */
 } xfs_dq_logitem_t;
 
 typedef struct xfs_qoff_logitem {
