PCI: Return -ENOSYS for SR-IOV operations on non-SR-IOV devices

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-123.el7
Rebuild_CHGLOG: - [pci] Return -ENOSYS for SR-IOV operations on non-SR-IOV devices (Myron Stowe) [1005229]
Rebuild_FUZZ: 95.87%
commit-author Stefan Assmann <sassmann@kpanic.de>
commit 652d1100453a14bcc2b4514af79c701360836085
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-123.el7/652d1100.failed

Change the return value to -ENOSYS if a device is not an SR-IOV PF.
Previously we returned either -ENODEV or -EINVAL.

Also have pci_sriov_get_totalvfs() return 0 in the error case to make the
behaviour consistent whether CONFIG_PCI_IOV is enabled or not.

	Signed-off-by: Stefan Assmann <sassmann@kpanic.de>
	Signed-off-by: Bjorn Helgaas <bhelgaas@google.com>
(cherry picked from commit 652d1100453a14bcc2b4514af79c701360836085)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/pci/iov.c
diff --cc drivers/pci/iov.c
index 3ef183cdce9c,21a7182dccd4..000000000000
--- a/drivers/pci/iov.c
+++ b/drivers/pci/iov.c
@@@ -331,10 -321,10 +331,17 @@@ static int sriov_enable(struct pci_dev 
  		if (!pdev)
  			return -ENODEV;
  
++<<<<<<< HEAD
 +		pci_dev_put(pdev);
 +
 +		if (!pdev->is_physfn)
 +			return -ENODEV;
++=======
+ 		if (!pdev->is_physfn) {
+ 			pci_dev_put(pdev);
+ 			return -ENOSYS;
+ 		}
++>>>>>>> 652d1100453a (PCI: Return -ENOSYS for SR-IOV operations on non-SR-IOV devices)
  
  		rc = sysfs_create_link(&dev->dev.kobj,
  					&pdev->dev.kobj, "dep_link");
* Unmerged path drivers/pci/iov.c
