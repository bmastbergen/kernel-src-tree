ALSA: hda - Refactor pm notification in hda_codec.c

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-123.el7
Rebuild_CHGLOG: - [alsa] hda: Refactor pm notification in hda_codec.c (Jaroslav Kysela) [1044022]
Rebuild_FUZZ: 90.53%
commit-author Takashi Iwai <tiwai@suse.de>
commit a40e0a880b34d95f583552be7fd3905b6b4e6891
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-123.el7/a40e0a88.failed

No functional change.

- codec->pm_down_notified flag is renamed to codec->pm_up_notified
  flag (and takes the reversed meaning), which is managed solely in
  hda_call_pm_notify() now.

- The explicit call of hda_call_pm_notify() is moved into
  hda_keep_power_on().

- Removed a redundant call of hda_call_pm_notify() in
  snd_hda_power_up(), as it's called in hda_call_codec_resume()
  anyway.

	Signed-off-by: Takashi Iwai <tiwai@suse.de>
(cherry picked from commit a40e0a880b34d95f583552be7fd3905b6b4e6891)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	sound/pci/hda/hda_codec.c
diff --cc sound/pci/hda/hda_codec.c
index 95345c257c9e,8f7295bdccbd..000000000000
--- a/sound/pci/hda/hda_codec.c
+++ b/sound/pci/hda/hda_codec.c
@@@ -4923,11 -4935,8 +4923,16 @@@ static void hda_power_work(struct work_
  	spin_unlock(&codec->power_lock);
  
  	state = hda_call_codec_suspend(codec, true);
++<<<<<<< HEAD
 +	codec->pm_down_notified = 0;
 +	if (!bus->power_keep_link_on && (state & AC_PWRST_CLK_STOP_OK)) {
 +		codec->pm_down_notified = 1;
 +		hda_call_pm_notify(bus, false);
 +	}
++=======
+ 	if (!bus->power_keep_link_on && (state & AC_PWRST_CLK_STOP_OK))
+ 		hda_call_pm_notify(codec, false);
++>>>>>>> a40e0a880b34 (ALSA: hda - Refactor pm notification in hda_codec.c)
  }
  
  static void hda_keep_power_on(struct hda_codec *codec)
* Unmerged path sound/pci/hda/hda_codec.c
diff --git a/sound/pci/hda/hda_codec.h b/sound/pci/hda/hda_codec.h
index 14e4b5a9c43c..a3e5f45d74c1 100644
--- a/sound/pci/hda/hda_codec.h
+++ b/sound/pci/hda/hda_codec.h
@@ -908,7 +908,7 @@ struct hda_codec {
 #ifdef CONFIG_PM
 	unsigned int power_on :1;	/* current (global) power-state */
 	unsigned int d3_stop_clk:1;	/* support D3 operation without BCLK */
-	unsigned int pm_down_notified:1; /* PM notified to controller */
+	unsigned int pm_up_notified:1;	/* PM notified to controller */
 	unsigned int in_pm:1;		/* suspend/resume being performed */
 	int power_transition;	/* power-state in transition */
 	int power_count;	/* current (global) power refcount */
