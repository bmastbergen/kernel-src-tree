cnic: Add a signature to indicate valid doorbell offset.

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-123.el7
Rebuild_CHGLOG: - [net] cnic: Add a signature to indicate valid doorbell offset (Maurizio Lombardi) [1051181]
Rebuild_FUZZ: 99.10%
commit-author Eddie Wai <eddie.wai@broadcom.com>
commit d15e2a92c4c263fd44a0b41e637a032bd618e6c9
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-123.el7/d15e2a92.failed

The buffer that is used to pass doorbell offset to the userspace UIO
driver may contain nonzero value in older versions of bnx2x driver.
Userspace cannot easily tell whether it contains a valid doorbell
offset or not.  With the added signature, userspace will only use
the doorbell offset if the signature is present.

Update version to 2.5.19.

	Signed-off-by: Eddie Wai <eddie.wai@broadcom.com>
	Signed-off-by: Michael Chan <mchan@broadcom.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit d15e2a92c4c263fd44a0b41e637a032bd618e6c9)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/broadcom/cnic.c
diff --cc drivers/net/ethernet/broadcom/cnic.c
index 1ee4db6633b7,fcf9105a5476..000000000000
--- a/drivers/net/ethernet/broadcom/cnic.c
+++ b/drivers/net/ethernet/broadcom/cnic.c
@@@ -5218,7 -5218,9 +5218,13 @@@ static void cnic_init_rings(struct cnic
  				"iSCSI CLIENT_SETUP did not complete\n");
  		cnic_spq_completion(dev, DRV_CTL_RET_L2_SPQ_CREDIT_CMD, 1);
  		cnic_ring_ctl(dev, cid, cli, 1);
++<<<<<<< HEAD
 +		*cid_ptr = cid;
++=======
+ 		*cid_ptr = cid >> 4;
+ 		*(cid_ptr + 1) = cid * bp->db_size;
+ 		*(cid_ptr + 2) = UIO_USE_TX_DOORBELL;
++>>>>>>> d15e2a92c4c2 (cnic: Add a signature to indicate valid doorbell offset.)
  	}
  }
  
* Unmerged path drivers/net/ethernet/broadcom/cnic.c
diff --git a/drivers/net/ethernet/broadcom/cnic.h b/drivers/net/ethernet/broadcom/cnic.h
index 0121a5d55192..0d6b13f854d9 100644
--- a/drivers/net/ethernet/broadcom/cnic.h
+++ b/drivers/net/ethernet/broadcom/cnic.h
@@ -186,6 +186,8 @@ struct kcq_info {
 	u16		(*hw_idx)(u16);
 };
 
+#define UIO_USE_TX_DOORBELL 0x017855DB
+
 struct cnic_uio_dev {
 	struct uio_info		cnic_uinfo;
 	u32			uio_dev;
diff --git a/drivers/net/ethernet/broadcom/cnic_if.h b/drivers/net/ethernet/broadcom/cnic_if.h
index 0658b43e148c..6cad5cda893f 100644
--- a/drivers/net/ethernet/broadcom/cnic_if.h
+++ b/drivers/net/ethernet/broadcom/cnic_if.h
@@ -14,8 +14,8 @@
 
 #include "bnx2x/bnx2x_mfw_req.h"
 
-#define CNIC_MODULE_VERSION	"2.5.18"
-#define CNIC_MODULE_RELDATE	"Sept 01, 2013"
+#define CNIC_MODULE_VERSION	"2.5.19"
+#define CNIC_MODULE_RELDATE	"December 19, 2013"
 
 #define CNIC_ULP_RDMA		0
 #define CNIC_ULP_ISCSI		1
