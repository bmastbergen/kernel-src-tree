netfilter: nf_tables: complete net namespace support

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-123.el7
commit-author Pablo Neira Ayuso <pablo@netfilter.org>
commit 99633ab29b2131b68089a6c7f60458390860e044
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-123.el7/99633ab2.failed

Register family per netnamespace to ensure that sets are
only visible in its approapriate namespace.

	Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
(cherry picked from commit 99633ab29b2131b68089a6c7f60458390860e044)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	include/net/netfilter/nf_tables.h
#	net/bridge/netfilter/nf_tables_bridge.c
#	net/ipv4/netfilter/nf_tables_ipv4.c
#	net/ipv6/netfilter/nf_tables_ipv6.c
#	net/netfilter/nf_tables_api.c
* Unmerged path include/net/netfilter/nf_tables.h
* Unmerged path net/bridge/netfilter/nf_tables_bridge.c
* Unmerged path net/ipv4/netfilter/nf_tables_ipv4.c
* Unmerged path net/ipv6/netfilter/nf_tables_ipv6.c
* Unmerged path net/netfilter/nf_tables_api.c
diff --git a/include/net/net_namespace.h b/include/net/net_namespace.h
index b17697827482..3ee206f7b454 100644
--- a/include/net/net_namespace.h
+++ b/include/net/net_namespace.h
@@ -22,6 +22,7 @@
 #if defined(CONFIG_NF_CONNTRACK) || defined(CONFIG_NF_CONNTRACK_MODULE)
 #include <net/netns/conntrack.h>
 #endif
+#include <net/netns/nftables.h>
 #include <net/netns/xfrm.h>
 
 struct user_namespace;
@@ -100,6 +101,9 @@ struct net {
 #if defined(CONFIG_NF_CONNTRACK) || defined(CONFIG_NF_CONNTRACK_MODULE)
 	struct netns_ct		ct;
 #endif
+#if defined(CONFIG_NF_TABLES) || defined(CONFIG_NF_TABLES_MODULE)
+	struct netns_nftables	nft;
+#endif
 #if IS_ENABLED(CONFIG_NF_DEFRAG_IPV6)
 	struct netns_nf_frag	nf_frag;
 #endif
* Unmerged path include/net/netfilter/nf_tables.h
diff --git a/include/net/netns/nftables.h b/include/net/netns/nftables.h
new file mode 100644
index 000000000000..a98b1c5d9913
--- /dev/null
+++ b/include/net/netns/nftables.h
@@ -0,0 +1,15 @@
+#ifndef _NETNS_NFTABLES_H_
+#define _NETNS_NFTABLES_H_
+
+#include <linux/list.h>
+
+struct nft_af_info;
+
+struct netns_nftables {
+	struct list_head	af_info;
+	struct nft_af_info	*ipv4;
+	struct nft_af_info	*ipv6;
+	struct nft_af_info	*bridge;
+};
+
+#endif
* Unmerged path net/bridge/netfilter/nf_tables_bridge.c
* Unmerged path net/ipv4/netfilter/nf_tables_ipv4.c
* Unmerged path net/ipv6/netfilter/nf_tables_ipv6.c
* Unmerged path net/netfilter/nf_tables_api.c
