ALSA: hda - Fix bad EAPD setup for HP machines with AD1984A

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-123.el7
Rebuild_CHGLOG: - [alsa] hda: Fix bad EAPD setup for HP machines with AD1984A (Jaroslav Kysela) [1044022]
Rebuild_FUZZ: 91.89%
commit-author Takashi Iwai <tiwai@suse.de>
commit 1cd9b2f78bf29d5282e02b32f9b3ecebc5842a7c
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-123.el7/1cd9b2f7.failed

It seems that EAPD on NID 0x16 is the only control over all outputs on
HP machines with AD1984A while turning EAPD on NID 0x12 breaks the
output.  Thus we need to avoid fiddling EAPD on NID.  As a quick
workaround, just set own_eapd_ctrl flag for the wrong EAPD, then
implement finer EAPD controls.

Bugzilla: https://bugzilla.kernel.org/show_bug.cgi?id=66321
	Cc: <stable@vger.kernel.org>
	Signed-off-by: Takashi Iwai <tiwai@suse.de>
(cherry picked from commit 1cd9b2f78bf29d5282e02b32f9b3ecebc5842a7c)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	sound/pci/hda/patch_analog.c
diff --cc sound/pci/hda/patch_analog.c
index dd94b3ac9e08,34d86ec5d3dd..000000000000
--- a/sound/pci/hda/patch_analog.c
+++ b/sound/pci/hda/patch_analog.c
@@@ -935,8 -952,20 +935,18 @@@ static void ad1884_fixup_hp_eapd(struc
  				 const struct hda_fixup *fix, int action)
  {
  	struct ad198x_spec *spec = codec->spec;
 -	static const struct hda_verb gpio_init_verbs[] = {
 -		{0x01, AC_VERB_SET_GPIO_MASK, 0x02},
 -		{0x01, AC_VERB_SET_GPIO_DIRECTION, 0x02},
 -		{0x01, AC_VERB_SET_GPIO_DATA, 0x02},
 -		{},
 -	};
  
++<<<<<<< HEAD
 +	if (action == HDA_FIXUP_ACT_PRE_PROBE) {
++=======
+ 	switch (action) {
+ 	case HDA_FIXUP_ACT_PRE_PROBE:
+ 		spec->gen.vmaster_mute.hook = ad1884_vmaster_hp_gpio_hook;
+ 		spec->gen.own_eapd_ctl = 1;
+ 		snd_hda_sequence_write_cache(codec, gpio_init_verbs);
+ 		break;
+ 	case HDA_FIXUP_ACT_PROBE:
++>>>>>>> 1cd9b2f78bf2 (ALSA: hda - Fix bad EAPD setup for HP machines with AD1984A)
  		if (spec->gen.autocfg.line_out_type == AUTO_PIN_SPEAKER_OUT)
  			spec->eapd_nid = spec->gen.autocfg.line_out_pins[0];
  		else
* Unmerged path sound/pci/hda/patch_analog.c
