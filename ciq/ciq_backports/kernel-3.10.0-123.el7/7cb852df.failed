NFSv4.1: fix SECINFO* use of put_rpccred

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-123.el7
Rebuild_CHGLOG: - [fs] nfs: fix SECINFO* use of put_rpccred (Jeff Layton) [1009119]
Rebuild_FUZZ: 94.74%
commit-author Weston Andros Adamson <dros@netapp.com>
commit 7cb852dfc858e9ab092cbbfcb3e57bae4aa7f56a
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-123.el7/7cb852df.failed

Recent SP4_MACH_CRED changes allows rpc_message.rpc_cred to change,
so keep a separate pointer to the machine cred for put_rpccred.

	Signed-off-by: Weston Andros Adamson <dros@netapp.com>
	Signed-off-by: Trond Myklebust <Trond.Myklebust@netapp.com>
(cherry picked from commit 7cb852dfc858e9ab092cbbfcb3e57bae4aa7f56a)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	fs/nfs/nfs4proc.c
diff --cc fs/nfs/nfs4proc.c
index 41189a249935,4b6a2f05b335..000000000000
--- a/fs/nfs/nfs4proc.c
+++ b/fs/nfs/nfs4proc.c
@@@ -5543,11 -6002,27 +5543,29 @@@ static int _nfs4_proc_secinfo(struct in
  		.rpc_argp = &args,
  		.rpc_resp = &res,
  	};
++<<<<<<< HEAD
 +	struct rpc_clnt *clnt = NFS_SERVER(dir)->nfs_client->cl_rpcclient;
++=======
+ 	struct rpc_clnt *clnt = NFS_SERVER(dir)->client;
+ 	struct rpc_cred *cred = NULL;
+ 
+ 	if (use_integrity) {
+ 		clnt = NFS_SERVER(dir)->nfs_client->cl_rpcclient;
+ 		cred = nfs4_get_clid_cred(NFS_SERVER(dir)->nfs_client);
+ 		msg.rpc_cred = cred;
+ 	}
++>>>>>>> 7cb852dfc858 (NFSv4.1: fix SECINFO* use of put_rpccred)
  
  	dprintk("NFS call  secinfo %s\n", name->name);
 -
 -	nfs4_state_protect(NFS_SERVER(dir)->nfs_client,
 -		NFS_SP4_MACH_CRED_SECINFO, &clnt, &msg);
 -
 -	status = nfs4_call_sync(clnt, NFS_SERVER(dir), &msg, &args.seq_args,
 -				&res.seq_res, 0);
 +	status = nfs4_call_sync(clnt, NFS_SERVER(dir), &msg, &args.seq_args, &res.seq_res, 0);
  	dprintk("NFS reply  secinfo: %d\n", status);
++<<<<<<< HEAD
++=======
+ 
+ 	if (cred)
+ 		put_rpccred(cred);
+ 
++>>>>>>> 7cb852dfc858 (NFSv4.1: fix SECINFO* use of put_rpccred)
  	return status;
  }
  
* Unmerged path fs/nfs/nfs4proc.c
