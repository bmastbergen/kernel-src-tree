powerpc/pseries: Fix endian issues in pseries EEH code

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-123.el7
Rebuild_CHGLOG: - [powerpc] pseries: Fix endian issues in pseries EEH code (Steve Best) [1051192]
Rebuild_FUZZ: 92.00%
commit-author Anton Blanchard <anton@samba.org>
commit b91da2d4ce896c324bdbf1a078dbbe2db9a35ef1
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-123.el7/b91da2d4.failed

	Signed-off-by: Anton Blanchard <anton@samba.org>
	Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
(cherry picked from commit b91da2d4ce896c324bdbf1a078dbbe2db9a35ef1)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/powerpc/platforms/pseries/eeh_pseries.c
diff --cc arch/powerpc/platforms/pseries/eeh_pseries.c
index b456b157d33d,ccb633e077b1..000000000000
--- a/arch/powerpc/platforms/pseries/eeh_pseries.c
+++ b/arch/powerpc/platforms/pseries/eeh_pseries.c
@@@ -146,8 -188,11 +146,16 @@@ static void *pseries_eeh_of_probe(struc
  {
  	struct eeh_dev *edev;
  	struct eeh_pe pe;
++<<<<<<< HEAD
 +	const u32 *class_code, *vendor_id, *device_id;
 +	const u32 *regs;
++=======
+ 	struct pci_dn *pdn = PCI_DN(dn);
+ 	const __be32 *classp, *vendorp, *devicep;
+ 	u32 class_code;
+ 	const __be32 *regs;
+ 	u32 pcie_flags;
++>>>>>>> b91da2d4ce89 (powerpc/pseries: Fix endian issues in pseries EEH code)
  	int enable = 0;
  	int ret;
  
@@@ -167,9 -212,28 +175,34 @@@
  	if (dn->type && !strcmp(dn->type, "isa"))
  		return NULL;
  
++<<<<<<< HEAD
 +	/* Update class code and mode of eeh device */
 +	edev->class_code = *class_code;
 +	edev->mode = 0;
++=======
+ 	class_code = of_read_number(classp, 1);
+ 
+ 	/*
+ 	 * Update class code and mode of eeh device. We need
+ 	 * correctly reflects that current device is root port
+ 	 * or PCIe switch downstream port.
+ 	 */
+ 	edev->class_code = class_code;
+ 	edev->pcie_cap = pseries_eeh_find_cap(dn, PCI_CAP_ID_EXP);
+ 	edev->mode &= 0xFFFFFF00;
+ 	if ((edev->class_code >> 8) == PCI_CLASS_BRIDGE_PCI) {
+ 		edev->mode |= EEH_DEV_BRIDGE;
+ 		if (edev->pcie_cap) {
+ 			rtas_read_config(pdn, edev->pcie_cap + PCI_EXP_FLAGS,
+ 					 2, &pcie_flags);
+ 			pcie_flags = (pcie_flags & PCI_EXP_FLAGS_TYPE) >> 4;
+ 			if (pcie_flags == PCI_EXP_TYPE_ROOT_PORT)
+ 				edev->mode |= EEH_DEV_ROOT_PORT;
+ 			else if (pcie_flags == PCI_EXP_TYPE_DOWNSTREAM)
+ 				edev->mode |= EEH_DEV_DS_PORT;
+ 		}
+ 	}
++>>>>>>> b91da2d4ce89 (powerpc/pseries: Fix endian issues in pseries EEH code)
  
  	/* Retrieve the device address */
  	regs = of_get_property(dn, "reg", NULL);
* Unmerged path arch/powerpc/platforms/pseries/eeh_pseries.c
