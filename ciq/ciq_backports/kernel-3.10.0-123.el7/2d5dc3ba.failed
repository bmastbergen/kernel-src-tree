xen-blkfront: Introduce a 'max' module parameter to alter the amount of indirect segments.

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-123.el7
Rebuild_CHGLOG: - [virt] xen-blkfront: Introduce a 'max' module parameter to alter the amount of indirect segments (Radim Krcmar) [1003683]
Rebuild_FUZZ: 99.44%
commit-author Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>
commit 2d5dc3ba853344f39a41ae5bdb0a337b2ecaafa6
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-123.el7/2d5dc3ba.failed

The max module parameter (by default 32) is the maximum number of
segments that the frontend will negotiate with the backend for indirect
descriptors.  Higher value means more potential throughput but more
memory usage. The backend picks the minimum of the frontend and its
default backend value.

	Signed-off-by: Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>
(cherry picked from commit 2d5dc3ba853344f39a41ae5bdb0a337b2ecaafa6)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/block/xen-blkfront.c
diff --cc drivers/block/xen-blkfront.c
index d89ef86220f4,08bdfc3b2de2..000000000000
--- a/drivers/block/xen-blkfront.c
+++ b/drivers/block/xen-blkfront.c
@@@ -80,6 -88,16 +80,19 @@@ struct blk_shadow 
  static DEFINE_MUTEX(blkfront_mutex);
  static const struct block_device_operations xlvbd_block_fops;
  
++<<<<<<< HEAD
++=======
+ /*
+  * Maximum number of segments in indirect requests, the actual value used by
+  * the frontend driver is the minimum of this value and the value provided
+  * by the backend driver.
+  */
+ 
+ static unsigned int xen_blkif_max_segments = 32;
+ module_param_named(max, xen_blkif_max_segments, int, S_IRUGO);
+ MODULE_PARM_DESC(max, "Maximum amount of segments in indirect requests (default is 32)");
+ 
++>>>>>>> 2d5dc3ba8533 (xen-blkfront: Introduce a 'max' module parameter to alter the amount of indirect segments.)
  #define BLK_RING_SIZE __CONST_RING_SIZE(blkif, PAGE_SIZE)
  
  /*
diff --git a/Documentation/ABI/testing/sysfs-driver-xen-blkfront b/Documentation/ABI/testing/sysfs-driver-xen-blkfront
new file mode 100644
index 000000000000..c0a6cb7eb314
--- /dev/null
+++ b/Documentation/ABI/testing/sysfs-driver-xen-blkfront
@@ -0,0 +1,10 @@
+What:           /sys/module/xen_blkfront/parameters/max
+Date:           June 2013
+KernelVersion:  3.11
+Contact:        Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>
+Description:
+                Maximum number of segments that the frontend will negotiate
+                with the backend for indirect descriptors. The default value
+                is 32 - higher value means more potential throughput but more
+                memory usage. The backend picks the minimum of the frontend
+                and its default backend value.
* Unmerged path drivers/block/xen-blkfront.c
