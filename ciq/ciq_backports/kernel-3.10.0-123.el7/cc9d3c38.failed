dm mpath: do not fail path on -ENOSPC

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-123.el7
Rebuild_CHGLOG: - [md] dm-mpath: do not fail path on -ENOSPC (Mike Snitzer) [1010437]
Rebuild_FUZZ: 97.30%
commit-author Jun'ichi Nomura <j-nomura@ce.jp.nec.com>
commit cc9d3c382bc1674884c2e5e468d51230a9503dee
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-123.el7/cc9d3c38.failed

Since ENOSPC is a target-side error, dm-mpath should just pass the error
information to upper layer instead of retrying itself with path failover.
Otherwise it will end up failing all paths down while path checkers find
all paths ok.

ENOSPC can now be returned from SCSI device after commit a9d6ceb8
("[SCSI] return ENOSPC on thin provisioning failure").

	Signed-off-by: Jun'ichi Nomura <j-nomura@ce.jp.nec.com>
	Acked-by: Hannes Reinecke <hare@suse.de>
	Signed-off-by: Mike Snitzer <snitzer@redhat.com>
(cherry picked from commit cc9d3c382bc1674884c2e5e468d51230a9503dee)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/md/dm-mpath.c
diff --cc drivers/md/dm-mpath.c
index 5adede17ddf6,075747e25f77..000000000000
--- a/drivers/md/dm-mpath.c
+++ b/drivers/md/dm-mpath.c
@@@ -1261,6 -1261,21 +1261,24 @@@ static void activate_path(struct work_s
  				pg_init_done, pgpath);
  }
  
++<<<<<<< HEAD
++=======
+ static int noretry_error(int error)
+ {
+ 	switch (error) {
+ 	case -EOPNOTSUPP:
+ 	case -EREMOTEIO:
+ 	case -EILSEQ:
+ 	case -ENODATA:
+ 	case -ENOSPC:
+ 		return 1;
+ 	}
+ 
+ 	/* Anything else could be a path failure, so should be retried */
+ 	return 0;
+ }
+ 
++>>>>>>> cc9d3c382bc1 (dm mpath: do not fail path on -ENOSPC)
  /*
   * end_io handling
   */
* Unmerged path drivers/md/dm-mpath.c
