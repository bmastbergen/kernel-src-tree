ALSA: hda - WAKEEN feature enabling for runtime pm

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-123.el7
Rebuild_CHGLOG: - [alsa] hda: WAKEEN feature enabling for runtime pm (Jaroslav Kysela) [1044022]
Rebuild_FUZZ: 90.32%
commit-author Wang Xingchao <xingchao.wang@linux.intel.com>
commit 7d4f606c50ffaaa3ac60b7faf770dc6e84af3207
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-123.el7/7d4f606c.failed

With runtime power save feature enabled, Headphone hotplug
event will not be detected while controller/codec in D3. HDA has
feature WAKEEN to let codec wake up system if controller is in D3 or
system in S3.(HDA Spec 4.5.9.2/3). Codec can send out INT or wake up
controller depending on whether CIE or GIE enabled.(Figure 4, Interupt
structure).

The controller must be in RESET mode after enter runtime-suspend, otherwise
it will not be waken up even if codec send out wake-up event. And STATESTS
will be cleared after controller brought out of RESET mode.

This patch only enable WAKEEN for runtime-suspend(Controller D3) mode,
not for system S3 mode. with tool "evtest", Headphone hotplug events
could be cought and reported successfully.

[fixed an unused variable warning by tiwai]

	Signed-off-by: Wang Xingchao <xingchao.wang@linux.intel.com>
	Signed-off-by: Takashi Iwai <tiwai@suse.de>
(cherry picked from commit 7d4f606c50ffaaa3ac60b7faf770dc6e84af3207)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	sound/pci/hda/hda_intel.c
diff --cc sound/pci/hda/hda_intel.c
index cfca97ee3127,7f9e4062a8d7..000000000000
--- a/sound/pci/hda/hda_intel.c
+++ b/sound/pci/hda/hda_intel.c
@@@ -2971,9 -2987,31 +2975,34 @@@ static int azx_runtime_resume(struct de
  {
  	struct snd_card *card = dev_get_drvdata(dev);
  	struct azx *chip = card->private_data;
+ 	struct hda_bus *bus;
+ 	struct hda_codec *codec;
+ 	int status;
+ 
++<<<<<<< HEAD
++=======
+ 	if (chip->driver_caps & AZX_DCAPS_I915_POWERWELL)
+ 		hda_display_power(true);
+ 
+ 	/* Read STATESTS before controller reset */
+ 	status = azx_readw(chip, STATESTS);
  
++>>>>>>> 7d4f606c50ff (ALSA: hda - WAKEEN feature enabling for runtime pm)
  	azx_init_pci(chip);
  	azx_init_chip(chip, 1);
+ 
+ 	bus = chip->bus;
+ 	if (status && bus) {
+ 		list_for_each_entry(codec, &bus->codec_list, list)
+ 			if (status & (1 << codec->addr))
+ 				queue_delayed_work(codec->bus->workq,
+ 						   &codec->jackpoll_work, codec->jackpoll_interval);
+ 	}
+ 
+ 	/* disable controller Wake Up event*/
+ 	azx_writew(chip, WAKEEN, azx_readw(chip, WAKEEN) &
+ 			~STATESTS_INT_MASK);
+ 
  	return 0;
  }
  
* Unmerged path sound/pci/hda/hda_intel.c
