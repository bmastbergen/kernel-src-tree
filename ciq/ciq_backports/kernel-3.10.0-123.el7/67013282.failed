ip_tunnel: Add fallback tunnels to the hash lists

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-123.el7
commit-author Steffen Klassert <steffen.klassert@secunet.com>
commit 67013282627185aeec2fb92c75868dcace0d25b4
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-123.el7/67013282.failed

Currently we can not update the tunnel parameters of
the fallback tunnels because we don't find them in the
hash lists. Fix this by adding them on initialization.

Bug was introduced with commit c544193214
("GRE: Refactor GRE tunneling code.")

	Cc: Pravin Shelar <pshelar@nicira.com>
	Signed-off-by: Steffen Klassert <steffen.klassert@secunet.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 67013282627185aeec2fb92c75868dcace0d25b4)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/ipv4/ip_tunnel.c
diff --cc net/ipv4/ip_tunnel.c
index 9fdf8a6d95f3,895a3535321b..000000000000
--- a/net/ipv4/ip_tunnel.c
+++ b/net/ipv4/ip_tunnel.c
@@@ -854,12 -850,16 +854,22 @@@ int ip_tunnel_init_net(struct net *net
  
  	rtnl_lock();
  	itn->fb_tunnel_dev = __ip_tunnel_create(net, ops, &parms);
++<<<<<<< HEAD
++=======
+ 	/* FB netdevice is special: we have one, and only one per netns.
+ 	 * Allowing to move it to another netns is clearly unsafe.
+ 	 */
+ 	if (!IS_ERR(itn->fb_tunnel_dev)) {
+ 		itn->fb_tunnel_dev->features |= NETIF_F_NETNS_LOCAL;
+ 		ip_tunnel_add(itn, netdev_priv(itn->fb_tunnel_dev));
+ 	}
++>>>>>>> 670132826271 (ip_tunnel: Add fallback tunnels to the hash lists)
  	rtnl_unlock();
  
 -	return PTR_RET(itn->fb_tunnel_dev);
 +	if (IS_ERR(itn->fb_tunnel_dev))
 +		return PTR_ERR(itn->fb_tunnel_dev);
 +
 +	return 0;
  }
  EXPORT_SYMBOL_GPL(ip_tunnel_init_net);
  
* Unmerged path net/ipv4/ip_tunnel.c
