s390/pci: implement hotplug notifications

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-123.el7
Rebuild_CHGLOG: - [s390] pci: implement hotplug notifications (Hendrik Brueckner) [1030312]
Rebuild_FUZZ: 93.51%
commit-author Sebastian Ott <sebott@linux.vnet.ibm.com>
commit d795ddad36cbc828176c898a5084549030539162
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-123.el7/d795ddad.failed

When the availability of a pci function has changed by means
outside of our control we receive an availability event.
Implement/improve the handling of these notifications.

	Reviewed-by: Gerald Schaefer <gerald.schaefer@de.ibm.com>
	Signed-off-by: Sebastian Ott <sebott@linux.vnet.ibm.com>
	Signed-off-by: Martin Schwidefsky <schwidefsky@de.ibm.com>
(cherry picked from commit d795ddad36cbc828176c898a5084549030539162)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/s390/pci/pci_event.c
diff --cc arch/s390/pci/pci_event.c
index bbbed1e7538f,800f064b0da7..000000000000
--- a/arch/s390/pci/pci_event.c
+++ b/arch/s390/pci/pci_event.c
@@@ -42,31 -43,6 +43,34 @@@ struct zpci_ccdf_avail 
  	u16 pec;			/* PCI event code */
  } __packed;
  
++<<<<<<< HEAD
 +static void zpci_event_log_avail(struct zpci_ccdf_avail *ccdf)
 +{
 +	struct zpci_dev *zdev = get_zdev_by_fid(ccdf->fid);
 +	struct pci_dev *pdev = zdev ? zdev->pdev : NULL;
 +
 +	pr_info("%s: Event 0x%x reconfigured PCI function 0x%x\n",
 +		pdev ? pci_name(pdev) : "n/a", ccdf->pec, ccdf->fid);
 +	zpci_err("avail CCDF:\n");
 +	zpci_err_hex(ccdf, sizeof(*ccdf));
 +
 +	switch (ccdf->pec) {
 +	case 0x0301:
 +		zpci_enable_device(zdev);
 +		break;
 +	case 0x0302:
 +		clp_add_pci_device(ccdf->fid, ccdf->fh, 0);
 +		break;
 +	case 0x0306:
 +		clp_find_pci_devices();
 +		break;
 +	default:
 +		break;
 +	}
 +}
 +
++=======
++>>>>>>> d795ddad36cb (s390/pci: implement hotplug notifications)
  void zpci_event_error(void *data)
  {
  	struct zpci_ccdf_err *ccdf = data;
* Unmerged path arch/s390/pci/pci_event.c
