drm/radeon: program DCE2 audio dto just like DCE3

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-123.el7
Rebuild_CHGLOG: - [drm] radeon: program DCE2 audio dto just like DCE3 (Rob Clark) [1054409]
Rebuild_FUZZ: 95.74%
commit-author Alex Deucher <alexander.deucher@amd.com>
commit 55d4e020fb8ddd3896a8cd3351028f5c3a2c4bd3
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-123.el7/55d4e020.failed

Seems to work like the DCE3 version despite what
the register spec says.

bug:
https://bugs.freedesktop.org/show_bug.cgi?id=71975

	Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
	Cc: stable@vger.kernel.org
(cherry picked from commit 55d4e020fb8ddd3896a8cd3351028f5c3a2c4bd3)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/gpu/drm/radeon/r600_hdmi.c
diff --cc drivers/gpu/drm/radeon/r600_hdmi.c
index 456750a0daa5,b7d3ecba43e3..000000000000
--- a/drivers/gpu/drm/radeon/r600_hdmi.c
+++ b/drivers/gpu/drm/radeon/r600_hdmi.c
@@@ -245,17 -288,35 +245,49 @@@ void r600_audio_set_dto(struct drm_enco
  	 * number (coefficient of two integer numbers.  DCCG_AUDIO_DTOx_PHASE
  	 * is the numerator, DCCG_AUDIO_DTOx_MODULE is the denominator
  	 */
++<<<<<<< HEAD
 +	if (ASIC_IS_DCE3(rdev)) {
 +		/* according to the reg specs, this should DCE3.2 only, but in
 +		 * practice it seems to cover DCE3.0 as well.
 +		 */
 +		WREG32(DCCG_AUDIO_DTO0_PHASE, base_rate * 100);
 +		WREG32(DCCG_AUDIO_DTO0_MODULE, clock * 100);
 +		WREG32(DCCG_AUDIO_DTO_SELECT, 0); /* select DTO0 */
 +	} else {
 +		/* according to the reg specs, this should be DCE2.0 and DCE3.0 */
 +		WREG32(AUDIO_DTO, AUDIO_DTO_PHASE(base_rate / 10) |
 +		       AUDIO_DTO_MODULE(clock / 10));
++=======
+ 	if (ASIC_IS_DCE32(rdev)) {
+ 		if (dig->dig_encoder == 0) {
+ 			dto_cntl = RREG32(DCCG_AUDIO_DTO0_CNTL) & ~DCCG_AUDIO_DTO_WALLCLOCK_RATIO_MASK;
+ 			dto_cntl |= DCCG_AUDIO_DTO_WALLCLOCK_RATIO(wallclock_ratio);
+ 			WREG32(DCCG_AUDIO_DTO0_CNTL, dto_cntl);
+ 			WREG32(DCCG_AUDIO_DTO0_PHASE, dto_phase);
+ 			WREG32(DCCG_AUDIO_DTO0_MODULE, dto_modulo);
+ 			WREG32(DCCG_AUDIO_DTO_SELECT, 0); /* select DTO0 */
+ 		} else {
+ 			dto_cntl = RREG32(DCCG_AUDIO_DTO1_CNTL) & ~DCCG_AUDIO_DTO_WALLCLOCK_RATIO_MASK;
+ 			dto_cntl |= DCCG_AUDIO_DTO_WALLCLOCK_RATIO(wallclock_ratio);
+ 			WREG32(DCCG_AUDIO_DTO1_CNTL, dto_cntl);
+ 			WREG32(DCCG_AUDIO_DTO1_PHASE, dto_phase);
+ 			WREG32(DCCG_AUDIO_DTO1_MODULE, dto_modulo);
+ 			WREG32(DCCG_AUDIO_DTO_SELECT, 1); /* select DTO1 */
+ 		}
+ 	} else {
+ 		/* according to the reg specs, this should DCE3.2 only, but in
+ 		 * practice it seems to cover DCE2.0/3.0/3.1 as well.
+ 		 */
+ 		if (dig->dig_encoder == 0) {
+ 			WREG32(DCCG_AUDIO_DTO0_PHASE, base_rate * 100);
+ 			WREG32(DCCG_AUDIO_DTO0_MODULE, clock * 100);
+ 			WREG32(DCCG_AUDIO_DTO_SELECT, 0); /* select DTO0 */
+ 		} else {
+ 			WREG32(DCCG_AUDIO_DTO1_PHASE, base_rate * 100);
+ 			WREG32(DCCG_AUDIO_DTO1_MODULE, clock * 100);
+ 			WREG32(DCCG_AUDIO_DTO_SELECT, 1); /* select DTO1 */
+ 		}
++>>>>>>> 55d4e020fb8d (drm/radeon: program DCE2 audio dto just like DCE3)
  	}
  }
  
* Unmerged path drivers/gpu/drm/radeon/r600_hdmi.c
