efi-pstore: Make efi-pstore return a unique id

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-123.el7
commit-author Madper Xie <cxie@redhat.com>
commit fdeadb43fdf1e7d5698c027b555c389174548e5a
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-123.el7/fdeadb43.failed

Pstore fs expects that backends provide a unique id which could avoid
pstore making entries as duplication or denominating entries the same
name. So I combine the timestamp, part and count into id.

	Signed-off-by: Madper Xie <cxie@redhat.com>
	Cc: Seiji Aguchi <seiji.aguchi@hds.com>
	Cc: stable@vger.kernel.org
	Signed-off-by: Matt Fleming <matt.fleming@intel.com>
(cherry picked from commit fdeadb43fdf1e7d5698c027b555c389174548e5a)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/firmware/efi/efi-pstore.c
diff --cc drivers/firmware/efi/efi-pstore.c
index 9ff01c4fd69c,743fd426f21b..000000000000
--- a/drivers/firmware/efi/efi-pstore.c
+++ b/drivers/firmware/efi/efi-pstore.c
@@@ -52,9 -59,19 +58,23 @@@ static int efi_pstore_read_func(struct 
  	for (i = 0; i < DUMP_NAME_LEN; i++)
  		name[i] = entry->var.VariableName[i];
  
++<<<<<<< HEAD
 +	if (sscanf(name, "dump-type%u-%u-%d-%lu",
++=======
+ 	if (sscanf(name, "dump-type%u-%u-%d-%lu-%c",
+ 		   cb_data->type, &part, &cnt, &time, &data_type) == 5) {
+ 		*cb_data->id = generic_id(time, part, cnt);
+ 		*cb_data->count = cnt;
+ 		cb_data->timespec->tv_sec = time;
+ 		cb_data->timespec->tv_nsec = 0;
+ 		if (data_type == 'C')
+ 			*cb_data->compressed = true;
+ 		else
+ 			*cb_data->compressed = false;
+ 	} else if (sscanf(name, "dump-type%u-%u-%d-%lu",
++>>>>>>> fdeadb43fdf1 (efi-pstore: Make efi-pstore return a unique id)
  		   cb_data->type, &part, &cnt, &time) == 4) {
- 		*cb_data->id = part;
+ 		*cb_data->id = generic_id(time, part, cnt);
  		*cb_data->count = cnt;
  		cb_data->timespec->tv_sec = time;
  		cb_data->timespec->tv_nsec = 0;
* Unmerged path drivers/firmware/efi/efi-pstore.c
