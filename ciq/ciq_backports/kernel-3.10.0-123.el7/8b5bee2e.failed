nfs4.1: Add SP4_MACH_CRED secinfo support

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-123.el7
Rebuild_CHGLOG: - [fs] nfs: Add SP4_MACH_CRED secinfo suppor (Jeff Layton) [1009119]
Rebuild_FUZZ: 94.87%
commit-author Weston Andros Adamson <dros@netapp.com>
commit 8b5bee2e1b60a611b15b1862f55e60cc9f668324
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-123.el7/8b5bee2e.failed

SECINFO and SECINFO_NONAME can use the machine credential.

	Signed-off-by: Weston Andros Adamson <dros@netapp.com>
	Signed-off-by: Trond Myklebust <Trond.Myklebust@netapp.com>
(cherry picked from commit 8b5bee2e1b60a611b15b1862f55e60cc9f668324)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	fs/nfs/nfs4proc.c
diff --cc fs/nfs/nfs4proc.c
index 74bc306dedb0,5c917c975432..000000000000
--- a/fs/nfs/nfs4proc.c
+++ b/fs/nfs/nfs4proc.c
@@@ -5531,11 -5990,25 +5531,20 @@@ static int _nfs4_proc_secinfo(struct in
  		.rpc_argp = &args,
  		.rpc_resp = &res,
  	};
 -	struct rpc_clnt *clnt = NFS_SERVER(dir)->client;
 -
 -	if (use_integrity) {
 -		clnt = NFS_SERVER(dir)->nfs_client->cl_rpcclient;
 -		msg.rpc_cred = nfs4_get_clid_cred(NFS_SERVER(dir)->nfs_client);
 -	}
 +	struct rpc_clnt *clnt = NFS_SERVER(dir)->nfs_client->cl_rpcclient;
  
  	dprintk("NFS call  secinfo %s\n", name->name);
++<<<<<<< HEAD
 +	status = nfs4_call_sync(clnt, NFS_SERVER(dir), &msg, &args.seq_args, &res.seq_res, 0);
++=======
+ 
+ 	nfs4_state_protect(NFS_SERVER(dir)->nfs_client,
+ 		NFS_SP4_MACH_CRED_SECINFO, &clnt, &msg);
+ 
+ 	status = nfs4_call_sync(clnt, NFS_SERVER(dir), &msg, &args.seq_args,
+ 				&res.seq_res, 0);
++>>>>>>> 8b5bee2e1b60 (nfs4.1: Add SP4_MACH_CRED secinfo support)
  	dprintk("NFS reply  secinfo: %d\n", status);
 -
 -	if (msg.rpc_cred)
 -		put_rpccred(msg.rpc_cred);
 -
  	return status;
  }
  
* Unmerged path fs/nfs/nfs4proc.c
diff --git a/include/linux/nfs_fs_sb.h b/include/linux/nfs_fs_sb.h
index a52a00575751..90f48124bb13 100644
--- a/include/linux/nfs_fs_sb.h
+++ b/include/linux/nfs_fs_sb.h
@@ -95,6 +95,7 @@ struct nfs_client {
 #define NFS_SP4_MACH_CRED_MINIMAL  1	/* Minimal sp4_mach_cred - state ops
 					 * must use machine cred */
 #define NFS_SP4_MACH_CRED_CLEANUP  2	/* CLOSE and LOCKU */
+#define NFS_SP4_MACH_CRED_SECINFO  3	/* SECINFO and SECINFO_NO_NAME */
 #endif /* CONFIG_NFS_V4 */
 
 #ifdef CONFIG_NFS_FSCACHE
