ALSA: hda - Add a headset mic model for ALC269 and friends

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-123.el7
Rebuild_CHGLOG: - [alsa] hda: Add a headset mic model for ALC269 and friends (Jaroslav Kysela) [1044022]
Rebuild_FUZZ: 91.74%
commit-author David Henningsson <david.henningsson@canonical.com>
commit 7c478f03372ad2cf434fde62082895bfcb6e6e89
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-123.el7/7c478f03.failed

Using the headset mic model will cause the headset mic to be labeled
"headset mic" instead of just "mic".

	Signed-off-by: David Henningsson <david.henningsson@canonical.com>
	Signed-off-by: Takashi Iwai <tiwai@suse.de>
(cherry picked from commit 7c478f03372ad2cf434fde62082895bfcb6e6e89)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	Documentation/sound/alsa/HD-Audio-Models.txt
diff --cc Documentation/sound/alsa/HD-Audio-Models.txt
index 459bab0c49d0,85c362d8ea34..000000000000
--- a/Documentation/sound/alsa/HD-Audio-Models.txt
+++ b/Documentation/sound/alsa/HD-Audio-Models.txt
@@@ -21,14 -21,15 +21,24 @@@ ALC267/26
  ==========
    inv-dmic	Inverted internal mic workaround
  
 -ALC269/270/275/276/28x/29x
 +ALC269/270/275/276/280/282
  ======
++<<<<<<< HEAD
 +  laptop-amic	Laptops with analog-mic input
 +  laptop-dmic	Laptops with digital-mic input
 +  alc269-dmic	Enable ALC269(VA) digital mic workaround
 +  alc271-dmic	Enable ALC271X digital mic workaround
 +  inv-dmic	Inverted internal mic workaround
 +  lenovo-dock   Enables docking station I/O for some Lenovos
++=======
+   laptop-amic		Laptops with analog-mic input
+   laptop-dmic		Laptops with digital-mic input
+   alc269-dmic		Enable ALC269(VA) digital mic workaround
+   alc271-dmic		Enable ALC271X digital mic workaround
+   inv-dmic		Inverted internal mic workaround
+   headset-mic		Indicates a combined headset (headphone+mic) jack
+   lenovo-dock   	Enables docking station I/O for some Lenovos
++>>>>>>> 7c478f03372a (ALSA: hda - Add a headset mic model for ALC269 and friends)
    dell-headset-multi	Headset jack, which can also be used as mic-in
    dell-headset-dock	Headset jack (without mic-in), and also dock I/O
  
* Unmerged path Documentation/sound/alsa/HD-Audio-Models.txt
diff --git a/sound/pci/hda/patch_realtek.c b/sound/pci/hda/patch_realtek.c
index 93b4c9efd1bc..31be61f3e046 100644
--- a/sound/pci/hda/patch_realtek.c
+++ b/sound/pci/hda/patch_realtek.c
@@ -2723,6 +2723,15 @@ static void alc269_fixup_hweq(struct hda_codec *codec,
 	alc_write_coef_idx(codec, 0x1e, coef | 0x80);
 }
 
+static void alc269_fixup_headset_mic(struct hda_codec *codec,
+				       const struct hda_fixup *fix, int action)
+{
+	struct alc_spec *spec = codec->spec;
+
+	if (action == HDA_FIXUP_ACT_PRE_PROBE)
+		spec->parse_flags |= HDA_PINCFG_HEADSET_MIC;
+}
+
 static void alc271_fixup_dmic(struct hda_codec *codec,
 			      const struct hda_fixup *fix, int action)
 {
@@ -3411,6 +3420,7 @@ enum {
 	ALC271_FIXUP_DMIC,
 	ALC269_FIXUP_PCM_44K,
 	ALC269_FIXUP_STEREO_DMIC,
+	ALC269_FIXUP_HEADSET_MIC,
 	ALC269_FIXUP_QUANTA_MUTE,
 	ALC269_FIXUP_LIFEBOOK,
 	ALC269_FIXUP_AMIC,
@@ -3507,6 +3517,10 @@ static const struct hda_fixup alc269_fixups[] = {
 		.type = HDA_FIXUP_FUNC,
 		.v.func = alc269_fixup_stereo_dmic,
 	},
+	[ALC269_FIXUP_HEADSET_MIC] = {
+		.type = HDA_FIXUP_FUNC,
+		.v.func = alc269_fixup_headset_mic,
+	},
 	[ALC269_FIXUP_QUANTA_MUTE] = {
 		.type = HDA_FIXUP_FUNC,
 		.v.func = alc269_fixup_quanta_mute,
@@ -3849,6 +3863,7 @@ static const struct hda_model_fixup alc269_fixup_models[] = {
 	{.id = ALC269_FIXUP_STEREO_DMIC, .name = "alc269-dmic"},
 	{.id = ALC271_FIXUP_DMIC, .name = "alc271-dmic"},
 	{.id = ALC269_FIXUP_INV_DMIC, .name = "inv-dmic"},
+	{.id = ALC269_FIXUP_HEADSET_MIC, .name = "headset-mic"},
 	{.id = ALC269_FIXUP_LENOVO_DOCK, .name = "lenovo-dock"},
 	{.id = ALC269_FIXUP_HP_GPIO_LED, .name = "hp-gpio-led"},
 	{.id = ALC269_FIXUP_DELL1_MIC_NO_PRESENCE, .name = "dell-headset-multi"},
