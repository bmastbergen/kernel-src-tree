ipv6 addrconf: introduce IFA_F_MANAGETEMPADDR to tell kernel to manage temporary addresses

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-123.el7
Rebuild_CHGLOG: - [net] ipv6: addrconf: introduce IFA_F_MANAGETEMPADDR to tell kernel to manage temporary addresses (Jiri Pirko) [1021871]
Rebuild_FUZZ: 99.45%
commit-author Jiri Pirko <jiri@resnulli.us>
commit 53bd674915379d91e0e505332c89741b34eab05c
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-123.el7/53bd6749.failed

Creating an address with this flag set will result in kernel taking care
of temporary addresses in the same way as if the address was created by
kernel itself (after RA receive). This allows userspace applications
implementing the autoconfiguration (NetworkManager for example) to
implement ipv6 addresses privacy.

	Signed-off-by: Jiri Pirko <jiri@resnulli.us>
	Signed-off-by: Thomas Haller <thaller@redhat.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 53bd674915379d91e0e505332c89741b34eab05c)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/ipv6/addrconf.c
diff --cc net/ipv6/addrconf.c
index fd3249676845,5087cc5cb810..000000000000
--- a/net/ipv6/addrconf.c
+++ b/net/ipv6/addrconf.c
@@@ -2183,9 -2246,8 +2251,8 @@@ ok
  		}
  
  		if (ifp) {
 -			u32 flags;
 +			int flags;
  			unsigned long now;
- 			struct inet6_ifaddr *ift;
  			u32 stored_lft;
  
  			/* update lifetime (RFC2462 5.5.3 e) */
@@@ -3755,8 -3706,10 +3782,12 @@@ inet6_rtm_newaddr(struct sk_buff *skb, 
  	if (dev == NULL)
  		return -ENODEV;
  
 -	ifa_flags = tb[IFA_FLAGS] ? nla_get_u32(tb[IFA_FLAGS]) : ifm->ifa_flags;
 -
  	/* We ignore other flags so far. */
++<<<<<<< HEAD
 +	ifa_flags = ifm->ifa_flags & (IFA_F_NODAD | IFA_F_HOMEADDRESS);
++=======
+ 	ifa_flags &= IFA_F_NODAD | IFA_F_HOMEADDRESS | IFA_F_MANAGETEMPADDR;
++>>>>>>> 53bd67491537 (ipv6 addrconf: introduce IFA_F_MANAGETEMPADDR to tell kernel to manage temporary addresses)
  
  	ifa = ipv6_get_ifaddr(net, pfx, dev, 1);
  	if (ifa == NULL) {
diff --git a/include/uapi/linux/if_addr.h b/include/uapi/linux/if_addr.h
index 23357ab81a77..1438e6a0b8b8 100644
--- a/include/uapi/linux/if_addr.h
+++ b/include/uapi/linux/if_addr.h
@@ -44,6 +44,7 @@ enum {
 #define IFA_F_DEPRECATED	0x20
 #define IFA_F_TENTATIVE		0x40
 #define IFA_F_PERMANENT		0x80
+#define IFA_F_MANAGETEMPADDR	0x100
 
 struct ifa_cacheinfo {
 	__u32	ifa_prefered;
* Unmerged path net/ipv6/addrconf.c
