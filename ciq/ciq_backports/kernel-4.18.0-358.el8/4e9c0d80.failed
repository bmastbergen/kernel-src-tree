KVM: x86/mmu: Use MMU's role to get CR4.PSE for computing rsvd bits

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-358.el8
commit-author Sean Christopherson <seanjc@google.com>
commit 4e9c0d80dbbd2dd411d726ed10eccaaba6d63a08
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-358.el8/4e9c0d80.failed

Use the MMU's role to get CR4.PSE when calculating reserved bits for the
guest's PTEs.  Practically speaking, this is a glorified nop as the role
always come from vCPU state for the relevant flows, but converting to
the roles will provide consistency once everything else is converted, and
will Just Work if the "always comes from vCPU" behavior were ever to
change (unlikely).

	Signed-off-by: Sean Christopherson <seanjc@google.com>
Message-Id: <20210622175739.3610207-31-seanjc@google.com>
	Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>
(cherry picked from commit 4e9c0d80dbbd2dd411d726ed10eccaaba6d63a08)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/x86/kvm/mmu/mmu.c
diff --cc arch/x86/kvm/mmu/mmu.c
index 8d5c79f00f21,3a8af50e1510..000000000000
--- a/arch/x86/kvm/mmu/mmu.c
+++ b/arch/x86/kvm/mmu/mmu.c
@@@ -4244,7 -4216,8 +4244,12 @@@ static void reset_rsvds_bits_mask(struc
  				vcpu->arch.reserved_gpa_bits,
  				context->root_level, context->nx,
  				guest_cpuid_has(vcpu, X86_FEATURE_GBPAGES),
++<<<<<<< HEAD
 +				is_pse(vcpu), guest_cpuid_is_amd(vcpu));
++=======
+ 				is_cr4_pse(context),
+ 				guest_cpuid_is_amd_or_hygon(vcpu));
++>>>>>>> 4e9c0d80dbbd (KVM: x86/mmu: Use MMU's role to get CR4.PSE for computing rsvd bits)
  }
  
  static void
* Unmerged path arch/x86/kvm/mmu/mmu.c
