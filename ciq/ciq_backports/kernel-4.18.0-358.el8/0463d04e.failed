printk: reduce setup_text_buf size to LOG_LINE_MAX

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-358.el8
commit-author John Ogness <john.ogness@linutronix.de>
commit 0463d04ea03a12d8a5aad42197a5945dfd78d7d6
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-358.el8/0463d04e.failed

@setup_text_buf only copies the original text messages (without any
prefix or extended text). It only needs to be LOG_LINE_MAX in size.

	Signed-off-by: John Ogness <john.ogness@linutronix.de>
	Reviewed-by: Petr Mladek <pmladek@suse.com>
	Signed-off-by: Petr Mladek <pmladek@suse.com>
Link: https://lore.kernel.org/r/20200930090134.8723-3-john.ogness@linutronix.de
(cherry picked from commit 0463d04ea03a12d8a5aad42197a5945dfd78d7d6)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	kernel/printk/printk.c
diff --cc kernel/printk/printk.c
index c1fedccb5ed4,f5c2945d1e3f..000000000000
--- a/kernel/printk/printk.c
+++ b/kernel/printk/printk.c
@@@ -1166,8 -1070,42 +1166,38 @@@ static void __init set_percpu_data_read
  	__printk_percpu_data_ready = true;
  }
  
++<<<<<<< HEAD
++=======
+ static unsigned int __init add_to_rb(struct printk_ringbuffer *rb,
+ 				     struct printk_record *r)
+ {
+ 	struct prb_reserved_entry e;
+ 	struct printk_record dest_r;
+ 
+ 	prb_rec_init_wr(&dest_r, r->info->text_len);
+ 
+ 	if (!prb_reserve(&e, rb, &dest_r))
+ 		return 0;
+ 
+ 	memcpy(&dest_r.text_buf[0], &r->text_buf[0], r->info->text_len);
+ 	dest_r.info->text_len = r->info->text_len;
+ 	dest_r.info->facility = r->info->facility;
+ 	dest_r.info->level = r->info->level;
+ 	dest_r.info->flags = r->info->flags;
+ 	dest_r.info->ts_nsec = r->info->ts_nsec;
+ 	dest_r.info->caller_id = r->info->caller_id;
+ 	memcpy(&dest_r.info->dev_info, &r->info->dev_info, sizeof(dest_r.info->dev_info));
+ 
+ 	prb_final_commit(&e);
+ 
+ 	return prb_record_text_space(&e);
+ }
+ 
+ static char setup_text_buf[LOG_LINE_MAX] __initdata;
+ 
++>>>>>>> 0463d04ea03a (printk: reduce setup_text_buf size to LOG_LINE_MAX)
  void __init setup_log_buf(int early)
  {
 -	struct printk_info *new_infos;
 -	unsigned int new_descs_count;
 -	struct prb_desc *new_descs;
 -	struct printk_info info;
 -	struct printk_record r;
 -	size_t new_descs_size;
 -	size_t new_infos_size;
  	unsigned long flags;
  	char *new_log_buf;
  	unsigned int free;
* Unmerged path kernel/printk/printk.c
