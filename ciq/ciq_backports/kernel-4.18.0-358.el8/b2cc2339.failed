Bluetooth: Enable RPA Timeout

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-358.el8
commit-author Sathish Narasimman <nsathish41@gmail.com>
commit b2cc23398e8166b38f8715026273503b081c2a7a
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-358.el8/b2cc2339.failed

Enable RPA timeout during bluetooth initialization.
The RPA timeout value is used from hdev, which initialized from
debug_fs

	Signed-off-by: Sathish Narasimman <sathish.narasimman@intel.com>
	Signed-off-by: Marcel Holtmann <marcel@holtmann.org>
(cherry picked from commit b2cc23398e8166b38f8715026273503b081c2a7a)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/bluetooth/hci_core.c
diff --cc net/bluetooth/hci_core.c
index 2e937fdba281,68bfe57b6625..000000000000
--- a/net/bluetooth/hci_core.c
+++ b/net/bluetooth/hci_core.c
@@@ -756,6 -758,19 +756,22 @@@ static int hci_init3_req(struct hci_req
  				    0, NULL);
  		}
  
++<<<<<<< HEAD
++=======
+ 		if (hdev->commands[34] & 0x20) {
+ 			/* Clear LE Resolving List */
+ 			hci_req_add(req, HCI_OP_LE_CLEAR_RESOLV_LIST, 0, NULL);
+ 		}
+ 
+ 		if (hdev->commands[35] & 0x40) {
+ 			__le16 rpa_timeout = cpu_to_le16(hdev->rpa_timeout);
+ 
+ 			/* Set RPA timeout */
+ 			hci_req_add(req, HCI_OP_LE_SET_RPA_TIMEOUT, 2,
+ 				    &rpa_timeout);
+ 		}
+ 
++>>>>>>> b2cc23398e81 (Bluetooth: Enable RPA Timeout)
  		if (hdev->le_features[0] & HCI_LE_DATA_LEN_EXT) {
  			/* Read LE Maximum Data Length */
  			hci_req_add(req, HCI_OP_LE_READ_MAX_DATA_LEN, 0, NULL);
diff --git a/include/net/bluetooth/hci.h b/include/net/bluetooth/hci.h
index 22de35264e4b..f25ebae8efa6 100644
--- a/include/net/bluetooth/hci.h
+++ b/include/net/bluetooth/hci.h
@@ -1647,6 +1647,8 @@ struct hci_rp_le_read_resolv_list_size {
 
 #define HCI_OP_LE_SET_ADDR_RESOLV_ENABLE 0x202d
 
+#define HCI_OP_LE_SET_RPA_TIMEOUT	0x202e
+
 #define HCI_OP_LE_READ_MAX_DATA_LEN	0x202f
 struct hci_rp_le_read_max_data_len {
 	__u8	status;
* Unmerged path net/bluetooth/hci_core.c
