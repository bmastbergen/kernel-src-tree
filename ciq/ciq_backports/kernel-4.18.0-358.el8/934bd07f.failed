nfsd: move fsnotify on client creation outside spinlock

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-358.el8
commit-author J. Bruce Fields <bfields@redhat.com>
commit 934bd07fae7e55232845f909f78873ab8678ca74
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-358.el8/934bd07f.failed

This was causing a "sleeping function called from invalid context"
warning.

I don't think we need the set_and_test_bit() here; clients move from
unconfirmed to confirmed only once, under the client_lock.

The (conf == unconf) is a way to check whether we're in that confirming
case, hopefully that's not too obscure.

Fixes: 472d155a0631 "nfsd: report client confirmation status in "info" file"
	Signed-off-by: J. Bruce Fields <bfields@redhat.com>
(cherry picked from commit 934bd07fae7e55232845f909f78873ab8678ca74)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	fs/nfsd/nfs4state.c
diff --cc fs/nfsd/nfs4state.c
index 8f8e5e7cfffb,c01ecb7b3fd3..000000000000
--- a/fs/nfsd/nfs4state.c
+++ b/fs/nfsd/nfs4state.c
@@@ -2742,10 -2824,8 +2742,15 @@@ move_to_confirmed(struct nfs4_client *c
  	list_move(&clp->cl_idhash, &nn->conf_id_hashtbl[idhashval]);
  	rb_erase(&clp->cl_namenode, &nn->unconf_name_tree);
  	add_clp_to_name_tree(clp, &nn->conf_name_tree);
++<<<<<<< HEAD
 +	if (!test_and_set_bit(NFSD4_CLIENT_CONFIRMED, &clp->cl_flags) &&
 +	    clp->cl_nfsd_dentry &&
 +	    clp->cl_nfsd_info_dentry)
 +		fsnotify_dentry(clp->cl_nfsd_info_dentry, FS_MODIFY);
++=======
+ 	set_bit(NFSD4_CLIENT_CONFIRMED, &clp->cl_flags);
+ 	trace_nfsd_clid_confirmed(&clp->cl_clientid);
++>>>>>>> 934bd07fae7e (nfsd: move fsnotify on client creation outside spinlock)
  	renew_client_locked(clp);
  }
  
* Unmerged path fs/nfsd/nfs4state.c
