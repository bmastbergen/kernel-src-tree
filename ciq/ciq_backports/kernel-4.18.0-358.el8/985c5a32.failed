nvme: allocate the keep alive request using BLK_MQ_REQ_NOWAIT

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-358.el8
commit-author Christoph Hellwig <hch@lst.de>
commit 985c5a329dfe5ecb782551cddef48912961b83f1
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-358.el8/985c5a32.failed

To avoid an error recovery deadlock where the keep alive work is waiting
for a request and thus can't be flushed to make progress for tearing down
the controller.  Also print the error code returned from
blk_mq_alloc_request to help debugging any future issues in this code.

Based on an earlier patch from Hannes Reinecke <hare@suse.de>.

	Signed-off-by: Christoph Hellwig <hch@lst.de>
	Reviewed-by: Sagi Grimberg <sagi@grimberg.me>
	Reviewed-by: Chaitanya Kulkarni <chaitanya.kulkarni@wdc.com>
	Reviewed-by: Hannes Reinecke <hare@suse.de>
	Reviewed-by: Daniel Wagner <dwagner@suse.de>
(cherry picked from commit 985c5a329dfe5ecb782551cddef48912961b83f1)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/nvme/host/core.c
diff --cc drivers/nvme/host/core.c
index 1f59d5d8c422,83d6740f8d4e..000000000000
--- a/drivers/nvme/host/core.c
+++ b/drivers/nvme/host/core.c
@@@ -1301,9 -1241,11 +1301,15 @@@ static void nvme_keep_alive_work(struc
  		return;
  	}
  
++<<<<<<< HEAD
 +	if (nvme_keep_alive(ctrl)) {
++=======
+ 	rq = nvme_alloc_request(ctrl->admin_q, &ctrl->ka_cmd,
+ 				BLK_MQ_REQ_RESERVED | BLK_MQ_REQ_NOWAIT);
+ 	if (IS_ERR(rq)) {
++>>>>>>> 985c5a329dfe (nvme: allocate the keep alive request using BLK_MQ_REQ_NOWAIT)
  		/* allocation failure, reset the controller */
- 		dev_err(ctrl->device, "keep-alive failed\n");
+ 		dev_err(ctrl->device, "keep-alive failed: %ld\n", PTR_ERR(rq));
  		nvme_reset_ctrl(ctrl);
  		return;
  	}
* Unmerged path drivers/nvme/host/core.c
