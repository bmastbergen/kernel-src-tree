Bluetooth: Add toggle to switch off interleave scan

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-358.el8
commit-author Howard Chung <howardchung@google.com>
commit 80af16a3e473f0789d205810733a513279e5b6f9
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-358.el8/80af16a3.failed

This patch add a configurable parameter to switch off the interleave
scan feature.

	Signed-off-by: Howard Chung <howardchung@google.com>
	Reviewed-by: Alain Michaud <alainm@chromium.org>
	Signed-off-by: Marcel Holtmann <marcel@holtmann.org>
	Signed-off-by: Johan Hedberg <johan.hedberg@intel.com>
(cherry picked from commit 80af16a3e473f0789d205810733a513279e5b6f9)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	include/net/bluetooth/hci_core.h
#	net/bluetooth/hci_core.c
#	net/bluetooth/hci_request.c
#	net/bluetooth/mgmt_config.c
diff --cc include/net/bluetooth/hci_core.h
index 87a79e4f1ac5,63c6d656564a..000000000000
--- a/include/net/bluetooth/hci_core.h
+++ b/include/net/bluetooth/hci_core.h
@@@ -345,6 -361,9 +345,12 @@@ struct hci_dev 
  	__u8		ssp_debug_mode;
  	__u8		hw_error_code;
  	__u32		clock;
++<<<<<<< HEAD
++=======
+ 	__u16		advmon_allowlist_duration;
+ 	__u16		advmon_no_filter_duration;
+ 	__u8		enable_advmon_interleave_scan;
++>>>>>>> 80af16a3e473 (Bluetooth: Add toggle to switch off interleave scan)
  
  	__u16		devid_source;
  	__u16		devid_vendor;
diff --cc net/bluetooth/hci_core.c
index 0693dacbf6e3,8cfcf43eb08f..000000000000
--- a/net/bluetooth/hci_core.c
+++ b/net/bluetooth/hci_core.c
@@@ -3468,6 -3592,10 +3468,13 @@@ struct hci_dev *hci_alloc_dev(void
  	hdev->cur_adv_instance = 0x00;
  	hdev->adv_instance_timeout = 0;
  
++<<<<<<< HEAD
++=======
+ 	hdev->advmon_allowlist_duration = 300;
+ 	hdev->advmon_no_filter_duration = 500;
+ 	hdev->enable_advmon_interleave_scan = 0x00;	/* Default to disable */
+ 
++>>>>>>> 80af16a3e473 (Bluetooth: Add toggle to switch off interleave scan)
  	hdev->sniff_max_interval = 800;
  	hdev->sniff_min_interval = 80;
  
diff --cc net/bluetooth/hci_request.c
index 533127737517,d0d0fbbb3fa5..000000000000
--- a/net/bluetooth/hci_request.c
+++ b/net/bluetooth/hci_request.c
@@@ -993,6 -1057,11 +993,14 @@@ void hci_req_add_le_passive_scan(struc
  				      &own_addr_type))
  		return;
  
++<<<<<<< HEAD
++=======
+ 	if (hdev->enable_advmon_interleave_scan &&
+ 	    __hci_update_interleaved_scan(hdev))
+ 		return;
+ 
+ 	bt_dev_dbg(hdev, "interleave state %d", hdev->interleave_scan_state);
++>>>>>>> 80af16a3e473 (Bluetooth: Add toggle to switch off interleave scan)
  	/* Adding or removing entries from the white list must
  	 * happen before enabling scanning. The controller does
  	 * not allow white list modification while scanning.
* Unmerged path net/bluetooth/mgmt_config.c
* Unmerged path include/net/bluetooth/hci_core.h
* Unmerged path net/bluetooth/hci_core.c
* Unmerged path net/bluetooth/hci_request.c
* Unmerged path net/bluetooth/mgmt_config.c
