Bluetooth: Add definitions for advertisement monitor features

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-358.el8
commit-author Miao-chen Chou <mcchou@chromium.org>
commit 7fceb17c6b480e0f2bd0e566a8231039fb8a809e
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-358.el8/7fceb17c.failed

This adds support for Advertisement Monitor API. Here are the commands
and events added.
- Read Advertisement Monitor Feature command
- Add Advertisement Pattern Monitor command
- Remove Advertisement Monitor command
- Advertisement Monitor Added event
- Advertisement Monitor Removed event

	Signed-off-by: Miao-chen Chou <mcchou@chromium.org>
	Signed-off-by: Marcel Holtmann <marcel@holtmann.org>
	Signed-off-by: Johan Hedberg <johan.hedberg@intel.com>
(cherry picked from commit 7fceb17c6b480e0f2bd0e566a8231039fb8a809e)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	include/net/bluetooth/mgmt.h
diff --cc include/net/bluetooth/mgmt.h
index 79792be43000,beae5c3980f0..000000000000
--- a/include/net/bluetooth/mgmt.h
+++ b/include/net/bluetooth/mgmt.h
@@@ -674,6 -678,108 +674,111 @@@ struct mgmt_cp_set_blocked_keys 
  } __packed;
  #define MGMT_OP_SET_BLOCKED_KEYS_SIZE 2
  
++<<<<<<< HEAD
++=======
+ #define MGMT_OP_SET_WIDEBAND_SPEECH	0x0047
+ 
+ #define MGMT_OP_READ_SECURITY_INFO	0x0048
+ #define MGMT_READ_SECURITY_INFO_SIZE	0
+ struct mgmt_rp_read_security_info {
+ 	__le16   sec_len;
+ 	__u8     sec[];
+ } __packed;
+ 
+ #define MGMT_OP_READ_EXP_FEATURES_INFO	0x0049
+ #define MGMT_READ_EXP_FEATURES_INFO_SIZE 0
+ struct mgmt_rp_read_exp_features_info {
+ 	__le16 feature_count;
+ 	struct {
+ 		__u8   uuid[16];
+ 		__le32 flags;
+ 	} features[];
+ } __packed;
+ 
+ #define MGMT_OP_SET_EXP_FEATURE		0x004a
+ struct mgmt_cp_set_exp_feature {
+ 	__u8   uuid[16];
+ 	__u8   param[];
+ } __packed;
+ #define MGMT_SET_EXP_FEATURE_SIZE	16
+ struct mgmt_rp_set_exp_feature {
+ 	__u8   uuid[16];
+ 	__le32 flags;
+ } __packed;
+ 
+ #define MGMT_OP_READ_DEF_SYSTEM_CONFIG	0x004b
+ #define MGMT_READ_DEF_SYSTEM_CONFIG_SIZE	0
+ 
+ #define MGMT_OP_SET_DEF_SYSTEM_CONFIG	0x004c
+ #define MGMT_SET_DEF_SYSTEM_CONFIG_SIZE		0
+ 
+ #define MGMT_OP_READ_DEF_RUNTIME_CONFIG	0x004d
+ #define MGMT_READ_DEF_RUNTIME_CONFIG_SIZE	0
+ 
+ #define MGMT_OP_SET_DEF_RUNTIME_CONFIG	0x004e
+ #define MGMT_SET_DEF_RUNTIME_CONFIG_SIZE	0
+ 
+ #define MGMT_OP_GET_DEVICE_FLAGS	0x004F
+ #define MGMT_GET_DEVICE_FLAGS_SIZE	7
+ struct mgmt_cp_get_device_flags {
+ 	struct mgmt_addr_info addr;
+ } __packed;
+ struct mgmt_rp_get_device_flags {
+ 	struct mgmt_addr_info addr;
+ 	__le32 supported_flags;
+ 	__le32 current_flags;
+ } __packed;
+ 
+ #define MGMT_OP_SET_DEVICE_FLAGS	0x0050
+ #define MGMT_SET_DEVICE_FLAGS_SIZE	11
+ struct mgmt_cp_set_device_flags {
+ 	struct mgmt_addr_info addr;
+ 	__le32 current_flags;
+ } __packed;
+ struct mgmt_rp_set_device_flags {
+ 	struct mgmt_addr_info addr;
+ } __packed;
+ 
+ #define MGMT_ADV_MONITOR_FEATURE_MASK_OR_PATTERNS    BIT(0)
+ 
+ #define MGMT_OP_READ_ADV_MONITOR_FEATURES	0x0051
+ #define MGMT_READ_ADV_MONITOR_FEATURES_SIZE	0
+ struct mgmt_rp_read_adv_monitor_features {
+ 	__le32 supported_features;
+ 	__le32 enabled_features;
+ 	__le16 max_num_handles;
+ 	__u8 max_num_patterns;
+ 	__le16 num_handles;
+ 	__le16 handles[];
+ }  __packed;
+ 
+ struct mgmt_adv_pattern {
+ 	__u8 ad_type;
+ 	__u8 offset;
+ 	__u8 length;
+ 	__u8 value[31];
+ } __packed;
+ 
+ #define MGMT_OP_ADD_ADV_PATTERNS_MONITOR	0x0052
+ struct mgmt_cp_add_adv_patterns_monitor {
+ 	__u8 pattern_count;
+ 	struct mgmt_adv_pattern patterns[];
+ } __packed;
+ #define MGMT_ADD_ADV_PATTERNS_MONITOR_SIZE	1
+ struct mgmt_rp_add_adv_patterns_monitor {
+ 	__le16 monitor_handle;
+ } __packed;
+ 
+ #define MGMT_OP_REMOVE_ADV_MONITOR		0x0053
+ struct mgmt_cp_remove_adv_monitor {
+ 	__le16 monitor_handle;
+ } __packed;
+ #define MGMT_REMOVE_ADV_MONITOR_SIZE		2
+ struct mgmt_rp_remove_adv_monitor {
+ 	__le16 monitor_handle;
+ } __packed;
+ 
++>>>>>>> 7fceb17c6b48 (Bluetooth: Add definitions for advertisement monitor features)
  #define MGMT_EV_CMD_COMPLETE		0x0001
  struct mgmt_ev_cmd_complete {
  	__le16	opcode;
@@@ -899,3 -1005,26 +1004,29 @@@ struct mgmt_ev_ext_info_changed 
  struct mgmt_ev_phy_configuration_changed {
  	__le32	selected_phys;
  } __packed;
++<<<<<<< HEAD
++=======
+ 
+ #define MGMT_EV_EXP_FEATURE_CHANGED	0x0027
+ struct mgmt_ev_exp_feature_changed {
+ 	__u8	uuid[16];
+ 	__le32	flags;
+ } __packed;
+ 
+ #define MGMT_EV_DEVICE_FLAGS_CHANGED		0x002a
+ struct mgmt_ev_device_flags_changed {
+ 	struct mgmt_addr_info addr;
+ 	__le32 supported_flags;
+ 	__le32 current_flags;
+ } __packed;
+ 
+ #define MGMT_EV_ADV_MONITOR_ADDED	0x002b
+ struct mgmt_ev_adv_monitor_added {
+ 	__le16 monitor_handle;
+ }  __packed;
+ 
+ #define MGMT_EV_ADV_MONITOR_REMOVED	0x002c
+ struct mgmt_ev_adv_monitor_removed {
+ 	__le16 monitor_handle;
+ }  __packed;
++>>>>>>> 7fceb17c6b48 (Bluetooth: Add definitions for advertisement monitor features)
* Unmerged path include/net/bluetooth/mgmt.h
