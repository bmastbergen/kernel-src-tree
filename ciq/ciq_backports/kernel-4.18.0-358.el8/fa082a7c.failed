platform/x86: intel_pmc_core: Move to intel sub-directory

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-358.el8
commit-author Kate Hsuan <hpa@redhat.com>
commit fa082a7cf5a66a42a06da048afd972e2cc1b67ea
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-358.el8/fa082a7c.failed

Move Intel PMC core driver to intel sub-directory to improve readability.

	Signed-off-by: Kate Hsuan <hpa@redhat.com>
	Reviewed-by: Hans de Goede <hdegoede@redhat.com>
	Signed-off-by: Andy Shevchenko <andriy.shevchenko@linux.intel.com>
	Reviewed-by: Rajneesh Bhardwaj <irenic.rajneesh@gmail.com>
Link: https://lore.kernel.org/r/20210820110458.73018-7-andriy.shevchenko@linux.intel.com
	Signed-off-by: Hans de Goede <hdegoede@redhat.com>
(cherry picked from commit fa082a7cf5a66a42a06da048afd972e2cc1b67ea)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/platform/x86/Kconfig
#	drivers/platform/x86/Makefile
#	drivers/platform/x86/intel/Kconfig
#	drivers/platform/x86/intel/Makefile
diff --cc drivers/platform/x86/Kconfig
index 8d08c377b32f,aed7570388ef..000000000000
--- a/drivers/platform/x86/Kconfig
+++ b/drivers/platform/x86/Kconfig
@@@ -1292,40 -1148,75 +1292,101 @@@ config INTEL_TURBO_MAX_
  	  This driver is only required when the system is not using Hardware
  	  P-States (HWP). In HWP mode, priority can be read from ACPI tables.
  
 -config INTEL_UNCORE_FREQ_CONTROL
 -	tristate "Intel Uncore frequency control driver"
 -	depends on X86_64
 +config SILEAD_DMI
 +	bool "Tablets with Silead touchscreens"
 +	depends on ACPI && DMI && I2C=y && TOUCHSCREEN_SILEAD
 +	---help---
 +	  Certain ACPI based tablets with Silead touchscreens do not have
 +	  enough data in ACPI tables for the touchscreen driver to handle
 +	  the touchscreen properly, as OEMs expected the data to be baked
 +	  into the tablet model specific version of the driver shipped
 +	  with the OS-image for the device. This option supplies the missing
 +	  information. Enable this for x86 tablets with Silead touchscreens.
 +
 +config INTEL_CHTDC_TI_PWRBTN
 +	tristate "Intel Cherry Trail Dollar Cove TI power button driver"
 +	depends on INTEL_SOC_PMIC_CHTDC_TI
 +	depends on INPUT
 +	---help---
 +	  This option adds a power button driver driver for Dollar Cove TI
 +	  PMIC on Intel Cherry Trail devices.
 +
 +	  To compile this driver as a module, choose M here: the module
 +	  will be called intel_chtdc_ti_pwrbtn.
 +
++<<<<<<< HEAD
 +config I2C_MULTI_INSTANTIATE
 +	tristate "I2C multi instantiate pseudo device driver"
 +	depends on I2C && ACPI
  	help
 -	  This driver allows control of uncore frequency limits on
 -	  supported server platforms.
 -	  Uncore frequency controls RING/LLC (last-level cache) clocks.
 +	  Some ACPI-based systems list multiple i2c-devices in a single ACPI
 +	  firmware-node. This driver will instantiate separate i2c-clients
 +	  for each device in the firmware-node.
  
  	  To compile this driver as a module, choose M here: the module
 -	  will be called intel-uncore-frequency.
 +	  will be called i2c-multi-instantiate.
  
 +source "drivers/platform/x86/intel_speed_select_if/Kconfig"
++=======
+ config INTEL_SCU_IPC
+ 	bool
+ 
+ config INTEL_SCU
+ 	bool
+ 	select INTEL_SCU_IPC
+ 
+ config INTEL_SCU_PCI
+ 	bool "Intel SCU PCI driver"
+ 	depends on PCI
+ 	select INTEL_SCU
+ 	help
+ 	  This driver is used to bridge the communications between kernel
+ 	  and SCU on some embedded Intel x86 platforms. It also creates
+ 	  devices that are connected to the SoC through the SCU.
+ 	  Platforms supported:
+ 	    Medfield
+ 	    Clovertrail
+ 	    Merrifield
+ 	    Broxton
+ 	    Apollo Lake
+ 
+ config INTEL_SCU_PLATFORM
+ 	tristate "Intel SCU platform driver"
+ 	depends on ACPI
+ 	select INTEL_SCU
+ 	help
+ 	  This driver is used to bridge the communications between kernel
+ 	  and SCU (sometimes called PMC as well). The driver currently
+ 	  supports Intel Elkhart Lake and compatible platforms.
+ 
+ config INTEL_SCU_WDT
+ 	bool
+ 	default INTEL_SCU_PCI
+ 	depends on INTEL_MID_WATCHDOG
+ 	help
+ 	  This is a specific platform code to instantiate watchdog device
+ 	  on ACPI-based Intel MID platforms.
+ 
+ config INTEL_SCU_IPC_UTIL
+ 	tristate "Intel SCU IPC utility driver"
+ 	depends on INTEL_SCU
+ 	help
+ 	  The IPC Util driver provides an interface with the SCU enabling
+ 	  low level access for debug work and updating the firmware. Say
+ 	  N unless you will be doing this on an Intel MID platform.
+ 
+ config INTEL_TELEMETRY
+ 	tristate "Intel SoC Telemetry Driver"
+ 	depends on X86_64
+ 	depends on MFD_INTEL_PMC_BXT
+ 	depends on INTEL_PUNIT_IPC
+ 	help
+ 	  This driver provides interfaces to configure and use
+ 	  telemetry for INTEL SoC from APL onwards. It is also
+ 	  used to get various SoC events and parameters
+ 	  directly via debugfs files. Various tools may use
+ 	  this interface for SoC state monitoring.
++>>>>>>> fa082a7cf5a6 (platform/x86: intel_pmc_core: Move to intel sub-directory)
  
  endif # X86_PLATFORM_DEVICES
  
diff --cc drivers/platform/x86/Makefile
index 63fea2b07435,1668f7360833..000000000000
--- a/drivers/platform/x86/Makefile
+++ b/drivers/platform/x86/Makefile
@@@ -58,47 -102,37 +58,72 @@@ obj-$(CONFIG_INTEL_WMI_THUNDERBOLT)	+= 
  # before toshiba_acpi initializes
  obj-$(CONFIG_ACPI_TOSHIBA)	+= toshiba_acpi.o
  
 -# Laptop drivers
 -obj-$(CONFIG_ACPI_CMPC)		+= classmate-laptop.o
 -obj-$(CONFIG_COMPAL_LAPTOP)	+= compal-laptop.o
 -obj-$(CONFIG_LG_LAPTOP)		+= lg-laptop.o
 -obj-$(CONFIG_PANASONIC_LAPTOP)	+= panasonic-laptop.o
 -obj-$(CONFIG_SONY_LAPTOP)	+= sony-laptop.o
 -obj-$(CONFIG_SYSTEM76_ACPI)	+= system76_acpi.o
 -obj-$(CONFIG_TOPSTAR_LAPTOP)	+= topstar-laptop.o
 -
 -# Platform drivers
 -obj-$(CONFIG_FW_ATTR_CLASS)		+= firmware_attributes_class.o
 +obj-$(CONFIG_TOSHIBA_BT_RFKILL)	+= toshiba_bluetooth.o
 +obj-$(CONFIG_TOSHIBA_HAPS)	+= toshiba_haps.o
 +obj-$(CONFIG_TOSHIBA_WMI)	+= toshiba-wmi.o
 +obj-$(CONFIG_INTEL_CHT_INT33FE)	+= intel_cht_int33fe.o
 +obj-$(CONFIG_INTEL_INT0002_VGPIO) += intel_int0002_vgpio.o
 +obj-$(CONFIG_INTEL_HID_EVENT)	+= intel-hid.o
 +obj-$(CONFIG_INTEL_VBTN)	+= intel-vbtn.o
 +obj-$(CONFIG_INTEL_SCU_IPC)	+= intel_scu_ipc.o
 +obj-$(CONFIG_INTEL_SCU_IPC_UTIL) += intel_scu_ipcutil.o
 +obj-$(CONFIG_INTEL_MFLD_THERMAL) += intel_mid_thermal.o
 +obj-$(CONFIG_INTEL_IPS)		+= intel_ips.o
 +obj-$(CONFIG_XO1_RFKILL)	+= xo1-rfkill.o
 +obj-$(CONFIG_XO15_EBOOK)	+= xo15-ebook.o
 +obj-$(CONFIG_IBM_RTL)		+= ibm_rtl.o
 +obj-$(CONFIG_SAMSUNG_LAPTOP)	+= samsung-laptop.o
 +obj-$(CONFIG_MXM_WMI)		+= mxm-wmi.o
 +obj-$(CONFIG_INTEL_MID_POWER_BUTTON)	+= intel_mid_powerbtn.o
 +obj-$(CONFIG_INTEL_OAKTRAIL)	+= intel_oaktrail.o
 +obj-$(CONFIG_SAMSUNG_Q10)	+= samsung-q10.o
 +obj-$(CONFIG_APPLE_GMUX)	+= apple-gmux.o
 +obj-$(CONFIG_INTEL_RST)		+= intel-rst.o
 +obj-$(CONFIG_INTEL_SMARTCONNECT)	+= intel-smartconnect.o
 +
 +obj-$(CONFIG_PVPANIC)           += pvpanic.o
 +obj-$(CONFIG_ALIENWARE_WMI)	+= alienware-wmi.o
 +obj-$(CONFIG_INTEL_PMC_IPC)	+= intel_pmc_ipc.o
 +obj-$(CONFIG_SILEAD_DMI)	+= silead_dmi.o
 +obj-$(CONFIG_SURFACE_PRO3_BUTTON)	+= surfacepro3_button.o
 +obj-$(CONFIG_SURFACE_3_BUTTON)	+= surface3_button.o
 +obj-$(CONFIG_INTEL_PUNIT_IPC)  += intel_punit_ipc.o
 +obj-$(CONFIG_INTEL_BXTWC_PMIC_TMU)	+= intel_bxtwc_tmu.o
 +obj-$(CONFIG_INTEL_TELEMETRY)	+= intel_telemetry_core.o \
 +				   intel_telemetry_pltdrv.o \
 +				   intel_telemetry_debugfs.o
 +obj-$(CONFIG_INTEL_PMC_CORE)    += intel_pmc_core.o intel_pmc_core_pltdrv.o
 +obj-$(CONFIG_INTEL_PMT_CLASS)		+= intel_pmt_class.o
 +obj-$(CONFIG_INTEL_PMT_TELEMETRY)	+= intel_pmt_telemetry.o
 +obj-$(CONFIG_INTEL_PMT_CRASHLOG)	+= intel_pmt_crashlog.o
 +obj-$(CONFIG_PMC_ATOM)		+= pmc_atom.o
 +obj-$(CONFIG_MLX_PLATFORM)	+= mlx-platform.o
 +obj-$(CONFIG_INTEL_TURBO_MAX_3) += intel_turbo_max_3.o
 +obj-$(CONFIG_INTEL_CHTDC_TI_PWRBTN)	+= intel_chtdc_ti_pwrbtn.o
  obj-$(CONFIG_I2C_MULTI_INSTANTIATE)	+= i2c-multi-instantiate.o
++<<<<<<< HEAD
 +obj-$(CONFIG_INTEL_SPEED_SELECT_INTERFACE) += intel_speed_select_if/
++=======
+ obj-$(CONFIG_MLX_PLATFORM)		+= mlx-platform.o
+ obj-$(CONFIG_TOUCHSCREEN_DMI)		+= touchscreen_dmi.o
+ obj-$(CONFIG_WIRELESS_HOTKEY)		+= wireless-hotkey.o
+ 
+ # Intel uncore drivers
+ obj-$(CONFIG_INTEL_IPS)				+= intel_ips.o
+ obj-$(CONFIG_INTEL_RST)				+= intel-rst.o
+ obj-$(CONFIG_INTEL_SMARTCONNECT)		+= intel-smartconnect.o
+ obj-$(CONFIG_INTEL_SPEED_SELECT_INTERFACE)	+= intel_speed_select_if/
+ obj-$(CONFIG_INTEL_TURBO_MAX_3)			+= intel_turbo_max_3.o
+ obj-$(CONFIG_INTEL_UNCORE_FREQ_CONTROL)		+= intel-uncore-frequency.o
+ 
+ # Intel PMIC / PMC / P-Unit devices
+ obj-$(CONFIG_INTEL_SCU_IPC)		+= intel_scu_ipc.o
+ obj-$(CONFIG_INTEL_SCU_PCI)		+= intel_scu_pcidrv.o
+ obj-$(CONFIG_INTEL_SCU_PLATFORM)	+= intel_scu_pltdrv.o
+ obj-$(CONFIG_INTEL_SCU_WDT)		+= intel_scu_wdt.o
+ obj-$(CONFIG_INTEL_SCU_IPC_UTIL)	+= intel_scu_ipcutil.o
+ obj-$(CONFIG_INTEL_TELEMETRY)		+= intel_telemetry_core.o \
+ 					   intel_telemetry_pltdrv.o \
+ 					   intel_telemetry_debugfs.o
+ obj-$(CONFIG_PMC_ATOM)			+= pmc_atom.o
++>>>>>>> fa082a7cf5a6 (platform/x86: intel_pmc_core: Move to intel sub-directory)
* Unmerged path drivers/platform/x86/intel/Kconfig
* Unmerged path drivers/platform/x86/intel/Makefile
diff --git a/MAINTAINERS b/MAINTAINERS
index cf87ae238d81..9c7ce93c2c16 100644
--- a/MAINTAINERS
+++ b/MAINTAINERS
@@ -7484,7 +7484,7 @@ M:	David E Box <david.e.box@intel.com>
 L:	platform-driver-x86@vger.kernel.org
 S:	Maintained
 F:	Documentation/ABI/testing/sysfs-platform-intel-pmc
-F:	drivers/platform/x86/intel_pmc_core*
+F:	drivers/platform/x86/intel/pmc/
 
 INTEL PMC/P-Unit IPC DRIVER
 M:	Zha Qipeng<qipeng.zha@intel.com>
* Unmerged path drivers/platform/x86/Kconfig
* Unmerged path drivers/platform/x86/Makefile
* Unmerged path drivers/platform/x86/intel/Kconfig
* Unmerged path drivers/platform/x86/intel/Makefile
diff --git a/drivers/platform/x86/intel/pmc/Kconfig b/drivers/platform/x86/intel/pmc/Kconfig
new file mode 100644
index 000000000000..b526597e4deb
--- /dev/null
+++ b/drivers/platform/x86/intel/pmc/Kconfig
@@ -0,0 +1,25 @@
+# SPDX-License-Identifier: GPL-2.0
+#
+# Intel x86 Platform-Specific Drivers
+#
+
+config INTEL_PMC_CORE
+	tristate "Intel PMC Core driver"
+	depends on PCI
+	depends on ACPI
+	help
+	  The Intel Platform Controller Hub for Intel Core SoCs provides access
+	  to Power Management Controller registers via various interfaces. This
+	  driver can utilize debugging capabilities and supported features as
+	  exposed by the Power Management Controller. It also may perform some
+	  tasks in the PMC in order to enable transition into the SLPS0 state.
+	  It should be selected on all Intel platforms supported by the driver.
+
+	  Supported features:
+		- SLP_S0_RESIDENCY counter
+		- PCH IP Power Gating status
+		- LTR Ignore / LTR Show
+		- MPHY/PLL gating status (Sunrisepoint PCH only)
+		- SLPS0 Debug registers (Cannonlake/Icelake PCH)
+		- Low Power Mode registers (Tigerlake and beyond)
+		- PMC quirks as needed to enable SLPS0/S0ix
diff --git a/drivers/platform/x86/intel/pmc/Makefile b/drivers/platform/x86/intel/pmc/Makefile
new file mode 100644
index 000000000000..8966fcdc0e1d
--- /dev/null
+++ b/drivers/platform/x86/intel/pmc/Makefile
@@ -0,0 +1,9 @@
+# SPDX-License-Identifier: GPL-2.0
+#
+# Intel x86 Platform-Specific Drivers
+#
+
+intel_pmc_core-y			:= core.o
+obj-$(CONFIG_INTEL_PMC_CORE)		+= intel_pmc_core.o
+intel_pmc_core_pltdrv-y			:= pltdrv.o
+obj-$(CONFIG_INTEL_PMC_CORE)		+= intel_pmc_core_pltdrv.o
diff --git a/drivers/platform/x86/intel_pmc_core.c b/drivers/platform/x86/intel/pmc/core.c
similarity index 99%
rename from drivers/platform/x86/intel_pmc_core.c
rename to drivers/platform/x86/intel/pmc/core.c
index ae410a358ffe..9963bc3d470c 100644
--- a/drivers/platform/x86/intel_pmc_core.c
+++ b/drivers/platform/x86/intel/pmc/core.c
@@ -31,7 +31,7 @@
 #include <asm/msr.h>
 #include <asm/tsc.h>
 
-#include "intel_pmc_core.h"
+#include "core.h"
 
 #define ACPI_S0IX_DSM_UUID		"57a6512e-3979-4e9d-9708-ff13b2508972"
 #define ACPI_GET_LOW_MODE_REGISTERS	1
diff --git a/drivers/platform/x86/intel_pmc_core.h b/drivers/platform/x86/intel/pmc/core.h
similarity index 100%
rename from drivers/platform/x86/intel_pmc_core.h
rename to drivers/platform/x86/intel/pmc/core.h
diff --git a/drivers/platform/x86/intel_pmc_core_pltdrv.c b/drivers/platform/x86/intel/pmc/pltdrv.c
similarity index 100%
rename from drivers/platform/x86/intel_pmc_core_pltdrv.c
rename to drivers/platform/x86/intel/pmc/pltdrv.c
