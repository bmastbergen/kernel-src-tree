KVM: arm64: Trim guest debug exception handling

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-358.el8
commit-author Raghavendra Rao Ananta <rananta@google.com>
commit 8ce8a6fce9bfd3fcabe230ad104e2caf08b2e58d
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-358.el8/8ce8a6fc.failed

The switch-case for handling guest debug exception covers
all the debug exception classes, but functionally, doesn't
do anything with them other than ESR_ELx_EC_WATCHPT_LOW.
Moreover, even though handled well, the 'default' case
could be confusing from a security point of view, stating
that the guests' actions can potentially flood the syslog.
But in reality, the code is unreachable.

Hence, trim down the function to only handle the case with
ESR_ELx_EC_WATCHPT_LOW with a simple 'if' check.

	Suggested-by: Marc Zyngier <maz@kernel.org>
	Signed-off-by: Raghavendra Rao Ananta <rananta@google.com>
	Signed-off-by: Marc Zyngier <maz@kernel.org>
Link: https://lore.kernel.org/r/20210823223940.1878930-1-rananta@google.com
(cherry picked from commit 8ce8a6fce9bfd3fcabe230ad104e2caf08b2e58d)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/arm64/kvm/handle_exit.c
diff --cc arch/arm64/kvm/handle_exit.c
index 237ef37866c0,b143f1ab6520..000000000000
--- a/arch/arm64/kvm/handle_exit.c
+++ b/arch/arm64/kvm/handle_exit.c
@@@ -136,23 -123,10 +135,25 @@@ static int kvm_handle_guest_debug(struc
  	run->exit_reason = KVM_EXIT_DEBUG;
  	run->debug.arch.hsr = esr;
  
- 	switch (ESR_ELx_EC(esr)) {
- 	case ESR_ELx_EC_WATCHPT_LOW:
+ 	if (ESR_ELx_EC(esr) == ESR_ELx_EC_WATCHPT_LOW)
  		run->debug.arch.far = vcpu->arch.fault.far_el2;
++<<<<<<< HEAD
 +		/* fall through */
 +	case ESR_ELx_EC_SOFTSTP_LOW:
 +	case ESR_ELx_EC_BREAKPT_LOW:
 +	case ESR_ELx_EC_BKPT32:
 +	case ESR_ELx_EC_BRK64:
 +		break;
 +	default:
 +		kvm_err("%s: un-handled case esr: %#08x\n",
 +			__func__, (unsigned int) esr);
 +		ret = -1;
 +		break;
 +	}
++=======
++>>>>>>> 8ce8a6fce9bf (KVM: arm64: Trim guest debug exception handling)
  
- 	return ret;
+ 	return 0;
  }
  
  static int kvm_handle_unknown_ec(struct kvm_vcpu *vcpu)
* Unmerged path arch/arm64/kvm/handle_exit.c
