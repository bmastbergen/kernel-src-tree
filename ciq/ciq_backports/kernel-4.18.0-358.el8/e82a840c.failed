efi: Update implementation of add_links() to create fwnode links

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-358.el8
commit-author Saravana Kannan <saravanak@google.com>
commit e82a840cb1c1c83d01a9b81bb63b6cf1c09239d7
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-358.el8/e82a840c.failed

The semantics of add_links() has changed from creating device link
between devices to creating fwnode links between fwnodes. So, update the
implementation of add_links() to match the new semantics.

	Signed-off-by: Saravana Kannan <saravanak@google.com>
Link: https://lore.kernel.org/r/20201121020232.908850-16-saravanak@google.com
	Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
(cherry picked from commit e82a840cb1c1c83d01a9b81bb63b6cf1c09239d7)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/firmware/efi/efi-init.c
diff --cc drivers/firmware/efi/efi-init.c
index b280533df7a2,c0c3d4c3837a..000000000000
--- a/drivers/firmware/efi/efi-init.c
+++ b/drivers/firmware/efi/efi-init.c
@@@ -338,27 -330,9 +337,30 @@@ static int efifb_add_links(const struc
  	if (!sup_np)
  		return 0;
  
- 	sup_dev = get_dev_from_fwnode(&sup_np->fwnode);
+ 	fwnode_link_add(fwnode, of_fwnode_handle(sup_np));
  	of_node_put(sup_np);
  
++<<<<<<< HEAD
 +	/*
 +	 * Return -ENODEV if the PCI graphics controller device hasn't been
 +	 * registered yet.  This ensures that efifb isn't allowed to probe
 +	 * and this function is retried again when new devices are
 +	 * registered.
 +	 */
 +	if (!sup_dev)
 +		return -ENODEV;
 +
 +	/*
 +	 * If this fails, retrying this function at a later point won't
 +	 * change anything. So, don't return an error after this.
 +	 */
 +	if (!device_link_add(dev, sup_dev, 0))
 +		dev_warn(dev, "device_link_add() failed\n");
 +
 +	put_device(sup_dev);
 +
++=======
++>>>>>>> e82a840cb1c1 (efi: Update implementation of add_links() to create fwnode links)
  	return 0;
  }
  
* Unmerged path drivers/firmware/efi/efi-init.c
