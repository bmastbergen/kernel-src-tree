Bluetooth: Use ext adv handle from requests in CCs

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-358.el8
commit-author Daniel Winkler <danielwinkler@google.com>
commit 25e70886c20005ac7facbd997ff4c3526dcd0de3
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-358.el8/25e70886.failed

Some extended advertising hci command complete events are still using
hdev->cur_adv_instance to map the request to the correct advertisement
handle. However, with extended advertising, "current instance" doesn't
make sense as we can have multiple concurrent advertisements. This
change switches these command complete handlers to use the advertising
handle from the request/event, to ensure we will always use the correct
advertising handle regardless of the state of hdev->cur_adv_instance.

This change is tested on hatch and kefka chromebooks and run through
single- and multi-advertising automated tests to confirm callbacks
report tx power to the correct advertising handle, etc.

	Reviewed-by: Miao-chen Chou <mcchou@chromium.org>
	Signed-off-by: Daniel Winkler <danielwinkler@google.com>
	Signed-off-by: Marcel Holtmann <marcel@holtmann.org>
(cherry picked from commit 25e70886c20005ac7facbd997ff4c3526dcd0de3)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/bluetooth/hci_event.c
diff --cc net/bluetooth/hci_event.c
index 9f3ddbbe894c,016b2999f219..000000000000
--- a/net/bluetooth/hci_event.c
+++ b/net/bluetooth/hci_event.c
@@@ -1751,7 -1786,8 +1749,12 @@@ static void hci_cc_set_ext_adv_param(st
  			adv_instance->tx_power = rp->tx_power;
  	}
  	/* Update adv data as tx power is known now */
++<<<<<<< HEAD
 +	hci_req_update_adv_data(hdev, hdev->cur_adv_instance);
++=======
+ 	hci_req_update_adv_data(hdev, cp->handle);
+ 
++>>>>>>> 25e70886c200 (Bluetooth: Use ext adv handle from requests in CCs)
  	hci_dev_unlock(hdev);
  }
  
* Unmerged path net/bluetooth/hci_event.c
