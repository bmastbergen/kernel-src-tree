printk: console: remove unnecessary safe buffer usage

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-358.el8
commit-author John Ogness <john.ogness@linutronix.de>
commit 505a27a7342912f25ef3d9dabd6a08857e76efc2
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-358.el8/505a27a7.failed

Upon registering a console, safe buffers are activated when setting
up the sequence number to replay the log. However, these are already
protected by @console_sem and @syslog_lock. Remove the unnecessary
safe buffer usage.

	Signed-off-by: John Ogness <john.ogness@linutronix.de>
	Reviewed-by: Petr Mladek <pmladek@suse.com>
	Signed-off-by: Petr Mladek <pmladek@suse.com>
Link: https://lore.kernel.org/r/20210303101528.29901-16-john.ogness@linutronix.de
(cherry picked from commit 505a27a7342912f25ef3d9dabd6a08857e76efc2)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	kernel/printk/printk.c
diff --cc kernel/printk/printk.c
index 9c33249065a6,2f829fbf0a13..000000000000
--- a/kernel/printk/printk.c
+++ b/kernel/printk/printk.c
@@@ -2830,9 -2967,7 +2830,13 @@@ void register_console(struct console *n
  		/*
  		 * console_unlock(); will print out the buffered messages
  		 * for us.
++<<<<<<< HEAD
 +		 */
 +		logbuf_lock_irqsave(flags);
 +		/*
++=======
+ 		 *
++>>>>>>> 505a27a73429 (printk: console: remove unnecessary safe buffer usage)
  		 * We're about to replay the log buffer.  Only do this to the
  		 * just-registered console to avoid excessive message spam to
  		 * the already-registered consoles.
@@@ -2843,9 -2978,11 +2847,17 @@@
  		 */
  		exclusive_console = newcon;
  		exclusive_console_stop_seq = console_seq;
++<<<<<<< HEAD
 +		console_seq = syslog_seq;
 +		console_idx = syslog_idx;
 +		logbuf_unlock_irqrestore(flags);
++=======
+ 
+ 		/* Get a consistent copy of @syslog_seq. */
+ 		raw_spin_lock_irqsave(&syslog_lock, flags);
+ 		console_seq = syslog_seq;
+ 		raw_spin_unlock_irqrestore(&syslog_lock, flags);
++>>>>>>> 505a27a73429 (printk: console: remove unnecessary safe buffer usage)
  	}
  	console_unlock();
  	console_sysfs_notify();
* Unmerged path kernel/printk/printk.c
