kvm: x86: implement KVM PM-notifier

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-358.el8
commit-author Sergey Senozhatsky <senozhatsky@chromium.org>
commit 7d62874f69d7e5c1c1063a5848075bd1adff3998
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-358.el8/7d62874f.failed

Implement PM hibernation/suspend prepare notifiers so that KVM
can reliably set PVCLOCK_GUEST_STOPPED on VCPUs and properly
suspend VMs.

	Signed-off-by: Sergey Senozhatsky <senozhatsky@chromium.org>
Message-Id: <20210606021045.14159-2-senozhatsky@chromium.org>
	Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>
(cherry picked from commit 7d62874f69d7e5c1c1063a5848075bd1adff3998)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/x86/kvm/Kconfig
#	arch/x86/kvm/x86.c
diff --cc arch/x86/kvm/Kconfig
index a20afbe5a466,7a78b88c0f1a..000000000000
--- a/arch/x86/kvm/Kconfig
+++ b/arch/x86/kvm/Kconfig
@@@ -45,7 -45,9 +45,12 @@@ config KV
  	select KVM_GENERIC_DIRTYLOG_READ_PROTECT
  	select KVM_VFIO
  	select SRCU
++<<<<<<< HEAD
 +	---help---
++=======
+ 	select HAVE_KVM_PM_NOTIFIER if PM
+ 	help
++>>>>>>> 7d62874f69d7 (kvm: x86: implement KVM PM-notifier)
  	  Support hosting fully virtualized guest machines using hardware
  	  virtualization extensions.  You will need a fairly recent
  	  processor equipped with virtualization extensions. You will also
diff --cc arch/x86/kvm/x86.c
index b7e08b7eb1e0,3c5a33ab10c0..000000000000
--- a/arch/x86/kvm/x86.c
+++ b/arch/x86/kvm/x86.c
@@@ -57,6 -57,8 +57,11 @@@
  #include <linux/sched/stat.h>
  #include <linux/sched/isolation.h>
  #include <linux/mem_encrypt.h>
++<<<<<<< HEAD
++=======
+ #include <linux/entry-kvm.h>
+ #include <linux/suspend.h>
++>>>>>>> 7d62874f69d7 (kvm: x86: implement KVM PM-notifier)
  
  #include <trace/events/kvm.h>
  
* Unmerged path arch/x86/kvm/Kconfig
* Unmerged path arch/x86/kvm/x86.c
