iommu/arm-smmu-v3: Ratelimit event dump

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-358.el8
commit-author Jean-Philippe Brucker <jean-philippe@linaro.org>
commit 9cff922bba429b310507eac3b6cb5eb1b57e9ad1
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-358.el8/9cff922b.failed

When a device or driver misbehaves, it is possible to receive DMA fault
events much faster than we can print them out, causing a lock up of the
system and inability to cancel the source of the problem. Ratelimit
printing of events to help recovery.

	Tested-by: Aaro Koskinen <aaro.koskinen@nokia.com>
	Signed-off-by: Jean-Philippe Brucker <jean-philippe@linaro.org>
Link: https://lore.kernel.org/r/20210531095648.118282-1-jean-philippe@linaro.org
	Signed-off-by: Will Deacon <will@kernel.org>
(cherry picked from commit 9cff922bba429b310507eac3b6cb5eb1b57e9ad1)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/iommu/arm/arm-smmu-v3/arm-smmu-v3.c
diff --cc drivers/iommu/arm/arm-smmu-v3/arm-smmu-v3.c
index f453e04e3994,9ca9c5373591..000000000000
--- a/drivers/iommu/arm/arm-smmu-v3/arm-smmu-v3.c
+++ b/drivers/iommu/arm/arm-smmu-v3/arm-smmu-v3.c
@@@ -1389,6 -1526,10 +1391,13 @@@ static irqreturn_t arm_smmu_evtq_thread
  		while (!queue_remove_raw(q, evt)) {
  			u8 id = FIELD_GET(EVTQ_0_ID, evt[0]);
  
++<<<<<<< HEAD
++=======
+ 			ret = arm_smmu_handle_evt(smmu, evt);
+ 			if (!ret || !__ratelimit(&rs))
+ 				continue;
+ 
++>>>>>>> 9cff922bba42 (iommu/arm-smmu-v3: Ratelimit event dump)
  			dev_info(smmu->dev, "event 0x%02x received:\n", id);
  			for (i = 0; i < ARRAY_SIZE(evt); ++i)
  				dev_info(smmu->dev, "\t0x%016llx\n",
* Unmerged path drivers/iommu/arm/arm-smmu-v3/arm-smmu-v3.c
