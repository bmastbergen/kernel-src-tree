Documentation: networking: switchdev: fix command for static FDB entries

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-358.el8
commit-author Vladimir Oltean <vladimir.oltean@nxp.com>
commit 787a4109f46847975ffae7d528a55c6b768ef0aa
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-358.el8/787a4109.failed

The "bridge fdb add" command provided in the switchdev documentation is
junk now, not only because it is syntactically incorrect and rejected by
the iproute2 bridge program, but also because it was not updated in
light of Arkadi Sharshevsky's radical switchdev refactoring in commit
29ab586c3d83 ("net: switchdev: Remove bridge bypass support from
switchdev"). Try to explain what the intended usage pattern is with the
new kernel implementation.

	Signed-off-by: Vladimir Oltean <vladimir.oltean@nxp.com>
	Reviewed-by: Florian Fainelli <f.fainelli@gmail.com>
	Reviewed-by: Ido Schimmel <idosch@nvidia.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 787a4109f46847975ffae7d528a55c6b768ef0aa)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	Documentation/networking/switchdev.txt
diff --cc Documentation/networking/switchdev.txt
index 85b62d5f3e8a,1b56367d85ad..000000000000
--- a/Documentation/networking/switchdev.txt
+++ b/Documentation/networking/switchdev.txt
@@@ -171,21 -181,44 +171,50 @@@ To offloading L2 bridging, the switchde
  Static FDB Entries
  ^^^^^^^^^^^^^^^^^^
  
++<<<<<<< HEAD:Documentation/networking/switchdev.txt
 +The switchdev driver should implement ndo_fdb_add, ndo_fdb_del and ndo_fdb_dump
 +to support static FDB entries installed to the device.  Static bridge FDB
 +entries are installed, for example, using iproute2 bridge cmd:
- 
- 	bridge fdb add ADDR dev DEV [vlan VID] [self]
- 
- The driver should use the helper switchdev_port_fdb_xxx ops for ndo_fdb_xxx
- ops, and handle add/delete/dump of SWITCHDEV_OBJ_ID_PORT_FDB object using
- switchdev_port_obj_xxx ops.
- 
- XXX: what should be done if offloading this rule to hardware fails (for
- example, due to full capacity in hardware tables) ?
++=======
+ A driver which implements the ``ndo_fdb_add``, ``ndo_fdb_del`` and
+ ``ndo_fdb_dump`` operations is able to support the command below, which adds a
+ static bridge FDB entry::
++>>>>>>> 787a4109f468 (Documentation: networking: switchdev: fix command for static FDB entries):Documentation/networking/switchdev.rst
+ 
+         bridge fdb add dev DEV ADDRESS [vlan VID] [self] static
+ 
+ (the "static" keyword is non-optional: if not specified, the entry defaults to
+ being "local", which means that it should not be forwarded)
+ 
+ The "self" keyword (optional because it is implicit) has the role of
+ instructing the kernel to fulfill the operation through the ``ndo_fdb_add``
+ implementation of the ``DEV`` device itself. If ``DEV`` is a bridge port, this
+ will bypass the bridge and therefore leave the software database out of sync
+ with the hardware one.
+ 
+ To avoid this, the "master" keyword can be used::
+ 
+         bridge fdb add dev DEV ADDRESS [vlan VID] master static
+ 
+ The above command instructs the kernel to search for a master interface of
+ ``DEV`` and fulfill the operation through the ``ndo_fdb_add`` method of that.
+ This time, the bridge generates a ``SWITCHDEV_FDB_ADD_TO_DEVICE`` notification
+ which the port driver can handle and use it to program its hardware table. This
+ way, the software and the hardware database will both contain this static FDB
+ entry.
+ 
+ Note: for new switchdev drivers that offload the Linux bridge, implementing the
+ ``ndo_fdb_add`` and ``ndo_fdb_del`` bridge bypass methods is strongly
+ discouraged: all static FDB entries should be added on a bridge port using the
+ "master" flag. The ``ndo_fdb_dump`` is an exception and can be implemented to
+ visualize the hardware tables, if the device does not have an interrupt for
+ notifying the operating system of newly learned/forgotten dynamic FDB
+ addresses. In that case, the hardware FDB might end up having entries that the
+ software FDB does not, and implementing ``ndo_fdb_dump`` is the only way to see
+ them.
  
  Note: by default, the bridge does not filter on VLAN and only bridges untagged
 -traffic.  To enable VLAN support, turn on VLAN filtering::
 +traffic.  To enable VLAN support, turn on VLAN filtering:
  
  	echo 1 >/sys/class/net/<bridge>/bridge/vlan_filtering
  
* Unmerged path Documentation/networking/switchdev.txt
