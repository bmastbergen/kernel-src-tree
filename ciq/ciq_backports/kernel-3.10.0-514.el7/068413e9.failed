usb: ohci-da8xx can only be built-in

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
Rebuild_CHGLOG: - [usb] ohci-da8xx can only be built-in (Don Zickus) [1303209]
Rebuild_FUZZ: 92.54%
commit-author Arnd Bergmann <arnd@arndb.de>
commit 068413e9b7beb0843704ebaee3fb20f31c9a4cdf
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/068413e9.failed

The PHY setup code of the TI DaVinci DA8xx OHCI controller
uses ad-hoc register access using a pointer that is meant to
be used only by the DaVinci platform implementation and that
is intentionally not exported to loadable modules. This results
in a link error on configurations that use a modular OHCI
code on this platform.

While the proper solution for this problem would be to
implement a real PHY driver shared by ohci-da8xx and musb-da8xx,
this patch for now just works around the build error by
only allowing the ohci-da8xx code to be built-in.

	Signed-off-by: Arnd Bergmann <arnd@arndb.de>
	Acked-by: Alan Stern <stern@rowland.harvard.edu>
	Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
(cherry picked from commit 068413e9b7beb0843704ebaee3fb20f31c9a4cdf)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/usb/host/ohci-hcd.c
diff --cc drivers/usb/host/ohci-hcd.c
index a34868c2befc,f98d03f3144c..000000000000
--- a/drivers/usb/host/ohci-hcd.c
+++ b/drivers/usb/host/ohci-hcd.c
@@@ -1219,42 -1178,7 +1219,46 @@@ MODULE_LICENSE ("GPL")
  #define SA1111_DRIVER		ohci_hcd_sa1111_driver
  #endif
  
++<<<<<<< HEAD
 +#if defined(CONFIG_ARCH_S3C24XX) || defined(CONFIG_ARCH_S3C64XX)
 +#include "ohci-s3c2410.c"
 +#define S3C2410_PLATFORM_DRIVER	ohci_hcd_s3c2410_driver
 +#endif
 +
 +#ifdef CONFIG_USB_OHCI_HCD_OMAP1
 +#include "ohci-omap.c"
 +#define OMAP1_PLATFORM_DRIVER	ohci_hcd_omap_driver
 +#endif
 +
 +#ifdef CONFIG_USB_OHCI_HCD_OMAP3
 +#include "ohci-omap3.c"
 +#define OMAP3_PLATFORM_DRIVER	ohci_hcd_omap3_driver
 +#endif
 +
 +#if defined(CONFIG_PXA27x) || defined(CONFIG_PXA3xx)
 +#include "ohci-pxa27x.c"
 +#define PLATFORM_DRIVER		ohci_hcd_pxa27x_driver
 +#endif
 +
 +#ifdef CONFIG_ARCH_EP93XX
 +#include "ohci-ep93xx.c"
 +#define EP93XX_PLATFORM_DRIVER	ohci_hcd_ep93xx_driver
 +#endif
 +
 +#ifdef CONFIG_ARCH_AT91
 +#include "ohci-at91.c"
 +#define AT91_PLATFORM_DRIVER	ohci_hcd_at91_driver
 +#endif
 +
 +#ifdef CONFIG_ARCH_LPC32XX
 +#include "ohci-nxp.c"
 +#define NXP_PLATFORM_DRIVER	usb_hcd_nxp_driver
 +#endif
 +
 +#ifdef CONFIG_ARCH_DAVINCI_DA8XX
++=======
+ #ifdef CONFIG_USB_OHCI_HCD_DAVINCI
++>>>>>>> 068413e9b7be (usb: ohci-da8xx can only be built-in)
  #include "ohci-da8xx.c"
  #define DAVINCI_PLATFORM_DRIVER	ohci_hcd_da8xx_driver
  #endif
diff --git a/drivers/usb/host/Kconfig b/drivers/usb/host/Kconfig
index 4c29912fedea..41cf79c831b7 100644
--- a/drivers/usb/host/Kconfig
+++ b/drivers/usb/host/Kconfig
@@ -398,6 +398,16 @@ config USB_OHCI_HCD_OMAP3
 	  Enables support for the on-chip OHCI controller on
 	  OMAP3 and later chips.
 
+config USB_OHCI_HCD_DAVINCI
+	bool "OHCI support for TI DaVinci DA8xx"
+	depends on ARCH_DAVINCI_DA8XX
+	depends on USB_OHCI_HCD=y
+	default y
+	help
+	  Enables support for the DaVinci DA8xx integrated OHCI
+	  controller. This driver cannot currently be a loadable
+	  module because it lacks a proper PHY abstraction.
+
 config USB_OHCI_ATH79
 	bool "USB OHCI support for the Atheros AR71XX/AR7240 SoCs (DEPRECATED)"
 	depends on (SOC_AR71XX || SOC_AR724X)
* Unmerged path drivers/usb/host/ohci-hcd.c
