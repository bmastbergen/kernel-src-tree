iommu/vt-d: Make use of domain_alloc and domain_free

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
Rebuild_CHGLOG: - [iommu] vt-d: Make use of domain_alloc and domain_free (Myron Stowe) [1299039]
Rebuild_FUZZ: 93.88%
commit-author Joerg Roedel <jroedel@suse.de>
commit 00a77deb0f2f2c35cfeba183df98f92487d2e88b
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/00a77deb.failed

Get rid of domain_init and domain_destroy and implement
domain_alloc/domain_free instead.

	Reviewed-by: Alex Williamson <alex.williamson@redhat.com>
	Signed-off-by: Joerg Roedel <jroedel@suse.de>
(cherry picked from commit 00a77deb0f2f2c35cfeba183df98f92487d2e88b)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/iommu/intel-iommu.c
diff --cc drivers/iommu/intel-iommu.c
index 5a2efdb81364,a312e4966686..000000000000
--- a/drivers/iommu/intel-iommu.c
+++ b/drivers/iommu/intel-iommu.c
@@@ -446,8 -450,14 +449,14 @@@ EXPORT_SYMBOL_GPL(intel_iommu_gfx_mappe
  static DEFINE_SPINLOCK(device_domain_lock);
  static LIST_HEAD(device_domain_list);
  
 -static const struct iommu_ops intel_iommu_ops;
 +static struct iommu_ops intel_iommu_ops;
  
+ /* Convert generic 'struct iommu_domain to private struct dmar_domain */
+ static struct dmar_domain *to_dmar_domain(struct iommu_domain *dom)
+ {
+ 	return container_of(dom, struct dmar_domain, domain);
+ }
+ 
  static int __init intel_iommu_setup(char *str)
  {
  	if (!str)
@@@ -4582,9 -4601,10 +4590,16 @@@ static void intel_iommu_remove_device(s
  	iommu_device_unlink(iommu->iommu_dev, dev);
  }
  
++<<<<<<< HEAD
 +static struct iommu_ops intel_iommu_ops = {
 +	.domain_init	= intel_iommu_domain_init,
 +	.domain_destroy = intel_iommu_domain_destroy,
++=======
+ static const struct iommu_ops intel_iommu_ops = {
+ 	.capable	= intel_iommu_capable,
+ 	.domain_alloc	= intel_iommu_domain_alloc,
+ 	.domain_free	= intel_iommu_domain_free,
++>>>>>>> 00a77deb0f2f (iommu/vt-d: Make use of domain_alloc and domain_free)
  	.attach_dev	= intel_iommu_attach_device,
  	.detach_dev	= intel_iommu_detach_device,
  	.map		= intel_iommu_map,
* Unmerged path drivers/iommu/intel-iommu.c
