ipvs: handle ip_vs_fill_iph_skb_off failure

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
commit-author Arnd Bergmann <arnd@arndb.de>
commit 3f20efba41916ee17ce82f0fdd02581ada2872b2
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/3f20efba.failed

ip_vs_fill_iph_skb_off() may not find an IP header, and gcc has
determined that ip_vs_sip_fill_param() then incorrectly accesses
the protocol fields:

net/netfilter/ipvs/ip_vs_pe_sip.c: In function 'ip_vs_sip_fill_param':
net/netfilter/ipvs/ip_vs_pe_sip.c:76:5: error: 'iph.protocol' may be used uninitialized in this function [-Werror=maybe-uninitialized]
  if (iph.protocol != IPPROTO_UDP)
     ^
net/netfilter/ipvs/ip_vs_pe_sip.c:81:10: error: 'iph.len' may be used uninitialized in this function [-Werror=maybe-uninitialized]
  dataoff = iph.len + sizeof(struct udphdr);
          ^

This adds a check for the ip_vs_fill_iph_skb_off() return code
before looking at the ip header data returned from it.

	Signed-off-by: Arnd Bergmann <arnd@arndb.de>
Fixes: b0e010c527de ("ipvs: replace ip_vs_fill_ip4hdr with ip_vs_fill_iph_skb_off")
	Acked-by: Julian Anastasov <ja@ssi.bg>
	Signed-off-by: Simon Horman <horms@verge.net.au>
(cherry picked from commit 3f20efba41916ee17ce82f0fdd02581ada2872b2)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/netfilter/ipvs/ip_vs_pe_sip.c
diff --cc net/netfilter/ipvs/ip_vs_pe_sip.c
index bed5f7042529,c4e9ca016a88..000000000000
--- a/net/netfilter/ipvs/ip_vs_pe_sip.c
+++ b/net/netfilter/ipvs/ip_vs_pe_sip.c
@@@ -70,10 -70,10 +70,14 @@@ ip_vs_sip_fill_param(struct ip_vs_conn_
  	const char *dptr;
  	int retc;
  
++<<<<<<< HEAD
 +	ip_vs_fill_iph_skb(p->af, skb, &iph);
++=======
+ 	retc = ip_vs_fill_iph_skb(p->af, skb, false, &iph);
++>>>>>>> 3f20efba4191 (ipvs: handle ip_vs_fill_iph_skb_off failure)
  
  	/* Only useful with UDP */
- 	if (iph.protocol != IPPROTO_UDP)
+ 	if (!retc || iph.protocol != IPPROTO_UDP)
  		return -EINVAL;
  	/* todo: IPv6 fragments:
  	 *       I think this only should be done for the first fragment. /HS
* Unmerged path net/netfilter/ipvs/ip_vs_pe_sip.c
