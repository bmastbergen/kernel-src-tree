SUNRPC: Remove the redundant XPRT_CONNECTION_CLOSE flag

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
commit-author Trond Myklebust <trond.myklebust@primarydata.com>
commit 9e2b9f37760e129cee053cc7b6e7288acc2a7134
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/9e2b9f37.failed

	Signed-off-by: Trond Myklebust <trond.myklebust@primarydata.com>
(cherry picked from commit 9e2b9f37760e129cee053cc7b6e7288acc2a7134)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	include/linux/sunrpc/xprt.h
#	net/sunrpc/xprtsock.c
diff --cc include/linux/sunrpc/xprt.h
index d809b906cb69,8b93ef53df3c..000000000000
--- a/include/linux/sunrpc/xprt.h
+++ b/include/linux/sunrpc/xprt.h
@@@ -360,8 -360,6 +360,11 @@@ void			xprt_unlock_connect(struct rpc_x
  #define XPRT_BOUND		(4)
  #define XPRT_BINDING		(5)
  #define XPRT_CLOSING		(6)
++<<<<<<< HEAD
 +#define XPRT_CONNECTION_ABORT	(7)
 +#define XPRT_CONNECTION_CLOSE	(8)
++=======
++>>>>>>> 9e2b9f37760e (SUNRPC: Remove the redundant XPRT_CONNECTION_CLOSE flag)
  #define XPRT_CONGESTED		(9)
  
  static inline void xprt_set_connected(struct rpc_xprt *xprt)
diff --cc net/sunrpc/xprtsock.c
index b0582fdf9149,c72b13e2bdf5..000000000000
--- a/net/sunrpc/xprtsock.c
+++ b/net/sunrpc/xprtsock.c
@@@ -860,6 -801,14 +860,17 @@@ static void xs_error_report(struct soc
  	read_unlock_bh(&sk->sk_callback_lock);
  }
  
++<<<<<<< HEAD
++=======
+ static void xs_sock_reset_connection_flags(struct rpc_xprt *xprt)
+ {
+ 	smp_mb__before_atomic();
+ 	clear_bit(XPRT_CLOSE_WAIT, &xprt->state);
+ 	clear_bit(XPRT_CLOSING, &xprt->state);
+ 	smp_mb__after_atomic();
+ }
+ 
++>>>>>>> 9e2b9f37760e (SUNRPC: Remove the redundant XPRT_CONNECTION_CLOSE flag)
  static void xs_reset_transport(struct sock_xprt *transport)
  {
  	struct socket *sock = transport->sock;
* Unmerged path include/linux/sunrpc/xprt.h
diff --git a/net/sunrpc/xprt.c b/net/sunrpc/xprt.c
index cca0b403cca1..2f3218ac400a 100644
--- a/net/sunrpc/xprt.c
+++ b/net/sunrpc/xprt.c
@@ -681,7 +681,6 @@ xprt_init_autodisconnect(unsigned long data)
 	if (test_and_set_bit(XPRT_LOCKED, &xprt->state))
 		goto out_abort;
 	spin_unlock(&xprt->transport_lock);
-	set_bit(XPRT_CONNECTION_CLOSE, &xprt->state);
 	queue_work(rpciod_workqueue, &xprt->task_cleanup);
 	return;
 out_abort:
* Unmerged path net/sunrpc/xprtsock.c
