efi: efi-stub-helper cleanup

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
commit-author Leif Lindholm <leif.lindholm@linaro.org>
commit 9403e462fb5ffa9eeaa9663cb23ded02b7e603a3
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/9403e462.failed

An #ifdef CONFIG_ARM clause in efi-stub-helper.c got included with some
of the generic stub rework by Roy Franz. Drop it here to make subsequent
patches less confusing.

Also, In handle_cmdline_files(), fh is not initialized, and while the
overall logic around this handling appears safe, gcc does not always
pick this up. Initialize to NULL to remove the resulting warning.

	Signed-off-by: Leif Lindholm <leif.lindholm@linaro.org>
	Signed-off-by: Matt Fleming <matt.fleming@intel.com>
(cherry picked from commit 9403e462fb5ffa9eeaa9663cb23ded02b7e603a3)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/firmware/efi/efi-stub-helper.c
diff --cc drivers/firmware/efi/efi-stub-helper.c
index f243c3499856,47722003b8fc..000000000000
--- a/drivers/firmware/efi/efi-stub-helper.c
+++ b/drivers/firmware/efi/efi-stub-helper.c
@@@ -246,23 -252,24 +246,30 @@@ static void efi_free(efi_system_table_
  
  
  /*
 - * Check the cmdline for a LILO-style file= arguments.
 + * Check the cmdline for a LILO-style initrd= arguments.
   *
 - * We only support loading a file from the same filesystem as
 - * the kernel image.
 + * We only support loading an initrd from the same filesystem as the
 + * kernel image.
   */
 -static efi_status_t handle_cmdline_files(efi_system_table_t *sys_table_arg,
 -					 efi_loaded_image_t *image,
 -					 char *cmd_line, char *option_string,
 -					 unsigned long max_addr,
 -					 unsigned long *load_addr,
 -					 unsigned long *load_size)
 +static efi_status_t handle_ramdisks(efi_system_table_t *sys_table_arg,
 +				    efi_loaded_image_t *image,
 +				    struct setup_header *hdr)
  {
++<<<<<<< HEAD
 +	struct initrd *initrds;
 +	unsigned long initrd_addr;
 +	efi_guid_t fs_proto = EFI_FILE_SYSTEM_GUID;
 +	u64 initrd_total;
 +	efi_file_io_interface_t *io;
 +	efi_file_handle_t *fh;
++=======
+ 	struct file_info *files;
+ 	unsigned long file_addr;
+ 	u64 file_size_total;
+ 	efi_file_handle_t *fh = NULL;
++>>>>>>> 9403e462fb5f (efi: efi-stub-helper cleanup)
  	efi_status_t status;
 -	int nr_files;
 +	int nr_initrds;
  	char *str;
  	int i, j, k;
  
* Unmerged path drivers/firmware/efi/efi-stub-helper.c
