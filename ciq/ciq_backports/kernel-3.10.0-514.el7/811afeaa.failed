net/mlx5e: Use ndo_stop explicitly at shutdown flow

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
Rebuild_CHGLOG: - [netdrv] mlx5e: Use ndo_stop explicitly at shutdown flow (kamal heib) [1275159 1296272 1296405 1298421 1298422 1298423 1298424 1298425]
Rebuild_FUZZ: 95.92%
commit-author Eran Ben Elisha <eranbe@mellanox.com>
commit 811afeaa3797bdf4eabed286100811b33005c9e0
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/811afeaa.failed

The current implementation copies the flow of ndo_stop instead of
calling it explicitly, Fixed it.

Fixes: 5fc7197d3a25 ("net/mlx5: Add pci shutdown callback")
	Signed-off-by: Eran Ben Elisha <eranbe@mellanox.com>
	Signed-off-by: Saeed Mahameed <saeedm@mellanox.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 811afeaa3797bdf4eabed286100811b33005c9e0)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/mellanox/mlx5/core/en_main.c
diff --cc drivers/net/ethernet/mellanox/mlx5/core/en_main.c
index 7b4dd1c5db29,f5c8d5db25a8..000000000000
--- a/drivers/net/ethernet/mellanox/mlx5/core/en_main.c
+++ b/drivers/net/ethernet/mellanox/mlx5/core/en_main.c
@@@ -2457,17 -3187,26 +2457,32 @@@ static void mlx5e_destroy_netdev(struc
  
  	set_bit(MLX5E_STATE_DESTROYING, &priv->state);
  
 -	queue_work(priv->wq, &priv->set_rx_mode_work);
 +	schedule_work(&priv->set_rx_mode_work);
  	mlx5e_disable_async_events(priv);
++<<<<<<< HEAD
 +	flush_scheduled_work();
 +	unregister_netdev(netdev);
 +	mlx5e_destroy_flow_tables(priv);
++=======
+ 	flush_workqueue(priv->wq);
+ 	if (test_bit(MLX5_INTERFACE_STATE_SHUTDOWN, &mdev->intf_state)) {
+ 		netif_device_detach(netdev);
+ 		mlx5e_close(netdev);
+ 	} else {
+ 		unregister_netdev(netdev);
+ 	}
+ 
+ 	mlx5e_tc_cleanup(priv);
+ 	mlx5e_vxlan_cleanup(priv);
+ 	mlx5e_destroy_q_counter(priv);
+ 	mlx5e_destroy_flow_steering(priv);
++>>>>>>> 811afeaa3797 (net/mlx5e: Use ndo_stop explicitly at shutdown flow)
  	mlx5e_destroy_tirs(priv);
 -	mlx5e_destroy_rqts(priv);
 +	mlx5e_destroy_rqt(priv, MLX5E_SINGLE_RQ_RQT);
 +	mlx5e_destroy_rqt(priv, MLX5E_INDIRECTION_RQT);
  	mlx5e_close_drop_rq(priv);
  	mlx5e_destroy_tises(priv);
 -	mlx5_core_destroy_mkey(priv->mdev, &priv->umr_mkey);
 -	mlx5_core_destroy_mkey(priv->mdev, &priv->mkey);
 +	mlx5_core_destroy_mkey(priv->mdev, &priv->mr);
  	mlx5_core_dealloc_transport_domain(priv->mdev, priv->tdn);
  	mlx5_core_dealloc_pd(priv->mdev, priv->pdn);
  	mlx5_unmap_free_uar(priv->mdev, &priv->cq_uar);
* Unmerged path drivers/net/ethernet/mellanox/mlx5/core/en_main.c
