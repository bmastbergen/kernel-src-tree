drm/mgag200: Black screen fix for G200e rev 4

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
commit-author Mathieu Larouche <mathieu.larouche@matrox.com>
commit d3922b69617b62bb2509936b68301f837229d9f0
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/d3922b69.failed

- Fixed black screen for some resolutions of G200e rev4
- Fixed testm & testn which had predetermined value.

	Reported-by: Jan Beulich <jbeulich@suse.com>

	Signed-off-by: Mathieu Larouche <mathieu.larouche@matrox.com>
	Cc: stable@vger.kernel.org
	Signed-off-by: Dave Airlie <airlied@redhat.com>
(cherry picked from commit d3922b69617b62bb2509936b68301f837229d9f0)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/gpu/drm/mgag200/mgag200_mode.c
diff --cc drivers/gpu/drm/mgag200/mgag200_mode.c
index ad4b9010dfb0,d347dca17267..000000000000
--- a/drivers/gpu/drm/mgag200/mgag200_mode.c
+++ b/drivers/gpu/drm/mgag200/mgag200_mode.c
@@@ -142,6 -138,60 +142,63 @@@ static int mga_g200se_set_plls(struct m
  				}
  			}
  		}
++<<<<<<< HEAD
++=======
+ 	} else {
+ 
+ 
+ 		m = n = p = 0;
+ 		vcomax        = 1600000;
+ 		vcomin        = 800000;
+ 		pllreffreq    = 25000;
+ 
+ 		if (clock < 25000)
+ 			clock = 25000;
+ 
+ 		clock = clock * 2;
+ 
+ 		delta = 0xFFFFFFFF;
+ 		/* Permited delta is 0.5% as VESA Specification */
+ 		permitteddelta = clock * 5 / 1000;
+ 
+ 		for (i = 0 ; i < P_ARRAY_SIZE ; i++) {
+ 			testp = pvalues_e4[i];
+ 
+ 			if ((clock * testp) > vcomax)
+ 				continue;
+ 			if ((clock * testp) < vcomin)
+ 				continue;
+ 
+ 			for (testn = 50; testn <= 256; testn++) {
+ 				for (testm = 1; testm <= 32; testm++) {
+ 					computed = (pllreffreq * testn) /
+ 						(testm * testp);
+ 					if (computed > clock)
+ 						tmpdelta = computed - clock;
+ 					else
+ 						tmpdelta = clock - computed;
+ 
+ 					if (tmpdelta < delta) {
+ 						delta = tmpdelta;
+ 						m = testm - 1;
+ 						n = testn - 1;
+ 						p = testp - 1;
+ 					}
+ 				}
+ 			}
+ 		}
+ 
+ 		fvv = pllreffreq * (n + 1) / (m + 1);
+ 		fvv = (fvv - 800000) / 50000;
+ 
+ 		if (fvv > 15)
+ 			fvv = 15;
+ 
+ 		p |= (fvv << 4);
+ 		m |= 0x80;
+ 
+ 		clock = clock / 2;
++>>>>>>> d3922b69617b (drm/mgag200: Black screen fix for G200e rev 4)
  	}
  
  	if (delta > permitteddelta) {
* Unmerged path drivers/gpu/drm/mgag200/mgag200_mode.c
