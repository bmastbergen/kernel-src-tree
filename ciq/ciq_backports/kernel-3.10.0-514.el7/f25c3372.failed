mmc: sdhci: add DDR50 1.8V mode support for BayTrail eMMC Controller

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
Rebuild_CHGLOG: - [mmc] sdhci: add DDR50 1.8V mode support for BayTrail eMMC Controller (Don Zickus) [1127975 1277866 1280133 1286932 1297039]
Rebuild_FUZZ: 96.18%
commit-author Maurice Petallo <mauricex.r.petallo@intel.com>
commit f25c33724d1512a72554c0ad4cb70b43ba15374e
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/f25c3372.failed

This is to enable DDR50 bus speed mode with 1.8V signaling capability
for BayTrail ACPI and PCI mode eMMC Controller.

	Signed-off-by: Maurice Petallo <mauricex.r.petallo@intel.com>
	Acked-by: Adrian Hunter <adrian.hunter@intel.com>
	Signed-off-by: Ulf Hansson <ulf.hansson@linaro.org>
(cherry picked from commit f25c33724d1512a72554c0ad4cb70b43ba15374e)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/mmc/host/sdhci-pci.c
diff --cc drivers/mmc/host/sdhci-pci.c
index 964a1866c95c,42f4633d0060..000000000000
--- a/drivers/mmc/host/sdhci-pci.c
+++ b/drivers/mmc/host/sdhci-pci.c
@@@ -246,10 -250,27 +246,15 @@@ static const struct sdhci_pci_fixes sdh
  	.probe_slot	= pch_hc_probe_slot,
  };
  
 -static void sdhci_pci_int_hw_reset(struct sdhci_host *host)
 -{
 -	u8 reg;
 -
 -	reg = sdhci_readb(host, SDHCI_POWER_CONTROL);
 -	reg |= 0x10;
 -	sdhci_writeb(host, reg, SDHCI_POWER_CONTROL);
 -	/* For eMMC, minimum is 1us but give it 9us for good measure */
 -	udelay(9);
 -	reg &= ~0x10;
 -	sdhci_writeb(host, reg, SDHCI_POWER_CONTROL);
 -	/* For eMMC, minimum is 200us but give it 300us for good measure */
 -	usleep_range(300, 1000);
 -}
 -
  static int byt_emmc_probe_slot(struct sdhci_pci_slot *slot)
  {
++<<<<<<< HEAD
 +	slot->host->mmc->caps |= MMC_CAP_8_BIT_DATA | MMC_CAP_NONREMOVABLE;
++=======
+ 	slot->host->mmc->caps |= MMC_CAP_8_BIT_DATA | MMC_CAP_NONREMOVABLE |
+ 				 MMC_CAP_HW_RESET | MMC_CAP_1_8V_DDR;
++>>>>>>> f25c33724d15 (mmc: sdhci: add DDR50 1.8V mode support for BayTrail eMMC Controller)
  	slot->host->mmc->caps2 |= MMC_CAP2_HC_ERASE_SZ;
 -	slot->hw_reset = sdhci_pci_int_hw_reset;
  	return 0;
  }
  
diff --git a/drivers/mmc/host/sdhci-acpi.c b/drivers/mmc/host/sdhci-acpi.c
index 6bb0a4230c7a..7c7de0b3ea5b 100644
--- a/drivers/mmc/host/sdhci-acpi.c
+++ b/drivers/mmc/host/sdhci-acpi.c
@@ -116,7 +116,8 @@ static const struct sdhci_acpi_chip sdhci_acpi_chip_int = {
 
 static const struct sdhci_acpi_slot sdhci_acpi_slot_int_emmc = {
 	.chip    = &sdhci_acpi_chip_int,
-	.caps    = MMC_CAP_8_BIT_DATA | MMC_CAP_NONREMOVABLE | MMC_CAP_HW_RESET,
+	.caps    = MMC_CAP_8_BIT_DATA | MMC_CAP_NONREMOVABLE |
+		   MMC_CAP_HW_RESET | MMC_CAP_1_8V_DDR,
 	.caps2   = MMC_CAP2_HC_ERASE_SZ,
 	.flags   = SDHCI_ACPI_RUNTIME_PM,
 	.quirks2 = SDHCI_QUIRK2_PRESET_VALUE_BROKEN,
* Unmerged path drivers/mmc/host/sdhci-pci.c
