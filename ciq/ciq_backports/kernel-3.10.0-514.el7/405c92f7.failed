ipv6: add defensive check for CHECKSUM_PARTIAL skbs in ip_fragment

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
commit-author Hannes Frederic Sowa <hannes@stressinduktion.org>
commit 405c92f7a5417274419192ad134d6dc71aedaaa4
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/405c92f7.failed

CHECKSUM_PARTIAL skbs should never arrive in ip_fragment. If we get one
of those warn about them once and handle them gracefully by recalculating
the checksum.

Fixes: commit 32dce968dd987 ("ipv6: Allow for partial checksums on non-ufo packets")
See-also: commit 72e843bb09d45 ("ipv6: ip6_fragment() should check CHECKSUM_PARTIAL")
	Cc: Eric Dumazet <edumazet@google.com>
	Cc: Vlad Yasevich <vyasevich@gmail.com>
	Cc: Benjamin Coddington <bcodding@redhat.com>
	Cc: Tom Herbert <tom@herbertland.com>
	Signed-off-by: Hannes Frederic Sowa <hannes@stressinduktion.org>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 405c92f7a5417274419192ad134d6dc71aedaaa4)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/ipv6/ip6_output.c
diff --cc net/ipv6/ip6_output.c
index 6e24dc6ba803,e6a7bd15b9b7..000000000000
--- a/net/ipv6/ip6_output.c
+++ b/net/ipv6/ip6_output.c
@@@ -562,8 -596,18 +562,19 @@@ int ip6_fragment(struct sock *sk, struc
  		if (np->frag_size)
  			mtu = np->frag_size;
  	}
 -	if (mtu < hlen + sizeof(struct frag_hdr) + 8)
 -		goto fail_toobig;
  	mtu -= hlen + sizeof(struct frag_hdr);
  
++<<<<<<< HEAD
++=======
+ 	frag_id = ipv6_select_ident(net, &ipv6_hdr(skb)->daddr,
+ 				    &ipv6_hdr(skb)->saddr);
+ 
+ 	if (skb->ip_summed == CHECKSUM_PARTIAL &&
+ 	    (err = skb_checksum_help(skb)))
+ 		goto fail;
+ 
+ 	hroom = LL_RESERVED_SPACE(rt->dst.dev);
++>>>>>>> 405c92f7a541 (ipv6: add defensive check for CHECKSUM_PARTIAL skbs in ip_fragment)
  	if (skb_has_frag_list(skb)) {
  		int first_len = skb_pagelen(skb);
  		struct sk_buff *frag2;
* Unmerged path net/ipv6/ip6_output.c
