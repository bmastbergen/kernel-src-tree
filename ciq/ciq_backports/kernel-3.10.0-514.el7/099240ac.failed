x86/efi: Delete dead code when checking for non-native

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
Rebuild_CHGLOG: - [x86] efi: Delete dead code when checking for non-native (Lenny Szubowicz) [1310154]
Rebuild_FUZZ: 96.15%
commit-author Matt Fleming <matt.fleming@intel.com>
commit 099240ac111aac454962e6399c0cc51d1511504a
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/099240ac.failed

Both efi_free_boot_services() and efi_enter_virtual_mode() are invoked
from init/main.c, but only if the EFI runtime services are available.
This is not the case for non-native boots, e.g. where a 64-bit kernel is
booted with 32-bit EFI firmware.

Delete the dead code.

	Acked-by: Borislav Petkov <bp@suse.de>
	Signed-off-by: Matt Fleming <matt.fleming@intel.com>
(cherry picked from commit 099240ac111aac454962e6399c0cc51d1511504a)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/x86/platform/efi/efi.c
diff --cc arch/x86/platform/efi/efi.c
index 4374bb91ee4e,b96ae7918a16..000000000000
--- a/arch/x86/platform/efi/efi.c
+++ b/arch/x86/platform/efi/efi.c
@@@ -1110,23 -1002,20 +1107,35 @@@ static void __init __efi_enter_virtual_
  
  	efi.systab = NULL;
  
++<<<<<<< HEAD
 +	/*
 +	 * We don't do virtual mode, since we don't do runtime services, on
 +	 * non-native EFI
 +	 */
 +	if (!efi_is_native()) {
 +		efi_unmap_memmap();
 +		return;
 +	}
 +
 +	efi_merge_regions();
 +	new_memmap = efi_map_regions(&count, &pg_shift);
 +	if (!new_memmap) {
 +		pr_err("Error reallocating memory, EFI runtime non-functional!\n");
 +		return;
++=======
+ 	if (efi_setup) {
+ 		efi_map_regions_fixed();
+ 	} else {
+ 		efi_merge_regions();
+ 		new_memmap = efi_map_regions(&count);
+ 		if (!new_memmap) {
+ 			pr_err("Error reallocating memory, EFI runtime non-functional!\n");
+ 			return;
+ 		}
++>>>>>>> 099240ac111a (x86/efi: Delete dead code when checking for non-native)
  	}
  
 -	err = save_runtime_map();
 -	if (err)
 -		pr_err("Error saving runtime map, efi runtime on kexec non-functional!!\n");
 +	save_runtime_map();
  
  	BUG_ON(!efi.systab);
  
* Unmerged path arch/x86/platform/efi/efi.c
