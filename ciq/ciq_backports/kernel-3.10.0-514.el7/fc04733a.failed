netfilter: nfnetlink: use original skbuff when committing/aborting

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
commit-author Pablo Neira Ayuso <pablo@netfilter.org>
commit fc04733a1a71af26bf30830571b71f5f2a354a06
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/fc04733a.failed

This allows us to access the original content of the batch from
the commit and the abort paths.

	Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
(cherry picked from commit fc04733a1a71af26bf30830571b71f5f2a354a06)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/netfilter/nfnetlink.c
diff --cc net/netfilter/nfnetlink.c
index 158c193cef9a,f77d3f7f22b5..000000000000
--- a/net/netfilter/nfnetlink.c
+++ b/net/netfilter/nfnetlink.c
@@@ -380,8 -333,7 +380,12 @@@ replay
  			 * original skb.
  			 */
  			if (err == -EAGAIN) {
++<<<<<<< HEAD
 +				nfnl_err_reset(&err_list);
 +				ss->abort(skb);
++=======
+ 				ss->abort(oskb);
++>>>>>>> fc04733a1a71 (netfilter: nfnetlink: use original skbuff when committing/aborting)
  				nfnl_unlock(subsys_id);
  				kfree_skb(nskb);
  				goto replay;
@@@ -418,11 -357,10 +422,11 @@@ ack
  	}
  done:
  	if (success && done)
- 		ss->commit(skb);
+ 		ss->commit(oskb);
  	else
- 		ss->abort(skb);
+ 		ss->abort(oskb);
  
 +	nfnl_err_deliver(&err_list, oskb);
  	nfnl_unlock(subsys_id);
  	kfree_skb(nskb);
  }
* Unmerged path net/netfilter/nfnetlink.c
