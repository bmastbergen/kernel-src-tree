x86/microcode/intel: Move the BUG_ON up and turn it into WARN_ON

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
Rebuild_CHGLOG: - [x86] microcode/intel: Move the BUG_ON up and turn it into WARN_ON (Prarit Bhargava) [1253762]
Rebuild_FUZZ: 96.77%
commit-author Borislav Petkov <bp@suse.de>
commit 58b5f2cc4bdbc9b616e68639f5a84886aa5be590
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/58b5f2cc.failed

If we're going to BUG_ON() because we're running on the wrong CPU, we
better do it as the first thing we do when entering that function. And
also, turn it into a WARN_ON() because it is not worth to panic the
system if we apply the microcode on the wrong CPU - we're simply going
to exit early.

	Tested-by: Thomas Voegtle <tv@lio96.de>
	Signed-off-by: Borislav Petkov <bp@suse.de>
	Cc: Linus Torvalds <torvalds@linux-foundation.org>
	Cc: Peter Zijlstra <peterz@infradead.org>
	Cc: Thomas Gleixner <tglx@linutronix.de>
Link: http://lkml.kernel.org/r/1454499225-21544-11-git-send-email-bp@alien8.de
	Signed-off-by: Ingo Molnar <mingo@kernel.org>
(cherry picked from commit 58b5f2cc4bdbc9b616e68639f5a84886aa5be590)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/x86/kernel/cpu/microcode/intel.c
diff --cc arch/x86/kernel/cpu/microcode/intel.c
index 865d78872256,c029c2bb2a29..000000000000
--- a/arch/x86/kernel/cpu/microcode/intel.c
+++ b/arch/x86/kernel/cpu/microcode/intel.c
@@@ -74,13 -843,13 +74,22 @@@ static int apply_microcode_intel(int cp
  	int cpu_num = raw_smp_processor_id();
  	struct cpuinfo_x86 *c = &cpu_data(cpu_num);
  
+ 	/* We should bind the task to the CPU */
+ 	if (WARN_ON(cpu_num != cpu))
+ 		return -1;
+ 
  	uci = ucode_cpu_info + cpu;
++<<<<<<< HEAD
 +	mc_intel = uci->mc;
 +
 +	/* We should bind the task to the CPU */
 +	BUG_ON(cpu_num != cpu);
 +
 +	if (mc_intel == NULL)
++=======
+ 	mc = uci->mc;
+ 	if (!mc)
++>>>>>>> 58b5f2cc4bdb (x86/microcode/intel: Move the BUG_ON up and turn it into WARN_ON)
  		return 0;
  
  	/*
* Unmerged path arch/x86/kernel/cpu/microcode/intel.c
