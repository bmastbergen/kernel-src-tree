x86/insn: remove pcommit

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
commit-author Dan Williams <dan.j.williams@intel.com>
commit fd1d961dd681d58308456049a817cbf4c0662018
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/fd1d961d.failed

The pcommit instruction is being deprecated in favor of either ADR
(asynchronous DRAM refresh: flush-on-power-fail) at the platform level, or
posted-write-queue flush addresses as defined by the ACPI 6.x NFIT (NVDIMM
Firmware Interface Table).

	Cc: Thomas Gleixner <tglx@linutronix.de>
	Cc: "H. Peter Anvin" <hpa@zytor.com>
	Cc: x86@kernel.org
	Cc: Josh Poimboeuf <jpoimboe@redhat.com>
	Cc: Peter Zijlstra <peterz@infradead.org>
	Cc: Arnaldo Carvalho de Melo <acme@kernel.org>
	Cc: Alexander Shishkin <alexander.shishkin@linux.intel.com>
	Cc: Borislav Petkov <bp@suse.de>
	Cc: Andy Lutomirski <luto@kernel.org>
	Cc: Xiao Guangrong <guangrong.xiao@linux.intel.com>
	Cc: Adrian Hunter <adrian.hunter@intel.com>
	Cc: Ross Zwisler <ross.zwisler@linux.intel.com>
	Acked-by: Ingo Molnar <mingo@redhat.com>
	Signed-off-by: Dan Williams <dan.j.williams@intel.com>
(cherry picked from commit fd1d961dd681d58308456049a817cbf4c0662018)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/x86/include/asm/cpufeatures.h
#	arch/x86/include/asm/special_insns.h
#	arch/x86/lib/x86-opcode-map.txt
#	tools/objtool/arch/x86/insn/x86-opcode-map.txt
#	tools/perf/arch/x86/tests/insn-x86-dat-32.c
#	tools/perf/arch/x86/tests/insn-x86-dat-64.c
#	tools/perf/arch/x86/tests/insn-x86-dat-src.c
#	tools/perf/util/intel-pt-decoder/x86-opcode-map.txt
diff --cc arch/x86/include/asm/special_insns.h
index fc7d11200445,587d7914ea4b..000000000000
--- a/arch/x86/include/asm/special_insns.h
+++ b/arch/x86/include/asm/special_insns.h
@@@ -199,6 -239,20 +199,23 @@@ static inline void clflushopt(volatile 
  		       "+m" (*(volatile char __force *)__p));
  }
  
++<<<<<<< HEAD
++=======
+ static inline void clwb(volatile void *__p)
+ {
+ 	volatile struct { char x[64]; } *p = __p;
+ 
+ 	asm volatile(ALTERNATIVE_2(
+ 		".byte " __stringify(NOP_DS_PREFIX) "; clflush (%[pax])",
+ 		".byte 0x66; clflush (%[pax])", /* clflushopt (%%rax) */
+ 		X86_FEATURE_CLFLUSHOPT,
+ 		".byte 0x66, 0x0f, 0xae, 0x30",  /* clwb (%%rax) */
+ 		X86_FEATURE_CLWB)
+ 		: [p] "+m" (*p)
+ 		: [pax] "a" (p));
+ }
+ 
++>>>>>>> fd1d961dd681 (x86/insn: remove pcommit)
  #define nop() asm volatile ("nop")
  
  
diff --cc arch/x86/lib/x86-opcode-map.txt
index a02a195d219c,28632ee68377..000000000000
--- a/arch/x86/lib/x86-opcode-map.txt
+++ b/arch/x86/lib/x86-opcode-map.txt
@@@ -936,8 -946,8 +936,13 @@@ GrpTable: Grp1
  3: vstmxcsr Md (v1) | WRGSBASE Ry (F3),(11B)
  4: XSAVE
  5: XRSTOR | lfence (11B)
++<<<<<<< HEAD
 +6: XSAVEOPT | mfence (11B)
 +7: clflush | sfence (11B)
++=======
+ 6: XSAVEOPT | clwb (66) | mfence (11B)
+ 7: clflush | clflushopt (66) | sfence (11B)
++>>>>>>> fd1d961dd681 (x86/insn: remove pcommit)
  EndTable
  
  GrpTable: Grp16
diff --cc tools/perf/util/intel-pt-decoder/x86-opcode-map.txt
index a02a195d219c,28632ee68377..000000000000
--- a/tools/perf/util/intel-pt-decoder/x86-opcode-map.txt
+++ b/tools/perf/util/intel-pt-decoder/x86-opcode-map.txt
@@@ -936,8 -946,8 +936,13 @@@ GrpTable: Grp1
  3: vstmxcsr Md (v1) | WRGSBASE Ry (F3),(11B)
  4: XSAVE
  5: XRSTOR | lfence (11B)
++<<<<<<< HEAD
 +6: XSAVEOPT | mfence (11B)
 +7: clflush | sfence (11B)
++=======
+ 6: XSAVEOPT | clwb (66) | mfence (11B)
+ 7: clflush | clflushopt (66) | sfence (11B)
++>>>>>>> fd1d961dd681 (x86/insn: remove pcommit)
  EndTable
  
  GrpTable: Grp16
* Unmerged path arch/x86/include/asm/cpufeatures.h
* Unmerged path tools/objtool/arch/x86/insn/x86-opcode-map.txt
* Unmerged path tools/perf/arch/x86/tests/insn-x86-dat-32.c
* Unmerged path tools/perf/arch/x86/tests/insn-x86-dat-64.c
* Unmerged path tools/perf/arch/x86/tests/insn-x86-dat-src.c
* Unmerged path arch/x86/include/asm/cpufeatures.h
* Unmerged path arch/x86/include/asm/special_insns.h
* Unmerged path arch/x86/lib/x86-opcode-map.txt
* Unmerged path tools/objtool/arch/x86/insn/x86-opcode-map.txt
* Unmerged path tools/perf/arch/x86/tests/insn-x86-dat-32.c
* Unmerged path tools/perf/arch/x86/tests/insn-x86-dat-64.c
* Unmerged path tools/perf/arch/x86/tests/insn-x86-dat-src.c
* Unmerged path tools/perf/util/intel-pt-decoder/x86-opcode-map.txt
