NFSv4.1/pnfs: Don't prevent layoutgets when doing return-on-close

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
commit-author Trond Myklebust <trond.myklebust@primarydata.com>
commit 5c4a79fb2b1cd80cb58986f6acf402721901c545
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/5c4a79fb.failed

If there is an outstanding return-on-close, then we just want new
layoutget requests to wait rather than fail.

	Signed-off-by: Trond Myklebust <trond.myklebust@primarydata.com>
(cherry picked from commit 5c4a79fb2b1cd80cb58986f6acf402721901c545)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	fs/nfs/pnfs.c
diff --cc fs/nfs/pnfs.c
index 6ac8d2b4bc82,8c5f9f59efbb..000000000000
--- a/fs/nfs/pnfs.c
+++ b/fs/nfs/pnfs.c
@@@ -1087,8 -1104,10 +1087,15 @@@ bool pnfs_roc(struct inode *ino
  			found = true;
  		}
  	if (!found)
++<<<<<<< HEAD
 +		goto out_nolayout;
 +	lo->plh_block_lgets++;
++=======
+ 		goto out_noroc;
+ 	if (test_and_set_bit(NFS_LAYOUT_RETURN, &lo->plh_flags))
+ 		goto out_noroc;
+ 	lo->plh_return_iomode = IOMODE_ANY;
++>>>>>>> 5c4a79fb2b1c (NFSv4.1/pnfs: Don't prevent layoutgets when doing return-on-close)
  	pnfs_get_layout_hdr(lo); /* matched in pnfs_roc_release */
  	spin_unlock(&ino->i_lock);
  	pnfs_free_lseg_list(&tmp_list);
* Unmerged path fs/nfs/pnfs.c
