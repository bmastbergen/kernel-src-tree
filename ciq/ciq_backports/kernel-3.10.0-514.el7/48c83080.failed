PCI: Move informational printk to pci_add_dma_alias()

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
Rebuild_CHGLOG: - [pci] Move informational printk to pci_add_dma_alias() (Jerry Snitselaar) [1299853]
Rebuild_FUZZ: 95.05%
commit-author Bjorn Helgaas <bhelgaas@google.com>
commit 48c830809ce6e143781172c03a9794cb66802b31
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/48c83080.failed

One of the quirks that adds DMA aliases logs an informational message in
dmesg.  Move that to pci_add_dma_alias() so all users log the message
consistently.  No functional change intended (except extra message).

	Signed-off-by: Bjorn Helgaas <bhelgaas@google.com>
	Reviewed-by: Alex Williamson <alex.williamson@redhat.com>
(cherry picked from commit 48c830809ce6e143781172c03a9794cb66802b31)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/pci/pci.c
#	drivers/pci/quirks.c
diff --cc drivers/pci/pci.c
index 1126474d9c49,c82ebd0f6982..000000000000
--- a/drivers/pci/pci.c
+++ b/drivers/pci/pci.c
@@@ -4268,6 -4578,22 +4268,25 @@@ int pci_set_vga_state(struct pci_dev *d
  	return 0;
  }
  
++<<<<<<< HEAD
++=======
+ /**
+  * pci_add_dma_alias - Add a DMA devfn alias for a device
+  * @dev: the PCI device for which alias is added
+  * @devfn: alias slot and function
+  *
+  * This helper encodes 8-bit devfn as bit number in dma_alias_mask.
+  * It should be called early, preferably as PCI fixup header quirk.
+  */
+ void pci_add_dma_alias(struct pci_dev *dev, u8 devfn)
+ {
+ 	dev->dma_alias_devfn = devfn;
+ 	dev->dev_flags |= PCI_DEV_FLAGS_DMA_ALIAS_DEVFN;
+ 	dev_info(&dev->dev, "Enabling fixed DMA alias to %02x.%d\n",
+ 		 PCI_SLOT(devfn), PCI_FUNC(devfn));
+ }
+ 
++>>>>>>> 48c830809ce6 (PCI: Move informational printk to pci_add_dma_alias())
  bool pci_device_is_present(struct pci_dev *pdev)
  {
  	u32 v;
diff --cc drivers/pci/quirks.c
index 3f0d54b18af9,7559e4024447..000000000000
--- a/drivers/pci/quirks.c
+++ b/drivers/pci/quirks.c
@@@ -3561,13 -3691,8 +3561,18 @@@ static void quirk_fixed_dma_alias(struc
  	const struct pci_device_id *id;
  
  	id = pci_match_id(fixed_dma_alias_tbl, dev);
++<<<<<<< HEAD
 +	if (id) {
 +		dev->pci_dev_rh->dma_alias_devfn = id->driver_data;
 +		dev->dev_flags |= PCI_DEV_FLAGS_DMA_ALIAS_DEVFN;
 +		dev_info(&dev->dev, "Enabling fixed DMA alias to %02x.%d\n",
 +			 PCI_SLOT(dev->pci_dev_rh->dma_alias_devfn),
 +			 PCI_FUNC(dev->pci_dev_rh->dma_alias_devfn));
 +	}
++=======
+ 	if (id)
+ 		pci_add_dma_alias(dev, id->driver_data);
++>>>>>>> 48c830809ce6 (PCI: Move informational printk to pci_add_dma_alias())
  }
  
  DECLARE_PCI_FIXUP_HEADER(PCI_VENDOR_ID_ADAPTEC2, 0x0285, quirk_fixed_dma_alias);
* Unmerged path drivers/pci/pci.c
* Unmerged path drivers/pci/quirks.c
