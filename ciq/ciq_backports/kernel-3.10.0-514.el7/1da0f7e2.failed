IB/qib: Delete QIB user context allocation and de-alloction functions

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
commit-author Harish Chegondi <harish.chegondi@intel.com>
commit 1da0f7e2041ec54657eea25ed84612819c7a2cba
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/1da0f7e2.failed

IB user context alloc and dealloc functions have been added to rdmavt.
Delete the QIB user context alloc/dealloc functions and use the ones in
rdmavt.

	Reviewed-by: Ira Weiny <ira.weiny@intel.com>
	Signed-off-by: Harish Chegondi <harish.chegondi@intel.com>
	Signed-off-by: Doug Ledford <dledford@redhat.com>
(cherry picked from commit 1da0f7e2041ec54657eea25ed84612819c7a2cba)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/infiniband/hw/qib/qib_verbs.c
diff --cc drivers/infiniband/hw/qib/qib_verbs.c
index c4417a1f33be,5d230c8def82..000000000000
--- a/drivers/infiniband/hw/qib/qib_verbs.c
+++ b/drivers/infiniband/hw/qib/qib_verbs.c
@@@ -1969,54 -1831,6 +1959,57 @@@ unsigned qib_get_pkey(struct qib_ibpor
  	return ret;
  }
  
++<<<<<<< HEAD
 +static int qib_query_pkey(struct ib_device *ibdev, u8 port, u16 index,
 +			  u16 *pkey)
 +{
 +	struct qib_devdata *dd = dd_from_ibdev(ibdev);
 +	int ret;
 +
 +	if (index >= qib_get_npkeys(dd)) {
 +		ret = -EINVAL;
 +		goto bail;
 +	}
 +
 +	*pkey = qib_get_pkey(to_iport(ibdev, port), index);
 +	ret = 0;
 +
 +bail:
 +	return ret;
 +}
 +
 +/**
 + * qib_alloc_ucontext - allocate a ucontest
 + * @ibdev: the infiniband device
 + * @udata: not used by the QLogic_IB driver
 + */
 +
 +static struct ib_ucontext *qib_alloc_ucontext(struct ib_device *ibdev,
 +					      struct ib_udata *udata)
 +{
 +	struct qib_ucontext *context;
 +	struct ib_ucontext *ret;
 +
 +	context = kmalloc(sizeof(*context), GFP_KERNEL);
 +	if (!context) {
 +		ret = ERR_PTR(-ENOMEM);
 +		goto bail;
 +	}
 +
 +	ret = &context->ibucontext;
 +
 +bail:
 +	return ret;
 +}
 +
 +static int qib_dealloc_ucontext(struct ib_ucontext *context)
 +{
 +	kfree(to_iucontext(context));
 +	return 0;
 +}
 +
++=======
++>>>>>>> 1da0f7e2041e (IB/qib: Delete QIB user context allocation and de-alloction functions)
  static void init_ibport(struct qib_pportdata *ppd)
  {
  	struct qib_verbs_counters cntrs;
@@@ -2230,16 -2020,16 +2223,27 @@@ int qib_register_ib_device(struct qib_d
  	ibdev->modify_device = qib_modify_device;
  	ibdev->query_port = qib_query_port;
  	ibdev->modify_port = qib_modify_port;
 -	ibdev->query_pkey = NULL;
 +	ibdev->query_pkey = qib_query_pkey;
  	ibdev->query_gid = qib_query_gid;
++<<<<<<< HEAD
 +	ibdev->alloc_ucontext = qib_alloc_ucontext;
 +	ibdev->dealloc_ucontext = qib_dealloc_ucontext;
 +	ibdev->alloc_pd = qib_alloc_pd;
 +	ibdev->dealloc_pd = qib_dealloc_pd;
 +	ibdev->create_ah = qib_create_ah;
 +	ibdev->destroy_ah = qib_destroy_ah;
 +	ibdev->modify_ah = qib_modify_ah;
 +	ibdev->query_ah = qib_query_ah;
++=======
+ 	ibdev->alloc_ucontext = NULL;
+ 	ibdev->dealloc_ucontext = NULL;
+ 	ibdev->alloc_pd = NULL;
+ 	ibdev->dealloc_pd = NULL;
+ 	ibdev->create_ah = NULL;
+ 	ibdev->destroy_ah = NULL;
+ 	ibdev->modify_ah = NULL;
+ 	ibdev->query_ah = NULL;
++>>>>>>> 1da0f7e2041e (IB/qib: Delete QIB user context allocation and de-alloction functions)
  	ibdev->create_srq = qib_create_srq;
  	ibdev->modify_srq = qib_modify_srq;
  	ibdev->query_srq = qib_query_srq;
* Unmerged path drivers/infiniband/hw/qib/qib_verbs.c
