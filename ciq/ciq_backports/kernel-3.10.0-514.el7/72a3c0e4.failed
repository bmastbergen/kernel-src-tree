tty: Add support for the WCH384 4S multi-IO card

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
Rebuild_CHGLOG: - [tty] Add support for the WCH384 4S multi-IO card (Jeremy McNicoll) [1309575]
Rebuild_FUZZ: 94.51%
commit-author Sergej Pupykin <ml@sergej.pp.ru>
commit 72a3c0e4e6624a77ee6eee0903f209185fe20647
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/72a3c0e4.failed

WCH384 4S board is a PCI-E card with 4 DB9 COM ports detected as
Serial controller: Device 1c00:3470 (rev 10) (prog-if 05 [16850])

	Signed-off-by: Sergej Pupykin <ml@sergej.pp.ru>
	Acked-by: Zany Yan <sirlight@cox.net>
	Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
(cherry picked from commit 72a3c0e4e6624a77ee6eee0903f209185fe20647)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/tty/serial/8250/8250_pci.c
diff --cc drivers/tty/serial/8250/8250_pci.c
index c52948b368d8,d1f8dc6aabcb..000000000000
--- a/drivers/tty/serial/8250/8250_pci.c
+++ b/drivers/tty/serial/8250/8250_pci.c
@@@ -1521,6 -1814,16 +1521,19 @@@ pci_wch_ch353_setup(struct serial_priva
  	return pci_default_setup(priv, board, port, idx);
  }
  
++<<<<<<< HEAD
++=======
+ static int
+ pci_wch_ch38x_setup(struct serial_private *priv,
+                     const struct pciserial_board *board,
+                     struct uart_8250_port *port, int idx)
+ {
+ 	port->port.flags |= UPF_FIXED_TYPE;
+ 	port->port.type = PORT_16850;
+ 	return pci_default_setup(priv, board, port, idx);
+ }
+ 
++>>>>>>> 72a3c0e4e662 (tty: Add support for the WCH384 4S multi-IO card)
  #define PCI_VENDOR_ID_SBSMODULARIO	0x124B
  #define PCI_SUBVENDOR_ID_SBSMODULARIO	0x124B
  #define PCI_DEVICE_ID_OCTPRO		0x0001
@@@ -1569,6 -1878,9 +1582,12 @@@
  #define PCI_VENDOR_ID_SUNIX		0x1fd4
  #define PCI_DEVICE_ID_SUNIX_1999	0x1999
  
++<<<<<<< HEAD
++=======
+ #define PCIE_VENDOR_ID_WCH		0x1c00
+ #define PCIE_DEVICE_ID_WCH_CH382_2S1P	0x3250
+ #define PCIE_DEVICE_ID_WCH_CH384_4S	0x3470
++>>>>>>> 72a3c0e4e662 (tty: Add support for the WCH384 4S multi-IO card)
  
  /* Unknown vendors/cards - this should not be in linux/pci_ids.h */
  #define PCI_SUBDEVICE_ID_UNKNOWN_0x1584	0x1584
@@@ -2181,6 -2572,22 +2200,25 @@@ static struct pci_serial_quirk pci_seri
  		.subdevice	= PCI_ANY_ID,
  		.setup		= pci_wch_ch353_setup,
  	},
++<<<<<<< HEAD
++=======
+ 	/* WCH CH382 2S1P card (16850 clone) */
+ 	{
+ 		.vendor         = PCIE_VENDOR_ID_WCH,
+ 		.device         = PCIE_DEVICE_ID_WCH_CH382_2S1P,
+ 		.subvendor      = PCI_ANY_ID,
+ 		.subdevice      = PCI_ANY_ID,
+ 		.setup          = pci_wch_ch38x_setup,
+ 	},
+ 	/* WCH CH384 4S card (16850 clone) */
+ 	{
+ 		.vendor         = PCIE_VENDOR_ID_WCH,
+ 		.device         = PCIE_DEVICE_ID_WCH_CH384_4S,
+ 		.subvendor      = PCI_ANY_ID,
+ 		.subdevice      = PCI_ANY_ID,
+ 		.setup          = pci_wch_ch38x_setup,
+ 	},
++>>>>>>> 72a3c0e4e662 (tty: Add support for the WCH384 4S multi-IO card)
  	/*
  	 * ASIX devices with FIFO bug
  	 */
@@@ -2451,6 -2880,12 +2489,13 @@@ enum pci_board_num_t 
  	pbn_omegapci,
  	pbn_NETMOS9900_2s_115200,
  	pbn_brcm_trumanage,
++<<<<<<< HEAD
++=======
+ 	pbn_fintek_4,
+ 	pbn_fintek_8,
+ 	pbn_fintek_12,
+ 	pbn_wch384_4,
++>>>>>>> 72a3c0e4e662 (tty: Add support for the WCH384 4S multi-IO card)
  };
  
  /*
@@@ -3201,6 -3667,32 +3246,35 @@@ static struct pciserial_board pci_board
  		.reg_shift	= 2,
  		.base_baud	= 115200,
  	},
++<<<<<<< HEAD
++=======
+ 	[pbn_fintek_4] = {
+ 		.num_ports	= 4,
+ 		.uart_offset	= 8,
+ 		.base_baud	= 115200,
+ 		.first_offset	= 0x40,
+ 	},
+ 	[pbn_fintek_8] = {
+ 		.num_ports	= 8,
+ 		.uart_offset	= 8,
+ 		.base_baud	= 115200,
+ 		.first_offset	= 0x40,
+ 	},
+ 	[pbn_fintek_12] = {
+ 		.num_ports	= 12,
+ 		.uart_offset	= 8,
+ 		.base_baud	= 115200,
+ 		.first_offset	= 0x40,
+ 	},
+ 
+ 	[pbn_wch384_4] = {
+ 		.flags		= FL_BASE0,
+ 		.num_ports	= 4,
+ 		.base_baud      = 115200,
+ 		.uart_offset    = 8,
+ 		.first_offset   = 0xC0,
+ 	},
++>>>>>>> 72a3c0e4e662 (tty: Add support for the WCH384 4S multi-IO card)
  };
  
  static const struct pci_device_id blacklist[] = {
@@@ -3211,6 -3703,9 +3285,12 @@@
  
  	/* multi-io cards handled by parport_serial */
  	{ PCI_DEVICE(0x4348, 0x7053), }, /* WCH CH353 2S1P */
++<<<<<<< HEAD
++=======
+ 	{ PCI_DEVICE(0x4348, 0x5053), }, /* WCH CH353 1S1P */
+ 	{ PCI_DEVICE(0x1c00, 0x3250), }, /* WCH CH382 2S1P */
+ 	{ PCI_DEVICE(0x1c00, 0x3470), }, /* WCH CH384 4S */
++>>>>>>> 72a3c0e4e662 (tty: Add support for the WCH384 4S multi-IO card)
  };
  
  /*
* Unmerged path drivers/tty/serial/8250/8250_pci.c
