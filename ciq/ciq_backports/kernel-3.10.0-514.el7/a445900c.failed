i2c: designware: Add support for AMD I2C controller

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
commit-author Carl Peng <carlpeng008@gmail.com>
commit a445900c906092f3b49ee40a7365d0d54acc568e
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/a445900c.failed

Add support for AMD version of the DW I2C host controller. The device is
enumerated from ACPI namespace with ACPI ID AMD0010. Because the core
driver needs an input source clock, and this is not an Intel LPSS device
where clocks are provided through drivers/acpi/acpi_lpss.c, we register the
clock ourselves if the clock rate is given in ->driver_data

	Signed-off-by: Carl Peng <carlpeng008@gmail.com>
	Signed-off-by: Mika Westerberg <mika.westerberg@linux.intel.com>
	Signed-off-by: Wolfram Sang <wsa@the-dreams.de>
(cherry picked from commit a445900c906092f3b49ee40a7365d0d54acc568e)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/i2c/busses/i2c-designware-platdrv.c
diff --cc drivers/i2c/busses/i2c-designware-platdrv.c
index c6618c95b98c,a7431150acf7..000000000000
--- a/drivers/i2c/busses/i2c-designware-platdrv.c
+++ b/drivers/i2c/busses/i2c-designware-platdrv.c
@@@ -78,10 -81,8 +79,11 @@@ static void dw_i2c_acpi_params(struct p
  static int dw_i2c_acpi_configure(struct platform_device *pdev)
  {
  	struct dw_i2c_dev *dev = platform_get_drvdata(pdev);
+ 	const struct acpi_device_id *id;
  
 +	if (!ACPI_HANDLE(&pdev->dev))
 +		return -ENODEV;
 +
  	dev->adapter.nr = -1;
  	dev->tx_fifo_depth = 32;
  	dev->rx_fifo_depth = 32;
@@@ -103,6 -124,8 +125,11 @@@ static const struct acpi_device_id dw_i
  	{ "INT3432", 0 },
  	{ "INT3433", 0 },
  	{ "80860F41", 0 },
++<<<<<<< HEAD
++=======
+ 	{ "808622C1", 0 },
+ 	{ "AMD0010", 133 * 1000 * 1000 },
++>>>>>>> a445900c9060 (i2c: designware: Add support for AMD I2C controller)
  	{ }
  };
  MODULE_DEVICE_TABLE(acpi, dw_i2c_acpi_match);
diff --git a/drivers/i2c/busses/Kconfig b/drivers/i2c/busses/Kconfig
index 8f402a25c932..8a79a1ea3903 100644
--- a/drivers/i2c/busses/Kconfig
+++ b/drivers/i2c/busses/Kconfig
@@ -405,6 +405,7 @@ config I2C_DESIGNWARE_CORE
 config I2C_DESIGNWARE_PLATFORM
 	tristate "Synopsys DesignWare Platform"
 	select I2C_DESIGNWARE_CORE
+	depends on (ACPI && COMMON_CLK) || !ACPI
 	help
 	  If you say yes to this option, support will be included for the
 	  Synopsys DesignWare I2C adapter. Only master mode is supported.
* Unmerged path drivers/i2c/busses/i2c-designware-platdrv.c
