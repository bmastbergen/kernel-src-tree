r8152: use test_and_clear_bit

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
commit-author hayeswang <hayeswang@realtek.com>
commit 216a8349d3a0dd1bc2afbcc821e374c8f929bd62
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/216a8349.failed

Replace test_bit() followed by clear_bit() with test_and_clear_bit().

	Signed-off-by: Hayes Wang <hayeswang@realtek.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 216a8349d3a0dd1bc2afbcc821e374c8f929bd62)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/usb/r8152.c
diff --cc drivers/net/usb/r8152.c
index caccdf613161,4f0bb67a7590..000000000000
--- a/drivers/net/usb/r8152.c
+++ b/drivers/net/usb/r8152.c
@@@ -2844,24 -3015,27 +2838,31 @@@ static void rtl_work_func_t(struct work
  	if (!test_bit(WORK_ENABLE, &tp->flags))
  		goto out1;
  
 -	if (!mutex_trylock(&tp->control)) {
 -		schedule_delayed_work(&tp->schedule, 0);
 +	if (test_bit(RTL8152_UNPLUG, &tp->flags))
  		goto out1;
 -	}
  
- 	if (test_bit(RTL8152_LINK_CHG, &tp->flags))
+ 	if (test_and_clear_bit(RTL8152_LINK_CHG, &tp->flags))
  		set_carrier(tp);
  
- 	if (test_bit(RTL8152_SET_RX_MODE, &tp->flags))
+ 	if (test_and_clear_bit(RTL8152_SET_RX_MODE, &tp->flags))
  		_rtl8152_set_rx_mode(tp->netdev);
  
++<<<<<<< HEAD
 +	if (test_bit(SCHEDULE_TASKLET, &tp->flags) &&
 +	    (tp->speed & LINK_STATUS)) {
 +		clear_bit(SCHEDULE_TASKLET, &tp->flags);
 +		tasklet_schedule(&tp->tl);
 +	}
- 
- 	if (test_bit(PHY_RESET, &tp->flags))
++=======
+ 	/* don't schedule napi before linking */
+ 	if (test_and_clear_bit(SCHEDULE_NAPI, &tp->flags) &&
+ 	    netif_carrier_ok(tp->netdev))
+ 		napi_schedule(&tp->napi);
++>>>>>>> 216a8349d3a0 (r8152: use test_and_clear_bit)
+ 
+ 	if (test_and_clear_bit(PHY_RESET, &tp->flags))
  		rtl_phy_reset(tp);
  
 -	mutex_unlock(&tp->control);
 -
  out1:
  	usb_autopm_put_interface(tp->intf);
  }
* Unmerged path drivers/net/usb/r8152.c
