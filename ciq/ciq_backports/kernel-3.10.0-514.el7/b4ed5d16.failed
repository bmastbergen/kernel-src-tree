tools: hv: report ENOSPC errors in hv_fcopy_daemon

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
commit-author Olaf Hering <olaf@aepfle.de>
commit b4ed5d1682c6613988c2eb1de55df5ac9988afcc
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/b4ed5d16.failed

Currently some "Unspecified error 0x80004005" is reported on the Windows
side if something fails. Handle the ENOSPC case and return
ERROR_DISK_FULL, which allows at least Copy-VMFile to report a meaning
full error.

	Signed-off-by: Olaf Hering <olaf@aepfle.de>
	Signed-off-by: K. Y. Srinivasan <kys@microsoft.com>
	Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
(cherry picked from commit b4ed5d1682c6613988c2eb1de55df5ac9988afcc)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	tools/hv/hv_fcopy_daemon.c
diff --cc tools/hv/hv_fcopy_daemon.c
index fba1c75aa484,f1d742682317..000000000000
--- a/tools/hv/hv_fcopy_daemon.c
+++ b/tools/hv/hv_fcopy_daemon.c
@@@ -42,15 -44,10 +43,19 @@@ static int hv_start_fcopy(struct hv_sta
  	int error = HV_E_FAIL;
  	char *q, *p;
  
++<<<<<<< HEAD
 +	/*
 +	 * If possile append a path seperator to the path.
 +	 */
 +	if (strlen((char *)smsg->path_name) < (W_MAX_PATH - 2))
 +		strcat((char *)smsg->path_name, "/");
 +
++=======
+ 	filesize = 0;
++>>>>>>> b4ed5d1682c6 (tools: hv: report ENOSPC errors in hv_fcopy_daemon)
  	p = (char *)smsg->path_name;
  	snprintf(target_fname, sizeof(target_fname), "%s/%s",
 -		 (char *)smsg->path_name, (char *)smsg->file_name);
 +		(char *)smsg->path_name, smsg->file_name);
  
  	syslog(LOG_INFO, "Target file name: %s", target_fname);
  	/*
diff --git a/include/uapi/linux/hyperv.h b/include/uapi/linux/hyperv.h
index 78e4a86030dd..31b7960314f6 100644
--- a/include/uapi/linux/hyperv.h
+++ b/include/uapi/linux/hyperv.h
@@ -306,6 +306,7 @@ enum hv_kvp_exchg_pool {
 #define HV_INVALIDARG			0x80070057
 #define HV_GUID_NOTFOUND		0x80041002
 #define HV_ERROR_ALREADY_EXISTS		0x80070050
+#define HV_ERROR_DISK_FULL		0x80070070
 
 #define ADDR_FAMILY_NONE	0x00
 #define ADDR_FAMILY_IPV4	0x01
* Unmerged path tools/hv/hv_fcopy_daemon.c
