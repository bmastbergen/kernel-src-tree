mmc: sdhci-pci: enable the clear transfer mode register quirk for AMD sdhci

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
Rebuild_CHGLOG: - [mmc] sdhci-pci: enable the clear transfer mode register quirk for AMD sdhci (Don Zickus) [1127975 1277866 1280133 1286932 1297039]
Rebuild_FUZZ: 96.55%
commit-author Vincent Wan <vincent.wan@amd.com>
commit d44f88da42d2a75eeac02f87455043f44e10d7cc
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/d44f88da.failed

This patch is to enable the quirk for AMD sdhci requiring transfer
mode register need to be cleared for commands without data

	Signed-off-by: Vincent Wan <vincent.wan@amd.com>
	Signed-off-by: Wan Zongshun <mcuos.com@gmail.com>
	Signed-off-by: Ulf Hansson <ulf.hansson@linaro.org>
(cherry picked from commit d44f88da42d2a75eeac02f87455043f44e10d7cc)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/mmc/host/sdhci-pci.c
diff --cc drivers/mmc/host/sdhci-pci.c
index a627aad5414a,5a77f188b503..000000000000
--- a/drivers/mmc/host/sdhci-pci.c
+++ b/drivers/mmc/host/sdhci-pci.c
@@@ -581,6 -633,35 +581,38 @@@ static const struct sdhci_pci_fixes sdh
  	.probe		= via_probe,
  };
  
++<<<<<<< HEAD
++=======
+ static int rtsx_probe_slot(struct sdhci_pci_slot *slot)
+ {
+ 	slot->host->mmc->caps2 |= MMC_CAP2_HS200;
+ 	return 0;
+ }
+ 
+ static const struct sdhci_pci_fixes sdhci_rtsx = {
+ 	.quirks2	= SDHCI_QUIRK2_PRESET_VALUE_BROKEN |
+ 			SDHCI_QUIRK2_BROKEN_DDR50,
+ 	.probe_slot	= rtsx_probe_slot,
+ };
+ 
+ static int amd_probe(struct sdhci_pci_chip *chip)
+ {
+ 	struct pci_dev	*smbus_dev;
+ 
+ 	smbus_dev = pci_get_device(PCI_VENDOR_ID_AMD,
+ 			PCI_DEVICE_ID_AMD_HUDSON2_SMBUS, NULL);
+ 
+ 	if (smbus_dev && (smbus_dev->revision < 0x51))
+ 		chip->quirks2 |= SDHCI_QUIRK2_CLEAR_TRANSFERMODE_REG_BEFORE_CMD;
+ 
+ 	return 0;
+ }
+ 
+ static const struct sdhci_pci_fixes sdhci_amd = {
+ 	.probe		= amd_probe,
+ };
+ 
++>>>>>>> d44f88da42d2 (mmc: sdhci-pci: enable the clear transfer mode register quirk for AMD sdhci)
  static const struct pci_device_id pci_ids[] = {
  	{
  		.vendor		= PCI_VENDOR_ID_RICOH,
* Unmerged path drivers/mmc/host/sdhci-pci.c
