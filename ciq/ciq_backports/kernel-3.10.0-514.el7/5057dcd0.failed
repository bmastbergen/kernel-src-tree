virtio_balloon: export 'available' memory to balloon statistics

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
commit-author Igor Redko <redkoi@virtuozzo.com>
commit 5057dcd0f1aaad57e07e728ba20a99e205c6b9de
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/5057dcd0.failed

Add a new field, VIRTIO_BALLOON_S_AVAIL, to virtio_balloon memory
statistics protocol, corresponding to 'Available' in /proc/meminfo.

It indicates to the hypervisor how big the balloon can be inflated
without pushing the guest system to swap.

	Signed-off-by: Igor Redko <redkoi@virtuozzo.com>
	Signed-off-by: Denis V. Lunev <den@openvz.org>
	Reviewed-by: Roman Kagan <rkagan@virtuozzo.com>
	Cc: Michael S. Tsirkin <mst@redhat.com>
	Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
	Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
(cherry picked from commit 5057dcd0f1aaad57e07e728ba20a99e205c6b9de)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/virtio/virtio_balloon.c
diff --cc drivers/virtio/virtio_balloon.c
index 5e461066deb2,f2b77dea8d3c..000000000000
--- a/drivers/virtio/virtio_balloon.c
+++ b/drivers/virtio/virtio_balloon.c
@@@ -29,6 -29,8 +29,11 @@@
  #include <linux/module.h>
  #include <linux/balloon_compaction.h>
  #include <linux/oom.h>
++<<<<<<< HEAD
++=======
+ #include <linux/wait.h>
+ #include <linux/mm.h>
++>>>>>>> 5057dcd0f1aa (virtio_balloon: export 'available' memory to balloon statistics)
  
  /*
   * Balloon device works in 4K page units.  So each page is pointed to by
* Unmerged path drivers/virtio/virtio_balloon.c
diff --git a/include/uapi/linux/virtio_balloon.h b/include/uapi/linux/virtio_balloon.h
index 984169a819ee..f81cbdb0328e 100644
--- a/include/uapi/linux/virtio_balloon.h
+++ b/include/uapi/linux/virtio_balloon.h
@@ -50,7 +50,8 @@ struct virtio_balloon_config {
 #define VIRTIO_BALLOON_S_MINFLT   3   /* Number of minor faults */
 #define VIRTIO_BALLOON_S_MEMFREE  4   /* Total amount of free memory */
 #define VIRTIO_BALLOON_S_MEMTOT   5   /* Total amount of memory */
-#define VIRTIO_BALLOON_S_NR       6
+#define VIRTIO_BALLOON_S_AVAIL    6   /* Available memory as in /proc */
+#define VIRTIO_BALLOON_S_NR       7
 
 /*
  * Memory statistics structure.
