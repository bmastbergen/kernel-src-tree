mei: hbm: add new error code MEI_CL_CONN_NOT_ALLOWED

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
commit-author Alexander Usyskin <alexander.usyskin@intel.com>
commit 71e117f28a6782fa2d31cce63340a9f18417afa4
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/71e117f2.failed

The device can return error 5 (NOT_ALLOWED) on connection attempt.
This error can happen if:
1. An another connection attempt is in progress
2. There is an attempt to connect a fixed (connectionless) client
3. The number of available connections is exceeded (new in HBM 2.0)

We should not hit that error unless there is an internal book keeping
hiccup except option (3), therefore we translate the error code
to errno EBUSY;

	Signed-off-by: Alexander Usyskin <alexander.usyskin@intel.com>
	Signed-off-by: Tomas Winkler <tomas.winkler@intel.com>
	Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
(cherry picked from commit 71e117f28a6782fa2d31cce63340a9f18417afa4)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/misc/mei/hw.h
diff --cc drivers/misc/mei/hw.h
index 50526f92f092,c262d0bd5bd5..000000000000
--- a/drivers/misc/mei/hw.h
+++ b/drivers/misc/mei/hw.h
@@@ -102,11 -156,12 +102,20 @@@ enum mei_stop_reason_types 
   * used by hbm_client_connect_response.status
   */
  enum mei_cl_connect_status {
++<<<<<<< HEAD
 +	MEI_CL_CONN_SUCCESS          = 0x00,
 +	MEI_CL_CONN_NOT_FOUND        = 0x01,
 +	MEI_CL_CONN_ALREADY_STARTED  = 0x02,
 +	MEI_CL_CONN_OUT_OF_RESOURCES = 0x03,
 +	MEI_CL_CONN_MESSAGE_SMALL    = 0x04
++=======
+ 	MEI_CL_CONN_SUCCESS          = MEI_HBMS_SUCCESS,
+ 	MEI_CL_CONN_NOT_FOUND        = MEI_HBMS_CLIENT_NOT_FOUND,
+ 	MEI_CL_CONN_ALREADY_STARTED  = MEI_HBMS_ALREADY_EXISTS,
+ 	MEI_CL_CONN_OUT_OF_RESOURCES = MEI_HBMS_REJECTED,
+ 	MEI_CL_CONN_MESSAGE_SMALL    = MEI_HBMS_INVALID_PARAMETER,
+ 	MEI_CL_CONN_NOT_ALLOWED      = MEI_HBMS_NOT_ALLOWED,
++>>>>>>> 71e117f28a67 (mei: hbm: add new error code MEI_CL_CONN_NOT_ALLOWED)
  };
  
  /*
diff --git a/drivers/misc/mei/hbm.c b/drivers/misc/mei/hbm.c
index 3cb8e1000d69..64befed4f221 100644
--- a/drivers/misc/mei/hbm.c
+++ b/drivers/misc/mei/hbm.c
@@ -33,6 +33,7 @@ static const char *mei_cl_conn_status_str(enum mei_cl_connect_status status)
 	MEI_CL_CS(ALREADY_STARTED);
 	MEI_CL_CS(OUT_OF_RESOURCES);
 	MEI_CL_CS(MESSAGE_SMALL);
+	MEI_CL_CS(NOT_ALLOWED);
 	default: return "unknown";
 	}
 #undef MEI_CL_CCS
@@ -70,6 +71,7 @@ static int mei_cl_conn_status_to_errno(enum mei_cl_connect_status status)
 	case MEI_CL_CONN_ALREADY_STARTED:  return -EBUSY;
 	case MEI_CL_CONN_OUT_OF_RESOURCES: return -EBUSY;
 	case MEI_CL_CONN_MESSAGE_SMALL:    return -EINVAL;
+	case MEI_CL_CONN_NOT_ALLOWED:      return -EBUSY;
 	default:                           return -EINVAL;
 	}
 }
* Unmerged path drivers/misc/mei/hw.h
