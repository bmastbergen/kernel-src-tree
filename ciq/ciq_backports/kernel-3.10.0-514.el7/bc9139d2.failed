drm/nouveau/bios/disp: fix handling of "match any protocol" entries

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
Rebuild_CHGLOG: - [drm] nouveau/bios/disp: fix handling of "match any protocol" entries (Rob Clark) [1348329 1349064]
Rebuild_FUZZ: 96.92%
commit-author Ben Skeggs <bskeggs@redhat.com>
commit bc9139d23f6b038e32bcd2dffdee70a8d76b3976
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/bc9139d2.failed

As it turns out, a value of 0xff means "any protocol" and not "VGA".

	Signed-off-by: Ben Skeggs <bskeggs@redhat.com>
	Cc: stable@vger.kernel.org
(cherry picked from commit bc9139d23f6b038e32bcd2dffdee70a8d76b3976)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/gpu/drm/nouveau/nvkm/engine/disp/gf119.c
#	drivers/gpu/drm/nouveau/nvkm/engine/disp/nv50.c
#	drivers/gpu/drm/nouveau/nvkm/subdev/bios/disp.c
diff --cc drivers/gpu/drm/nouveau/nvkm/engine/disp/nv50.c
index 8ba808df24ad,fcb1b0c46d64..000000000000
--- a/drivers/gpu/drm/nouveau/nvkm/engine/disp/nv50.c
+++ b/drivers/gpu/drm/nouveau/nvkm/engine/disp/nv50.c
@@@ -1543,19 -391,13 +1544,22 @@@ exec_clkcmp(struct nv50_disp_priv *priv
  	if (outp->info.location == 0) {
  		switch (outp->info.type) {
  		case DCB_OUTPUT_TMDS:
++<<<<<<< HEAD
 +			*conf = (ctrl & 0x00000f00) >> 8;
 +			if (pclk >= 165000)
 +				*conf |= 0x0100;
 +			break;
 +		case DCB_OUTPUT_LVDS:
 +			*conf = priv->sor.lvdsconf;
++=======
+ 			if (*conf == 5)
+ 				*conf |= 0x0100;
  			break;
- 		case DCB_OUTPUT_DP:
- 			*conf = (ctrl & 0x00000f00) >> 8;
+ 		case DCB_OUTPUT_LVDS:
+ 			*conf |= disp->sor.lvdsconf;
++>>>>>>> bc9139d23f6b (drm/nouveau/bios/disp: fix handling of "match any protocol" entries)
  			break;
- 		case DCB_OUTPUT_ANALOG:
  		default:
- 			*conf = 0x00ff;
  			break;
  		}
  	} else {
diff --cc drivers/gpu/drm/nouveau/nvkm/subdev/bios/disp.c
index 262c410b7ee2,9efb1b48cd54..000000000000
--- a/drivers/gpu/drm/nouveau/nvkm/subdev/bios/disp.c
+++ b/drivers/gpu/drm/nouveau/nvkm/subdev/bios/disp.c
@@@ -141,9 -141,10 +141,16 @@@ nvbios_ocfg_parse(struct nvkm_bios *bio
  {
  	u16 data = nvbios_ocfg_entry(bios, outp, idx, ver, hdr, cnt, len);
  	if (data) {
++<<<<<<< HEAD
 +		info->match     = nv_ro16(bios, data + 0x00);
 +		info->clkcmp[0] = nv_ro16(bios, data + 0x02);
 +		info->clkcmp[1] = nv_ro16(bios, data + 0x04);
++=======
+ 		info->proto     = nvbios_rd08(bios, data + 0x00);
+ 		info->flags     = nvbios_rd16(bios, data + 0x01);
+ 		info->clkcmp[0] = nvbios_rd16(bios, data + 0x02);
+ 		info->clkcmp[1] = nvbios_rd16(bios, data + 0x04);
++>>>>>>> bc9139d23f6b (drm/nouveau/bios/disp: fix handling of "match any protocol" entries)
  	}
  	return data;
  }
* Unmerged path drivers/gpu/drm/nouveau/nvkm/engine/disp/gf119.c
diff --git a/drivers/gpu/drm/nouveau/include/nvkm/subdev/bios/disp.h b/drivers/gpu/drm/nouveau/include/nvkm/subdev/bios/disp.h
index db10c11f0595..c5a6ebd5a478 100644
--- a/drivers/gpu/drm/nouveau/include/nvkm/subdev/bios/disp.h
+++ b/drivers/gpu/drm/nouveau/include/nvkm/subdev/bios/disp.h
@@ -25,7 +25,8 @@ u16 nvbios_outp_match(struct nvkm_bios *, u16 type, u16 mask,
 		      u8 *ver, u8 *hdr, u8 *cnt, u8 *len, struct nvbios_outp *);
 
 struct nvbios_ocfg {
-	u16 match;
+	u8  proto;
+	u8  flags;
 	u16 clkcmp[2];
 };
 
@@ -33,7 +34,7 @@ u16 nvbios_ocfg_entry(struct nvkm_bios *, u16 outp, u8 idx,
 		      u8 *ver, u8 *hdr, u8 *cnt, u8 *len);
 u16 nvbios_ocfg_parse(struct nvkm_bios *, u16 outp, u8 idx,
 		      u8 *ver, u8 *hdr, u8 *cnt, u8 *len, struct nvbios_ocfg *);
-u16 nvbios_ocfg_match(struct nvkm_bios *, u16 outp, u16 type,
+u16 nvbios_ocfg_match(struct nvkm_bios *, u16 outp, u8 proto, u8 flags,
 		      u8 *ver, u8 *hdr, u8 *cnt, u8 *len, struct nvbios_ocfg *);
 u16 nvbios_oclk_match(struct nvkm_bios *, u16 cmp, u32 khz);
 #endif
* Unmerged path drivers/gpu/drm/nouveau/nvkm/engine/disp/gf119.c
* Unmerged path drivers/gpu/drm/nouveau/nvkm/engine/disp/nv50.c
* Unmerged path drivers/gpu/drm/nouveau/nvkm/subdev/bios/disp.c
