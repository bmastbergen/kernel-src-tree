i40e: move sync_vsi_filters up in service_task

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
commit-author Jesse Brandeburg <jesse.brandeburg@intel.com>
commit 2818ccd95684d39cc3bdad579e02ae56c0d6de88
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/2818ccd9.failed

The sync_vsi_filters function is moved up in the service_task because
it may need to request a reset, and we don't want to wait another round
of service task time.

NOTE: Filters will be replayed by sync_vsi_filters including broadcast
and promiscuous settings.

Also, added some error handling in this space in case any of these
fail the driver will retry correctly.

Also update copyright year.

Change-ID: I23f3d552100baecea69466339f738f27614efd47
	Signed-off-by: Jesse Brandeburg <jesse.brandeburg@intel.com>
	Tested-by: Andrew Bowers <andrewx.bowers@intel.com>
	Signed-off-by: Jeff Kirsher <jeffrey.t.kirsher@intel.com>
(cherry picked from commit 2818ccd95684d39cc3bdad579e02ae56c0d6de88)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/intel/i40e/i40e_main.c
diff --cc drivers/net/ethernet/intel/i40e/i40e_main.c
index 94c3277e2ada,e974db32975b..000000000000
--- a/drivers/net/ethernet/intel/i40e/i40e_main.c
+++ b/drivers/net/ethernet/intel/i40e/i40e_main.c
@@@ -2177,24 -2145,35 +2177,31 @@@ int i40e_sync_vsi_filters(struct i40e_v
  							  &vsi->back->hw,
  							  vsi->seid,
  							  cur_promisc, NULL);
 -			if (aq_ret) {
 -				retval =
 -				i40e_aq_rc_to_posix(aq_ret,
 -						    pf->hw.aq.asq_last_status);
 +			if (ret)
  				dev_info(&pf->pdev->dev,
  					 "set multicast promisc failed, err %d, aq_err %d\n",
 -					 aq_ret, pf->hw.aq.asq_last_status);
 -			}
 +					 ret, pf->hw.aq.asq_last_status);
  		}
 -		aq_ret = i40e_aq_set_vsi_broadcast(&vsi->back->hw,
 -						   vsi->seid,
 -						   cur_promisc, NULL);
 -		if (aq_ret) {
 -			retval = i40e_aq_rc_to_posix(aq_ret,
 -						     pf->hw.aq.asq_last_status);
 +		ret = i40e_aq_set_vsi_broadcast(&vsi->back->hw,
 +						vsi->seid,
 +						cur_promisc, NULL);
 +		if (ret)
  			dev_info(&pf->pdev->dev,
  				 "set brdcast promisc failed, err %s, aq_err %s\n",
 -				 i40e_stat_str(&pf->hw, aq_ret),
 +				 i40e_stat_str(&pf->hw, ret),
  				 i40e_aq_str(&pf->hw,
  					     pf->hw.aq.asq_last_status));
 -		}
  	}
++<<<<<<< HEAD
++=======
+ out:
+ 	/* if something went wrong then set the changed flag so we try again */
+ 	if (retval)
+ 		vsi->flags |= I40E_VSI_FLAG_FILTER_CHANGED;
++>>>>>>> 2818ccd95684 (i40e: move sync_vsi_filters up in service_task)
  
  	clear_bit(__I40E_CONFIG_BUSY, &vsi->state);
 -	return retval;
 +	return 0;
  }
  
  /**
* Unmerged path drivers/net/ethernet/intel/i40e/i40e_main.c
