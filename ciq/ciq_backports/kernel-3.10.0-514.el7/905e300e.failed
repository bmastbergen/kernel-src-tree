USB: host: st: fix ehci/ohci driver selection

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
Rebuild_CHGLOG: - [usb] host: st: fix ehci/ohci driver selection (Don Zickus) [1303209]
Rebuild_FUZZ: 94.12%
commit-author Arnd Bergmann <arnd@arndb.de>
commit 905e300e1043f5ff513840d342df5c985b3dc08c
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/905e300e.failed

The newly added sti ehci and ohci drivers come with a single
Kconfig entry that does not depend on either of the base drivers,
which leads to a link error when they are disabled:

drivers/built-in.o: In function `ohci_platform_init':
:(.init.text+0x14788): undefined reference to `ohci_init_driver'

To fix that, this patch introduces two separate Kconfig options
with proper dependencies, which avoids the problem and is also
more consistent with the other glue drivers.

	Signed-off-by: Arnd Bergmann <arnd@arndb.de>
Fixes: d115837259ada ("usb: host: ohci-st: Add OHCI driver support for ST STB devices")
	Cc: Peter Griffin <peter.griffin@linaro.org>
	Acked-by: Alan Stern <stern@rowland.harvard.edu>
	Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
(cherry picked from commit 905e300e1043f5ff513840d342df5c985b3dc08c)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/usb/host/Kconfig
#	drivers/usb/host/Makefile
diff --cc drivers/usb/host/Kconfig
index 50a55ea2b8cc,002ba1d5bcf5..000000000000
--- a/drivers/usb/host/Kconfig
+++ b/drivers/usb/host/Kconfig
@@@ -390,8 -403,58 +399,61 @@@ config USB_OHCI_HCD_OMAP
  	---help---
  	  Enables support for the OHCI controller on OMAP1/2 chips.
  
++<<<<<<< HEAD
++=======
+ config USB_OHCI_HCD_SPEAR
+         tristate "Support for ST SPEAr on-chip OHCI USB controller"
+         depends on USB_OHCI_HCD && PLAT_SPEAR
+         default y
+         ---help---
+           Enables support for the on-chip OHCI controller on
+           ST SPEAr chips.
+ 
+ config USB_OHCI_HCD_STI
+ 	tristate "Support for ST STiHxxx on-chip OHCI USB controller"
+ 	depends on ARCH_STI && OF
+ 	select GENERIC_PHY
+ 	select USB_OHCI_HCD_PLATFORM
+ 	help
+ 	  Enable support for the on-chip OHCI controller found on
+ 	  STMicroelectronics consumer electronics SoC's.
+ 
+ config USB_OHCI_HCD_S3C2410
+         tristate "OHCI support for Samsung S3C24xx/S3C64xx SoC series"
+         depends on USB_OHCI_HCD && (ARCH_S3C24XX || ARCH_S3C64XX)
+         default y
+         ---help---
+           Enables support for the on-chip OHCI controller on
+           S3C24xx/S3C64xx chips.
+ 
+ config USB_OHCI_HCD_LPC32XX
+ 	tristate "Support for LPC on-chip OHCI USB controller"
+ 	depends on USB_OHCI_HCD && ARCH_LPC32XX
+ 	depends on USB_ISP1301
+ 	default y
+ 	---help---
+           Enables support for the on-chip OHCI controller on
+           NXP chips.
+ 
+ config USB_OHCI_HCD_PXA27X
+ 	tristate "Support for PXA27X/PXA3XX on-chip OHCI USB controller"
+ 	depends on USB_OHCI_HCD && (PXA27x || PXA3xx)
+ 	default y
+ 	---help---
+ 	  Enables support for the on-chip OHCI controller on
+ 	  PXA27x/PXA3xx chips.
+ 
+ config USB_OHCI_HCD_AT91
+         tristate "Support for Atmel on-chip OHCI USB controller"
+         depends on USB_OHCI_HCD && ARCH_AT91
+         default y
+         ---help---
+           Enables support for the on-chip OHCI controller on
+           Atmel chips.
+ 
++>>>>>>> 905e300e1043 (USB: host: st: fix ehci/ohci driver selection)
  config USB_OHCI_HCD_OMAP3
 -	tristate "OHCI support for OMAP3 and later chips"
 +	bool "OHCI support for OMAP3 and later chips"
  	depends on (ARCH_OMAP3 || ARCH_OMAP4)
  	default y
  	---help---
diff --cc drivers/usb/host/Makefile
index c063401cba59,0336bb2c0e6f..000000000000
--- a/drivers/usb/host/Makefile
+++ b/drivers/usb/host/Makefile
@@@ -32,9 -38,12 +32,14 @@@ obj-$(CONFIG_USB_EHCI_MXC)	+= ehci-mxc.
  obj-$(CONFIG_USB_EHCI_HCD_OMAP)	+= ehci-omap.o
  obj-$(CONFIG_USB_EHCI_HCD_ORION)	+= ehci-orion.o
  obj-$(CONFIG_USB_EHCI_HCD_SPEAR)	+= ehci-spear.o
++<<<<<<< HEAD
 +obj-$(CONFIG_USB_EHCI_S5P)	+= ehci-s5p.o
++=======
+ obj-$(CONFIG_USB_EHCI_HCD_ST)	+= ehci-st.o
+ obj-$(CONFIG_USB_EHCI_EXYNOS)	+= ehci-exynos.o
++>>>>>>> 905e300e1043 (USB: host: st: fix ehci/ohci driver selection)
  obj-$(CONFIG_USB_EHCI_HCD_AT91) += ehci-atmel.o
  obj-$(CONFIG_USB_EHCI_MSM)	+= ehci-msm.o
 -obj-$(CONFIG_USB_EHCI_TEGRA)	+= ehci-tegra.o
 -obj-$(CONFIG_USB_W90X900_EHCI)	+= ehci-w90x900.o
  
  obj-$(CONFIG_USB_OXU210HP_HCD)	+= oxu210hp-hcd.o
  obj-$(CONFIG_USB_ISP116X_HCD)	+= isp116x-hcd.o
@@@ -44,6 -53,14 +49,17 @@@ obj-$(CONFIG_USB_OHCI_HCD)	+= ohci-hcd.
  obj-$(CONFIG_USB_OHCI_HCD_PCI)	+= ohci-pci.o
  obj-$(CONFIG_USB_OHCI_HCD_PLATFORM)	+= ohci-platform.o
  obj-$(CONFIG_USB_OHCI_EXYNOS)	+= ohci-exynos.o
++<<<<<<< HEAD
++=======
+ obj-$(CONFIG_USB_OHCI_HCD_OMAP1)	+= ohci-omap.o
+ obj-$(CONFIG_USB_OHCI_HCD_OMAP3)	+= ohci-omap3.o
+ obj-$(CONFIG_USB_OHCI_HCD_SPEAR)	+= ohci-spear.o
+ obj-$(CONFIG_USB_OHCI_HCD_STI)	+= ohci-st.o
+ obj-$(CONFIG_USB_OHCI_HCD_AT91)	+= ohci-at91.o
+ obj-$(CONFIG_USB_OHCI_HCD_S3C2410)	+= ohci-s3c2410.o
+ obj-$(CONFIG_USB_OHCI_HCD_LPC32XX)	+= ohci-nxp.o
+ obj-$(CONFIG_USB_OHCI_HCD_PXA27X)	+= ohci-pxa27x.o
++>>>>>>> 905e300e1043 (USB: host: st: fix ehci/ohci driver selection)
  
  obj-$(CONFIG_USB_UHCI_HCD)	+= uhci-hcd.o
  obj-$(CONFIG_USB_FHCI_HCD)	+= fhci.o
* Unmerged path drivers/usb/host/Kconfig
* Unmerged path drivers/usb/host/Makefile
