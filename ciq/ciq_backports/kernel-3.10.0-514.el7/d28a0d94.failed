powerpc/pasemi: Move controller ops from ppc_md to controller_ops

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
Rebuild_CHGLOG: - [powerpc] pasemi: Move controller ops from ppc_md to controller_ops (Gustavo Duarte) [1275657]
Rebuild_FUZZ: 93.44%
commit-author Daniel Axtens <dja@axtens.net>
commit d28a0d94d752354d9830f8cc0426e9119f9f227d
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/d28a0d94.failed

This moves the PaSemi platform to use the pci_controller_ops
structure rather than ppc_md for PCI controller operations.

	Signed-off-by: Daniel Axtens <dja@axtens.net>
	Signed-off-by: Michael Ellerman <mpe@ellerman.id.au>
(cherry picked from commit d28a0d94d752354d9830f8cc0426e9119f9f227d)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/powerpc/platforms/pasemi/iommu.c
diff --cc arch/powerpc/platforms/pasemi/iommu.c
index b7245b21c3f0,b8f567b2ea19..000000000000
--- a/arch/powerpc/platforms/pasemi/iommu.c
+++ b/arch/powerpc/platforms/pasemi/iommu.c
@@@ -253,8 -250,10 +255,15 @@@ void __init iommu_init_early_pasemi(voi
  
  	iob_init(NULL);
  
++<<<<<<< HEAD
 +	ppc_md.pci_dma_dev_setup = pci_dma_dev_setup_pasemi;
 +	ppc_md.pci_dma_bus_setup = pci_dma_bus_setup_pasemi;
++=======
+ 	pasemi_pci_controller_ops.dma_dev_setup = pci_dma_dev_setup_pasemi;
+ 	pasemi_pci_controller_ops.dma_bus_setup = pci_dma_bus_setup_pasemi;
+ 	ppc_md.tce_build = iobmap_build;
+ 	ppc_md.tce_free  = iobmap_free;
++>>>>>>> d28a0d94d752 (powerpc/pasemi: Move controller ops from ppc_md to controller_ops)
  	set_pci_dma_ops(&dma_iommu_ops);
  }
  
* Unmerged path arch/powerpc/platforms/pasemi/iommu.c
diff --git a/arch/powerpc/platforms/pasemi/pasemi.h b/arch/powerpc/platforms/pasemi/pasemi.h
index ea65bf0eb897..11f230a48227 100644
--- a/arch/powerpc/platforms/pasemi/pasemi.h
+++ b/arch/powerpc/platforms/pasemi/pasemi.h
@@ -30,5 +30,6 @@ static inline void restore_astate(int cpu)
 }
 #endif
 
+extern struct pci_controller_ops pasemi_pci_controller_ops;
 
 #endif /* _PASEMI_PASEMI_H */
diff --git a/arch/powerpc/platforms/pasemi/pci.c b/arch/powerpc/platforms/pasemi/pci.c
index aa862713258c..f3a68a0fef23 100644
--- a/arch/powerpc/platforms/pasemi/pci.c
+++ b/arch/powerpc/platforms/pasemi/pci.c
@@ -31,6 +31,8 @@
 
 #include <asm/ppc-pci.h>
 
+#include "pasemi.h"
+
 #define PA_PXP_CFA(bus, devfn, off) (((bus) << 20) | ((devfn) << 12) | (off))
 
 static inline int pa_pxp_offset_valid(u8 bus, u8 devfn, int offset)
@@ -199,6 +201,7 @@ static int __init pas_add_bridge(struct device_node *dev)
 
 	hose->first_busno = 0;
 	hose->last_busno = 0xff;
+	hose->controller_ops = pasemi_pci_controller_ops;
 
 	setup_pa_pxp(hose);
 
@@ -239,3 +242,5 @@ void __iomem *pasemi_pci_getcfgaddr(struct pci_dev *dev, int offset)
 
 	return (void __iomem *)pa_pxp_cfg_addr(hose, dev->bus->number, dev->devfn, offset);
 }
+
+struct pci_controller_ops pasemi_pci_controller_ops;
