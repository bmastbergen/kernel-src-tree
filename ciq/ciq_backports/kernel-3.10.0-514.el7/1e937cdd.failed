xfs: Add alignment check for DAX mount

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
commit-author Toshi Kani <toshi.kani@hpe.com>
commit 1e937cddd1ff4b823fc9d148ebabd443f105211e
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/1e937cdd.failed

When a partition is not aligned by 4KB, mount -o dax succeeds,
but any read/write access to the filesystem fails, except for
metadata update.

Call bdev_dax_supported() to perform proper precondition checks
which includes this partition alignment check.

	Signed-off-by: Toshi Kani <toshi.kani@hpe.com>
	Reviewed-by: Christoph Hellwig <hch@lst.de>
	Cc: Dave Chinner <david@fromorbit.com>
	Cc: Dan Williams <dan.j.williams@intel.com>
	Cc: Ross Zwisler <ross.zwisler@linux.intel.com>
	Cc: Christoph Hellwig <hch@infradead.org>
	Cc: Boaz Harrosh <boaz@plexistor.com>
	Signed-off-by: Vishal Verma <vishal.l.verma@intel.com>
(cherry picked from commit 1e937cddd1ff4b823fc9d148ebabd443f105211e)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	fs/xfs/xfs_super.c
diff --cc fs/xfs/xfs_super.c
index c827b68f42ea,39f4e6ab3d36..000000000000
--- a/fs/xfs/xfs_super.c
+++ b/fs/xfs/xfs_super.c
@@@ -1544,6 -1556,22 +1544,25 @@@ xfs_fs_fill_super
  	if (XFS_SB_VERSION_NUM(&mp->m_sb) == XFS_SB_VERSION_5)
  		sb->s_flags |= MS_I_VERSION;
  
++<<<<<<< HEAD
++=======
+ 	if (mp->m_flags & XFS_MOUNT_DAX) {
+ 		xfs_warn(mp,
+ 		"DAX enabled. Warning: EXPERIMENTAL, use at your own risk");
+ 
+ 		error = bdev_dax_supported(sb, sb->s_blocksize);
+ 		if (error) {
+ 			xfs_alert(mp,
+ 			"DAX unsupported by block device. Turning off DAX.");
+ 			mp->m_flags &= ~XFS_MOUNT_DAX;
+ 		}
+ 	}
+ 
+ 	if (xfs_sb_version_hassparseinodes(&mp->m_sb))
+ 		xfs_alert(mp,
+ 	"EXPERIMENTAL sparse inode feature enabled. Use at your own risk!");
+ 
++>>>>>>> 1e937cddd1ff (xfs: Add alignment check for DAX mount)
  	error = xfs_mountfs(mp);
  	if (error)
  		goto out_filestream_unmount;
* Unmerged path fs/xfs/xfs_super.c
