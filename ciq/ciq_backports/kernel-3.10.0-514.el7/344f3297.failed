bonding: use neighbours for bond_next_slave()

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
commit-author Veaceslav Falico <vfalico@redhat.com>
commit 344f3297629e409675120998d1cfe4d21c34fbaa
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/344f3297.failed

Use the new function __bond_next_slave().

CC: Jay Vosburgh <fubar@us.ibm.com>
CC: Andy Gospodarek <andy@greyhouse.net>
	Signed-off-by: Veaceslav Falico <vfalico@redhat.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 344f3297629e409675120998d1cfe4d21c34fbaa)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	include/net/bonding.h
diff --cc include/net/bonding.h
index 8c9030b1a51e,f070557c21ea..000000000000
--- a/include/net/bonding.h
+++ b/include/net/bonding.h
@@@ -54,26 -71,26 +54,29 @@@
  	set_fs(fs);			\
  	res; })
  
 -/* slave list primitives */
 -#define bond_slave_list(bond) (&(bond)->dev->adj_list.lower)
 +#define BOND_MODE(bond) ((bond)->params.mode)
  
 -#define bond_has_slaves(bond) !list_empty(bond_slave_list(bond))
 +/* slave list primitives */
 +#define bond_has_slaves(bond) !list_empty(&(bond)->dev->adj_list.lower)
  
- #define bond_to_slave(ptr) list_entry(ptr, struct slave, list)
- 
  /* IMPORTANT: bond_first/last_slave can return NULL in case of an empty list */
  #define bond_first_slave(bond) \
 -	(bond_has_slaves(bond) ? \
 -		netdev_adjacent_get_private(bond_slave_list(bond)->next) : \
 -		NULL)
 +	list_first_entry_or_null(&(bond)->slave_list, struct slave, list)
  #define bond_last_slave(bond) \
 -	(bond_has_slaves(bond) ? \
 -		netdev_adjacent_get_private(bond_slave_list(bond)->prev) : \
 -		NULL)
 +	(list_empty(&(bond)->slave_list) ? NULL : \
 +					   bond_to_slave((bond)->slave_list.prev))
  
 -#define bond_is_first_slave(bond, pos) (pos == bond_first_slave(bond))
 -#define bond_is_last_slave(bond, pos) (pos == bond_last_slave(bond))
 +/* Caller must have rcu_read_lock */
 +#define bond_first_slave_rcu(bond) \
 +	list_first_entry_or_null(&(bond)->slave_list, struct slave, list)
  
++<<<<<<< HEAD:include/net/bonding.h
 +#define bond_is_first_slave(bond, pos) ((pos)->list.prev == &(bond)->slave_list)
 +#define bond_is_last_slave(bond, pos) ((pos)->list.next == &(bond)->slave_list)
++=======
+ /* Since bond_first/last_slave can return NULL, these can return NULL too */
+ #define bond_next_slave(bond, pos) __bond_next_slave(bond, pos)
++>>>>>>> 344f3297629e (bonding: use neighbours for bond_next_slave()):drivers/net/bonding/bonding.h
  
  /**
   * bond_for_each_slave - iterate over all slaves
* Unmerged path include/net/bonding.h
