netfilter: nft_counter: fix erroneous return values

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
commit-author Anton Protopopov <a.s.protopopov@gmail.com>
commit 5cc6ce9ff27565949a1001a2889a8dd9fd09e772
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/5cc6ce9f.failed

The nft_counter_init() and nft_counter_clone() functions should return
negative error value -ENOMEM instead of positive ENOMEM.

	Signed-off-by: Anton Protopopov <a.s.protopopov@gmail.com>
	Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
(cherry picked from commit 5cc6ce9ff27565949a1001a2889a8dd9fd09e772)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/netfilter/nft_counter.c
diff --cc net/netfilter/nft_counter.c
index 9e54bfe3ba12,c9743f78f219..000000000000
--- a/net/netfilter/nft_counter.c
+++ b/net/netfilter/nft_counter.c
@@@ -118,6 -125,31 +118,34 @@@ static void nft_counter_destroy(const s
  	free_percpu(priv->counter);
  }
  
++<<<<<<< HEAD
++=======
+ static int nft_counter_clone(struct nft_expr *dst, const struct nft_expr *src)
+ {
+ 	struct nft_counter_percpu_priv *priv = nft_expr_priv(src);
+ 	struct nft_counter_percpu_priv *priv_clone = nft_expr_priv(dst);
+ 	struct nft_counter_percpu __percpu *cpu_stats;
+ 	struct nft_counter_percpu *this_cpu;
+ 	struct nft_counter total;
+ 
+ 	nft_counter_fetch(priv->counter, &total);
+ 
+ 	cpu_stats = __netdev_alloc_pcpu_stats(struct nft_counter_percpu,
+ 					      GFP_ATOMIC);
+ 	if (cpu_stats == NULL)
+ 		return -ENOMEM;
+ 
+ 	preempt_disable();
+ 	this_cpu = this_cpu_ptr(cpu_stats);
+ 	this_cpu->counter.packets = total.packets;
+ 	this_cpu->counter.bytes = total.bytes;
+ 	preempt_enable();
+ 
+ 	priv_clone->counter = cpu_stats;
+ 	return 0;
+ }
+ 
++>>>>>>> 5cc6ce9ff275 (netfilter: nft_counter: fix erroneous return values)
  static struct nft_expr_type nft_counter_type;
  static const struct nft_expr_ops nft_counter_ops = {
  	.type		= &nft_counter_type,
* Unmerged path net/netfilter/nft_counter.c
