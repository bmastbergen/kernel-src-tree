crypto: drivers - Fix Kconfig selects

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
Rebuild_CHGLOG: - [crypto] drivers - Fix Kconfig selects (Neil Horman) [1274179]
Rebuild_FUZZ: 87.88%
commit-author Herbert Xu <herbert@gondor.apana.org.au>
commit 596103cf8fb0a258e1a5ed3e895860764490934d
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/596103cf.failed

This patch fixes a number of problems in crypto driver Kconfig
entries:

1. Select BLKCIPHER instead of BLKCIPHER2.  The latter is internal
and should not be used outside of the crypto API itself.
2. Do not select ALGAPI unless you use a legacy type like
CRYPTO_ALG_TYPE_CIPHER.
3. Select the algorithm type that you are implementing, e.g., AEAD.
4. Do not select generic C code such as CBC/ECB unless you use them
as a fallback.
5. Remove default n since that is the default default.

	Signed-off-by: Herbert Xu <herbert@gondor.apana.org.au>
(cherry picked from commit 596103cf8fb0a258e1a5ed3e895860764490934d)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/crypto/Kconfig
#	drivers/crypto/caam/Kconfig
#	drivers/crypto/ccp/Kconfig
diff --cc drivers/crypto/Kconfig
index 070e1b070ef6,7a72797f6f58..000000000000
--- a/drivers/crypto/Kconfig
+++ b/drivers/crypto/Kconfig
@@@ -252,13 -273,24 +252,27 @@@ config CRYPTO_DEV_OMAP_SHA
  
  config CRYPTO_DEV_OMAP_AES
  	tristate "Support for OMAP AES hw engine"
 -	depends on ARCH_OMAP2 || ARCH_OMAP3 || ARCH_OMAP2PLUS
 +	depends on ARCH_OMAP2 || ARCH_OMAP3
  	select CRYPTO_AES
- 	select CRYPTO_BLKCIPHER2
+ 	select CRYPTO_BLKCIPHER
  	help
  	  OMAP processors have AES module accelerator. Select this if you
  	  want to use the OMAP module for AES algorithms.
  
++<<<<<<< HEAD
++=======
+ config CRYPTO_DEV_OMAP_DES
+ 	tristate "Support for OMAP DES3DES hw engine"
+ 	depends on ARCH_OMAP2PLUS
+ 	select CRYPTO_DES
+ 	select CRYPTO_BLKCIPHER
+ 	help
+ 	  OMAP processors have DES/3DES module accelerator. Select this if you
+ 	  want to use the OMAP module for DES and 3DES algorithms. Currently
+ 	  the ECB and CBC modes of operation supported by the driver. Also
+ 	  accesses made on unaligned boundaries are also supported.
+ 
++>>>>>>> 596103cf8fb0 (crypto: drivers - Fix Kconfig selects)
  config CRYPTO_DEV_PICOXCELL
  	tristate "Support for picoXcell IPSEC and Layer2 crypto engines"
  	depends on ARCH_PICOXCELL && HAVE_CLK
@@@ -287,10 -320,9 +302,9 @@@ config CRYPTO_DEV_SAHAR
  	  found in some Freescale i.MX chips.
  
  config CRYPTO_DEV_S5P
 -	tristate "Support for Samsung S5PV210/Exynos crypto accelerator"
 -	depends on ARCH_S5PV210 || ARCH_EXYNOS
 +	tristate "Support for Samsung S5PV210 crypto accelerator"
 +	depends on ARCH_S5PV210
  	select CRYPTO_AES
- 	select CRYPTO_ALGAPI
  	select CRYPTO_BLKCIPHER
  	help
  	  This option allows you to have support for S5P crypto acceleration.
@@@ -388,5 -399,68 +392,72 @@@ config CRYPTO_DEV_ATMEL_SH
  	  To compile this driver as a module, choose M here: the module
  	  will be called atmel-sha.
  
++<<<<<<< HEAD
 +source "drivers/crypto/qat/Kconfig"
++=======
+ config CRYPTO_DEV_CCP
+ 	bool "Support for AMD Cryptographic Coprocessor"
+ 	depends on ((X86 && PCI) || (ARM64 && (OF_ADDRESS || ACPI))) && HAS_IOMEM
+ 	help
+ 	  The AMD Cryptographic Coprocessor provides hardware support
+ 	  for encryption, hashing and related operations.
+ 
+ if CRYPTO_DEV_CCP
+ 	source "drivers/crypto/ccp/Kconfig"
+ endif
+ 
+ config CRYPTO_DEV_MXS_DCP
+ 	tristate "Support for Freescale MXS DCP"
+ 	depends on ARCH_MXS
+ 	select CRYPTO_CBC
+ 	select CRYPTO_ECB
+ 	select CRYPTO_AES
+ 	select CRYPTO_BLKCIPHER
+ 	select CRYPTO_HASH
+ 	help
+ 	  The Freescale i.MX23/i.MX28 has SHA1/SHA256 and AES128 CBC/ECB
+ 	  co-processor on the die.
+ 
+ 	  To compile this driver as a module, choose M here: the module
+ 	  will be called mxs-dcp.
+ 
+ source "drivers/crypto/qat/Kconfig"
+ 
+ config CRYPTO_DEV_QCE
+ 	tristate "Qualcomm crypto engine accelerator"
+ 	depends on (ARCH_QCOM || COMPILE_TEST) && HAS_DMA && HAS_IOMEM
+ 	select CRYPTO_AES
+ 	select CRYPTO_DES
+ 	select CRYPTO_ECB
+ 	select CRYPTO_CBC
+ 	select CRYPTO_XTS
+ 	select CRYPTO_CTR
+ 	select CRYPTO_BLKCIPHER
+ 	help
+ 	  This driver supports Qualcomm crypto engine accelerator
+ 	  hardware. To compile this driver as a module, choose M here. The
+ 	  module will be called qcrypto.
+ 
+ config CRYPTO_DEV_VMX
+ 	bool "Support for VMX cryptographic acceleration instructions"
+ 	depends on PPC64
+ 	help
+ 	  Support for VMX cryptographic acceleration instructions.
+ 
+ source "drivers/crypto/vmx/Kconfig"
+ 
+ config CRYPTO_DEV_IMGTEC_HASH
+ 	tristate "Imagination Technologies hardware hash accelerator"
+ 	depends on MIPS || COMPILE_TEST
+ 	depends on HAS_DMA
+ 	select CRYPTO_MD5
+ 	select CRYPTO_SHA1
+ 	select CRYPTO_SHA256
+ 	select CRYPTO_HASH
+ 	help
+ 	  This driver interfaces with the Imagination Technologies
+ 	  hardware hash accelerator. Supporting MD5/SHA1/SHA224/SHA256
+ 	  hashing algorithms.
+ 
++>>>>>>> 596103cf8fb0 (crypto: drivers - Fix Kconfig selects)
  endif # CRYPTO_HW
diff --cc drivers/crypto/caam/Kconfig
index b44091c47f75,e286e285aa8a..000000000000
--- a/drivers/crypto/caam/Kconfig
+++ b/drivers/crypto/caam/Kconfig
@@@ -31,8 -44,7 +31,12 @@@ config CRYPTO_DEV_FSL_CAAM_RINGSIZ
  
  config CRYPTO_DEV_FSL_CAAM_INTC
  	bool "Job Ring interrupt coalescing"
++<<<<<<< HEAD
 +	depends on CRYPTO_DEV_FSL_CAAM
 +	default n
++=======
+ 	depends on CRYPTO_DEV_FSL_CAAM_JR
++>>>>>>> 596103cf8fb0 (crypto: drivers - Fix Kconfig selects)
  	help
  	  Enable the Job Ring's interrupt coalescing feature.
  
@@@ -62,10 -74,11 +66,11 @@@ config CRYPTO_DEV_FSL_CAAM_INTC_TIME_TH
  
  config CRYPTO_DEV_FSL_CAAM_CRYPTO_API
  	tristate "Register algorithm implementations with the Crypto API"
 -	depends on CRYPTO_DEV_FSL_CAAM && CRYPTO_DEV_FSL_CAAM_JR
 +	depends on CRYPTO_DEV_FSL_CAAM
  	default y
- 	select CRYPTO_ALGAPI
+ 	select CRYPTO_AEAD
  	select CRYPTO_AUTHENC
+ 	select CRYPTO_BLKCIPHER
  	help
  	  Selecting this will offload crypto for users of the
  	  scatterlist crypto API (such as the linux native IPSec
@@@ -98,3 -111,10 +103,13 @@@ config CRYPTO_DEV_FSL_CAAM_RNG_AP
  
  	  To compile this as a module, choose M here: the module
  	  will be called caamrng.
++<<<<<<< HEAD
++=======
+ 
+ config CRYPTO_DEV_FSL_CAAM_DEBUG
+ 	bool "Enable debug output in CAAM driver"
+ 	depends on CRYPTO_DEV_FSL_CAAM
+ 	help
+ 	  Selecting this will enable printing of various debug
+ 	  information in the CAAM driver.
++>>>>>>> 596103cf8fb0 (crypto: drivers - Fix Kconfig selects)
* Unmerged path drivers/crypto/ccp/Kconfig
* Unmerged path drivers/crypto/Kconfig
* Unmerged path drivers/crypto/caam/Kconfig
* Unmerged path drivers/crypto/ccp/Kconfig
diff --git a/drivers/crypto/nx/Kconfig b/drivers/crypto/nx/Kconfig
index 7807c0a679c2..ad7552a6998c 100644
--- a/drivers/crypto/nx/Kconfig
+++ b/drivers/crypto/nx/Kconfig
@@ -3,16 +3,8 @@ config CRYPTO_DEV_NX_ENCRYPT
 	tristate "Encryption acceleration support on pSeries platform"
 	depends on PPC_PSERIES && IBMVIO && !CPU_LITTLE_ENDIAN
 	default y
-	select CRYPTO_ALGAPI
 	select CRYPTO_AES
-	select CRYPTO_CBC
-	select CRYPTO_ECB
 	select CRYPTO_CCM
-	select CRYPTO_GCM
-	select CRYPTO_AUTHENC
-	select CRYPTO_XCBC
-	select CRYPTO_SHA256
-	select CRYPTO_SHA512
 	help
 	  Support for PowerPC Nest (NX) encryption acceleration. This
 	  module supports acceleration for AES and SHA2 algorithms on
diff --git a/drivers/crypto/qat/Kconfig b/drivers/crypto/qat/Kconfig
index 49bede2a9f77..6fdb9e8b22a7 100644
--- a/drivers/crypto/qat/Kconfig
+++ b/drivers/crypto/qat/Kconfig
@@ -2,9 +2,8 @@ config CRYPTO_DEV_QAT
 	tristate
 	select CRYPTO_AEAD
 	select CRYPTO_AUTHENC
-	select CRYPTO_ALGAPI
-	select CRYPTO_AES
-	select CRYPTO_CBC
+	select CRYPTO_BLKCIPHER
+	select CRYPTO_HMAC
 	select CRYPTO_SHA1
 	select CRYPTO_SHA256
 	select CRYPTO_SHA512
@@ -13,7 +12,6 @@ config CRYPTO_DEV_QAT
 config CRYPTO_DEV_QAT_DH895xCC
 	tristate "Support for Intel(R) DH895xCC"
 	depends on X86 && PCI
-	default n
 	select CRYPTO_DEV_QAT
 	help
 	  Support for Intel(R) DH895xcc with Intel(R) QuickAssist Technology
diff --git a/drivers/crypto/ux500/Kconfig b/drivers/crypto/ux500/Kconfig
index b35e5c4b025a..30796441b0a6 100644
--- a/drivers/crypto/ux500/Kconfig
+++ b/drivers/crypto/ux500/Kconfig
@@ -7,6 +7,8 @@
 config CRYPTO_DEV_UX500_CRYP
 	tristate "UX500 crypto driver for CRYP block"
 	depends on CRYPTO_DEV_UX500
+	select CRYPTO_ALGAPI
+	select CRYPTO_BLKCIPHER
 	select CRYPTO_DES
 	help
         This selects the crypto driver for the UX500_CRYP hardware. It supports
@@ -16,7 +18,6 @@ config CRYPTO_DEV_UX500_HASH
         tristate "UX500 crypto driver for HASH block"
         depends on CRYPTO_DEV_UX500
         select CRYPTO_HASH
-        select CRYPTO_HMAC
         help
           This selects the hash driver for the UX500_HASH hardware.
           Depends on UX500/STM DMA if running in DMA mode.
@@ -24,7 +25,6 @@ config CRYPTO_DEV_UX500_HASH
 config CRYPTO_DEV_UX500_DEBUG
 	bool "Activate ux500 platform debug-mode for crypto and hash block"
 	depends on CRYPTO_DEV_UX500_CRYP || CRYPTO_DEV_UX500_HASH
-	default n
 	help
 	  Say Y if you want to add debug prints to ux500_hash and
 	  ux500_cryp devices.
