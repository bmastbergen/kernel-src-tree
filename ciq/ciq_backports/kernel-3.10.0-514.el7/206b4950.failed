net/ip6_tunnel: fix dst leak

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
Rebuild_CHGLOG: - [net] ip6_tunnel: fix dst leak (Jiri Benc) [1323141]
Rebuild_FUZZ: 92.31%
commit-author Paolo Abeni <pabeni@redhat.com>
commit 206b49500df558dbc15d8836b09f6397ec5ed8bb
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/206b4950.failed

the commit cdf3464e6c6b ("ipv6: Fix dst_entry refcnt bugs in ip6_tunnel")
introduced percpu storage for ip6_tunnel dst cache, but while clearing
such cache it used raw_cpu_ptr to walk the per cpu entries, so cached
dst on non current cpu are not actually reset.

This patch replaces raw_cpu_ptr with per_cpu_ptr, properly cleaning
such storage.

Fixes: cdf3464e6c6b ("ipv6: Fix dst_entry refcnt bugs in ip6_tunnel")
	Signed-off-by: Paolo Abeni <pabeni@redhat.com>
	Acked-by: Martin KaFai Lau <kafai@fb.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 206b49500df558dbc15d8836b09f6397ec5ed8bb)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/ipv6/ip6_tunnel.c
diff --cc net/ipv6/ip6_tunnel.c
index da3fa47becb4,137fca42aaa6..000000000000
--- a/net/ipv6/ip6_tunnel.c
+++ b/net/ipv6/ip6_tunnel.c
@@@ -145,8 -174,10 +145,15 @@@ EXPORT_SYMBOL_GPL(ip6_tnl_dst_get)
  
  void ip6_tnl_dst_reset(struct ip6_tnl *t)
  {
++<<<<<<< HEAD
 +	dst_release(t->dst_cache);
 +	t->dst_cache = NULL;
++=======
+ 	int i;
+ 
+ 	for_each_possible_cpu(i)
+ 		ip6_tnl_per_cpu_dst_set(per_cpu_ptr(t->dst_cache, i), NULL);
++>>>>>>> 206b49500df5 (net/ip6_tunnel: fix dst leak)
  }
  EXPORT_SYMBOL_GPL(ip6_tnl_dst_reset);
  
* Unmerged path net/ipv6/ip6_tunnel.c
