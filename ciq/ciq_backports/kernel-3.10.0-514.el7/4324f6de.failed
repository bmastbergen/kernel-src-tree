mmc: core: enable CMD19 tuning for DDR50 mode

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
Rebuild_CHGLOG: - [mmc] core: enable CMD19 tuning for DDR50 mode (Don Zickus) [1127975 1277866 1280133 1286932 1297039]
Rebuild_FUZZ: 94.12%
commit-author Weijun Yang <york.yang@csr.com>
commit 4324f6de6d2eb9b232410eb0d67bfafdde8ba711
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/4324f6de.failed

As SD Specifications Part1 Physical Layer Specification Version
3.01 says, CMD19 tuning is available for unlocked cards in transfer
state of 1.8V signaling mode. The small difference between v3.00
and 3.01 spec means that CMD19 tuning is also available for DDR50
mode.

	Signed-off-by: Weijun Yang <york.yang@csr.com>
	Signed-off-by: Barry Song <Baohua.Song@csr.com>
	Signed-off-by: Ulf Hansson <ulf.hansson@linaro.org>
(cherry picked from commit 4324f6de6d2eb9b232410eb0d67bfafdde8ba711)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/mmc/core/sd.c
diff --cc drivers/mmc/core/sd.c
index a81b0549dbf3,e124db0fc178..000000000000
--- a/drivers/mmc/core/sd.c
+++ b/drivers/mmc/core/sd.c
@@@ -660,13 -625,24 +660,34 @@@ static int mmc_sd_init_uhs_card(struct 
  	 * SPI mode doesn't define CMD19 and tuning is only valid for SDR50 and
  	 * SDR104 mode SD-cards. Note that tuning is mandatory for SDR104.
  	 */
++<<<<<<< HEAD
 +	if (!mmc_host_is_spi(card->host) && card->host->ops->execute_tuning &&
 +			(card->sd_bus_speed == UHS_SDR50_BUS_SPEED ||
 +			 card->sd_bus_speed == UHS_SDR104_BUS_SPEED)) {
 +		mmc_host_clk_hold(card->host);
 +		err = card->host->ops->execute_tuning(card->host,
 +						      MMC_SEND_TUNING_BLOCK);
 +		mmc_host_clk_release(card->host);
++=======
+ 	if (!mmc_host_is_spi(card->host) &&
+ 		(card->sd_bus_speed == UHS_SDR50_BUS_SPEED ||
+ 		 card->sd_bus_speed == UHS_DDR50_BUS_SPEED ||
+ 		 card->sd_bus_speed == UHS_SDR104_BUS_SPEED)) {
+ 		err = mmc_execute_tuning(card);
+ 
+ 		/*
+ 		 * As SD Specifications Part1 Physical Layer Specification
+ 		 * Version 3.01 says, CMD19 tuning is available for unlocked
+ 		 * cards in transfer state of 1.8V signaling mode. The small
+ 		 * difference between v3.00 and 3.01 spec means that CMD19
+ 		 * tuning is also available for DDR50 mode.
+ 		 */
+ 		if (err && card->sd_bus_speed == UHS_DDR50_BUS_SPEED) {
+ 			pr_warn("%s: ddr50 tuning failed\n",
+ 				mmc_hostname(card->host));
+ 			err = 0;
+ 		}
++>>>>>>> 4324f6de6d2e (mmc: core: enable CMD19 tuning for DDR50 mode)
  	}
  
  out:
* Unmerged path drivers/mmc/core/sd.c
