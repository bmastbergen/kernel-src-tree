r8152: fix the carrier off when autoresuming

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
commit-author hayeswang <hayeswang@realtek.com>
commit 445f7f4d62628cb2971db884084d162ecb622ec7
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/445f7f4d.failed

netif_carrier_off would be called when autoresuming, even though
the cable is plugged. This causes some applications do relative
actions when detecting the carrier off. Keep the status of the
carrier, and let it be modified when the linking change occurs.

	Signed-off-by: Hayes Wang <hayeswang@realtek.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 445f7f4d62628cb2971db884084d162ecb622ec7)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/usb/r8152.c
diff --cc drivers/net/usb/r8152.c
index 0e970070bc5a,e0394427e372..000000000000
--- a/drivers/net/usb/r8152.c
+++ b/drivers/net/usb/r8152.c
@@@ -2052,11 -2067,10 +2069,10 @@@ static void rtl_disable(struct r8152 *t
  	for (i = 0; i < 1000; i++) {
  		if (ocp_read_word(tp, MCU_TYPE_PLA, PLA_TCR0) & TCR0_TX_EMPTY)
  			break;
 -		mdelay(1);
 +		usleep_range(1000, 2000);
  	}
  
- 	for (i = 0; i < RTL8152_MAX_RX; i++)
- 		usb_kill_urb(tp->rx_info[i].urb);
+ 	rtl_stop_rx(tp);
  
  	rtl8152_nic_reset(tp);
  }
@@@ -3122,13 -3131,12 +3140,18 @@@ static int rtl8152_resume(struct usb_in
  		} else {
  			tp->rtl_ops.up(tp);
  			rtl8152_set_speed(tp, AUTONEG_ENABLE,
++<<<<<<< HEAD
 +					  tp->mii.supports_gmii ?
 +					  SPEED_1000 : SPEED_100,
 +					  DUPLEX_FULL);
++=======
+ 				tp->mii.supports_gmii ? SPEED_1000 : SPEED_100,
+ 				DUPLEX_FULL);
+ 			tp->speed = 0;
+ 			netif_carrier_off(tp->netdev);
+ 			set_bit(WORK_ENABLE, &tp->flags);
++>>>>>>> 445f7f4d6262 (r8152: fix the carrier off when autoresuming)
  		}
- 		tp->speed = 0;
- 		netif_carrier_off(tp->netdev);
- 		set_bit(WORK_ENABLE, &tp->flags);
  		usb_submit_urb(tp->intr_urb, GFP_KERNEL);
  	}
  
* Unmerged path drivers/net/usb/r8152.c
