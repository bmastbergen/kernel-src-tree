perf evsel: Disable branch flags/cycles for --callgraph lbr

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
commit-author Andi Kleen <ak@linux.intel.com>
commit bd0f889536f80630c1c4a414f2de90744d2c87d0
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/bd0f8895.failed

[The kernel patch needed for this is in tip now (b16a5b52eb9 perf/x86:
Add option to disable ...) So this user tools patch to make use of it
should be merged now]

Automatically disable collecting branch flags and cycles with
--call-graph lbr. This allows avoiding a bunch of extra MSR
reads in the PMI on Skylake.

When the kernel doesn't support the new flags they are automatically
cleared in the fallback code.

v2: Switch to use branch_sample_type instead of sample_type.
Adjust description.
Fix the fallback logic.

	Signed-off-by: Andi Kleen <ak@linux.intel.com>
	Acked-by: Jiri Olsa <jolsa@kernel.org>
Link: http://lkml.kernel.org/r/1449879144-29074-1-git-send-email-andi@firstfloor.org
	Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>
(cherry picked from commit bd0f889536f80630c1c4a414f2de90744d2c87d0)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	tools/perf/util/evsel.c
diff --cc tools/perf/util/evsel.c
index ff56cebf0bb7,544e4400de13..000000000000
--- a/tools/perf/util/evsel.c
+++ b/tools/perf/util/evsel.c
@@@ -34,8 -34,13 +34,14 @@@ static struct 
  	bool exclude_guest;
  	bool mmap2;
  	bool cloexec;
++<<<<<<< HEAD
++=======
+ 	bool clockid;
+ 	bool clockid_wrong;
+ 	bool lbr_flags;
++>>>>>>> bd0f889536f8 (perf evsel: Disable branch flags/cycles for --callgraph lbr)
  } perf_missing_features;
  
 -static clockid_t clockid;
 -
  static int perf_evsel__no_extra_init(struct perf_evsel *evsel __maybe_unused)
  {
  	return 0;
* Unmerged path tools/perf/util/evsel.c
