staging/rdma/hfi1: Consolidate dma ops for hfi1

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
Rebuild_CHGLOG: - [infiniband] rdma/hfi1: Consolidate dma ops for hfi1 (Alex Estrin) [1272062 1273170]
Rebuild_FUZZ: 90.70%
commit-author Ira Weiny <ira.weiny@intel.com>
commit f326674ae374e08b34d8b02b2357bad4ef07317c
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/f326674a.failed

Remove the dma.c file from hfi1 in favor of using that which is
present in rdmavt.

	Reviewed-by: Ira Weiny <ira.weiny@intel.com>
	Reviewed-by: Mike Marciniszyn <mike.marciniszyn@intel.com>
	Signed-off-by: Dennis Dalessandro <dennis.dalessandro@intel.com>
	Signed-off-by: Doug Ledford <dledford@redhat.com>
(cherry picked from commit f326674ae374e08b34d8b02b2357bad4ef07317c)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/staging/hfi1/Makefile
diff --cc drivers/staging/hfi1/Makefile
index 2e5daa6cdcc2,69fb10f6a111..000000000000
--- a/drivers/staging/hfi1/Makefile
+++ b/drivers/staging/hfi1/Makefile
@@@ -7,10 -7,10 +7,14 @@@
  #
  obj-$(CONFIG_INFINIBAND_HFI1) += hfi1.o
  
++<<<<<<< HEAD:drivers/staging/hfi1/Makefile
 +hfi1-y := chip.o cq.o device.o diag.o dma.o driver.o eprom.o file_ops.o firmware.o \
++=======
+ hfi1-y := chip.o cq.o device.o diag.o driver.o efivar.o eprom.o file_ops.o firmware.o \
++>>>>>>> f326674ae374 (staging/rdma/hfi1: Consolidate dma ops for hfi1):drivers/staging/rdma/hfi1/Makefile
  	init.o intr.o keys.o mad.o mmap.o mr.o pcie.o pio.o pio_copy.o \
  	qp.o qsfp.o rc.o ruc.o sdma.o srq.o sysfs.o trace.o twsi.o \
 -	uc.o ud.o user_exp_rcv.o user_pages.o user_sdma.o verbs_mcast.o verbs.o
 +	uc.o ud.o user_pages.o user_sdma.o verbs_mcast.o verbs.o
  hfi1-$(CONFIG_DEBUG_FS) += debugfs.o
  
  CFLAGS_trace.o = -I$(src)
* Unmerged path drivers/staging/hfi1/Makefile
diff --git a/drivers/staging/hfi1/verbs.c b/drivers/staging/hfi1/verbs.c
index 67c96cad7dd5..8b75522d1b8c 100644
--- a/drivers/staging/hfi1/verbs.c
+++ b/drivers/staging/hfi1/verbs.c
@@ -2054,7 +2054,7 @@ int hfi1_register_ib_device(struct hfi1_devdata *dd)
 	ibdev->detach_mcast = hfi1_multicast_detach;
 	ibdev->process_mad = hfi1_process_mad;
 	ibdev->mmap = hfi1_mmap;
-	ibdev->dma_ops = &hfi1_dma_mapping_ops;
+	ibdev->dma_ops = NULL;
 	ibdev->get_port_immutable = port_immutable;
 
 	strncpy(ibdev->node_desc, init_utsname()->nodename,
diff --git a/drivers/staging/hfi1/verbs.h b/drivers/staging/hfi1/verbs.h
index 88bfa8068863..e05da68c4d57 100644
--- a/drivers/staging/hfi1/verbs.h
+++ b/drivers/staging/hfi1/verbs.h
@@ -1153,6 +1153,4 @@ extern unsigned int hfi1_max_srq_wrs;
 
 extern const u32 ib_hfi1_rnr_table[];
 
-extern struct ib_dma_mapping_ops hfi1_dma_mapping_ops;
-
 #endif                          /* HFI1_VERBS_H */
