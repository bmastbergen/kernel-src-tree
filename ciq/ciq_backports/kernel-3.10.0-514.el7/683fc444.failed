hpsa: abandon rescans on memory alloaction failures.

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
Rebuild_CHGLOG: - [scsi] hpsa: abandon rescans on memory alloaction failures (Joseph Szczypek) [1274467]
Rebuild_FUZZ: 99.03%
commit-author Don Brace <don.brace@pmcs.com>
commit 683fc444697a388f17cbc3bd7e64191ce000b6b4
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/683fc444.failed

Abandon and reschedule rescan process only if device inquiries
fail due to mem alloc failures, which are likely to occur for
all devices.

Otherwise, skip device if inquiry fails for other reasons,
and continue rescanning process for other devices.

	Reviewed-by: Scott Teel <scott.teel@pmcs.com>
	Reviewed-by: Justin Lindley <justin.lindley@pmcs.com>
	Reviewed-by: Kevin Barnett <kevin.barnett@pmcs.com>
	Reviewed-by: Tomas Henzl <thenzl@redhat.com>
	Signed-off-by: Don Brace <don.brace@pmcs.com>
	Reviewed-by: Hannes Reinecke <hare@suse.de>
	Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
(cherry picked from commit 683fc444697a388f17cbc3bd7e64191ce000b6b4)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/scsi/hpsa.c
diff --cc drivers/scsi/hpsa.c
index 3c91d6ef5eb9,ce0341a178fd..000000000000
--- a/drivers/scsi/hpsa.c
+++ b/drivers/scsi/hpsa.c
@@@ -3757,9 -3811,20 +3762,26 @@@ static void hpsa_update_scsi_devices(st
  				continue;
  
  		/* Get device type, vendor, model, device id */
++<<<<<<< HEAD
 +		if (hpsa_update_device_info(h, lunaddrbytes, tmpdevice,
 +							&is_OBDR))
 +			continue; /* skip it if we can't talk to it. */
++=======
+ 		rc = hpsa_update_device_info(h, lunaddrbytes, tmpdevice,
+ 							&is_OBDR);
+ 		if (rc == -ENOMEM) {
+ 			dev_warn(&h->pdev->dev,
+ 				"Out of memory, rescan deferred.\n");
+ 			h->drv_req_rescan = 1;
+ 			goto out;
+ 		}
+ 		if (rc) {
+ 			dev_warn(&h->pdev->dev,
+ 				"Inquiry failed, skipping device.\n");
+ 			continue;
+ 		}
+ 
++>>>>>>> 683fc444697a (hpsa: abandon rescans on memory alloaction failures.)
  		figure_bus_target_lun(h, lunaddrbytes, tmpdevice);
  		hpsa_update_device_supports_aborts(h, tmpdevice, lunaddrbytes);
  		this_device = currentsd[ncurrent];
* Unmerged path drivers/scsi/hpsa.c
