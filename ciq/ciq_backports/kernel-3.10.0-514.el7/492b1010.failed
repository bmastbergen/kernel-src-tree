perf hists browser: Support collapsing/expanding whole entries in hierarchy

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
commit-author Namhyung Kim <namhyung@kernel.org>
commit 492b1010606e9222690992ad8e4898a88a696856
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/492b1010.failed

The 'C' and 'E' keys are to collapse/expand all hist entries.  Update
nr_hierarchy_entries properly in this case.

	Signed-off-by: Namhyung Kim <namhyung@kernel.org>
	Acked-by: Pekka Enberg <penberg@kernel.org>
	Cc: Andi Kleen <andi@firstfloor.org>
	Cc: David Ahern <dsahern@gmail.com>
	Cc: Jiri Olsa <jolsa@kernel.org>
	Cc: Peter Zijlstra <peterz@infradead.org>
	Cc: Stephane Eranian <eranian@google.com>
	Cc: Wang Nan <wangnan0@huawei.com>
Link: http://lkml.kernel.org/r/1456326830-30456-13-git-send-email-namhyung@kernel.org
	Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>
(cherry picked from commit 492b1010606e9222690992ad8e4898a88a696856)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	tools/perf/ui/browsers/hists.c
diff --cc tools/perf/ui/browsers/hists.c
index 0489502d0db6,857b9beb0aab..000000000000
--- a/tools/perf/ui/browsers/hists.c
+++ b/tools/perf/ui/browsers/hists.c
@@@ -2047,6 -2139,42 +2085,45 @@@ static void hist_browser__update_nr_ent
  	hb->nr_hierarchy_entries = nr_entries;
  }
  
++<<<<<<< HEAD
++=======
+ static void hist_browser__update_percent_limit(struct hist_browser *hb,
+ 					       double percent)
+ {
+ 	struct hist_entry *he;
+ 	struct rb_node *nd = rb_first(&hb->hists->entries);
+ 	u64 total = hists__total_period(hb->hists);
+ 	u64 min_callchain_hits = total * (percent / 100);
+ 
+ 	hb->min_pcnt = callchain_param.min_percent = percent;
+ 
+ 	if (!symbol_conf.use_callchain)
+ 		return;
+ 
+ 	while ((nd = hists__filter_entries(nd, hb->min_pcnt)) != NULL) {
+ 		he = rb_entry(nd, struct hist_entry, rb_node);
+ 
+ 		if (callchain_param.mode == CHAIN_GRAPH_REL) {
+ 			total = he->stat.period;
+ 
+ 			if (symbol_conf.cumulate_callchain)
+ 				total = he->stat_acc->period;
+ 
+ 			min_callchain_hits = total * (percent / 100);
+ 		}
+ 
+ 		callchain_param.sort(&he->sorted_chain, he->callchain,
+ 				     min_callchain_hits, &callchain_param);
+ 
+ 		/* force to re-evaluate folding state of callchains */
+ 		he->init_have_children = false;
+ 		hist_entry__set_folding(he, hb, false);
+ 
+ 		nd = rb_next(nd);
+ 	}
+ }
+ 
++>>>>>>> 492b1010606e (perf hists browser: Support collapsing/expanding whole entries in hierarchy)
  static int perf_evsel__hists_browse(struct perf_evsel *evsel, int nr_events,
  				    const char *helpline,
  				    bool left_exits,
* Unmerged path tools/perf/ui/browsers/hists.c
