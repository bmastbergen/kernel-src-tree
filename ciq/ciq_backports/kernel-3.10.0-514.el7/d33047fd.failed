powerpc/powernv: Fix early pci_controller_ops loading.

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
Rebuild_CHGLOG: - [powerpc] powernv: Fix early pci_controller_ops loading (Gustavo Duarte) [1275657]
Rebuild_FUZZ: 90.91%
commit-author Daniel Axtens <dja@axtens.net>
commit d33047fd7e7d93662622888681861ba84d43c506
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/d33047fd.failed

Load the PowerNV platform pci controller ops into pci controllers
after all the operations are loaded into the platform ops struct, not
before.

Otherwise we aren't actually setting the ops properly which can break
IO for some devices.

Fixes: 65ebf4b63 ("powerpc/powernv: Move controller ops from ppc_md to controller_ops")
	Reported-by: Gavin Shan <gwshan@linux.vnet.ibm.com>
	Reviewed-by: Gavin Shan <gwshan@linux.vnet.ibm.com>
	Signed-off-by: Daniel Axtens <dja@axtens.net>
	Signed-off-by: Michael Ellerman <mpe@ellerman.id.au>
(cherry picked from commit d33047fd7e7d93662622888681861ba84d43c506)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/powerpc/platforms/powernv/pci-ioda.c
diff --cc arch/powerpc/platforms/powernv/pci-ioda.c
index fe5c4ee44e89,f8bc950efcae..000000000000
--- a/arch/powerpc/platforms/powernv/pci-ioda.c
+++ b/arch/powerpc/platforms/powernv/pci-ioda.c
@@@ -3045,12 -2808,16 +3045,20 @@@ void __init pnv_pci_init_ioda_phb(struc
  	 * the child P2P bridges) can form individual PE.
  	 */
  	ppc_md.pcibios_fixup = pnv_pci_ioda_fixup;
++<<<<<<< HEAD
 +	ppc_md.pcibios_enable_device_hook = pnv_pci_enable_device_hook;
 +	ppc_md.pcibios_window_alignment = pnv_pci_window_alignment;
 +	ppc_md.pcibios_reset_secondary_bus = pnv_pci_reset_secondary_bus;
++=======
+ 	pnv_pci_controller_ops.enable_device_hook = pnv_pci_enable_device_hook;
+ 	pnv_pci_controller_ops.window_alignment = pnv_pci_window_alignment;
+ 	pnv_pci_controller_ops.reset_secondary_bus = pnv_pci_reset_secondary_bus;
+ 	hose->controller_ops = pnv_pci_controller_ops;
+ 
++>>>>>>> d33047fd7e7d (powerpc/powernv: Fix early pci_controller_ops loading.)
  #ifdef CONFIG_PCI_IOV
  	ppc_md.pcibios_fixup_sriov = pnv_pci_ioda_fixup_iov_resources;
 -	ppc_md.pcibios_iov_resource_alignment = pnv_pci_iov_resource_alignment;
 -#endif
 -
 +#endif /* CONFIG_PCI_IOV */
  	pci_add_flags(PCI_REASSIGN_ALL_RSRC);
  
  	/* Reset IODA tables to a clean state */
* Unmerged path arch/powerpc/platforms/powernv/pci-ioda.c
