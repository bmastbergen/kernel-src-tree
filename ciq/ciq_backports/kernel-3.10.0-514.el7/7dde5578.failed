tty: Add support for PCIe WCH382 2S multi-IO card

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
Rebuild_CHGLOG: - [tty] Add support for PCIe WCH382 2S multi-IO card (Jeremy McNicoll) [1309575]
Rebuild_FUZZ: 94.62%
commit-author Jeremy McNicoll <jmcnicol@redhat.com>
commit 7dde55787b43a8f2b4021916db38d90c03a2ec64
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/7dde5578.failed

WCH382 2S board is a PCIe card with 2 DB9 COM ports detected as
Serial controller: Device 1c00:3253 (rev 10) (prog-if 05 [16850])

	Signed-off-by: Jeremy McNicoll <jmcnicol@redhat.com>
	Cc: stable <stable@vger.kernel.org>
	Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
(cherry picked from commit 7dde55787b43a8f2b4021916db38d90c03a2ec64)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/tty/serial/8250/8250_pci.c
diff --cc drivers/tty/serial/8250/8250_pci.c
index c52948b368d8,7cd6f9a90542..000000000000
--- a/drivers/tty/serial/8250/8250_pci.c
+++ b/drivers/tty/serial/8250/8250_pci.c
@@@ -1569,6 -1938,16 +1569,19 @@@ pci_wch_ch353_setup(struct serial_priva
  #define PCI_VENDOR_ID_SUNIX		0x1fd4
  #define PCI_DEVICE_ID_SUNIX_1999	0x1999
  
++<<<<<<< HEAD
++=======
+ #define PCIE_VENDOR_ID_WCH		0x1c00
+ #define PCIE_DEVICE_ID_WCH_CH382_2S1P	0x3250
+ #define PCIE_DEVICE_ID_WCH_CH384_4S	0x3470
+ #define PCIE_DEVICE_ID_WCH_CH382_2S	0x3253
+ 
+ #define PCI_VENDOR_ID_PERICOM			0x12D8
+ #define PCI_DEVICE_ID_PERICOM_PI7C9X7951	0x7951
+ #define PCI_DEVICE_ID_PERICOM_PI7C9X7952	0x7952
+ #define PCI_DEVICE_ID_PERICOM_PI7C9X7954	0x7954
+ #define PCI_DEVICE_ID_PERICOM_PI7C9X7958	0x7958
++>>>>>>> 7dde55787b43 (tty: Add support for PCIe WCH382 2S multi-IO card)
  
  /* Unknown vendors/cards - this should not be in linux/pci_ids.h */
  #define PCI_SUBDEVICE_ID_UNKNOWN_0x1584	0x1584
@@@ -2181,6 -2638,30 +2194,33 @@@ static struct pci_serial_quirk pci_seri
  		.subdevice	= PCI_ANY_ID,
  		.setup		= pci_wch_ch353_setup,
  	},
++<<<<<<< HEAD
++=======
+ 	/* WCH CH382 2S card (16850 clone) */
+ 	{
+ 		.vendor         = PCIE_VENDOR_ID_WCH,
+ 		.device         = PCIE_DEVICE_ID_WCH_CH382_2S,
+ 		.subvendor      = PCI_ANY_ID,
+ 		.subdevice      = PCI_ANY_ID,
+ 		.setup          = pci_wch_ch38x_setup,
+ 	},
+ 	/* WCH CH382 2S1P card (16850 clone) */
+ 	{
+ 		.vendor         = PCIE_VENDOR_ID_WCH,
+ 		.device         = PCIE_DEVICE_ID_WCH_CH382_2S1P,
+ 		.subvendor      = PCI_ANY_ID,
+ 		.subdevice      = PCI_ANY_ID,
+ 		.setup          = pci_wch_ch38x_setup,
+ 	},
+ 	/* WCH CH384 4S card (16850 clone) */
+ 	{
+ 		.vendor         = PCIE_VENDOR_ID_WCH,
+ 		.device         = PCIE_DEVICE_ID_WCH_CH384_4S,
+ 		.subvendor      = PCI_ANY_ID,
+ 		.subdevice      = PCI_ANY_ID,
+ 		.setup          = pci_wch_ch38x_setup,
+ 	},
++>>>>>>> 7dde55787b43 (tty: Add support for PCIe WCH382 2S multi-IO card)
  	/*
  	 * ASIX devices with FIFO bug
  	 */
@@@ -2451,6 -2959,17 +2491,18 @@@ enum pci_board_num_t 
  	pbn_omegapci,
  	pbn_NETMOS9900_2s_115200,
  	pbn_brcm_trumanage,
++<<<<<<< HEAD
++=======
+ 	pbn_fintek_4,
+ 	pbn_fintek_8,
+ 	pbn_fintek_12,
+ 	pbn_wch382_2,
+ 	pbn_wch384_4,
+ 	pbn_pericom_PI7C9X7951,
+ 	pbn_pericom_PI7C9X7952,
+ 	pbn_pericom_PI7C9X7954,
+ 	pbn_pericom_PI7C9X7958,
++>>>>>>> 7dde55787b43 (tty: Add support for PCIe WCH382 2S multi-IO card)
  };
  
  /*
@@@ -3201,6 -3767,65 +3253,68 @@@ static struct pciserial_board pci_board
  		.reg_shift	= 2,
  		.base_baud	= 115200,
  	},
++<<<<<<< HEAD
++=======
+ 	[pbn_fintek_4] = {
+ 		.num_ports	= 4,
+ 		.uart_offset	= 8,
+ 		.base_baud	= 115200,
+ 		.first_offset	= 0x40,
+ 	},
+ 	[pbn_fintek_8] = {
+ 		.num_ports	= 8,
+ 		.uart_offset	= 8,
+ 		.base_baud	= 115200,
+ 		.first_offset	= 0x40,
+ 	},
+ 	[pbn_fintek_12] = {
+ 		.num_ports	= 12,
+ 		.uart_offset	= 8,
+ 		.base_baud	= 115200,
+ 		.first_offset	= 0x40,
+ 	},
+ 	[pbn_wch382_2] = {
+ 		.flags		= FL_BASE0,
+ 		.num_ports	= 2,
+ 		.base_baud	= 115200,
+ 		.uart_offset	= 8,
+ 		.first_offset	= 0xC0,
+ 	},
+ 	[pbn_wch384_4] = {
+ 		.flags		= FL_BASE0,
+ 		.num_ports	= 4,
+ 		.base_baud      = 115200,
+ 		.uart_offset    = 8,
+ 		.first_offset   = 0xC0,
+ 	},
+ 	/*
+ 	 * Pericom PI7C9X795[1248] Uno/Dual/Quad/Octal UART
+ 	 */
+ 	[pbn_pericom_PI7C9X7951] = {
+ 		.flags          = FL_BASE0,
+ 		.num_ports      = 1,
+ 		.base_baud      = 921600,
+ 		.uart_offset	= 0x8,
+ 	},
+ 	[pbn_pericom_PI7C9X7952] = {
+ 		.flags          = FL_BASE0,
+ 		.num_ports      = 2,
+ 		.base_baud      = 921600,
+ 		.uart_offset	= 0x8,
+ 	},
+ 	[pbn_pericom_PI7C9X7954] = {
+ 		.flags          = FL_BASE0,
+ 		.num_ports      = 4,
+ 		.base_baud      = 921600,
+ 		.uart_offset	= 0x8,
+ 	},
+ 	[pbn_pericom_PI7C9X7958] = {
+ 		.flags          = FL_BASE0,
+ 		.num_ports      = 8,
+ 		.base_baud      = 921600,
+ 		.uart_offset	= 0x8,
+ 	},
++>>>>>>> 7dde55787b43 (tty: Add support for PCIe WCH382 2S multi-IO card)
  };
  
  static const struct pci_device_id blacklist[] = {
@@@ -4875,9 -5591,13 +4989,17 @@@ static struct pci_device_id serial_pci_
  		PCI_ANY_ID, PCI_ANY_ID,
  		0, 0, pbn_b0_bt_2_115200 },
  
++<<<<<<< HEAD
 +	{	PCI_VENDOR_ID_WCH, PCI_DEVICE_ID_WCH_CH352_2S,
++=======
+ 	{	PCIE_VENDOR_ID_WCH, PCIE_DEVICE_ID_WCH_CH382_2S,
+ 		PCI_ANY_ID, PCI_ANY_ID,
+ 		0, 0, pbn_wch382_2 },
+ 
+ 	{	PCIE_VENDOR_ID_WCH, PCIE_DEVICE_ID_WCH_CH384_4S,
++>>>>>>> 7dde55787b43 (tty: Add support for PCIe WCH382 2S multi-IO card)
  		PCI_ANY_ID, PCI_ANY_ID,
 -		0, 0, pbn_wch384_4 },
 +		0, 0, pbn_b0_bt_2_115200 },
  
  	/*
  	 * Commtech, Inc. Fastcom adapters
* Unmerged path drivers/tty/serial/8250/8250_pci.c
