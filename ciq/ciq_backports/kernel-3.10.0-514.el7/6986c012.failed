ovl: cleanup unused var in rename2

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
commit-author Miklos Szeredi <mszeredi@redhat.com>
commit 6986c012faa480fb0fda74eaae9abb22f7ad1004
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/6986c012.failed

	Signed-off-by: Miklos Szeredi <mszeredi@redhat.com>
(cherry picked from commit 6986c012faa480fb0fda74eaae9abb22f7ad1004)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	fs/overlayfs/dir.c
diff --cc fs/overlayfs/dir.c
index f36099264ab2,b3fc0a35bf62..000000000000
--- a/fs/overlayfs/dir.c
+++ b/fs/overlayfs/dir.c
@@@ -713,10 -719,9 +713,9 @@@ static int ovl_rename2(struct inode *ol
  	struct dentry *trap;
  	bool old_opaque;
  	bool new_opaque;
- 	bool new_create = false;
  	bool cleanup_whiteout = false;
  	bool overwrite = !(flags & RENAME_EXCHANGE);
 -	bool is_dir = d_is_dir(old);
 +	bool is_dir = S_ISDIR(old->d_inode->i_mode);
  	bool new_is_dir = false;
  	struct dentry *opaquedir = NULL;
  	const struct cred *old_cred = NULL;
@@@ -839,29 -844,38 +838,35 @@@
  
  	trap = lock_rename(new_upperdir, old_upperdir);
  
 -
 -	olddentry = lookup_one_len(old->d_name.name, old_upperdir,
 -				   old->d_name.len);
 -	err = PTR_ERR(olddentry);
 -	if (IS_ERR(olddentry))
 -		goto out_unlock;
 -
 -	err = -ESTALE;
 -	if (olddentry != ovl_dentry_upper(old))
 -		goto out_dput_old;
 -
 -	newdentry = lookup_one_len(new->d_name.name, new_upperdir,
 -				   new->d_name.len);
 -	err = PTR_ERR(newdentry);
 -	if (IS_ERR(newdentry))
 -		goto out_dput_old;
 -
 -	err = -ESTALE;
 -	if (ovl_dentry_upper(new)) {
 +	olddentry = ovl_dentry_upper(old);
 +	newdentry = ovl_dentry_upper(new);
 +	if (newdentry) {
  		if (opaquedir) {
 -			if (newdentry != opaquedir)
 -				goto out_dput;
 +			newdentry = opaquedir;
 +			opaquedir = NULL;
  		} else {
 -			if (newdentry != ovl_dentry_upper(new))
 -				goto out_dput;
 +			dget(newdentry);
  		}
  	} else {
++<<<<<<< HEAD
 +		new_create = true;
 +		newdentry = lookup_one_len(new->d_name.name, new_upperdir,
 +					   new->d_name.len);
 +		err = PTR_ERR(newdentry);
 +		if (IS_ERR(newdentry))
 +			goto out_unlock;
++=======
+ 		if (!d_is_negative(newdentry) &&
+ 		    (!new_opaque || !ovl_is_whiteout(newdentry)))
+ 			goto out_dput;
++>>>>>>> 6986c012faa4 (ovl: cleanup unused var in rename2)
  	}
  
 +	err = -ESTALE;
 +	if (olddentry->d_parent != old_upperdir)
 +		goto out_dput;
 +	if (newdentry->d_parent != new_upperdir)
 +		goto out_dput;
  	if (olddentry == trap)
  		goto out_dput;
  	if (newdentry == trap)
* Unmerged path fs/overlayfs/dir.c
