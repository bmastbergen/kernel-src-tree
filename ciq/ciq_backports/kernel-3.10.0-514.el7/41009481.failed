ovs/geneve: fix rtnl notifications on iface deletion

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
Rebuild_CHGLOG: - [net] openvswitch: geneve: fix rtnl notifications on iface deletion (Eric Garver) [1297476]
Rebuild_FUZZ: 90.27%
commit-author Nicolas Dichtel <nicolas.dichtel@6wind.com>
commit 41009481b690493c169ce85f591b9d32c6fd9422
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/41009481.failed

The function geneve_dev_create_fb() (only used by ovs) never calls
rtnl_configure_link(). The consequence is that dev->rtnl_link_state is
never set to RTNL_LINK_INITIALIZED.
During the deletion phase, the function rollback_registered_many() sends
a RTM_DELLINK only if dev->rtnl_link_state is set to RTNL_LINK_INITIALIZED.

Fixes: e305ac6cf5a1 ("geneve: Add support to collect tunnel metadata.")
CC: Pravin B Shelar <pshelar@nicira.com>
CC: Jesse Gross <jesse@nicira.com>
CC: Thomas Graf <tgraf@suug.ch>
	Signed-off-by: Nicolas Dichtel <nicolas.dichtel@6wind.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 41009481b690493c169ce85f591b9d32c6fd9422)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/geneve.c
diff --cc drivers/net/geneve.c
index d82906728571,305a04e45a13..000000000000
--- a/drivers/net/geneve.c
+++ b/drivers/net/geneve.c
@@@ -1010,7 -1524,24 +1010,22 @@@ struct net_device *geneve_dev_create_fb
  		free_netdev(dev);
  		return ERR_PTR(err);
  	}
++<<<<<<< HEAD
++=======
+ 
+ 	/* openvswitch users expect packet sizes to be unrestricted,
+ 	 * so set the largest MTU we can.
+ 	 */
+ 	err = __geneve_change_mtu(dev, IP_MAX_MTU, false);
+ 	if (err)
+ 		goto err;
+ 
+ 	err = rtnl_configure_link(dev, NULL);
+ 	if (err < 0)
+ 		goto err;
+ 
++>>>>>>> 41009481b690 (ovs/geneve: fix rtnl notifications on iface deletion)
  	return dev;
 -
 - err:
 -	geneve_dellink(dev, &list_kill);
 -	unregister_netdevice_many(&list_kill);
 -	return ERR_PTR(err);
  }
  EXPORT_SYMBOL_GPL(geneve_dev_create_fb);
  
* Unmerged path drivers/net/geneve.c
