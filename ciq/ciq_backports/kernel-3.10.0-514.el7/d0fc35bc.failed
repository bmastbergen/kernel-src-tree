usb: fsl: drop USB_FSL_MPH_DR_OF Kconfig symbol

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
Rebuild_CHGLOG: - [usb] fsl: drop USB_FSL_MPH_DR_OF Kconfig symbol (Torez Smith) [1332712]
Rebuild_FUZZ: 94.38%
commit-author Arnd Bergmann <arnd@arndb.de>
commit d0fc35bc0889c7157527ed5758f54101ec015839
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/d0fc35bc.failed

The USB_FSL_MPH_DR_OF symbol is used to ensure the code that interprets
the DR device node is built whenever one of the two drivers (EHCI or
UDC) for the platform is enabled. However, if CONFIG_USB is disabled
and we only support gadget mode, this causes a Kconfig warning:

warning: (USB_FSL_USB2) selects USB_FSL_MPH_DR_OF which has unmet direct dependencies (USB_SUPPORT && USB)

We can avoid this warning by simply no longer using the symbol,
and making sure we enter the drivers/usb/host/ directory when
the UDC driver is enabled that needs the file, and then we use
Makefile syntax to ensure the file is built-in if needed.

There is currently a dependency on CONFIG_OF, but this is redundant,
as we already know that this is set unconditionally for the platforms
that use this driver.

	Signed-off-by: Arnd Bergmann <arnd@arndb.de>
	Signed-off-by: Felipe Balbi <balbi@kernel.org>
(cherry picked from commit d0fc35bc0889c7157527ed5758f54101ec015839)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/usb/Makefile
#	drivers/usb/gadget/udc/Kconfig
#	drivers/usb/host/Makefile
diff --cc drivers/usb/Makefile
index 6ce2450e5a1c,dca78565eb55..000000000000
--- a/drivers/usb/Makefile
+++ b/drivers/usb/Makefile
@@@ -23,10 -25,8 +23,14 @@@ obj-$(CONFIG_USB_ISP1362_HCD)	+= host
  obj-$(CONFIG_USB_U132_HCD)	+= host/
  obj-$(CONFIG_USB_R8A66597_HCD)	+= host/
  obj-$(CONFIG_USB_HWA_HCD)	+= host/
 +obj-$(CONFIG_USB_ISP1760_HCD)	+= host/
  obj-$(CONFIG_USB_IMX21_HCD)	+= host/
++<<<<<<< HEAD
 +obj-$(CONFIG_USB_FSL_MPH_DR_OF)	+= host/
 +obj-$(CONFIG_USB_FUSBH200_HCD)	+= host/
++=======
+ obj-$(CONFIG_USB_FSL_USB2)	+= host/
++>>>>>>> d0fc35bc0889 (usb: fsl: drop USB_FSL_MPH_DR_OF Kconfig symbol)
  obj-$(CONFIG_USB_FOTG210_HCD)	+= host/
  obj-$(CONFIG_USB_MAX3421_HCD)	+= host/
  
diff --cc drivers/usb/host/Makefile
index 42746dd0ec8d,a9ddd3c9ec94..000000000000
--- a/drivers/usb/host/Makefile
+++ b/drivers/usb/host/Makefile
@@@ -53,14 -72,12 +53,20 @@@ obj-$(CONFIG_USB_SL811_HCD)	+= sl811-hc
  obj-$(CONFIG_USB_SL811_CS)	+= sl811_cs.o
  obj-$(CONFIG_USB_U132_HCD)	+= u132-hcd.o
  obj-$(CONFIG_USB_R8A66597_HCD)	+= r8a66597-hcd.o
 +obj-$(CONFIG_USB_ISP1760_HCD)	+= isp1760.o
  obj-$(CONFIG_USB_HWA_HCD)	+= hwa-hc.o
  obj-$(CONFIG_USB_IMX21_HCD)	+= imx21-hcd.o
++<<<<<<< HEAD
 +obj-$(CONFIG_USB_FSL_MPH_DR_OF)	+= fsl-mph-dr-of.o
 +obj-$(CONFIG_USB_OCTEON2_COMMON) += octeon2-common.o
++=======
+ obj-$(CONFIG_USB_FSL_USB2)	+= fsl-mph-dr-of.o
+ obj-$(CONFIG_USB_EHCI_FSL)	+= fsl-mph-dr-of.o
+ obj-$(CONFIG_USB_EHCI_FSL)	+= ehci-fsl.o
++>>>>>>> d0fc35bc0889 (usb: fsl: drop USB_FSL_MPH_DR_OF Kconfig symbol)
  obj-$(CONFIG_USB_HCD_BCMA)	+= bcma-hcd.o
  obj-$(CONFIG_USB_HCD_SSB)	+= ssb-hcd.o
 +obj-$(CONFIG_USB_FUSBH200_HCD)	+= fusbh200-hcd.o
  obj-$(CONFIG_USB_FOTG210_HCD)	+= fotg210-hcd.o
  obj-$(CONFIG_USB_MAX3421_HCD)	+= max3421-hcd.o
 +obj-$(CONFIG_USB_HCD_ST)	+= ehci-st.o ohci-st.o
* Unmerged path drivers/usb/gadget/udc/Kconfig
* Unmerged path drivers/usb/Makefile
* Unmerged path drivers/usb/gadget/udc/Kconfig
diff --git a/drivers/usb/host/Kconfig b/drivers/usb/host/Kconfig
index 174f845a82e2..c51b308827b4 100644
--- a/drivers/usb/host/Kconfig
+++ b/drivers/usb/host/Kconfig
@@ -99,9 +99,6 @@ config USB_EHCI_TT_NEWSCHED
 
 	  If unsure, say Y.
 
-config USB_FSL_MPH_DR_OF
-	tristate
-
 if USB_EHCI_HCD
 
 config USB_EHCI_PCI
@@ -134,7 +131,6 @@ config USB_EHCI_FSL
 	bool "Support for Freescale PPC on-chip EHCI USB controller"
 	depends on FSL_SOC
 	select USB_EHCI_ROOT_HUB_TT
-	select USB_FSL_MPH_DR_OF if OF
 	---help---
 	  Variation of ARC USB block used in some Freescale chips.
 
* Unmerged path drivers/usb/host/Makefile
