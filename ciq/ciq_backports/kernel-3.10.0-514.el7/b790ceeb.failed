thinkpad_acpi: Add adaptive_kbd_mode sysfs attr

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
commit-author Bastien Nocera <hadess@hadess.net>
commit b790ceeb0fd94725150219abd8c13b08a17a32e3
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/b790ceeb.failed

Add a sysfs attribute to allow privileged users to change the keyboard
mode. This could be used by desktop environments to change the keyboard
mode depending on the application focused, as the Windows application
does.

	Signed-off-by: Bastien Nocera <hadess@hadess.net>
	Acked-by: Henrique de Moraes Holschuh <hmh@hmh.eng.br>
	Signed-off-by: Darren Hart <dvhart@linux.intel.com>
(cherry picked from commit b790ceeb0fd94725150219abd8c13b08a17a32e3)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/platform/x86/thinkpad_acpi.c
diff --cc drivers/platform/x86/thinkpad_acpi.c
index b6eaecd5fa76,ae528cf0b143..000000000000
--- a/drivers/platform/x86/thinkpad_acpi.c
+++ b/drivers/platform/x86/thinkpad_acpi.c
@@@ -3466,9 -3503,12 +3522,12 @@@ static int __init hotkey_init(struct ib
  
  err_exit:
  	delete_attr_set(hotkey_dev_attributes, &tpacpi_pdev->dev.kobj);
+ 	sysfs_remove_group(&tpacpi_pdev->dev.kobj,
+ 			&adaptive_kbd_attr_group);
+ 
  	hotkey_dev_attributes = NULL;
  
 -	return (res < 0) ? res : 1;
 +	return (res < 0)? res : 1;
  }
  
  /* Thinkpad X1 Carbon support 5 modes including Home mode, Web browser
@@@ -3478,15 -3518,7 +3537,19 @@@
   * Will consider support rest of modes in future.
   *
   */
++<<<<<<< HEAD
 +enum ADAPTIVE_KEY_MODE {
 +	HOME_MODE,
 +	WEB_BROWSER_MODE,
 +	WEB_CONFERENCE_MODE,
 +	FUNCTION_MODE,
 +	LAYFLAT_MODE
 +};
 +
 +const int adaptive_keyboard_modes[] = {
++=======
+ static const int adaptive_keyboard_modes[] = {
++>>>>>>> b790ceeb0fd9 (thinkpad_acpi: Add adaptive_kbd_mode sysfs attr)
  	HOME_MODE,
  /*	WEB_BROWSER_MODE = 2,
  	WEB_CONFERENCE_MODE = 3, */
diff --git a/Documentation/laptops/thinkpad-acpi.txt b/Documentation/laptops/thinkpad-acpi.txt
index e41140879443..8bab5fe125f5 100644
--- a/Documentation/laptops/thinkpad-acpi.txt
+++ b/Documentation/laptops/thinkpad-acpi.txt
@@ -1416,6 +1416,24 @@ Sysfs notes:
 	rfkill controller switch "tpacpi_uwb_sw": refer to
 	Documentation/rfkill.txt for details.
 
+Adaptive keyboard
+-----------------
+
+sysfs device attribute: adaptive_kbd_mode
+
+This sysfs attribute controls the keyboard "face" that will be shown on the
+Lenovo X1 Carbon 2nd gen (2014)'s adaptive keyboard. The value can be read
+and set.
+
+1 = Home mode
+2 = Web-browser mode
+3 = Web-conference mode
+4 = Function mode
+5 = Layflat mode
+
+For more details about which buttons will appear depending on the mode, please
+review the laptop's user guide:
+http://www.lenovo.com/shop/americas/content/user_guides/x1carbon_2_ug_en.pdf
 
 Multiple Commands, Module Parameters
 ------------------------------------
* Unmerged path drivers/platform/x86/thinkpad_acpi.c
