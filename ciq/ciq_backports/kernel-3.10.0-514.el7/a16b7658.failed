drm/i915: Call intel_dp_mst_resume() before resuming displays

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
Rebuild_CHGLOG: - [drm] i915: Call intel_dp_mst_resume() before resuming displays (Rob Clark) [1072036 1115530 1202702 1211398 1272159 1329087]
Rebuild_FUZZ: 96.61%
commit-author Lyude <cpaul@redhat.com>
commit a16b7658f4e0d4aec9bc3e75a5f0cc3f7a3a0422
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/a16b7658.failed

Since we need MST devices ready before we try to resume displays,
calling this after intel_display_resume() can result in some issues with
various laptop docks where the monitor won't turn back on after
suspending the system.

This order was originally changed in

	commit e7d6f7d70829 ("drm/i915: resume MST after reading back hw state")

In order to fix some unclaimed register errors, however the actual cause
of those has since been fixed.

CC: stable@vger.kernel.org
	Signed-off-by: Lyude <cpaul@redhat.com>
[danvet: Resolve conflicts with locking changes.]
	Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>
(cherry picked from commit a16b7658f4e0d4aec9bc3e75a5f0cc3f7a3a0422)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/gpu/drm/i915/i915_drv.c
diff --cc drivers/gpu/drm/i915/i915_drv.c
index a19d2c71e205,f73b4f7b2d39..000000000000
--- a/drivers/gpu/drm/i915/i915_drv.c
+++ b/drivers/gpu/drm/i915/i915_drv.c
@@@ -723,12 -770,10 +723,17 @@@ static int i915_drm_resume(struct drm_d
  		dev_priv->display.hpd_irq_setup(dev);
  	spin_unlock_irq(&dev_priv->irq_lock);
  
++<<<<<<< HEAD
 +	drm_modeset_lock_all(dev);
 +	intel_modeset_setup_hw_state(dev, true);
 +	drm_modeset_unlock_all(dev);
 +
++=======
++>>>>>>> a16b7658f4e0 (drm/i915: Call intel_dp_mst_resume() before resuming displays)
  	intel_dp_mst_resume(dev);
  
+ 	intel_display_resume(dev);
+ 
  	/*
  	 * ... but also need to make sure that hotplug processing
  	 * doesn't cause havoc. Like in the driver load code we don't
* Unmerged path drivers/gpu/drm/i915/i915_drv.c
