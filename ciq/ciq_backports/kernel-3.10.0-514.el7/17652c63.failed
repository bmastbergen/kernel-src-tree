i40e: remove unused argument

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
commit-author Jesse Brandeburg <jesse.brandeburg@intel.com>
commit 17652c6336fdca0f48906f0a1d9b5ac77b29e5a7
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/17652c63.failed

With the final edition of the patches to remove sleeps from
the driver's entry points, the grab_rtnl argument is no
longer needed, so partially revert the commit that added it.

Change-ID: Ib9778476242586cc9e58b670f5f48d415cb59003
	Signed-off-by: Jesse Brandeburg <jesse.brandeburg@intel.com>
	Tested-by: Andrew Bowers <andrewx.bowers@intel.com>
	Signed-off-by: Jeff Kirsher <jeffrey.t.kirsher@intel.com>
(cherry picked from commit 17652c6336fdca0f48906f0a1d9b5ac77b29e5a7)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/intel/i40e/i40e_debugfs.c
#	drivers/net/ethernet/intel/i40e/i40e_main.c
#	drivers/net/ethernet/intel/i40e/i40e_virtchnl_pf.c
diff --cc drivers/net/ethernet/intel/i40e/i40e_debugfs.c
index 9f9d8422096a,10744a698d6f..000000000000
--- a/drivers/net/ethernet/intel/i40e/i40e_debugfs.c
+++ b/drivers/net/ethernet/intel/i40e/i40e_debugfs.c
@@@ -1145,8 -1135,10 +1145,13 @@@ static ssize_t i40e_dbg_command_write(s
  			goto command_write_done;
  		}
  
 -		spin_lock_bh(&vsi->mac_filter_list_lock);
  		f = i40e_add_filter(vsi, ma, vlan, false, false);
++<<<<<<< HEAD
 +		ret = i40e_sync_vsi_filters(vsi, true);
++=======
+ 		spin_unlock_bh(&vsi->mac_filter_list_lock);
+ 		ret = i40e_sync_vsi_filters(vsi);
++>>>>>>> 17652c6336fd (i40e: remove unused argument)
  		if (f && !ret)
  			dev_info(&pf->pdev->dev,
  				 "add macaddr: %pM vlan=%d added to VSI %d\n",
@@@ -1182,8 -1174,10 +1187,13 @@@
  			goto command_write_done;
  		}
  
 -		spin_lock_bh(&vsi->mac_filter_list_lock);
  		i40e_del_filter(vsi, ma, vlan, false, false);
++<<<<<<< HEAD
 +		ret = i40e_sync_vsi_filters(vsi, true);
++=======
+ 		spin_unlock_bh(&vsi->mac_filter_list_lock);
+ 		ret = i40e_sync_vsi_filters(vsi);
++>>>>>>> 17652c6336fd (i40e: remove unused argument)
  		if (!ret)
  			dev_info(&pf->pdev->dev,
  				 "del macaddr: %pM vlan=%d removed from VSI %d\n",
diff --cc drivers/net/ethernet/intel/i40e/i40e_main.c
index 57260c97109e,9e6268b4295a..000000000000
--- a/drivers/net/ethernet/intel/i40e/i40e_main.c
+++ b/drivers/net/ethernet/intel/i40e/i40e_main.c
@@@ -1773,9 -1864,10 +1772,9 @@@ static void i40e_set_rx_mode(struct net
   *
   * Returns 0 or error value
   **/
- int i40e_sync_vsi_filters(struct i40e_vsi *vsi, bool grab_rtnl)
+ int i40e_sync_vsi_filters(struct i40e_vsi *vsi)
  {
 -	struct list_head tmp_del_list, tmp_add_list;
 -	struct i40e_mac_filter *f, *ftmp, *fclone;
 +	struct i40e_mac_filter *f, *ftmp;
  	bool promisc_forced_on = false;
  	bool add_happened = false;
  	int filter_list_len = 0;
@@@ -8827,7 -9222,10 +8833,13 @@@ int i40e_vsi_release(struct i40e_vsi *v
  	list_for_each_entry_safe(f, ftmp, &vsi->mac_filter_list, list)
  		i40e_del_filter(vsi, f->macaddr, f->vlan,
  				f->is_vf, f->is_netdev);
++<<<<<<< HEAD
 +	i40e_sync_vsi_filters(vsi, false);
++=======
+ 	spin_unlock_bh(&vsi->mac_filter_list_lock);
+ 
+ 	i40e_sync_vsi_filters(vsi);
++>>>>>>> 17652c6336fd (i40e: remove unused argument)
  
  	i40e_vsi_delete(vsi);
  	i40e_vsi_free_q_vectors(vsi);
diff --cc drivers/net/ethernet/intel/i40e/i40e_virtchnl_pf.c
index 21f5f7b84b7b,819803c8e461..000000000000
--- a/drivers/net/ethernet/intel/i40e/i40e_virtchnl_pf.c
+++ b/drivers/net/ethernet/intel/i40e/i40e_virtchnl_pf.c
@@@ -1603,10 -1629,13 +1603,16 @@@ static int i40e_vc_add_mac_addr_msg(str
  			goto error_param;
  		}
  	}
 -	spin_unlock_bh(&vsi->mac_filter_list_lock);
  
  	/* program the updated filter list */
++<<<<<<< HEAD
 +	if (i40e_sync_vsi_filters(vsi, false))
 +		dev_err(&pf->pdev->dev, "Unable to program VF MAC filters\n");
++=======
+ 	if (i40e_sync_vsi_filters(vsi))
+ 		dev_err(&pf->pdev->dev, "Unable to program VF %d MAC filters\n",
+ 			vf->vf_id);
++>>>>>>> 17652c6336fd (i40e: remove unused argument)
  
  error_param:
  	/* send the response to the VF */
@@@ -1654,10 -1684,12 +1660,16 @@@ static int i40e_vc_del_mac_addr_msg(str
  	for (i = 0; i < al->num_elements; i++)
  		i40e_del_filter(vsi, al->list[i].addr,
  				I40E_VLAN_ANY, true, false);
 -	spin_unlock_bh(&vsi->mac_filter_list_lock);
  
  	/* program the updated filter list */
++<<<<<<< HEAD
 +	if (i40e_sync_vsi_filters(vsi, false))
 +		dev_err(&pf->pdev->dev, "Unable to program VF MAC filters\n");
++=======
+ 	if (i40e_sync_vsi_filters(vsi))
+ 		dev_err(&pf->pdev->dev, "Unable to program VF %d MAC filters\n",
+ 			vf->vf_id);
++>>>>>>> 17652c6336fd (i40e: remove unused argument)
  
  error_param:
  	/* send the response to the VF */
@@@ -2060,9 -2098,11 +2072,9 @@@ int i40e_ndo_set_vf_mac(struct net_devi
  	list_for_each_entry(f, &vsi->mac_filter_list, list)
  		i40e_del_filter(vsi, f->macaddr, f->vlan, true, false);
  
 -	spin_unlock_bh(&vsi->mac_filter_list_lock);
 -
  	dev_info(&pf->pdev->dev, "Setting MAC %pM on VF %d\n", mac, vf_id);
  	/* program mac filter */
- 	if (i40e_sync_vsi_filters(vsi, false)) {
+ 	if (i40e_sync_vsi_filters(vsi)) {
  		dev_err(&pf->pdev->dev, "Unable to program ucast filters\n");
  		ret = -EIO;
  		goto error_param;
diff --git a/drivers/net/ethernet/intel/i40e/i40e.h b/drivers/net/ethernet/intel/i40e/i40e.h
index f6d97ad811bb..e60a04f13396 100644
--- a/drivers/net/ethernet/intel/i40e/i40e.h
+++ b/drivers/net/ethernet/intel/i40e/i40e.h
@@ -668,7 +668,7 @@ struct i40e_mac_filter *i40e_add_filter(struct i40e_vsi *vsi,
 					bool is_vf, bool is_netdev);
 void i40e_del_filter(struct i40e_vsi *vsi, u8 *macaddr, s16 vlan,
 		     bool is_vf, bool is_netdev);
-int i40e_sync_vsi_filters(struct i40e_vsi *vsi, bool grab_rtnl);
+int i40e_sync_vsi_filters(struct i40e_vsi *vsi);
 struct i40e_vsi *i40e_vsi_setup(struct i40e_pf *pf, u8 type,
 				u16 uplink, u32 param1);
 int i40e_vsi_release(struct i40e_vsi *vsi);
* Unmerged path drivers/net/ethernet/intel/i40e/i40e_debugfs.c
* Unmerged path drivers/net/ethernet/intel/i40e/i40e_main.c
* Unmerged path drivers/net/ethernet/intel/i40e/i40e_virtchnl_pf.c
