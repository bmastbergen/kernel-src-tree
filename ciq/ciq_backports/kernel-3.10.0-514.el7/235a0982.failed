ceph: multiple filesystem support

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
commit-author Yan, Zheng <zyan@redhat.com>
commit 235a09821c2bc71d9d07f12217ce2ac00db99eba
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/235a0982.failed

To access non-default filesystem, we just need to subscribe to
mdsmap.<MDS_NAMESPACE_ID> and add a new mount option for mds
namespace id.

	Signed-off-by: Yan, Zheng <zyan@redhat.com>
[idryomov@gmail.com: switch to a new libceph API]
	Signed-off-by: Ilya Dryomov <idryomov@gmail.com>
(cherry picked from commit 235a09821c2bc71d9d07f12217ce2ac00db99eba)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	fs/ceph/super.c
diff --cc fs/ceph/super.c
index 5877616577af,452770dc9fc1..000000000000
--- a/fs/ceph/super.c
+++ b/fs/ceph/super.c
@@@ -418,7 -451,20 +424,9 @@@ static int ceph_show_options(struct seq
  		seq_puts(m, ",noasyncreaddir");
  	if ((fsopt->flags & CEPH_MOUNT_OPT_DCACHE) == 0)
  		seq_puts(m, ",nodcache");
 -	if (fsopt->flags & CEPH_MOUNT_OPT_FSCACHE)
 -		seq_puts(m, ",fsc");
 -	if (fsopt->flags & CEPH_MOUNT_OPT_NOPOOLPERM)
 -		seq_puts(m, ",nopoolperm");
 -
 -#ifdef CONFIG_CEPH_FS_POSIX_ACL
 -	if (fsopt->sb_flags & MS_POSIXACL)
 -		seq_puts(m, ",acl");
 -	else
 -		seq_puts(m, ",noacl");
 -#endif
  
+ 	if (fsopt->mds_namespace != CEPH_FS_CLUSTER_ID_NONE)
+ 		seq_printf(m, ",mds_namespace=%d", fsopt->mds_namespace);
  	if (fsopt->wsize)
  		seq_printf(m, ",wsize=%d", fsopt->wsize);
  	if (fsopt->rsize != CEPH_RSIZE_DEFAULT)
@@@ -492,7 -538,8 +500,12 @@@ static struct ceph_fs_client *create_fs
  		goto fail;
  	}
  	fsc->client->extra_mon_dispatch = extra_mon_dispatch;
++<<<<<<< HEAD
 +	fsc->client->monc.want_mdsmap = 1;
++=======
+ 	fsc->client->monc.fs_cluster_id = fsopt->mds_namespace;
+ 	ceph_monc_want_map(&fsc->client->monc, CEPH_SUB_MDSMAP, 0, true);
++>>>>>>> 235a09821c2b (ceph: multiple filesystem support)
  
  	fsc->mount_options = fsopt;
  
* Unmerged path fs/ceph/super.c
diff --git a/fs/ceph/super.h b/fs/ceph/super.h
index 1c439e8e6c74..89e8d5dbc91c 100644
--- a/fs/ceph/super.h
+++ b/fs/ceph/super.h
@@ -55,6 +55,7 @@ struct ceph_mount_options {
 	int cap_release_safety;
 	int max_readdir;       /* max readdir result (entires) */
 	int max_readdir_bytes; /* max readdir result (bytes) */
+	int mds_namespace;
 
 	/*
 	 * everything above this point can be memcmp'd; everything below
