perf stat record: Keep sample_type 0 for pipe session

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
commit-author Jiri Olsa <jolsa@kernel.org>
commit 6db1a5c190d6abe416ea36aa28a6c53e0b3bbd5e
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/6db1a5c1.failed

For pipe sessions we need to keep sample_type zero, because script's
perf_evsel__check_attr is triggered by sample_type != 0, and the check
would fail on stat session.

I was tempted to keep it zero unconditionally, but the pipe session is
sufficient. In perf.data session we are guarded by HEADER_STAT feature.

	Signed-off-by: Jiri Olsa <jolsa@kernel.org>
	Cc: David Ahern <dsahern@gmail.com>
	Cc: Kan Liang <kan.liang@intel.com>
	Cc: Namhyung Kim <namhyung@kernel.org>
	Cc: Peter Zijlstra <a.p.zijlstra@chello.nl>
Link: http://lkml.kernel.org/r/1452028152-26762-2-git-send-email-jolsa@kernel.org
	Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>
(cherry picked from commit 6db1a5c190d6abe416ea36aa28a6c53e0b3bbd5e)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	tools/perf/builtin-stat.c
diff --cc tools/perf/builtin-stat.c
index 473fc692d35a,7f568244662b..000000000000
--- a/tools/perf/builtin-stat.c
+++ b/tools/perf/builtin-stat.c
@@@ -161,7 -184,18 +161,22 @@@ static int create_perf_stat_counter(str
  	 * like tracepoints. Clear it up for counting.
  	 */
  	attr->sample_period = 0;
++<<<<<<< HEAD
 +	attr->sample_type   = 0;
++=======
+ 
+ 	/*
+ 	 * But set sample_type to PERF_SAMPLE_IDENTIFIER, which should be harmless
+ 	 * while avoiding that older tools show confusing messages.
+ 	 *
+ 	 * However for pipe sessions we need to keep it zero,
+ 	 * because script's perf_evsel__check_attr is triggered
+ 	 * by attr->sample_type != 0, and we can't run it on
+ 	 * stat sessions.
+ 	 */
+ 	if (!(STAT_RECORD && perf_stat.file.is_pipe))
+ 		attr->sample_type = PERF_SAMPLE_IDENTIFIER;
++>>>>>>> 6db1a5c190d6 (perf stat record: Keep sample_type 0 for pipe session)
  
  	/*
  	 * Disabling all counters initially, they will be enabled
* Unmerged path tools/perf/builtin-stat.c
