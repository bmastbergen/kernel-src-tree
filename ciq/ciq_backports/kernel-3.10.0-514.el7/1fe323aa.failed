sctp: use event->chunk when it's valid

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
commit-author Xin Long <lucien.xin@gmail.com>
commit 1fe323aa1b2390a0c57fb0b06a782f128d49094c
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/1fe323aa.failed

Commit 52253db924d1 ("sctp: also point GSO head_skb to the sk when
it's available") used event->chunk->head_skb to get the head_skb in
sctp_ulpevent_set_owner().

But at that moment, the event->chunk was NULL, as it cloned the skb
in sctp_ulpevent_make_rcvmsg(). Therefore, that patch didn't really
work.

This patch is to move the event->chunk initialization before calling
sctp_ulpevent_receive_data() so that it uses event->chunk when it's
valid.

Fixes: 52253db924d1 ("sctp: also point GSO head_skb to the sk when it's available")
	Signed-off-by: Xin Long <lucien.xin@gmail.com>
	Acked-by: Marcelo Ricardo Leitner <marcelo.leitner@gmail.com>
	Acked-by: Neil Horman <nhorman@tuxdriver.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 1fe323aa1b2390a0c57fb0b06a782f128d49094c)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/sctp/ulpevent.c
diff --cc net/sctp/ulpevent.c
index f87464d56664,d85b803da11d..000000000000
--- a/net/sctp/ulpevent.c
+++ b/net/sctp/ulpevent.c
@@@ -750,6 -702,12 +750,15 @@@ struct sctp_ulpevent *sctp_ulpevent_mak
  	 */
  	sctp_ulpevent_init(event, 0, skb->len + sizeof(struct sk_buff));
  
++<<<<<<< HEAD
++=======
+ 	/* And hold the chunk as we need it for getting the IP headers
+ 	 * later in recvmsg
+ 	 */
+ 	sctp_chunk_hold(chunk);
+ 	event->chunk = chunk;
+ 
++>>>>>>> 1fe323aa1b23 (sctp: use event->chunk when it's valid)
  	sctp_ulpevent_receive_data(event, asoc);
  
  	event->stream = ntohs(chunk->subh.data_hdr->stream);
* Unmerged path net/sctp/ulpevent.c
