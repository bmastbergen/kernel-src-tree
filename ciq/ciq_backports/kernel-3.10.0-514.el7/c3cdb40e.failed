zram: remove max_num_devices limitation

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
commit-author Sergey Senozhatsky <sergey.senozhatsky@gmail.com>
commit c3cdb40e66344553898daa3ccd068c03173a3f42
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/c3cdb40e.failed

Limiting the number of zram devices to 32 (default max_num_devices value)
is confusing, let's drop it.  A user with 2TB or 4TB of RAM, for example,
can request as many devices as he can handle.

	Signed-off-by: Sergey Senozhatsky <sergey.senozhatsky@gmail.com>
	Acked-by: Minchan Kim <minchan@kernel.org>
	Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
	Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
(cherry picked from commit c3cdb40e66344553898daa3ccd068c03173a3f42)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/block/zram/zram_drv.c
diff --cc drivers/block/zram/zram_drv.c
index f4772ab5159f,70aac2e564e9..000000000000
--- a/drivers/block/zram/zram_drv.c
+++ b/drivers/block/zram/zram_drv.c
@@@ -1028,13 -1287,6 +1028,16 @@@ static int __init zram_init(void
  {
  	int ret, dev_id;
  
++<<<<<<< HEAD
 +	if (num_devices > max_num_devices) {
 +		pr_warn("Invalid value for num_devices: %u\n",
 +				num_devices);
 +		ret = -EINVAL;
 +		goto out;
 +	}
 +
++=======
++>>>>>>> c3cdb40e6634 (zram: remove max_num_devices limitation)
  	zram_major = register_blkdev(0, "zram");
  	if (zram_major <= 0) {
  		pr_warn("Unable to get major number\n");
diff --git a/Documentation/blockdev/zram.txt b/Documentation/blockdev/zram.txt
index f9135b48fe66..ffb97b4bcff1 100644
--- a/Documentation/blockdev/zram.txt
+++ b/Documentation/blockdev/zram.txt
@@ -19,7 +19,9 @@ Following shows a typical sequence of steps for using zram.
 1) Load Module:
 	modprobe zram num_devices=4
 	This creates 4 devices: /dev/zram{0,1,2,3}
-	(num_devices parameter is optional. Default: 1)
+
+num_devices parameter is optional and tells zram how many devices should be
+pre-created. Default: 1.
 
 2) Set max number of compression streams
 	Compression backend may use up to max_comp_streams compression streams,
* Unmerged path drivers/block/zram/zram_drv.c
diff --git a/drivers/block/zram/zram_drv.h b/drivers/block/zram/zram_drv.h
index 7d655c176e09..ddb8994f53b5 100644
--- a/drivers/block/zram/zram_drv.h
+++ b/drivers/block/zram/zram_drv.h
@@ -20,12 +20,6 @@
 
 #include "zcomp.h"
 
-/*
- * Some arbitrary value. This is just to catch
- * invalid value for num_devices module parameter.
- */
-static const unsigned max_num_devices = 32;
-
 /*-- Configurable parameters */
 
 /*
