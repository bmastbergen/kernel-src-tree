mei: use uuid, me_addr tuple addressing also for flow control credits

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
commit-author Tomas Winkler <tomas.winkler@intel.com>
commit 2e5df413becf6bd3854d1eb4f96542a53848bb27
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/2e5df413.failed

Add uuid, me_addr addressing also for flow control credits.
The only exception in cases for single buffer clients for which
the host address in flow credits response is always 0

To in order to deal with add/remove race between fw and driver clients
addressing we need to use [uuid, me_addr] tuple to address the clients

	Signed-off-by: Tomas Winkler <tomas.winkler@intel.com>
	Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
(cherry picked from commit 2e5df413becf6bd3854d1eb4f96542a53848bb27)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/misc/mei/client.c
diff --cc drivers/misc/mei/client.c
index 22a9268f24eb,3be18b7951e5..000000000000
--- a/drivers/misc/mei/client.c
+++ b/drivers/misc/mei/client.c
@@@ -660,13 -704,12 +660,18 @@@ int mei_cl_flow_ctrl_creds(struct mei_c
  	if (cl->mei_flow_ctrl_creds > 0)
  		return 1;
  
++<<<<<<< HEAD
 +	id = mei_me_cl_by_id(dev, cl->me_client_id);
 +	if (id < 0) {
++=======
+ 	me_cl = mei_me_cl_by_uuid_id(dev, &cl->cl_uuid, cl->me_client_id);
+ 	if (!me_cl) {
++>>>>>>> 2e5df413becf (mei: use uuid, me_addr tuple addressing also for flow control credits)
  		cl_err(dev, cl, "no such me client %d\n", cl->me_client_id);
 -		return -ENOENT;
 +		return id;
  	}
  
 +	me_cl = &dev->me_clients[id];
  	if (me_cl->mei_flow_ctrl_creds) {
  		if (WARN_ON(me_cl->props.single_recv_buf == 0))
  			return -EINVAL;
@@@ -696,14 -738,13 +701,19 @@@ int mei_cl_flow_ctrl_reduce(struct mei_
  
  	dev = cl->dev;
  
++<<<<<<< HEAD
 +	id = mei_me_cl_by_id(dev, cl->me_client_id);
 +	if (id < 0) {
++=======
+ 	me_cl = mei_me_cl_by_uuid_id(dev, &cl->cl_uuid, cl->me_client_id);
+ 	if (!me_cl) {
++>>>>>>> 2e5df413becf (mei: use uuid, me_addr tuple addressing also for flow control credits)
  		cl_err(dev, cl, "no such me client %d\n", cl->me_client_id);
 -		return -ENOENT;
 +		return id;
  	}
  
 -	if (me_cl->props.single_recv_buf) {
 +	me_cl = &dev->me_clients[id];
 +	if (me_cl->props.single_recv_buf != 0) {
  		if (WARN_ON(me_cl->mei_flow_ctrl_creds <= 0))
  			return -EINVAL;
  		me_cl->mei_flow_ctrl_creds--;
* Unmerged path drivers/misc/mei/client.c
