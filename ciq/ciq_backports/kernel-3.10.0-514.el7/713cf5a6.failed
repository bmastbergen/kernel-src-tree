raid5: don't allow resize/reshape with cache(log) support

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
commit-author Shaohua Li <shli@fb.com>
commit 713cf5a63954bdc1cd4bed0a81e98cbd8fc5928c
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/713cf5a6.failed

If cache(log) support is enabled, don't allow resize/reshape in current
stage. In the future, we can flush all data from cache(log) to raid
before resize/reshape and then allow resize/reshape.

	Signed-off-by: Shaohua Li <shli@fb.com>
	Signed-off-by: NeilBrown <neilb@suse.com>
(cherry picked from commit 713cf5a63954bdc1cd4bed0a81e98cbd8fc5928c)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/md/raid5.c
diff --cc drivers/md/raid5.c
index b9b255fe2944,122702d957a6..000000000000
--- a/drivers/md/raid5.c
+++ b/drivers/md/raid5.c
@@@ -7150,7 -7226,11 +7160,15 @@@ static int raid5_resize(struct mddev *m
  	 * worth it.
  	 */
  	sector_t newsize;
++<<<<<<< HEAD
 +	sectors &= ~((sector_t)mddev->chunk_sectors - 1);
++=======
+ 	struct r5conf *conf = mddev->private;
+ 
+ 	if (conf->log)
+ 		return -EINVAL;
+ 	sectors &= ~((sector_t)conf->chunk_sectors - 1);
++>>>>>>> 713cf5a63954 (raid5: don't allow resize/reshape with cache(log) support)
  	newsize = raid5_size(mddev, sectors, mddev->raid_disks);
  	if (mddev->external_size &&
  	    mddev->array_sectors > newsize)
* Unmerged path drivers/md/raid5.c
