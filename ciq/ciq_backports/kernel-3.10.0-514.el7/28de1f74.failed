iw_cxgb4: Take clip reference before starting IPv6 listen

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
commit-author Hariprasad S <hariprasad@chelsio.com>
commit 28de1f74374da4f0f628b14bbccb07e5637d00b1
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/28de1f74.failed

The h/w is designed in such a way that, if you do anything IPv6
related, a valid clip entry must be there. So take clip reference
before creating IPv6 listening servers, and then if we fail to
create server, release the clip entry.

	Signed-off-by: Hariprasad Shenai <hariprasad@chelsio.com>
	Acked-by: Steve Wise <swise@opengridcomputing.com>
	Signed-off-by: Doug Ledford <dledford@redhat.com>
(cherry picked from commit 28de1f74374da4f0f628b14bbccb07e5637d00b1)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/infiniband/hw/cxgb4/cm.c
diff --cc drivers/infiniband/hw/cxgb4/cm.c
index cc2be9e50b5a,704680471567..000000000000
--- a/drivers/infiniband/hw/cxgb4/cm.c
+++ b/drivers/infiniband/hw/cxgb4/cm.c
@@@ -3136,10 -3286,15 +3142,22 @@@ static int create_server6(struct c4iw_d
  		err = c4iw_wait_for_reply(&ep->com.dev->rdev,
  					  &ep->com.wr_wait,
  					  0, 0, __func__);
++<<<<<<< HEAD
 +	if (err)
 +		pr_err("cxgb4_create_server6/filter failed err %d stid %d laddr %pI6 lport %d\n",
 +		       err, ep->stid,
 +		       sin6->sin6_addr.s6_addr, ntohs(sin6->sin6_port));
++=======
+ 	else if (err > 0)
+ 		err = net_xmit_errno(err);
+ 	if (err) {
+ 		cxgb4_clip_release(ep->com.dev->rdev.lldi.ports[0],
+ 				   (const u32 *)&sin6->sin6_addr.s6_addr, 1);
+ 		pr_err("cxgb4_create_server6/filter failed err %d stid %d laddr %pI6 lport %d\n",
+ 		       err, ep->stid,
+ 		       sin6->sin6_addr.s6_addr, ntohs(sin6->sin6_port));
+ 	}
++>>>>>>> 28de1f74374d (iw_cxgb4: Take clip reference before starting IPv6 listen)
  	return err;
  }
  
* Unmerged path drivers/infiniband/hw/cxgb4/cm.c
