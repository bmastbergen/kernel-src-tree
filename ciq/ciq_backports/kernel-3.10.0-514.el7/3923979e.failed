IB/hfi1: Change hfi1_init loop to preserve error returns

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
commit-author Ashutosh Dixit <ashutosh.dixit@intel.com>
commit 3923979e9bc6aa6f168a644314d6729e9f98eccc
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/3923979e.failed

If one iteration of the loop causes an error return and a later iteration
doesn't, the later iteration causes the earlier error condition to be
lost. This could result in driver probe succeeding when it should have
failed. Therefore save off the error return in the loop itself rather than
outside the loop.

	Reviewed-by: Dennis Dalessandro <dennis.dalessandro@intel.com>
	Reviewed-by: Mitko Haralanov <mitko.haralanov@intel.com>
	Signed-off-by: Ashutosh Dixit <ashutosh.dixit@intel.com>
	Signed-off-by: Doug Ledford <dledford@redhat.com>
(cherry picked from commit 3923979e9bc6aa6f168a644314d6729e9f98eccc)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/staging/hfi1/init.c
diff --cc drivers/staging/hfi1/init.c
index 29ebbdfb27ec,9e71abf0f40f..000000000000
--- a/drivers/staging/hfi1/init.c
+++ b/drivers/staging/hfi1/init.c
@@@ -728,12 -732,12 +728,16 @@@ int hfi1_init(struct hfi1_devdata *dd, 
  		lastfail = hfi1_create_rcvhdrq(dd, rcd);
  		if (!lastfail)
  			lastfail = hfi1_setup_eagerbufs(rcd);
- 		if (lastfail)
+ 		if (lastfail) {
  			dd_dev_err(dd,
++<<<<<<< HEAD:drivers/staging/hfi1/init.c
 +				"failed to allocate kernel ctxt's rcvhdrq and/or egr bufs\n");
++=======
+ 				   "failed to allocate kernel ctxt's rcvhdrq and/or egr bufs\n");
+ 			ret = lastfail;
+ 		}
++>>>>>>> 3923979e9bc6 (IB/hfi1: Change hfi1_init loop to preserve error returns):drivers/staging/rdma/hfi1/init.c
  	}
- 	if (lastfail)
- 		ret = lastfail;
  
  	/* Allocate enough memory for user event notification. */
  	len = PAGE_ALIGN(dd->chip_rcv_contexts * HFI1_MAX_SHARED_CTXTS *
* Unmerged path drivers/staging/hfi1/init.c
