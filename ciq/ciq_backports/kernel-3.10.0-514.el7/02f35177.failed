x86/microcode/intel: Simplify load_ucode_intel_bsp()

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
Rebuild_CHGLOG: - [x86] microcode/intel: Simplify load_ucode_intel_bsp() (Prarit Bhargava) [1253762]
Rebuild_FUZZ: 96.00%
commit-author Borislav Petkov <bp@suse.de>
commit 02f35177fb00ee0d73f9af2d6006af6b75b58c11
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/02f35177.failed

Don't compute start and end from start and size in order to compute size
again down the path in scan_microcode(). So pass size directly instead
and simplify a bunch. Shorten variable names and remove useless ones.

	Signed-off-by: Borislav Petkov <bp@suse.de>
(cherry picked from commit 02f35177fb00ee0d73f9af2d6006af6b75b58c11)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/x86/kernel/cpu/microcode/intel_early.c
diff --cc arch/x86/kernel/cpu/microcode/intel_early.c
index 141b589aa1e3,34a2ff9217f8..000000000000
--- a/arch/x86/kernel/cpu/microcode/intel_early.c
+++ b/arch/x86/kernel/cpu/microcode/intel_early.c
@@@ -718,45 -718,40 +715,70 @@@ int __init save_microcode_in_initrd_int
  static void __init
  _load_ucode_intel_bsp(struct mc_saved_data *mc_saved_data,
  		      unsigned long *mc_saved_in_initrd,
++<<<<<<< HEAD
 +		      unsigned long initrd_start_early,
 +		      unsigned long initrd_end_early,
 +		      struct ucode_cpu_info *uci)
 +{
 +	collect_cpu_info_early(uci);
 +	scan_microcode(initrd_start_early, initrd_end_early, mc_saved_data,
 +		       mc_saved_in_initrd, uci);
 +	load_microcode(mc_saved_data, mc_saved_in_initrd,
 +		       initrd_start_early, uci);
 +	apply_microcode_early(uci);
++=======
+ 		      unsigned long start, unsigned long size)
+ {
+ 	struct ucode_cpu_info uci;
+ 	enum ucode_state ret;
+ 
+ 	collect_cpu_info_early(&uci);
+ 	scan_microcode(start, size, mc_saved_data, mc_saved_in_initrd, &uci);
+ 
+ 	ret = load_microcode(mc_saved_data, mc_saved_in_initrd, start, &uci);
+ 	if (ret != UCODE_OK)
+ 		return;
+ 
+ 	apply_microcode_early(&uci, true);
++>>>>>>> 02f35177fb00 (x86/microcode/intel: Simplify load_ucode_intel_bsp())
  }
  
- void __init
- load_ucode_intel_bsp(void)
+ void __init load_ucode_intel_bsp(void)
  {
++<<<<<<< HEAD
 +	u64 ramdisk_image, ramdisk_size;
 +	unsigned long initrd_start_early, initrd_end_early;
 +	struct ucode_cpu_info uci;
++=======
+ 	u64 start, size;
++>>>>>>> 02f35177fb00 (x86/microcode/intel: Simplify load_ucode_intel_bsp())
  #ifdef CONFIG_X86_32
- 	struct boot_params *boot_params_p;
+ 	struct boot_params *p;
  
- 	boot_params_p = (struct boot_params *)__pa_nodebug(&boot_params);
- 	ramdisk_image = boot_params_p->hdr.ramdisk_image;
- 	ramdisk_size  = boot_params_p->hdr.ramdisk_size;
- 	initrd_start_early = ramdisk_image;
- 	initrd_end_early = initrd_start_early + ramdisk_size;
+ 	p	= (struct boot_params *)__pa_nodebug(&boot_params);
+ 	start	= p->hdr.ramdisk_image;
+ 	size	= p->hdr.ramdisk_size;
  
  	_load_ucode_intel_bsp(
++<<<<<<< HEAD
 +		(struct mc_saved_data *)__pa_nodebug(&mc_saved_data),
 +		(unsigned long *)__pa_nodebug(&mc_saved_in_initrd),
 +		initrd_start_early, initrd_end_early, &uci);
++=======
+ 			(struct mc_saved_data *)__pa_nodebug(&mc_saved_data),
+ 			(unsigned long *)__pa_nodebug(&mc_saved_in_initrd),
+ 			start, size);
++>>>>>>> 02f35177fb00 (x86/microcode/intel: Simplify load_ucode_intel_bsp())
  #else
- 	ramdisk_image = boot_params.hdr.ramdisk_image;
- 	ramdisk_size  = boot_params.hdr.ramdisk_size;
- 	initrd_start_early = ramdisk_image + PAGE_OFFSET;
- 	initrd_end_early = initrd_start_early + ramdisk_size;
+ 	start	= boot_params.hdr.ramdisk_image + PAGE_OFFSET;
+ 	size	= boot_params.hdr.ramdisk_size;
  
++<<<<<<< HEAD
 +	_load_ucode_intel_bsp(&mc_saved_data, mc_saved_in_initrd,
 +			      initrd_start_early, initrd_end_early, &uci);
++=======
+ 	_load_ucode_intel_bsp(&mc_saved_data, mc_saved_in_initrd, start, size);
++>>>>>>> 02f35177fb00 (x86/microcode/intel: Simplify load_ucode_intel_bsp())
  #endif
  }
  
* Unmerged path arch/x86/kernel/cpu/microcode/intel_early.c
