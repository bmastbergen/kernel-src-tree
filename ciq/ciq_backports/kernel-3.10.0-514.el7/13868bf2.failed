mmc: sdhci: add quirk for broken HS200 support

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
commit-author David Cohen <david.a.cohen@linux.intel.com>
commit 13868bf20f2f2c305f96e23620b024e167d6f9cb
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/13868bf2.failed

This patch defines a quirk for platforms unable to enable HS200 support.

	Signed-off-by: David Cohen <david.a.cohen@linux.intel.com>
	Reviewed-by: Chuanxiao Dong <chuanxiao.dong@intel.com>
	Acked-by: Dong Aisheng <b29396@freescale.com>
	Cc: stable <stable@vger.kernel.org> # [3.13]
	Signed-off-by: Chris Ball <chris@printf.net>
(cherry picked from commit 13868bf20f2f2c305f96e23620b024e167d6f9cb)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	include/linux/mmc/sdhci.h
diff --cc include/linux/mmc/sdhci.h
index 405e706a07e9,362927c48f97..000000000000
--- a/include/linux/mmc/sdhci.h
+++ b/include/linux/mmc/sdhci.h
@@@ -96,6 -96,10 +96,13 @@@ struct sdhci_host 
  #define SDHCI_QUIRK2_NO_1_8_V				(1<<2)
  #define SDHCI_QUIRK2_PRESET_VALUE_BROKEN		(1<<3)
  #define SDHCI_QUIRK2_CARD_ON_NEEDS_BUS_ON		(1<<4)
++<<<<<<< HEAD
++=======
+ /* Controller has a non-standard host control register */
+ #define SDHCI_QUIRK2_BROKEN_HOST_CONTROL		(1<<5)
+ /* Controller does not support HS200 */
+ #define SDHCI_QUIRK2_BROKEN_HS200			(1<<6)
++>>>>>>> 13868bf20f2f (mmc: sdhci: add quirk for broken HS200 support)
  
  	int irq;		/* Device IRQ */
  	void __iomem *ioaddr;	/* Mapped address */
diff --git a/drivers/mmc/host/sdhci.c b/drivers/mmc/host/sdhci.c
index cc00bed3e200..ec3eb30845c7 100644
--- a/drivers/mmc/host/sdhci.c
+++ b/drivers/mmc/host/sdhci.c
@@ -3016,7 +3016,8 @@ int sdhci_add_host(struct sdhci_host *host)
 		/* SD3.0: SDR104 is supported so (for eMMC) the caps2
 		 * field can be promoted to support HS200.
 		 */
-		mmc->caps2 |= MMC_CAP2_HS200;
+		if (!(host->quirks2 & SDHCI_QUIRK2_BROKEN_HS200))
+			mmc->caps2 |= MMC_CAP2_HS200;
 	} else if (caps[1] & SDHCI_SUPPORT_SDR50)
 		mmc->caps |= MMC_CAP_UHS_SDR50;
 
* Unmerged path include/linux/mmc/sdhci.h
