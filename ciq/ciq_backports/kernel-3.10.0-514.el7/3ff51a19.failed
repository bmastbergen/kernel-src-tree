tty: Remove TTY_HUPPING

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
Rebuild_CHGLOG: - [tty] Remove TTY_HUPPING ("Herton R. Krzesinski") [1327403]
Rebuild_FUZZ: 87.80%
commit-author Peter Hurley <peter@hurleysoftware.com>
commit 3ff51a199f9e85aed843471bc10dae9e94dbb0fc
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/3ff51a19.failed

Now that tty_ldisc_hangup() does not drop the tty lock, it is no
longer possible to observe TTY_HUPPING while holding the tty lock
on another cpu.

Remove TTY_HUPPING bit definition.

	Reviewed-by: Alan Cox <alan@linux.intel.com>
	Signed-off-by: Peter Hurley <peter@hurleysoftware.com>
	Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
(cherry picked from commit 3ff51a199f9e85aed843471bc10dae9e94dbb0fc)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/tty/tty_io.c
diff --cc drivers/tty/tty_io.c
index b4c587413e15,873793c426df..000000000000
--- a/drivers/tty/tty_io.c
+++ b/drivers/tty/tty_io.c
@@@ -629,8 -685,10 +629,15 @@@ static void __tty_hangup(struct tty_str
  
  	tty_lock(tty);
  
++<<<<<<< HEAD
 +	/* some functions below drop BTM, so we need this bit */
 +	set_bit(TTY_HUPPING, &tty->flags);
++=======
+ 	if (test_bit(TTY_HUPPED, &tty->flags)) {
+ 		tty_unlock(tty);
+ 		return;
+ 	}
++>>>>>>> 3ff51a199f9e (tty: Remove TTY_HUPPING)
  
  	/* inuse_filps is protected by the single tty lock,
  	   this really needs to change if we want to flush the
* Unmerged path drivers/tty/tty_io.c
diff --git a/drivers/tty/tty_ldisc.c b/drivers/tty/tty_ldisc.c
index fd2b20d6af80..0b896cc9dc4a 100644
--- a/drivers/tty/tty_ldisc.c
+++ b/drivers/tty/tty_ldisc.c
@@ -548,8 +548,7 @@ int tty_set_ldisc(struct tty_struct *tty, int ldisc)
 
 	old_ldisc = tty->ldisc;
 
-	if (test_bit(TTY_HUPPING, &tty->flags) ||
-	    test_bit(TTY_HUPPED, &tty->flags)) {
+	if (test_bit(TTY_HUPPED, &tty->flags)) {
 		/* We were raced by the hangup method. It will have stomped
 		   the ldisc data and closed the ldisc down */
 		tty_ldisc_enable_pair(tty, o_tty);
diff --git a/include/linux/tty.h b/include/linux/tty.h
index 8ddae3b5452c..6f7f51c31ef6 100644
--- a/include/linux/tty.h
+++ b/include/linux/tty.h
@@ -313,7 +313,6 @@ struct tty_file_private {
 #define TTY_PTY_LOCK 		16	/* pty private */
 #define TTY_NO_WRITE_SPLIT 	17	/* Preserve write boundaries to driver */
 #define TTY_HUPPED 		18	/* Post driver->hangup() */
-#define TTY_HUPPING 		21	/* ->hangup() in progress */
 #define TTY_LDISC_HALTED	22	/* Line discipline is halted */
 
 #define TTY_WRITE_FLUSH(tty) tty_write_flush((tty))
