drm/i915/gen9: Reject display updates that exceed wm limitations (v2)

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
commit-author Matt Roper <matthew.d.roper@intel.com>
commit 6b6bada7d476b586d85b1f9df43125804877e09f
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/6b6bada7.failed

If we can't find any valid level 0 watermark values for the requested
atomic transaction, reject the configuration before we try to start
programming the hardware.

v2:
 - Add extra debugging output when we reject level 0 watermarks so that
   we can more easily debug how/why they were rejected.

	Cc: Lyude Paul <cpaul@redhat.com>
	Signed-off-by: Matt Roper <matthew.d.roper@intel.com>
	Reviewed-by: Maarten Lankhorst <maarten.lankhorst@linux.intel.com>
Link: http://patchwork.freedesktop.org/patch/msgid/1463061971-19638-17-git-send-email-matthew.d.roper@intel.com
(cherry picked from commit 6b6bada7d476b586d85b1f9df43125804877e09f)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/gpu/drm/i915/intel_pm.c
diff --cc drivers/gpu/drm/i915/intel_pm.c
index cca54888a5ac,fcf925b31575..000000000000
--- a/drivers/gpu/drm/i915/intel_pm.c
+++ b/drivers/gpu/drm/i915/intel_pm.c
@@@ -2930,8 -3304,25 +2930,30 @@@ static bool skl_compute_plane_wm(const 
  			res_blocks++;
  	}
  
++<<<<<<< HEAD
 +	if (res_blocks >= ddb_allocation || res_lines > 31)
 +		return false;
++=======
+ 	if (res_blocks >= ddb_allocation || res_lines > 31) {
+ 		*enabled = false;
+ 
+ 		/*
+ 		 * If there are no valid level 0 watermarks, then we can't
+ 		 * support this display configuration.
+ 		 */
+ 		if (level) {
+ 			return 0;
+ 		} else {
+ 			DRM_DEBUG_KMS("Requested display configuration exceeds system watermark limitations\n");
+ 			DRM_DEBUG_KMS("Plane %d.%d: blocks required = %u/%u, lines required = %u/31\n",
+ 				      to_intel_crtc(cstate->base.crtc)->pipe,
+ 				      skl_wm_plane_id(to_intel_plane(pstate->plane)),
+ 				      res_blocks, ddb_allocation, res_lines);
+ 
+ 			return -EINVAL;
+ 		}
+ 	}
++>>>>>>> 6b6bada7d476 (drm/i915/gen9: Reject display updates that exceed wm limitations (v2))
  
  	*out_blocks = res_blocks;
  	*out_lines = res_lines;
* Unmerged path drivers/gpu/drm/i915/intel_pm.c
