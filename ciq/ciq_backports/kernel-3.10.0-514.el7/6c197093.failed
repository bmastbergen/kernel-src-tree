mpt3sas: Set maximum transfer length per IO to 4MB for VDs

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
commit-author Chaitra P B <chaitra.basappa@broadcom.com>
commit 6c197093847e8cdec844df39a373bfe1f9a1ac8a
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/6c197093.failed

Set maximum transfer length per IO on RAID volumes to 4MB by setting
VD's queue's max_sector to 8192.

	Signed-off-by: Chaitra P B <chaitra.basappa@broadcom.com>
	Reviewed-by: Tomas Henzl <thenzl@redhat.com>
	Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
(cherry picked from commit 6c197093847e8cdec844df39a373bfe1f9a1ac8a)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/scsi/mpt3sas/mpt3sas_scsih.c
diff --cc drivers/scsi/mpt3sas/mpt3sas_scsih.c
index 9f88d2a5e458,7217218edbac..000000000000
--- a/drivers/scsi/mpt3sas/mpt3sas_scsih.c
+++ b/drivers/scsi/mpt3sas/mpt3sas_scsih.c
@@@ -1798,17 -1901,27 +1798,29 @@@ _scsih_slave_configure(struct scsi_devi
  			break;
  		}
  
 -		if (!ioc->hide_ir_msg)
 -			sdev_printk(KERN_INFO, sdev,
 -			   "%s: handle(0x%04x), wwid(0x%016llx),"
 -			    " pd_count(%d), type(%s)\n",
 -			    r_level, raid_device->handle,
 -			    (unsigned long long)raid_device->wwid,
 -			    raid_device->num_pds, ds);
 +		sdev_printk(KERN_INFO, sdev,
 +			"%s: handle(0x%04x), wwid(0x%016llx), pd_count(%d), type(%s)\n",
 +			 r_level, raid_device->handle,
 +			 (unsigned long long)raid_device->wwid,
 +			 raid_device->num_pds, ds);
  
++<<<<<<< HEAD
++=======
+ 		if (shost->max_sectors > MPT3SAS_RAID_MAX_SECTORS) {
+ 			blk_queue_max_hw_sectors(sdev->request_queue,
+ 						MPT3SAS_RAID_MAX_SECTORS);
+ 			sdev_printk(KERN_INFO, sdev,
+ 					"Set queue's max_sector to: %u\n",
+ 						MPT3SAS_RAID_MAX_SECTORS);
+ 		}
+ 
+ 		scsih_change_queue_depth(sdev, qdepth);
++>>>>>>> 6c197093847e (mpt3sas: Set maximum transfer length per IO to 4MB for VDs)
  
 -		/* raid transport support */
 -		if (!ioc->is_warpdrive)
 -			_scsih_set_level(ioc, sdev, raid_device->volume_type);
 +		_scsih_change_queue_depth(sdev, qdepth, SCSI_QDEPTH_DEFAULT);
 +
 +/* raid transport support */
 +		_scsih_set_level(sdev, raid_device->volume_type);
  		return 0;
  	}
  
diff --git a/drivers/scsi/mpt3sas/mpt3sas_base.h b/drivers/scsi/mpt3sas/mpt3sas_base.h
index bf753531bc24..2680f596dc44 100644
--- a/drivers/scsi/mpt3sas/mpt3sas_base.h
+++ b/drivers/scsi/mpt3sas/mpt3sas_base.h
@@ -96,6 +96,8 @@
 #define MPT3SAS_SAS_QUEUE_DEPTH		254
 #define MPT3SAS_RAID_QUEUE_DEPTH	128
 
+#define MPT3SAS_RAID_MAX_SECTORS	8192
+
 #define MPT_NAME_LENGTH			32	/* generic length of strings */
 #define MPT_STRING_LENGTH		64
 
* Unmerged path drivers/scsi/mpt3sas/mpt3sas_scsih.c
