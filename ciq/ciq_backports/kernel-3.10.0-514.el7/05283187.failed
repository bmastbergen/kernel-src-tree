ip_tunnel: Provide tunnel metadata API for CONFIG_INET=n

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
commit-author Thomas Graf <tgraf@suug.ch>
commit 052831879945be0d9fad2216b127147c565ec1b1
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/05283187.failed

Account for the configuration FIB_RULES=y && INET=n as FIB_RULES can
be selected by IPV6 or DECNET without INET.

Fixes: e7030878fc84 ("fib: Add fib rule match on tunnel id")
Fixes: 3093fbe7ff4b ("route: Per route IP tunnel metadata via lightweight tunnel")
	Reported-by: kbuild test robot <fengguang.wu@intel.com>
	Signed-off-by: Thomas Graf <tgraf@suug.ch>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 052831879945be0d9fad2216b127147c565ec1b1)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	include/net/ip_tunnels.h
diff --cc include/net/ip_tunnels.h
index 1466fdbddeda,d975b3ebd6c7..000000000000
--- a/include/net/ip_tunnels.h
+++ b/include/net/ip_tunnels.h
@@@ -296,6 -293,42 +296,45 @@@ static inline void iptunnel_xmit_stats(
  	}
  }
  
++<<<<<<< HEAD
++=======
+ static inline void *ip_tunnel_info_opts(struct ip_tunnel_info *info, size_t n)
+ {
+ 	return info + 1;
+ }
+ 
+ static inline struct ip_tunnel_info *lwt_tun_info(struct lwtunnel_state *lwtstate)
+ {
+ 	return (struct ip_tunnel_info *)lwtstate->data;
+ }
+ 
+ extern struct static_key ip_tunnel_metadata_cnt;
+ 
+ /* Returns > 0 if metadata should be collected */
+ static inline int ip_tunnel_collect_metadata(void)
+ {
+ 	return static_key_false(&ip_tunnel_metadata_cnt);
+ }
+ 
+ void ip_tunnel_need_metadata(void);
+ void ip_tunnel_unneed_metadata(void);
+ 
+ #else /* CONFIG_INET */
+ 
+ static inline struct ip_tunnel_info *lwt_tun_info(struct lwtunnel_state *lwtstate)
+ {
+ 	return NULL;
+ }
+ 
+ static inline void ip_tunnel_need_metadata(void)
+ {
+ }
+ 
+ static inline void ip_tunnel_unneed_metadata(void)
+ {
+ }
+ 
++>>>>>>> 052831879945 (ip_tunnel: Provide tunnel metadata API for CONFIG_INET=n)
  #endif /* CONFIG_INET */
  
  #endif /* __NET_IP_TUNNELS_H */
* Unmerged path include/net/ip_tunnels.h
