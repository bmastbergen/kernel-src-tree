mpt3sas: Free memory pools before retrying to allocate with different value.

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
Rebuild_CHGLOG: - [scsi] mpt3sas: Free memory pools before retrying to allocate with different value (Tomas Henzl) [1262031]
Rebuild_FUZZ: 99.34%
commit-author Suganath prabu Subramani <suganath-prabu.subramani@avagotech.com>
commit 8ff045c92708a595b7e39d68bdc0bd7edc08a073
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/8ff045c9.failed

Deallocate resources before reallocating of the same in retry_allocation
path of _base_allocate_memory_pools()

	Signed-off-by: Suganath prabu Subramani <suganath-prabu.subramani@avagotech.com>
	Signed-off-by: Chaitra P B <chaitra.basappa@broadcom.com>
	Reviewed-by: Tomas Henzl <thenzl@redhat.com>
	Reviewed-by: Johannes Thumshirn <jthumshirn@suse.de>
	Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
(cherry picked from commit 8ff045c92708a595b7e39d68bdc0bd7edc08a073)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/scsi/mpt3sas/mpt3sas_base.c
diff --cc drivers/scsi/mpt3sas/mpt3sas_base.c
index 83f36c3c826b,5bbbbf26d2f9..000000000000
--- a/drivers/scsi/mpt3sas/mpt3sas_base.c
+++ b/drivers/scsi/mpt3sas/mpt3sas_base.c
@@@ -3344,8 -3412,9 +3344,14 @@@ _base_allocate_memory_pools(struct MPT3
  		    ioc->chains_needed_per_io, ioc->request_sz, sz/1024);
  		if (ioc->scsiio_depth < MPT3SAS_SAS_QUEUE_DEPTH)
  			goto out;
++<<<<<<< HEAD
 +		retry_sz += 64;
 +		ioc->hba_queue_depth = max_request_credit - retry_sz;
++=======
+ 		retry_sz = 64;
+ 		ioc->hba_queue_depth -= retry_sz;
+ 		_base_release_memory_pools(ioc);
++>>>>>>> 8ff045c92708 (mpt3sas: Free memory pools before retrying to allocate with different value.)
  		goto retry_allocation;
  	}
  
* Unmerged path drivers/scsi/mpt3sas/mpt3sas_base.c
