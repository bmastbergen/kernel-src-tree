s390/pci: enforce fmb page boundary rule

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
Rebuild_CHGLOG: - [s390] pci: enforce fmb page boundary rule (Hendrik Brueckner) [1330111]
Rebuild_FUZZ: 93.33%
commit-author Sebastian Ott <sebott@linux.vnet.ibm.com>
commit 80c544ded25ac14d7cc3e555abb8ed2c2da99b84
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/80c544de.failed

The function measurement block must not cross a page boundary. Ensure
that by raising the alignment requirement to the smallest power of 2
larger than the size of the fmb.

Fixes: d0b088531 ("s390/pci: performance statistics and debug infrastructure")
	Cc: stable@vger.kernel.org # v3.8+
	Signed-off-by: Sebastian Ott <sebott@linux.vnet.ibm.com>
	Signed-off-by: Martin Schwidefsky <schwidefsky@de.ibm.com>
(cherry picked from commit 80c544ded25ac14d7cc3e555abb8ed2c2da99b84)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/s390/pci/pci.c
diff --cc arch/s390/pci/pci.c
index cd007d9404d6,9fd59a7cfcd3..000000000000
--- a/arch/s390/pci/pci.c
+++ b/arch/s390/pci/pci.c
@@@ -973,13 -860,11 +973,18 @@@ static inline int barsize(u8 size
  
  static int zpci_mem_init(void)
  {
++<<<<<<< HEAD
 +	zdev_irq_cache = kmem_cache_create("PCI_IRQ_cache", sizeof(struct zdev_irq_map),
 +				L1_CACHE_BYTES, SLAB_HWCACHE_ALIGN, NULL);
 +	if (!zdev_irq_cache)
 +		goto error_zdev;
++=======
+ 	BUILD_BUG_ON(!is_power_of_2(__alignof__(struct zpci_fmb)) ||
+ 		     __alignof__(struct zpci_fmb) < sizeof(struct zpci_fmb));
++>>>>>>> 80c544ded25a (s390/pci: enforce fmb page boundary rule)
  
  	zdev_fmb_cache = kmem_cache_create("PCI_FMB_cache", sizeof(struct zpci_fmb),
- 				16, 0, NULL);
+ 					   __alignof__(struct zpci_fmb), 0, NULL);
  	if (!zdev_fmb_cache)
  		goto error_fmb;
  
diff --git a/arch/s390/include/asm/pci.h b/arch/s390/include/asm/pci.h
index bcde0abc12ed..2bad214175d5 100644
--- a/arch/s390/include/asm/pci.h
+++ b/arch/s390/include/asm/pci.h
@@ -44,7 +44,7 @@ struct zpci_fmb {
 	u64 rpcit_ops;
 	u64 dma_rbytes;
 	u64 dma_wbytes;
-} __packed __aligned(16);
+} __packed __aligned(64);
 
 struct msi_map {
 	unsigned long irq;
* Unmerged path arch/s390/pci/pci.c
