sched: Fix sched_policy < 0 comparison

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
commit-author Richard Weinberger <richard@nod.at>
commit b14ed2c273f8ab872ae4e6735fe5ab09cb14b8c3
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/b14ed2c2.failed

attr.sched_policy is u32, therefore a comparison against < 0 is never true.
Fix this by casting sched_policy to int.

This issue was reported by coverity CID 1219934.

Fixes: dbdb22754fde ("sched: Disallow sched_attr::sched_policy < 0")
	Signed-off-by: Richard Weinberger <richard@nod.at>
	Signed-off-by: Peter Zijlstra <peterz@infradead.org>
	Cc: Michael Kerrisk <mtk.manpages@gmail.com>
	Cc: Linus Torvalds <torvalds@linux-foundation.org>
Link: http://lkml.kernel.org/r/1401741514-7045-1-git-send-email-richard@nod.at
	Signed-off-by: Ingo Molnar <mingo@kernel.org>
(cherry picked from commit b14ed2c273f8ab872ae4e6735fe5ab09cb14b8c3)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	kernel/sched/core.c
diff --cc kernel/sched/core.c
index 8f3f375de9d1,540542b93f9f..000000000000
--- a/kernel/sched/core.c
+++ b/kernel/sched/core.c
@@@ -4366,6 -3666,39 +4366,42 @@@ SYSCALL_DEFINE2(sched_setparam, pid_t, 
  }
  
  /**
++<<<<<<< HEAD
++=======
+  * sys_sched_setattr - same as above, but with extended sched_attr
+  * @pid: the pid in question.
+  * @uattr: structure containing the extended parameters.
+  * @flags: for future extension.
+  */
+ SYSCALL_DEFINE3(sched_setattr, pid_t, pid, struct sched_attr __user *, uattr,
+ 			       unsigned int, flags)
+ {
+ 	struct sched_attr attr;
+ 	struct task_struct *p;
+ 	int retval;
+ 
+ 	if (!uattr || pid < 0 || flags)
+ 		return -EINVAL;
+ 
+ 	retval = sched_copy_attr(uattr, &attr);
+ 	if (retval)
+ 		return retval;
+ 
+ 	if ((int)attr.sched_policy < 0)
+ 		return -EINVAL;
+ 
+ 	rcu_read_lock();
+ 	retval = -ESRCH;
+ 	p = find_process_by_pid(pid);
+ 	if (p != NULL)
+ 		retval = sched_setattr(p, &attr);
+ 	rcu_read_unlock();
+ 
+ 	return retval;
+ }
+ 
+ /**
++>>>>>>> b14ed2c273f8 (sched: Fix sched_policy < 0 comparison)
   * sys_sched_getscheduler - get the policy (scheduling class) of a thread
   * @pid: the pid in question.
   *
* Unmerged path kernel/sched/core.c
