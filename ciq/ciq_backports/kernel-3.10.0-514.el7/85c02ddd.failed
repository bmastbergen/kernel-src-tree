mmc: tmio: tmio_mmc_host has .multi_io_quirk

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
commit-author Kuninori Morimoto <kuninori.morimoto.gx@renesas.com>
commit 85c02ddd591e5252eb1cbe8743a839638d7415fd
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/85c02ddd.failed

Current .multi_io_quirk is implemented under tmio_mmc_data.
It goes to tmio_mmc_host by this patch.

	Signed-off-by: Kuninori Morimoto <kuninori.morimoto.gx@renesas.com>
	Acked-by: Lee Jones <lee.jones@linaro.org>
	Signed-off-by: Ulf Hansson <ulf.hansson@linaro.org>
(cherry picked from commit 85c02ddd591e5252eb1cbe8743a839638d7415fd)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/mmc/host/sh_mobile_sdhi.c
#	drivers/mmc/host/tmio_mmc.h
#	include/linux/mfd/tmio.h
diff --cc drivers/mmc/host/sh_mobile_sdhi.c
index 79ee6f0c45bd,c92efe59284d..000000000000
--- a/drivers/mmc/host/sh_mobile_sdhi.c
+++ b/drivers/mmc/host/sh_mobile_sdhi.c
@@@ -154,10 -207,19 +154,26 @@@ static int sh_mobile_sdhi_probe(struct 
  		goto eclkget;
  	}
  
++<<<<<<< HEAD
 +	mmc_data->clk_enable = sh_mobile_sdhi_clk_enable;
 +	mmc_data->clk_disable = sh_mobile_sdhi_clk_disable;
 +	mmc_data->capabilities = MMC_CAP_MMC_HIGHSPEED;
 +	mmc_data->write16_hook = sh_mobile_sdhi_write16_hook;
++=======
+ 	host = tmio_mmc_host_alloc(pdev);
+ 	if (!host) {
+ 		ret = -ENOMEM;
+ 		goto eprobe;
+ 	}
+ 
+ 	host->dma		= dma_priv;
+ 	host->write16_hook	= sh_mobile_sdhi_write16_hook;
+ 	host->clk_enable	= sh_mobile_sdhi_clk_enable;
+ 	host->clk_disable	= sh_mobile_sdhi_clk_disable;
+ 	host->multi_io_quirk	= sh_mobile_sdhi_multi_io_quirk;
+ 
+ 	mmc_data->capabilities = MMC_CAP_MMC_HIGHSPEED;
++>>>>>>> 85c02ddd591e (mmc: tmio: tmio_mmc_host has .multi_io_quirk)
  	if (p) {
  		mmc_data->flags = p->tmio_flags;
  		mmc_data->ocr_mask = p->tmio_ocr_mask;
diff --cc drivers/mmc/host/tmio_mmc.h
index d857f5c6e7d9,263256c897ed..000000000000
--- a/drivers/mmc/host/tmio_mmc.h
+++ b/drivers/mmc/host/tmio_mmc.h
@@@ -85,10 -93,18 +85,20 @@@ struct tmio_mmc_host 
  	unsigned long		last_req_ts;
  	struct mutex		ios_lock;	/* protect set_ios() context */
  	bool			native_hotplug;
++<<<<<<< HEAD
++=======
+ 	bool			sdio_irq_enabled;
+ 
+ 	int (*write16_hook)(struct tmio_mmc_host *host, int addr);
+ 	int (*clk_enable)(struct platform_device *pdev, unsigned int *f);
+ 	void (*clk_disable)(struct platform_device *pdev);
+ 	int (*multi_io_quirk)(struct mmc_card *card,
+ 			      unsigned int direction, int blk_size);
++>>>>>>> 85c02ddd591e (mmc: tmio: tmio_mmc_host has .multi_io_quirk)
  };
  
 -struct tmio_mmc_host *tmio_mmc_host_alloc(struct platform_device *pdev);
 -void tmio_mmc_host_free(struct tmio_mmc_host *host);
 -int tmio_mmc_host_probe(struct tmio_mmc_host *host,
 +int tmio_mmc_host_probe(struct tmio_mmc_host **host,
 +			struct platform_device *pdev,
  			struct tmio_mmc_data *pdata);
  void tmio_mmc_host_remove(struct tmio_mmc_host *host);
  void tmio_mmc_do_data_irq(struct tmio_mmc_host *host);
diff --cc include/linux/mfd/tmio.h
index 38409958f913,3edaa17d1ccd..000000000000
--- a/include/linux/mfd/tmio.h
+++ b/include/linux/mfd/tmio.h
@@@ -109,12 -125,6 +109,15 @@@ struct tmio_mmc_data 
  	unsigned int			cd_gpio;
  	void (*set_pwr)(struct platform_device *host, int state);
  	void (*set_clk_div)(struct platform_device *host, int state);
++<<<<<<< HEAD
 +	int (*write16_hook)(struct tmio_mmc_host *host, int addr);
 +	/* clock management callbacks */
 +	int (*clk_enable)(struct platform_device *pdev, unsigned int *f);
 +	void (*clk_disable)(struct platform_device *pdev);
 +	int (*multi_io_quirk)(struct mmc_card *card,
 +			      unsigned int direction, int blk_size);
++=======
++>>>>>>> 85c02ddd591e (mmc: tmio: tmio_mmc_host has .multi_io_quirk)
  };
  
  /*
* Unmerged path drivers/mmc/host/sh_mobile_sdhi.c
* Unmerged path drivers/mmc/host/tmio_mmc.h
diff --git a/drivers/mmc/host/tmio_mmc_pio.c b/drivers/mmc/host/tmio_mmc_pio.c
index d5da81365223..c039685e7e84 100644
--- a/drivers/mmc/host/tmio_mmc_pio.c
+++ b/drivers/mmc/host/tmio_mmc_pio.c
@@ -923,10 +923,9 @@ static int tmio_multi_io_quirk(struct mmc_card *card,
 			       unsigned int direction, int blk_size)
 {
 	struct tmio_mmc_host *host = mmc_priv(card->host);
-	struct tmio_mmc_data *pdata = host->pdata;
 
-	if (pdata->multi_io_quirk)
-		return pdata->multi_io_quirk(card, direction, blk_size);
+	if (host->multi_io_quirk)
+		return host->multi_io_quirk(card, direction, blk_size);
 
 	return blk_size;
 }
* Unmerged path include/linux/mfd/tmio.h
