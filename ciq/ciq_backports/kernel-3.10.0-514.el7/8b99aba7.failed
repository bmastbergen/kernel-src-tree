ALSA: hda - Fix audio crackles on Dell Latitude E7x40

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
commit-author Takashi Iwai <tiwai@suse.de>
commit 8b99aba70c5f581860736855e211cf981f438ad2
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/8b99aba7.failed

We still got a report that the audio crackles and noises occur with
the recent 4.1 kernels on Dell machines.  These machines seem to need
similar workarounds that have been applied to the recent Dell XPS 13
models.  Since the codec of these machines (Dell Latitute E7240 and
E7440) is different from XPS 13's one, we need a new fixup entry.

Also, it was confirmed that the previous workaround to disable the
widget power-save (commit [219f47e4f964: ALSA: hda - Disable widget
power-saving for ALC292 & co]) is no longer needed after this fix.
So, this patch includes the partial revert of the commit, too.

Reported-and-tested-by: Mihai Don»õu <mihai.dontu@gmail.com>
	Tested-by: Jonathan McDowell <noodles@earth.li>
	Signed-off-by: Takashi Iwai <tiwai@suse.de>
(cherry picked from commit 8b99aba70c5f581860736855e211cf981f438ad2)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	sound/pci/hda/patch_realtek.c
diff --cc sound/pci/hda/patch_realtek.c
index 388613612f28,919051d92a0b..000000000000
--- a/sound/pci/hda/patch_realtek.c
+++ b/sound/pci/hda/patch_realtek.c
@@@ -4522,7 -4515,8 +4522,12 @@@ enum 
  	ALC288_FIXUP_DELL_HEADSET_MODE,
  	ALC288_FIXUP_DELL1_MIC_NO_PRESENCE,
  	ALC288_FIXUP_DELL_XPS_13_GPIO6,
++<<<<<<< HEAD
 +	ALC298_FIXUP_DELL1_MIC_NO_PRESENCE,
++=======
+ 	ALC292_FIXUP_DELL_E7X,
+ 	ALC292_FIXUP_DISABLE_AAMIX,
++>>>>>>> 8b99aba70c5f (ALSA: hda - Fix audio crackles on Dell Latitude E7x40)
  };
  
  static const struct hda_fixup alc269_fixups[] = {
@@@ -5051,15 -5039,15 +5056,27 @@@
  		.chained = true,
  		.chain_id = ALC288_FIXUP_DELL1_MIC_NO_PRESENCE
  	},
++<<<<<<< HEAD
 +	[ALC298_FIXUP_DELL1_MIC_NO_PRESENCE] = {
 +		.type = HDA_FIXUP_PINS,
 +		.v.pins = (const struct hda_pintbl[]) {
 +			{ 0x18, 0x01a1913c }, /* use as headset mic, without its own jack detect */
 +			{ 0x1a, 0x01a1913d }, /* use as headphone mic, without its own jack detect */
 +			{ }
 +		},
 +		.chained = true,
 +		.chain_id = ALC269_FIXUP_HEADSET_MODE
++=======
+ 	[ALC292_FIXUP_DISABLE_AAMIX] = {
+ 		.type = HDA_FIXUP_FUNC,
+ 		.v.func = alc_fixup_disable_aamix,
+ 	},
+ 	[ALC292_FIXUP_DELL_E7X] = {
+ 		.type = HDA_FIXUP_FUNC,
+ 		.v.func = alc_fixup_dell_xps13,
+ 		.chained = true,
+ 		.chain_id = ALC292_FIXUP_DISABLE_AAMIX
++>>>>>>> 8b99aba70c5f (ALSA: hda - Fix audio crackles on Dell Latitude E7x40)
  	},
  };
  
@@@ -5678,21 -5651,8 +5697,20 @@@ static int patch_alc269(struct hda_code
  
  	spec = codec->spec;
  	spec->gen.shared_mic_vref_pin = 0x18;
- 	if (codec->core.vendor_id != 0x10ec0292)
- 		codec->power_save_node = 1;
+ 	codec->power_save_node = 1;
  
 +#ifdef CONFIG_PM
 +	codec->patch_ops.suspend = alc269_suspend;
 +	codec->patch_ops.resume = alc269_resume;
 +#endif
 +	spec->shutup = alc269_shutup;
 +
 +#ifdef CONFIG_PM
 +	codec->patch_ops.suspend = alc269_suspend;
 +	codec->patch_ops.resume = alc269_resume;
 +#endif
 +	spec->shutup = alc269_shutup;
 +
  	snd_hda_pick_fixup(codec, alc269_fixup_models,
  		       alc269_fixup_tbl, alc269_fixups);
  	snd_hda_pick_pin_fixup(codec, alc269_pin_fixup_tbl, alc269_fixups);
* Unmerged path sound/pci/hda/patch_realtek.c
