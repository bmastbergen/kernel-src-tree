nvme: move to a new drivers/nvme/host directory

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
commit-author Jay Sternberg <jay.e.sternberg@intel.com>
commit 57dacad5f2288e3de91f99b29f07b4a2793446d2
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/57dacad5.failed

This patch moves the NVMe driver from drivers/block/ to its own new
drivers/nvme/host/ directory.  This is in preparation of splitting the
current monolithic driver up and add support for the upcoming NVMe
over Fabrics standard.  The drivers/nvme/host/ is chose to leave space
for a NVMe target implementation in addition to this host side driver.

	Signed-off-by: Jay Sternberg <jay.e.sternberg@intel.com>
[hch: rebased, renamed core.c to pci.c, slight tweaks]
	Signed-off-by: Christoph Hellwig <hch@lst.de>
	Acked-by: Keith Busch <keith.busch@intel.com>
	Signed-off-by: Jens Axboe <axboe@fb.com>
(cherry picked from commit 57dacad5f2288e3de91f99b29f07b4a2793446d2)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/block/Kconfig
#	drivers/block/Makefile
#	drivers/nvme/host/nvme.h
diff --cc drivers/block/Kconfig
index 35b61a28738e,29819e719afa..000000000000
--- a/drivers/block/Kconfig
+++ b/drivers/block/Kconfig
@@@ -310,16 -310,15 +310,28 @@@ config BLK_DEV_NB
  
  	  If unsure, say N.
  
++<<<<<<< HEAD
 +config BLK_DEV_NVME
 +	tristate "NVM Express block device"
 +	depends on PCI
 +	---help---
 +	  The NVM Express driver is for solid state drives directly
 +	  connected to the PCI or PCI Express bus.  If you know you
 +	  don't have one of these, it is safe to answer N.
 +
 +	  To compile this driver as a module, choose M here: the
 +	  module will be called nvme.
++=======
+ config BLK_DEV_SKD
+ 	tristate "STEC S1120 Block Driver"
+ 	depends on PCI
+ 	depends on 64BIT
+ 	---help---
+ 	Saying Y or M here will enable support for the
+ 	STEC, Inc. S1120 PCIe SSD.
+ 
+ 	Use device /dev/skd$N amd /dev/skd$Np$M.
++>>>>>>> 57dacad5f228 (nvme: move to a new drivers/nvme/host directory)
  
  config BLK_DEV_OSD
  	tristate "OSD object-as-blkdev support"
diff --cc drivers/block/Makefile
index ee7f36c63316,671329023ec2..000000000000
--- a/drivers/block/Makefile
+++ b/drivers/block/Makefile
@@@ -22,7 -22,7 +22,11 @@@ obj-$(CONFIG_XILINX_SYSACE)	+= xsysace.
  obj-$(CONFIG_CDROM_PKTCDVD)	+= pktcdvd.o
  obj-$(CONFIG_MG_DISK)		+= mg_disk.o
  obj-$(CONFIG_SUNVDC)		+= sunvdc.o
++<<<<<<< HEAD
 +obj-$(CONFIG_BLK_DEV_NVME)	+= nvme.o
++=======
+ obj-$(CONFIG_BLK_DEV_SKD)	+= skd.o
++>>>>>>> 57dacad5f228 (nvme: move to a new drivers/nvme/host directory)
  obj-$(CONFIG_BLK_DEV_OSD)	+= osdblk.o
  
  obj-$(CONFIG_BLK_DEV_UMEM)	+= umem.o
@@@ -44,5 -43,5 +48,9 @@@ obj-$(CONFIG_BLK_DEV_RSXX) += rsxx
  obj-$(CONFIG_BLK_DEV_NULL_BLK)	+= null_blk.o
  obj-$(CONFIG_ZRAM) += zram/
  
++<<<<<<< HEAD
 +nvme-y		:= nvme-core.o nvme-scsi.o
++=======
+ skd-y		:= skd_main.o
++>>>>>>> 57dacad5f228 (nvme: move to a new drivers/nvme/host directory)
  swim_mod-y	:= swim.o swim_asm.o
* Unmerged path drivers/nvme/host/nvme.h
diff --git a/MAINTAINERS b/MAINTAINERS
index 45e81f2028fc..9cff36409d91 100644
--- a/MAINTAINERS
+++ b/MAINTAINERS
@@ -5850,7 +5850,7 @@ M:	Matthew Wilcox <willy@linux.intel.com>
 L:	linux-nvme@lists.infradead.org
 T:	git git://git.infradead.org/users/willy/linux-nvme.git
 S:	Supported
-F:	drivers/block/nvme*
+F:	drivers/nvme/host/
 F:	include/linux/nvme.h
 
 OMAP SUPPORT
diff --git a/drivers/Kconfig b/drivers/Kconfig
index 9ab57d8e708f..2bc67980e392 100644
--- a/drivers/Kconfig
+++ b/drivers/Kconfig
@@ -16,6 +16,8 @@ source "drivers/pnp/Kconfig"
 
 source "drivers/block/Kconfig"
 
+source "drivers/nvme/Kconfig"
+
 # misc before ide - BLK_DEV_SGIIOC4 depends on SGI_IOC4
 
 source "drivers/misc/Kconfig"
diff --git a/drivers/Makefile b/drivers/Makefile
index 4e4360508dbf..c064dbe7916d 100644
--- a/drivers/Makefile
+++ b/drivers/Makefile
@@ -60,6 +60,7 @@ obj-$(CONFIG_NUBUS)		+= nubus/
 obj-y				+= macintosh/
 obj-$(CONFIG_IDE)		+= ide/
 obj-$(CONFIG_SCSI)		+= scsi/
+obj-y				+= nvme/
 obj-$(CONFIG_ATA)		+= ata/
 obj-$(CONFIG_TARGET_CORE)	+= target/
 obj-$(CONFIG_MTD)		+= mtd/
* Unmerged path drivers/block/Kconfig
* Unmerged path drivers/block/Makefile
diff --git a/drivers/nvme/Kconfig b/drivers/nvme/Kconfig
new file mode 100644
index 000000000000..a39d9431eaec
--- /dev/null
+++ b/drivers/nvme/Kconfig
@@ -0,0 +1 @@
+source "drivers/nvme/host/Kconfig"
diff --git a/drivers/nvme/Makefile b/drivers/nvme/Makefile
new file mode 100644
index 000000000000..9421e829d2a9
--- /dev/null
+++ b/drivers/nvme/Makefile
@@ -0,0 +1,2 @@
+
+obj-y		+= host/
diff --git a/drivers/nvme/host/Kconfig b/drivers/nvme/host/Kconfig
new file mode 100644
index 000000000000..0089f78b4071
--- /dev/null
+++ b/drivers/nvme/host/Kconfig
@@ -0,0 +1,10 @@
+config BLK_DEV_NVME
+	tristate "NVM Express block device"
+	depends on PCI
+	---help---
+	  The NVM Express driver is for solid state drives directly
+	  connected to the PCI or PCI Express bus.  If you know you
+	  don't have one of these, it is safe to answer N.
+
+	  To compile this driver as a module, choose M here: the
+	  module will be called nvme.
diff --git a/drivers/nvme/host/Makefile b/drivers/nvme/host/Makefile
new file mode 100644
index 000000000000..cfb6679ec245
--- /dev/null
+++ b/drivers/nvme/host/Makefile
@@ -0,0 +1,4 @@
+
+obj-$(CONFIG_BLK_DEV_NVME)     += nvme.o
+
+nvme-y		+= pci.o scsi.o
* Unmerged path drivers/nvme/host/nvme.h
diff --git a/drivers/block/nvme-core.c b/drivers/nvme/host/pci.c
similarity index 100%
rename from drivers/block/nvme-core.c
rename to drivers/nvme/host/pci.c
diff --git a/drivers/block/nvme-scsi.c b/drivers/nvme/host/scsi.c
similarity index 100%
rename from drivers/block/nvme-scsi.c
rename to drivers/nvme/host/scsi.c
