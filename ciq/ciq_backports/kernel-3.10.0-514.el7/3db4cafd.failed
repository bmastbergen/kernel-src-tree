x86/boot: Fix non-EFI build

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
Rebuild_CHGLOG: - [x86] boot: Fix non-EFI build (Lenny Szubowicz) [1310154]
Rebuild_FUZZ: 92.00%
commit-author Matt Fleming <matt.fleming@intel.com>
commit 3db4cafdfd05717dc939780134e53023a3c1f15f
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/3db4cafd.failed

The kbuild test robot reported the following errors, introduced with
commit 54b52d872680 ("x86/efi: Build our own EFI services pointer
table"),

 arch/x86/boot/compressed/head_32.o: In function `efi32_config':
>> (.data+0x58): undefined reference to `efi_call_phys'

 arch/x86/boot/compressed/head_64.o: In function `efi64_config':
>> (.data+0x90): undefined reference to `efi_call6'

Wrap the efi*_config structures in #ifdef CONFIG_EFI_STUB so that we
don't make references to EFI functions if they're not compiled in.

	Signed-off-by: Matt Fleming <matt.fleming@intel.com>
(cherry picked from commit 3db4cafdfd05717dc939780134e53023a3c1f15f)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/x86/boot/compressed/head_32.S
#	arch/x86/boot/compressed/head_64.S
diff --cc arch/x86/boot/compressed/head_32.S
index 1e3184f6072f,de9d4200d305..000000000000
--- a/arch/x86/boot/compressed/head_32.S
+++ b/arch/x86/boot/compressed/head_32.S
@@@ -223,7 -227,16 +223,20 @@@ relocated
   * Jump to the decompressed kernel.
   */
  	xorl	%ebx, %ebx
++<<<<<<< HEAD
 +	jmp	*%ebp
++=======
+ 	jmp	*%eax
+ 
+ #ifdef CONFIG_EFI_STUB
+ 	.data
+ efi32_config:
+ 	.fill 11,8,0
+ 	.long efi_call_phys
+ 	.long 0
+ 	.byte 0
+ #endif
++>>>>>>> 3db4cafdfd05 (x86/boot: Fix non-EFI build)
  
  /*
   * Stack and heap for uncompression
diff --cc arch/x86/boot/compressed/head_64.S
index a71d43a7a6b9,57e58a5fa210..000000000000
--- a/arch/x86/boot/compressed/head_64.S
+++ b/arch/x86/boot/compressed/head_64.S
@@@ -370,6 -440,25 +370,28 @@@ gdt
  	.quad   0x0000000000000000	/* TS continued */
  gdt_end:
  
++<<<<<<< HEAD
++=======
+ #ifdef CONFIG_EFI_STUB
+ efi_config:
+ 	.quad	0
+ 
+ #ifdef CONFIG_EFI_MIXED
+ 	.global efi32_config
+ efi32_config:
+ 	.fill	11,8,0
+ 	.quad	efi64_thunk
+ 	.byte	0
+ #endif
+ 
+ 	.global efi64_config
+ efi64_config:
+ 	.fill	11,8,0
+ 	.quad	efi_call6
+ 	.byte	1
+ #endif /* CONFIG_EFI_STUB */
+ 
++>>>>>>> 3db4cafdfd05 (x86/boot: Fix non-EFI build)
  /*
   * Stack and heap for uncompression
   */
* Unmerged path arch/x86/boot/compressed/head_32.S
* Unmerged path arch/x86/boot/compressed/head_64.S
