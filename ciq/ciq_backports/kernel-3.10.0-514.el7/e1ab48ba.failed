perf record: Introduce record__finish_output() to finish a perf.data

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
commit-author Wang Nan <wangnan0@huawei.com>
commit e1ab48ba63ee6b2494a67bb60bf99692ecdaca7c
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/e1ab48ba.failed

Move code for finalizing 'perf.data' to record__finish_output(). It will
be used by following commits to split output to multiple files.

	Signed-off-by: He Kuang <hekuang@huawei.com>
	Cc: Alexei Starovoitov <ast@kernel.org>
	Cc: He Kuang <hekuang@huawei.com>
	Cc: Jiri Olsa <jolsa@kernel.org>
	Cc: Li Zefan <lizefan@huawei.com>
	Cc: Masami Hiramatsu <masami.hiramatsu.pt@hitachi.com>
	Cc: Namhyung Kim <namhyung@kernel.org>
	Cc: Peter Zijlstra <peterz@infradead.org>
	Cc: Zefan Li <lizefan@huawei.com>
	Cc: pi3orama@163.com
Link: http://lkml.kernel.org/r/1456479154-136027-23-git-send-email-wangnan0@huawei.com
	Signed-off-by: Wang Nan <wangnan0@huawei.com>
	Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>
(cherry picked from commit e1ab48ba63ee6b2494a67bb60bf99692ecdaca7c)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	tools/perf/builtin-record.c
diff --cc tools/perf/builtin-record.c
index 9631fc84ef82,46e2772f838e..000000000000
--- a/tools/perf/builtin-record.c
+++ b/tools/perf/builtin-record.c
@@@ -662,22 -808,8 +685,27 @@@ out_child
  	/* this will be recalculated during process_buildids() */
  	rec->samples = 0;
  
++<<<<<<< HEAD
 +	if (!err && !file->is_pipe) {
 +		rec->session->header.data_size += rec->bytes_written;
 +		file->size = lseek(perf_data_file__fd(file), 0, SEEK_CUR);
 +
 +		if (!rec->no_buildid) {
 +			process_buildids(rec);
 +			/*
 +			 * We take all buildids when the file contains
 +			 * AUX area tracing data because we do not decode the
 +			 * trace because it would take too long.
 +			 */
 +			if (rec->opts.full_auxtrace)
 +				dsos__hit_all(rec->session);
 +		}
 +		perf_session__write_header(rec->session, rec->evlist, fd, true);
 +	}
++=======
+ 	if (!err)
+ 		record__finish_output(rec);
++>>>>>>> e1ab48ba63ee (perf record: Introduce record__finish_output() to finish a perf.data)
  
  	if (!err && !quiet) {
  		char samples[128];
* Unmerged path tools/perf/builtin-record.c
