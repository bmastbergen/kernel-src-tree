perf report: Fix a bug on "--call-graph none" option

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
commit-author Namhyung Kim <namhyung@kernel.org>
commit 208e7607459477432d3df52c32d4b961a96d4a94
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/208e7607.failed

The patch f9db0d0f1b2c ("perf callchain: Allow disabling call graphs
per event") added an ability to enable/disable callchain recording per
event.  But it had a problem when the enablement setting is changed at
'perf report' time using -g/--call-graph option.

For example, the following scenario will get a segfault.

  $ perf record -ag sleep 1
  [ perf record: Woken up 1 times to write data ]
  [ perf record: Captured and wrote 0.500 MB perf.data (2555 samples) ]

  $ perf report -g none
  perf: Segmentation fault
  -------- backtrace --------
  perf[0x53a98a]
  /usr/lib/libc.so.6(+0x335af)[0x7f4e91df95af]

This is because callchain_param.sort() callback was not set but it
tried to call the function as it had the PERF_SAMPLE_CALLCHAIN bit.

	Signed-off-by: Namhyung Kim <namhyung@kernel.org>
	Tested-by: Arnaldo Carvalho de Melo <acme@redhat.com>
	Cc: Jiri Olsa <jolsa@redhat.com>
	Cc: Kan Liang <kan.liang@intel.com>
	Cc: Peter Zijlstra <a.p.zijlstra@chello.nl>
Fixes: f9db0d0f1b2c ("perf callchain: Allow disabling call graphs per event")
Link: http://lkml.kernel.org/r/1443587640-24242-1-git-send-email-namhyung@kernel.org
	Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>
(cherry picked from commit 208e7607459477432d3df52c32d4b961a96d4a94)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	tools/perf/util/hist.c
diff --cc tools/perf/util/hist.c
index f72bd44173a7,c346b331b892..000000000000
--- a/tools/perf/util/hist.c
+++ b/tools/perf/util/hist.c
@@@ -1143,6 -1148,13 +1143,16 @@@ void hists__output_resort(struct hists 
  	struct rb_node *next;
  	struct hist_entry *n;
  	u64 min_callchain_hits;
++<<<<<<< HEAD
++=======
+ 	struct perf_evsel *evsel = hists_to_evsel(hists);
+ 	bool use_callchain;
+ 
+ 	if (evsel && symbol_conf.use_callchain && !symbol_conf.show_ref_callgraph)
+ 		use_callchain = evsel->attr.sample_type & PERF_SAMPLE_CALLCHAIN;
+ 	else
+ 		use_callchain = symbol_conf.use_callchain;
++>>>>>>> 208e76074594 (perf report: Fix a bug on "--call-graph none" option)
  
  	min_callchain_hits = hists->stats.total_period * (callchain_param.min_percent / 100);
  
* Unmerged path tools/perf/util/hist.c
