ovl: clear nlink on rmdir

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
commit-author Miklos Szeredi <mszeredi@redhat.com>
commit dbc816d05ddcfb189af8784d04fc84c812db3747
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/dbc816d0.failed

To make delete notification work on fa/inotify.

	Signed-off-by: Miklos Szeredi <mszeredi@redhat.com>
(cherry picked from commit dbc816d05ddcfb189af8784d04fc84c812db3747)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	fs/overlayfs/dir.c
diff --cc fs/overlayfs/dir.c
index 02a117bdec65,ddda948109d3..000000000000
--- a/fs/overlayfs/dir.c
+++ b/fs/overlayfs/dir.c
@@@ -645,14 -689,18 +645,23 @@@ static int ovl_do_remove(struct dentry 
  		goto out_drop_write;
  
  	type = ovl_path_type(dentry);
 -
 -	old_cred = ovl_override_creds(dentry->d_sb);
 -	if (OVL_TYPE_PURE_UPPER(type))
 +	if (OVL_TYPE_PURE_UPPER(type)) {
  		err = ovl_remove_upper(dentry, is_dir);
 -	else
 +	} else {
 +		const struct cred *old_cred = ovl_override_creds(dentry->d_sb);
 +
  		err = ovl_remove_and_whiteout(dentry, is_dir);
++<<<<<<< HEAD
 +
 +		revert_creds(old_cred);
++=======
+ 	revert_creds(old_cred);
+ 	if (!err) {
+ 		if (is_dir)
+ 			clear_nlink(dentry->d_inode);
+ 		else
+ 			drop_nlink(dentry->d_inode);
++>>>>>>> dbc816d05ddc (ovl: clear nlink on rmdir)
  	}
  out_drop_write:
  	ovl_drop_write(dentry);
* Unmerged path fs/overlayfs/dir.c
