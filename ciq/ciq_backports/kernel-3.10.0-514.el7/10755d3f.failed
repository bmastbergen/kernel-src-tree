bnx2fc: Add driver tunables.

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
Rebuild_CHGLOG: - [scsi] bnx2fc: Add driver tunables (Maurizio Lombardi) [1273084]
Rebuild_FUZZ: 98.18%
commit-author Joe Carnuccio <joe.carnuccio@qlogic.com>
commit 10755d3f47a9b28639f2e3d29a09ff2a0969657d
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/10755d3f.failed

Per customer request, add the following driver tunables:

o devloss_tmo
o max_luns
o queue_depth
o tm_timeout

tm_timeout is set per scsi_host in /sys/class/scsi_host/hostX/tm_timeout.

	Signed-off-by: Joe Carnuccio <joe.carnuccio@qlogic.com>
	Signed-off-by: Chad Dupuis <chad.dupuis@qlogic.com>
	Reviewed-by: Johannes Thumshirn <jthumshirn@suse.de>
	Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
(cherry picked from commit 10755d3f47a9b28639f2e3d29a09ff2a0969657d)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/scsi/bnx2fc/bnx2fc_fcoe.c
diff --cc drivers/scsi/bnx2fc/bnx2fc_fcoe.c
index 60691bc1f65e,b0305b0fd21c..000000000000
--- a/drivers/scsi/bnx2fc/bnx2fc_fcoe.c
+++ b/drivers/scsi/bnx2fc/bnx2fc_fcoe.c
@@@ -2877,6 -2951,9 +2952,12 @@@ static struct scsi_host_template bnx2fc
  	.use_clustering		= ENABLE_CLUSTERING,
  	.sg_tablesize		= BNX2FC_MAX_BDS_PER_CMD,
  	.max_sectors		= 1024,
++<<<<<<< HEAD
++=======
+ 	.track_queue_depth	= 1,
+ 	.slave_configure	= bnx2fc_slave_configure,
+ 	.shost_attrs		= bnx2fc_host_attrs,
++>>>>>>> 10755d3f47a9 (bnx2fc: Add driver tunables.)
  };
  
  static struct libfc_function_template bnx2fc_libfc_fcn_templ = {
diff --git a/drivers/scsi/bnx2fc/bnx2fc.h b/drivers/scsi/bnx2fc/bnx2fc.h
index 499e369eabf0..106788f304d6 100644
--- a/drivers/scsi/bnx2fc/bnx2fc.h
+++ b/drivers/scsi/bnx2fc/bnx2fc.h
@@ -261,6 +261,7 @@ struct bnx2fc_interface {
 	u8 vlan_enabled;
 	int vlan_id;
 	bool enabled;
+	u8 tm_timeout;
 };
 
 #define bnx2fc_from_ctlr(x)			\
* Unmerged path drivers/scsi/bnx2fc/bnx2fc_fcoe.c
diff --git a/drivers/scsi/bnx2fc/bnx2fc_io.c b/drivers/scsi/bnx2fc/bnx2fc_io.c
index 59b90678a56d..74e904119a7d 100644
--- a/drivers/scsi/bnx2fc/bnx2fc_io.c
+++ b/drivers/scsi/bnx2fc/bnx2fc_io.c
@@ -770,7 +770,7 @@ retry_tmf:
 	spin_unlock_bh(&tgt->tgt_lock);
 
 	rc = wait_for_completion_timeout(&io_req->tm_done,
-					 BNX2FC_TM_TIMEOUT * HZ);
+					 interface->tm_timeout * HZ);
 	spin_lock_bh(&tgt->tgt_lock);
 
 	io_req->wait_for_comp = 0;
