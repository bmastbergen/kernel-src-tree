iommu/amd: Introduce protection_domain_init() function

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
Rebuild_CHGLOG: - [iommu] amd: Introduce protection_domain_init() function (Myron Stowe) [1050021]
Rebuild_FUZZ: 94.12%
commit-author Joerg Roedel <jroedel@suse.de>
commit 7a5a566eab48da7522f601f96aef3af102178046
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/7a5a566e.failed

This function contains the common parts between the
initialization of dma_ops_domains and usual protection
domains. This also fixes a long-standing bug which was
uncovered by recent changes, in which the api_lock was not
initialized for dma_ops_domains.

	Reported-by: George Wang <xuw2015@gmail.com>
	Tested-by: George Wang <xuw2015@gmail.com>
	Signed-off-by: Joerg Roedel <jroedel@suse.de>
(cherry picked from commit 7a5a566eab48da7522f601f96aef3af102178046)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/iommu/amd_iommu.c
diff --cc drivers/iommu/amd_iommu.c
index ec80b60ecc11,cedbf004c8ef..000000000000
--- a/drivers/iommu/amd_iommu.c
+++ b/drivers/iommu/amd_iommu.c
@@@ -119,7 -115,8 +119,12 @@@ struct iommu_cmd 
  struct kmem_cache *amd_iommu_irq_cache;
  
  static void update_domain(struct protection_domain *domain);
++<<<<<<< HEAD
 +static int __init alloc_passthrough_domain(void);
++=======
+ static int alloc_passthrough_domain(void);
+ static int protection_domain_init(struct protection_domain *domain);
++>>>>>>> 7a5a566eab48 (iommu/amd: Introduce protection_domain_init() function)
  
  /****************************************************************************
   *
* Unmerged path drivers/iommu/amd_iommu.c
