ovl: copy new uid/gid into overlayfs runtime inode

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
commit-author Konstantin Khlebnikov <koct9i@gmail.com>
commit b81de061fa59f17d2730aabb1b84419ef3913810
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/b81de061.failed

Overlayfs must update uid/gid after chown, otherwise functions
like inode_owner_or_capable() will check user against stale uid.
Catched by xfstests generic/087, it chowns file and calls utimes.

	Signed-off-by: Konstantin Khlebnikov <koct9i@gmail.com>
	Signed-off-by: Miklos Szeredi <miklos@szeredi.hu>
	Cc: <stable@vger.kernel.org>
(cherry picked from commit b81de061fa59f17d2730aabb1b84419ef3913810)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	fs/overlayfs/inode.c
diff --cc fs/overlayfs/inode.c
index 5c77b4f87340,a4ff5d0d7db9..000000000000
--- a/fs/overlayfs/inode.c
+++ b/fs/overlayfs/inode.c
@@@ -53,9 -63,11 +53,15 @@@ int ovl_setattr(struct dentry *dentry, 
  	if (!err) {
  		upperdentry = ovl_dentry_upper(dentry);
  
 -		inode_lock(upperdentry->d_inode);
 +		mutex_lock(&upperdentry->d_inode->i_mutex);
  		err = notify_change(upperdentry, attr, NULL);
++<<<<<<< HEAD
 +		mutex_unlock(&upperdentry->d_inode->i_mutex);
++=======
+ 		if (!err)
+ 			ovl_copyattr(upperdentry->d_inode, dentry->d_inode);
+ 		inode_unlock(upperdentry->d_inode);
++>>>>>>> b81de061fa59 (ovl: copy new uid/gid into overlayfs runtime inode)
  	}
  	ovl_drop_write(dentry);
  out:
* Unmerged path fs/overlayfs/inode.c
