ceph: add missing init_acl() for mkdir() and atomic_open()

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
commit-author Yan, Zheng <zheng.z.yan@intel.com>
commit b20a95a0dd47c56c5d20e1c9e260293d0b87abe0
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/b20a95a0.failed

	Signed-off-by: Yan, Zheng <zheng.z.yan@intel.com>
(cherry picked from commit b20a95a0dd47c56c5d20e1c9e260293d0b87abe0)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	fs/ceph/dir.c
diff --cc fs/ceph/dir.c
index 67bdd35eda74,2e3b30dcfc94..000000000000
--- a/fs/ceph/dir.c
+++ b/fs/ceph/dir.c
@@@ -727,7 -693,10 +727,14 @@@ static int ceph_mknod(struct inode *dir
  	if (!err && !req->r_reply_info.head->is_dentry)
  		err = ceph_handle_notrace_create(dir, dentry);
  	ceph_mdsc_put_request(req);
++<<<<<<< HEAD
 +	if (err)
++=======
+ 
+ 	if (!err)
+ 		ceph_init_acl(dentry, dentry->d_inode, dir);
+ 	else
++>>>>>>> b20a95a0dd47 (ceph: add missing init_acl() for mkdir() and atomic_open())
  		d_drop(dentry);
  	return err;
  }
@@@ -770,8 -734,9 +777,14 @@@ static int ceph_symlink(struct inode *d
  	if (!err && !req->r_reply_info.head->is_dentry)
  		err = ceph_handle_notrace_create(dir, dentry);
  	ceph_mdsc_put_request(req);
++<<<<<<< HEAD
 +out:
 +	if (err)
++=======
+ 	if (!err)
+ 		ceph_init_acl(dentry, dentry->d_inode, dir);
+ 	else
++>>>>>>> b20a95a0dd47 (ceph: add missing init_acl() for mkdir() and atomic_open())
  		d_drop(dentry);
  	return err;
  }
* Unmerged path fs/ceph/dir.c
diff --git a/fs/ceph/file.c b/fs/ceph/file.c
index 0c3070bb755c..9cb61d074800 100644
--- a/fs/ceph/file.c
+++ b/fs/ceph/file.c
@@ -269,6 +269,7 @@ int ceph_atomic_open(struct inode *dir, struct dentry *dentry,
 	} else {
 		dout("atomic_open finish_open on dn %p\n", dn);
 		if (req->r_op == CEPH_MDS_OP_CREATE && req->r_reply_info.has_create_ino) {
+			ceph_init_acl(dentry, dentry->d_inode, dir);
 			*opened |= FILE_CREATED;
 		}
 		err = finish_open(file, dentry, ceph_open, opened);
