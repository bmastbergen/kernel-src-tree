net: move napi_hash[] into read mostly section

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
Rebuild_CHGLOG: - [net] move napi_hash[] into read mostly section (Ivan Vecera) [1268334]
Rebuild_FUZZ: 90.48%
commit-author Eric Dumazet <edumazet@google.com>
commit 6180d9de61a5c461f9e3efef5417a844701dbbb2
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/6180d9de.failed

We do not often add/delete a napi context.
Moving napi_hash[] into read mostly section avoids potential false sharing.

	Signed-off-by: Eric Dumazet <edumazet@google.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 6180d9de61a5c461f9e3efef5417a844701dbbb2)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/core/dev.c
diff --cc net/core/dev.c
index ab84e718fe49,02dfbd91a8e4..000000000000
--- a/net/core/dev.c
+++ b/net/core/dev.c
@@@ -174,10 -183,10 +174,15 @@@ EXPORT_SYMBOL(dev_base_lock)
  /* protects napi_hash addition/deletion and napi_gen_id */
  static DEFINE_SPINLOCK(napi_hash_lock);
  
++<<<<<<< HEAD
 +static unsigned int napi_gen_id;
 +static DEFINE_HASHTABLE(napi_hash, 8);
++=======
+ static unsigned int napi_gen_id = NR_CPUS;
+ static DEFINE_READ_MOSTLY_HASHTABLE(napi_hash, 8);
++>>>>>>> 6180d9de61a5 (net: move napi_hash[] into read mostly section)
  
 -static seqcount_t devnet_rename_seq;
 +seqcount_t devnet_rename_seq;
  
  static inline void dev_base_seq_inc(struct net *net)
  {
diff --git a/include/linux/hashtable.h b/include/linux/hashtable.h
index 519b6e2d769e..661e5c2a8e2a 100644
--- a/include/linux/hashtable.h
+++ b/include/linux/hashtable.h
@@ -16,6 +16,10 @@
 	struct hlist_head name[1 << (bits)] =					\
 			{ [0 ... ((1 << (bits)) - 1)] = HLIST_HEAD_INIT }
 
+#define DEFINE_READ_MOSTLY_HASHTABLE(name, bits)				\
+	struct hlist_head name[1 << (bits)] __read_mostly =			\
+			{ [0 ... ((1 << (bits)) - 1)] = HLIST_HEAD_INIT }
+
 #define DECLARE_HASHTABLE(name, bits)                                   	\
 	struct hlist_head name[1 << (bits)]
 
* Unmerged path net/core/dev.c
