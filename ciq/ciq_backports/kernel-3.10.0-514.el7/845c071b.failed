usb: musb: Rework USB and USB_GADGET dependency

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
Rebuild_CHGLOG: - [usb] musb: Rework USB and USB_GADGET dependency (Don Zickus) [1303209]
Rebuild_FUZZ: 94.38%
commit-author Ezequiel Garcia <ezequiel.garcia@free-electrons.com>
commit 845c071b7853c0046693022f4e95c9cdd043e2db
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/845c071b.failed

This USB controller can work in as host-only, gadget-only or dual-role
modes. Rework the dependency on the USB and USB_GADGET configs in order
to allow building the driver when !USB or !USG_GADGET.

	Signed-off-by: Ezequiel Garcia <ezequiel.garcia@free-electrons.com>
	Signed-off-by: Felipe Balbi <balbi@ti.com>
(cherry picked from commit 845c071b7853c0046693022f4e95c9cdd043e2db)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/usb/musb/Kconfig
diff --cc drivers/usb/musb/Kconfig
index 06f8d29af1ef,688dc8bb192d..000000000000
--- a/drivers/usb/musb/Kconfig
+++ b/drivers/usb/musb/Kconfig
@@@ -28,6 -28,35 +28,38 @@@ config USB_MUSB_HDR
  if USB_MUSB_HDRC
  
  choice
++<<<<<<< HEAD
++=======
+ 	bool "MUSB Mode Selection"
+ 	default USB_MUSB_DUAL_ROLE if (USB && USB_GADGET)
+ 	default USB_MUSB_HOST if (USB && !USB_GADGET)
+ 	default USB_MUSB_GADGET if (!USB && USB_GADGET)
+ 
+ config USB_MUSB_HOST
+ 	bool "Host only mode"
+ 	depends on USB=y || USB=USB_MUSB_HDRC
+ 	help
+ 	  Select this when you want to use MUSB in host mode only,
+ 	  thereby the gadget feature will be regressed.
+ 
+ config USB_MUSB_GADGET
+ 	bool "Gadget only mode"
+ 	depends on USB_GADGET=y || USB_GADGET=USB_MUSB_HDRC
+ 	help
+ 	  Select this when you want to use MUSB in gadget mode only,
+ 	  thereby the host feature will be regressed.
+ 
+ config USB_MUSB_DUAL_ROLE
+ 	bool "Dual Role mode"
+ 	depends on ((USB=y || USB=USB_MUSB_HDRC) && (USB_GADGET=y || USB_GADGET=USB_MUSB_HDRC))
+ 	help
+ 	  This is the default mode of working of MUSB controller where
+ 	  both host and gadget features are enabled.
+ 
+ endchoice
+ 
+ choice
++>>>>>>> 845c071b7853 (usb: musb: Rework USB and USB_GADGET dependency)
  	prompt "Platform Glue Layer"
  
  config USB_MUSB_DAVINCI
diff --git a/drivers/usb/Kconfig b/drivers/usb/Kconfig
index 8aa8f734f7c7..17b1dbd46a56 100644
--- a/drivers/usb/Kconfig
+++ b/drivers/usb/Kconfig
@@ -94,8 +94,6 @@ source "drivers/usb/wusbcore/Kconfig"
 
 source "drivers/usb/host/Kconfig"
 
-source "drivers/usb/musb/Kconfig"
-
 source "drivers/usb/renesas_usbhs/Kconfig"
 
 source "drivers/usb/class/Kconfig"
@@ -106,6 +104,8 @@ source "drivers/usb/image/Kconfig"
 
 endif
 
+source "drivers/usb/musb/Kconfig"
+
 source "drivers/usb/dwc3/Kconfig"
 
 source "drivers/usb/chipidea/Kconfig"
* Unmerged path drivers/usb/musb/Kconfig
