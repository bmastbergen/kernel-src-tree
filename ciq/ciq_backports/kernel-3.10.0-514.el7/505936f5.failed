SUNRPC: Cleanup to remove remaining uses of XPRT_CONNECTION_ABORT

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
commit-author Trond Myklebust <trond.myklebust@primarydata.com>
commit 505936f59f1e4cd0ff92ae5abc7aae64fb74dbdb
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/505936f5.failed

	Signed-off-by: Trond Myklebust <trond.myklebust@primarydata.com>
(cherry picked from commit 505936f59f1e4cd0ff92ae5abc7aae64fb74dbdb)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/sunrpc/xprtsock.c
diff --cc net/sunrpc/xprtsock.c
index 44e3d5b48882,2f8db3499a17..000000000000
--- a/net/sunrpc/xprtsock.c
+++ b/net/sunrpc/xprtsock.c
@@@ -860,6 -801,15 +860,18 @@@ static void xs_error_report(struct soc
  	read_unlock_bh(&sk->sk_callback_lock);
  }
  
++<<<<<<< HEAD
++=======
+ static void xs_sock_reset_connection_flags(struct rpc_xprt *xprt)
+ {
+ 	smp_mb__before_atomic();
+ 	clear_bit(XPRT_CONNECTION_CLOSE, &xprt->state);
+ 	clear_bit(XPRT_CLOSE_WAIT, &xprt->state);
+ 	clear_bit(XPRT_CLOSING, &xprt->state);
+ 	smp_mb__after_atomic();
+ }
+ 
++>>>>>>> 505936f59f1e (SUNRPC: Cleanup to remove remaining uses of XPRT_CONNECTION_ABORT)
  static void xs_reset_transport(struct sock_xprt *transport)
  {
  	struct socket *sock = transport->sock;
@@@ -1992,9 -1903,6 +2004,12 @@@ static int xs_local_setup_socket(struc
  	struct socket *sock;
  	int status = -EIO;
  
++<<<<<<< HEAD
 +	current->flags |= PF_FSTRANS;
 +
 +	clear_bit(XPRT_CONNECTION_ABORT, &xprt->state);
++=======
++>>>>>>> 505936f59f1e (SUNRPC: Cleanup to remove remaining uses of XPRT_CONNECTION_ABORT)
  	status = __sock_create(xprt->xprt_net, AF_LOCAL,
  					SOCK_STREAM, 0, &sock, 1);
  	if (status < 0) {
@@@ -2245,10 -2146,7 +2260,9 @@@ static void xs_tcp_setup_socket(struct 
  	struct rpc_xprt *xprt = &transport->xprt;
  	int status = -EIO;
  
 +	current->flags |= PF_FSTRANS;
 +
  	if (!sock) {
- 		clear_bit(XPRT_CONNECTION_ABORT, &xprt->state);
  		sock = xs_create_sock(xprt, transport,
  				xs_addr(xprt)->sa_family, SOCK_STREAM,
  				IPPROTO_TCP, true);
diff --git a/include/linux/sunrpc/xprt.h b/include/linux/sunrpc/xprt.h
index d809b906cb69..49620b46f49d 100644
--- a/include/linux/sunrpc/xprt.h
+++ b/include/linux/sunrpc/xprt.h
@@ -360,7 +360,6 @@ void			xprt_unlock_connect(struct rpc_xprt *, void *);
 #define XPRT_BOUND		(4)
 #define XPRT_BINDING		(5)
 #define XPRT_CLOSING		(6)
-#define XPRT_CONNECTION_ABORT	(7)
 #define XPRT_CONNECTION_CLOSE	(8)
 #define XPRT_CONGESTED		(9)
 
* Unmerged path net/sunrpc/xprtsock.c
