ipv4: ip_tunnel: use net namespace from rtable not socket

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
commit-author Hannes Frederic Sowa <hannes@stressinduktion.org>
commit 926a882f6916fd76b6f8ee858d45a2241c5e7999
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/926a882f.failed

The socket parameter might legally be NULL, thus sock_net is sometimes
causing a NULL pointer dereference. Using net_device pointer in dst_entry
is more reliable.

Fixes: b6a7719aedd7e5c ("ipv4: hash net ptr into fragmentation bucket selection")
	Reported-by: Rick Jones <rick.jones2@hp.com>
	Cc: Rick Jones <rick.jones2@hp.com>
	Cc: David S. Miller <davem@davemloft.net>
	Signed-off-by: Hannes Frederic Sowa <hannes@stressinduktion.org>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 926a882f6916fd76b6f8ee858d45a2241c5e7999)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/ipv4/ip_tunnel_core.c
diff --cc net/ipv4/ip_tunnel_core.c
index c969294e6abb,ce63ab21b6cd..000000000000
--- a/net/ipv4/ip_tunnel_core.c
+++ b/net/ipv4/ip_tunnel_core.c
@@@ -74,7 -74,8 +74,12 @@@ int iptunnel_xmit(struct sock *sk, stru
  	iph->daddr	=	dst;
  	iph->saddr	=	src;
  	iph->ttl	=	ttl;
++<<<<<<< HEAD
 +	__ip_select_ident(iph, &rt->dst, (skb_shinfo(skb)->gso_segs ?: 1) - 1);
++=======
+ 	__ip_select_ident(dev_net(rt->dst.dev), iph,
+ 			  skb_shinfo(skb)->gso_segs ?: 1);
++>>>>>>> 926a882f6916 (ipv4: ip_tunnel: use net namespace from rtable not socket)
  
  	err = ip_local_out_sk(sk, skb);
  	if (unlikely(net_xmit_eval(err)))
* Unmerged path net/ipv4/ip_tunnel_core.c
