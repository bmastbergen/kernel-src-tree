perf tools: Fix shadowed declaration in parse-events.c

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
commit-author Jiri Olsa <jolsa@redhat.com>
commit 272ed29a91aea4397c05157dea7210dd7e81557a
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/272ed29a.failed

The error variable breaks build on CentOS 6.7, due to a collision with a
global error symbol:

    CC       util/parse-events.o
  cc1: warnings being treated as errors
  util/parse-events.c:419: error: declaration of ‘error’ shadows a global
  declaration
  util/util.h:135: error: shadowed declaration is here
  util/parse-events.c: In function ‘add_tracepoint_multi_event’:
  ...

Using different argument names instead to fix it.

	Reported-by: Vinson Lee <vlee@twopensource.com>
	Signed-off-by: Jiri Olsa <jolsa@kernel.org>
	Tested-by: Arnaldo Carvalho de Melo <acme@redhat.com>
	Cc: David Ahern <dsahern@gmail.com>
	Cc: He Kuang <hekuang@huawei.com>
	Cc: H. Peter Anvin <hpa@zytor.com>
	Cc: Jiri Olsa <jolsa@kernel.org>
	Cc: linux-tip-commits@vger.kernel.org
	Cc: Matt Fleming <matt@codeblueprint.co.uk>
	Cc: Namhyung Kim <namhyung@kernel.org>
	Cc: Peter Zijlstra <a.p.zijlstra@chello.nl>
	Cc: Raphael Beamonte <raphael.beamonte@gmail.com>
	Cc: Thomas Gleixner <tglx@linutronix.de>
Link: http://lkml.kernel.org/r/20150929150531.GI27383@krava.redhat.com
[ Fix one more case, at line 770 ]
	Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>
(cherry picked from commit 272ed29a91aea4397c05157dea7210dd7e81557a)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	tools/perf/util/parse-events.c
diff --cc tools/perf/util/parse-events.c
index fd7bc5047cba,c1c64fb647aa..000000000000
--- a/tools/perf/util/parse-events.c
+++ b/tools/perf/util/parse-events.c
@@@ -378,10 -386,10 +378,10 @@@ int parse_events_add_cache(struct list_
  	memset(&attr, 0, sizeof(attr));
  	attr.config = cache_type | (cache_op << 8) | (cache_result << 16);
  	attr.type = PERF_TYPE_HW_CACHE;
 -	return add_event(list, idx, &attr, name, NULL);
 +	return add_event(list, idx, &attr, name);
  }
  
- static void tracepoint_error(struct parse_events_error *error, int err,
+ static void tracepoint_error(struct parse_events_error *e, int err,
  			     char *sys, char *name)
  {
  	char help[BUFSIZ];
@@@ -410,7 -418,8 +410,12 @@@
  
  static int add_tracepoint(struct list_head *list, int *idx,
  			  char *sys_name, char *evt_name,
++<<<<<<< HEAD
 +			  struct parse_events_error *error __maybe_unused)
++=======
+ 			  struct parse_events_error *err,
+ 			  struct list_head *head_config)
++>>>>>>> 272ed29a91ae (perf tools: Fix shadowed declaration in parse-events.c)
  {
  	struct perf_evsel *evsel;
  
@@@ -426,7 -443,8 +431,12 @@@
  
  static int add_tracepoint_multi_event(struct list_head *list, int *idx,
  				      char *sys_name, char *evt_name,
++<<<<<<< HEAD
 +				      struct parse_events_error *error)
++=======
+ 				      struct parse_events_error *err,
+ 				      struct list_head *head_config)
++>>>>>>> 272ed29a91ae (perf tools: Fix shadowed declaration in parse-events.c)
  {
  	char evt_path[MAXPATHLEN];
  	struct dirent *evt_ent;
@@@ -450,7 -468,8 +460,12 @@@
  		if (!strglobmatch(evt_ent->d_name, evt_name))
  			continue;
  
++<<<<<<< HEAD
 +		ret = add_tracepoint(list, idx, sys_name, evt_ent->d_name, error);
++=======
+ 		ret = add_tracepoint(list, idx, sys_name, evt_ent->d_name,
+ 				     err, head_config);
++>>>>>>> 272ed29a91ae (perf tools: Fix shadowed declaration in parse-events.c)
  	}
  
  	closedir(evt_dir);
@@@ -459,16 -478,20 +474,32 @@@
  
  static int add_tracepoint_event(struct list_head *list, int *idx,
  				char *sys_name, char *evt_name,
++<<<<<<< HEAD
 +				struct parse_events_error *error)
 +{
 +	return strpbrk(evt_name, "*?") ?
 +	       add_tracepoint_multi_event(list, idx, sys_name, evt_name, error) :
 +	       add_tracepoint(list, idx, sys_name, evt_name, error);
++=======
+ 				struct parse_events_error *err,
+ 				struct list_head *head_config)
+ {
+ 	return strpbrk(evt_name, "*?") ?
+ 	       add_tracepoint_multi_event(list, idx, sys_name, evt_name,
+ 					  err, head_config) :
+ 	       add_tracepoint(list, idx, sys_name, evt_name,
+ 			      err, head_config);
++>>>>>>> 272ed29a91ae (perf tools: Fix shadowed declaration in parse-events.c)
  }
  
  static int add_tracepoint_multi_sys(struct list_head *list, int *idx,
  				    char *sys_name, char *evt_name,
++<<<<<<< HEAD
 +				    struct parse_events_error *error)
++=======
+ 				    struct parse_events_error *err,
+ 				    struct list_head *head_config)
++>>>>>>> 272ed29a91ae (perf tools: Fix shadowed declaration in parse-events.c)
  {
  	struct dirent *events_ent;
  	DIR *events_dir;
@@@ -492,7 -515,7 +523,11 @@@
  			continue;
  
  		ret = add_tracepoint_event(list, idx, events_ent->d_name,
++<<<<<<< HEAD
 +					   evt_name, error);
++=======
+ 					   evt_name, err, head_config);
++>>>>>>> 272ed29a91ae (perf tools: Fix shadowed declaration in parse-events.c)
  	}
  
  	closedir(events_dir);
@@@ -656,6 -721,71 +691,74 @@@ static int config_attr(struct perf_even
  	return 0;
  }
  
++<<<<<<< HEAD
++=======
+ static int get_config_terms(struct list_head *head_config,
+ 			    struct list_head *head_terms __maybe_unused)
+ {
+ #define ADD_CONFIG_TERM(__type, __name, __val)			\
+ do {								\
+ 	struct perf_evsel_config_term *__t;			\
+ 								\
+ 	__t = zalloc(sizeof(*__t));				\
+ 	if (!__t)						\
+ 		return -ENOMEM;					\
+ 								\
+ 	INIT_LIST_HEAD(&__t->list);				\
+ 	__t->type       = PERF_EVSEL__CONFIG_TERM_ ## __type;	\
+ 	__t->val.__name = __val;				\
+ 	list_add_tail(&__t->list, head_terms);			\
+ } while (0)
+ 
+ 	struct parse_events_term *term;
+ 
+ 	list_for_each_entry(term, head_config, list) {
+ 		switch (term->type_term) {
+ 		case PARSE_EVENTS__TERM_TYPE_SAMPLE_PERIOD:
+ 			ADD_CONFIG_TERM(PERIOD, period, term->val.num);
+ 			break;
+ 		case PARSE_EVENTS__TERM_TYPE_SAMPLE_FREQ:
+ 			ADD_CONFIG_TERM(FREQ, freq, term->val.num);
+ 			break;
+ 		case PARSE_EVENTS__TERM_TYPE_TIME:
+ 			ADD_CONFIG_TERM(TIME, time, term->val.num);
+ 			break;
+ 		case PARSE_EVENTS__TERM_TYPE_CALLGRAPH:
+ 			ADD_CONFIG_TERM(CALLGRAPH, callgraph, term->val.str);
+ 			break;
+ 		case PARSE_EVENTS__TERM_TYPE_STACKSIZE:
+ 			ADD_CONFIG_TERM(STACK_USER, stack_user, term->val.num);
+ 			break;
+ 		default:
+ 			break;
+ 		}
+ 	}
+ #undef ADD_EVSEL_CONFIG
+ 	return 0;
+ }
+ 
+ int parse_events_add_tracepoint(struct list_head *list, int *idx,
+ 				char *sys, char *event,
+ 				struct parse_events_error *err,
+ 				struct list_head *head_config)
+ {
+ 	if (head_config) {
+ 		struct perf_event_attr attr;
+ 
+ 		if (config_attr(&attr, head_config, err,
+ 				config_term_tracepoint))
+ 			return -EINVAL;
+ 	}
+ 
+ 	if (strpbrk(sys, "*?"))
+ 		return add_tracepoint_multi_sys(list, idx, sys, event,
+ 						err, head_config);
+ 	else
+ 		return add_tracepoint_event(list, idx, sys, event,
+ 					    err, head_config);
+ }
+ 
++>>>>>>> 272ed29a91ae (perf tools: Fix shadowed declaration in parse-events.c)
  int parse_events_add_numeric(struct parse_events_evlist *data,
  			     struct list_head *list,
  			     u32 type, u64 config,
* Unmerged path tools/perf/util/parse-events.c
