i40e: Restrict VF poll mode to only single function mode devices

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
commit-author Shannon Nelson <shannon.nelson@intel.com>
commit 14c5f5d264c3ee28e8ec9fd4dffb29f5d1ea1d02
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/14c5f5d2.failed

The VFs can request their queues to be set up into polling mode, rather
than interrupt mode, which works well for supporting things like DPDK,
but this should not be available when working in an multi-function
support device.

Change-ID: Id36792e4e7422db8f2033336507211f68f14ff6f
	Signed-off-by: Shannon Nelson <shannon.nelson@intel.com>
	Tested-by: Andrew Bowers <andrewx.bowers@intel.com>
	Signed-off-by: Jeff Kirsher <jeffrey.t.kirsher@intel.com>
(cherry picked from commit 14c5f5d264c3ee28e8ec9fd4dffb29f5d1ea1d02)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/intel/i40e/i40e_virtchnl_pf.c
diff --cc drivers/net/ethernet/intel/i40e/i40e_virtchnl_pf.c
index d901afb6a12a,30f8cbe6b54b..000000000000
--- a/drivers/net/ethernet/intel/i40e/i40e_virtchnl_pf.c
+++ b/drivers/net/ethernet/intel/i40e/i40e_virtchnl_pf.c
@@@ -1212,6 -1355,30 +1212,33 @@@ static int i40e_vc_get_vf_resources_msg
  	} else {
  		vfres->vf_offload_flags |= I40E_VIRTCHNL_VF_OFFLOAD_RSS_REG;
  	}
++<<<<<<< HEAD
++=======
+ 
+ 	if (pf->flags & I40E_FLAG_MULTIPLE_TCP_UDP_RSS_PCTYPE) {
+ 		if (vf->driver_caps & I40E_VIRTCHNL_VF_OFFLOAD_RSS_PCTYPE_V2)
+ 			vfres->vf_offload_flags |=
+ 				I40E_VIRTCHNL_VF_OFFLOAD_RSS_PCTYPE_V2;
+ 	}
+ 
+ 	if (vf->driver_caps & I40E_VIRTCHNL_VF_OFFLOAD_RX_POLLING) {
+ 		if (pf->flags & I40E_FLAG_MFP_ENABLED) {
+ 			dev_err(&pf->pdev->dev,
+ 				"VF %d requested polling mode: this feature is supported only when the device is running in single function per port (SFP) mode\n",
+ 				 vf->vf_id);
+ 			ret = I40E_ERR_PARAM;
+ 			goto err;
+ 		}
+ 		vfres->vf_offload_flags |= I40E_VIRTCHNL_VF_OFFLOAD_RX_POLLING;
+ 	}
+ 
+ 	if (pf->flags & I40E_FLAG_WB_ON_ITR_CAPABLE) {
+ 		if (vf->driver_caps & I40E_VIRTCHNL_VF_OFFLOAD_WB_ON_ITR)
+ 			vfres->vf_offload_flags |=
+ 					I40E_VIRTCHNL_VF_OFFLOAD_WB_ON_ITR;
+ 	}
+ 
++>>>>>>> 14c5f5d264c3 (i40e: Restrict VF poll mode to only single function mode devices)
  	vfres->num_vsis = num_vsis;
  	vfres->num_queue_pairs = vf->num_queue_pairs;
  	vfres->max_vectors = pf->hw.func_caps.num_msix_vectors_vf;
* Unmerged path drivers/net/ethernet/intel/i40e/i40e_virtchnl_pf.c
