hv_netvsc: Implement set_channels ethtool op

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
commit-author Andrew Schwartzmeyer <andschwa@microsoft.com>
commit b5960e6e2b5c52520cec5888c3feb71b71ba1980
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/b5960e6e.failed

This enables the use of ethtool --set-channels devname combined N to
change the number of vRSS queues. Separate rx, tx, and other parameters
are not supported. The maximum is rsscap.num_recv_que. It passes the
given value to rndis_filter_device_add through the device_info->num_chn
field.

If the procedure fails, it attempts to recover to the prior state. If
the recovery fails, it logs an error and aborts.

Current num_chn is saved and restored when changing the MTU.

	Signed-off-by: Andrew Schwartzmeyer <andschwa@microsoft.com>
	Reviewed-by: Haiyang Zhang <haiyangz@microsoft.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit b5960e6e2b5c52520cec5888c3feb71b71ba1980)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/hyperv/netvsc_drv.c
diff --cc drivers/net/hyperv/netvsc_drv.c
index 56b76b7b9a27,f3b9d3eb753b..000000000000
--- a/drivers/net/hyperv/netvsc_drv.c
+++ b/drivers/net/hyperv/netvsc_drv.c
@@@ -757,7 -894,11 +852,12 @@@ static int netvsc_change_mtu(struct net
  
  	ndevctx->device_ctx = hdev;
  	hv_set_drvdata(hdev, ndev);
 -
 -	memset(&device_info, 0, sizeof(device_info));
  	device_info.ring_size = ring_size;
++<<<<<<< HEAD
++=======
+ 	device_info.num_chn = nvdev->num_chn;
+ 	device_info.max_num_vrss_chns = max_num_vrss_chns;
++>>>>>>> b5960e6e2b5c (hv_netvsc: Implement set_channels ethtool op)
  	rndis_filter_device_add(hdev, &device_info);
  
  out:
* Unmerged path drivers/net/hyperv/netvsc_drv.c
