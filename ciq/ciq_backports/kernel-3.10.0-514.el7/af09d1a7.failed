xen: remove deprecated IRQF_DISABLED

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
commit-author Michael Opdenacker <michael.opdenacker@free-electrons.com>
commit af09d1a73aed4e83ee095f2dabdc09386e31f2ea
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/af09d1a7.failed

This patch proposes to remove the IRQF_DISABLED flag from drivers/xen
code. It's a NOOP since 2.6.35 and it will be removed one day.

Note that architecture dependent fixes for IRQF_DISABLED
were already submitted through separate patches.

	Signed-off-by: Michael Opdenacker <michael.opdenacker@free-electrons.com>
	Signed-off-by: Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>
(cherry picked from commit af09d1a73aed4e83ee095f2dabdc09386e31f2ea)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/xen/evtchn.c
diff --cc drivers/xen/evtchn.c
index b6165e047f48,5de2063e16d3..000000000000
--- a/drivers/xen/evtchn.c
+++ b/drivers/xen/evtchn.c
@@@ -263,23 -292,33 +263,30 @@@ static int evtchn_bind_to_user(struct p
  	 * interrupt handler yet, and our caller has already
  	 * serialized bind operations.)
  	 */
 -
 -	evtchn = kzalloc(sizeof(*evtchn), GFP_KERNEL);
 -	if (!evtchn)
 -		return -ENOMEM;
 -
 -	evtchn->user = u;
 -	evtchn->port = port;
 -	evtchn->enabled = true; /* start enabled */
 -
 -	rc = add_evtchn(u, evtchn);
 -	if (rc < 0)
 -		goto err;
 -
 +	BUG_ON(get_port_user(port) != NULL);
 +	set_port_user(port, u);
 +	set_port_enabled(port, true); /* start enabled */
 +
++<<<<<<< HEAD
 +	rc = bind_evtchn_to_irqhandler(port, evtchn_interrupt, IRQF_DISABLED,
 +				       u->name, (void *)(unsigned long)port);
 +	if (rc >= 0)
 +		rc = evtchn_make_refcounted(port);
 +	else {
 +		/* bind failed, should close the port now */
 +		struct evtchn_close close;
 +		close.port = port;
 +		if (HYPERVISOR_event_channel_op(EVTCHNOP_close, &close) != 0)
 +			BUG();
 +		set_port_user(port, NULL);
 +	}
++=======
+ 	rc = bind_evtchn_to_irqhandler(port, evtchn_interrupt, 0,
+ 				       u->name, evtchn);
+ 	if (rc < 0)
+ 		goto err;
++>>>>>>> af09d1a73aed (xen: remove deprecated IRQF_DISABLED)
  
 -	rc = evtchn_make_refcounted(port);
 -	return rc;
 -
 -err:
 -	/* bind failed, should close the port now */
 -	close.port = port;
 -	if (HYPERVISOR_event_channel_op(EVTCHNOP_close, &close) != 0)
 -		BUG();
 -	del_evtchn(u, evtchn);
  	return rc;
  }
  
* Unmerged path drivers/xen/evtchn.c
diff --git a/drivers/xen/platform-pci.c b/drivers/xen/platform-pci.c
index 99db9e1eb8ba..2f3528e93cb9 100644
--- a/drivers/xen/platform-pci.c
+++ b/drivers/xen/platform-pci.c
@@ -84,7 +84,7 @@ static irqreturn_t do_hvm_evtchn_intr(int irq, void *dev_id)
 static int xen_allocate_irq(struct pci_dev *pdev)
 {
 	return request_irq(pdev->irq, do_hvm_evtchn_intr,
-			IRQF_DISABLED | IRQF_NOBALANCING | IRQF_TRIGGER_RISING,
+			IRQF_NOBALANCING | IRQF_TRIGGER_RISING,
 			"xen-platform-pci", pdev);
 }
 
