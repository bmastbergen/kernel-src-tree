veth: implement ndo_set_rx_headroom

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
commit-author Paolo Abeni <pabeni@redhat.com>
commit 163e529200af7b7521fbde5dbcc653cf3ce597df
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/163e5292.failed

The rx headroom for veth dev is the peer device needed_headroom.
Avoid ping-pong updates setting the private flag IFF_PHONY_HEADROOM.

This avoids skb head reallocation when forwarding from a veth dev
towards a device adding some kind of encapsulation.

When transmitting frames below the MTU size towards a vxlan device,
this gives about 10% performance speed-up when OVS is used to connect
the veth and the vxlan device and a little more when using a
plain Linux bridge.

	Signed-off-by: Paolo Abeni <pabeni@redhat.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 163e529200af7b7521fbde5dbcc653cf3ce597df)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/veth.c
diff --cc drivers/net/veth.c
index 7c5375bb2ada,4f30a6ae50d0..000000000000
--- a/drivers/net/veth.c
+++ b/drivers/net/veth.c
@@@ -259,8 -302,14 +283,13 @@@ static const struct net_device_ops veth
  	.ndo_start_xmit      = veth_xmit,
  	.ndo_change_mtu      = veth_change_mtu,
  	.ndo_get_stats64     = veth_get_stats64,
 -	.ndo_set_rx_mode     = veth_set_multicast_list,
  	.ndo_set_mac_address = eth_mac_addr,
 -#ifdef CONFIG_NET_POLL_CONTROLLER
 -	.ndo_poll_controller	= veth_poll_controller,
 -#endif
  	.ndo_get_iflink		= veth_get_iflink,
++<<<<<<< HEAD
++=======
+ 	.ndo_features_check	= passthru_features_check,
+ 	.ndo_set_rx_headroom	= veth_set_rx_headroom,
++>>>>>>> 163e529200af (veth: implement ndo_set_rx_headroom)
  };
  
  #define VETH_FEATURES (NETIF_F_SG | NETIF_F_FRAGLIST | NETIF_F_ALL_TSO |    \
* Unmerged path drivers/net/veth.c
