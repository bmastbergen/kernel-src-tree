net/mlx5: Use offset based reserved field names in the IFC header file

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
commit-author Matan Barak <matanb@mellanox.com>
commit b4ff3a36d3e409d365a09b6b783ff895063ff4ef
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/b4ff3a36.failed

mlx5_ifc.h is a header file representing the API and ABI between
the driver to the firmware and hardware. This file is used from
both the mlx5_ib and mlx5_core drivers.

Previously, this file used incrementing counter to indicate
reserved fields, for example:

struct mlx5_ifc_odp_per_transport_service_cap_bits {
        u8         send[0x1];
        u8         receive[0x1];
        u8         write[0x1];
        u8         read[0x1];
        u8         reserved_0[0x1];
        u8         srq_receive[0x1];
        u8         reserved_1[0x1a];
};

If one developer implements through net-next feature A that uses
reserved_0, they replace it with featureA and renames reserved_1 to
reserved_0. In the same kernel cycle, a 2nd developer could implement
feature B through the rdma tree, that uses reserved_1 and split it to
featureB and a smaller reserved_1 field. This will cause a conflict
when the two trees are merged.

The source of this conflict is that the 1st developer changed *all*
reserved fields.

As Linus suggested, we change the layout of structs to:

struct mlx5_ifc_odp_per_transport_service_cap_bits {
	u8         send[0x1];
	u8         receive[0x1];
	u8         write[0x1];
	u8         read[0x1];
	u8         reserved_at_4[0x1];
	u8         srq_receive[0x1];
	u8         reserved_at_6[0x1a];
};

This makes the conflicts much more rare and preserves the locality of
changes.

	Signed-off-by: Matan Barak <matanb@mellanox.com>
	Signed-off-by: Alaa Hleihel <alaa@mellanox.com>
	Reported-by: Linus Torvalds <torvalds@linux-foundation.org>
	Signed-off-by: Saeed Mahameed <saeedm@mellanox.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit b4ff3a36d3e409d365a09b6b783ff895063ff4ef)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	include/linux/mlx5/mlx5_ifc.h
diff --cc include/linux/mlx5/mlx5_ifc.h
index 3446b357315b,51f1e540fc2b..000000000000
--- a/include/linux/mlx5/mlx5_ifc.h
+++ b/include/linux/mlx5/mlx5_ifc.h
@@@ -844,23 -844,24 +844,30 @@@ struct mlx5_ifc_cmd_hca_cap_bits 
  	u8         log_max_wq_sz[0x5];
  
  	u8         nic_vport_change_event[0x1];
- 	u8         reserved_61[0xa];
+ 	u8         reserved_at_3e0[0xa];
  	u8         log_max_vlan_list[0x5];
- 	u8         reserved_62[0x3];
+ 	u8         reserved_at_3ef[0x3];
  	u8         log_max_current_mc_list[0x5];
- 	u8         reserved_63[0x3];
+ 	u8         reserved_at_3f7[0x3];
  	u8         log_max_current_uc_list[0x5];
  
- 	u8         reserved_64[0x80];
+ 	u8         reserved_at_3ff[0x80];
  
- 	u8         reserved_65[0x3];
+ 	u8         reserved_at_47f[0x3];
  	u8         log_max_l2_table[0x5];
- 	u8         reserved_66[0x8];
+ 	u8         reserved_at_487[0x8];
  	u8         log_uar_page_sz[0x10];
  
++<<<<<<< HEAD
 +	u8         reserved_67[0xe0];
 +
 +	u8         reserved_68[0x1f];
++=======
+ 	u8         reserved_at_49f[0x20];
+ 	u8         device_frequency_mhz[0x20];
+ 	u8         device_frequency_khz[0x20];
+ 	u8         reserved_at_4ff[0x5f];
++>>>>>>> b4ff3a36d3e4 (net/mlx5: Use offset based reserved field names in the IFC header file)
  	u8         cqe_zip[0x1];
  
  	u8         cqe_zip_timeout[0x10];
@@@ -2223,19 -2224,25 +2230,39 @@@ struct mlx5_ifc_nic_vport_context_bits 
  
  	u8         mtu[0x10];
  
++<<<<<<< HEAD
 +	u8         reserved_3[0x640];
++=======
+ 	u8         system_image_guid[0x40];
+ 	u8         port_guid[0x40];
+ 	u8         node_guid[0x40];
+ 
+ 	u8         reserved_at_200[0x140];
+ 	u8         qkey_violation_counter[0x10];
+ 	u8         reserved_at_350[0x430];
++>>>>>>> b4ff3a36d3e4 (net/mlx5: Use offset based reserved field names in the IFC header file)
  
  	u8         promisc_uc[0x1];
  	u8         promisc_mc[0x1];
  	u8         promisc_all[0x1];
++<<<<<<< HEAD
 +	u8         reserved_4[0x2];
 +	u8         allowed_list_type[0x3];
 +	u8         reserved_5[0xc];
++=======
+ 	u8         reserved_at_783[0x2];
+ 	u8         allowed_list_type[0x3];
+ 	u8         reserved_at_788[0xc];
++>>>>>>> b4ff3a36d3e4 (net/mlx5: Use offset based reserved field names in the IFC header file)
  	u8         allowed_list_size[0xc];
  
  	struct mlx5_ifc_mac_address_layout_bits permanent_address;
  
++<<<<<<< HEAD
 +	u8         reserved_6[0x20];
++=======
+ 	u8         reserved_at_7e0[0x20];
++>>>>>>> b4ff3a36d3e4 (net/mlx5: Use offset based reserved field names in the IFC header file)
  
  	u8         current_uc_mac_address[0][0x40];
  };
* Unmerged path include/linux/mlx5/mlx5_ifc.h
