ALSA: hda - Add mic mute hotkey quirk for Lenovo ThinkCentre AIO

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
commit-author Kailang <kailang@realtek.com>
commit 3694cb2947db50753caf432db067487eafae7b9b
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/3694cb29.failed

The Lenovo ThinkCenter AIO uses Line2 (NID 0x1b) to implement the
micmute hotkey, here we register an input device and use Line2 unsol
event to collect the hotkey pressing or releasing.

In the meanwhile, the micmute led is controlled by GPIO2, so we
use an existing function alc_fixup_gpio_mic_mute_hook() to control
the led.

[Hui: And there are two places to register the input device, to make
the code simple and clean, move the two same code sections into a
function.]

	Cc: <stable@vger.kernel.org>
	Signed-off-by: Kailang <kailang@realtek.com>
	Signed-off-by: Hui Wang <hui.wang@canonical.com>
	Signed-off-by: Takashi Iwai <tiwai@suse.de>
(cherry picked from commit 3694cb2947db50753caf432db067487eafae7b9b)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	sound/pci/hda/patch_realtek.c
diff --cc sound/pci/hda/patch_realtek.c
index cedaf0d6d544,257b839ea94d..000000000000
--- a/sound/pci/hda/patch_realtek.c
+++ b/sound/pci/hda/patch_realtek.c
@@@ -4619,7 -4671,16 +4671,14 @@@ enum 
  	ALC288_FIXUP_DELL_HEADSET_MODE,
  	ALC288_FIXUP_DELL1_MIC_NO_PRESENCE,
  	ALC288_FIXUP_DELL_XPS_13_GPIO6,
 -	ALC288_FIXUP_DELL_XPS_13,
 -	ALC288_FIXUP_DISABLE_AAMIX,
 -	ALC292_FIXUP_DELL_E7X,
 -	ALC292_FIXUP_DISABLE_AAMIX,
 -	ALC293_FIXUP_DISABLE_AAMIX_MULTIJACK,
  	ALC298_FIXUP_DELL1_MIC_NO_PRESENCE,
++<<<<<<< HEAD
++=======
+ 	ALC275_FIXUP_DELL_XPS,
+ 	ALC256_FIXUP_DELL_XPS_13_HEADPHONE_NOISE,
+ 	ALC293_FIXUP_LENOVO_SPK_NOISE,
+ 	ALC233_FIXUP_LENOVO_LINE2_MIC_HOTKEY,
++>>>>>>> 3694cb2947db (ALSA: hda - Add mic mute hotkey quirk for Lenovo ThinkCentre AIO)
  };
  
  static const struct hda_fixup alc269_fixups[] = {
@@@ -5171,6 -5262,38 +5230,41 @@@
  		.chained = true,
  		.chain_id = ALC269_FIXUP_HEADSET_MODE
  	},
++<<<<<<< HEAD
++=======
+ 	[ALC275_FIXUP_DELL_XPS] = {
+ 		.type = HDA_FIXUP_VERBS,
+ 		.v.verbs = (const struct hda_verb[]) {
+ 			/* Enables internal speaker */
+ 			{0x20, AC_VERB_SET_COEF_INDEX, 0x1f},
+ 			{0x20, AC_VERB_SET_PROC_COEF, 0x00c0},
+ 			{0x20, AC_VERB_SET_COEF_INDEX, 0x30},
+ 			{0x20, AC_VERB_SET_PROC_COEF, 0x00b1},
+ 			{}
+ 		}
+ 	},
+ 	[ALC256_FIXUP_DELL_XPS_13_HEADPHONE_NOISE] = {
+ 		.type = HDA_FIXUP_VERBS,
+ 		.v.verbs = (const struct hda_verb[]) {
+ 			/* Disable pass-through path for FRONT 14h */
+ 			{0x20, AC_VERB_SET_COEF_INDEX, 0x36},
+ 			{0x20, AC_VERB_SET_PROC_COEF, 0x1737},
+ 			{}
+ 		},
+ 		.chained = true,
+ 		.chain_id = ALC255_FIXUP_DELL1_MIC_NO_PRESENCE
+ 	},
+ 	[ALC293_FIXUP_LENOVO_SPK_NOISE] = {
+ 		.type = HDA_FIXUP_FUNC,
+ 		.v.func = alc_fixup_disable_aamix,
+ 		.chained = true,
+ 		.chain_id = ALC269_FIXUP_THINKPAD_ACPI
+ 	},
+ 	[ALC233_FIXUP_LENOVO_LINE2_MIC_HOTKEY] = {
+ 		.type = HDA_FIXUP_FUNC,
+ 		.v.func = alc233_fixup_lenovo_line2_mic_hotkey,
+ 	},
++>>>>>>> 3694cb2947db (ALSA: hda - Add mic mute hotkey quirk for Lenovo ThinkCentre AIO)
  };
  
  static const struct snd_pci_quirk alc269_fixup_tbl[] = {
@@@ -5313,6 -5442,8 +5407,11 @@@
  	SND_PCI_QUIRK(0x17aa, 0x2218, "Thinkpad X1 Carbon 2nd", ALC292_FIXUP_TPT440_DOCK),
  	SND_PCI_QUIRK(0x17aa, 0x2223, "ThinkPad T550", ALC292_FIXUP_TPT440_DOCK),
  	SND_PCI_QUIRK(0x17aa, 0x2226, "ThinkPad X250", ALC292_FIXUP_TPT440_DOCK),
++<<<<<<< HEAD
++=======
+ 	SND_PCI_QUIRK(0x17aa, 0x2233, "Thinkpad", ALC293_FIXUP_LENOVO_SPK_NOISE),
+ 	SND_PCI_QUIRK(0x17aa, 0x30bb, "ThinkCentre AIO", ALC233_FIXUP_LENOVO_LINE2_MIC_HOTKEY),
++>>>>>>> 3694cb2947db (ALSA: hda - Add mic mute hotkey quirk for Lenovo ThinkCentre AIO)
  	SND_PCI_QUIRK(0x17aa, 0x3977, "IdeaPad S210", ALC283_FIXUP_INT_MIC),
  	SND_PCI_QUIRK(0x17aa, 0x3978, "IdeaPad Y410P", ALC269_FIXUP_NO_SHUTUP),
  	SND_PCI_QUIRK(0x17aa, 0x5013, "Thinkpad", ALC269_FIXUP_LIMIT_INT_MIC_BOOST),
* Unmerged path sound/pci/hda/patch_realtek.c
