DLM: Save and restore socket callbacks properly

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
commit-author Bob Peterson <rpeterso@redhat.com>
commit b81171cb6869111dbaf9fb642f4434514c21d696
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/b81171cb.failed

This patch fixes the problems with patch b3a5bbfd7.

1. It removes a return statement from lowcomms_error_report
   because it needs to call the original error report in all paths
   through the function.
2. All socket callbacks are saved and restored, not just the
   sk_error_report, and that's done so with proper locking like
   sunrpc does.

	Signed-off-by: Bob Peterson <rpeterso@redhat.com>
	Signed-off-by: David Teigland <teigland@redhat.com>
(cherry picked from commit b81171cb6869111dbaf9fb642f4434514c21d696)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	fs/dlm/lowcomms.c
diff --cc fs/dlm/lowcomms.c
index 5400b3fbda3e,00640e70ed7a..000000000000
--- a/fs/dlm/lowcomms.c
+++ b/fs/dlm/lowcomms.c
@@@ -1425,19 -1323,14 +1471,27 @@@ static int sctp_listen_for_all(void
  	sock->sk->sk_user_data = con;
  	con->sock = sock;
  	con->sock->sk->sk_data_ready = lowcomms_data_ready;
 -	con->rx_action = sctp_accept_from_sock;
 -	con->connect_action = sctp_connect_to_sock;
 +	con->rx_action = receive_from_sock;
 +	con->connect_action = sctp_init_assoc;
  
++<<<<<<< HEAD
 +	/* Bind to all interfaces. */
 +	for (i = 0; i < dlm_local_count; i++) {
 +		memcpy(&localaddr, dlm_local_addr[i], sizeof(localaddr));
 +		make_sockaddr(&localaddr, dlm_config.ci_tcp_port, &addr_len);
 +
 +		result = add_sctp_bind_addr(con, &localaddr, addr_len, num);
 +		if (result)
 +			goto create_delsock;
 +		++num;
 +	}
++=======
+ 	write_unlock_bh(&sock->sk->sk_callback_lock);
+ 
+ 	/* Bind to all addresses. */
+ 	if (sctp_bind_addrs(con, dlm_config.ci_tcp_port))
+ 		goto create_delsock;
++>>>>>>> b81171cb6869 (DLM: Save and restore socket callbacks properly)
  
  	result = sock->ops->listen(sock, 5);
  	if (result < 0) {
* Unmerged path fs/dlm/lowcomms.c
