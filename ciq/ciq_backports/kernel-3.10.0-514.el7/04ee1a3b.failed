audit: get rid of *NO* daemon at audit_pid=0 message

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
commit-author Richard Guy Briggs <rgb@redhat.com>
commit 04ee1a3b8f0584099370f8501ac785fd5d2ed6ff
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/04ee1a3b.failed

kauditd_send_skb is called after audit_pid was checked to be non-zero.

However, it can be set to 0 due to auditd exiting while kauditd_send_skb
is still executed and this can result in a spurious warning about missing
auditd.

Re-check audit_pid before printing the message.

	Signed-off-by: Mateusz Guzik <mguzik@redhat.com>
	Cc: Eric Paris <eparis@redhat.com>
	Cc: linux-kernel@vger.kernel.org
	Acked-by: Eric Paris <eparis@redhat.com>
	Signed-off-by: Richard Guy Briggs <rgb@redhat.com>
	Signed-off-by: Eric Paris <eparis@redhat.com>
(cherry picked from commit 04ee1a3b8f0584099370f8501ac785fd5d2ed6ff)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	kernel/audit.c
diff --cc kernel/audit.c
index 2260c15ce846,2dc757354693..000000000000
--- a/kernel/audit.c
+++ b/kernel/audit.c
@@@ -399,9 -410,12 +399,18 @@@ static void kauditd_send_skb(struct sk_
  	err = netlink_unicast(audit_sock, skb, audit_nlk_portid, 0);
  	if (err < 0) {
  		BUG_ON(err != -ECONNREFUSED); /* Shouldn't happen */
++<<<<<<< HEAD
 +		printk(KERN_ERR "audit: *NO* daemon at audit_pid=%d\n", audit_pid);
 +		audit_log_lost("auditd disappeared\n");
 +		audit_pid = 0;
++=======
+ 		if (audit_pid) {
+ 			printk(KERN_ERR "audit: *NO* daemon at audit_pid=%d\n", audit_pid);
+ 			audit_log_lost("auditd disappeared\n");
+ 			audit_pid = 0;
+ 			audit_sock = NULL;
+ 		}
++>>>>>>> 04ee1a3b8f05 (audit: get rid of *NO* daemon at audit_pid=0 message)
  		/* we might get lucky and get this in the next auditd */
  		audit_hold_skb(skb);
  	} else
* Unmerged path kernel/audit.c
