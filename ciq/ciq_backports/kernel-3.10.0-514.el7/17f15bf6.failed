IB/hfi1: Fix pio wait counter double increment

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
commit-author Mike Marciniszyn <mike.marciniszyn@intel.com>
commit 17f15bf66884b9e33c5005ee0149b039af8f7af2
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/17f15bf6.failed

The code unconditionlly increments the pio wait counter
making the counter inacurate and unusable.

Fixes: 14553ca11039 ("staging/rdma/hfi1: Adaptive PIO for short messages")
	Reviewed-by: Dennis Dalessandro <dennis.dalessandro@intel.com>
	Signed-off-by: Mike Marciniszyn <mike.marciniszyn@intel.com>
	Signed-off-by: Doug Ledford <dledford@redhat.com>
(cherry picked from commit 17f15bf66884b9e33c5005ee0149b039af8f7af2)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/staging/hfi1/verbs.c
diff --cc drivers/staging/hfi1/verbs.c
index d228eb7fc4f0,f3531fdfef01..000000000000
--- a/drivers/staging/hfi1/verbs.c
+++ b/drivers/staging/hfi1/verbs.c
@@@ -1091,11 -944,12 +1091,17 @@@ static int no_bufs_available(struct hfi
  			struct hfi1_ibdev *dev = &dd->verbs_dev;
  			int was_empty;
  
++<<<<<<< HEAD:drivers/staging/hfi1/verbs.c
 +			dev->n_piowait++;
 +			qp->s_flags |= HFI1_S_WAIT_PIO;
++=======
+ 			dev->n_piowait += !!(flag & RVT_S_WAIT_PIO);
+ 			dev->n_piodrain += !!(flag & RVT_S_WAIT_PIO_DRAIN);
+ 			qp->s_flags |= flag;
++>>>>>>> 17f15bf66884 (IB/hfi1: Fix pio wait counter double increment):drivers/staging/rdma/hfi1/verbs.c
  			was_empty = list_empty(&sc->piowait);
  			list_add_tail(&priv->s_iowait.list, &sc->piowait);
 -			trace_hfi1_qpsleep(qp, RVT_S_WAIT_PIO);
 +			trace_hfi1_qpsleep(qp, HFI1_S_WAIT_PIO);
  			atomic_inc(&qp->refcount);
  			/* counting: only call wantpiobuf_intr if first user */
  			if (was_empty)
* Unmerged path drivers/staging/hfi1/verbs.c
