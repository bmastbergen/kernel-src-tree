mei: fix up uuid matching

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
commit-author Greg Kroah-Hartman <gregkh@linuxfoundation.org>
commit b144ce2d37619e05afdb0a15676500d76a64b1be
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/b144ce2d.failed

A previous commit, c93b76b34b4d ("mei: bus: report also uuid in module
alias") caused a build error as I missed applying a needed patch to add
some macros to uapi/linux/uuid.h.  Instead of those additional macros,
change the mei code to use the existing uuid structure directly.

Fixes: c93b76b34b4d
	Cc: Tomas Winkler <tomas.winkler@intel.com>
	Cc: Samuel Ortiz <sameo@linux.intel.com>
	Reported-by: Stephen Rothwell <sfr@canb.auug.org.au>
	Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
(cherry picked from commit b144ce2d37619e05afdb0a15676500d76a64b1be)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/misc/mei/bus.c
#	drivers/nfc/mei_phy.h
#	include/linux/mod_devicetable.h
#	scripts/mod/file2alias.c
diff --cc drivers/misc/mei/bus.c
index ca8736c3675b,357b6ae4d207..000000000000
--- a/drivers/misc/mei/bus.c
+++ b/drivers/misc/mei/bus.c
@@@ -45,9 -49,16 +45,22 @@@ static int mei_cl_device_match(struct d
  
  	id = driver->id_table;
  
++<<<<<<< HEAD
 +	while (id->name[0]) {
 +		if (!strncmp(dev_name(dev), id->name, sizeof(id->name)))
 +			return 1;
++=======
+ 	while (uuid_le_cmp(NULL_UUID_LE, id->uuid)) {
+ 
+ 		if (!uuid_le_cmp(*uuid, id->uuid)) {
+ 			if (id->name[0]) {
+ 				if (!strncmp(name, id->name, sizeof(id->name)))
+ 					return 1;
+ 			} else {
+ 				return 1;
+ 			}
+ 		}
++>>>>>>> b144ce2d3761 (mei: fix up uuid matching)
  
  		id++;
  	}
diff --cc drivers/nfc/mei_phy.h
index d669900f8278,fbfa3e61738f..000000000000
--- a/drivers/nfc/mei_phy.h
+++ b/drivers/nfc/mei_phy.h
@@@ -3,7 -3,10 +3,12 @@@
  
  #include <linux/mei_cl_bus.h>
  #include <net/nfc/hci.h>
 -#include <linux/uuid.h>
  
++<<<<<<< HEAD
++=======
+ #define MEI_NFC_UUID UUID_LE(0x0bb17a78, 0x2a8e, 0x4c50, \
+ 		0x94, 0xd4, 0x50, 0x26, 0x67, 0x23, 0x77, 0x5c)
++>>>>>>> b144ce2d3761 (mei: fix up uuid matching)
  #define MEI_NFC_HEADER_SIZE 10
  #define MEI_NFC_MAX_HCI_PAYLOAD 300
  
diff --cc include/linux/mod_devicetable.h
index b3bd7e737e8b,048c270822f9..000000000000
--- a/include/linux/mod_devicetable.h
+++ b/include/linux/mod_devicetable.h
@@@ -573,9 -599,22 +573,13 @@@ struct ipack_device_id 
  
  #define MEI_CL_MODULE_PREFIX "mei:"
  #define MEI_CL_NAME_SIZE 32
 -#define MEI_CL_UUID_FMT "%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x"
 -#define MEI_CL_UUID_ARGS(_u) \
 -	_u[0], _u[1], _u[2], _u[3], _u[4], _u[5], _u[6], _u[7], \
 -	_u[8], _u[9], _u[10], _u[11], _u[12], _u[13], _u[14], _u[15]
  
 -/**
 - * struct mei_cl_device_id - MEI client device identifier
 - * @name: helper name
 - * @uuid: client uuid
 - * @driver_info: information used by the driver.
 - *
 - * identifies mei client device by uuid and name
 - */
  struct mei_cl_device_id {
  	char name[MEI_CL_NAME_SIZE];
++<<<<<<< HEAD
++=======
+ 	uuid_le uuid;
++>>>>>>> b144ce2d3761 (mei: fix up uuid matching)
  	kernel_ulong_t driver_info;
  };
  
diff --cc scripts/mod/file2alias.c
index 45f9a3377dcd,718b2a29bd43..000000000000
--- a/scripts/mod/file2alias.c
+++ b/scripts/mod/file2alias.c
@@@ -129,6 -134,15 +132,18 @@@ static inline void add_wildcard(char *s
  		strcat(str + len, "*");
  }
  
++<<<<<<< HEAD
++=======
+ static inline void add_uuid(char *str, uuid_le uuid)
+ {
+ 	int len = strlen(str);
+ 	int i;
+ 
+ 	for (i = 0; i < 16; i++)
+ 		sprintf(str + len + (i << 1), "%02x", uuid.b[i]);
+ }
+ 
++>>>>>>> b144ce2d3761 (mei: fix up uuid matching)
  /**
   * Check that sizeof(device_id type) are consistent with size of section
   * in .o file. If in-consistent then userspace and kernel does not agree
* Unmerged path drivers/misc/mei/bus.c
* Unmerged path drivers/nfc/mei_phy.h
* Unmerged path include/linux/mod_devicetable.h
* Unmerged path scripts/mod/file2alias.c
