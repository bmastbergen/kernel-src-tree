powerpc/powernv: Move MSI-related ops to pci_controller_ops

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
Rebuild_CHGLOG: - [powerpc] powernv: Move MSI-related ops to pci_controller_ops (Gustavo Duarte) [1275657]
Rebuild_FUZZ: 92.73%
commit-author Daniel Axtens <dja@axtens.net>
commit d6381119a415316c5602710cf7fbf388d15d6d3c
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/d6381119.failed

Move the PowerNV/BML platform to use the pci_controller_ops structure
rather than ppc_md for MSI related PCI controller operations.

	Signed-off-by: Daniel Axtens <dja@axtens.net>
	Signed-off-by: Michael Ellerman <mpe@ellerman.id.au>
(cherry picked from commit d6381119a415316c5602710cf7fbf388d15d6d3c)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/powerpc/platforms/powernv/pci.c
diff --cc arch/powerpc/platforms/powernv/pci.c
index 3a74d719e520,0f04940b7fb0..000000000000
--- a/arch/powerpc/platforms/powernv/pci.c
+++ b/arch/powerpc/platforms/powernv/pci.c
@@@ -873,16 -762,20 +873,30 @@@ void __init pnv_pci_init(void
  	pci_devs_phb_init();
  
  	/* Configure IOMMU DMA hooks */
 -	ppc_md.tce_build = pnv_tce_build_vm;
 -	ppc_md.tce_free = pnv_tce_free_vm;
 -	ppc_md.tce_build_rm = pnv_tce_build_rm;
 -	ppc_md.tce_free_rm = pnv_tce_free_rm;
 -	ppc_md.tce_get = pnv_tce_get;
 +	ppc_md.pci_dma_dev_setup = pnv_pci_dma_dev_setup;
 +	ppc_md.pci_probe_mode = pnv_pci_probe_mode;
  	set_pci_dma_ops(&dma_iommu_ops);
++<<<<<<< HEAD
 +
 +	/* Configure MSIs */
 +#ifdef CONFIG_PCI_MSI
 +	ppc_md.msi_check_device = pnv_msi_check_device;
 +	ppc_md.setup_msi_irqs = pnv_setup_msi_irqs;
 +	ppc_md.teardown_msi_irqs = pnv_teardown_msi_irqs;
 +#endif
 +}
 +
 +machine_subsys_initcall_sync(powernv, tce_iommu_bus_notifier_init);
++=======
+ }
+ 
+ machine_subsys_initcall_sync(powernv, tce_iommu_bus_notifier_init);
+ 
+ struct pci_controller_ops pnv_pci_controller_ops = {
+ 	.dma_dev_setup = pnv_pci_dma_dev_setup,
+ #ifdef CONFIG_PCI_MSI
+ 	.setup_msi_irqs = pnv_setup_msi_irqs,
+ 	.teardown_msi_irqs = pnv_teardown_msi_irqs,
+ #endif
+ };
++>>>>>>> d6381119a415 (powerpc/powernv: Move MSI-related ops to pci_controller_ops)
* Unmerged path arch/powerpc/platforms/powernv/pci.c
