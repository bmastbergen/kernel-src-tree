netfilter: bridge: fix NULL deref in physin/out ifindex helpers

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
commit-author Florian Westphal <fw@strlen.de>
commit 547c4b547e07dcc60874b6ef6252dd49ff74aec1
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/547c4b54.failed

Might not have an outdev yet. We'll oops when iface goes down while skbs
are still nfqueue'd:

RIP: 0010:[<ffffffff81422a2f>]  [<ffffffff81422a2f>] dev_cmp+0x4f/0x80
nfqnl_rcv_dev_event+0xe2/0x150
notifier_call_chain+0x53/0xa0

Fixes: c737b7c4510026 ("netfilter: bridge: add helpers for fetching physin/outdev")
	Signed-off-by: Florian Westphal <fw@strlen.de>
	Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
(cherry picked from commit 547c4b547e07dcc60874b6ef6252dd49ff74aec1)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	include/linux/netfilter_bridge.h
diff --cc include/linux/netfilter_bridge.h
index 91f08439b405,f2fdb5a52070..000000000000
--- a/include/linux/netfilter_bridge.h
+++ b/include/linux/netfilter_bridge.h
@@@ -111,9 -37,40 +111,45 @@@ static inline void br_drop_fake_rtable(
  		skb_dst_drop(skb);
  }
  
++<<<<<<< HEAD
++=======
+ static inline int nf_bridge_get_physinif(const struct sk_buff *skb)
+ {
+ 	struct nf_bridge_info *nf_bridge;
+ 
+ 	if (skb->nf_bridge == NULL)
+ 		return 0;
+ 
+ 	nf_bridge = skb->nf_bridge;
+ 	return nf_bridge->physindev ? nf_bridge->physindev->ifindex : 0;
+ }
+ 
+ static inline int nf_bridge_get_physoutif(const struct sk_buff *skb)
+ {
+ 	struct nf_bridge_info *nf_bridge;
+ 
+ 	if (skb->nf_bridge == NULL)
+ 		return 0;
+ 
+ 	nf_bridge = skb->nf_bridge;
+ 	return nf_bridge->physoutdev ? nf_bridge->physoutdev->ifindex : 0;
+ }
+ 
+ static inline struct net_device *
+ nf_bridge_get_physindev(const struct sk_buff *skb)
+ {
+ 	return skb->nf_bridge ? skb->nf_bridge->physindev : NULL;
+ }
+ 
+ static inline struct net_device *
+ nf_bridge_get_physoutdev(const struct sk_buff *skb)
+ {
+ 	return skb->nf_bridge ? skb->nf_bridge->physoutdev : NULL;
+ }
++>>>>>>> 547c4b547e07 (netfilter: bridge: fix NULL deref in physin/out ifindex helpers)
  #else
 +#define nf_bridge_maybe_copy_header(skb)	(0)
 +#define nf_bridge_pad(skb)			(0)
  #define br_drop_fake_rtable(skb)	        do { } while (0)
  #endif /* CONFIG_BRIDGE_NETFILTER */
  
* Unmerged path include/linux/netfilter_bridge.h
