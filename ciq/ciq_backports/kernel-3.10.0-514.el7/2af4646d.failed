perf stat record: Store events IDs in perf data file

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
commit-author Jiri Olsa <jolsa@kernel.org>
commit 2af4646d1041ee590b0032d2b0103fa81aa43174
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/2af4646d.failed

Store event IDs in evlist object so it get stored into perf.data file.

	Signed-off-by: Jiri Olsa <jolsa@kernel.org>
	Tested-by: Kan Liang <kan.liang@intel.com>
	Cc: David Ahern <dsahern@gmail.com>
	Cc: Namhyung Kim <namhyung@kernel.org>
	Cc: Peter Zijlstra <a.p.zijlstra@chello.nl>
Link: http://lkml.kernel.org/r/1446734469-11352-6-git-send-email-jolsa@kernel.org
	Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>
(cherry picked from commit 2af4646d1041ee590b0032d2b0103fa81aa43174)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	tools/perf/builtin-stat.c
diff --cc tools/perf/builtin-stat.c
index 473fc692d35a,39d0c30f0f59..000000000000
--- a/tools/perf/builtin-stat.c
+++ b/tools/perf/builtin-stat.c
@@@ -283,6 -317,67 +283,70 @@@ static void workload_exec_failed_signal
  	workload_exec_errno = info->si_value.sival_int;
  }
  
++<<<<<<< HEAD
++=======
+ static int perf_stat_synthesize_config(void)
+ {
+ 	int err;
+ 
+ 	err = perf_event__synthesize_thread_map2(NULL, evsel_list->threads,
+ 						process_synthesized_event,
+ 						NULL);
+ 	if (err < 0) {
+ 		pr_err("Couldn't synthesize thread map.\n");
+ 		return err;
+ 	}
+ 
+ 	err = perf_event__synthesize_cpu_map(NULL, evsel_list->cpus,
+ 					     process_synthesized_event, NULL);
+ 	if (err < 0) {
+ 		pr_err("Couldn't synthesize thread map.\n");
+ 		return err;
+ 	}
+ 
+ 	err = perf_event__synthesize_stat_config(NULL, &stat_config,
+ 						 process_synthesized_event, NULL);
+ 	if (err < 0) {
+ 		pr_err("Couldn't synthesize config.\n");
+ 		return err;
+ 	}
+ 
+ 	return 0;
+ }
+ 
+ #define FD(e, x, y) (*(int *)xyarray__entry(e->fd, x, y))
+ 
+ static int __store_counter_ids(struct perf_evsel *counter,
+ 			       struct cpu_map *cpus,
+ 			       struct thread_map *threads)
+ {
+ 	int cpu, thread;
+ 
+ 	for (cpu = 0; cpu < cpus->nr; cpu++) {
+ 		for (thread = 0; thread < threads->nr; thread++) {
+ 			int fd = FD(counter, cpu, thread);
+ 
+ 			if (perf_evlist__id_add_fd(evsel_list, counter,
+ 						   cpu, thread, fd) < 0)
+ 				return -1;
+ 		}
+ 	}
+ 
+ 	return 0;
+ }
+ 
+ static int store_counter_ids(struct perf_evsel *counter)
+ {
+ 	struct cpu_map *cpus = counter->cpus;
+ 	struct thread_map *threads = counter->threads;
+ 
+ 	if (perf_evsel__alloc_id(counter, cpus->nr, threads->nr))
+ 		return -ENOMEM;
+ 
+ 	return __store_counter_ids(counter, cpus, threads);
+ }
+ 
++>>>>>>> 2af4646d1041 (perf stat record: Store events IDs in perf data file)
  static int __run_perf_stat(int argc, const char **argv)
  {
  	int interval = stat_config.interval;
* Unmerged path tools/perf/builtin-stat.c
