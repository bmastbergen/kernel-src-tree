openvswitch: Scrub skb between namespaces

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
commit-author Joe Stringer <joestringer@nicira.com>
commit 740dbc289155fdeed32438396370e70b684cd45e
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/740dbc28.failed

If OVS receives a packet from another namespace, then the packet should
be scrubbed. However, people have already begun to rely on the behaviour
that skb->mark is preserved across namespaces, so retain this one field.

This is mainly to address information leakage between namespaces when
using OVS internal ports, but by placing it in ovs_vport_receive() it is
more generally applicable, meaning it should not be overlooked if other
port types are allowed to be moved into namespaces in future.

	Signed-off-by: Joe Stringer <joestringer@nicira.com>
	Acked-by: Pravin B Shelar <pshelar@nicira.com>
	Acked-by: Thomas Graf <tgraf@suug.ch>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 740dbc289155fdeed32438396370e70b684cd45e)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/openvswitch/vport.c
diff --cc net/openvswitch/vport.c
index af23ba077836,12a36ac21eda..000000000000
--- a/net/openvswitch/vport.c
+++ b/net/openvswitch/vport.c
@@@ -475,15 -442,17 +475,28 @@@ void ovs_vport_receive(struct vport *vp
  	struct sw_flow_key key;
  	int error;
  
 +	stats = this_cpu_ptr(vport->percpu_stats);
 +	u64_stats_update_begin(&stats->syncp);
 +	stats->rx_packets++;
 +	stats->rx_bytes += skb->len +
 +			   (skb_vlan_tag_present(skb) ? VLAN_HLEN : 0);
 +	u64_stats_update_end(&stats->syncp);
 +
  	OVS_CB(skb)->input_vport = vport;
++<<<<<<< HEAD
 +	OVS_CB(skb)->egress_tun_info = NULL;
++=======
+ 	OVS_CB(skb)->mru = 0;
+ 	if (unlikely(dev_net(skb->dev) != ovs_dp_get_net(vport->dp))) {
+ 		u32 mark;
+ 
+ 		mark = skb->mark;
+ 		skb_scrub_packet(skb, true);
+ 		skb->mark = mark;
+ 		tun_info = NULL;
+ 	}
+ 
++>>>>>>> 740dbc289155 (openvswitch: Scrub skb between namespaces)
  	/* Extract flow from 'skb' into 'key'. */
  	error = ovs_flow_key_extract(tun_info, skb, &key);
  	if (unlikely(error)) {
* Unmerged path net/openvswitch/vport.c
