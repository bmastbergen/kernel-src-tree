acpi, nfit: fix acpi_check_dsm() vs zero functions implemented

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
Rebuild_CHGLOG: - [acpi] nfit: fix acpi_check_dsm() vs zero functions implemented (Jeff Moyer) [1271957 1278621 1343736 1349587 1349702 1353614 1355792]
Rebuild_FUZZ: 94.92%
commit-author Dan Williams <dan.j.williams@intel.com>
commit 4995734e973a2c2e9c6f6413cbad9913fc4df0dc
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/4995734e.failed

QEMU 2.6 implements nascent support for nvdimm DSMs. Depending on
configuration it may only implement the function0 dsm to indicate that
no other DSMs are available. Commit 31eca76ba2fc "nfit, libnvdimm:
limited/whitelisted dimm command marshaling mechanism" breaks QEMU, but
QEMU is spec compliant.  Per the spec the way to indicate that no
functions are supported is:

    If Function Index is zero, the return is a buffer containing one bit
    for each function index, starting with zero. Bit 0 indicates whether
    there is support for any functions other than function 0 for the
    specified UUID and Revision ID. If set to zero, no functions are
    supported (other than function zero) for the specified UUID and
    Revision ID.

Update the nfit driver to determine the family (interface UUID) without
requiring the implementation to define any other functions, i.e.
short-circuit acpi_check_dsm() to succeed per the spec.  The nfit driver
appears to be the only user passing funcs==0 to acpi_check_dsm(), so
this behavior change of the common routine should be limited to the
probing done by the nfit driver.

	Cc: Len Brown <lenb@kernel.org>
	Cc: Jerry Hoemann <jerry.hoemann@hpe.com>
	Acked-by: "Rafael J. Wysocki" <rafael@kernel.org>
Fixes: 31eca76ba2fc ("nfit, libnvdimm: limited/whitelisted dimm command marshaling mechanism")
	Reported-by: Xiao Guangrong <guangrong.xiao@linux.intel.com>
	Tested-by: Xiao Guangrong <guangrong.xiao@linux.intel.com>
	Signed-off-by: Dan Williams <dan.j.williams@intel.com>
(cherry picked from commit 4995734e973a2c2e9c6f6413cbad9913fc4df0dc)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/acpi/nfit.c
* Unmerged path drivers/acpi/nfit.c
* Unmerged path drivers/acpi/nfit.c
diff --git a/drivers/acpi/utils.c b/drivers/acpi/utils.c
index acd0b403831c..343ff9d1ec5e 100644
--- a/drivers/acpi/utils.c
+++ b/drivers/acpi/utils.c
@@ -657,9 +657,6 @@ bool acpi_check_dsm(acpi_handle handle, const u8 *uuid, u64 rev, u64 funcs)
 	u64 mask = 0;
 	union acpi_object *obj;
 
-	if (funcs == 0)
-		return false;
-
 	obj = acpi_evaluate_dsm(handle, uuid, rev, 0, NULL);
 	if (!obj)
 		return false;
@@ -672,6 +669,9 @@ bool acpi_check_dsm(acpi_handle handle, const u8 *uuid, u64 rev, u64 funcs)
 			mask |= (((u8)obj->buffer.pointer[i]) << (i * 8));
 	ACPI_FREE(obj);
 
+	if (funcs == 0)
+		return true;
+
 	/*
 	 * Bit 0 indicates whether there's support for any functions other than
 	 * function 0 for the specified UUID and revision.
