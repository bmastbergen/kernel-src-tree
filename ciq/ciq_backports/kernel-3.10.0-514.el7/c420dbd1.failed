ACPI: Implement proper length checks for mem resources

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
Rebuild_CHGLOG: - [acpi] Implement proper length checks for mem resources (Myron Stowe) [1344513]
Rebuild_FUZZ: 94.12%
commit-author Thomas Gleixner <tglx@linutronix.de>
commit c420dbd13ef7f399a865498496ac9ce2755b8007
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/c420dbd1.failed

Check whether the resulting length is the same as the given
length. Check for start <= end as well.

We need to hand in the resource for this, so we can apply the flags
directly.

[Jiang] Remove enforcement that resource starting address must be
non-zero.

	Signed-off-by: Thomas Gleixner <tglx@linutronix.de>
	Signed-off-by: Jiang Liu <jiang.liu@linux.intel.com>
	Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>
(cherry picked from commit c420dbd13ef7f399a865498496ac9ce2755b8007)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/acpi/resource.c
diff --cc drivers/acpi/resource.c
index d4c3d7640715,3e7d9f6eb875..000000000000
--- a/drivers/acpi/resource.c
+++ b/drivers/acpi/resource.c
@@@ -199,16 -209,15 +209,22 @@@ bool acpi_dev_resource_address_space(st
  
  	switch(addr.resource_type) {
  	case ACPI_MEMORY_RANGE:
++<<<<<<< HEAD
 +		len = addr.maximum - addr.minimum + 1;
 +		res->flags = acpi_dev_memresource_flags(len,
 +						addr.info.mem.write_protect,
 +						window);
++=======
+ 		acpi_dev_memresource_flags(res, addr.address.address_length,
+ 					   addr.info.mem.write_protect,
+ 					   window);
++>>>>>>> c420dbd13ef7 (ACPI: Implement proper length checks for mem resources)
  		break;
  	case ACPI_IO_RANGE:
 -		io_decode = addr.address.granularity == 0xfff ?
 +		io_decode = addr.granularity == 0xfff ?
  				ACPI_DECODE_10 : ACPI_DECODE_16;
 -		res->flags = acpi_dev_ioresource_flags(addr.address.minimum,
 -						       addr.address.maximum,
 +		res->flags = acpi_dev_ioresource_flags(addr.minimum,
 +						       addr.maximum,
  						       io_decode, window);
  		break;
  	case ACPI_BUS_NUMBER_RANGE:
@@@ -250,16 -258,16 +265,23 @@@ bool acpi_dev_resource_ext_address_spac
  
  	switch(ext_addr->resource_type) {
  	case ACPI_MEMORY_RANGE:
++<<<<<<< HEAD
 +		len = ext_addr->maximum - ext_addr->minimum + 1;
 +		res->flags = acpi_dev_memresource_flags(len,
 +					ext_addr->info.mem.write_protect,
 +					window);
++=======
+ 		acpi_dev_memresource_flags(res,
+ 					   ext_addr->address.address_length,
+ 					   ext_addr->info.mem.write_protect,
+ 					   window);
++>>>>>>> c420dbd13ef7 (ACPI: Implement proper length checks for mem resources)
  		break;
  	case ACPI_IO_RANGE:
 -		io_decode = ext_addr->address.granularity == 0xfff ?
 +		io_decode = ext_addr->granularity == 0xfff ?
  				ACPI_DECODE_10 : ACPI_DECODE_16;
 -		res->flags = acpi_dev_ioresource_flags(ext_addr->address.minimum,
 -						       ext_addr->address.maximum,
 +		res->flags = acpi_dev_ioresource_flags(ext_addr->minimum,
 +						       ext_addr->maximum,
  						       io_decode, window);
  		break;
  	case ACPI_BUS_NUMBER_RANGE:
* Unmerged path drivers/acpi/resource.c
