r8152: fix the wake event

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
commit-author hayeswang <hayeswang@realtek.com>
commit 5ee3c60c8d3b88cab6496c9b7d49a01576dd9cf9
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/5ee3c60c.failed

When the autosuspend is enabled and occurs before system suspend, we should
wake the device before running system syspend. Then, we could change the wake
event for system suspend. Otherwise, the device would resume the system when
receiving any packet.

	Signed-off-by: Hayes Wang <hayeswang@realtek.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 5ee3c60c8d3b88cab6496c9b7d49a01576dd9cf9)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/usb/r8152.c
diff --cc drivers/net/usb/r8152.c
index caccdf613161,ef9aab6712a3..000000000000
--- a/drivers/net/usb/r8152.c
+++ b/drivers/net/usb/r8152.c
@@@ -25,11 -24,18 +25,24 @@@
  #include <net/ip6_checksum.h>
  #include <uapi/linux/mdio.h>
  #include <linux/mdio.h>
++<<<<<<< HEAD
 +
 +/* Version Information */
 +#define DRIVER_VERSION "v1.06.0 (2014/03/03)"
++=======
+ #include <linux/usb/cdc.h>
+ #include <linux/suspend.h>
+ 
+ /* Information for net-next */
+ #define NETNEXT_VERSION		"08"
+ 
+ /* Information for net */
+ #define NET_VERSION		"3"
+ 
+ #define DRIVER_VERSION		"v1." NETNEXT_VERSION "." NET_VERSION
++>>>>>>> 5ee3c60c8d3b (r8152: fix the wake event)
  #define DRIVER_AUTHOR "Realtek linux nic maintainers <nic_swsd@realtek.com>"
 -#define DRIVER_DESC "Realtek RTL8152/RTL8153 Based USB Ethernet Adapters"
 +#define DRIVER_DESC "Realtek RTL8152 Based USB 2.0 Ethernet Adapters"
  #define MODULENAME "r8152"
  
  #define R8152_PHY_ID		32
@@@ -561,6 -604,10 +574,13 @@@ struct r8152 
  	spinlock_t rx_lock, tx_lock;
  	struct delayed_work schedule;
  	struct mii_if_info mii;
++<<<<<<< HEAD
++=======
+ 	struct mutex control;	/* use for hw setting */
+ #ifdef CONFIG_PM_SLEEP
+ 	struct notifier_block pm_notifier;
+ #endif
++>>>>>>> 5ee3c60c8d3b (r8152: fix the wake event)
  
  	struct rtl_ops {
  		void (*init)(struct r8152 *);
@@@ -2912,9 -3114,17 +2959,13 @@@ static int rtl8152_open(struct net_devi
  		netif_warn(tp, ifup, netdev, "intr_urb submit failed: %d\n",
  			   res);
  		free_all_mem(tp);
 -	} else {
 -		napi_enable(&tp->napi);
  	}
  
 -	mutex_unlock(&tp->control);
 -
  	usb_autopm_put_interface(tp->intf);
+ #ifdef CONFIG_PM_SLEEP
+ 	tp->pm_notifier.notifier_call = rtl_notifier;
+ 	register_pm_notifier(&tp->pm_notifier);
+ #endif
  
  out:
  	return res;
@@@ -2925,6 -3135,10 +2976,13 @@@ static int rtl8152_close(struct net_dev
  	struct r8152 *tp = netdev_priv(netdev);
  	int res = 0;
  
++<<<<<<< HEAD
++=======
+ #ifdef CONFIG_PM_SLEEP
+ 	unregister_pm_notifier(&tp->pm_notifier);
+ #endif
+ 	napi_disable(&tp->napi);
++>>>>>>> 5ee3c60c8d3b (r8152: fix the wake event)
  	clear_bit(WORK_ENABLE, &tp->flags);
  	usb_kill_urb(tp->intr_urb);
  	cancel_delayed_work_sync(&tp->schedule);
* Unmerged path drivers/net/usb/r8152.c
