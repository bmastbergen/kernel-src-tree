powerpc/powernv: Initialize M64 PE in time

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
Rebuild_CHGLOG: - [powerpc] powernv: Initialize M64 PE in time (Gustavo Duarte) [1275657]
Rebuild_FUZZ: 89.47%
commit-author Gavin Shan <gwshan@linux.vnet.ibm.com>
commit 4b82ab18033a7e8434e568a6485e6e5c2e5adb02
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/4b82ab18.failed

The patch initializes PE instance when reserving PE number to
keep consistent things as we did before. Also, it replaces the
iteration on bridge's windows with the prefered way.

	Signed-off-by: Gavin Shan <gwshan@linux.vnet.ibm.com>
	Signed-off-by: Michael Ellerman <mpe@ellerman.id.au>
(cherry picked from commit 4b82ab18033a7e8434e568a6485e6e5c2e5adb02)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/powerpc/platforms/powernv/pci-ioda.c
diff --cc arch/powerpc/platforms/powernv/pci-ioda.c
index b82c0b99b901,7a7a68873df4..000000000000
--- a/arch/powerpc/platforms/powernv/pci-ioda.c
+++ b/arch/powerpc/platforms/powernv/pci-ioda.c
@@@ -132,6 -85,30 +132,33 @@@ static inline void __raw_rm_writeq(u64 
  		: : "r" (val), "r" (paddr) : "memory");
  }
  
++<<<<<<< HEAD
++=======
+ static inline bool pnv_pci_is_mem_pref_64(unsigned long flags)
+ {
+ 	return ((flags & (IORESOURCE_MEM_64 | IORESOURCE_PREFETCH)) ==
+ 		(IORESOURCE_MEM_64 | IORESOURCE_PREFETCH));
+ }
+ 
+ static void pnv_ioda_reserve_pe(struct pnv_phb *phb, int pe_no)
+ {
+ 	if (!(pe_no >= 0 && pe_no < phb->ioda.total_pe)) {
+ 		pr_warn("%s: Invalid PE %d on PHB#%x\n",
+ 			__func__, pe_no, phb->hose->global_number);
+ 		return;
+ 	}
+ 
+ 	if (test_and_set_bit(pe_no, phb->ioda.pe_alloc)) {
+ 		pr_warn("%s: PE %d was assigned on PHB#%x\n",
+ 			__func__, pe_no, phb->hose->global_number);
+ 		return;
+ 	}
+ 
+ 	phb->ioda.pe_array[pe_no].phb = phb;
+ 	phb->ioda.pe_array[pe_no].pe_number = pe_no;
+ }
+ 
++>>>>>>> 4b82ab18033a (powerpc/powernv: Initialize M64 PE in time)
  static int pnv_ioda_alloc_pe(struct pnv_phb *phb)
  {
  	unsigned long pe;
* Unmerged path arch/powerpc/platforms/powernv/pci-ioda.c
