drm/i915: Pass the correct crtc state to .update_plane()

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
Rebuild_CHGLOG: - [drm] i915: Pass the correct crtc state to .update_plane() (Rob Clark) [1348329 1349064]
Rebuild_FUZZ: 96.30%
commit-author Ville Syrj채l채 <ville.syrjala@linux.intel.com>
commit 9f6151c9039084e18c118831779a99ac8f29e39c
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/9f6151c9.failed

Pass the current crtc state, not the old crtc state, to the
.update_plane() hook.

Noticed on BSW when PRIMSIZE was getting programmed to a stale value
which produced utter garbage on screen eg. wwhen going from 1920x1080
to 1024x768.

	Cc: Maarten Lankhorst <maarten.lankhorst@linux.intel.com>
Fixes: a758e6845825 ("drm/i915: Do not use commit_plane for sprite planes.")
	Signed-off-by: Ville Syrj채l채 <ville.syrjala@linux.intel.com>
Link: http://patchwork.freedesktop.org/patch/msgid/1457543247-13987-3-git-send-email-ville.syrjala@linux.intel.com
	Reviewed-by: Maarten Lankhorst <maarten.lankhorst@linux.intel.com>
(cherry picked from commit 9f6151c9039084e18c118831779a99ac8f29e39c)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/gpu/drm/i915/intel_atomic_plane.c
diff --cc drivers/gpu/drm/i915/intel_atomic_plane.c
index 976b89156570,7de7721f65bc..000000000000
--- a/drivers/gpu/drm/i915/intel_atomic_plane.c
+++ b/drivers/gpu/drm/i915/intel_atomic_plane.c
@@@ -171,12 -194,14 +171,23 @@@ static void intel_plane_atomic_update(s
  	struct intel_plane *intel_plane = to_intel_plane(plane);
  	struct intel_plane_state *intel_state =
  		to_intel_plane_state(plane->state);
++<<<<<<< HEAD
 +
 +	/* Don't disable an already disabled plane */
 +	if (!plane->state->fb && !old_state->fb)
 +		return;
 +
 +	intel_plane->commit_plane(plane, intel_state);
++=======
+ 	struct drm_crtc *crtc = plane->state->crtc ?: old_state->crtc;
+ 
+ 	if (intel_state->visible)
+ 		intel_plane->update_plane(plane,
+ 					  to_intel_crtc_state(crtc->state),
+ 					  intel_state);
+ 	else
+ 		intel_plane->disable_plane(plane, crtc);
++>>>>>>> 9f6151c90390 (drm/i915: Pass the correct crtc state to .update_plane())
  }
  
  const struct drm_plane_helper_funcs intel_plane_helper_funcs = {
* Unmerged path drivers/gpu/drm/i915/intel_atomic_plane.c
