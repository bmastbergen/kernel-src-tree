IB/cma: cma_validate_port should verify the port and netdevice

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
commit-author Matan Barak <matanb@mellanox.com>
commit abae1b71dd37bab506b14a6cf6ba7148f4d57232
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/abae1b71.failed

Previously, cma_validate_port searched for GIDs in IB cache and then
tried to verify the found port. This could fail when there are
identical GIDs on both ports. In addition, netdevice should be taken
into account when searching the GID table.
Fixing cma_validate_port to search only the relevant port's cache
and netdevice.

	Signed-off-by: Matan Barak <matanb@mellanox.com>
	Signed-off-by: Doug Ledford <dledford@redhat.com>
(cherry picked from commit abae1b71dd37bab506b14a6cf6ba7148f4d57232)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/infiniband/core/cma.c
diff --cc drivers/infiniband/core/cma.c
index 685c1992d48f,2cbf9c9b4fe4..000000000000
--- a/drivers/infiniband/core/cma.c
+++ b/drivers/infiniband/core/cma.c
@@@ -438,9 -439,13 +439,19 @@@ static inline int cma_validate_port(str
  	if ((dev_type != ARPHRD_INFINIBAND) && rdma_protocol_ib(device, port))
  		return ret;
  
++<<<<<<< HEAD
 +	ret = ib_find_cached_gid(device, gid, &found_port, NULL);
 +	if (port != found_port)
 +		return -ENODEV;
++=======
+ 	if (dev_type == ARPHRD_ETHER)
+ 		ndev = dev_get_by_index(&init_net, bound_if_index);
+ 
+ 	ret = ib_find_cached_gid_by_port(device, gid, port, ndev, NULL);
+ 
+ 	if (ndev)
+ 		dev_put(ndev);
++>>>>>>> abae1b71dd37 (IB/cma: cma_validate_port should verify the port and netdevice)
  
  	return ret;
  }
* Unmerged path drivers/infiniband/core/cma.c
