mm/dmapool: allow NULL `pool' pointer in dma_pool_destroy()

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
Rebuild_CHGLOG: - [mm] dmapool: allow NULL `pool' pointer in dma_pool_destroy() (Mike Snitzer) [1314893]
Rebuild_FUZZ: 97.39%
commit-author Sergey Senozhatsky <sergey.senozhatsky@gmail.com>
commit 44d7175da6ea10e353e69b586bb68bbfef89e403
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/44d7175d.failed

dma_pool_destroy() does not tolerate a NULL dma_pool pointer argument and
performs a NULL-pointer dereference.  This requires additional attention
and effort from developers/reviewers and forces all dma_pool_destroy()
callers to do a NULL check

    if (pool)
        dma_pool_destroy(pool);

Or, otherwise, be invalid dma_pool_destroy() users.

Tweak dma_pool_destroy() and NULL-check the pointer there.

Proposed by Andrew Morton.

Link: https://lkml.org/lkml/2015/6/8/583
	Signed-off-by: Sergey Senozhatsky <sergey.senozhatsky@gmail.com>
	Acked-by: David Rientjes <rientjes@google.com>
	Cc: Julia Lawall <julia.lawall@lip6.fr>
	Cc: Joe Perches <joe@perches.com>
	Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
	Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
(cherry picked from commit 44d7175da6ea10e353e69b586bb68bbfef89e403)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	mm/dmapool.c
diff --cc mm/dmapool.c
index c69781e97cf9,4b657099111f..000000000000
--- a/mm/dmapool.c
+++ b/mm/dmapool.c
@@@ -259,6 -269,12 +259,15 @@@ static void pool_free_page(struct dma_p
   */
  void dma_pool_destroy(struct dma_pool *pool)
  {
++<<<<<<< HEAD
++=======
+ 	bool empty = false;
+ 
+ 	if (unlikely(!pool))
+ 		return;
+ 
+ 	mutex_lock(&pools_reg_lock);
++>>>>>>> 44d7175da6ea (mm/dmapool: allow NULL `pool' pointer in dma_pool_destroy())
  	mutex_lock(&pools_lock);
  	list_del(&pool->pools);
  	if (pool->dev && list_empty(&pool->dev->dma_pools))
* Unmerged path mm/dmapool.c
