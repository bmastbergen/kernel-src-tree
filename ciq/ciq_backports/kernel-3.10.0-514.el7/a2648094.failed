SUNRPC: Move AF_LOCAL receive data path into a workqueue context

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
commit-author Trond Myklebust <trond.myklebust@primarydata.com>
commit a26480942c99d84a7682ea4c00f47a3a42ed41d2
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/a2648094.failed

Now that we've done it for TCP and UDP, let's convert AF_LOCAL as well.

	Signed-off-by: Trond Myklebust <trond.myklebust@primarydata.com>
(cherry picked from commit a26480942c99d84a7682ea4c00f47a3a42ed41d2)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/sunrpc/xprtsock.c
diff --cc net/sunrpc/xprtsock.c
index 8f47abde4939,1471ecceabf9..000000000000
--- a/net/sunrpc/xprtsock.c
+++ b/net/sunrpc/xprtsock.c
@@@ -957,13 -916,13 +959,17 @@@ static int xs_local_copy_to_xdr(struct 
   *
   * Currently this assumes we can read the whole reply in a single gulp.
   */
++<<<<<<< HEAD
 +static void xs_local_data_ready(struct sock *sk, int len)
++=======
+ static void xs_local_data_read_skb(struct rpc_xprt *xprt,
+ 		struct sock *sk,
+ 		struct sk_buff *skb)
++>>>>>>> a26480942c99 (SUNRPC: Move AF_LOCAL receive data path into a workqueue context)
  {
  	struct rpc_task *task;
- 	struct rpc_xprt *xprt;
  	struct rpc_rqst *rovr;
- 	struct sk_buff *skb;
- 	int err, repsize, copied;
+ 	int repsize, copied;
  	u32 _xid;
  	__be32 *xp;
  
@@@ -1957,10 -1958,10 +1977,10 @@@ static int xs_local_finish_connecting(s
  		xs_save_old_callbacks(transport, sk);
  
  		sk->sk_user_data = xprt;
- 		sk->sk_data_ready = xs_local_data_ready;
+ 		sk->sk_data_ready = xs_data_ready;
  		sk->sk_write_space = xs_udp_write_space;
  		sk->sk_error_report = xs_error_report;
 -		sk->sk_allocation = GFP_NOIO;
 +		sk->sk_allocation = GFP_ATOMIC;
  
  		xprt_clear_connected(xprt);
  
@@@ -2718,6 -2789,7 +2738,10 @@@ static struct rpc_xprt *xs_setup_local(
  	xprt->ops = &xs_local_ops;
  	xprt->timeout = &xs_local_default_timeout;
  
++<<<<<<< HEAD
++=======
+ 	INIT_WORK(&transport->recv_worker, xs_local_data_receive_workfn);
++>>>>>>> a26480942c99 (SUNRPC: Move AF_LOCAL receive data path into a workqueue context)
  	INIT_DELAYED_WORK(&transport->connect_worker,
  			xs_dummy_setup_socket);
  
* Unmerged path net/sunrpc/xprtsock.c
