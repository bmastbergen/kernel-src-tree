mmc: sdhci: properly check card present state when quirk NO_CARD_NO_RESET is set

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
Rebuild_CHGLOG: - [mmc] sdhci: properly check card present state when quirk NO_CARD_NO_RESET is set (Don Zickus) [1127975 1277866 1280133 1286932 1297039]
Rebuild_FUZZ: 96.77%
commit-author Ivan T. Ivanov <ivan.ivanov@linaro.org>
commit 135b0a284d9c2bcfb64a5f7d90c439ede8bc5e06
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/135b0a28.failed

Controller could have both NO_CARD_NO_RESET and BROKEN_CARD_DETECTION
quirks set. Use sdhci_do_get_cd() when applying NO_CARD_NO_RESET, which
properly check for BROKEN_CARD_DETECTION quirk.

	Signed-off-by: Ivan T. Ivanov <ivan.ivanov@linaro.org>
	Signed-off-by: Ulf Hansson <ulf.hansson@linaro.org>
(cherry picked from commit 135b0a284d9c2bcfb64a5f7d90c439ede8bc5e06)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/mmc/host/sdhci.c
diff --cc drivers/mmc/host/sdhci.c
index 720a08a5c84f,c83d11080da0..000000000000
--- a/drivers/mmc/host/sdhci.c
+++ b/drivers/mmc/host/sdhci.c
@@@ -233,12 -201,17 +233,21 @@@ static void sdhci_reset(struct sdhci_ho
  		timeout--;
  		mdelay(1);
  	}
 -}
 -EXPORT_SYMBOL_GPL(sdhci_reset);
  
++<<<<<<< HEAD
 +	if (host->ops->platform_reset_exit)
 +		host->ops->platform_reset_exit(host, mask);
++=======
+ static void sdhci_do_reset(struct sdhci_host *host, u8 mask)
+ {
+ 	if (host->quirks & SDHCI_QUIRK_NO_CARD_NO_RESET) {
+ 		if (!sdhci_do_get_cd(host))
+ 			return;
+ 	}
++>>>>>>> 135b0a284d9c (mmc: sdhci: properly check card present state when quirk NO_CARD_NO_RESET is set)
  
 -	host->ops->reset(host, mask);
 +	if (host->quirks & SDHCI_QUIRK_RESTORE_IRQS_AFTER_RESET)
 +		sdhci_clear_set_irqs(host, SDHCI_INT_ALL_MASK, ier);
  
  	if (mask & SDHCI_RESET_ALL) {
  		if (host->flags & (SDHCI_USE_SDMA | SDHCI_USE_ADMA)) {
* Unmerged path drivers/mmc/host/sdhci.c
