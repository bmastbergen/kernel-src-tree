net/mlx5: Unmap only the relevant IO memory mapping

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
Rebuild_CHGLOG: - [netdrv] mlx5: Unmap only the relevant IO memory mapping (kamal heib) [1275159 1296272 1296405 1298421 1298422 1298423 1298424 1298425]
Rebuild_FUZZ: 95.92%
commit-author Gal Pressman <galp@mellanox.com>
commit 5f8a02a441b861fd3b1b5135a1a6e1c13ee4bb33
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/5f8a02a4.failed

When freeing UAR the driver tries to unmap uar->map and uar->bf_map
which are mutually exclusive thus always unmapping a NULL pointer.
Make sure we only call iounmap() once, for the actual mapping.

Fixes: 0ba422410bbf ('net/mlx5: Fix global UAR mapping')
	Signed-off-by: Gal Pressman <galp@mellanox.com>
	Reported-by: Doron Tsur <doront@mellanox.com>
	Signed-off-by: Saeed Mahameed <saeedm@mellanox.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 5f8a02a441b861fd3b1b5135a1a6e1c13ee4bb33)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/mellanox/mlx5/core/uar.c
diff --cc drivers/net/ethernet/mellanox/mlx5/core/uar.c
index eb05c845ece9,5ff8af472bf5..000000000000
--- a/drivers/net/ethernet/mellanox/mlx5/core/uar.c
+++ b/drivers/net/ethernet/mellanox/mlx5/core/uar.c
@@@ -262,8 -269,10 +262,15 @@@ EXPORT_SYMBOL(mlx5_alloc_map_uar)
  
  void mlx5_unmap_free_uar(struct mlx5_core_dev *mdev, struct mlx5_uar *uar)
  {
++<<<<<<< HEAD
 +	io_mapping_unmap(uar->bf_map);
 +	iounmap(uar->map);
++=======
+ 	if (uar->map)
+ 		iounmap(uar->map);
+ 	else
+ 		iounmap(uar->bf_map);
++>>>>>>> 5f8a02a441b8 (net/mlx5: Unmap only the relevant IO memory mapping)
  	mlx5_cmd_free_uar(mdev, uar->index);
  }
  EXPORT_SYMBOL(mlx5_unmap_free_uar);
* Unmerged path drivers/net/ethernet/mellanox/mlx5/core/uar.c
