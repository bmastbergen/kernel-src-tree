IB/qib: Use rdmavt pkey verbs function

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
commit-author Harish Chegondi <harish.chegondi@intel.com>
commit 76fec3e08c1205c4b57bd934727cbbf7223b8dac
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/76fec3e0.failed

Remove qib query pkey function which is no longer needed as this is now
being done in rdmavt. The allocation and maintenance of the list still
resides in the driver.

	Reviewed-by: Dennis Dalessandro <dennis.dalessandro@intel.com>
	Signed-off-by: Harish Chegondi <harish.chegondi@intel.com>
	Signed-off-by: Doug Ledford <dledford@redhat.com>
(cherry picked from commit 76fec3e08c1205c4b57bd934727cbbf7223b8dac)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/infiniband/hw/qib/qib_verbs.c
diff --cc drivers/infiniband/hw/qib/qib_verbs.c
index c4417a1f33be,74cb50104e0e..000000000000
--- a/drivers/infiniband/hw/qib/qib_verbs.c
+++ b/drivers/infiniband/hw/qib/qib_verbs.c
@@@ -2089,7 -1943,7 +2071,11 @@@ int qib_register_ib_device(struct qib_d
  	struct qib_ibdev *dev = &dd->verbs_dev;
  	struct ib_device *ibdev = &dev->rdi.ibdev;
  	struct qib_pportdata *ppd = dd->pport;
++<<<<<<< HEAD
 +	unsigned i, lk_tab_size;
++=======
+ 	unsigned i, ctxt;
++>>>>>>> 76fec3e08c12 (IB/qib: Use rdmavt pkey verbs function)
  	int ret;
  
  	dev->qp_table_size = ib_qib_qp_table_size;
@@@ -2283,11 -2106,24 +2269,26 @@@
  	dd->verbs_dev.rdi.driver_f.port_callback = qib_create_port_files;
  	dd->verbs_dev.rdi.driver_f.get_card_name = qib_get_card_name;
  	dd->verbs_dev.rdi.driver_f.get_pci_dev = qib_get_pci_dev;
 -	dd->verbs_dev.rdi.driver_f.check_ah = qib_check_ah;
 -	dd->verbs_dev.rdi.driver_f.notify_new_ah = qib_notify_new_ah;
  	dd->verbs_dev.rdi.dparms.props.max_pd = ib_qib_max_pds;
 -	dd->verbs_dev.rdi.dparms.props.max_ah = ib_qib_max_ahs;
 -	dd->verbs_dev.rdi.flags = (RVT_FLAG_QP_INIT_DRIVER |
 +	dd->verbs_dev.rdi.flags = (RVT_FLAG_MR_INIT_DRIVER |
 +				   RVT_FLAG_QP_INIT_DRIVER |
  				   RVT_FLAG_CQ_INIT_DRIVER);
- 
++<<<<<<< HEAD
++
++=======
+ 	dd->verbs_dev.rdi.dparms.lkey_table_size = qib_lkey_table_size;
+ 	dd->verbs_dev.rdi.dparms.nports = dd->num_pports;
+ 	dd->verbs_dev.rdi.dparms.npkeys = qib_get_npkeys(dd);
+ 
+ 	ppd = dd->pport;
+ 	for (i = 0; i < dd->num_pports; i++, ppd++) {
+ 		ctxt = ppd->hw_pidx;
+ 		rvt_init_port(&dd->verbs_dev.rdi,
+ 			      &ppd->ibport_data.rvp,
+ 			      i,
+ 			      dd->rcd[ctxt]->pkeys);
+ 	}
++>>>>>>> 76fec3e08c12 (IB/qib: Use rdmavt pkey verbs function)
  
  	ret = rvt_register_device(&dd->verbs_dev.rdi);
  	if (ret)
* Unmerged path drivers/infiniband/hw/qib/qib_verbs.c
