tools: Support relative directory path for 'O='

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
Rebuild_CHGLOG: - [makefile] revert "tools: Support relative directory path for 'O='" (Josh Poimboeuf) [1347232]
Rebuild_FUZZ: 89.52%
commit-author Josh Poimboeuf <jpoimboe@redhat.com>
commit e17cf3a80d4ba0c4e40bf1a89deb1354c2e10e14
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/e17cf3a8.failed

Running "make O=foo" (with a relative directory path) fails with:

  scripts/Makefile.include:3: *** O=foo does not exist.  Stop.
  /home/jpoimboe/git/linux/Makefile:1547: recipe for target 'tools/objtool' failed

The tools Makefile gets confused by the relative path and tries to build
objtool in tools/foo.  Convert the output directory to an absolute path
before passing it to the tools Makefile.

	Reported-by: Sudip Mukherjee <sudipm.mukherjee@gmail.com>
	Signed-off-by: Josh Poimboeuf <jpoimboe@redhat.com>
	Cc: Andrew Morton <akpm@linux-foundation.org>
	Cc: Jiri Olsa <jolsa@kernel.org>
	Cc: Linus Torvalds <torvalds@linux-foundation.org>
	Cc: Peter Zijlstra <peterz@infradead.org>
	Cc: Stephen Rothwell <sfr@canb.auug.org.au>
	Cc: Thomas Gleixner <tglx@linutronix.de>
	Cc: linux-next@vger.kernel.org
	Cc: linux@roeck-us.net
	Cc: live-patching@vger.kernel.org
Link: http://lkml.kernel.org/r/94a078c6c998fac9f01a14f574008bf7dff40191.1457016803.git.jpoimboe@redhat.com
	Signed-off-by: Ingo Molnar <mingo@kernel.org>
(cherry picked from commit e17cf3a80d4ba0c4e40bf1a89deb1354c2e10e14)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	Makefile
diff --cc Makefile
index 9bf0ea111cf7,2c27a01c42f1..000000000000
--- a/Makefile
+++ b/Makefile
@@@ -1389,11 -1506,14 +1389,19 @@@ kernelversion
  # Clear a bunch of variables before executing the submake
  tools/: FORCE
  	$(Q)mkdir -p $(objtree)/tools
++<<<<<<< HEAD
 +	$(Q)$(MAKE) LDFLAGS= MAKEFLAGS="$(filter --j% -j,$(MAKEFLAGS))" O=$(objtree) subdir=tools -C $(src)/tools/
 +
 +tools/%: FORCE
 +	$(Q)mkdir -p $(objtree)/tools
 +	$(Q)$(MAKE) LDFLAGS= MAKEFLAGS="$(filter --j% -j,$(MAKEFLAGS))" O=$(objtree) subdir=tools -C $(src)/tools/ $*
++=======
+ 	$(Q)$(MAKE) LDFLAGS= MAKEFLAGS="$(filter --j% -j,$(MAKEFLAGS))" O=$(shell cd $(objtree) && /bin/pwd) subdir=tools -C $(src)/tools/
+ 
+ tools/%: FORCE
+ 	$(Q)mkdir -p $(objtree)/tools
+ 	$(Q)$(MAKE) LDFLAGS= MAKEFLAGS="$(filter --j% -j,$(MAKEFLAGS))" O=$(shell cd $(objtree) && /bin/pwd) subdir=tools -C $(src)/tools/ $*
++>>>>>>> e17cf3a80d4b (tools: Support relative directory path for 'O=')
  
  # Single targets
  # ---------------------------------------------------------------------------
* Unmerged path Makefile
