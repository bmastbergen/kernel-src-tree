IB/qib,rdmavt: Move smi_ah to qib

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
Rebuild_CHGLOG: - [infiniband] ib/qib, rdmavt: Move smi_ah to qib (Alex Estrin) [1272062 1273170]
Rebuild_FUZZ: 98.51%
commit-author Dennis Dalessandro <dennis.dalessandro@intel.com>
commit 4eadd8ff21bffcaf3338267dcca571accc612c8e
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/4eadd8ff.failed

Rdmavt adopted an smi_ah from qib which is not needed by hfi1. Move this
back to qib and get it out of the common library.

	Reviewed-by: Ira Weiny <ira.weiny@intel.com>
	Reviewed-by: Jubin John <jubin.john@intel.com>
	Signed-off-by: Dennis Dalessandro <dennis.dalessandro@intel.com>
	Signed-off-by: Doug Ledford <dledford@redhat.com>
(cherry picked from commit 4eadd8ff21bffcaf3338267dcca571accc612c8e)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/infiniband/hw/qib/qib_iba7322.c
#	drivers/infiniband/hw/qib/qib_verbs.h
diff --cc drivers/infiniband/hw/qib/qib_iba7322.c
index 181e226c8045,ca28c19d9618..000000000000
--- a/drivers/infiniband/hw/qib/qib_iba7322.c
+++ b/drivers/infiniband/hw/qib/qib_iba7322.c
@@@ -5515,7 -5515,7 +5515,11 @@@ static void try_7322_ipg(struct qib_ppo
  			ret = PTR_ERR(ah);
  		else {
  			send_buf->ah = ah;
++<<<<<<< HEAD
 +			ibp->smi_ah = to_iah(ah);
++=======
+ 			ibp->smi_ah = ibah_to_rvtah(ah);
++>>>>>>> 4eadd8ff21bf (IB/qib,rdmavt: Move smi_ah to qib)
  			ret = 0;
  		}
  	} else {
diff --cc drivers/infiniband/hw/qib/qib_verbs.h
index ca366073af4f,4b76a8d59337..000000000000
--- a/drivers/infiniband/hw/qib/qib_verbs.h
+++ b/drivers/infiniband/hw/qib/qib_verbs.h
@@@ -685,21 -218,9 +685,26 @@@ struct qib_pma_counters 
  };
  
  struct qib_ibport {
++<<<<<<< HEAD
 +	struct qib_qp __rcu *qp0;
 +	struct qib_qp __rcu *qp1;
 +	struct ib_mad_agent *send_agent;	/* agent for SMI (traps) */
 +	struct qib_ah *sm_ah;
 +	struct qib_ah *smi_ah;
 +	struct rb_root mcast_tree;
 +	spinlock_t lock;		/* protect changes in this struct */
 +
 +	/* non-zero when timer is set */
 +	unsigned long mkey_lease_timeout;
 +	unsigned long trap_timeout;
 +	__be64 gid_prefix;      /* in network order */
 +	__be64 mkey;
++=======
+ 	struct rvt_ibport rvp;
+ 	struct rvt_ah *smi_ah;
++>>>>>>> 4eadd8ff21bf (IB/qib,rdmavt: Move smi_ah to qib)
  	__be64 guids[QIB_GUIDS_PER_PORT	- 1];	/* writable GUIDs */
 +	u64 tid;		/* TID for traps */
  	struct qib_pma_counters __percpu *pmastats;
  	u64 z_unicast_xmit;     /* starting count for PMA */
  	u64 z_unicast_rcv;      /* starting count for PMA */
* Unmerged path drivers/infiniband/hw/qib/qib_iba7322.c
* Unmerged path drivers/infiniband/hw/qib/qib_verbs.h
diff --git a/include/rdma/rdma_vt.h b/include/rdma/rdma_vt.h
index ce737017c759..b53a2ebfd088 100644
--- a/include/rdma/rdma_vt.h
+++ b/include/rdma/rdma_vt.h
@@ -137,7 +137,6 @@ struct rvt_ibport {
 	u16 *pkey_table;
 
 	struct rvt_ah *sm_ah;
-	struct rvt_ah *smi_ah;
 };
 
 #define RVT_CQN_MAX 16 /* maximum length of cq name */
