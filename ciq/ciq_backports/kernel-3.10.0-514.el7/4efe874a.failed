PCI: Don't read past the end of sysfs "driver_override" buffer

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
Rebuild_CHGLOG: - [pci] Don't read past the end of sysfs "driver_override" buffer (Myron Stowe) [1331507]
Rebuild_FUZZ: 95.87%
commit-author Sasha Levin <sasha.levin@oracle.com>
commit 4efe874aace57dba967624ce1c48322da2447b75
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/4efe874a.failed

When printing the driver_override parameter when it is 4095 and 4094 bytes
long, the printing code would access invalid memory because we need count+1
bytes for printing.

Fixes: 782a985d7af2 ("PCI: Introduce new device binding path using pci_dev.driver_override")
	Signed-off-by: Sasha Levin <sasha.levin@oracle.com>
	Signed-off-by: Bjorn Helgaas <bhelgaas@google.com>
	Acked-by: Alex Williamson <alex.williamson@redhat.com>
CC: stable@vger.kernel.org	# v3.16+
CC: Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>
CC: Alexander Graf <agraf@suse.de>
CC: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
(cherry picked from commit 4efe874aace57dba967624ce1c48322da2447b75)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/pci/pci-sysfs.c
diff --cc drivers/pci/pci-sysfs.c
index 1135328c15cf,312f23a8429c..000000000000
--- a/drivers/pci/pci-sysfs.c
+++ b/drivers/pci/pci-sysfs.c
@@@ -550,9 -519,10 +550,10 @@@ static ssize_t driver_override_store(st
  				     const char *buf, size_t count)
  {
  	struct pci_dev *pdev = to_pci_dev(dev);
 -	char *driver_override, *old = pdev->driver_override, *cp;
 +	char *driver_override, *old = pdev->pci_dev_rh->driver_override, *cp;
  
- 	if (count > PATH_MAX)
+ 	/* We need to keep extra room for a newline */
+ 	if (count >= (PAGE_SIZE - 1))
  		return -EINVAL;
  
  	driver_override = kstrndup(buf, count, GFP_KERNEL);
@@@ -580,7 -550,7 +581,11 @@@ static ssize_t driver_override_show(str
  {
  	struct pci_dev *pdev = to_pci_dev(dev);
  
++<<<<<<< HEAD
 +	return sprintf(buf, "%s\n", pdev->pci_dev_rh->driver_override);
++=======
+ 	return snprintf(buf, PAGE_SIZE, "%s\n", pdev->driver_override);
++>>>>>>> 4efe874aace5 (PCI: Don't read past the end of sysfs "driver_override" buffer)
  }
  static DEVICE_ATTR_RW(driver_override);
  
* Unmerged path drivers/pci/pci-sysfs.c
