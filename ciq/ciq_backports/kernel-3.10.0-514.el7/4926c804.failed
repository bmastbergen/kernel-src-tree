ALSA: intel8x0: Drop superfluous VM checks

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
commit-author Takashi Iwai <tiwai@suse.de>
commit 4926c8046549cc3c9689e8050e303c016a0b0cba
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/4926c804.failed

intel8x0 driver has the inside_vm check for skipping a buggy hardware
workaround in the PCM pointer callback in the commit [228cf79376f1:
ALSA: intel8x0: Improve performance in virtual environment].  This was
originally applied to all devices on known VMs, but the code was
switched to use the PCI  ID matching for applying to only known
devices (KVM and Parallels), in order to avoid applying wrongly to
VT-d and other such cases, in the commit [7fb4f392bd27: ALSA:
intel8x0: improve virtual environment detection].

Meanwhile, the original VM check was kept even after switching to the
PCI ID matching.  It was partly because we weren't 100% sure whether
we had covered all well, and partly because this would help
identifying the issue once when a user of another VM hit the same
problem or a regression.  Currently the VM check is used only for
showing the kernel message that the VM-optimization isn't applied, and
the VM check itself doesn't change the actual driver behavior at all.

Despite the relatively safe driver behavior, the code caught attention
of developers badly and brought many confusion / misunderstanding.
Since we've got neither regression nor enhancement report for other
VMs for five years long, it's likely safe to drop this superfluous VM
check now.

The module option is still kept, so if a user still needs to adjust,
it can be applied as was.

	Acked-by: Konstantin Ozerkov <kozerkov@parallels.com>
	Signed-off-by: Takashi Iwai <tiwai@suse.de>
(cherry picked from commit 4926c8046549cc3c9689e8050e303c016a0b0cba)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	sound/pci/intel8x0.c
diff --cc sound/pci/intel8x0.c
index ccdab29a8b66,9720a30dbfff..000000000000
--- a/sound/pci/intel8x0.c
+++ b/sound/pci/intel8x0.c
@@@ -2972,19 -2966,13 +2966,18 @@@ static int snd_intel8x0_inside_vm(struc
  		goto fini;
  	}
  
- 	/* detect KVM and Parallels virtual environments */
- 	result = kvm_para_available();
- #ifdef X86_FEATURE_HYPERVISOR
- 	result = result || boot_cpu_has(X86_FEATURE_HYPERVISOR);
- #endif
- 	if (!result)
- 		goto fini;
- 
  	/* check for known (emulated) devices */
++<<<<<<< HEAD
 +	if (pci->subsystem_vendor == 0x1af4 &&
 +	    pci->subsystem_device == 0x1100) {
++=======
+ 	result = 0;
+ 	if (pci->subsystem_vendor == PCI_SUBVENDOR_ID_REDHAT_QUMRANET &&
+ 	    pci->subsystem_device == PCI_SUBDEVICE_ID_QEMU) {
++>>>>>>> 4926c8046549 (ALSA: intel8x0: Drop superfluous VM checks)
  		/* KVM emulated sound, PCI SSID: 1af4:1100 */
  		msg = "enable KVM";
+ 		result = 1;
  	} else if (pci->subsystem_vendor == 0x1ab8) {
  		/* Parallels VM emulated sound, PCI SSID: 1ab8:xxxx */
  		msg = "enable Parallels VM";
* Unmerged path sound/pci/intel8x0.c
