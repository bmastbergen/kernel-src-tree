perf hists browser: Offer 'Zoom into DSO'/'Map details' only when sort order has 'dso'

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
commit-author Namhyung Kim <namhyung@kernel.org>
commit b1447a54f5b41eaf1cc469d9bd3834caa2ff9afb
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/b1447a54.failed

We can't offer a zoom into DSO when a bucket (struct hist_entry) may
have samples for more than one DSO, i.e. when 'dso' is not part of
the sort order, ditto for 'Map details', fix it.

	Signed-off-by: Namhyung Kim <namhyung@kernel.org>
	Tested-by: Arnaldo Carvalho de Melo <acme@redhat.com>
	Cc: Andi Kleen <andi@firstfloor.org>
	Cc: David Ahern <dsahern@gmail.com>
	Cc: Jiri Olsa <jolsa@kernel.org>,
	Cc: Peter Zijlstra <peterz@infradead.org>
	Cc: Stephane Eranian <eranian@google.com>
	Cc: Wang Nan <wangnan0@huawei.com>
Link: http://lkml.kernel.org/r/1452960197-5323-9-git-send-email-namhyung@kernel.org
[ Carved out from a  larger patch, moved check to add_{dso,map}_opt() ]
	Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>
(cherry picked from commit b1447a54f5b41eaf1cc469d9bd3834caa2ff9afb)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	tools/perf/ui/browsers/hists.c
diff --cc tools/perf/ui/browsers/hists.c
index ebdb1edfae96,e892106410a7..000000000000
--- a/tools/perf/ui/browsers/hists.c
+++ b/tools/perf/ui/browsers/hists.c
@@@ -1813,9 -1823,9 +1813,13 @@@ do_zoom_dso(struct hist_browser *browse
  
  static int
  add_dso_opt(struct hist_browser *browser, struct popup_action *act,
 -	    char **optstr, struct map *map)
 +	    char **optstr, struct dso *dso)
  {
++<<<<<<< HEAD
 +	if (dso == NULL)
++=======
+ 	if (!sort__has_dso || map == NULL)
++>>>>>>> b1447a54f5b4 (perf hists browser: Offer 'Zoom into DSO'/'Map details' only when sort order has 'dso')
  		return 0;
  
  	if (asprintf(optstr, "Zoom %s %s DSO",
* Unmerged path tools/perf/ui/browsers/hists.c
diff --git a/tools/perf/util/sort.h b/tools/perf/util/sort.h
index 79a3c9516c6c..1614898c584d 100644
--- a/tools/perf/util/sort.h
+++ b/tools/perf/util/sort.h
@@ -32,6 +32,7 @@ extern const char default_sort_order[];
 extern regex_t ignore_callees_regex;
 extern int have_ignore_callees;
 extern int sort__need_collapse;
+extern int sort__has_dso;
 extern int sort__has_parent;
 extern int sort__has_sym;
 extern enum sort_mode sort__mode;
