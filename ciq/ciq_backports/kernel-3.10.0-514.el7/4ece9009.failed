sit: fix sit0 percpu double allocations

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
commit-author Eric Dumazet <edumazet@google.com>
commit 4ece9009774596ee3df0acba65a324b7ea79387c
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/4ece9009.failed

sit0 device allocates its percpu storage twice :
- One time in ipip6_tunnel_init()
- One time in ipip6_fb_tunnel_init()

Thus we leak 48 bytes per possible cpu per network namespace dismantle.

ipip6_fb_tunnel_init() can be much simpler and does not
return an error, and should be called after register_netdev()

Note that ipip6_tunnel_clone_6rd() also needs to be called
after register_netdev() (calling ipip6_tunnel_init())

Fixes: ebe084aafb7e ("sit: Use ipip6_tunnel_init as the ndo_init function.")
	Signed-off-by: Eric Dumazet <edumazet@google.com>
	Reported-by: Dmitry Vyukov <dvyukov@google.com>
	Cc: Steffen Klassert <steffen.klassert@secunet.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 4ece9009774596ee3df0acba65a324b7ea79387c)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/ipv6/sit.c
diff --cc net/ipv6/sit.c
index 7705c194d52d,dcccae86190f..000000000000
--- a/net/ipv6/sit.c
+++ b/net/ipv6/sit.c
@@@ -1662,15 -1817,13 +1648,23 @@@ static int __net_init sit_init_net(stru
  	 */
  	sitn->fb_tunnel_dev->features |= NETIF_F_NETNS_LOCAL;
  
++<<<<<<< HEAD
 +	err = ipip6_fb_tunnel_init(sitn->fb_tunnel_dev);
 +	if (err)
 +		goto err_dev_free;
 +
 +	ipip6_tunnel_clone_6rd(sitn->fb_tunnel_dev, sitn);
 +
 +	if ((err = register_netdev(sitn->fb_tunnel_dev)))
++=======
+ 	err = register_netdev(sitn->fb_tunnel_dev);
+ 	if (err)
++>>>>>>> 4ece90097745 (sit: fix sit0 percpu double allocations)
  		goto err_reg_dev;
  
+ 	ipip6_tunnel_clone_6rd(sitn->fb_tunnel_dev, sitn);
+ 	ipip6_fb_tunnel_init(sitn->fb_tunnel_dev);
+ 
  	t = netdev_priv(sitn->fb_tunnel_dev);
  
  	strcpy(t->parms.name, sitn->fb_tunnel_dev->name);
* Unmerged path net/ipv6/sit.c
