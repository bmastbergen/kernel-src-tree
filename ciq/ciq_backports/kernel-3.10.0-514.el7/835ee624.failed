IB/srp: Swap two code blocks in srp_add_one()

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-514.el7
commit-author Bart Van Assche <bart.vanassche@sandisk.com>
commit 835ee624c99d0b63797babf25abe208182bb88bf
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-514.el7/835ee624.failed

This patch does not change any functionality but makes the next
patch in this series easier to read.

	Signed-off-by: Bart Van Assche <bart.vanassche@sandisk.com>
	Tested-by: Laurence Oberman <loberman@redhat.com>
	Cc: Christoph Hellwig <hch@lst.de>
	Cc: Sagi Grimberg <sagi@grimberg.me>
	Signed-off-by: Doug Ledford <dledford@redhat.com>
(cherry picked from commit 835ee624c99d0b63797babf25abe208182bb88bf)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/infiniband/ulp/srp/ib_srp.c
diff --cc drivers/infiniband/ulp/srp/ib_srp.c
index eb57f69536ed,a37a1f9d1204..000000000000
--- a/drivers/infiniband/ulp/srp/ib_srp.c
+++ b/drivers/infiniband/ulp/srp/ib_srp.c
@@@ -3449,30 -3427,10 +3449,33 @@@ static void srp_add_one(struct ib_devic
  	int mr_page_shift, p;
  	u64 max_pages_per_mr;
  
 +	dev_attr = kmalloc(sizeof *dev_attr, GFP_KERNEL);
 +	if (!dev_attr)
 +		return;
 +
 +	if (ib_query_device(device, dev_attr)) {
 +		pr_warn("Query device failed for %s\n", device->name);
 +		goto free_attr;
 +	}
 +
  	srp_dev = kmalloc(sizeof *srp_dev, GFP_KERNEL);
  	if (!srp_dev)
 -		return;
 +		goto free_attr;
 +
++<<<<<<< HEAD
 +	srp_dev->has_fmr = (device->alloc_fmr && device->dealloc_fmr &&
 +			    device->map_phys_fmr && device->unmap_fmr);
 +	srp_dev->has_fr = (dev_attr->device_cap_flags &
 +			   IB_DEVICE_MEM_MGT_EXTENSIONS);
 +	if (!srp_dev->has_fmr && !srp_dev->has_fr)
 +		dev_warn(&device->dev, "neither FMR nor FR is supported\n");
 +
 +	srp_dev->use_fast_reg = (srp_dev->has_fr &&
 +				 (!srp_dev->has_fmr || prefer_fr));
 +	srp_dev->use_fmr = !srp_dev->use_fast_reg && srp_dev->has_fmr;
  
++=======
++>>>>>>> 835ee624c99d (IB/srp: Swap two code blocks in srp_add_one())
  	/*
  	 * Use the smallest page size supported by the HCA, down to a
  	 * minimum of 4096 bytes. We're unlikely to build large sglists
* Unmerged path drivers/infiniband/ulp/srp/ib_srp.c
