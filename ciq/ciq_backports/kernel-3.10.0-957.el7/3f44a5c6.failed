tools/power turbostat: add --enable Time_Of_Day_Seconds

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-957.el7
Rebuild_CHGLOG: - [tools] power turbostat: add --enable Time_Of_Day_Seconds (Prarit Bhargava) [1454489]
Rebuild_FUZZ: 94.23%
commit-author Len Brown <len.brown@intel.com>
commit 3f44a5c62be2f2b15317942fa7bc4a810d2420aa
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-957.el7/3f44a5c6.failed

Add a Time_Of_Day_Seconds column showing when measurement
for each row was completed.  Units are [sec.subsec] since Epoch,
as reported by gettimeofday(2).

While useful to correlate turbostat output with other tools,
this built-in column is disabled, by default.

Add the "--enable" option to enable such disabled-by-default
built-in columns:

"--enable Time_Of_Day_Seconds"
"--enable usec"

"--enable all", will enable all disabled-by-defauilt built-in counters.

When "--debug" is used, all disabled-by-default columns are enabled,
unless explicitly skipped using "--hide"

	Signed-off-by: Len Brown <len.brown@intel.com>
(cherry picked from commit 3f44a5c62be2f2b15317942fa7bc4a810d2420aa)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	tools/power/x86/turbostat/turbostat.c
diff --cc tools/power/x86/turbostat/turbostat.c
index 84dfc36c50d8,627e5749d7d1..000000000000
--- a/tools/power/x86/turbostat/turbostat.c
+++ b/tools/power/x86/turbostat/turbostat.c
@@@ -49,7 -49,8 +49,12 @@@ FILE *outf
  int *fd_percpu;
  struct timespec interval_ts = {5, 0};
  unsigned int debug;
++<<<<<<< HEAD
 +unsigned int quiet = 1;
++=======
+ unsigned int quiet;
+ unsigned int shown;
++>>>>>>> 3f44a5c62be2 (tools/power turbostat: add --enable Time_Of_Day_Seconds)
  unsigned int sums_need_wide_columns;
  unsigned int rapl_joules;
  unsigned int summary_only;
@@@ -4995,8 -5008,8 +5010,13 @@@ void cmdline(int argc, char **argv
  		{"add",		required_argument,	0, 'a'},
  		{"cpu",		required_argument,	0, 'c'},
  		{"Dump",	no_argument,		0, 'D'},
++<<<<<<< HEAD
 +		{"debug",	no_argument,		0, 'd'},	 /* internal, not documented */
 +		{"verbose",	no_argument,		0, 'v'},
++=======
+ 		{"debug",	no_argument,		0, 'd'},	/* internal, not documented */
+ 		{"enable",	required_argument,	0, 'e'},
++>>>>>>> 3f44a5c62be2 (tools/power turbostat: add --enable Time_Of_Day_Seconds)
  		{"interval",	required_argument,	0, 'i'},
  		{"help",	no_argument,		0, 'h'},
  		{"hide",	required_argument,	0, 'H'},	// meh, -h taken by --help
@@@ -5013,7 -5026,7 +5033,11 @@@
  
  	progname = argv[0];
  
++<<<<<<< HEAD
 +	while ((opt = getopt_long_only(argc, argv, "+C:c:Ddvhi:JM:m:o:qST:V",
++=======
+ 	while ((opt = getopt_long_only(argc, argv, "+C:c:Dde:hi:Jo:qST:v",
++>>>>>>> 3f44a5c62be2 (tools/power turbostat: add --enable Time_Of_Day_Seconds)
  				long_options, &option_index)) != -1) {
  		switch (opt) {
  		case 'a':
@@@ -5025,13 -5038,20 +5049,22 @@@
  		case 'D':
  			dump_only++;
  			break;
+ 		case 'e':
+ 			/* --enable specified counter */
+ 			bic_enabled |= bic_lookup(optarg, SHOW_LIST);
+ 			break;
  		case 'd':
 +		case 'v':
 +			quiet = 0;
  			debug++;
+ 			ENABLE_BIC(BIC_DISABLED_BY_DEFAULT);
  			break;
  		case 'H':
- 			parse_show_hide(optarg, HIDE_LIST);
+ 			/*
+ 			 * --hide: do not show those specified
+ 			 *  multiple invocations simply clear more bits in enabled mask
+ 			 */
+ 			bic_enabled &= ~bic_lookup(optarg, HIDE_LIST);
  			break;
  		case 'h':
  		default:
diff --git a/tools/power/x86/turbostat/turbostat.8 b/tools/power/x86/turbostat/turbostat.8
index 1b6ec36c528b..bc79cf601a82 100644
--- a/tools/power/x86/turbostat/turbostat.8
+++ b/tools/power/x86/turbostat/turbostat.8
@@ -54,9 +54,12 @@ name as necessary to disambiguate it from others is necessary.  Note that option
 .PP
 \fB--cpu cpu-set\fP limit output to system summary plus the specified cpu-set.  If cpu-set is the string "core", then the system summary plus the first CPU in each core are printed -- eg. subsequent HT siblings are not printed.  Or if cpu-set is the string "package", then the system summary plus the first CPU in each package is printed.  Otherwise, the system summary plus the specified set of CPUs are printed.  The cpu-set is ordered from low to high, comma delimited with ".." and "-" permitted to denote a range. eg. 1,2,8,14..17,21-44
 .PP
-\fB--hide column\fP do not show the specified columns.  May be invoked multiple times, or with a comma-separated list of column names.  Use "--hide sysfs" to hide the sysfs statistics columns as a group.
+\fB--hide column\fP do not show the specified built-in columns.  May be invoked multiple times, or with a comma-separated list of column names.  Use "--hide sysfs" to hide the sysfs statistics columns as a group.
 .PP
-\fB--show column\fP show only the specified columns.  May be invoked multiple times, or with a comma-separated list of column names.  Use "--show sysfs" to show the sysfs statistics columns as a group.
+\fB--enable column\fP show the specified built-in columns, which are otherwise disabled, by default.  Currently the only built-in counters disabled by default are "usec" and "Time_Of_Day_Seconds".
+The column name "all" can be used to enable all disabled-by-default built-in counters.
+.PP
+\fB--show column\fP show only the specified built-in columns.  May be invoked multiple times, or with a comma-separated list of column names.  Use "--show sysfs" to show the sysfs statistics columns as a group.
 .PP
 \fB--Dump\fP displays the raw counter values.
 .PP
@@ -86,6 +89,8 @@ displays the statistics gathered since it was forked.
 The system configuration dump (if --quiet is not used) is followed by statistics.  The first row of the statistics labels the content of each column (below).  The second row of statistics is the system summary line.  The system summary line has a '-' in the columns for the Package, Core, and CPU.  The contents of the system summary line depends on the type of column.  Columns that count items (eg. IRQ) show the sum across all CPUs in the system.  Columns that show a percentage show the average across all CPUs in the system.  Columns that dump raw MSR values simply show 0 in the summary.  After the system summary row, each row describes a specific Package/Core/CPU.  Note that if the --cpu parameter is used to limit which specific CPUs are displayed, turbostat will still collect statistics for all CPUs in the system and will still show the system summary for all CPUs in the system.
 .SH COLUMN DESCRIPTIONS
 .nf
+\fBusec\fP For each CPU, the number of microseconds elapsed during counter collection, including thread migration -- if any.  This counter is disabled by default, and is enabled with "--enable usec", or --debug.  On the summary row, usec refers to the total elapsed time to collect the counters on all cpus.
+\fBTime_Of_Day_Seconds\fP For each CPU, the gettimeofday(2) value (seconds.subsec since Epoch) when the counters ending the measurement interval were collected.  This column is disabled by default, and can be enabled with "--enable Time_Of_Day_Seconds" or "--debug".  On the summary row, Time_Of_Day_Seconds refers to the timestamp following collection of counters on the last CPU.
 \fBCore\fP processor core number.  Note that multiple CPUs per core indicate support for Intel(R) Hyper-Threading Technology (HT).
 \fBCPU\fP Linux CPU (logical processor) number.  Yes, it is okay that on many systems the CPUs are not listed in numerical order -- for efficiency reasons, turbostat runs in topology order, so HT siblings appear together.
 \fBPackage\fP processor package number -- not present on systems with a single processor package.
* Unmerged path tools/power/x86/turbostat/turbostat.c
