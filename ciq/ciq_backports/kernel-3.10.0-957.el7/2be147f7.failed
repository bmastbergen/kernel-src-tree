atm: zatm: Fix potential Spectre v1

jira LE-1907
cve CVE-2018-3693
Rebuild_History Non-Buildable kernel-3.10.0-957.el7
Rebuild_CHGLOG: - [atm] zatm: Fix potential Spectre v1 (Lauro Ramos Venancio) [1589035] {CVE-2018-3693}
Rebuild_FUZZ: 92.31%
commit-author Gustavo A. R. Silva <gustavo@embeddedor.com>
commit 2be147f7459db5bbf292e0a6f135037b55e20b39
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-957.el7/2be147f7.failed

pool can be indirectly controlled by user-space, hence leading to
a potential exploitation of the Spectre variant 1 vulnerability.

This issue was detected with the help of Smatch:

drivers/atm/zatm.c:1462 zatm_ioctl() warn: potential spectre issue
'zatm_dev->pool_info' (local cap)

Fix this by sanitizing pool before using it to index
zatm_dev->pool_info

Notice that given that speculation windows are large, the policy is
to kill the speculation on the first load and not worry if it can be
completed with a dependent load/store [1].

[1] https://marc.info/?l=linux-kernel&m=152449131114778&w=2

	Cc: stable@vger.kernel.org
	Signed-off-by: Gustavo A. R. Silva <gustavo@embeddedor.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 2be147f7459db5bbf292e0a6f135037b55e20b39)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/atm/zatm.c
diff --cc drivers/atm/zatm.c
index 969c3c29000c,9c9a22958717..000000000000
--- a/drivers/atm/zatm.c
+++ b/drivers/atm/zatm.c
@@@ -27,7 -27,8 +27,12 @@@
  #include <asm/string.h>
  #include <asm/io.h>
  #include <linux/atomic.h>
++<<<<<<< HEAD
 +#include <asm/uaccess.h>
++=======
+ #include <linux/uaccess.h>
+ #include <linux/nospec.h>
++>>>>>>> 2be147f7459d (atm: zatm: Fix potential Spectre v1)
  
  #include "uPD98401.h"
  #include "uPD98402.h"
* Unmerged path drivers/atm/zatm.c
