net: cdc_ncm: Fix TX zero padding

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-957.el7
Rebuild_CHGLOG: - [usb] cdc_ncm: Fix TX zero padding (Torez Smith) [1540721]
Rebuild_FUZZ: 91.80%
commit-author Jim Baxter <jim_baxter@mentor.com>
commit aeca3a77b1e0ed06a095933b89c86aed007383eb
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-957.el7/aeca3a77.failed

The zero padding that is added to NTB's does
not zero the memory correctly.
This is because the skb_put modifies the value
of skb_out->len which results in the memset
command not setting any memory to zero as
(ctx->tx_max - skb_out->len) == 0.

I have resolved this by storing the size of
the memory to be zeroed before the skb_put
and using this in the memset call.

	Signed-off-by: Jim Baxter <jim_baxter@mentor.com>
	Reviewed-by: Bj√∏rn Mork <bjorn@mork.no>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit aeca3a77b1e0ed06a095933b89c86aed007383eb)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/usb/cdc_ncm.c
diff --cc drivers/net/usb/cdc_ncm.c
index 3e582e83ebb5,b5cec1824a78..000000000000
--- a/drivers/net/usb/cdc_ncm.c
+++ b/drivers/net/usb/cdc_ncm.c
@@@ -1246,11 -1245,13 +1247,21 @@@ cdc_ncm_fill_tx_frame(struct usbnet *de
  	 * a ZLP after full sized NTBs.
  	 */
  	if (!(dev->driver_info->flags & FLAG_SEND_ZLP) &&
++<<<<<<< HEAD
 +	    skb_out->len > ctx->min_tx_pkt)
 +		memset(skb_put(skb_out, ctx->tx_max - skb_out->len), 0,
 +		       ctx->tx_max - skb_out->len);
 +	else if (skb_out->len < ctx->tx_max && (skb_out->len % dev->maxpacket) == 0)
 +		*(u8 *)skb_put(skb_out, 1) = 0;	/* force short packet */
++=======
+ 	    skb_out->len > ctx->min_tx_pkt) {
+ 		padding_count = ctx->tx_max - skb_out->len;
+ 		memset(skb_put(skb_out, padding_count), 0, padding_count);
+ 	} else if (skb_out->len < ctx->tx_max &&
+ 		   (skb_out->len % dev->maxpacket) == 0) {
+ 		*skb_put(skb_out, 1) = 0;	/* force short packet */
+ 	}
++>>>>>>> aeca3a77b1e0 (net: cdc_ncm: Fix TX zero padding)
  
  	/* set final frame length */
  	nth16 = (struct usb_cdc_ncm_nth16 *)skb_out->data;
* Unmerged path drivers/net/usb/cdc_ncm.c
