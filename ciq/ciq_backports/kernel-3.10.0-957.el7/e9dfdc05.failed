netfilter: ipset: Fix hash:* type expiration

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-957.el7
commit-author Jozsef Kadlecsik <kadlec@blackhole.kfki.hu>
commit e9dfdc052d018268926ab769d5b7598226713d5a
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-957.el7/e9dfdc05.failed

Incorrect index was used when the data blob was shrinked at expiration,
which could lead to falsely expired entries and memory leak when
the comment extension was used too.

	Signed-off-by: Jozsef Kadlecsik <kadlec@blackhole.kfki.hu>
(cherry picked from commit e9dfdc052d018268926ab769d5b7598226713d5a)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/netfilter/ipset/ip_set_hash_gen.h
diff --cc net/netfilter/ipset/ip_set_hash_gen.h
index 9ce28af662bf,fa4f6374bb73..000000000000
--- a/net/netfilter/ipset/ip_set_hash_gen.h
+++ b/net/netfilter/ipset/ip_set_hash_gen.h
@@@ -473,10 -517,18 +473,25 @@@ mtype_expire(struct htype *h, u8 nets_l
  			if (!tmp)
  				/* Still try to delete expired elements */
  				continue;
++<<<<<<< HEAD
 +			n->size -= AHASH_INIT_SIZE;
 +			memcpy(tmp, n->value, n->size * dsize);
 +			kfree(n->value);
 +			n->value = tmp;
++=======
+ 			tmp->size = n->size - AHASH_INIT_SIZE;
+ 			for (j = 0, d = 0; j < n->pos; j++) {
+ 				if (!test_bit(j, n->used))
+ 					continue;
+ 				data = ahash_data(n, j, dsize);
+ 				memcpy(tmp->value + d * dsize, data, dsize);
+ 				set_bit(d, tmp->used);
+ 				d++;
+ 			}
+ 			tmp->pos = d;
+ 			rcu_assign_pointer(hbucket(t, i), tmp);
+ 			kfree_rcu(n, rcu);
++>>>>>>> e9dfdc052d01 (netfilter: ipset: Fix hash:* type expiration)
  		}
  	}
  }
* Unmerged path net/netfilter/ipset/ip_set_hash_gen.h
