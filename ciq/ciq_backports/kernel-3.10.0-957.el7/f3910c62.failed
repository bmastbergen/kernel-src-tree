cxgb4: Support firmware rdma write completion work request.

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-957.el7
Rebuild_CHGLOG: - [netdrv] cxgb4: Support firmware rdma write completion work request (Arjun Vynipadath) [1523151]
Rebuild_FUZZ: 99.15%
commit-author Raju Rangoju <rajur@chelsio.com>
commit f3910c6278f380d87f8bf8e46a8db46b2d0cff27
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-957.el7/f3910c62.failed

If FW supports RDMA WRITE_COMPLETION functionality, then advertise that
to the ULDs. This will be used by iw_cxgb4 to allow WRITE_COMPLETION
work requests.

	Signed-off-by: Potnuri Bharat Teja <bharat@chelsio.com>
	Signed-off-by: Raju Rangoju <rajur@chelsio.com>
	Signed-off-by: Ganesh Goudar <ganeshgr@chelsio.com>
	Signed-off-by: Steve Wise <swise@opengridcomputing.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit f3910c6278f380d87f8bf8e46a8db46b2d0cff27)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/chelsio/cxgb4/cxgb4.h
#	drivers/net/ethernet/chelsio/cxgb4/cxgb4_main.c
#	drivers/net/ethernet/chelsio/cxgb4/cxgb4_uld.c
#	drivers/net/ethernet/chelsio/cxgb4/cxgb4_uld.h
#	drivers/net/ethernet/chelsio/cxgb4/t4fw_api.h
diff --cc drivers/net/ethernet/chelsio/cxgb4/cxgb4.h
index 20cb63c29ece,688f95440af2..000000000000
--- a/drivers/net/ethernet/chelsio/cxgb4/cxgb4.h
+++ b/drivers/net/ethernet/chelsio/cxgb4/cxgb4.h
@@@ -382,6 -390,8 +382,11 @@@ struct adapter_params 
  	 * used by the Port
  	 */
  	u8 mps_bg_map[MAX_NPORTS];	/* MPS Buffer Group Map */
++<<<<<<< HEAD
++=======
+ 	bool write_w_imm_support;       /* FW supports WRITE_WITH_IMMEDIATE */
+ 	bool write_cmpl_support;        /* FW supports WRITE_CMPL */
++>>>>>>> f3910c6278f3 (cxgb4: Support firmware rdma write completion work request.)
  };
  
  /* State needed to monitor the forward progress of SGE Ingress DMA activities
diff --cc drivers/net/ethernet/chelsio/cxgb4/cxgb4_main.c
index 2f16e0177100,99c9b88d6d34..000000000000
--- a/drivers/net/ethernet/chelsio/cxgb4/cxgb4_main.c
+++ b/drivers/net/ethernet/chelsio/cxgb4/cxgb4_main.c
@@@ -4254,6 -4519,18 +4254,21 @@@ static int adap_init0(struct adapter *a
  			 "max_ordird_qp %d max_ird_adapter %d\n",
  			 adap->params.max_ordird_qp,
  			 adap->params.max_ird_adapter);
++<<<<<<< HEAD
++=======
+ 
+ 		/* Enable write_with_immediate if FW supports it */
+ 		params[0] = FW_PARAM_DEV(RDMA_WRITE_WITH_IMM);
+ 		ret = t4_query_params(adap, adap->mbox, adap->pf, 0, 1, params,
+ 				      val);
+ 		adap->params.write_w_imm_support = (ret == 0 && val[0] != 0);
+ 
+ 		/* Enable write_cmpl if FW supports it */
+ 		params[0] = FW_PARAM_DEV(RI_WRITE_CMPL_WR);
+ 		ret = t4_query_params(adap, adap->mbox, adap->pf, 0, 1, params,
+ 				      val);
+ 		adap->params.write_cmpl_support = (ret == 0 && val[0] != 0);
++>>>>>>> f3910c6278f3 (cxgb4: Support firmware rdma write completion work request.)
  		adap->num_ofld_uld += 2;
  	}
  	if (caps_cmd.iscsicaps) {
diff --cc drivers/net/ethernet/chelsio/cxgb4/cxgb4_uld.c
index 2e7fd24ea55d,a95cde0fadf7..000000000000
--- a/drivers/net/ethernet/chelsio/cxgb4/cxgb4_uld.c
+++ b/drivers/net/ethernet/chelsio/cxgb4/cxgb4_uld.c
@@@ -666,6 -665,9 +666,12 @@@ static void uld_init(struct adapter *ad
  	lld->max_ird_adapter = adap->params.max_ird_adapter;
  	lld->ulptx_memwrite_dsgl = adap->params.ulptx_memwrite_dsgl;
  	lld->nodeid = dev_to_node(adap->pdev_dev);
++<<<<<<< HEAD
++=======
+ 	lld->fr_nsmr_tpte_wr_support = adap->params.fr_nsmr_tpte_wr_support;
+ 	lld->write_w_imm_support = adap->params.write_w_imm_support;
+ 	lld->write_cmpl_support = adap->params.write_cmpl_support;
++>>>>>>> f3910c6278f3 (cxgb4: Support firmware rdma write completion work request.)
  }
  
  static void uld_attach(struct adapter *adap, unsigned int uld)
diff --cc drivers/net/ethernet/chelsio/cxgb4/cxgb4_uld.h
index ddef1cc70cd5,b0ca06edaa7c..000000000000
--- a/drivers/net/ethernet/chelsio/cxgb4/cxgb4_uld.h
+++ b/drivers/net/ethernet/chelsio/cxgb4/cxgb4_uld.h
@@@ -349,6 -354,8 +349,11 @@@ struct cxgb4_lld_info 
  	void **iscsi_ppm;		     /* iscsi page pod manager */
  	int nodeid;			     /* device numa node id */
  	bool fr_nsmr_tpte_wr_support;	     /* FW supports FR_NSMR_TPTE_WR */
++<<<<<<< HEAD
++=======
+ 	bool write_w_imm_support;         /* FW supports WRITE_WITH_IMMEDIATE */
+ 	bool write_cmpl_support;             /* FW supports WRITE_CMPL WR */
++>>>>>>> f3910c6278f3 (cxgb4: Support firmware rdma write completion work request.)
  };
  
  struct cxgb4_uld_info {
diff --cc drivers/net/ethernet/chelsio/cxgb4/t4fw_api.h
index d80a41bdc371,544757f6ab3a..000000000000
--- a/drivers/net/ethernet/chelsio/cxgb4/t4fw_api.h
+++ b/drivers/net/ethernet/chelsio/cxgb4/t4fw_api.h
@@@ -1206,6 -1214,8 +1207,11 @@@ enum fw_params_param_dev 
  	FW_PARAMS_PARAM_DEV_FILTER2_WR  = 0x1D,
  	FW_PARAMS_PARAM_DEV_MPSBGMAP	= 0x1E,
  	FW_PARAMS_PARAM_DEV_HMA_SIZE	= 0x20,
++<<<<<<< HEAD
++=======
+ 	FW_PARAMS_PARAM_DEV_RDMA_WRITE_WITH_IMM = 0x21,
+ 	FW_PARAMS_PARAM_DEV_RI_WRITE_CMPL_WR    = 0x24,
++>>>>>>> f3910c6278f3 (cxgb4: Support firmware rdma write completion work request.)
  };
  
  /*
* Unmerged path drivers/net/ethernet/chelsio/cxgb4/cxgb4.h
* Unmerged path drivers/net/ethernet/chelsio/cxgb4/cxgb4_main.c
* Unmerged path drivers/net/ethernet/chelsio/cxgb4/cxgb4_uld.c
* Unmerged path drivers/net/ethernet/chelsio/cxgb4/cxgb4_uld.h
* Unmerged path drivers/net/ethernet/chelsio/cxgb4/t4fw_api.h
