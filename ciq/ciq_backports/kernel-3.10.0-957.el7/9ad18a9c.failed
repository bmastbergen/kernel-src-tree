scsi: megaraid_sas: remove instance->ctrl_info

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-957.el7
Rebuild_CHGLOG: - [scsi] megaraid_sas: remove instance->ctrl_info (Tomas Henzl) [1513838]
Rebuild_FUZZ: 93.02%
commit-author Shivasharan S <shivasharan.srikanteshwara@broadcom.com>
commit 9ad18a9c0c972b618ef68ca8c4a3ff7e7d0b49eb
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-957.el7/9ad18a9c.failed

Re-use the pre-allocated ctrl_info DMA buffer.

	Signed-off-by: Kashyap Desai <kashyap.desai@broadcom.com>
	Signed-off-by: Shivasharan S <shivasharan.srikanteshwara@broadcom.com>
	Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
(cherry picked from commit 9ad18a9c0c972b618ef68ca8c4a3ff7e7d0b49eb)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/scsi/megaraid/megaraid_sas_base.c
diff --cc drivers/scsi/megaraid/megaraid_sas_base.c
index 3bd6576d3342,b30e80cf4c25..000000000000
--- a/drivers/scsi/megaraid/megaraid_sas_base.c
+++ b/drivers/scsi/megaraid/megaraid_sas_base.c
@@@ -4651,10 -4605,10 +4651,14 @@@ megasas_get_ctrl_info(struct megasas_in
  	struct megasas_cmd *cmd;
  	struct megasas_dcmd_frame *dcmd;
  	struct megasas_ctrl_info *ci;
- 	struct megasas_ctrl_info *ctrl_info;
  	dma_addr_t ci_h = 0;
  
++<<<<<<< HEAD
 +	ctrl_info = instance->ctrl_info;
++=======
+ 	ci = instance->ctrl_info_buf;
+ 	ci_h = instance->ctrl_info_buf_h;
++>>>>>>> 9ad18a9c0c97 (scsi: megaraid_sas: remove instance->ctrl_info)
  
  	cmd = megasas_get_cmd(instance);
  
@@@ -5537,14 -5469,13 +5535,12 @@@ static int megasas_init_fw(struct megas
  
  fail_get_ld_pd_list:
  	instance->instancet->disable_intr(instance);
 -fail_init_adapter:
  	megasas_destroy_irqs(instance);
 -fail_setup_irqs:
 +fail_init_adapter:
  	if (instance->msix_vectors)
 -		pci_free_irq_vectors(instance->pdev);
 +		pci_disable_msix(instance->pdev);
  	instance->msix_vectors = 0;
  fail_ready_state:
- 	kfree(instance->ctrl_info);
- 	instance->ctrl_info = NULL;
  	iounmap(instance->reg_set);
  
  fail_ioremap:
diff --git a/drivers/scsi/megaraid/megaraid_sas.h b/drivers/scsi/megaraid/megaraid_sas.h
index 934fa647b8a5..23a4048af0aa 100644
--- a/drivers/scsi/megaraid/megaraid_sas.h
+++ b/drivers/scsi/megaraid/megaraid_sas.h
@@ -2218,7 +2218,6 @@ struct megasas_instance {
 
 	/* Ptr to hba specific information */
 	void *ctrl_context;
-	struct megasas_ctrl_info *ctrl_info;
 	unsigned int msix_vectors;
 	struct msix_entry msixentry[MEGASAS_MAX_MSIX_QUEUES];
 	struct megasas_irq_context irq_context[MEGASAS_MAX_MSIX_QUEUES];
* Unmerged path drivers/scsi/megaraid/megaraid_sas_base.c
