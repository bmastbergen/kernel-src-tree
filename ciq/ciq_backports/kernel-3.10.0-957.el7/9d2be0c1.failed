s390/dasd: Make raw I/O usable without prefix support

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-957.el7
Rebuild_CHGLOG: - [s390] dasd: Make raw I/O usable without prefix support (Hendrik Brueckner) [1519353]
Rebuild_FUZZ: 95.05%
commit-author Jan Höppner <hoeppner@linux.vnet.ibm.com>
commit 9d2be0c1d461520578a7634f09527515f51e2267
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-957.el7/9d2be0c1.failed

The Prefix CCW is not mandatory and raw I/O can also be issued without
it. Check whether the Prefix CCW is supported and if not use the
combination of Define Extent and Locate Record Extended instead.

While at it, sort the variable declarations, replace the gotos with
early exits, and remove an error check at the end which is irrelevant.
Also, remove the XRC check as it is not relevant for raw I/O.

	Reviewed-by: Stefan Haberland <sth@linux.vnet.ibm.com>
	Signed-off-by: Jan Höppner <hoeppner@linux.vnet.ibm.com>
	Signed-off-by: Martin Schwidefsky <schwidefsky@de.ibm.com>
(cherry picked from commit 9d2be0c1d461520578a7634f09527515f51e2267)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/s390/block/dasd_eckd.c
diff --cc drivers/s390/block/dasd_eckd.c
index 007789314c99,c3e5ad641b0b..000000000000
--- a/drivers/s390/block/dasd_eckd.c
+++ b/drivers/s390/block/dasd_eckd.c
@@@ -3863,21 -3783,24 +3863,36 @@@ static struct dasd_ccw_req *dasd_eckd_b
  						   struct dasd_block *block,
  						   struct request *req)
  {
++<<<<<<< HEAD
 +	unsigned long *idaws;
 +	struct dasd_device *basedev;
 +	struct dasd_ccw_req *cqr;
 +	struct ccw1 *ccw;
 +	struct req_iterator iter;
 +	struct bio_vec *bv;
 +	char *dst;
 +	unsigned char cmd;
 +	unsigned int trkcount;
++=======
+ 	sector_t start_padding_sectors, end_sector_offset, end_padding_sectors;
++>>>>>>> 9d2be0c1d461 (s390/dasd: Make raw I/O usable without prefix support)
  	unsigned int seg_len, len_to_track_end;
- 	unsigned int first_offs;
  	unsigned int cidaw, cplength, datasize;
  	sector_t first_trk, last_trk, sectors;
- 	sector_t start_padding_sectors, end_sector_offset, end_padding_sectors;
- 	unsigned int pfx_datasize;
+ 	struct dasd_eckd_private *base_priv;
+ 	struct dasd_device *basedev;
+ 	struct req_iterator iter;
+ 	struct dasd_ccw_req *cqr;
+ 	unsigned int first_offs;
+ 	unsigned int trkcount;
+ 	unsigned long *idaws;
+ 	unsigned int size;
+ 	unsigned char cmd;
+ 	struct bio_vec bv;
+ 	struct ccw1 *ccw;
+ 	int use_prefix;
+ 	void *data;
+ 	char *dst;
  
  	/*
  	 * raw track access needs to be mutiple of 64k and on 64k boundary
* Unmerged path drivers/s390/block/dasd_eckd.c
