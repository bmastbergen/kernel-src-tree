cxgb4: do not set needs_free_netdev for mgmt dev's

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-957.el7
commit-author Ganesh Goudar <ganeshgr@chelsio.com>
commit b06ef18a4c255609388ed6e068a1c69c797545e0
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-957.el7/b06ef18a.failed

Do not set 'needs_free_netdev' as we do call free_netdev
for mgmt net devices, doing both hits BUG_ON.

	Signed-off-by: Ganesh Goudar <ganeshgr@chelsio.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit b06ef18a4c255609388ed6e068a1c69c797545e0)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/chelsio/cxgb4/cxgb4_main.c
diff --cc drivers/net/ethernet/chelsio/cxgb4/cxgb4_main.c
index 6ab9c774d010,61022b5f6743..000000000000
--- a/drivers/net/ethernet/chelsio/cxgb4/cxgb4_main.c
+++ b/drivers/net/ethernet/chelsio/cxgb4/cxgb4_main.c
@@@ -4941,38 -4970,6 +4941,41 @@@ static void dummy_setup(struct net_devi
  	/* Initialize the device structure. */
  	dev->netdev_ops = &cxgb4_mgmt_netdev_ops;
  	dev->ethtool_ops = &cxgb4_mgmt_ethtool_ops;
++<<<<<<< HEAD
 +	dev->extended->needs_free_netdev = true;
 +}
 +
 +static int config_mgmt_dev(struct pci_dev *pdev)
 +{
 +	struct adapter *adap = pci_get_drvdata(pdev);
 +	struct net_device *netdev;
 +	struct port_info *pi;
 +	char name[IFNAMSIZ];
 +	int err;
 +
 +	snprintf(name, IFNAMSIZ, "mgmtpf%d%d", adap->adap_idx, adap->pf);
 +	netdev = alloc_netdev(sizeof(struct port_info), name, dummy_setup);
 +	if (!netdev)
 +		return -ENOMEM;
 +
 +	pi = netdev_priv(netdev);
 +	pi->adapter = adap;
 +	pi->tx_chan = adap->pf % adap->params.nports;
 +	SET_NETDEV_DEV(netdev, &pdev->dev);
 +
 +	adap->port[0] = netdev;
 +	pi->port_id = 0;
 +
 +	err = register_netdev(adap->port[0]);
 +	if (err) {
 +		pr_info("Unable to register VF mgmt netdev %s\n", name);
 +		free_netdev(adap->port[0]);
 +		adap->port[0] = NULL;
 +		return err;
 +	}
 +	return 0;
++=======
++>>>>>>> b06ef18a4c25 (cxgb4: do not set needs_free_netdev for mgmt dev's)
  }
  
  static int cxgb4_iov_configure(struct pci_dev *pdev, int num_vfs)
* Unmerged path drivers/net/ethernet/chelsio/cxgb4/cxgb4_main.c
