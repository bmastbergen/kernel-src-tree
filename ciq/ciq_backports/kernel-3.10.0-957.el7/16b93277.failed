tcmu: Fix some memory corruption

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-957.el7
commit-author Dan Carpenter <dan.carpenter@oracle.com>
commit 16b932770417b1bc304d87c48aa0bb8a3c1164e1
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-957.el7/16b93277.failed

"udev->nl_reply_supported" is an int but on 64 bit arches we are writing
8 bytes of data to it so it corrupts four bytes beyond the end of the
struct.

Fixes: b849b4567549 ("target: Add netlink command reply supported option for each device")
	Signed-off-by: Dan Carpenter <dan.carpenter@oracle.com>
	Signed-off-by: Nicholas Bellinger <nab@linux-iscsi.org>
(cherry picked from commit 16b932770417b1bc304d87c48aa0bb8a3c1164e1)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/target/target_core_user.c
diff --cc drivers/target/target_core_user.c
index 3a9402c59df4,d2b8d5ccb446..000000000000
--- a/drivers/target/target_core_user.c
+++ b/drivers/target/target_core_user.c
@@@ -1447,26 -1724,10 +1447,33 @@@ static ssize_t tcmu_set_configfs_dev_pa
  				ret = -ENOMEM;
  				break;
  			}
++<<<<<<< HEAD
 +			ret = kstrtoint(arg_p, 0, &tmpval);
 +			kfree(arg_p);
 +			if (ret < 0) {
 +				pr_err("kstrtoint() failed for max_data_area_mb=\n");
 +				break;
 +			}
 +
 +			if (tmpval <= 0) {
 +				pr_err("Invalid max_data_area %d\n", tmpval);
 +				ret = -EINVAL;
 +				break;
 +			}
 +
 +			udev->max_blocks = TCMU_MBS_TO_BLOCKS(tmpval);
 +			if (udev->max_blocks > DATA_BLOCKS_BITS_MAX) {
 +				pr_err("%d is too large. Adjusting max_data_area_mb to global limit of %u\n",
 +				       tmpval,
 +				       TCMU_BLOCKS_TO_MBS(DATA_BLOCKS_BITS_MAX));
 +				udev->max_blocks = DATA_BLOCKS_BITS_MAX;
 +			}
++=======
+ 			ret = kstrtoint(arg_p, 0, &udev->nl_reply_supported);
+ 			kfree(arg_p);
+ 			if (ret < 0)
+ 				pr_err("kstrtoint() failed for nl_reply_supported=\n");
++>>>>>>> 16b932770417 (tcmu: Fix some memory corruption)
  			break;
  		default:
  			break;
* Unmerged path drivers/target/target_core_user.c
