net/mlx5e: Switch Q counters to use the stats group API

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-957.el7
Rebuild_CHGLOG: - [netdrv] mlx5e: Switch Q counters to use the stats group API (Alaa Hleihel) [1520297]
Rebuild_FUZZ: 96.23%
commit-author Kamal Heib <kamalh@mellanox.com>
commit fd8dcdb8d2e72f6ab7caf63392bece01344b4b47
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-957.el7/fd8dcdb8.failed

Switch the Q counters to use the new stats group API.

	Signed-off-by: Kamal Heib <kamalh@mellanox.com>
	Reviewed-by: Gal Pressman <galp@mellanox.com>
	Signed-off-by: Saeed Mahameed <saeedm@mellanox.com>
(cherry picked from commit fd8dcdb8d2e72f6ab7caf63392bece01344b4b47)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/mellanox/mlx5/core/en_ethtool.c
#	drivers/net/ethernet/mellanox/mlx5/core/en_stats.c
#	drivers/net/ethernet/mellanox/mlx5/core/en_stats.h
diff --cc drivers/net/ethernet/mellanox/mlx5/core/en_ethtool.c
index 52759b7e5eaa,35ba40af2a73..000000000000
--- a/drivers/net/ethernet/mellanox/mlx5/core/en_ethtool.c
+++ b/drivers/net/ethernet/mellanox/mlx5/core/en_ethtool.c
@@@ -176,10 -175,13 +175,16 @@@ static bool mlx5e_query_global_pause_co
  
  int mlx5e_ethtool_get_sset_count(struct mlx5e_priv *priv, int sset)
  {
 -	int i, num_stats = 0;
 -
  	switch (sset) {
  	case ETH_SS_STATS:
++<<<<<<< HEAD
 +		return NUM_SW_COUNTERS +
 +		       MLX5E_NUM_Q_CNTRS(priv) +
++=======
+ 		for (i = 0; i < mlx5e_num_stats_grps; i++)
+ 			num_stats += mlx5e_stats_grps[i].get_num_stats(priv);
+ 		return num_stats +
++>>>>>>> fd8dcdb8d2e7 (net/mlx5e: Switch Q counters to use the stats group API)
  		       NUM_VPORT_COUNTERS + NUM_PPORT_COUNTERS(priv) +
  		       NUM_PCIE_COUNTERS(priv) +
  		       MLX5E_NUM_RQ_STATS(priv) +
@@@ -211,14 -213,9 +216,10 @@@ static void mlx5e_fill_stats_strings(st
  	int i, j, tc, prio, idx = 0;
  	unsigned long pfc_combined;
  
 -	for (i = 0; i < mlx5e_num_stats_grps; i++)
 -		idx = mlx5e_stats_grps[i].fill_strings(priv, data, idx);
 +	/* SW counters */
 +	for (i = 0; i < NUM_SW_COUNTERS; i++)
 +		strcpy(data + (idx++) * ETH_GSTRING_LEN, sw_stats_desc[i].format);
  
- 	/* Q counters */
- 	for (i = 0; i < MLX5E_NUM_Q_CNTRS(priv); i++)
- 		strcpy(data + (idx++) * ETH_GSTRING_LEN, q_stats_desc[i].format);
- 
  	/* VPORT counters */
  	for (i = 0; i < NUM_VPORT_COUNTERS; i++)
  		strcpy(data + (idx++) * ETH_GSTRING_LEN,
@@@ -354,14 -351,9 +355,10 @@@ void mlx5e_ethtool_get_ethtool_stats(st
  	channels = &priv->channels;
  	mutex_unlock(&priv->state_lock);
  
 -	for (i = 0; i < mlx5e_num_stats_grps; i++)
 -		idx = mlx5e_stats_grps[i].fill_stats(priv, data, idx);
 +	for (i = 0; i < NUM_SW_COUNTERS; i++)
 +		data[idx++] = MLX5E_READ_CTR64_CPU(&priv->stats.sw,
 +						   sw_stats_desc, i);
  
- 	for (i = 0; i < MLX5E_NUM_Q_CNTRS(priv); i++)
- 		data[idx++] = MLX5E_READ_CTR32_CPU(&priv->stats.qcnt,
- 						   q_stats_desc, i);
- 
  	for (i = 0; i < NUM_VPORT_COUNTERS; i++)
  		data[idx++] = MLX5E_READ_CTR64_BE(priv->stats.vport.query_vport_out,
  						  vport_stats_desc, i);
diff --cc drivers/net/ethernet/mellanox/mlx5/core/en_stats.h
index 6008820e81eb,b82ecb1fa353..000000000000
--- a/drivers/net/ethernet/mellanox/mlx5/core/en_stats.h
+++ b/drivers/net/ethernet/mellanox/mlx5/core/en_stats.h
@@@ -411,8 -380,6 +407,11 @@@ static const struct counter_desc sq_sta
  	{ MLX5E_DECLARE_TX_STAT(struct mlx5e_sq_stats, xmit_more) },
  };
  
++<<<<<<< HEAD
 +#define NUM_SW_COUNTERS			ARRAY_SIZE(sw_stats_desc)
 +#define NUM_Q_COUNTERS			ARRAY_SIZE(q_stats_desc)
++=======
++>>>>>>> fd8dcdb8d2e7 (net/mlx5e: Switch Q counters to use the stats group API)
  #define NUM_VPORT_COUNTERS		ARRAY_SIZE(vport_stats_desc)
  #define NUM_PPORT_802_3_COUNTERS	ARRAY_SIZE(pport_802_3_stats_desc)
  #define NUM_PPORT_2863_COUNTERS		ARRAY_SIZE(pport_2863_stats_desc)
* Unmerged path drivers/net/ethernet/mellanox/mlx5/core/en_stats.c
* Unmerged path drivers/net/ethernet/mellanox/mlx5/core/en_ethtool.c
* Unmerged path drivers/net/ethernet/mellanox/mlx5/core/en_stats.c
* Unmerged path drivers/net/ethernet/mellanox/mlx5/core/en_stats.h
