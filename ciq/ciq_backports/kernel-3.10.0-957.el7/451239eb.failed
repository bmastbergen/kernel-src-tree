s390: add support for IBM z14 Model ZR1

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-957.el7
Rebuild_CHGLOG: - [s390] add support for IBM z14 Model ZR1 (Hendrik Brueckner) [1519345]
Rebuild_FUZZ: 91.67%
commit-author Heiko Carstens <heiko.carstens@de.ibm.com>
commit 451239eb3d397bd197a79cc3aab943da41ba0905
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-957.el7/451239eb.failed

Just add the new machine type number to the two places that matter.

	Cc: <stable@vger.kernel.org> # v4.14+
	Signed-off-by: Heiko Carstens <heiko.carstens@de.ibm.com>
	Signed-off-by: Martin Schwidefsky <schwidefsky@de.ibm.com>
(cherry picked from commit 451239eb3d397bd197a79cc3aab943da41ba0905)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/s390/Kconfig
#	arch/s390/kernel/setup.c
diff --cc arch/s390/Kconfig
index 6d4676098bd9,199ac3e4da1d..000000000000
--- a/arch/s390/Kconfig
+++ b/arch/s390/Kconfig
@@@ -248,12 -278,20 +248,26 @@@ config MARCH_ZEC1
  	  older machines.
  
  config MARCH_Z13
 -	bool "IBM z13s and z13"
 -	select HAVE_MARCH_Z13_FEATURES
 +	bool "IBM z13"
 +	select HAVE_MARCH_Z13_FEATURES if 64BIT
  	help
++<<<<<<< HEAD
 +	  Select this to enable optimizations for IBM z13 (2964 series).
 +	  The kernel will be slightly faster but will not work on older
 +	  machines.
++=======
+ 	  Select this to enable optimizations for IBM z13s and z13 (2965 and
+ 	  2964 series). The kernel will be slightly faster but will not work on
+ 	  older machines.
+ 
+ config MARCH_Z14
+ 	bool "IBM z14 ZR1 and z14"
+ 	select HAVE_MARCH_Z14_FEATURES
+ 	help
+ 	  Select this to enable optimizations for IBM z14 ZR1 and z14 (3907
+ 	  and 3906 series). The kernel will be slightly faster but will not
+ 	  work on older machines.
++>>>>>>> 451239eb3d39 (s390: add support for IBM z14 Model ZR1)
  
  endchoice
  
diff --cc arch/s390/kernel/setup.c
index d6e8e87b465f,d82a9ec64ea9..000000000000
--- a/arch/s390/kernel/setup.c
+++ b/arch/s390/kernel/setup.c
@@@ -988,8 -817,13 +988,15 @@@ static void __init setup_hwcaps(void
  		strcpy(elf_platform, "zEC12");
  		break;
  	case 0x2964:
 -	case 0x2965:
  		strcpy(elf_platform, "z13");
  		break;
++<<<<<<< HEAD
++=======
+ 	case 0x3906:
+ 	case 0x3907:
+ 		strcpy(elf_platform, "z14");
+ 		break;
++>>>>>>> 451239eb3d39 (s390: add support for IBM z14 Model ZR1)
  	}
  
  	/*
* Unmerged path arch/s390/Kconfig
diff --git a/arch/s390/kernel/perf_cpum_cf_events.c b/arch/s390/kernel/perf_cpum_cf_events.c
index a6573149f869..9c0673d28701 100644
--- a/arch/s390/kernel/perf_cpum_cf_events.c
+++ b/arch/s390/kernel/perf_cpum_cf_events.c
@@ -582,6 +582,7 @@ __init const struct attribute_group **cpumf_cf_event_group(void)
 		model = cpumcf_z13_pmu_event_attr;
 		break;
 	case 0x3906:
+	case 0x3907:
 		model = cpumcf_z14_pmu_event_attr;
 		break;
 	default:
* Unmerged path arch/s390/kernel/setup.c
