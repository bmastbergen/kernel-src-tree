iio: core: Introduce IIO_CHAN_INFO_DEBOUNCE_COUNT and _TIME

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-957.el7
Rebuild_CHGLOG: - [iio] core: Introduce IIO_CHAN_INFO_DEBOUNCE_COUNT and _TIME (Tony Camuso) [1559170]
Rebuild_FUZZ: 95.58%
commit-author Irina Tirdea <irina.tirdea@intel.com>
commit 2f0ecb7c6563d711bec15268d56adf1c630e77d1
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-957.el7/2f0ecb7c.failed

The pedometer needs to filter out false steps that might be generated by
tapping the foot, sitting, etc. To do that it computes the number of
steps that occur in a given time and decides the user is moving only
if this value is over a threshold. E.g.: the user starts moving only
if he takes 4 steps in 3 seconds. This filter is applied only when
the user starts moving.

A device that has such pedometer functionality is Freescale's MMA9553L:
http://www.freescale.com/files/sensors/doc/ref_manual/MMA9553LSWRM.pdf.

To export this feature, this patch introduces IIO_CHAN_INFO_DEBOUNCE_COUNT
and IIO_CHAN_INFO_DEBOUNCE_TIME. For the pedometer, in_steps_debounce_count
will specify the number of steps that need to occur in
in_steps_debounce_time seconds so that the pedometer decides the user is
moving.

	Signed-off-by: Irina Tirdea <irina.tirdea@intel.com>
	Signed-off-by: Jonathan Cameron <jic23@kernel.org>
(cherry picked from commit 2f0ecb7c6563d711bec15268d56adf1c630e77d1)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	Documentation/ABI/testing/sysfs-bus-iio
#	drivers/iio/industrialio-core.c
#	include/linux/iio/iio.h
diff --cc Documentation/ABI/testing/sysfs-bus-iio
index 7ba396de2c76,b4ea9c521f69..000000000000
--- a/Documentation/ABI/testing/sysfs-bus-iio
+++ b/Documentation/ABI/testing/sysfs-bus-iio
@@@ -908,13 -1061,150 +908,159 @@@ Description
  		This attribute is used to read the amount of quadrature error
  		present in the device at a given time.
  
 -What:		/sys/.../iio:deviceX/in_accelX_power_mode
 -KernelVersion:	3.11
 +What:		/sys/bus/iio/devices/iio:device*/buffer/hwfifo_timeout
 +KernelVersion:	4.12
  Contact:	linux-iio@vger.kernel.org
  Description:
++<<<<<<< HEAD
 +		A read/write property to provide capability to delay reporting of
 +		samples till a timeout is reached. This allows host processors to
 +		sleep, while the sensor is storing samples in its internal fifo.
 +		The maximum timeout in seconds can be specified by setting
 +		hwfifo_timeout.The current delay can be read by reading
 +		hwfifo_timeout. A value of 0 means that there is no timeout.
++=======
+ 		Specifies the chip power mode.
+ 		low_noise: reduce noise level from ADC,
+ 		low_power: enable low current consumption.
+ 		For a list of available output power modes read
+ 		in_accel_power_mode_available.
+ 
+ What:		/sys/.../iio:deviceX/in_energy_input
+ What:		/sys/.../iio:deviceX/in_energy_raw
+ KernelVersion:	3.20
+ Contact:	linux-iio@vger.kernel.org
+ Description:
+ 		This attribute is used to read the energy value reported by the
+ 		device (e.g.: human activity sensors report energy burnt by the
+ 		user). Units after application of scale are Joules.
+ 
+ What:		/sys/.../iio:deviceX/in_distance_input
+ What:		/sys/.../iio:deviceX/in_distance_raw
+ KernelVersion:	3.20
+ Contact:	linux-iio@vger.kernel.org
+ Description:
+ 		This attribute is used to read the distance covered by the user
+ 		since the last reboot while activated. Units after application
+ 		of scale are meters.
+ 
+ What:		/sys/bus/iio/devices/iio:deviceX/store_eeprom
+ KernelVersion:	3.4.0
+ Contact:	linux-iio@vger.kernel.org
+ Description:
+ 		Writing '1' stores the current device configuration into
+ 		on-chip EEPROM. After power-up or chip reset the device will
+ 		automatically load the saved configuration.
+ 
+ What:		/sys/.../iio:deviceX/in_proximity_raw
+ What:		/sys/.../iio:deviceX/in_proximity_input
+ What:		/sys/.../iio:deviceX/in_proximityY_raw
+ KernelVersion:	3.4
+ Contact:	linux-iio@vger.kernel.org
+ Description:
+ 		Proximity measurement indicating that some
+ 		object is near the sensor, usually be observing
+ 		reflectivity of infrared or ultrasound emitted.
+ 		Often these sensors are unit less and as such conversion
+ 		to SI units is not possible.  Where it is, the units should
+ 		be meters.  If such a conversion is not possible, the reported
+ 		values should behave in the same way as a distance, i.e. lower
+ 		values indicate something is closer to the sensor.
+ 
+ What:		/sys/.../iio:deviceX/in_illuminanceY_input
+ What:		/sys/.../iio:deviceX/in_illuminanceY_raw
+ What:		/sys/.../iio:deviceX/in_illuminanceY_mean_raw
+ KernelVersion:	3.4
+ Contact:	linux-iio@vger.kernel.org
+ Description:
+ 		Illuminance measurement, units after application of scale
+ 		and offset are lux.
+ 
+ What:		/sys/.../iio:deviceX/in_intensityY_raw
+ What:		/sys/.../iio:deviceX/in_intensityY_ir_raw
+ What:		/sys/.../iio:deviceX/in_intensityY_both_raw
+ KernelVersion:	3.4
+ Contact:	linux-iio@vger.kernel.org
+ Description:
+ 		Unit-less light intensity. Modifiers both and ir indicate
+ 		that measurements contains visible and infrared light
+ 		components or just infrared light, respectively.
+ 
+ What:		/sys/.../iio:deviceX/in_intensity_red_integration_time
+ What:		/sys/.../iio:deviceX/in_intensity_green_integration_time
+ What:		/sys/.../iio:deviceX/in_intensity_blue_integration_time
+ What:		/sys/.../iio:deviceX/in_intensity_clear_integration_time
+ What:		/sys/.../iio:deviceX/in_illuminance_integration_time
+ KernelVersion:	3.12
+ Contact:	linux-iio@vger.kernel.org
+ Description:
+ 		This attribute is used to get/set the integration time in
+ 		seconds.
+ 
+ What:		/sys/bus/iio/devices/iio:deviceX/in_rot_quaternion_raw
+ KernelVersion:	3.15
+ Contact:	linux-iio@vger.kernel.org
+ Description:
+ 		Raw value of quaternion components using a format
+ 		x y z w. Here x, y, and z component represents the axis about
+ 		which a rotation will occur and w component represents the
+ 		amount of rotation.
+ 
+ What:		/sys/bus/iio/devices/iio:deviceX/in_rot_from_north_magnetic_tilt_comp_raw
+ What:		/sys/bus/iio/devices/iio:deviceX/in_rot_from_north_true_tilt_comp_raw
+ What:		/sys/bus/iio/devices/iio:deviceX/in_rot_from_north_magnetic_raw
+ What:		/sys/bus/iio/devices/iio:deviceX/in_rot_from_north_true_raw
+ KernelVersion:	3.15
+ Contact:	linux-iio@vger.kernel.org
+ Description:
+ 		Raw value of rotation from true/magnetic north measured with
+ 		or without compensation from tilt sensors.
+ 
+ What:		/sys/bus/iio/devices/iio:deviceX/in_currentX_raw
+ KernelVersion:	3.18
+ Contact:	linux-iio@vger.kernel.org
+ Description:
+ 		Raw current measurement from channel X. Units are in milliamps
+ 		after application of scale and offset. If no offset or scale is
+ 		present, output should be considered as processed with the
+ 		unit in milliamps.
+ 
+ What:		/sys/.../iio:deviceX/in_steps_en
+ KernelVersion:	3.19
+ Contact:	linux-iio@vger.kernel.org
+ Description:
+ 		Activates the step counter. After activation, the number of steps
+ 		taken by the user will be counted in hardware and exported through
+ 		in_steps_input.
+ 
+ What:		/sys/.../iio:deviceX/in_steps_input
+ KernelVersion:	3.19
+ Contact:	linux-iio@vger.kernel.org
+ Description:
+ 		This attribute is used to read the number of steps taken by the user
+ 		since the last reboot while activated.
+ 
+ What:		/sys/.../iio:deviceX/in_velocity_sqrt(x^2+y^2+z^2)_input
+ What:		/sys/.../iio:deviceX/in_velocity_sqrt(x^2+y^2+z^2)_raw
+ KernelVersion:	3.19
+ Contact:	linux-iio@vger.kernel.org
+ Description:
+ 		This attribute is used to read the current speed value of the
+ 		user (which is the norm or magnitude of the velocity vector).
+ 		Units after application of scale are m/s.
+ 
+ What:		/sys/.../iio:deviceX/in_steps_debounce_count
+ KernelVersion:	3.20
+ Contact:	linux-iio@vger.kernel.org
+ Description:
+ 		Specifies the number of steps that must occur within
+ 		in_steps_filter_debounce_time for the pedometer to decide the
+ 		consumer is making steps.
+ 
+ What:		/sys/.../iio:deviceX/in_steps_debounce_time
+ KernelVersion:	3.20
+ Contact:	linux-iio@vger.kernel.org
+ Description:
+ 		Specifies number of seconds in which we compute the steps
+ 		that occur in order to decide if the consumer is making steps.
++>>>>>>> 2f0ecb7c6563 (iio: core: Introduce IIO_CHAN_INFO_DEBOUNCE_COUNT and _TIME)
diff --cc drivers/iio/industrialio-core.c
index 31af79e1e872,aaba9d3d980e..000000000000
--- a/drivers/iio/industrialio-core.c
+++ b/drivers/iio/industrialio-core.c
@@@ -116,8 -122,19 +116,17 @@@ static const char * const iio_chan_info
  	[IIO_CHAN_INFO_PHASE] = "phase",
  	[IIO_CHAN_INFO_HARDWAREGAIN] = "hardwaregain",
  	[IIO_CHAN_INFO_HYSTERESIS] = "hysteresis",
++<<<<<<< HEAD
++=======
+ 	[IIO_CHAN_INFO_INT_TIME] = "integration_time",
+ 	[IIO_CHAN_INFO_ENABLE] = "en",
+ 	[IIO_CHAN_INFO_CALIBHEIGHT] = "calibheight",
+ 	[IIO_CHAN_INFO_CALIBWEIGHT] = "calibweight",
+ 	[IIO_CHAN_INFO_DEBOUNCE_COUNT] = "debounce_count",
+ 	[IIO_CHAN_INFO_DEBOUNCE_TIME] = "debounce_time",
++>>>>>>> 2f0ecb7c6563 (iio: core: Introduce IIO_CHAN_INFO_DEBOUNCE_COUNT and _TIME)
  };
  
 -/**
 - * iio_find_channel_from_si() - get channel from its scan index
 - * @indio_dev:		device
 - * @si:			scan index to match
 - */
  const struct iio_chan_spec
  *iio_find_channel_from_si(struct iio_dev *indio_dev, int si)
  {
diff --cc include/linux/iio/iio.h
index c1d245faf5c1,80d855061064..000000000000
--- a/include/linux/iio/iio.h
+++ b/include/linux/iio/iio.h
@@@ -37,6 -37,19 +37,22 @@@ enum iio_chan_info_enum 
  	IIO_CHAN_INFO_PHASE,
  	IIO_CHAN_INFO_HARDWAREGAIN,
  	IIO_CHAN_INFO_HYSTERESIS,
++<<<<<<< HEAD
++=======
+ 	IIO_CHAN_INFO_INT_TIME,
+ 	IIO_CHAN_INFO_ENABLE,
+ 	IIO_CHAN_INFO_CALIBHEIGHT,
+ 	IIO_CHAN_INFO_CALIBWEIGHT,
+ 	IIO_CHAN_INFO_DEBOUNCE_COUNT,
+ 	IIO_CHAN_INFO_DEBOUNCE_TIME,
+ };
+ 
+ enum iio_shared_by {
+ 	IIO_SEPARATE,
+ 	IIO_SHARED_BY_TYPE,
+ 	IIO_SHARED_BY_DIR,
+ 	IIO_SHARED_BY_ALL
++>>>>>>> 2f0ecb7c6563 (iio: core: Introduce IIO_CHAN_INFO_DEBOUNCE_COUNT and _TIME)
  };
  
  enum iio_endian {
* Unmerged path Documentation/ABI/testing/sysfs-bus-iio
* Unmerged path drivers/iio/industrialio-core.c
* Unmerged path include/linux/iio/iio.h
