media: dvb_ca_en50221: sanity check slot number from userspace

jira LE-1907
cve CVE-2018-3693
Rebuild_History Non-Buildable kernel-3.10.0-957.el7
Rebuild_CHGLOG: - [media] dvb_ca_en50221: sanity check slot number from userspace (Lauro Ramos Venancio) [1589035] {CVE-2018-3693}
Rebuild_FUZZ: 94.02%
commit-author Colin Ian King <colin.king@canonical.com>
commit a24e6348e5a0e8562ad64d760c25907ed088611c
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-957.el7/a24e6348.failed

Currently a user can pass in an unsanitized slot number which
will lead to and out of range index into ca->slot_info. Fix this
by checking that the slot number is no more than the allowed
maximum number of slots. Seems that this bug has been in the driver
forever.

Detected by CoverityScan, CID#139381 ("Untrusted pointer read")

	Signed-off-by: Colin Ian King <colin.king@canonical.com>
	Reviewed-by: Dan Carpenter <dan.carpenter@oracle.com>
	Reviewed-by: Jasmin Jessich <jasmin@anw.at>
	Signed-off-by: Mauro Carvalho Chehab <mchehab@s-opensource.com>
(cherry picked from commit a24e6348e5a0e8562ad64d760c25907ed088611c)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/media/dvb-core/dvb_ca_en50221.c
diff --cc drivers/media/dvb-core/dvb_ca_en50221.c
index 0aac3096728e,a3b2754e7124..000000000000
--- a/drivers/media/dvb-core/dvb_ca_en50221.c
+++ b/drivers/media/dvb-core/dvb_ca_en50221.c
@@@ -1308,9 -1473,13 +1308,16 @@@ static ssize_t dvb_ca_en50221_io_write(
  		return -EFAULT;
  	buf += 2;
  	count -= 2;
++<<<<<<< HEAD
++=======
+ 
+ 	if (slot >= ca->slot_count)
+ 		return -EINVAL;
+ 	sl = &ca->slot_info[slot];
++>>>>>>> a24e6348e5a0 (media: dvb_ca_en50221: sanity check slot number from userspace)
  
  	/* check if the slot is actually running */
 -	if (sl->slot_state != DVB_CA_SLOTSTATE_RUNNING)
 +	if (ca->slot_info[slot].slot_state != DVB_CA_SLOTSTATE_RUNNING)
  		return -EINVAL;
  
  	/* fragment the packets & store in the buffer */
* Unmerged path drivers/media/dvb-core/dvb_ca_en50221.c
