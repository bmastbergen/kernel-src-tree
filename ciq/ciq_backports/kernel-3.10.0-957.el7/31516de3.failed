x86/intel_rdt: Add command line parameter to control L2_CDP

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-957.el7
Rebuild_CHGLOG: - [x86] intel_rdt: Add command line parameter to control L2_CDP (Jiri Olsa) [1509785]
Rebuild_FUZZ: 96.49%
commit-author Fenghua Yu <fenghua.yu@intel.com>
commit 31516de306c0c9235156cdc7acb976ea21f1f646
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-957.el7/31516de3.failed

L2 CDP can be controlled by kernel parameter "rdt=".
If "rdt=l2cdp", L2 CDP is turned on.
If "rdt=!l2cdp", L2 CDP is turned off.

	Signed-off-by: Fenghua Yu <fenghua.yu@intel.com>
	Signed-off-by: Thomas Gleixner <tglx@linutronix.de>
	Cc: "Ravi V Shankar" <ravi.v.shankar@intel.com>
	Cc: "Tony Luck" <tony.luck@intel.com>
	Cc: Vikas" <vikas.shivappa@intel.com>
	Cc: Sai Praneeth" <sai.praneeth.prakhya@intel.com>
	Cc: Reinette" <reinette.chatre@intel.com>
Link: https://lkml.kernel.org/r/1513810644-78015-7-git-send-email-fenghua.yu@intel.com


(cherry picked from commit 31516de306c0c9235156cdc7acb976ea21f1f646)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	Documentation/kernel-parameters.txt
diff --cc Documentation/kernel-parameters.txt
index a0f1f1428af0,fde058ca8419..000000000000
--- a/Documentation/kernel-parameters.txt
+++ b/Documentation/kernel-parameters.txt
@@@ -2979,9 -3680,24 +2979,30 @@@ bytes respectively. Such letter suffixe
  			Run specified binary instead of /init from the ramdisk,
  			used for early userspace startup. See initrd.
  
++<<<<<<< HEAD:Documentation/kernel-parameters.txt
 +	reboot=		[BUGS=X86-32,BUGS=ARM,BUGS=IA-64] Rebooting mode
 +			Format: <reboot_mode>[,<reboot_mode2>[,...]]
 +			See arch/*/kernel/reboot.c or arch/*/kernel/process.c
++=======
+ 	rdt=		[HW,X86,RDT]
+ 			Turn on/off individual RDT features. List is:
+ 			cmt, mbmtotal, mbmlocal, l3cat, l3cdp, l2cat, l2cdp,
+ 			mba.
+ 			E.g. to turn on cmt and turn off mba use:
+ 				rdt=cmt,!mba
+ 
+ 	reboot=		[KNL]
+ 			Format (x86 or x86_64):
+ 				[w[arm] | c[old] | h[ard] | s[oft] | g[pio]] \
+ 				[[,]s[mp]#### \
+ 				[[,]b[ios] | a[cpi] | k[bd] | t[riple] | e[fi] | p[ci]] \
+ 				[[,]f[orce]
+ 			Where reboot_mode is one of warm (soft) or cold (hard) or gpio,
+ 			      reboot_type is one of bios, acpi, kbd, triple, efi, or pci,
+ 			      reboot_force is either force or not specified,
+ 			      reboot_cpu is s[mp]#### with #### being the processor
+ 					to be used for rebooting.
++>>>>>>> 31516de306c0 (x86/intel_rdt: Add command line parameter to control L2_CDP):Documentation/admin-guide/kernel-parameters.txt
  
  	relax_domain_level=
  			[KNL, SMP] Set scheduler's default relax_domain_level.
* Unmerged path Documentation/kernel-parameters.txt
diff --git a/arch/x86/kernel/cpu/intel_rdt.c b/arch/x86/kernel/cpu/intel_rdt.c
index e9aeec4a3476..12d1e8789214 100644
--- a/arch/x86/kernel/cpu/intel_rdt.c
+++ b/arch/x86/kernel/cpu/intel_rdt.c
@@ -753,6 +753,7 @@ enum {
 	RDT_FLAG_L3_CAT,
 	RDT_FLAG_L3_CDP,
 	RDT_FLAG_L2_CAT,
+	RDT_FLAG_L2_CDP,
 	RDT_FLAG_MBA,
 };
 
@@ -775,6 +776,7 @@ static struct rdt_options rdt_options[]  __initdata = {
 	RDT_OPT(RDT_FLAG_L3_CAT,    "l3cat",	X86_FEATURE_CAT_L3),
 	RDT_OPT(RDT_FLAG_L3_CDP,    "l3cdp",	X86_FEATURE_CDP_L3),
 	RDT_OPT(RDT_FLAG_L2_CAT,    "l2cat",	X86_FEATURE_CAT_L2),
+	RDT_OPT(RDT_FLAG_L2_CDP,    "l2cdp",	X86_FEATURE_CDP_L2),
 	RDT_OPT(RDT_FLAG_MBA,	    "mba",	X86_FEATURE_MBA),
 };
 #define NUM_RDT_OPTIONS ARRAY_SIZE(rdt_options)
