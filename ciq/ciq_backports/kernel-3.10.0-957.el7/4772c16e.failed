ASoC: Intel: Kconfig: Simplify-clarify ACPI/PCI dependencies

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-957.el7
Rebuild_CHGLOG: - [sound] alsa: asoc: intel: kconfig: Simplify-clarify ACPI/PCI dependencies (Jaroslav Kysela) [1535427]
Rebuild_FUZZ: 95.24%
commit-author Pierre-Louis Bossart <pierre-louis.bossart@linux.intel.com>
commit 4772c16ede522d46219a59646503d2020841a6f4
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-957.el7/4772c16e.failed

PCI/ACPI selections should not happen in Kconfig for machine drivers,
move to SOC selections.

Add distinction between PCI and ACPI HiFi2 platforms and help text.

There should be no functionality change.

The PCI-based platforms may be removed at some point since Medfield
is not really supported by anyone, and with Edison now defunct support for
Merrifield/Edison is to be determined.

The dependency on SND_DMA_SGBUF for Haswell is not clear at this
point and may have to be further updated.

	Signed-off-by: Pierre-Louis Bossart <pierre-louis.bossart@linux.intel.com>
	Reviewed-by: Andy Shevchenko <andriy.shevchenko@linux.intel.com>
Acked-By: Vinod Koul <vinod.koul@intel.com>
	Signed-off-by: Mark Brown <broonie@kernel.org>
(cherry picked from commit 4772c16ede522d46219a59646503d2020841a6f4)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	sound/soc/intel/Kconfig
#	sound/soc/intel/boards/Kconfig
diff --cc sound/soc/intel/Kconfig
index dbc80250ceab,16374576cb6e..000000000000
--- a/sound/soc/intel/Kconfig
+++ b/sound/soc/intel/Kconfig
@@@ -39,241 -38,58 +39,279 @@@ config SND_SOC_INTEL_SST_FIRMWAR
  config SND_SOC_INTEL_SST_ACPI
  	tristate
  
 +config SND_SOC_INTEL_SST_MATCH
 +	tristate
 +
  config SND_SOC_INTEL_HASWELL
++<<<<<<< HEAD
 +	tristate
++=======
+ 	tristate "Intel ASoC SST driver for Haswell/Broadwell"
+ 	depends on SND_DMA_SGBUF
+ 	depends on DMADEVICES && ACPI
++>>>>>>> 4772c16ede52 (ASoC: Intel: Kconfig: Simplify-clarify ACPI/PCI dependencies)
  	select SND_SOC_INTEL_SST
  	select SND_SOC_INTEL_SST_FIRMWARE
 -	select SND_SOC_ACPI_INTEL_MATCH
 -	help
 -	  If you have a Intel Haswell or Broadwell platform connected to
 -	  an I2S codec, then enable this option by saying Y or m. This is
 -	  typically used for Chromebooks. This is a recommended option.
  
  config SND_SOC_INTEL_BAYTRAIL
++<<<<<<< HEAD
 +	tristate
++=======
+ 	tristate "Intel ASoC SST driver for Baytrail (legacy)"
+ 	depends on DMADEVICES && ACPI
++>>>>>>> 4772c16ede52 (ASoC: Intel: Kconfig: Simplify-clarify ACPI/PCI dependencies)
  	select SND_SOC_INTEL_SST
  	select SND_SOC_INTEL_SST_FIRMWARE
 -	select SND_SOC_ACPI_INTEL_MATCH
 +
++<<<<<<< HEAD
 +config SND_SOC_INTEL_HASWELL_MACH
 +	tristate "ASoC Audio DSP support for Intel Haswell Lynxpoint"
 +	depends on X86_INTEL_LPSS && I2C && I2C_DESIGNWARE_PLATFORM
 +	depends on DMADEVICES
 +	select SND_SOC_INTEL_HASWELL
 +	select SND_SOC_RT5640
 +	help
 +	  This adds support for the Lynxpoint Audio DSP on Intel(R) Haswell
 +	  Ultrabook platforms.
 +	  Say Y if you have such a device.
 +	  If unsure select "N".
 +
 +config SND_SOC_INTEL_BXT_DA7219_MAX98357A_MACH
 +	tristate "ASoC Audio driver for Broxton with DA7219 and MAX98357A in I2S Mode"
 +	depends on X86 && ACPI && I2C
 +	select SND_SOC_INTEL_SKYLAKE
 +	select SND_SOC_DA7219
 +	select SND_SOC_MAX98357A
 +	select SND_SOC_DMIC
 +	select SND_SOC_HDAC_HDMI
 +	select SND_HDA_DSP_LOADER
  	help
 -	  If you have a Intel Baytrail platform connected to an I2S codec,
 -	  then enable this option by saying Y or m. This was typically used
 -	  for Baytrail Chromebooks but this option is now deprecated and is
 -	  not recommended, use SND_SST_ATOM_HIFI2_PLATFORM instead.
 +	   This adds support for ASoC machine driver for Broxton-P platforms
 +	   with DA7219 + MAX98357A I2S audio codec.
 +	   Say Y if you have such a device.
 +	   If unsure select "N".
  
 +config SND_SOC_INTEL_BXT_RT298_MACH
 +	tristate "ASoC Audio driver for Broxton with RT298 I2S mode"
 +	depends on X86 && ACPI && I2C
 +	select SND_SOC_INTEL_SKYLAKE
 +	select SND_SOC_RT298
 +	select SND_SOC_DMIC
 +	select SND_SOC_HDAC_HDMI
 +	select SND_HDA_DSP_LOADER
 +	help
 +	   This adds support for ASoC machine driver for Broxton platforms
 +	   with RT286 I2S audio codec.
 +	   Say Y if you have such a device.
 +	   If unsure select "N".
 +
 +config SND_SOC_INTEL_BYT_RT5640_MACH
 +	tristate "ASoC Audio driver for Intel Baytrail with RT5640 codec"
 +	depends on X86_INTEL_LPSS && I2C
 +	depends on DMADEVICES
 +	depends on SND_SST_IPC_ACPI = n
 +	select SND_SOC_INTEL_BAYTRAIL
 +	select SND_SOC_RT5640
 +	help
 +	  This adds audio driver for Intel Baytrail platform based boards
 +	  with the RT5640 audio codec. This driver is deprecated, use
 +	  SND_SOC_INTEL_BYTCR_RT5640_MACH instead for better functionality.
 +
 +config SND_SOC_INTEL_BYT_MAX98090_MACH
 +	tristate "ASoC Audio driver for Intel Baytrail with MAX98090 codec"
 +	depends on X86_INTEL_LPSS && I2C
 +	depends on DMADEVICES
 +	depends on SND_SST_IPC_ACPI = n
 +	select SND_SOC_INTEL_BAYTRAIL
 +	select SND_SOC_MAX98090
 +	help
 +	  This adds audio driver for Intel Baytrail platform based boards
 +	  with the MAX98090 audio codec.
 +
 +config SND_SOC_INTEL_BDW_RT5677_MACH
 +	tristate "ASoC Audio driver for Intel Broadwell with RT5677 codec"
 +	depends on X86_INTEL_LPSS && GPIOLIB && I2C
 +	depends on DMADEVICES
 +	select SND_SOC_INTEL_HASWELL
 +	select SND_SOC_RT5677
 +	help
 +	  This adds support for Intel Broadwell platform based boards with
 +	  the RT5677 audio codec.
 +
 +config SND_SOC_INTEL_BROADWELL_MACH
 +	tristate "ASoC Audio DSP support for Intel Broadwell Wildcatpoint"
 +	depends on X86_INTEL_LPSS && I2C && I2C_DESIGNWARE_PLATFORM
 +	depends on DMADEVICES
 +	select SND_SOC_INTEL_HASWELL
 +	select SND_SOC_RT286
 +	help
 +	  This adds support for the Wilcatpoint Audio DSP on Intel(R) Broadwell
 +	  Ultrabook platforms.
 +	  Say Y if you have such a device.
 +	  If unsure select "N".
 +
 +config SND_SOC_INTEL_BYTCR_RT5640_MACH
 +        tristate "ASoC Audio driver for Intel Baytrail and Baytrail-CR with RT5640 codec"
 +	depends on X86 && I2C && ACPI
 +	select SND_SOC_RT5640
 +	select SND_SST_ATOM_HIFI2_PLATFORM
 +	select SND_SST_IPC_ACPI
 +	select SND_SOC_INTEL_SST_MATCH if ACPI
 +	help
 +          This adds support for ASoC machine driver for Intel(R) Baytrail and Baytrail-CR
 +          platforms with RT5640 audio codec.
 +          Say Y if you have such a device.
 +          If unsure select "N".
 +
 +config SND_SOC_INTEL_BYTCR_RT5651_MACH
 +        tristate "ASoC Audio driver for Intel Baytrail and Baytrail-CR with RT5651 codec"
 +	depends on X86 && I2C && ACPI
 +	select SND_SOC_RT5651
 +	select SND_SST_ATOM_HIFI2_PLATFORM
 +	select SND_SST_IPC_ACPI
 +	select SND_SOC_INTEL_SST_MATCH if ACPI
 +	help
 +          This adds support for ASoC machine driver for Intel(R) Baytrail and Baytrail-CR
 +          platforms with RT5651 audio codec.
 +          Say Y if you have such a device.
 +          If unsure select "N".
 +
 +config SND_SOC_INTEL_CHT_BSW_RT5672_MACH
 +        tristate "ASoC Audio driver for Intel Cherrytrail & Braswell with RT5672 codec"
 +        depends on X86_INTEL_LPSS && I2C && ACPI
 +        select SND_SOC_RT5670
 +        select SND_SST_ATOM_HIFI2_PLATFORM
 +        select SND_SST_IPC_ACPI
 +	select SND_SOC_INTEL_SST_MATCH if ACPI
 +        help
 +          This adds support for ASoC machine driver for Intel(R) Cherrytrail & Braswell
 +          platforms with RT5672 audio codec.
 +          Say Y if you have such a device.
 +          If unsure select "N".
 +
 +config SND_SOC_INTEL_CHT_BSW_RT5645_MACH
 +	tristate "ASoC Audio driver for Intel Cherrytrail & Braswell with RT5645/5650 codec"
 +	depends on X86_INTEL_LPSS && I2C && ACPI
 +	select SND_SOC_RT5645
 +	select SND_SST_ATOM_HIFI2_PLATFORM
 +	select SND_SST_IPC_ACPI
 +	select SND_SOC_INTEL_SST_MATCH if ACPI
 +	help
 +	  This adds support for ASoC machine driver for Intel(R) Cherrytrail & Braswell
 +	  platforms with RT5645/5650 audio codec.
 +	  If unsure select "N".
 +
 +config SND_SOC_INTEL_CHT_BSW_MAX98090_TI_MACH
 +	tristate "ASoC Audio driver for Intel Cherrytrail & Braswell with MAX98090 & TI codec"
 +	depends on X86_INTEL_LPSS && I2C && ACPI
 +	select SND_SOC_MAX98090
 +	select SND_SOC_TS3A227E
 +	select SND_SST_ATOM_HIFI2_PLATFORM
 +	select SND_SST_IPC_ACPI
 +	select SND_SOC_INTEL_SST_MATCH if ACPI
 +	help
 +	  This adds support for ASoC machine driver for Intel(R) Cherrytrail & Braswell
 +	  platforms with MAX98090 audio codec it also can support TI jack chip as aux device.
 +	  If unsure select "N".
 +
 +config SND_SOC_INTEL_BYT_CHT_DA7213_MACH
 +	tristate "ASoC Audio driver for Intel Baytrail & Cherrytrail with DA7212/7213 codec"
 +	depends on X86_INTEL_LPSS && I2C && ACPI
 +	select SND_SOC_DA7213
 +	select SND_SST_ATOM_HIFI2_PLATFORM
 +	select SND_SST_IPC_ACPI
 +	select SND_SOC_INTEL_SST_MATCH if ACPI
 +	help
 +	  This adds support for ASoC machine driver for Intel(R) Baytrail & CherryTrail
 +	  platforms with DA7212/7213 audio codec.
 +	  If unsure select "N".
 +
 +config SND_SOC_INTEL_BYT_CHT_ES8316_MACH
 +	tristate "ASoC Audio driver for Intel Baytrail & Cherrytrail with ES8316 codec"
 +	depends on X86_INTEL_LPSS && I2C && ACPI
 +	select SND_SOC_ES8316
 +	select SND_SST_ATOM_HIFI2_PLATFORM
 +	select SND_SST_IPC_ACPI
 +	select SND_SOC_INTEL_SST_MATCH if ACPI
 +	help
 +	  This adds support for ASoC machine driver for Intel(R) Baytrail &
 +	  Cherrytrail platforms with ES8316 audio codec.
 +	  If unsure select "N".
 +
 +config SND_SOC_INTEL_BYT_CHT_NOCODEC_MACH
 +	tristate "ASoC Audio driver for Intel Baytrail & Cherrytrail platform with no codec (MinnowBoard MAX, Up)"
 +	depends on X86_INTEL_LPSS && I2C && ACPI
 +	select SND_SST_ATOM_HIFI2_PLATFORM
 +	select SND_SST_IPC_ACPI
 +	select SND_SOC_INTEL_SST_MATCH if ACPI
 +	help
 +	  This adds support for ASoC machine driver for the MinnowBoard Max or
 +	  Up boards and provides access to I2S signals on the Low-Speed
 +	  connector
 +	  If unsure select "N".
 +
 +config SND_SOC_INTEL_KBL_RT5663_MAX98927_MACH
 +	tristate "ASoC Audio driver for KBL with RT5663 and MAX98927 in I2S Mode"
 +	depends on X86_INTEL_LPSS && I2C
 +	select SND_SOC_INTEL_SST
 +	select SND_SOC_INTEL_SKYLAKE
 +	select SND_SOC_RT5663
 +	select SND_SOC_MAX98927
 +	select SND_SOC_DMIC
 +	select SND_SOC_HDAC_HDMI
 +	help
 +	  This adds support for ASoC Onboard Codec I2S machine driver. This will
 +	  create an alsa sound card for RT5663 + MAX98927.
 +	  Say Y if you have such a device.
 +	  If unsure select "N".
 +
 +config SND_SOC_INTEL_KBL_RT5663_RT5514_MAX98927_MACH
 +        tristate "ASoC Audio driver for KBL with RT5663, RT5514 and MAX98927 in I2S Mode"
 +        depends on X86_INTEL_LPSS && I2C && SPI
 +        select SND_SOC_INTEL_SST
 +        select SND_SOC_INTEL_SKYLAKE
 +        select SND_SOC_RT5663
 +        select SND_SOC_RT5514
 +        select SND_SOC_RT5514_SPI
 +        select SND_SOC_MAX98927
 +        select SND_SOC_HDAC_HDMI
 +        help
 +          This adds support for ASoC Onboard Codec I2S machine driver. This will
 +          create an alsa sound card for RT5663 + RT5514 + MAX98927.
 +          Say Y if you have such a device.
 +          If unsure select "N".
 +
 +config SND_SOC_INTEL_SKYLAKE_SSP_CLK
 +	tristate
++=======
+ config SND_SST_ATOM_HIFI2_PLATFORM_PCI
+ 	tristate "Intel ASoC SST driver for PCI HiFi2 platforms (Medfield, Merrifield)"
+ 	depends on X86 && PCI
+ 	select SND_SST_IPC_PCI
+ 	select SND_SOC_COMPRESS
+ 	select SND_SOC_INTEL_COMMON
+ 	help
+ 	  If you have a Intel Medfield or Merrifield/Edison platform, then
+ 	  enable this option by saying Y or m. Distros will typically not
+ 	  enable this option: Medfield devices are not available to
+ 	  developers and while Merrifield/Edison can run a mainline kernel with
+ 	  limited functionality it will require a firmware file which
+ 	  is not in the standard firmware tree
+ 
+ config SND_SST_ATOM_HIFI2_PLATFORM
+ 	tristate "Intel ASoC SST driver for ACPI HiFi2 platforms (Baytrail, Cherrytrail)"
+ 	depends on X86 && ACPI
+ 	select SND_SST_IPC_ACPI
+ 	select SND_SOC_COMPRESS
+ 	select SND_SOC_ACPI_INTEL_MATCH
+ 	help
+ 	  If you have a Intel Baytrail or Cherrytrail platform with an I2S
+ 	  codec, then enable this option by saying Y or m. This is a
+ 	  recommended option
++>>>>>>> 4772c16ede52 (ASoC: Intel: Kconfig: Simplify-clarify ACPI/PCI dependencies)
  
  config SND_SOC_INTEL_SKYLAKE
 -	tristate "Intel ASoC SST driver for SKL/BXT/KBL/GLK/CNL"
 -	depends on PCI && ACPI
 +	tristate
  	select SND_HDA_EXT_CORE
  	select SND_HDA_DSP_LOADER
  	select SND_SOC_TOPOLOGY
* Unmerged path sound/soc/intel/boards/Kconfig
* Unmerged path sound/soc/intel/Kconfig
* Unmerged path sound/soc/intel/boards/Kconfig
