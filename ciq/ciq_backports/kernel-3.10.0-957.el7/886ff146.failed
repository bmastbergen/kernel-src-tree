i40e: stop using cmpxchg flow in i40e_set_priv_flags()

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-957.el7
commit-author Jacob Keller <jacob.e.keller@intel.com>
commit 886ff146a73627c287262a7d92ddfb50baa29552
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-957.el7/886ff146.failed

Now that the only places which modify flags are either (a) during
initialization prior to creating a netdevice, or (b) while holding the
rtnl lock, we no longer need the cmpxchg64 call in i40e_set_priv_flags.

	Signed-off-by: Jacob Keller <jacob.e.keller@intel.com>
	Tested-by: Andrew Bowers <andrewx.bowers@intel.com>
	Signed-off-by: Jeff Kirsher <jeffrey.t.kirsher@intel.com>
(cherry picked from commit 886ff146a73627c287262a7d92ddfb50baa29552)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/intel/i40e/i40e_ethtool.c
diff --cc drivers/net/ethernet/intel/i40e/i40e_ethtool.c
index d1640cbf01f3,b974482ff630..000000000000
--- a/drivers/net/ethernet/intel/i40e/i40e_ethtool.c
+++ b/drivers/net/ethernet/intel/i40e/i40e_ethtool.c
@@@ -4341,21 -4436,12 +4341,20 @@@ flags_complete
  		}
  	}
  
- 	/* Compare and exchange the new flags into place. If we failed, that
- 	 * is if cmpxchg returns anything but the old value, this means that
- 	 * something else has modified the flags variable since we copied it
- 	 * originally. We'll just punt with an error and log something in the
- 	 * message buffer.
- 	 *
- 	 * This is the point of no return for this function.  We need to have
- 	 * checked any discrepancies or misconfigurations and returned
- 	 * EOPNOTSUPP before updating pf->flags here.
+ 	/* Now that we've checked to ensure that the new flags are valid, load
+ 	 * them into place. Since we only modify flags either (a) during
+ 	 * initialization or (b) while holding the RTNL lock, we don't need
+ 	 * anything fancy here.
  	 */
++<<<<<<< HEAD
 +	if (cmpxchg(&pf->flags, orig_flags, new_flags) != orig_flags) {
 +		dev_warn(&pf->pdev->dev,
 +			 "Unable to update pf->flags as it was modified by another thread...\n");
 +		return -EAGAIN;
 +	}
++=======
+ 	pf->flags = new_flags;
++>>>>>>> 886ff146a736 (i40e: stop using cmpxchg flow in i40e_set_priv_flags())
  
  	/* Process any additional changes needed as a result of flag changes.
  	 * The changed_flags value reflects the list of bits that were
* Unmerged path drivers/net/ethernet/intel/i40e/i40e_ethtool.c
