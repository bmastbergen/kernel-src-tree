netfilter: ipset: Add element count to hash headers

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-957.el7
commit-author Eric B Munson <emunson@akamai.com>
commit a54dad51a83ba08e951191ce3e1e9eb44750c0bb
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-957.el7/a54dad51.failed

It would be useful for userspace to query the size of an ipset hash,
however, this data is not exposed to userspace outside of counting the
number of member entries.  This patch uses the attribute
IPSET_ATTR_ELEMENTS to indicate the size in the the header that is
exported to userspace.  This field is then printed by the userspace
tool for hashes.

	Signed-off-by: Eric B Munson <emunson@akamai.com>
	Cc: Pablo Neira Ayuso <pablo@netfilter.org>
	Cc: Josh Hunt <johunt@akamai.com>
	Cc: netfilter-devel@vger.kernel.org
	Signed-off-by: Jozsef Kadlecsik <kadlec@blackhole.kfki.hu>
(cherry picked from commit a54dad51a83ba08e951191ce3e1e9eb44750c0bb)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/netfilter/ipset/ip_set_hash_gen.h
diff --cc net/netfilter/ipset/ip_set_hash_gen.h
index 9ce28af662bf,f5acfb9709c9..000000000000
--- a/net/netfilter/ipset/ip_set_hash_gen.h
+++ b/net/netfilter/ipset/ip_set_hash_gen.h
@@@ -835,11 -1080,13 +835,17 @@@ mtype_head(struct ip_set *set, struct s
  #endif
  	if (nla_put_net32(skb, IPSET_ATTR_REFERENCES, htonl(set->ref)) ||
  	    nla_put_net32(skb, IPSET_ATTR_MEMSIZE, htonl(memsize)) ||
++<<<<<<< HEAD
 +	    ((set->extensions & IPSET_EXT_TIMEOUT) &&
 +	     nla_put_net32(skb, IPSET_ATTR_TIMEOUT, htonl(h->timeout))) ||
 +	    ((set->extensions & IPSET_EXT_COUNTER) &&
 +	     nla_put_net32(skb, IPSET_ATTR_CADT_FLAGS,
 +			   htonl(IPSET_FLAG_WITH_COUNTERS))))
++=======
+ 	    nla_put_net32(skb, IPSET_ATTR_ELEMENTS, htonl(h->elements)))
+ 		goto nla_put_failure;
+ 	if (unlikely(ip_set_put_flags(skb, set)))
++>>>>>>> a54dad51a83b (netfilter: ipset: Add element count to hash headers)
  		goto nla_put_failure;
  	ipset_nest_end(skb, nested);
  
* Unmerged path net/netfilter/ipset/ip_set_hash_gen.h
