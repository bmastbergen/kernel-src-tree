cifs: remove rfc1002 header from smb2_negotiate_req

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-957.el7
commit-author Ronnie Sahlberg <lsahlber@redhat.com>
commit 13cacea7bb20fbbd3cb400953b3142cde139abaa
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-957.el7/13cacea7.failed

	Signed-off-by: Ronnie Sahlberg <lsahlber@redhat.com>
	Signed-off-by: Steve French <smfrench@gmail.com>
(cherry picked from commit 13cacea7bb20fbbd3cb400953b3142cde139abaa)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	fs/cifs/smb2pdu.c
diff --cc fs/cifs/smb2pdu.c
index d547faa509d7,b1c2cc8ef55f..000000000000
--- a/fs/cifs/smb2pdu.c
+++ b/fs/cifs/smb2pdu.c
@@@ -488,12 -492,27 +491,34 @@@ SMB2_negotiate(const unsigned int xid, 
  	if (rc)
  		return rc;
  
- 	req->hdr.sync_hdr.SessionId = 0;
+ 	req->sync_hdr.SessionId = 0;
  
++<<<<<<< HEAD
 +	req->Dialects[0] = cpu_to_le16(ses->server->vals->protocol_id);
 +
 +	req->DialectCount = cpu_to_le16(1); /* One vers= at a time for now */
 +	inc_rfc1001_len(req, 2);
++=======
+ 	if (strcmp(ses->server->vals->version_string,
+ 		   SMB3ANY_VERSION_STRING) == 0) {
+ 		req->Dialects[0] = cpu_to_le16(SMB30_PROT_ID);
+ 		req->Dialects[1] = cpu_to_le16(SMB302_PROT_ID);
+ 		req->DialectCount = cpu_to_le16(2);
+ 		total_len += 4;
+ 	} else if (strcmp(ses->server->vals->version_string,
+ 		   SMBDEFAULT_VERSION_STRING) == 0) {
+ 		req->Dialects[0] = cpu_to_le16(SMB21_PROT_ID);
+ 		req->Dialects[1] = cpu_to_le16(SMB30_PROT_ID);
+ 		req->Dialects[2] = cpu_to_le16(SMB302_PROT_ID);
+ 		req->DialectCount = cpu_to_le16(3);
+ 		total_len += 6;
+ 	} else {
+ 		/* otherwise send specific dialect */
+ 		req->Dialects[0] = cpu_to_le16(ses->server->vals->protocol_id);
+ 		req->DialectCount = cpu_to_le16(1);
+ 		total_len += 2;
+ 	}
++>>>>>>> 13cacea7bb20 (cifs: remove rfc1002 header from smb2_negotiate_req)
  
  	/* only one of SMB2 signing flags may be set in SMB2 request */
  	if (ses->sign)
* Unmerged path fs/cifs/smb2pdu.c
diff --git a/fs/cifs/smb2pdu.h b/fs/cifs/smb2pdu.h
index e2b6ef14ec49..c7b492a586a2 100644
--- a/fs/cifs/smb2pdu.h
+++ b/fs/cifs/smb2pdu.h
@@ -224,7 +224,7 @@ struct share_redirect_error_context_rsp {
 #define SMB2_CLIENT_GUID_SIZE 16
 
 struct smb2_negotiate_req {
-	struct smb2_hdr hdr;
+	struct smb2_sync_hdr sync_hdr;
 	__le16 StructureSize; /* Must be 36 */
 	__le16 DialectCount;
 	__le16 SecurityMode;
