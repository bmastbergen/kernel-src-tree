i2c: i801: Save register SMBSLVCMD value only once

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-957.el7
Rebuild_CHGLOG: - [i2c] i801: Save register SMBSLVCMD value only once (Benjamin Tissoires) [1554926]
Rebuild_FUZZ: 94.74%
commit-author Jean Delvare <jdelvare@suse.de>
commit a086bb8317303dd74725dca933b9b29575159382
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-957.el7/a086bb83.failed

Saving the original value of register SMBSLVCMD in
i801_enable_host_notify() doesn't work, because this function is
called not only at probe time but also at resume time. Do it in
i801_probe() instead, so that the saved value is not overwritten at
resume time.

	Signed-off-by: Jean Delvare <jdelvare@suse.de>
Fixes: 22e94bd6779e ("i2c: i801: store and restore the SLVCMD register at load and unload")
	Reviewed-by: Benjamin Tissoires <benjamin.tissoires@redhat.com>
	Tested-by: Jason Andryuk <jandryuk@gmail.com>
	Signed-off-by: Wolfram Sang <wsa@the-dreams.de>
	Cc: stable@vger.kernel.org	# v4.10+
(cherry picked from commit a086bb8317303dd74725dca933b9b29575159382)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/i2c/busses/i2c-i801.c
diff --cc drivers/i2c/busses/i2c-i801.c
index cb34b050a17d,17aa20a55642..000000000000
--- a/drivers/i2c/busses/i2c-i801.c
+++ b/drivers/i2c/busses/i2c-i801.c
@@@ -857,7 -954,32 +857,36 @@@ static u32 i801_func(struct i2c_adapte
  	       I2C_FUNC_SMBUS_BLOCK_DATA | I2C_FUNC_SMBUS_WRITE_I2C_BLOCK |
  	       ((priv->features & FEATURE_SMBUS_PEC) ? I2C_FUNC_SMBUS_PEC : 0) |
  	       ((priv->features & FEATURE_I2C_BLOCK_READ) ?
++<<<<<<< HEAD
 +		I2C_FUNC_SMBUS_READ_I2C_BLOCK : 0);
++=======
+ 		I2C_FUNC_SMBUS_READ_I2C_BLOCK : 0) |
+ 	       ((priv->features & FEATURE_HOST_NOTIFY) ?
+ 		I2C_FUNC_SMBUS_HOST_NOTIFY : 0);
+ }
+ 
+ static void i801_enable_host_notify(struct i2c_adapter *adapter)
+ {
+ 	struct i801_priv *priv = i2c_get_adapdata(adapter);
+ 
+ 	if (!(priv->features & FEATURE_HOST_NOTIFY))
+ 		return;
+ 
+ 	if (!(SMBSLVCMD_HST_NTFY_INTREN & priv->original_slvcmd))
+ 		outb_p(SMBSLVCMD_HST_NTFY_INTREN | priv->original_slvcmd,
+ 		       SMBSLVCMD(priv));
+ 
+ 	/* clear Host Notify bit to allow a new notification */
+ 	outb_p(SMBSLVSTS_HST_NTFY_STS, SMBSLVSTS(priv));
+ }
+ 
+ static void i801_disable_host_notify(struct i801_priv *priv)
+ {
+ 	if (!(priv->features & FEATURE_HOST_NOTIFY))
+ 		return;
+ 
+ 	outb_p(priv->original_slvcmd, SMBSLVCMD(priv));
++>>>>>>> a086bb831730 (i2c: i801: Save register SMBSLVCMD value only once)
  }
  
  static const struct i2c_algorithm smbus_algorithm = {
* Unmerged path drivers/i2c/busses/i2c-i801.c
