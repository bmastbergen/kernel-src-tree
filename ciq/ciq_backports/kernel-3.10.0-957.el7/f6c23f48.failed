iio:kfifo: Fix memory leak

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-957.el7
Rebuild_CHGLOG: - [iio] kfifo: Fix memory leak (Tony Camuso) [1559170]
Rebuild_FUZZ: 91.67%
commit-author Lars-Peter Clausen <lars@metafoo.de>
commit f6c23f483937b8be53f313ec31068acdca91a25d
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-957.el7/f6c23f48.failed

We need to free the kfifo when we release the buffer, otherwise the fifos memory
will be leaked.

	Signed-off-by: Lars-Peter Clausen <lars@metafoo.de>
	Signed-off-by: Jonathan Cameron <jic23@kernel.org>
(cherry picked from commit f6c23f483937b8be53f313ec31068acdca91a25d)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/iio/kfifo_buf.c
diff --cc drivers/iio/kfifo_buf.c
index 1bea41bcbdc6,ce51092695ab..000000000000
--- a/drivers/iio/kfifo_buf.c
+++ b/drivers/iio/kfifo_buf.c
@@@ -130,6 -130,14 +130,17 @@@ static int iio_read_first_n_kfifo(struc
  	return copied;
  }
  
++<<<<<<< HEAD
++=======
+ static void iio_kfifo_buffer_release(struct iio_buffer *buffer)
+ {
+ 	struct iio_kfifo *kf = iio_to_kfifo(buffer);
+ 
+ 	kfifo_free(&kf->kf);
+ 	kfree(kf);
+ }
+ 
++>>>>>>> f6c23f483937 (iio:kfifo: Fix memory leak)
  static const struct iio_buffer_access_funcs kfifo_access_funcs = {
  	.store_to = &iio_store_to_kfifo,
  	.read_first_n = &iio_read_first_n_kfifo,
* Unmerged path drivers/iio/kfifo_buf.c
