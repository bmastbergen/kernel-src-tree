iio: Move callback buffer to its own module

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-957.el7
Rebuild_CHGLOG: - [iio] Move callback buffer to its own module (Tony Camuso) [1559170]
Rebuild_FUZZ: 93.83%
commit-author Lars-Peter Clausen <lars@metafoo.de>
commit 050ee2f16e245b42c9ba30640bb91b309b424c48
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-957.el7/050ee2f1.failed

Currently the IIO callback buffer implementation is directly built into the
IIO core module when enabled. Given that the callback buffer module is
standalone functionallity there is really no reason to do this. So move it
to its own module.

Also rename the source to follow the standard IIO module naming convention
as well as add a license notice to the file.

	Signed-off-by: Lars-Peter Clausen <lars@metafoo.de>
	Signed-off-by: Jonathan Cameron <jic23@kernel.org>
(cherry picked from commit 050ee2f16e245b42c9ba30640bb91b309b424c48)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/iio/Kconfig
diff --cc drivers/iio/Kconfig
index 4445a10262c8,b52c8a3b1360..000000000000
--- a/drivers/iio/Kconfig
+++ b/drivers/iio/Kconfig
@@@ -21,9 -21,9 +21,13 @@@ config IIO_BUFFE
  if IIO_BUFFER
  
  config IIO_BUFFER_CB
++<<<<<<< HEAD
 +boolean "IIO callback buffer used for push in-kernel interfaces"
++=======
+ 	tristate "IIO callback buffer used for push in-kernel interfaces"
++>>>>>>> 050ee2f16e24 (iio: Move callback buffer to its own module)
  	help
 -	  Should be selected by any drivers that do in-kernel push
 +	  Should be selected by any drivers that do-inkernel push
  	  usage.  That is, those where the data is pushed to the consumer.
  
  config IIO_KFIFO_BUF
* Unmerged path drivers/iio/Kconfig
diff --git a/drivers/iio/Makefile b/drivers/iio/Makefile
index 7a3866c2d2a1..278f236e4010 100644
--- a/drivers/iio/Makefile
+++ b/drivers/iio/Makefile
@@ -6,8 +6,8 @@ obj-$(CONFIG_IIO) += industrialio.o
 industrialio-y := industrialio-core.o industrialio-event.o inkern.o
 industrialio-$(CONFIG_IIO_BUFFER) += industrialio-buffer.o
 industrialio-$(CONFIG_IIO_TRIGGER) += industrialio-trigger.o
-industrialio-$(CONFIG_IIO_BUFFER_CB) += buffer_cb.o
 
+obj-$(CONFIG_IIO_BUFFER_CB) += industrialio-buffer-cb.o
 obj-$(CONFIG_IIO_TRIGGERED_BUFFER) += industrialio-triggered-buffer.o
 obj-$(CONFIG_IIO_KFIFO_BUF) += kfifo_buf.o
 
diff --git a/drivers/iio/buffer_cb.c b/drivers/iio/industrialio-buffer-cb.c
similarity index 87%
rename from drivers/iio/buffer_cb.c
rename to drivers/iio/industrialio-buffer-cb.c
index 0578f74fa23c..700947d9285f 100644
--- a/drivers/iio/buffer_cb.c
+++ b/drivers/iio/industrialio-buffer-cb.c
@@ -1,4 +1,12 @@
+/* The industrial I/O callback buffer
+ *
+ * This program is free software; you can redistribute it and/or modify it
+ * under the terms of the GNU General Public License version 2 as published by
+ * the Free Software Foundation.
+ */
+
 #include <linux/kernel.h>
+#include <linux/module.h>
 #include <linux/slab.h>
 #include <linux/err.h>
 #include <linux/export.h>
@@ -116,3 +124,7 @@ struct iio_channel
 	return cb_buffer->channels;
 }
 EXPORT_SYMBOL_GPL(iio_channel_cb_get_channels);
+
+MODULE_AUTHOR("Jonathan Cameron <jic23@kernel.org>");
+MODULE_DESCRIPTION("Industrial I/O callback buffer");
+MODULE_LICENSE("GPL");
