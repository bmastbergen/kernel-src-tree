NFS: Set FATTR4_WORD0_TYPE for . and .. entries

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-957.el7
commit-author Anna Schumaker <Anna.Schumaker@Netapp.com>
commit 18fe6a23e3114a6737471570753b708ff293b9de
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-957.el7/18fe6a23.failed

The current code worked okay for getdents(), but getdents64() expects
the d_type field to get filled out properly in the stat structure.
Setting this field fixes xfstests generic/401.

	Signed-off-by: Anna Schumaker <Anna.Schumaker@Netapp.com>
(cherry picked from commit 18fe6a23e3114a6737471570753b708ff293b9de)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	fs/nfs/nfs4proc.c
diff --cc fs/nfs/nfs4proc.c
index 1f76d7c4dff9,735b3068a2d1..000000000000
--- a/fs/nfs/nfs4proc.c
+++ b/fs/nfs/nfs4proc.c
@@@ -302,9 -306,10 +303,16 @@@ static void nfs4_setup_readdir(u64 cook
  		memcpy(p, ".\0\0\0", 4);                        /* entry */
  		p++;
  		*p++ = xdr_one;                         /* bitmap length */
++<<<<<<< HEAD
 +		*p++ = htonl(FATTR4_WORD0_FILEID);             /* bitmap */
 +		*p++ = htonl(8);              /* attribute buffer length */
 +		p = xdr_encode_hyper(p, NFS_FILEID(dentry->d_inode));
++=======
+ 		*p++ = htonl(attrs);                           /* bitmap */
+ 		*p++ = htonl(12);             /* attribute buffer length */
+ 		*p++ = htonl(NF4DIR);
+ 		p = xdr_encode_hyper(p, NFS_FILEID(d_inode(dentry)));
++>>>>>>> 18fe6a23e311 (NFS: Set FATTR4_WORD0_TYPE for . and .. entries)
  	}
  	
  	*p++ = xdr_one;                                  /* next */
@@@ -314,9 -319,10 +322,16 @@@
  	memcpy(p, "..\0\0", 4);                         /* entry */
  	p++;
  	*p++ = xdr_one;                         /* bitmap length */
++<<<<<<< HEAD
 +	*p++ = htonl(FATTR4_WORD0_FILEID);             /* bitmap */
 +	*p++ = htonl(8);              /* attribute buffer length */
 +	p = xdr_encode_hyper(p, NFS_FILEID(dentry->d_parent->d_inode));
++=======
+ 	*p++ = htonl(attrs);                           /* bitmap */
+ 	*p++ = htonl(12);             /* attribute buffer length */
+ 	*p++ = htonl(NF4DIR);
+ 	p = xdr_encode_hyper(p, NFS_FILEID(d_inode(dentry->d_parent)));
++>>>>>>> 18fe6a23e311 (NFS: Set FATTR4_WORD0_TYPE for . and .. entries)
  
  	readdir->pgbase = (char *)p - (char *)start;
  	readdir->count -= readdir->pgbase;
* Unmerged path fs/nfs/nfs4proc.c
