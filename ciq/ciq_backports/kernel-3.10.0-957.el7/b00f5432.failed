ip6_tunnel: process toobig in a better way

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-957.el7
commit-author Xin Long <lucien.xin@gmail.com>
commit b00f543240b9423eda73ad06c57becdd5478bc26
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-957.el7/b00f5432.failed

The same improvement in "ip6_gre: process toobig in a better way"
is needed by ip4ip6 and ip6ip6 as well.

Note that ip4ip6 and ip6ip6 will also update sk dst pmtu in their
err_handlers. Like I said before, gre6 could not do this as it's
inner proto is not certain. But for all of them, sk dst pmtu will
be updated in tx path if in need.

	Signed-off-by: Xin Long <lucien.xin@gmail.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit b00f543240b9423eda73ad06c57becdd5478bc26)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/ipv6/ip6_tunnel.c
diff --cc net/ipv6/ip6_tunnel.c
index a12e6c346803,7e9e205b69d9..000000000000
--- a/net/ipv6/ip6_tunnel.c
+++ b/net/ipv6/ip6_tunnel.c
@@@ -486,12 -498,11 +486,11 @@@ ip6_tnl_err(struct sk_buff *skb, __u8 i
  	err = 0;
  
  	switch (*type) {
- 		__u32 teli;
  		struct ipv6_tlv_tnl_enc_lim *tel;
- 		__u32 mtu;
+ 		__u32 mtu, teli;
  	case ICMPV6_DEST_UNREACH:
 -		net_dbg_ratelimited("%s: Path to destination invalid or inactive!\n",
 -				    t->parms.name);
 +		net_warn_ratelimited("%s: Path to destination invalid or inactive!\n",
 +				     t->parms.name);
  		rel_msg = 1;
  		break;
  	case ICMPV6_TIME_EXCEED:
@@@ -522,9 -535,8 +523,14 @@@
  		mtu = *info - offset;
  		if (mtu < IPV6_MIN_MTU)
  			mtu = IPV6_MIN_MTU;
++<<<<<<< HEAD
 +		t->dev->mtu = mtu;
 +
 +		if ((len = sizeof (*ipv6h) + ntohs(ipv6h->payload_len)) > mtu) {
++=======
+ 		len = sizeof(*ipv6h) + ntohs(ipv6h->payload_len);
+ 		if (len > mtu) {
++>>>>>>> b00f543240b9 (ip6_tunnel: process toobig in a better way)
  			rel_type = ICMPV6_PKT_TOOBIG;
  			rel_code = 0;
  			rel_info = mtu;
* Unmerged path net/ipv6/ip6_tunnel.c
