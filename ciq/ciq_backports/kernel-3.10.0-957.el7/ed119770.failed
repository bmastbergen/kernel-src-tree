HID: sensor-hub: correct dyn_callback_lock IRQ-safe change

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-957.el7
Rebuild_CHGLOG: - [hid] sensor-hub: correct dyn_callback_lock IRQ-safe change (Tony Camuso) [1559170]
Rebuild_FUZZ: 95.50%
commit-author Srinivas Pandruvada <srinivas.pandruvada@linux.intel.com>
commit ed1197709504c3641cbad32843667539cc912ea1
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-957.el7/ed119770.failed

Commit 0ccf091d1fbc1f99bb7f93bff8cf346769a9b0cd ("HID: sensor-hub:
make dyn_callback_lock IRQ-safe) was supposed to change locks
in sensor_hub_get_callback(), but missed.

	Signed-off-by: Srinivas Pandruvada <srinivas.pandruvada@linux.intel.com>
	Signed-off-by: Jiri Kosina <jkosina@suse.cz>
(cherry picked from commit ed1197709504c3641cbad32843667539cc912ea1)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/hid/hid-sensor-hub.c
diff --cc drivers/hid/hid-sensor-hub.c
index 3e67ed86c707,e54ce1097e2c..000000000000
--- a/drivers/hid/hid-sensor-hub.c
+++ b/drivers/hid/hid-sensor-hub.c
@@@ -131,15 -135,22 +131,22 @@@ static struct hid_sensor_hub_callbacks 
  {
  	struct hid_sensor_hub_callbacks_list *callback;
  	struct sensor_hub_data *pdata = hid_get_drvdata(hdev);
+ 	unsigned long flags;
  
- 	spin_lock(&pdata->dyn_callback_lock);
+ 	spin_lock_irqsave(&pdata->dyn_callback_lock, flags);
  	list_for_each_entry(callback, &pdata->dyn_callback_list, list)
 -		if (callback->usage_id == usage_id &&
 -			(collection_index >=
 -				callback->hsdev->start_collection_index) &&
 -			(collection_index <
 -				callback->hsdev->end_collection_index)) {
 +		if (callback->usage_id == usage_id) {
  			*priv = callback->priv;
++<<<<<<< HEAD
 +			spin_unlock(&pdata->dyn_callback_lock);
++=======
+ 			*hsdev = callback->hsdev;
+ 			spin_unlock_irqrestore(&pdata->dyn_callback_lock,
+ 					       flags);
++>>>>>>> ed1197709504 (HID: sensor-hub: correct dyn_callback_lock IRQ-safe change)
  			return callback->usage_callback;
  		}
- 	spin_unlock(&pdata->dyn_callback_lock);
+ 	spin_unlock_irqrestore(&pdata->dyn_callback_lock, flags);
  
  	return NULL;
  }
* Unmerged path drivers/hid/hid-sensor-hub.c
