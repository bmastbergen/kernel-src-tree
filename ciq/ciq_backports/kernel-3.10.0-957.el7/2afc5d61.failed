hv_netvsc: Use Windows version instead of NVSP version on GPAD teardown

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-957.el7
commit-author Mohammed Gamal <mgamal@redhat.com>
commit 2afc5d61a7197de25a61f54ea4ecfb4cb62b1d42
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-957.el7/2afc5d61.failed

When changing network interface settings, Windows guests
older than WS2016 can no longer shutdown. This was addressed
by commit 0ef58b0a05c12 ("hv_netvsc: change GPAD teardown order
on older versions"), however the issue also occurs on WS2012
guests that share NVSP protocol versions with WS2016 guests.
Hence we use Windows version directly to differentiate them.

Fixes: 0ef58b0a05c12 ("hv_netvsc: change GPAD teardown order on older versions")
	Signed-off-by: Mohammed Gamal <mgamal@redhat.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 2afc5d61a7197de25a61f54ea4ecfb4cb62b1d42)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/hyperv/netvsc.c
diff --cc drivers/net/hyperv/netvsc.c
index 1741fecf234a,d65b7fc6c4a4..000000000000
--- a/drivers/net/hyperv/netvsc.c
+++ b/drivers/net/hyperv/netvsc.c
@@@ -606,17 -589,15 +606,29 @@@ void netvsc_device_remove(struct hv_dev
  	 */
  	netdev_dbg(ndev, "net device safe to remove\n");
  
++<<<<<<< HEAD
 +	/* Now, we can close the channel safely */
 +	vmbus_close(device->channel);
 +
 +	/*
 +	 * If host is Win2016 or higher then we do the GPADL tear down
 +	 * here after VMBus is closed, instead of doing it earlier.
 +	 */
 +	if (vmbus_proto_version >= VERSION_WIN10) {
 +		netvsc_teardown_recv_buf_gpadl(device, net_device);
 +		netvsc_teardown_send_buf_gpadl(device, net_device);
 +	}
++=======
+ 	/* older versions require that buffer be revoked before close */
+ 	if (vmbus_proto_version < VERSION_WIN10)
+ 		netvsc_teardown_gpadl(device, net_device);
+ 
+ 	/* Now, we can close the channel safely */
+ 	vmbus_close(device->channel);
+ 
+ 	if (vmbus_proto_version >= VERSION_WIN10)
+ 		netvsc_teardown_gpadl(device, net_device);
++>>>>>>> 2afc5d61a719 (hv_netvsc: Use Windows version instead of NVSP version on GPAD teardown)
  
  	/* Release all resources */
  	free_netvsc_device_rcu(net_device);
* Unmerged path drivers/net/hyperv/netvsc.c
