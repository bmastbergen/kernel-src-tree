media: dvb_ca_en50221: prevent using slot_info for Spectre attacs

jira LE-1907
cve CVE-2018-3693
Rebuild_History Non-Buildable kernel-3.10.0-957.el7
Rebuild_CHGLOG: - [media] dvb_ca_en50221: prevent using slot_info for Spectre attacs (Lauro Ramos Venancio) [1589035] {CVE-2018-3693}
Rebuild_FUZZ: 94.31%
commit-author Mauro Carvalho Chehab <mchehab+samsung@kernel.org>
commit 4f5ab5d7a5e765ad231a132f82cec71de88b9aad
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-957.el7/4f5ab5d7.failed

slot can be controlled by user-space, hence leading to
a potential exploitation of the Spectre variant 1 vulnerability,
as warned by smatch:
	drivers/media/dvb-core/dvb_ca_en50221.c:1479 dvb_ca_en50221_io_write() warn: potential spectre issue 'ca->slot_info' (local cap)

	Acked-by: "Jasmin J." <jasmin@anw.at>
	Signed-off-by: Mauro Carvalho Chehab <mchehab+samsung@kernel.org>
(cherry picked from commit 4f5ab5d7a5e765ad231a132f82cec71de88b9aad)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/media/dvb-core/dvb_ca_en50221.c
diff --cc drivers/media/dvb-core/dvb_ca_en50221.c
index 0aac3096728e,1310526b0d49..000000000000
--- a/drivers/media/dvb-core/dvb_ca_en50221.c
+++ b/drivers/media/dvb-core/dvb_ca_en50221.c
@@@ -1309,8 -1475,13 +1310,16 @@@ static ssize_t dvb_ca_en50221_io_write(
  	buf += 2;
  	count -= 2;
  
++<<<<<<< HEAD
++=======
+ 	if (slot >= ca->slot_count)
+ 		return -EINVAL;
+ 	slot = array_index_nospec(slot, ca->slot_count);
+ 	sl = &ca->slot_info[slot];
+ 
++>>>>>>> 4f5ab5d7a5e7 (media: dvb_ca_en50221: prevent using slot_info for Spectre attacs)
  	/* check if the slot is actually running */
 -	if (sl->slot_state != DVB_CA_SLOTSTATE_RUNNING)
 +	if (ca->slot_info[slot].slot_state != DVB_CA_SLOTSTATE_RUNNING)
  		return -EINVAL;
  
  	/* fragment the packets & store in the buffer */
* Unmerged path drivers/media/dvb-core/dvb_ca_en50221.c
