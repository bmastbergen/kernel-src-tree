pci: use device_remove_file_self() instead of device_schedule_callback()

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-957.el7
Rebuild_CHGLOG: - [scsi] use device_remove_file_self() instead of device_schedule_callback() (Eda Zhou) [1585794]
Rebuild_FUZZ: 96.40%
commit-author Tejun Heo <tj@kernel.org>
commit 6716d289c437ad42dee455d241b29b71a816fbff
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-957.el7/6716d289.failed

driver-core now supports synchrnous self-deletion of attributes and
the asynchrnous removal mechanism is scheduled for removal.  Use it
instead of device_schedule_callback().  This makes "remove" behave
synchronously.

	Signed-off-by: Tejun Heo <tj@kernel.org>
	Cc: Bjorn Helgaas <bhelgaas@google.com>
	Cc: linux-pci@vger.kernel.org
	Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
(cherry picked from commit 6716d289c437ad42dee455d241b29b71a816fbff)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/pci/pci-sysfs.c
diff --cc drivers/pci/pci-sysfs.c
index cd5b1bc3eecd,94d1cb819eb6..000000000000
--- a/drivers/pci/pci-sysfs.c
+++ b/drivers/pci/pci-sysfs.c
@@@ -376,15 -352,10 +376,20 @@@ static struct device_attribute dev_resc
  							(S_IWUSR|S_IWGRP),
  							NULL, dev_rescan_store);
  
++<<<<<<< HEAD
 +static void remove_callback(struct device *dev)
 +{
 +	pci_stop_and_remove_bus_device_locked(to_pci_dev(dev));
 +}
 +
 +static ssize_t remove_store(struct device *dev, struct device_attribute *dummy,
 +			    const char *buf, size_t count)
++=======
+ static ssize_t
+ remove_store(struct device *dev, struct device_attribute *attr,
+ 	     const char *buf, size_t count)
++>>>>>>> 6716d289c437 (pci: use device_remove_file_self() instead of device_schedule_callback())
  {
- 	int ret = 0;
  	unsigned long val;
  
  	if (kstrtoul(buf, 0, &val) < 0)
* Unmerged path drivers/pci/pci-sysfs.c
