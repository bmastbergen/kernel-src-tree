ixgbe: Add support for macvlan offload RSS on X550 and clean-up pool handling

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-957.el7
commit-author Alexander Duyck <alexander.h.duyck@intel.com>
commit 2af62c56146d4be8bddc522ca75dae8234f5ac32
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-957.el7/2af62c56.failed

In order for RSS to work on the macvlan pools of the X550 we need to
populate the MRQC, RETA, and RSS key values for each pool. This patch makes
it so that we now take care of that.

In addition I have dropped the macvlan specific configuration of psrtype
since it is redundant with the code that already exists for configuring
this value.

	Signed-off-by: Alexander Duyck <alexander.h.duyck@intel.com>
	Tested-by: Andrew Bowers <andrewx.bowers@intel.com>
	Signed-off-by: Jeff Kirsher <jeffrey.t.kirsher@intel.com>
(cherry picked from commit 2af62c56146d4be8bddc522ca75dae8234f5ac32)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/intel/ixgbe/ixgbe_main.c
diff --cc drivers/net/ethernet/intel/ixgbe/ixgbe_main.c
index 6af8bd8690a7,5ccc3b6ccab1..000000000000
--- a/drivers/net/ethernet/intel/ixgbe/ixgbe_main.c
+++ b/drivers/net/ethernet/intel/ixgbe/ixgbe_main.c
@@@ -5117,29 -5282,6 +5129,32 @@@ static void ixgbe_macvlan_set_rx_mode(s
  	IXGBE_WRITE_REG(hw, IXGBE_VMOLR(pool), vmolr);
  }
  
++<<<<<<< HEAD
 +static void ixgbe_fwd_psrtype(struct ixgbe_fwd_adapter *vadapter)
 +{
 +	struct ixgbe_adapter *adapter = vadapter->real_adapter;
 +	int rss_i = vadapter->netdev->real_num_rx_queues;
 +	struct ixgbe_hw *hw = &adapter->hw;
 +	u16 pool = vadapter->pool;
 +	u32 psrtype = IXGBE_PSRTYPE_TCPHDR |
 +		      IXGBE_PSRTYPE_UDPHDR |
 +		      IXGBE_PSRTYPE_IPV4HDR |
 +		      IXGBE_PSRTYPE_L2HDR |
 +		      IXGBE_PSRTYPE_IPV6HDR;
 +
 +	if (hw->mac.type == ixgbe_mac_82598EB)
 +		return;
 +
 +	if (rss_i > 3)
 +		psrtype |= 2u << 29;
 +	else if (rss_i > 1)
 +		psrtype |= 1u << 29;
 +
 +	IXGBE_WRITE_REG(hw, IXGBE_PSRTYPE(VMDQ_P(pool)), psrtype);
 +}
 +
++=======
++>>>>>>> 2af62c56146d (ixgbe: Add support for macvlan offload RSS on X550 and clean-up pool handling)
  /**
   * ixgbe_clean_rx_ring - Free Rx Buffers per Queue
   * @rx_ring: ring to free buffers from
* Unmerged path drivers/net/ethernet/intel/ixgbe/ixgbe_main.c
