nfp: bpf: correct the encoding for No-Dest immed

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-957.el7
commit-author Jiong Wang <jiong.wang@netronome.com>
commit 3239e7bb28a8a4a96c36beeaa6439666e1ed4f8b
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-957.el7/3239e7bb.failed

When immed is used with No-Dest, the emitter should use reg.dst instead of
reg.areg for the destination, using the latter will actually encode
register zero.

	Signed-off-by: Jiong Wang <jiong.wang@netronome.com>
	Reviewed-by: Jakub Kicinski <jakub.kicinski@netronome.com>
	Signed-off-by: Daniel Borkmann <daniel@iogearbox.net>
(cherry picked from commit 3239e7bb28a8a4a96c36beeaa6439666e1ed4f8b)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/netronome/nfp/bpf/jit.c
diff --cc drivers/net/ethernet/netronome/nfp/bpf/jit.c
index 35648b968309,024b44089623..000000000000
--- a/drivers/net/ethernet/netronome/nfp/bpf/jit.c
+++ b/drivers/net/ethernet/netronome/nfp/bpf/jit.c
@@@ -273,8 -224,11 +273,16 @@@ emit_immed(struct nfp_prog *nfp_prog, s
  		return;
  	}
  
++<<<<<<< HEAD
 +	__emit_immed(nfp_prog, reg.areg, reg.breg, imm >> 8, width,
 +		     invert, shift, reg.wr_both);
++=======
+ 	/* Use reg.dst when destination is No-Dest. */
+ 	__emit_immed(nfp_prog,
+ 		     swreg_type(dst) == NN_REG_NONE ? reg.dst : reg.areg,
+ 		     reg.breg, imm >> 8, width, invert, shift,
+ 		     reg.wr_both, reg.dst_lmextn, reg.src_lmextn);
++>>>>>>> 3239e7bb28a8 (nfp: bpf: correct the encoding for No-Dest immed)
  }
  
  static void
* Unmerged path drivers/net/ethernet/netronome/nfp/bpf/jit.c
