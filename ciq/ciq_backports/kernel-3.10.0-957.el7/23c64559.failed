scsi: qla2xxx: Fix PRLI state check

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-957.el7
Rebuild_CHGLOG: - [scsi] qla2xxx: Fix PRLI state check (Himanshu Madhani) [1547714]
Rebuild_FUZZ: 90.62%
commit-author Quinn Tran <quinn.tran@cavium.com>
commit 23c645595dab7b414f23639d0a428a07515807df
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-957.el7/23c64559.failed

Get Port Database MBX cmd is to validate current Login state upon PRLI
completion. Current code looks at the last login state for re-validation
which was incorrect. This patch removed incorrect state check.

Fixes: 15f30a5752287 ("qla2xxx: Use IOCB interface to submit non-critical MBX.")
	Cc: <stable@vger.kernel.org> # 4.10+
	Signed-off-by: Quinn Tran <quinn.tran@cavium.com>
	Signed-off-by: Himanshu Madhani <himanshu.madhani@cavium.com>
	Reviewed-by: Hannes Reinecke <hare@suse.com>
	Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
(cherry picked from commit 23c645595dab7b414f23639d0a428a07515807df)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/scsi/qla2xxx/qla_mbx.c
diff --cc drivers/scsi/qla2xxx/qla_mbx.c
index 4649e83dd88d,e2b5fa47bb57..000000000000
--- a/drivers/scsi/qla2xxx/qla_mbx.c
+++ b/drivers/scsi/qla2xxx/qla_mbx.c
@@@ -5987,14 -6149,21 +5987,18 @@@ int __qla24xx_parse_gpdb(struct scsi_ql
  {
  	int rval = QLA_SUCCESS;
  	uint64_t zero = 0;
 -	u8 current_login_state, last_login_state;
 -
 -	if (fcport->fc4f_nvme) {
 -		current_login_state = pd->current_login_state >> 4;
 -		last_login_state = pd->last_login_state >> 4;
 -	} else {
 -		current_login_state = pd->current_login_state & 0xf;
 -		last_login_state = pd->last_login_state & 0xf;
 -	}
  
  	/* Check for logged in state. */
++<<<<<<< HEAD
 +	if (pd->current_login_state != PDS_PRLI_COMPLETE &&
 +		pd->last_login_state != PDS_PRLI_COMPLETE) {
++=======
+ 	if (current_login_state != PDS_PRLI_COMPLETE) {
++>>>>>>> 23c645595dab (scsi: qla2xxx: Fix PRLI state check)
  		ql_dbg(ql_dbg_mbx, vha, 0x119a,
  		    "Unable to verify login-state (%x/%x) for loop_id %x.\n",
 -		    current_login_state, last_login_state, fcport->loop_id);
 +		    pd->current_login_state, pd->last_login_state,
 +		    fcport->loop_id);
  		rval = QLA_FUNCTION_FAILED;
  		goto gpd_error_out;
  	}
* Unmerged path drivers/scsi/qla2xxx/qla_mbx.c
