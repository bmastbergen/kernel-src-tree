ipv6: fix IPV6_PKTINFO with v4 mapped

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-957.el7
commit-author Eric Dumazet <edumazet@google.com>
commit 5337b5b75cd9bd3624a6820e3c2a084d2480061c
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-957.el7/5337b5b7.failed

Use IS_ENABLED(CONFIG_IPV6), to enable this code if IPv6 is
a module.

	Signed-off-by: Eric Dumazet <edumazet@google.com>
Fixes: c8e6ad0829a7 ("ipv6: honor IPV6_PKTINFO with v4 mapped addresses on sendmsg")
	Acked-by: Hannes Frederic Sowa <hannes@stressinduktion.org>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 5337b5b75cd9bd3624a6820e3c2a084d2480061c)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/ipv4/ip_sockglue.c
diff --cc net/ipv4/ip_sockglue.c
index ac07084c45ef,9daf2177dc00..000000000000
--- a/net/ipv4/ip_sockglue.c
+++ b/net/ipv4/ip_sockglue.c
@@@ -194,6 -195,22 +194,25 @@@ int ip_cmsg_send(struct net *net, struc
  	for (cmsg = CMSG_FIRSTHDR(msg); cmsg; cmsg = CMSG_NXTHDR(msg, cmsg)) {
  		if (!CMSG_OK(msg, cmsg))
  			return -EINVAL;
++<<<<<<< HEAD
++=======
+ #if IS_ENABLED(CONFIG_IPV6)
+ 		if (allow_ipv6 &&
+ 		    cmsg->cmsg_level == SOL_IPV6 &&
+ 		    cmsg->cmsg_type == IPV6_PKTINFO) {
+ 			struct in6_pktinfo *src_info;
+ 
+ 			if (cmsg->cmsg_len < CMSG_LEN(sizeof(*src_info)))
+ 				return -EINVAL;
+ 			src_info = (struct in6_pktinfo *)CMSG_DATA(cmsg);
+ 			if (!ipv6_addr_v4mapped(&src_info->ipi6_addr))
+ 				return -EINVAL;
+ 			ipc->oif = src_info->ipi6_ifindex;
+ 			ipc->addr = src_info->ipi6_addr.s6_addr32[3];
+ 			continue;
+ 		}
+ #endif
++>>>>>>> 5337b5b75cd9 (ipv6: fix IPV6_PKTINFO with v4 mapped)
  		if (cmsg->cmsg_level != SOL_IP)
  			continue;
  		switch (cmsg->cmsg_type) {
* Unmerged path net/ipv4/ip_sockglue.c
