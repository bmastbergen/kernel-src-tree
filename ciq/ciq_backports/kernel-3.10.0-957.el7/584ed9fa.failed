md: raid10: remove VLAIS

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-957.el7
Rebuild_CHGLOG: - [md] raid10: remove VLAIS (Nigel Croxon) [1494474]
Rebuild_FUZZ: 90.91%
commit-author Matthias Kaehlcke <mka@chromium.org>
commit 584ed9fa9532f8b9d5955628ff87ee3b2ab9f5a9
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-957.el7/584ed9fa.failed

The raid10 driver can't be built with clang since it uses a variable
length array in a structure (VLAIS):

drivers/md/raid10.c:4583:17: error: fields must have a constant size:
  'variable length array in structure' extension will never be supported

Allocate the r10bio struct with kmalloc instead of using the VLAIS
construct.

Shaohua: set the MD_RECOVERY_INTR bit
Neil Brown: use GFP_NOIO

	Signed-off-by: Matthias Kaehlcke <mka@chromium.org>
	Reviewed-by: Guenter Roeck <groeck@chromium.org>
	Signed-off-by: Shaohua Li <shli@fb.com>
(cherry picked from commit 584ed9fa9532f8b9d5955628ff87ee3b2ab9f5a9)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/md/raid10.c
diff --cc drivers/md/raid10.c
index 17d84aee79e2,950fbefbedbb..000000000000
--- a/drivers/md/raid10.c
+++ b/drivers/md/raid10.c
@@@ -4731,14 -4578,20 +4731,24 @@@ static int handle_reshape_read_error(st
  	/* Use sync reads to get the blocks from somewhere else */
  	int sectors = r10_bio->sectors;
  	struct r10conf *conf = mddev->private;
- 	struct {
- 		struct r10bio r10_bio;
- 		struct r10dev devs[conf->copies];
- 	} on_stack;
- 	struct r10bio *r10b = &on_stack.r10_bio;
+ 	struct r10bio *r10b;
  	int slot = 0;
  	int idx = 0;
++<<<<<<< HEAD
 +	struct bio_vec *bvec = r10_bio->master_bio->bi_io_vec;
++=======
+ 	struct page **pages;
+ 
+ 	r10b = kmalloc(sizeof(*r10b) +
+ 	       sizeof(struct r10dev) * conf->copies, GFP_NOIO);
+ 	if (!r10b) {
+ 		set_bit(MD_RECOVERY_INTR, &mddev->recovery);
+ 		return -ENOMEM;
+ 	}
+ 
+ 	/* reshape IOs share pages from .devs[0].bio */
+ 	pages = get_resync_pages(r10_bio->devs[0].bio)->pages;
++>>>>>>> 584ed9fa9532 (md: raid10: remove VLAIS)
  
  	r10b->sector = r10_bio->sector;
  	__raid10_find_phys(&conf->prev, r10b);
* Unmerged path drivers/md/raid10.c
