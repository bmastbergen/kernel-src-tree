acpi: nfit: add persistent memory control flag for nd_region

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-957.el7
commit-author Dave Jiang <dave.jiang@intel.com>
commit 30e6d7bf29daa79d80711d35211c9b60894dbc44
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-957.el7/30e6d7bf.failed

Propagate the ADR attribute flag from the NFIT platform capabilities
sub-table to nd_region.

	Signed-off-by: Dave Jiang <dave.jiang@intel.com>
	Reviewed-by: Ross Zwisler <ross.zwisler@linux.intel.com>
	Signed-off-by: Ross Zwisler <ross.zwisler@linux.intel.com>
(cherry picked from commit 30e6d7bf29daa79d80711d35211c9b60894dbc44)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/acpi/nfit/core.c
#	include/linux/libnvdimm.h
diff --cc drivers/acpi/nfit/core.c
index b50d8cd25e0f,aa9d00db763a..000000000000
--- a/drivers/acpi/nfit/core.c
+++ b/drivers/acpi/nfit/core.c
@@@ -2613,6 -2672,12 +2613,15 @@@ static int acpi_nfit_register_region(st
  	else
  		ndr_desc->numa_node = NUMA_NO_NODE;
  
++<<<<<<< HEAD
++=======
+ 	if(acpi_desc->platform_cap & ACPI_NFIT_CAPABILITY_CACHE_FLUSH)
+ 		set_bit(ND_REGION_PERSIST_CACHE, &ndr_desc->flags);
+ 
+ 	if (acpi_desc->platform_cap & ACPI_NFIT_CAPABILITY_MEM_FLUSH)
+ 		set_bit(ND_REGION_PERSIST_MEMCTRL, &ndr_desc->flags);
+ 
++>>>>>>> 30e6d7bf29da (acpi: nfit: add persistent memory control flag for nd_region)
  	list_for_each_entry(nfit_memdev, &acpi_desc->memdevs, list) {
  		struct acpi_nfit_memory_map *memdev = nfit_memdev->memdev;
  		struct nd_mapping_desc *mapping;
diff --cc include/linux/libnvdimm.h
index a17c77f443ef,ff855ed965fb..000000000000
--- a/include/linux/libnvdimm.h
+++ b/include/linux/libnvdimm.h
@@@ -35,6 -47,17 +35,20 @@@ enum 
  
  	/* region flag indicating to direct-map persistent memory by default */
  	ND_REGION_PAGEMAP = 0,
++<<<<<<< HEAD
++=======
+ 	/*
+ 	 * Platform ensures entire CPU store data path is flushed to pmem on
+ 	 * system power loss.
+ 	 */
+ 	ND_REGION_PERSIST_CACHE = 1,
+ 	/*
+ 	 * Platform provides mechanisms to automatically flush outstanding
+ 	 * write data from memory controler to pmem on system power loss.
+ 	 * (ADR)
+ 	 */
+ 	ND_REGION_PERSIST_MEMCTRL = 2,
++>>>>>>> 30e6d7bf29da (acpi: nfit: add persistent memory control flag for nd_region)
  
  	/* mark newly adjusted resources as requiring a label update */
  	DPA_RESOURCE_ADJUSTED = 1 << 0,
* Unmerged path drivers/acpi/nfit/core.c
* Unmerged path include/linux/libnvdimm.h
