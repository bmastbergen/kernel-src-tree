mlxsw: spectrum: qdiscs: Clean qdisc statistics structs

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-957.el7
commit-author Nogah Frankel <nogahf@mellanox.com>
commit 4d1a4b8473a18babd6b29efdc12b93d7bbd2a097
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-957.el7/4d1a4b84.failed

Clean RED offloaded stats and make them more generic by breaking the
generic qdisc stats to a struct of their own.

	Signed-off-by: Nogah Frankel <nogahf@mellanox.com>
	Reviewed-by: Yuval Mintz <yuvalm@mellanox.com>
	Signed-off-by: Jiri Pirko <jiri@mellanox.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 4d1a4b8473a18babd6b29efdc12b93d7bbd2a097)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/mellanox/mlxsw/spectrum_qdisc.c
diff --cc drivers/net/ethernet/mellanox/mlxsw/spectrum_qdisc.c
index b5397da94d7f,0b6e553978b3..000000000000
--- a/drivers/net/ethernet/mellanox/mlxsw/spectrum_qdisc.c
+++ b/drivers/net/ethernet/mellanox/mlxsw/spectrum_qdisc.c
@@@ -41,6 -41,25 +41,28 @@@
  #include "spectrum.h"
  #include "reg.h"
  
++<<<<<<< HEAD
++=======
+ enum mlxsw_sp_qdisc_type {
+ 	MLXSW_SP_QDISC_NO_QDISC,
+ 	MLXSW_SP_QDISC_RED,
+ };
+ 
+ struct mlxsw_sp_qdisc {
+ 	u32 handle;
+ 	enum mlxsw_sp_qdisc_type type;
+ 	union {
+ 		struct red_stats red;
+ 	} xstats_base;
+ 	struct mlxsw_sp_qdisc_stats {
+ 		u64 tx_bytes;
+ 		u64 tx_packets;
+ 		u64 drops;
+ 		u64 overlimits;
+ 	} stats_base;
+ };
+ 
++>>>>>>> 4d1a4b8473a1 (mlxsw: spectrum: qdiscs: Clean qdisc statistics structs)
  static int
  mlxsw_sp_tclass_congestion_enable(struct mlxsw_sp_port *mlxsw_sp_port,
  				  int tclass_num, u32 min, u32 max,
@@@ -189,8 -209,9 +213,8 @@@ mlxsw_sp_qdisc_get_red_xstats(struct ml
  			      struct mlxsw_sp_qdisc *mlxsw_sp_qdisc,
  			      int tclass_num, struct red_stats *res)
  {
- 	struct red_stats *xstats_base = &mlxsw_sp_qdisc->xstats_base;
+ 	struct red_stats *xstats_base = &mlxsw_sp_qdisc->xstats_base.red;
  	struct mlxsw_sp_port_xstats *xstats;
 -	int early_drops, marks, pdrops;
  
  	if (mlxsw_sp_qdisc->handle != handle ||
  	    mlxsw_sp_qdisc->type != MLXSW_SP_QDISC_RED)
@@@ -208,9 -237,10 +232,10 @@@ static in
  mlxsw_sp_qdisc_get_red_stats(struct mlxsw_sp_port *mlxsw_sp_port, u32 handle,
  			     struct mlxsw_sp_qdisc *mlxsw_sp_qdisc,
  			     int tclass_num,
 -			     struct tc_qopt_offload_stats *res)
 +			     struct tc_red_qopt_offload_stats *res)
  {
  	u64 tx_bytes, tx_packets, overlimits, drops;
+ 	struct mlxsw_sp_qdisc_stats *stats_base;
  	struct mlxsw_sp_port_xstats *xstats;
  	struct rtnl_link_stats64 *stats;
  
* Unmerged path drivers/net/ethernet/mellanox/mlxsw/spectrum_qdisc.c
