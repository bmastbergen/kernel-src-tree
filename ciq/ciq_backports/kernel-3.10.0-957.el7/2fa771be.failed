ip6_tunnel: allow ip6gre dev mtu to be set below 1280

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-957.el7
commit-author Xin Long <lucien.xin@gmail.com>
commit 2fa771be953a17f8e0a9c39103464c2574444c62
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-957.el7/2fa771be.failed

Commit 582442d6d5bc ("ipv6: Allow the MTU of ipip6 tunnel to be set
below 1280") fixed a mtu setting issue. It works for ipip6 tunnel.

But ip6gre dev updates the mtu also with ip6_tnl_change_mtu. Since
the inner packet over ip6gre can be ipv4 and it's mtu should also
be allowed to set below 1280, the same issue also exists on ip6gre.

This patch is to fix it by simply changing to check if parms.proto
is IPPROTO_IPV6 in ip6_tnl_change_mtu instead, to make ip6gre to
go to 'else' branch.

	Signed-off-by: Xin Long <lucien.xin@gmail.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 2fa771be953a17f8e0a9c39103464c2574444c62)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/ipv6/ip6_tunnel.c
diff --cc net/ipv6/ip6_tunnel.c
index a12e6c346803,9a7cf355bc8c..000000000000
--- a/net/ipv6/ip6_tunnel.c
+++ b/net/ipv6/ip6_tunnel.c
@@@ -1569,11 -1677,11 +1569,16 @@@ int ip6_tnl_change_mtu(struct net_devic
  {
  	struct ip6_tnl *tnl = netdev_priv(dev);
  
++<<<<<<< HEAD
 +	if (tnl->parms.proto == IPPROTO_IPIP) {
 +		if (new_mtu < 68)
++=======
+ 	if (tnl->parms.proto == IPPROTO_IPV6) {
+ 		if (new_mtu < IPV6_MIN_MTU)
++>>>>>>> 2fa771be953a (ip6_tunnel: allow ip6gre dev mtu to be set below 1280)
  			return -EINVAL;
  	} else {
- 		if (new_mtu < IPV6_MIN_MTU)
+ 		if (new_mtu < ETH_MIN_MTU)
  			return -EINVAL;
  	}
  	if (new_mtu > 0xFFF8 - dev->hard_header_len)
* Unmerged path net/ipv6/ip6_tunnel.c
