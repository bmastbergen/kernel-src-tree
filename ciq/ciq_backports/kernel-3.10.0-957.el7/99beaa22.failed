net/mlx5e: Fix traffic between VF and representor

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-957.el7
commit-author Shahar Klein <shahark@mellanox.com>
commit 99beaa22f11152e128861f1c681744ca4749e9f8
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-957.el7/99beaa22.failed

After the cited commit, WQE RQ size is calculated based on sw_mtu but it
was not set for representors. This commit fixes that.

Fixes: 472a1e44b349 ("net/mlx5e: Save MTU in channels params")
	Signed-off-by: Shahar Klein <shahark@mellanox.com>
	Signed-off-by: Saeed Mahameed <saeedm@mellanox.com>
(cherry picked from commit 99beaa22f11152e128861f1c681744ca4749e9f8)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/mellanox/mlx5/core/en_rep.c
diff --cc drivers/net/ethernet/mellanox/mlx5/core/en_rep.c
index 21475fbee7ea,876c3e4c6193..000000000000
--- a/drivers/net/ethernet/mellanox/mlx5/core/en_rep.c
+++ b/drivers/net/ethernet/mellanox/mlx5/core/en_rep.c
@@@ -893,14 -883,15 +893,19 @@@ static void mlx5e_build_rep_params(stru
  					 MLX5_CQ_PERIOD_MODE_START_FROM_CQE :
  					 MLX5_CQ_PERIOD_MODE_START_FROM_EQE;
  
++<<<<<<< HEAD
++=======
+ 	params->hard_mtu    = MLX5E_ETH_HARD_MTU;
+ 	params->sw_mtu      = mtu;
++>>>>>>> 99beaa22f111 (net/mlx5e: Fix traffic between VF and representor)
  	params->log_sq_size = MLX5E_REP_PARAMS_LOG_SQ_SIZE;
  	params->rq_wq_type  = MLX5_WQ_TYPE_LINKED_LIST;
 -	params->log_rq_mtu_frames = MLX5E_REP_PARAMS_LOG_RQ_SIZE;
 +	params->log_rq_size = MLX5E_REP_PARAMS_LOG_RQ_SIZE;
  
 -	params->rx_dim_enabled = MLX5_CAP_GEN(mdev, cq_moderation);
 +	params->rx_am_enabled = MLX5_CAP_GEN(mdev, cq_moderation);
  	mlx5e_set_rx_cq_mode_params(params, cq_period_mode);
  
 +	params->tx_max_inline         = mlx5e_get_max_inline_cap(mdev);
  	params->num_tc                = 1;
  	params->lro_wqe_sz            = MLX5E_PARAMS_DEFAULT_LRO_WQE_SZ;
  
@@@ -941,9 -932,7 +946,13 @@@ static void mlx5e_init_rep(struct mlx5_
  
  	priv->channels.params.num_channels = profile->max_nch(mdev);
  
++<<<<<<< HEAD
 +	priv->hard_mtu = MLX5E_ETH_HARD_MTU;
 +
 +	mlx5e_build_rep_params(mdev, &priv->channels.params);
++=======
+ 	mlx5e_build_rep_params(mdev, &priv->channels.params, netdev->mtu);
++>>>>>>> 99beaa22f111 (net/mlx5e: Fix traffic between VF and representor)
  	mlx5e_build_rep_netdev(netdev);
  
  	mlx5e_timestamp_init(priv);
* Unmerged path drivers/net/ethernet/mellanox/mlx5/core/en_rep.c
