xfs: refactor the ifork block counting function

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-957.el7
commit-author Darrick J. Wong <darrick.wong@oracle.com>
commit e7f5d5ca36e29fa3c9702f236b0ab73f63336080
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-957.el7/e7f5d5ca.failed

Refactor the inode fork block counting function to count extents for us
at the same time.  This will be used by the bmbt scrubber function.

	Signed-off-by: Darrick J. Wong <darrick.wong@oracle.com>
	Reviewed-by: Brian Foster <bfoster@redhat.com>
(cherry picked from commit e7f5d5ca36e29fa3c9702f236b0ab73f63336080)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	fs/xfs/xfs_bmap_util.c
diff --cc fs/xfs/xfs_bmap_util.c
index 0b3f80aeee5c,93e955262d07..000000000000
--- a/fs/xfs/xfs_bmap_util.c
+++ b/fs/xfs/xfs_bmap_util.c
@@@ -1459,11 -1813,12 +1481,19 @@@ xfs_swap_extent_forks
  	int			*src_log_flags,
  	int			*target_log_flags)
  {
 +	xfs_extnum_t		nextents;
  	struct xfs_ifork	tempifp, *ifp, *tifp;
++<<<<<<< HEAD
 +	int			aforkblks = 0;
 +	int			taforkblks = 0;
 +	__uint64_t		tmp;
++=======
+ 	xfs_filblks_t		aforkblks = 0;
+ 	xfs_filblks_t		taforkblks = 0;
+ 	xfs_extnum_t		junk;
+ 	xfs_extnum_t		nextents;
+ 	uint64_t		tmp;
++>>>>>>> e7f5d5ca36e2 (xfs: refactor the ifork block counting function)
  	int			error;
  
  	/*
* Unmerged path fs/xfs/xfs_bmap_util.c
diff --git a/fs/xfs/xfs_bmap_util.h b/fs/xfs/xfs_bmap_util.h
index c2c3216cdef3..4299313a4ec9 100644
--- a/fs/xfs/xfs_bmap_util.h
+++ b/fs/xfs/xfs_bmap_util.h
@@ -68,4 +68,8 @@ int	xfs_swap_extents(struct xfs_inode *ip, struct xfs_inode *tip,
 
 xfs_daddr_t xfs_fsb_to_db(struct xfs_inode *ip, xfs_fsblock_t fsb);
 
+int xfs_bmap_count_blocks(struct xfs_trans *tp, struct xfs_inode *ip,
+			  int whichfork, xfs_extnum_t *nextents,
+			  xfs_filblks_t *count);
+
 #endif	/* __XFS_BMAP_UTIL_H__ */
