drm/nouveau/gr/gf100-: virtualise init_vsc_stream_master

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-957.el7
commit-author Ben Skeggs <bskeggs@redhat.com>
commit 2fe5ff6371350ce224dc2cc1da0e01888a1f9999
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-957.el7/2fe5ff63.failed

	Signed-off-by: Ben Skeggs <bskeggs@redhat.com>
(cherry picked from commit 2fe5ff6371350ce224dc2cc1da0e01888a1f9999)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/gpu/drm/nouveau/nvkm/engine/gr/gf100.c
#	drivers/gpu/drm/nouveau/nvkm/engine/gr/gf100.h
#	drivers/gpu/drm/nouveau/nvkm/engine/gr/gf104.c
#	drivers/gpu/drm/nouveau/nvkm/engine/gr/gf108.c
#	drivers/gpu/drm/nouveau/nvkm/engine/gr/gf110.c
#	drivers/gpu/drm/nouveau/nvkm/engine/gr/gf117.c
#	drivers/gpu/drm/nouveau/nvkm/engine/gr/gf119.c
#	drivers/gpu/drm/nouveau/nvkm/engine/gr/gk104.c
#	drivers/gpu/drm/nouveau/nvkm/engine/gr/gk110.c
#	drivers/gpu/drm/nouveau/nvkm/engine/gr/gk110b.c
#	drivers/gpu/drm/nouveau/nvkm/engine/gr/gk208.c
#	drivers/gpu/drm/nouveau/nvkm/engine/gr/gm107.c
#	drivers/gpu/drm/nouveau/nvkm/engine/gr/gm200.c
diff --cc drivers/gpu/drm/nouveau/nvkm/engine/gr/gf100.c
index 5d64fed84507,0c92b8c6375a..000000000000
--- a/drivers/gpu/drm/nouveau/nvkm/engine/gr/gf100.c
+++ b/drivers/gpu/drm/nouveau/nvkm/engine/gr/gf100.c
@@@ -1903,6 -1914,29 +1903,32 @@@ gf100_gr_new_(const struct gf100_gr_fun
  	return 0;
  }
  
++<<<<<<< HEAD
++=======
+ void
+ gf100_gr_init_gpc_mmu(struct gf100_gr *gr)
+ {
+ 	struct nvkm_device *device = gr->base.engine.subdev.device;
+ 	struct nvkm_fb *fb = device->fb;
+ 
+ 	nvkm_wr32(device, 0x418880, nvkm_rd32(device, 0x100c80) & 0x00000001);
+ 	nvkm_wr32(device, 0x4188a4, 0x03000000);
+ 	nvkm_wr32(device, 0x418888, 0x00000000);
+ 	nvkm_wr32(device, 0x41888c, 0x00000000);
+ 	nvkm_wr32(device, 0x418890, 0x00000000);
+ 	nvkm_wr32(device, 0x418894, 0x00000000);
+ 	nvkm_wr32(device, 0x4188b4, nvkm_memory_addr(fb->mmu_wr) >> 8);
+ 	nvkm_wr32(device, 0x4188b8, nvkm_memory_addr(fb->mmu_rd) >> 8);
+ }
+ 
+ void
+ gf100_gr_init_vsc_stream_master(struct gf100_gr *gr)
+ {
+ 	struct nvkm_device *device = gr->base.engine.subdev.device;
+ 	nvkm_mask(device, TPC_UNIT(0, 0, 0x05c), 0x00000001, 0x00000001);
+ }
+ 
++>>>>>>> 2fe5ff637135 (drm/nouveau/gr/gf100-: virtualise init_vsc_stream_master)
  int
  gf100_gr_init(struct gf100_gr *gr)
  {
@@@ -1928,7 -1954,16 +1954,20 @@@
  	else
  		gf100_gr_mmio(gr, gr->func->mmio);
  
++<<<<<<< HEAD
 +	nvkm_mask(device, TPC_UNIT(0, 0, 0x05c), 0x00000001, 0x00000001);
++=======
+ 	if (gr->func->init_r405a14)
+ 		gr->func->init_r405a14(gr);
+ 
+ 	if (gr->func->clkgate_pack)
+ 		nvkm_therm_clkgate_init(device->therm, gr->func->clkgate_pack);
+ 
+ 	if (gr->func->init_bios)
+ 		gr->func->init_bios(gr);
+ 
+ 	gr->func->init_vsc_stream_master(gr);
++>>>>>>> 2fe5ff637135 (drm/nouveau/gr/gf100-: virtualise init_vsc_stream_master)
  
  	memcpy(tpcnr, gr->tpc_nr, sizeof(gr->tpc_nr));
  	for (i = 0, gpc = -1; i < gr->tpc_total; i++) {
@@@ -2039,6 -2074,8 +2078,11 @@@ gf100_gr_gpccs_ucode = 
  static const struct gf100_gr_func
  gf100_gr = {
  	.init = gf100_gr_init,
++<<<<<<< HEAD
++=======
+ 	.init_gpc_mmu = gf100_gr_init_gpc_mmu,
+ 	.init_vsc_stream_master = gf100_gr_init_vsc_stream_master,
++>>>>>>> 2fe5ff637135 (drm/nouveau/gr/gf100-: virtualise init_vsc_stream_master)
  	.mmio = gf100_gr_pack_mmio,
  	.fecs.ucode = &gf100_gr_fecs_ucode,
  	.gpccs.ucode = &gf100_gr_gpccs_ucode,
diff --cc drivers/gpu/drm/nouveau/nvkm/engine/gr/gf100.h
index a36e45a4a635,45792a33fd65..000000000000
--- a/drivers/gpu/drm/nouveau/nvkm/engine/gr/gf100.h
+++ b/drivers/gpu/drm/nouveau/nvkm/engine/gr/gf100.h
@@@ -122,6 -122,9 +122,12 @@@ struct gf100_gr_func 
  	void (*dtor)(struct gf100_gr *);
  	int (*init)(struct gf100_gr *);
  	void (*init_gpc_mmu)(struct gf100_gr *);
++<<<<<<< HEAD
++=======
+ 	void (*init_r405a14)(struct gf100_gr *);
+ 	void (*init_bios)(struct gf100_gr *);
+ 	void (*init_vsc_stream_master)(struct gf100_gr *);
++>>>>>>> 2fe5ff637135 (drm/nouveau/gr/gf100-: virtualise init_vsc_stream_master)
  	void (*init_rop_active_fbps)(struct gf100_gr *);
  	void (*init_ppc_exceptions)(struct gf100_gr *);
  	void (*init_swdx_pes_mask)(struct gf100_gr *);
diff --cc drivers/gpu/drm/nouveau/nvkm/engine/gr/gf104.c
index d736dcd55ea2,61b27b179e15..000000000000
--- a/drivers/gpu/drm/nouveau/nvkm/engine/gr/gf104.c
+++ b/drivers/gpu/drm/nouveau/nvkm/engine/gr/gf104.c
@@@ -115,6 -115,8 +115,11 @@@ gf104_gr_pack_mmio[] = 
  static const struct gf100_gr_func
  gf104_gr = {
  	.init = gf100_gr_init,
++<<<<<<< HEAD
++=======
+ 	.init_gpc_mmu = gf100_gr_init_gpc_mmu,
+ 	.init_vsc_stream_master = gf100_gr_init_vsc_stream_master,
++>>>>>>> 2fe5ff637135 (drm/nouveau/gr/gf100-: virtualise init_vsc_stream_master)
  	.mmio = gf104_gr_pack_mmio,
  	.fecs.ucode = &gf100_gr_fecs_ucode,
  	.gpccs.ucode = &gf100_gr_gpccs_ucode,
diff --cc drivers/gpu/drm/nouveau/nvkm/engine/gr/gf108.c
index 2f0d24498427,992727f79439..000000000000
--- a/drivers/gpu/drm/nouveau/nvkm/engine/gr/gf108.c
+++ b/drivers/gpu/drm/nouveau/nvkm/engine/gr/gf108.c
@@@ -106,6 -106,15 +106,12 @@@ gf108_gr_pack_mmio[] = 
  static const struct gf100_gr_func
  gf108_gr = {
  	.init = gf100_gr_init,
++<<<<<<< HEAD
++=======
+ 	.init_gpc_mmu = gf100_gr_init_gpc_mmu,
+ 	.init_r405a14 = gf108_gr_init_r405a14,
+ 	.init_vsc_stream_master = gf100_gr_init_vsc_stream_master,
++>>>>>>> 2fe5ff637135 (drm/nouveau/gr/gf100-: virtualise init_vsc_stream_master)
  	.mmio = gf108_gr_pack_mmio,
  	.fecs.ucode = &gf100_gr_fecs_ucode,
  	.gpccs.ucode = &gf100_gr_gpccs_ucode,
diff --cc drivers/gpu/drm/nouveau/nvkm/engine/gr/gf110.c
index d1d942eb86af,07a57cc5074f..000000000000
--- a/drivers/gpu/drm/nouveau/nvkm/engine/gr/gf110.c
+++ b/drivers/gpu/drm/nouveau/nvkm/engine/gr/gf110.c
@@@ -87,6 -87,8 +87,11 @@@ gf110_gr_pack_mmio[] = 
  static const struct gf100_gr_func
  gf110_gr = {
  	.init = gf100_gr_init,
++<<<<<<< HEAD
++=======
+ 	.init_gpc_mmu = gf100_gr_init_gpc_mmu,
+ 	.init_vsc_stream_master = gf100_gr_init_vsc_stream_master,
++>>>>>>> 2fe5ff637135 (drm/nouveau/gr/gf100-: virtualise init_vsc_stream_master)
  	.mmio = gf110_gr_pack_mmio,
  	.fecs.ucode = &gf100_gr_fecs_ucode,
  	.gpccs.ucode = &gf100_gr_gpccs_ucode,
diff --cc drivers/gpu/drm/nouveau/nvkm/engine/gr/gf117.c
index 0124e468086e,29ab01be71ec..000000000000
--- a/drivers/gpu/drm/nouveau/nvkm/engine/gr/gf117.c
+++ b/drivers/gpu/drm/nouveau/nvkm/engine/gr/gf117.c
@@@ -123,6 -123,8 +123,11 @@@ gf117_gr_gpccs_ucode = 
  static const struct gf100_gr_func
  gf117_gr = {
  	.init = gf100_gr_init,
++<<<<<<< HEAD
++=======
+ 	.init_gpc_mmu = gf100_gr_init_gpc_mmu,
+ 	.init_vsc_stream_master = gf100_gr_init_vsc_stream_master,
++>>>>>>> 2fe5ff637135 (drm/nouveau/gr/gf100-: virtualise init_vsc_stream_master)
  	.mmio = gf117_gr_pack_mmio,
  	.fecs.ucode = &gf117_gr_fecs_ucode,
  	.gpccs.ucode = &gf117_gr_gpccs_ucode,
diff --cc drivers/gpu/drm/nouveau/nvkm/engine/gr/gf119.c
index 8d8e4cafe28f,d3b06dd7702d..000000000000
--- a/drivers/gpu/drm/nouveau/nvkm/engine/gr/gf119.c
+++ b/drivers/gpu/drm/nouveau/nvkm/engine/gr/gf119.c
@@@ -178,6 -178,8 +178,11 @@@ gf119_gr_pack_mmio[] = 
  static const struct gf100_gr_func
  gf119_gr = {
  	.init = gf100_gr_init,
++<<<<<<< HEAD
++=======
+ 	.init_gpc_mmu = gf100_gr_init_gpc_mmu,
+ 	.init_vsc_stream_master = gf100_gr_init_vsc_stream_master,
++>>>>>>> 2fe5ff637135 (drm/nouveau/gr/gf100-: virtualise init_vsc_stream_master)
  	.mmio = gf119_gr_pack_mmio,
  	.fecs.ucode = &gf100_gr_fecs_ucode,
  	.gpccs.ucode = &gf100_gr_gpccs_ucode,
diff --cc drivers/gpu/drm/nouveau/nvkm/engine/gr/gk104.c
index ec22da6c99fc,835f498d6b98..000000000000
--- a/drivers/gpu/drm/nouveau/nvkm/engine/gr/gk104.c
+++ b/drivers/gpu/drm/nouveau/nvkm/engine/gr/gk104.c
@@@ -214,18 -421,14 +221,18 @@@ gk104_gr_init(struct gf100_gr *gr
  	int gpc, tpc, rop;
  	int i;
  
 -	gr->func->init_gpc_mmu(gr);
 +	nvkm_wr32(device, GPC_BCAST(0x0880), 0x00000000);
 +	nvkm_wr32(device, GPC_BCAST(0x08a4), 0x00000000);
 +	nvkm_wr32(device, GPC_BCAST(0x0888), 0x00000000);
 +	nvkm_wr32(device, GPC_BCAST(0x088c), 0x00000000);
 +	nvkm_wr32(device, GPC_BCAST(0x0890), 0x00000000);
 +	nvkm_wr32(device, GPC_BCAST(0x0894), 0x00000000);
 +	nvkm_wr32(device, GPC_BCAST(0x08b4), nvkm_memory_addr(fb->mmu_wr) >> 8);
 +	nvkm_wr32(device, GPC_BCAST(0x08b8), nvkm_memory_addr(fb->mmu_rd) >> 8);
  
  	gf100_gr_mmio(gr, gr->func->mmio);
 -	if (gr->func->clkgate_pack)
 -		nvkm_therm_clkgate_init(gr->base.engine.subdev.device->therm,
 -					gr->func->clkgate_pack);
  
- 	nvkm_wr32(device, GPC_UNIT(0, 0x3018), 0x00000001);
+ 	gr->func->init_vsc_stream_master(gr);
  
  	memset(data, 0x00, sizeof(data));
  	memcpy(tpcnr, gr->tpc_nr, sizeof(gr->tpc_nr));
@@@ -339,6 -542,8 +346,11 @@@ gk104_gr_gpccs_ucode = 
  static const struct gf100_gr_func
  gk104_gr = {
  	.init = gk104_gr_init,
++<<<<<<< HEAD
++=======
+ 	.init_gpc_mmu = gf100_gr_init_gpc_mmu,
+ 	.init_vsc_stream_master = gk104_gr_init_vsc_stream_master,
++>>>>>>> 2fe5ff637135 (drm/nouveau/gr/gf100-: virtualise init_vsc_stream_master)
  	.init_rop_active_fbps = gk104_gr_init_rop_active_fbps,
  	.init_ppc_exceptions = gk104_gr_init_ppc_exceptions,
  	.mmio = gk104_gr_pack_mmio,
diff --cc drivers/gpu/drm/nouveau/nvkm/engine/gr/gk110.c
index f31b171a4102,eef7476e0ee8..000000000000
--- a/drivers/gpu/drm/nouveau/nvkm/engine/gr/gk110.c
+++ b/drivers/gpu/drm/nouveau/nvkm/engine/gr/gk110.c
@@@ -183,6 -337,8 +183,11 @@@ gk110_gr_gpccs_ucode = 
  static const struct gf100_gr_func
  gk110_gr = {
  	.init = gk104_gr_init,
++<<<<<<< HEAD
++=======
+ 	.init_gpc_mmu = gf100_gr_init_gpc_mmu,
+ 	.init_vsc_stream_master = gk104_gr_init_vsc_stream_master,
++>>>>>>> 2fe5ff637135 (drm/nouveau/gr/gf100-: virtualise init_vsc_stream_master)
  	.init_rop_active_fbps = gk104_gr_init_rop_active_fbps,
  	.init_ppc_exceptions = gk104_gr_init_ppc_exceptions,
  	.mmio = gk110_gr_pack_mmio,
diff --cc drivers/gpu/drm/nouveau/nvkm/engine/gr/gk110b.c
index d76dd178007f,ed4361a830a5..000000000000
--- a/drivers/gpu/drm/nouveau/nvkm/engine/gr/gk110b.c
+++ b/drivers/gpu/drm/nouveau/nvkm/engine/gr/gk110b.c
@@@ -103,6 -103,8 +103,11 @@@ gk110b_gr_pack_mmio[] = 
  static const struct gf100_gr_func
  gk110b_gr = {
  	.init = gk104_gr_init,
++<<<<<<< HEAD
++=======
+ 	.init_gpc_mmu = gf100_gr_init_gpc_mmu,
+ 	.init_vsc_stream_master = gk104_gr_init_vsc_stream_master,
++>>>>>>> 2fe5ff637135 (drm/nouveau/gr/gf100-: virtualise init_vsc_stream_master)
  	.init_rop_active_fbps = gk104_gr_init_rop_active_fbps,
  	.init_ppc_exceptions = gk104_gr_init_ppc_exceptions,
  	.mmio = gk110b_gr_pack_mmio,
diff --cc drivers/gpu/drm/nouveau/nvkm/engine/gr/gk208.c
index 14bbe6ed02a9,4c8beb9c1708..000000000000
--- a/drivers/gpu/drm/nouveau/nvkm/engine/gr/gk208.c
+++ b/drivers/gpu/drm/nouveau/nvkm/engine/gr/gk208.c
@@@ -162,6 -162,8 +162,11 @@@ gk208_gr_gpccs_ucode = 
  static const struct gf100_gr_func
  gk208_gr = {
  	.init = gk104_gr_init,
++<<<<<<< HEAD
++=======
+ 	.init_gpc_mmu = gf100_gr_init_gpc_mmu,
+ 	.init_vsc_stream_master = gk104_gr_init_vsc_stream_master,
++>>>>>>> 2fe5ff637135 (drm/nouveau/gr/gf100-: virtualise init_vsc_stream_master)
  	.init_rop_active_fbps = gk104_gr_init_rop_active_fbps,
  	.init_ppc_exceptions = gk104_gr_init_ppc_exceptions,
  	.mmio = gk208_gr_pack_mmio,
diff --cc drivers/gpu/drm/nouveau/nvkm/engine/gr/gm107.c
index 2c67fac576d1,58c03d6c1c2d..000000000000
--- a/drivers/gpu/drm/nouveau/nvkm/engine/gr/gm107.c
+++ b/drivers/gpu/drm/nouveau/nvkm/engine/gr/gm107.c
@@@ -327,9 -335,9 +327,9 @@@ gm107_gr_init(struct gf100_gr *gr
  
  	gf100_gr_mmio(gr, gr->func->mmio);
  
 -	gr->func->init_bios(gr);
 +	gm107_gr_init_bios(gr);
  
- 	nvkm_wr32(device, GPC_UNIT(0, 0x3018), 0x00000001);
+ 	gr->func->init_vsc_stream_master(gr);
  
  	memset(data, 0x00, sizeof(data));
  	memcpy(tpcnr, gr->tpc_nr, sizeof(gr->tpc_nr));
@@@ -442,6 -450,9 +442,12 @@@ gm107_gr_gpccs_ucode = 
  static const struct gf100_gr_func
  gm107_gr = {
  	.init = gm107_gr_init,
++<<<<<<< HEAD
++=======
+ 	.init_gpc_mmu = gm107_gr_init_gpc_mmu,
+ 	.init_bios = gm107_gr_init_bios,
+ 	.init_vsc_stream_master = gk104_gr_init_vsc_stream_master,
++>>>>>>> 2fe5ff637135 (drm/nouveau/gr/gf100-: virtualise init_vsc_stream_master)
  	.init_rop_active_fbps = gk104_gr_init_rop_active_fbps,
  	.init_ppc_exceptions = gk104_gr_init_ppc_exceptions,
  	.mmio = gm107_gr_pack_mmio,
diff --cc drivers/gpu/drm/nouveau/nvkm/engine/gr/gm200.c
index 6435f1257572,8583aad367af..000000000000
--- a/drivers/gpu/drm/nouveau/nvkm/engine/gr/gm200.c
+++ b/drivers/gpu/drm/nouveau/nvkm/engine/gr/gm200.c
@@@ -75,9 -75,9 +75,9 @@@ gm200_gr_init(struct gf100_gr *gr
  
  	gf100_gr_mmio(gr, gr->fuc_sw_nonctx);
  
 -	gr->func->init_bios(gr);
 +	gm107_gr_init_bios(gr);
  
- 	nvkm_wr32(device, GPC_UNIT(0, 0x3018), 0x00000001);
+ 	gr->func->init_vsc_stream_master(gr);
  
  	memset(data, 0x00, sizeof(data));
  	memcpy(tpcnr, gr->tpc_nr, sizeof(gr->tpc_nr));
@@@ -210,6 -210,8 +210,11 @@@ static const struct gf100_gr_fun
  gm200_gr = {
  	.init = gm200_gr_init,
  	.init_gpc_mmu = gm200_gr_init_gpc_mmu,
++<<<<<<< HEAD
++=======
+ 	.init_bios = gm107_gr_init_bios,
+ 	.init_vsc_stream_master = gk104_gr_init_vsc_stream_master,
++>>>>>>> 2fe5ff637135 (drm/nouveau/gr/gf100-: virtualise init_vsc_stream_master)
  	.init_rop_active_fbps = gm200_gr_init_rop_active_fbps,
  	.init_ppc_exceptions = gk104_gr_init_ppc_exceptions,
  	.rops = gm200_gr_rops,
* Unmerged path drivers/gpu/drm/nouveau/nvkm/engine/gr/gf100.c
* Unmerged path drivers/gpu/drm/nouveau/nvkm/engine/gr/gf100.h
* Unmerged path drivers/gpu/drm/nouveau/nvkm/engine/gr/gf104.c
* Unmerged path drivers/gpu/drm/nouveau/nvkm/engine/gr/gf108.c
* Unmerged path drivers/gpu/drm/nouveau/nvkm/engine/gr/gf110.c
* Unmerged path drivers/gpu/drm/nouveau/nvkm/engine/gr/gf117.c
* Unmerged path drivers/gpu/drm/nouveau/nvkm/engine/gr/gf119.c
* Unmerged path drivers/gpu/drm/nouveau/nvkm/engine/gr/gk104.c
* Unmerged path drivers/gpu/drm/nouveau/nvkm/engine/gr/gk110.c
* Unmerged path drivers/gpu/drm/nouveau/nvkm/engine/gr/gk110b.c
* Unmerged path drivers/gpu/drm/nouveau/nvkm/engine/gr/gk208.c
* Unmerged path drivers/gpu/drm/nouveau/nvkm/engine/gr/gm107.c
* Unmerged path drivers/gpu/drm/nouveau/nvkm/engine/gr/gm200.c
diff --git a/drivers/gpu/drm/nouveau/nvkm/engine/gr/gp100.c b/drivers/gpu/drm/nouveau/nvkm/engine/gr/gp100.c
index 867a5f7cc5bc..edaaebbe7613 100644
--- a/drivers/gpu/drm/nouveau/nvkm/engine/gr/gp100.c
+++ b/drivers/gpu/drm/nouveau/nvkm/engine/gr/gp100.c
@@ -63,7 +63,7 @@ gp100_gr_init(struct gf100_gr *gr)
 
 	gf100_gr_mmio(gr, gr->fuc_sw_nonctx);
 
-	nvkm_wr32(device, GPC_UNIT(0, 0x3018), 0x00000001);
+	gr->func->init_vsc_stream_master(gr);
 
 	memset(data, 0x00, sizeof(data));
 	memcpy(tpcnr, gr->tpc_nr, sizeof(gr->tpc_nr));
@@ -160,6 +160,7 @@ static const struct gf100_gr_func
 gp100_gr = {
 	.init = gp100_gr_init,
 	.init_gpc_mmu = gm200_gr_init_gpc_mmu,
+	.init_vsc_stream_master = gk104_gr_init_vsc_stream_master,
 	.init_rop_active_fbps = gp100_gr_init_rop_active_fbps,
 	.init_ppc_exceptions = gk104_gr_init_ppc_exceptions,
 	.init_num_active_ltcs = gp100_gr_init_num_active_ltcs,
diff --git a/drivers/gpu/drm/nouveau/nvkm/engine/gr/gp102.c b/drivers/gpu/drm/nouveau/nvkm/engine/gr/gp102.c
index 61e3a0b08559..821a6c4589e2 100644
--- a/drivers/gpu/drm/nouveau/nvkm/engine/gr/gp102.c
+++ b/drivers/gpu/drm/nouveau/nvkm/engine/gr/gp102.c
@@ -44,6 +44,7 @@ static const struct gf100_gr_func
 gp102_gr = {
 	.init = gp100_gr_init,
 	.init_gpc_mmu = gm200_gr_init_gpc_mmu,
+	.init_vsc_stream_master = gk104_gr_init_vsc_stream_master,
 	.init_rop_active_fbps = gp100_gr_init_rop_active_fbps,
 	.init_ppc_exceptions = gk104_gr_init_ppc_exceptions,
 	.init_swdx_pes_mask = gp102_gr_init_swdx_pes_mask,
diff --git a/drivers/gpu/drm/nouveau/nvkm/engine/gr/gp107.c b/drivers/gpu/drm/nouveau/nvkm/engine/gr/gp107.c
index f7272323f694..e2e12975bb2c 100644
--- a/drivers/gpu/drm/nouveau/nvkm/engine/gr/gp107.c
+++ b/drivers/gpu/drm/nouveau/nvkm/engine/gr/gp107.c
@@ -30,6 +30,7 @@ static const struct gf100_gr_func
 gp107_gr = {
 	.init = gp100_gr_init,
 	.init_gpc_mmu = gm200_gr_init_gpc_mmu,
+	.init_vsc_stream_master = gk104_gr_init_vsc_stream_master,
 	.init_rop_active_fbps = gp100_gr_init_rop_active_fbps,
 	.init_ppc_exceptions = gk104_gr_init_ppc_exceptions,
 	.init_swdx_pes_mask = gp102_gr_init_swdx_pes_mask,
diff --git a/drivers/gpu/drm/nouveau/nvkm/engine/gr/gp10b.c b/drivers/gpu/drm/nouveau/nvkm/engine/gr/gp10b.c
index 5f3d161a0842..e90cc3c845ec 100644
--- a/drivers/gpu/drm/nouveau/nvkm/engine/gr/gp10b.c
+++ b/drivers/gpu/drm/nouveau/nvkm/engine/gr/gp10b.c
@@ -37,6 +37,7 @@ static const struct gf100_gr_func
 gp10b_gr = {
 	.init = gp100_gr_init,
 	.init_gpc_mmu = gm200_gr_init_gpc_mmu,
+	.init_vsc_stream_master = gk104_gr_init_vsc_stream_master,
 	.init_rop_active_fbps = gp100_gr_init_rop_active_fbps,
 	.init_ppc_exceptions = gk104_gr_init_ppc_exceptions,
 	.init_num_active_ltcs = gp10b_gr_init_num_active_ltcs,
