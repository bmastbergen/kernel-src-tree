netfilter: ipset: use nfnl_mutex_is_locked

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-957.el7
commit-author Florian Westphal <fw@strlen.de>
commit 49971b8853f576f4252cbc8fc3df8173d7a56de3
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-957.el7/49971b88.failed

Check that we really hold nfnl mutex here instead of relying on correct
usage alone.

	Signed-off-by: Florian Westphal <fw@strlen.de>
	Acked-by: Jozsef Kadlecsik <kadlec@blackhole.kfki.hu>
	Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
(cherry picked from commit 49971b8853f576f4252cbc8fc3df8173d7a56de3)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/netfilter/ipset/ip_set_core.c
diff --cc net/netfilter/ipset/ip_set_core.c
index 8f5256a53627,1f3c03b3bebf..000000000000
--- a/net/netfilter/ipset/ip_set_core.c
+++ b/net/netfilter/ipset/ip_set_core.c
@@@ -56,12 -57,11 +56,17 @@@ MODULE_ALIAS_NFNL_SUBSYS(NFNL_SUBSYS_IP
  
  /* When the nfnl mutex is held: */
  #define ip_set_dereference(p)		\
++<<<<<<< HEAD
 +	rcu_dereference_protected(p, 1)
 +#define ip_set(inst, id)			\
++=======
+ 	rcu_dereference_protected(p, lockdep_nfnl_is_held(NFNL_SUBSYS_IPSET))
+ #define ip_set(inst, id)		\
++>>>>>>> 49971b8853f5 (netfilter: ipset: use nfnl_mutex_is_locked)
  	ip_set_dereference((inst)->ip_set_list)[id]
  
 -/* The set types are implemented in modules and registered set types
 +/*
 + * The set types are implemented in modules and registered set types
   * can be found in ip_set_type_list. Adding/deleting types is
   * serialized by ip_set_type_mutex.
   */
* Unmerged path net/netfilter/ipset/ip_set_core.c
