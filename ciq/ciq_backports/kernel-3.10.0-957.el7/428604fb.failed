ipv6: do not set routes if disable_ipv6 has been enabled

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-957.el7
commit-author Lorenzo Bianconi <lorenzo.bianconi@redhat.com>
commit 428604fb118facce1309670779a35baf27ad044c
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-957.el7/428604fb.failed

Do not allow setting ipv6 routes from userspace if disable_ipv6 has been
enabled. The issue can be triggered using the following reproducer:

- sysctl net.ipv6.conf.all.disable_ipv6=1
- ip -6 route add a:b:c:d::/64 dev em1
- ip -6 route show
  a:b:c:d::/64 dev em1 metric 1024 pref medium

Fix it checking disable_ipv6 value in ip6_route_info_create routine

	Signed-off-by: Lorenzo Bianconi <lorenzo.bianconi@redhat.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 428604fb118facce1309670779a35baf27ad044c)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/ipv6/route.c
diff --cc net/ipv6/route.c
index d1226c42fbb2,e461ef1158b6..000000000000
--- a/net/ipv6/route.c
+++ b/net/ipv6/route.c
@@@ -2015,8 -2917,21 +2015,23 @@@ int ip6_route_info_create(struct fib6_c
  	if (!dev)
  		goto out;
  
++<<<<<<< HEAD
++=======
+ 	if (idev->cnf.disable_ipv6) {
+ 		NL_SET_ERR_MSG(extack, "IPv6 is disabled on nexthop device");
+ 		err = -EACCES;
+ 		goto out;
+ 	}
+ 
+ 	if (!(dev->flags & IFF_UP)) {
+ 		NL_SET_ERR_MSG(extack, "Nexthop device is not up");
+ 		err = -ENETDOWN;
+ 		goto out;
+ 	}
+ 
++>>>>>>> 428604fb118f (ipv6: do not set routes if disable_ipv6 has been enabled)
  	if (!ipv6_addr_any(&cfg->fc_prefsrc)) {
  		if (!ipv6_chk_addr(net, &cfg->fc_prefsrc, dev, 0)) {
 -			NL_SET_ERR_MSG(extack, "Invalid source address");
  			err = -EINVAL;
  			goto out;
  		}
* Unmerged path net/ipv6/route.c
