drm/amdgpu: Don't default to DC support for Kaveri and older

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-957.el7
commit-author Harry Wentland <harry.wentland@amd.com>
commit d9fda248046ac035f18a6e663f2f9245b4bf9470
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-957.el7/d9fda248.failed

We've had a number of users report failures to detect and light up
display with DC with LVDS and VGA. These connector types are not
currently supported with DC. I'd like to add support but unfortunately
don't have a system with LVDS or VGA available.

In order not to cause regressions we should probably fallback to the
non-DC driver for ASICs that support VGA and LVDS.

These ASICs are:
 * Bonaire
 * Kabini
 * Kaveri
 * Mullins

ASIC support can always be force enabled with amdgpu.dc=1

v2: Keep Hawaii on DC
v3: Added Mullins to the list

	Cc: stable@vger.kernel.org
	Signed-off-by: Harry Wentland <harry.wentland@amd.com>
	Reviewed-by: Alex Deucher <alexander.deucher@amd.com>
	Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
(cherry picked from commit d9fda248046ac035f18a6e663f2f9245b4bf9470)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/gpu/drm/amd/amdgpu/amdgpu_device.c
diff --cc drivers/gpu/drm/amd/amdgpu/amdgpu_device.c
index e630d918fefc,6e5284e6c028..000000000000
--- a/drivers/gpu/drm/amd/amdgpu/amdgpu_device.c
+++ b/drivers/gpu/drm/amd/amdgpu/amdgpu_device.c
@@@ -1943,6 -2146,67 +1943,70 @@@ static void amdgpu_device_detect_sriov_
  }
  
  /**
++<<<<<<< HEAD
++=======
+  * amdgpu_device_asic_has_dc_support - determine if DC supports the asic
+  *
+  * @asic_type: AMD asic type
+  *
+  * Check if there is DC (new modesetting infrastructre) support for an asic.
+  * returns true if DC has support, false if not.
+  */
+ bool amdgpu_device_asic_has_dc_support(enum amd_asic_type asic_type)
+ {
+ 	switch (asic_type) {
+ #if defined(CONFIG_DRM_AMD_DC)
+ 	case CHIP_BONAIRE:
+ 	case CHIP_KAVERI:
+ 	case CHIP_KABINI:
+ 	case CHIP_MULLINS:
+ 		/*
+ 		 * We have systems in the wild with these ASICs that require
+ 		 * LVDS and VGA support which is not supported with DC.
+ 		 *
+ 		 * Fallback to the non-DC driver here by default so as not to
+ 		 * cause regressions.
+ 		 */
+ 		return amdgpu_dc > 0;
+ 	case CHIP_HAWAII:
+ 	case CHIP_CARRIZO:
+ 	case CHIP_STONEY:
+ 	case CHIP_POLARIS10:
+ 	case CHIP_POLARIS11:
+ 	case CHIP_POLARIS12:
+ 	case CHIP_VEGAM:
+ 	case CHIP_TONGA:
+ 	case CHIP_FIJI:
+ 	case CHIP_VEGA10:
+ 	case CHIP_VEGA12:
+ 	case CHIP_VEGA20:
+ #if defined(CONFIG_DRM_AMD_DC_DCN1_0)
+ 	case CHIP_RAVEN:
+ #endif
+ 		return amdgpu_dc != 0;
+ #endif
+ 	default:
+ 		return false;
+ 	}
+ }
+ 
+ /**
+  * amdgpu_device_has_dc_support - check if dc is supported
+  *
+  * @adev: amdgpu_device_pointer
+  *
+  * Returns true for supported, false for not supported
+  */
+ bool amdgpu_device_has_dc_support(struct amdgpu_device *adev)
+ {
+ 	if (amdgpu_sriov_vf(adev))
+ 		return false;
+ 
+ 	return amdgpu_device_asic_has_dc_support(adev->asic_type);
+ }
+ 
+ /**
++>>>>>>> d9fda248046a (drm/amdgpu: Don't default to DC support for Kaveri and older)
   * amdgpu_device_init - initialize the driver
   *
   * @adev: amdgpu_device pointer
* Unmerged path drivers/gpu/drm/amd/amdgpu/amdgpu_device.c
