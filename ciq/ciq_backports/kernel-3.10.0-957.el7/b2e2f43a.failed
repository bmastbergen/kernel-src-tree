s390: move nobp parameter functions to nospec-branch.c

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-957.el7
Rebuild_CHGLOG: - [s390] move nobp parameter functions to nospec-branch.c (Hendrik Brueckner) [1558325]
Rebuild_FUZZ: 94.12%
commit-author Martin Schwidefsky <schwidefsky@de.ibm.com>
commit b2e2f43a01bace1a25bdbae04c9f9846882b727a
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-957.el7/b2e2f43a.failed

Keep the code for the nobp parameter handling with the code for
expolines. Both are related to the spectre v2 mitigation.

	Signed-off-by: Martin Schwidefsky <schwidefsky@de.ibm.com>
(cherry picked from commit b2e2f43a01bace1a25bdbae04c9f9846882b727a)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/s390/kernel/Makefile
#	arch/s390/kernel/alternative.c
#	arch/s390/kernel/nospec-branch.c
diff --cc arch/s390/kernel/Makefile
index 597a10a12dc4,b06a6f79c1ec..000000000000
--- a/arch/s390/kernel/Makefile
+++ b/arch/s390/kernel/Makefile
@@@ -26,35 -55,30 +26,45 @@@ CFLAGS_dumpstack.o	+= -fno-optimize-sib
  #
  CFLAGS_ptrace.o		+= -DUTS_MACHINE='"$(UTS_MACHINE)"'
  
 -obj-y	:= traps.o time.o process.o base.o early.o setup.o idle.o vtime.o
 +CFLAGS_sysinfo.o += -Iinclude/math-emu -Iarch/s390/math-emu -w
 +
 +obj-y	:= bitmap.o traps.o time.o process.o base.o early.o setup.o vtime.o
  obj-y	+= processor.o sys_s390.o ptrace.o signal.o cpcmd.o ebcdic.o nmi.o
 -obj-y	+= debug.o irq.o ipl.o dis.o diag.o vdso.o als.o
 +obj-y	+= debug.o irq.o ipl.o dis.o diag.o sclp.o vdso.o
  obj-y	+= sysinfo.o jump_label.o lgr.o os_info.o machine_kexec.o pgm_check.o
++<<<<<<< HEAD
 +obj-y	+= dumpstack.o guarded_storage.o alternative.o
++=======
+ obj-y	+= runtime_instr.o cache.o fpu.o dumpstack.o guarded_storage.o sthyi.o
+ obj-y	+= entry.o reipl.o relocate_kernel.o kdebugfs.o alternative.o
+ obj-y	+= nospec-branch.o
++>>>>>>> b2e2f43a01ba (s390: move nobp parameter functions to nospec-branch.c)
  
 -extra-y				+= head.o head64.o vmlinux.lds
 +obj-y	+= $(if $(CONFIG_64BIT),entry64.o,entry.o)
 +obj-y	+= $(if $(CONFIG_64BIT),reipl64.o,reipl.o)
 +obj-y	+= $(if $(CONFIG_64BIT),relocate_kernel64.o,relocate_kernel.o)
  
++<<<<<<< HEAD
 +extra-y				+= head.o vmlinux.lds
 +extra-y				+= $(if $(CONFIG_64BIT),head64.o,head31.o)
++=======
+ CFLAGS_REMOVE_nospec-branch.o	+= $(CC_FLAGS_EXPOLINE)
++>>>>>>> b2e2f43a01ba (s390: move nobp parameter functions to nospec-branch.c)
  
 -obj-$(CONFIG_MODULES)		+= module.o
 +obj-$(CONFIG_MODULES)		+= s390_ksyms.o module.o
  obj-$(CONFIG_SMP)		+= smp.o
 -obj-$(CONFIG_SCHED_TOPOLOGY)	+= topology.o
 -obj-$(CONFIG_HIBERNATION)	+= suspend.o swsusp.o
 +obj-$(CONFIG_SCHED_BOOK)	+= topology.o
 +obj-$(CONFIG_HIBERNATION)	+= suspend.o swsusp_asm64.o
  obj-$(CONFIG_AUDIT)		+= audit.o
  compat-obj-$(CONFIG_AUDIT)	+= compat_audit.o
 -obj-$(CONFIG_COMPAT)		+= compat_linux.o compat_signal.o
 -obj-$(CONFIG_COMPAT)		+= compat_wrapper.o $(compat-obj-y)
 -obj-$(CONFIG_EARLY_PRINTK)	+= early_printk.o
 +obj-$(CONFIG_COMPAT)		+= compat_linux.o compat_signal.o \
 +					compat_wrapper.o compat_exec_domain.o \
 +					$(compat-obj-y)
 +
  obj-$(CONFIG_STACKTRACE)	+= stacktrace.o
  obj-$(CONFIG_KPROBES)		+= kprobes.o
 -obj-$(CONFIG_FUNCTION_TRACER)	+= mcount.o ftrace.o
 +obj-$(CONFIG_FUNCTION_TRACER)	+= $(if $(CONFIG_64BIT),mcount64.o,mcount.o)
 +obj-$(CONFIG_FUNCTION_TRACER)	+= ftrace.o
  obj-$(CONFIG_CRASH_DUMP)	+= crash_dump.o
  obj-$(CONFIG_UPROBES)		+= uprobes.o
  
diff --cc arch/s390/kernel/alternative.c
index 934990fa1fd9,1abf4f35d059..000000000000
--- a/arch/s390/kernel/alternative.c
+++ b/arch/s390/kernel/alternative.c
@@@ -14,19 -15,6 +14,22 @@@ static int __init disable_alternative_i
  
  early_param("noaltinstr", disable_alternative_instructions);
  
++<<<<<<< HEAD
 +static int nobp_flag = 1;
 +static int __init nobp_setup_early(char *str)
 +{
 +	bool enabled;
 +	int rc;
 +
 +	rc = strtobool(str, &enabled);
 +	if (!rc)
 +		nobp_flag = !!enabled;
 +	return rc;
 +}
 +early_param("nobp", nobp_setup_early);
 +
++=======
++>>>>>>> b2e2f43a01ba (s390: move nobp parameter functions to nospec-branch.c)
  struct brcl_insn {
  	u16 opc;
  	s32 disp;
* Unmerged path arch/s390/kernel/nospec-branch.c
* Unmerged path arch/s390/kernel/Makefile
* Unmerged path arch/s390/kernel/alternative.c
* Unmerged path arch/s390/kernel/nospec-branch.c
