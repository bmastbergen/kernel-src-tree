scsi: zfcp: fix missing REC trigger trace for all objects in ERP_FAILED

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-957.el7
commit-author Steffen Maier <maier@linux.ibm.com>
commit 8c3d20aada70042a39c6a6625be037c1472ca610
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-957.el7/8c3d20aa.failed

That other commit introduced an inconsistency because it would trace on
ERP_FAILED for all callers of port forced reopen triggers (not just
terminate_rport_io), but it would not trace on ERP_FAILED for all callers of
other ERP triggers such as adapter, port regular, LUN.

Therefore, generalize that other commit. zfcp_erp_action_enqueue() already
had two early outs which re-used the one zfcp_dbf_rec_trig() call.  All ERP
trigger functions finally run through zfcp_erp_action_enqueue().  So move
the special handling for ZFCP_STATUS_COMMON_ERP_FAILED into
zfcp_erp_action_enqueue() and add another early out with new trace marker
for pseudo ERP need in this case. This removes all early returns from all
ERP trigger functions so we always end up at zfcp_dbf_rec_trig().

Example trace record formatted with zfcpdbf from s390-tools:

Timestamp      : ...
Area           : REC
Subarea        : 00
Level          : 1
Exception      : -
CPU ID         : ..
Caller         : 0x...
Record ID      : 1                      ZFCP_DBF_REC_TRIG
Tag            : .......
LUN            : 0x...
WWPN           : 0x...
D_ID           : 0x...
Adapter status : 0x...
Port status    : 0x...
LUN status     : 0x...
Ready count    : 0x...
Running count  : 0x...
ERP want       : 0x0.                   ZFCP_ERP_ACTION_REOPEN_...
ERP need       : 0xe0                   ZFCP_ERP_ACTION_FAILED

	Signed-off-by: Steffen Maier <maier@linux.ibm.com>
	Cc: <stable@vger.kernel.org> #2.6.38+
	Reviewed-by: Benjamin Block <bblock@linux.ibm.com>
	Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
(cherry picked from commit 8c3d20aada70042a39c6a6625be037c1472ca610)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/s390/scsi/zfcp_erp.c
diff --cc drivers/s390/scsi/zfcp_erp.c
index dad45aba1cd3,20fe59300d0e..000000000000
--- a/drivers/s390/scsi/zfcp_erp.c
+++ b/drivers/s390/scsi/zfcp_erp.c
@@@ -364,9 -423,6 +403,12 @@@ static void _zfcp_erp_port_forced_reope
  	zfcp_erp_port_block(port, clear);
  	zfcp_scsi_schedule_rport_block(port);
  
++<<<<<<< HEAD
 +	if (atomic_read(&port->status) & ZFCP_STATUS_COMMON_ERP_FAILED)
 +		return;
 +
++=======
++>>>>>>> 8c3d20aada70 (scsi: zfcp: fix missing REC trigger trace for all objects in ERP_FAILED)
  	zfcp_erp_action_enqueue(ZFCP_ERP_ACTION_REOPEN_PORT_FORCED,
  				port->adapter, port, NULL, id, 0);
  }
* Unmerged path drivers/s390/scsi/zfcp_erp.c
