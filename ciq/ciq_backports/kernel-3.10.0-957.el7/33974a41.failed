perf trace: Call machine__exit() at exit

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-957.el7
commit-author Andrei Vagin <avagin@openvz.org>
commit 33974a414ce2324554f75dbd204ff0868f499e32
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-957.el7/33974a41.failed

Otherwise 'perf trace' leaves a temporary file /tmp/perf-vdso.so-XXXXXX.

  $ perf trace -o log true
  $ ls -l /tmp/perf-vdso.*
  -rw------- 1 root root 8192 Nov  8 03:08 /tmp/perf-vdso.so-5bCpD0

	Signed-off-by: Andrei Vagin <avagin@openvz.org>
	Reviewed-by: Jiri Olsa <jolsa@redhat.com>
	Cc: Alexander Shishkin <alexander.shishkin@linux.intel.com>
	Cc: Namhyung Kim <namhyung@kernel.org>
	Cc: Peter Zijlstra <peterz@infradead.org>
	Cc: Vasily Averin <vvs@virtuozzo.com>
Link: http://lkml.kernel.org/r/20171108002246.8924-1-avagin@openvz.org
	Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>
(cherry picked from commit 33974a414ce2324554f75dbd204ff0868f499e32)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	tools/perf/builtin-trace.c
diff --cc tools/perf/builtin-trace.c
index 0bbdddf10323,d5d7fff1c211..000000000000
--- a/tools/perf/builtin-trace.c
+++ b/tools/perf/builtin-trace.c
@@@ -1205,6 -1138,34 +1205,37 @@@ static int trace__symbols_init(struct t
  	return err;
  }
  
++<<<<<<< HEAD
++=======
+ static void trace__symbols__exit(struct trace *trace)
+ {
+ 	machine__exit(trace->host);
+ 	trace->host = NULL;
+ 
+ 	symbol__exit();
+ }
+ 
+ static int syscall__alloc_arg_fmts(struct syscall *sc, int nr_args)
+ {
+ 	int idx;
+ 
+ 	if (nr_args == 6 && sc->fmt && sc->fmt->nr_args != 0)
+ 		nr_args = sc->fmt->nr_args;
+ 
+ 	sc->arg_fmt = calloc(nr_args, sizeof(*sc->arg_fmt));
+ 	if (sc->arg_fmt == NULL)
+ 		return -1;
+ 
+ 	for (idx = 0; idx < nr_args; ++idx) {
+ 		if (sc->fmt)
+ 			sc->arg_fmt[idx] = sc->fmt->arg[idx];
+ 	}
+ 
+ 	sc->nr_args = nr_args;
+ 	return 0;
+ }
+ 
++>>>>>>> 33974a414ce2 (perf trace: Call machine__exit() at exit)
  static int syscall__set_arg_fmts(struct syscall *sc)
  {
  	struct format_field *field;
* Unmerged path tools/perf/builtin-trace.c
