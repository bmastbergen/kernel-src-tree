net: Fix NETDEV_CHANGE notifier usage causing spurious arp flush

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-957.el7
Rebuild_CHGLOG: - [net] Fix NETDEV_CHANGE notifier usage causing spurious arp flush (Xin Long) [1571615]
Rebuild_FUZZ: 95.93%
commit-author Loic Prylli <loicp@google.com>
commit 54951194656e4853e441266fd095f880bc0398f3
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-957.el7/54951194.failed

A bug was introduced in NETDEV_CHANGE notifier sequence causing the
arp table to be sometimes spuriously cleared (including manual arp
entries marked permanent), upon network link carrier changes.

The changed argument for the notifier was applied only to a single
caller of NETDEV_CHANGE, missing among others netdev_state_change().
So upon net_carrier events induced by the network, which are
triggering a call to netdev_state_change(), arp_netdev_event() would
decide whether to clear or not arp cache based on random/junk stack
values (a kind of read buffer overflow).

Fixes: be9efd365328 ("net: pass changed flags along with NETDEV_CHANGE event")
Fixes: 6c8b4e3ff81b ("arp: flush arp cache on IFF_NOARP change")
	Signed-off-by: Loic Prylli <loicp@google.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 54951194656e4853e441266fd095f880bc0398f3)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/core/dev.c
diff --cc net/core/dev.c
index 057b965c99c7,7990984ca364..000000000000
--- a/net/core/dev.c
+++ b/net/core/dev.c
@@@ -161,7 -148,9 +161,13 @@@ struct list_head ptype_all __read_mostl
  static struct list_head offload_base __read_mostly;
  
  static int netif_rx_internal(struct sk_buff *skb);
++<<<<<<< HEAD
 +static struct napi_struct *napi_by_id(unsigned int napi_id);
++=======
+ static int call_netdevice_notifiers_info(unsigned long val,
+ 					 struct net_device *dev,
+ 					 struct netdev_notifier_info *info);
++>>>>>>> 54951194656e (net: Fix NETDEV_CHANGE notifier usage causing spurious arp flush)
  
  /*
   * The @dev_base_head list is protected by @dev_base_lock and the rtnl
* Unmerged path net/core/dev.c
