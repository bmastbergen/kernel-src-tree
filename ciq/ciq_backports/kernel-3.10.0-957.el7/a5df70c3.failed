perf/x86: Only show format attributes when supported

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-957.el7
commit-author Andi Kleen <ak@linux.intel.com>
commit a5df70c354c26e20d5fd8eb64517f724e97ef0b2
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-957.el7/a5df70c3.failed

Only show the Intel format attributes in sysfs when the feature is actually
supported with the current model numbers. This allows programs to probe
what format attributes are available, and give a sensible error message
to users if they are not.

This handles near all cases for intel attributes since Nehalem,
except the (obscure) case when the model number if known, but PEBS
is disabled in PERF_CAPABILITIES.

	Signed-off-by: Andi Kleen <ak@linux.intel.com>
	Signed-off-by: Peter Zijlstra (Intel) <peterz@infradead.org>
	Cc: Linus Torvalds <torvalds@linux-foundation.org>
	Cc: Peter Zijlstra <peterz@infradead.org>
	Cc: Thomas Gleixner <tglx@linutronix.de>
Link: http://lkml.kernel.org/r/20170822185201.9261-2-andi@firstfloor.org
	Signed-off-by: Ingo Molnar <mingo@kernel.org>
(cherry picked from commit a5df70c354c26e20d5fd8eb64517f724e97ef0b2)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/x86/events/intel/core.c
diff --cc arch/x86/events/intel/core.c
index 2819d8d8cfe5,b00f1353a026..000000000000
--- a/arch/x86/events/intel/core.c
+++ b/arch/x86/events/intel/core.c
@@@ -3855,6 -3956,8 +3871,11 @@@ __init int intel_pmu_init(void
  		x86_pmu.pebs_constraints = intel_slm_pebs_event_constraints;
  		x86_pmu.extra_regs = intel_slm_extra_regs;
  		x86_pmu.flags |= PMU_FL_HAS_RSP_1;
++<<<<<<< HEAD
++=======
+ 		x86_pmu.cpu_events = slm_events_attrs;
+ 		extra_attr = slm_format_attr;
++>>>>>>> a5df70c354c2 (perf/x86: Only show format attributes when supported)
  		pr_cont("Silvermont events, ");
  		break;
  
* Unmerged path arch/x86/events/intel/core.c
