Fix: Disable sys_membarrier when nohz_full is enabled

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-957.el7
Rebuild_CHGLOG: - [kernel] membarrier: disable sys_membarrier when nohz_full is enabled (Rafael Aquini) [1560024]
Rebuild_FUZZ: 90.27%
commit-author Mathieu Desnoyers <mathieu.desnoyers@efficios.com>
commit 907565337ebf998a68cb5c5b2174ce5e5da065eb
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-957.el7/90756533.failed

Userspace applications should be allowed to expect the membarrier system
call with MEMBARRIER_CMD_SHARED command to issue memory barriers on
nohz_full CPUs, but synchronize_sched() does not take those into
account.

Given that we do not want unrelated processes to be able to affect
real-time sensitive nohz_full CPUs, simply return ENOSYS when membarrier
is invoked on a kernel with enabled nohz_full CPUs.

	Signed-off-by: Mathieu Desnoyers <mathieu.desnoyers@efficios.com>
CC: Josh Triplett <josh@joshtriplett.org>
CC: Steven Rostedt <rostedt@goodmis.org>
CC: <stable@vger.kernel.org>	[3.10+]
	Signed-off-by: Paul E. McKenney <paulmck@linux.vnet.ibm.com>
	Cc: Frederic Weisbecker <fweisbec@gmail.com>
	Cc: Chris Metcalf <cmetcalf@mellanox.com>
	Cc: Rik van Riel <riel@redhat.com>
	Acked-by: Lai Jiangshan <jiangshanlai@gmail.com>
	Reviewed-by: Josh Triplett <josh@joshtriplett.org>
(cherry picked from commit 907565337ebf998a68cb5c5b2174ce5e5da065eb)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	kernel/membarrier.c
* Unmerged path kernel/membarrier.c
* Unmerged path kernel/membarrier.c
