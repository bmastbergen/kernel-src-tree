net/mlx5e: IPoIB, Set the netdevice sw mtu in ipoib enhanced flow

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-957.el7
commit-author Feras Daoud <ferasda@mellanox.com>
commit 8e1d162d8e81838119de18b4ca1e302ce906f2a6
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-957.el7/8e1d162d.failed

After introduction of the cited commit, mlx5e_build_nic_params
receives the netdevice mtu in order to set the sw_mtu of mlx5e_params.
For enhanced IPoIB, the netdevice mtu is not set in this stage,
therefore, the initial sw_mtu equals zero. As a result, the hw_mtu
of the receive queue will be calculated incorrectly causing traffic
issues.

To fix this issue, query for port mtu before building the nic params.

Fixes: 472a1e44b349 ("net/mlx5e: Save MTU in channels params")
	Signed-off-by: Feras Daoud <ferasda@mellanox.com>
	Reviewed-by: Tariq Toukan <tariqt@mellanox.com>
	Signed-off-by: Saeed Mahameed <saeedm@mellanox.com>
(cherry picked from commit 8e1d162d8e81838119de18b4ca1e302ce906f2a6)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/mellanox/mlx5/core/ipoib/ipoib.c
diff --cc drivers/net/ethernet/mellanox/mlx5/core/ipoib/ipoib.c
index 6f5426a53ff7,b7c21eb21a21..000000000000
--- a/drivers/net/ethernet/mellanox/mlx5/core/ipoib/ipoib.c
+++ b/drivers/net/ethernet/mellanox/mlx5/core/ipoib/ipoib.c
@@@ -82,10 -83,13 +83,18 @@@ void mlx5i_init(struct mlx5_core_dev *m
  	priv->netdev      = netdev;
  	priv->profile     = profile;
  	priv->ppriv       = ppriv;
 +	priv->hard_mtu = MLX5_IB_GRH_BYTES + MLX5_IPOIB_HARD_LEN;
  	mutex_init(&priv->state_lock);
  
++<<<<<<< HEAD
 +	mlx5e_build_nic_params(mdev, &priv->channels.params, profile->max_nch(mdev));
++=======
+ 	mlx5_query_port_max_mtu(mdev, &max_mtu, 1);
+ 	netdev->mtu = max_mtu;
+ 
+ 	mlx5e_build_nic_params(mdev, &priv->channels.params,
+ 			       profile->max_nch(mdev), netdev->mtu);
++>>>>>>> 8e1d162d8e81 (net/mlx5e: IPoIB, Set the netdevice sw mtu in ipoib enhanced flow)
  	mlx5i_build_nic_params(mdev, &priv->channels.params);
  
  	mlx5e_timestamp_init(priv);
* Unmerged path drivers/net/ethernet/mellanox/mlx5/core/ipoib/ipoib.c
