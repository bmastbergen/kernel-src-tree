mlxsw: spectrum: qdiscs: Make the clean stats function to be for RED only

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-957.el7
commit-author Nogah Frankel <nogahf@mellanox.com>
commit c2ed6db76519902b39598ee5cde2f2f6d855e528
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-957.el7/c2ed6db7.failed

Improve readability by changing the clean stats function to handle only
RED. Qdiscs that will be offloaded in the future will have a clean stats
function of their own.

	Signed-off-by: Nogah Frankel <nogahf@mellanox.com>
	Reviewed-by: Yuval Mintz <yuvalm@mellanox.com>
	Signed-off-by: Jiri Pirko <jiri@mellanox.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit c2ed6db76519902b39598ee5cde2f2f6d855e528)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/mellanox/mlxsw/spectrum_qdisc.c
diff --cc drivers/net/ethernet/mellanox/mlxsw/spectrum_qdisc.c
index b5397da94d7f,6f7687bfa1e2..000000000000
--- a/drivers/net/ethernet/mellanox/mlxsw/spectrum_qdisc.c
+++ b/drivers/net/ethernet/mellanox/mlxsw/spectrum_qdisc.c
@@@ -80,34 -98,29 +80,48 @@@ mlxsw_sp_tclass_congestion_disable(stru
  }
  
  static void
- mlxsw_sp_setup_tc_qdisc_clean_stats(struct mlxsw_sp_port *mlxsw_sp_port,
- 				    struct mlxsw_sp_qdisc *mlxsw_sp_qdisc,
- 				    int tclass_num)
+ mlxsw_sp_setup_tc_qdisc_red_clean_stats(struct mlxsw_sp_port *mlxsw_sp_port,
+ 					struct mlxsw_sp_qdisc *mlxsw_sp_qdisc,
+ 					int tclass_num)
  {
 -	struct mlxsw_sp_qdisc_stats *stats_base;
 +	struct red_stats *xstats_base = &mlxsw_sp_qdisc->xstats_base;
  	struct mlxsw_sp_port_xstats *xstats;
  	struct rtnl_link_stats64 *stats;
 -	struct red_stats *red_base;
  
  	xstats = &mlxsw_sp_port->periodic_hw_stats.xstats;
  	stats = &mlxsw_sp_port->periodic_hw_stats.stats;
++<<<<<<< HEAD
++=======
+ 	stats_base = &mlxsw_sp_qdisc->stats_base;
+ 	red_base = &mlxsw_sp_qdisc->xstats_base.red;
 -
 -	stats_base->tx_packets = stats->tx_packets;
 -	stats_base->tx_bytes = stats->tx_bytes;
 -
++>>>>>>> c2ed6db76519 (mlxsw: spectrum: qdiscs: Make the clean stats function to be for RED only)
 +
 +	mlxsw_sp_qdisc->tx_packets = stats->tx_packets;
 +	mlxsw_sp_qdisc->tx_bytes = stats->tx_bytes;
 +
++<<<<<<< HEAD
 +	switch (mlxsw_sp_qdisc->type) {
 +	case MLXSW_SP_QDISC_RED:
 +		xstats_base->prob_mark = xstats->ecn;
 +		xstats_base->prob_drop = xstats->wred_drop[tclass_num];
 +		xstats_base->pdrop = xstats->tail_drop[tclass_num];
 +
 +		mlxsw_sp_qdisc->overlimits = xstats_base->prob_drop +
 +					     xstats_base->prob_mark;
 +		mlxsw_sp_qdisc->drops = xstats_base->prob_drop +
 +					xstats_base->pdrop;
 +		break;
 +	default:
 +		break;
 +	}
++=======
+ 	red_base->prob_mark = xstats->ecn;
+ 	red_base->prob_drop = xstats->wred_drop[tclass_num];
+ 	red_base->pdrop = xstats->tail_drop[tclass_num];
+ 
+ 	stats_base->overlimits = red_base->prob_drop + red_base->prob_mark;
+ 	stats_base->drops = red_base->prob_drop + red_base->pdrop;
++>>>>>>> c2ed6db76519 (mlxsw: spectrum: qdiscs: Make the clean stats function to be for RED only)
  }
  
  static int
* Unmerged path drivers/net/ethernet/mellanox/mlxsw/spectrum_qdisc.c
