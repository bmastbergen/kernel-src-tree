net/mlx5e: IPoIB, Add PTP ioctl support for child interface

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-957.el7
Rebuild_CHGLOG: - [netdrv] mlx5e: IPoIB, Add PTP ioctl support for child interface (Alaa Hleihel) [1520334 1520297]
Rebuild_FUZZ: 96.49%
commit-author Feras Daoud <ferasda@mellanox.com>
commit 08437c572c0873a696ceae92aff29f0ae334aeab
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-957.el7/08437c57.failed

Add support to control precision time protocol on child interfaces
using ioctl.

This commit changes the following:
- Change parent ioctl function to be non static
- Reuse the parent ioctl function in child devices

	Signed-off-by: Feras Daoud <ferasda@mellanox.com>
	Signed-off-by: Saeed Mahameed <saeedm@mellanox.com>
(cherry picked from commit 08437c572c0873a696ceae92aff29f0ae334aeab)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/mellanox/mlx5/core/ipoib/ipoib_vlan.c
diff --cc drivers/net/ethernet/mellanox/mlx5/core/ipoib/ipoib_vlan.c
index 63081376f4a7,b69e9d847a6b..000000000000
--- a/drivers/net/ethernet/mellanox/mlx5/core/ipoib/ipoib_vlan.c
+++ b/drivers/net/ethernet/mellanox/mlx5/core/ipoib/ipoib_vlan.c
@@@ -146,7 -147,8 +147,12 @@@ static const struct net_device_ops mlx5
  	.ndo_stop                = mlx5i_pkey_close,
  	.ndo_init                = mlx5i_pkey_dev_init,
  	.ndo_uninit              = mlx5i_pkey_dev_cleanup,
++<<<<<<< HEAD
 +	.ndo_change_mtu_rh74     = mlx5i_pkey_change_mtu,
++=======
+ 	.ndo_change_mtu          = mlx5i_pkey_change_mtu,
+ 	.ndo_do_ioctl            = mlx5i_pkey_ioctl,
++>>>>>>> 08437c572c08 (net/mlx5e: IPoIB, Add PTP ioctl support for child interface)
  };
  
  /* Child NDOs */
diff --git a/drivers/net/ethernet/mellanox/mlx5/core/ipoib/ipoib.c b/drivers/net/ethernet/mellanox/mlx5/core/ipoib/ipoib.c
index fcb72758697c..c42f13ae88a5 100644
--- a/drivers/net/ethernet/mellanox/mlx5/core/ipoib/ipoib.c
+++ b/drivers/net/ethernet/mellanox/mlx5/core/ipoib/ipoib.c
@@ -41,7 +41,6 @@
 static int mlx5i_open(struct net_device *netdev);
 static int mlx5i_close(struct net_device *netdev);
 static int mlx5i_change_mtu(struct net_device *netdev, int new_mtu);
-static int mlx5i_ioctl(struct net_device *dev, struct ifreq *ifr, int cmd);
 
 static const struct net_device_ops mlx5i_netdev_ops = {
 	.ndo_size                = sizeof(struct net_device_ops),
@@ -399,7 +398,7 @@ int mlx5i_dev_init(struct net_device *dev)
 	return 0;
 }
 
-static int mlx5i_ioctl(struct net_device *dev, struct ifreq *ifr, int cmd)
+int mlx5i_ioctl(struct net_device *dev, struct ifreq *ifr, int cmd)
 {
 	struct mlx5e_priv *priv = mlx5i_epriv(dev);
 
diff --git a/drivers/net/ethernet/mellanox/mlx5/core/ipoib/ipoib.h b/drivers/net/ethernet/mellanox/mlx5/core/ipoib/ipoib.h
index 49008022c306..5e87d04652d2 100644
--- a/drivers/net/ethernet/mellanox/mlx5/core/ipoib/ipoib.h
+++ b/drivers/net/ethernet/mellanox/mlx5/core/ipoib/ipoib.h
@@ -79,6 +79,7 @@ struct net_device *mlx5i_pkey_get_netdev(struct net_device *netdev, u32 qpn);
 /* Shared ndo functionts */
 int mlx5i_dev_init(struct net_device *dev);
 void mlx5i_dev_cleanup(struct net_device *dev);
+int mlx5i_ioctl(struct net_device *dev, struct ifreq *ifr, int cmd);
 
 /* Parent profile functions */
 void mlx5i_init(struct mlx5_core_dev *mdev,
* Unmerged path drivers/net/ethernet/mellanox/mlx5/core/ipoib/ipoib_vlan.c
