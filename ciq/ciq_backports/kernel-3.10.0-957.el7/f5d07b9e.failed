Input: trackpoint - force 3 buttons if 0 button is reported

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-957.el7
Rebuild_CHGLOG: - [input] trackpoint - force 3 buttons if 0 button is reported (Benjamin Tissoires) [1554926]
Rebuild_FUZZ: 93.69%
commit-author Aaron Ma <aaron.ma@canonical.com>
commit f5d07b9e98022d50720e38aa936fc11c67868ece
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-957.el7/f5d07b9e.failed

Lenovo introduced trackpoint compatible sticks with minimum PS/2 commands.
They supposed to reply with 0x02, 0x03, or 0x04 in response to the
"Read Extended ID" command, so we would know not to try certain extended
commands. Unfortunately even some trackpoints reporting the original IBM
version (0x01 firmware 0x0e) now respond with incorrect data to the "Get
Extended Buttons" command:

 thinkpad_acpi: ThinkPad BIOS R0DET87W (1.87 ), EC unknown
 thinkpad_acpi: Lenovo ThinkPad E470, model 20H1004SGE

 psmouse serio2: trackpoint: IBM TrackPoint firmware: 0x0e, buttons: 0/0

Since there are no trackpoints without buttons, let's assume the trackpoint
has 3 buttons when we get 0 response to the extended buttons query.

	Signed-off-by: Aaron Ma <aaron.ma@canonical.com>
Fixes: https://bugzilla.kernel.org/show_bug.cgi?id=196253
	Cc: stable@vger.kernel.org
	Signed-off-by: Dmitry Torokhov <dmitry.torokhov@gmail.com>
(cherry picked from commit f5d07b9e98022d50720e38aa936fc11c67868ece)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/input/mouse/trackpoint.c
diff --cc drivers/input/mouse/trackpoint.c
index bd5c176c7a2d,92a8898682a6..000000000000
--- a/drivers/input/mouse/trackpoint.c
+++ b/drivers/input/mouse/trackpoint.c
@@@ -376,9 -380,12 +376,18 @@@ int trackpoint_detect(struct psmouse *p
  	if (!set_properties)
  		return 0;
  
++<<<<<<< HEAD
 +	if (trackpoint_read(&psmouse->ps2dev, TP_EXT_BTN, &button_info)) {
 +		psmouse_warn(psmouse, "failed to get extended button data\n");
 +		button_info = 0;
++=======
+ 	if (trackpoint_read(ps2dev, TP_EXT_BTN, &button_info)) {
+ 		psmouse_warn(psmouse, "failed to get extended button data, assuming 3 buttons\n");
+ 		button_info = 0x33;
+ 	} else if (!button_info) {
+ 		psmouse_warn(psmouse, "got 0 in extended button data, assuming 3 buttons\n");
+ 		button_info = 0x33;
++>>>>>>> f5d07b9e9802 (Input: trackpoint - force 3 buttons if 0 button is reported)
  	}
  
  	psmouse->private = kzalloc(sizeof(struct trackpoint_data), GFP_KERNEL);
* Unmerged path drivers/input/mouse/trackpoint.c
