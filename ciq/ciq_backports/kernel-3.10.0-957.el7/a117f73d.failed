net/mlx5e: Sync netdev vxlan ports at open

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-957.el7
Rebuild_CHGLOG: - [netdrv] mlx5e: Sync netdev vxlan ports at open (Alaa Hleihel) [1520297]
Rebuild_FUZZ: 95.00%
commit-author Shahar Klein <shahark@mellanox.com>
commit a117f73dc2430443f23e18367fa545981129c1a6
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-957.el7/a117f73d.failed

When mlx5_core is loaded it is expected to sync ports
with all vxlan devices so it can support vxlan encap/decap.
This is done via udp_tunnel_get_rx_info(). Currently this
call is set in mlx5e_nic_enable() and if the netdev is not in
NETREG_REGISTERED state it will not be called.

Normally on load the netdev state is not NETREG_REGISTERED
so udp_tunnel_get_rx_info() will not be called.

Moving udp_tunnel_get_rx_info() to mlx5e_open() so
it will be called on netdev UP event and allow encap/decap.

Fixes: 610e89e05c3f ("net/mlx5e: Don't sync netdev state when not registered")
	Signed-off-by: Shahar Klein <shahark@mellanox.com>
	Reviewed-by: Roi Dayan <roid@mellanox.com>
	Signed-off-by: Saeed Mahameed <saeedm@mellanox.com>
(cherry picked from commit a117f73dc2430443f23e18367fa545981129c1a6)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/mellanox/mlx5/core/en_main.c
diff --cc drivers/net/ethernet/mellanox/mlx5/core/en_main.c
index f9f9996c2b9e,9b4827d36e3e..000000000000
--- a/drivers/net/ethernet/mellanox/mlx5/core/en_main.c
+++ b/drivers/net/ethernet/mellanox/mlx5/core/en_main.c
@@@ -4123,13 -4327,9 +4126,19 @@@ static void mlx5e_nic_enable(struct mlx
  
  	if (netdev->reg_state != NETREG_REGISTERED)
  		return;
++<<<<<<< HEAD
 +
 +	/* Device already registered: sync netdev system state */
 +	if (mlx5e_vxlan_allowed(mdev)) {
 +		rtnl_lock();
 +		udp_tunnel_get_rx_info(netdev);
 +		rtnl_unlock();
 +	}
++=======
+ #ifdef CONFIG_MLX5_CORE_EN_DCB
+ 	mlx5e_dcbnl_init_app(priv);
+ #endif
++>>>>>>> a117f73dc243 (net/mlx5e: Sync netdev vxlan ports at open)
  
  	queue_work(priv->wq, &priv->set_rx_mode_work);
  
* Unmerged path drivers/net/ethernet/mellanox/mlx5/core/en_main.c
