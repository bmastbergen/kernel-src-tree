mlxsw: spectrum_switchdev: Allow port enslavement to a VLAN-unaware bridge

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-957.el7
commit-author Ido Schimmel <idosch@mellanox.com>
commit 65b53bfd497b052277f89afb3839ace38190974c
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-957.el7/65b53bfd.failed

Up until now we only allowed VLAN devices to be put in a VLAN-unaware
bridge, but some users need the ability to enslave physical ports as
well.

This is achieved by mapping the port and VID 1 to the bridge's vFID,
instead of the port and the VID used by the VLAN device.

The above is valid because as long as the port is not enslaved to a
bridge, VID 1 is guaranteed to be configured as PVID and egress
untagged.

	Signed-off-by: Ido Schimmel <idosch@mellanox.com>
	Signed-off-by: Jiri Pirko <jiri@mellanox.com>
	Tested-by: David Ahern <dsahern@gmail.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 65b53bfd497b052277f89afb3839ace38190974c)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/mellanox/mlxsw/spectrum_switchdev.c
diff --cc drivers/net/ethernet/mellanox/mlxsw/spectrum_switchdev.c
index 593ad31be749,917663adf925..000000000000
--- a/drivers/net/ethernet/mellanox/mlxsw/spectrum_switchdev.c
+++ b/drivers/net/ethernet/mellanox/mlxsw/spectrum_switchdev.c
@@@ -1882,14 -1882,10 +1882,19 @@@ mlxsw_sp_bridge_8021d_port_join(struct 
  				struct netlink_ext_ack *extack)
  {
  	struct mlxsw_sp_port_vlan *mlxsw_sp_port_vlan;
+ 	struct net_device *dev = bridge_port->dev;
  	u16 vid;
  
++<<<<<<< HEAD
 +	if (!is_vlan_dev(bridge_port->dev)) {
 +		NL_SET_ERR_MSG(extack, "spectrum: Only VLAN devices can be enslaved to a VLAN-unaware bridge");
 +		return -EINVAL;
 +	}
 +	vid = vlan_dev_vlan_id(bridge_port->dev);
 +
++=======
+ 	vid = is_vlan_dev(dev) ? vlan_dev_vlan_id(dev) : 1;
++>>>>>>> 65b53bfd497b (mlxsw: spectrum_switchdev: Allow port enslavement to a VLAN-unaware bridge)
  	mlxsw_sp_port_vlan = mlxsw_sp_port_vlan_find_by_vid(mlxsw_sp_port, vid);
  	if (WARN_ON(!mlxsw_sp_port_vlan))
  		return -EINVAL;
* Unmerged path drivers/net/ethernet/mellanox/mlxsw/spectrum_switchdev.c
