mmc: block: Fix cmd error reset failure path

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-957.el7
Rebuild_CHGLOG: - [mmc] block: Fix cmd error reset failure path (Gopal Tiwari) [1549495]
Rebuild_FUZZ: 93.98%
commit-author Adrian Hunter <adrian.hunter@intel.com>
commit 8ecc34448e24e9e8a8f3a9b37be70b43c6af5288
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-957.el7/8ecc3444.failed

Commit 4e1f780032c5 ("mmc: block: break out mmc_blk_rw_cmd_abort()")
assumed the request had not completed, but in one case it had. Fix that.

Fixes: 4e1f780032c5 ("mmc: block: break out mmc_blk_rw_cmd_abort()")
	Signed-off-by: Adrian Hunter <adrian.hunter@intel.com>
	Reviewed-by: Linus Walleij <linus.walleij@linaro.org>
	Signed-off-by: Ulf Hansson <ulf.hansson@linaro.org>
(cherry picked from commit 8ecc34448e24e9e8a8f3a9b37be70b43c6af5288)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/mmc/core/block.c
diff --cc drivers/mmc/core/block.c
index 49dc294d6eb1,05afefcfb611..000000000000
--- a/drivers/mmc/core/block.c
+++ b/drivers/mmc/core/block.c
@@@ -1664,11 -1699,17 +1664,25 @@@ static int mmc_blk_issue_rw_rq(struct m
  			}
  			break;
  		case MMC_BLK_CMD_ERR:
++<<<<<<< HEAD
 +			ret = mmc_blk_cmd_err(md, card, brq, req, ret);
 +			if (mmc_blk_reset(md, card->host, type))
 +				goto cmd_abort;
 +			if (!ret)
 +				goto start_new_req;
++=======
+ 			req_pending = mmc_blk_rw_cmd_err(md, card, brq, old_req, req_pending);
+ 			if (mmc_blk_reset(md, card->host, type)) {
+ 				if (req_pending)
+ 					mmc_blk_rw_cmd_abort(card, old_req);
+ 				mmc_blk_rw_try_restart(mq, new_req);
+ 				return;
+ 			}
+ 			if (!req_pending) {
+ 				mmc_blk_rw_try_restart(mq, new_req);
+ 				return;
+ 			}
++>>>>>>> 8ecc34448e24 (mmc: block: Fix cmd error reset failure path)
  			break;
  		case MMC_BLK_RETRY:
  			retune_retry_done = brq->retune_retry_done;
* Unmerged path drivers/mmc/core/block.c
