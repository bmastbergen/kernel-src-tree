net/mlx5e: Fix null pointer access when setting MTU of vport representor

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-957.el7
Rebuild_CHGLOG: - [netdrv] mlx5e: Fix null pointer access when setting MTU of vport representor (Erez Alfasi) [1625195]
Rebuild_FUZZ: 97.14%
commit-author Adi Nissim <adin@mellanox.com>
commit eacecf2760e321bf1c99b981d44a14bd05721f15
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-957.el7/eacecf27.failed

MTU helper function is used by both conventional mlx5e
instances (PF/VF) and the eswitch representors. The representor
shouldn't change the nic vport context MTU, the VF is responsible for
that. Therefore set_mtu_cb has a null value when changing the
representor MTU.

Fixes: 250a42b6a764 ("net/mlx5e: Support configurable MTU for vport representors")
	Signed-off-by: Adi Nissim <adin@mellanox.com>
	Reviewed-by: Yevgeny Kliteynik <kliteyn@mellanox.com>
	Signed-off-by: Saeed Mahameed <saeedm@mellanox.com>
(cherry picked from commit eacecf2760e321bf1c99b981d44a14bd05721f15)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/mellanox/mlx5/core/en_main.c
diff --cc drivers/net/ethernet/mellanox/mlx5/core/en_main.c
index a42a2f9547cb,c592678ab5f1..000000000000
--- a/drivers/net/ethernet/mellanox/mlx5/core/en_main.c
+++ b/drivers/net/ethernet/mellanox/mlx5/core/en_main.c
@@@ -3209,17 -3695,26 +3209,24 @@@ static int mlx5e_change_mtu(struct net_
  
  	mutex_lock(&priv->state_lock);
  
 -	params = &priv->channels.params;
 +	reset = !priv->channels.params.lro_en &&
 +		(priv->channels.params.rq_wq_type !=
 +		 MLX5_WQ_TYPE_LINKED_LIST_STRIDING_RQ);
  
 -	reset = !params->lro_en;
  	reset = reset && test_bit(MLX5E_STATE_OPENED, &priv->state);
  
 -	new_channels.params = *params;
 -	new_channels.params.sw_mtu = new_mtu;
 -
 -	if (params->rq_wq_type == MLX5_WQ_TYPE_LINKED_LIST_STRIDING_RQ) {
 -		u8 ppw_old = mlx5e_mpwqe_log_pkts_per_wqe(params);
 -		u8 ppw_new = mlx5e_mpwqe_log_pkts_per_wqe(&new_channels.params);
 -
 -		reset = reset && (ppw_old != ppw_new);
 -	}
 +	curr_mtu    = netdev->mtu;
 +	netdev->mtu = new_mtu;
  
  	if (!reset) {
++<<<<<<< HEAD
 +		mlx5e_set_dev_port_mtu(priv);
++=======
+ 		params->sw_mtu = new_mtu;
+ 		if (set_mtu_cb)
+ 			set_mtu_cb(priv);
+ 		netdev->mtu = params->sw_mtu;
++>>>>>>> eacecf2760e3 (net/mlx5e: Fix null pointer access when setting MTU of vport representor)
  		goto out;
  	}
  
* Unmerged path drivers/net/ethernet/mellanox/mlx5/core/en_main.c
