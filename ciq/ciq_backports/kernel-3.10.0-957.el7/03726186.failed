netfilter: ipset: Check for comment netlink attribute length

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-957.el7
commit-author Sergey Popovich <popovich_sergei@mail.ua>
commit 037261866c8dd164c426580160973eb2d68f688c
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-957.el7/03726186.failed

Ensure userspace supplies string not longer than
IPSET_MAX_COMMENT_SIZE.

	Signed-off-by: Sergey Popovich <popovich_sergei@mail.ua>
	Signed-off-by: Jozsef Kadlecsik <kadlec@blackhole.kfki.hu>
	Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
(cherry picked from commit 037261866c8dd164c426580160973eb2d68f688c)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/netfilter/ipset/ip_set_bitmap_ip.c
#	net/netfilter/ipset/ip_set_bitmap_ipmac.c
#	net/netfilter/ipset/ip_set_bitmap_port.c
#	net/netfilter/ipset/ip_set_hash_ip.c
#	net/netfilter/ipset/ip_set_hash_ipmark.c
#	net/netfilter/ipset/ip_set_hash_ipport.c
#	net/netfilter/ipset/ip_set_hash_ipportip.c
#	net/netfilter/ipset/ip_set_hash_ipportnet.c
#	net/netfilter/ipset/ip_set_hash_mac.c
#	net/netfilter/ipset/ip_set_hash_net.c
#	net/netfilter/ipset/ip_set_hash_netiface.c
#	net/netfilter/ipset/ip_set_hash_netnet.c
#	net/netfilter/ipset/ip_set_hash_netport.c
#	net/netfilter/ipset/ip_set_hash_netportnet.c
#	net/netfilter/ipset/ip_set_list_set.c
diff --cc net/netfilter/ipset/ip_set_bitmap_ip.c
index faaca51bf3fa,2fe6de46f6d0..000000000000
--- a/net/netfilter/ipset/ip_set_bitmap_ip.c
+++ b/net/netfilter/ipset/ip_set_bitmap_ip.c
@@@ -422,6 -364,11 +422,14 @@@ static struct ip_set_type bitmap_ip_typ
  		[IPSET_ATTR_LINENO]	= { .type = NLA_U32 },
  		[IPSET_ATTR_BYTES]	= { .type = NLA_U64 },
  		[IPSET_ATTR_PACKETS]	= { .type = NLA_U64 },
++<<<<<<< HEAD
++=======
+ 		[IPSET_ATTR_COMMENT]	= { .type = NLA_NUL_STRING,
+ 					    .len  = IPSET_MAX_COMMENT_SIZE },
+ 		[IPSET_ATTR_SKBMARK]	= { .type = NLA_U64 },
+ 		[IPSET_ATTR_SKBPRIO]	= { .type = NLA_U32 },
+ 		[IPSET_ATTR_SKBQUEUE]	= { .type = NLA_U16 },
++>>>>>>> 037261866c8d (netfilter: ipset: Check for comment netlink attribute length)
  	},
  	.me		= THIS_MODULE,
  };
diff --cc net/netfilter/ipset/ip_set_bitmap_ipmac.c
index b2a7bea3f7b6,eb188561d65f..000000000000
--- a/net/netfilter/ipset/ip_set_bitmap_ipmac.c
+++ b/net/netfilter/ipset/ip_set_bitmap_ipmac.c
@@@ -479,6 -401,11 +479,14 @@@ static struct ip_set_type bitmap_ipmac_
  		[IPSET_ATTR_LINENO]	= { .type = NLA_U32 },
  		[IPSET_ATTR_BYTES]	= { .type = NLA_U64 },
  		[IPSET_ATTR_PACKETS]	= { .type = NLA_U64 },
++<<<<<<< HEAD
++=======
+ 		[IPSET_ATTR_COMMENT]	= { .type = NLA_NUL_STRING,
+ 					    .len  = IPSET_MAX_COMMENT_SIZE },
+ 		[IPSET_ATTR_SKBMARK]	= { .type = NLA_U64 },
+ 		[IPSET_ATTR_SKBPRIO]	= { .type = NLA_U32 },
+ 		[IPSET_ATTR_SKBQUEUE]	= { .type = NLA_U16 },
++>>>>>>> 037261866c8d (netfilter: ipset: Check for comment netlink attribute length)
  	},
  	.me		= THIS_MODULE,
  };
diff --cc net/netfilter/ipset/ip_set_bitmap_port.c
index 3fcb6e11fac3,898edb693b3f..000000000000
--- a/net/netfilter/ipset/ip_set_bitmap_port.c
+++ b/net/netfilter/ipset/ip_set_bitmap_port.c
@@@ -350,6 -294,11 +350,14 @@@ static struct ip_set_type bitmap_port_t
  		[IPSET_ATTR_LINENO]	= { .type = NLA_U32 },
  		[IPSET_ATTR_BYTES]	= { .type = NLA_U64 },
  		[IPSET_ATTR_PACKETS]	= { .type = NLA_U64 },
++<<<<<<< HEAD
++=======
+ 		[IPSET_ATTR_COMMENT]	= { .type = NLA_NUL_STRING,
+ 					    .len  = IPSET_MAX_COMMENT_SIZE },
+ 		[IPSET_ATTR_SKBMARK]	= { .type = NLA_U64 },
+ 		[IPSET_ATTR_SKBPRIO]	= { .type = NLA_U32 },
+ 		[IPSET_ATTR_SKBQUEUE]	= { .type = NLA_U16 },
++>>>>>>> 037261866c8d (netfilter: ipset: Check for comment netlink attribute length)
  	},
  	.me		= THIS_MODULE,
  };
diff --cc net/netfilter/ipset/ip_set_hash_ip.c
index aed8a8ef66da,ee7a72b13a5a..000000000000
--- a/net/netfilter/ipset/ip_set_hash_ip.c
+++ b/net/netfilter/ipset/ip_set_hash_ip.c
@@@ -324,6 -304,11 +324,14 @@@ static struct ip_set_type hash_ip_type 
  		[IPSET_ATTR_LINENO]	= { .type = NLA_U32 },
  		[IPSET_ATTR_BYTES]	= { .type = NLA_U64 },
  		[IPSET_ATTR_PACKETS]	= { .type = NLA_U64 },
++<<<<<<< HEAD
++=======
+ 		[IPSET_ATTR_COMMENT]	= { .type = NLA_NUL_STRING,
+ 					    .len  = IPSET_MAX_COMMENT_SIZE },
+ 		[IPSET_ATTR_SKBMARK]	= { .type = NLA_U64 },
+ 		[IPSET_ATTR_SKBPRIO]	= { .type = NLA_U32 },
+ 		[IPSET_ATTR_SKBQUEUE]	= { .type = NLA_U16 },
++>>>>>>> 037261866c8d (netfilter: ipset: Check for comment netlink attribute length)
  	},
  	.me		= THIS_MODULE,
  };
diff --cc net/netfilter/ipset/ip_set_hash_ipmark.c
index 7a2d6c3557bb,6ac7073fc850..000000000000
--- a/net/netfilter/ipset/ip_set_hash_ipmark.c
+++ b/net/netfilter/ipset/ip_set_hash_ipmark.c
@@@ -291,7 -310,11 +291,15 @@@ static struct ip_set_type hash_ipmark_t
  		[IPSET_ATTR_LINENO]	= { .type = NLA_U32 },
  		[IPSET_ATTR_BYTES]	= { .type = NLA_U64 },
  		[IPSET_ATTR_PACKETS]	= { .type = NLA_U64 },
++<<<<<<< HEAD
 +		[IPSET_ATTR_COMMENT]	= { .type = NLA_NUL_STRING },
++=======
+ 		[IPSET_ATTR_COMMENT]	= { .type = NLA_NUL_STRING,
+ 					    .len  = IPSET_MAX_COMMENT_SIZE },
+ 		[IPSET_ATTR_SKBMARK]	= { .type = NLA_U64 },
+ 		[IPSET_ATTR_SKBPRIO]	= { .type = NLA_U32 },
+ 		[IPSET_ATTR_SKBQUEUE]	= { .type = NLA_U16 },
++>>>>>>> 037261866c8d (netfilter: ipset: Check for comment netlink attribute length)
  	},
  	.me		= THIS_MODULE,
  };
diff --cc net/netfilter/ipset/ip_set_hash_ipport.c
index 6e6d26fd02ea,a3117d4ec267..000000000000
--- a/net/netfilter/ipset/ip_set_hash_ipport.c
+++ b/net/netfilter/ipset/ip_set_hash_ipport.c
@@@ -419,6 -373,11 +419,14 @@@ static struct ip_set_type hash_ipport_t
  		[IPSET_ATTR_LINENO]	= { .type = NLA_U32 },
  		[IPSET_ATTR_BYTES]	= { .type = NLA_U64 },
  		[IPSET_ATTR_PACKETS]	= { .type = NLA_U64 },
++<<<<<<< HEAD
++=======
+ 		[IPSET_ATTR_COMMENT]	= { .type = NLA_NUL_STRING,
+ 					    .len  = IPSET_MAX_COMMENT_SIZE },
+ 		[IPSET_ATTR_SKBMARK]	= { .type = NLA_U64 },
+ 		[IPSET_ATTR_SKBPRIO]	= { .type = NLA_U32 },
+ 		[IPSET_ATTR_SKBQUEUE]	= { .type = NLA_U16 },
++>>>>>>> 037261866c8d (netfilter: ipset: Check for comment netlink attribute length)
  	},
  	.me		= THIS_MODULE,
  };
diff --cc net/netfilter/ipset/ip_set_hash_ipportip.c
index 24b9417eb2c5,89615f134845..000000000000
--- a/net/netfilter/ipset/ip_set_hash_ipportip.c
+++ b/net/netfilter/ipset/ip_set_hash_ipportip.c
@@@ -437,6 -385,11 +437,14 @@@ static struct ip_set_type hash_ipportip
  		[IPSET_ATTR_LINENO]	= { .type = NLA_U32 },
  		[IPSET_ATTR_BYTES]	= { .type = NLA_U64 },
  		[IPSET_ATTR_PACKETS]	= { .type = NLA_U64 },
++<<<<<<< HEAD
++=======
+ 		[IPSET_ATTR_COMMENT]	= { .type = NLA_NUL_STRING,
+ 					    .len  = IPSET_MAX_COMMENT_SIZE },
+ 		[IPSET_ATTR_SKBMARK]	= { .type = NLA_U64 },
+ 		[IPSET_ATTR_SKBPRIO]	= { .type = NLA_U32 },
+ 		[IPSET_ATTR_SKBQUEUE]	= { .type = NLA_U16 },
++>>>>>>> 037261866c8d (netfilter: ipset: Check for comment netlink attribute length)
  	},
  	.me		= THIS_MODULE,
  };
diff --cc net/netfilter/ipset/ip_set_hash_ipportnet.c
index bb1a8e8f02c9,6ba7a7e083f9..000000000000
--- a/net/netfilter/ipset/ip_set_hash_ipportnet.c
+++ b/net/netfilter/ipset/ip_set_hash_ipportnet.c
@@@ -600,6 -544,11 +600,14 @@@ static struct ip_set_type hash_ipportne
  		[IPSET_ATTR_LINENO]	= { .type = NLA_U32 },
  		[IPSET_ATTR_BYTES]	= { .type = NLA_U64 },
  		[IPSET_ATTR_PACKETS]	= { .type = NLA_U64 },
++<<<<<<< HEAD
++=======
+ 		[IPSET_ATTR_COMMENT]	= { .type = NLA_NUL_STRING,
+ 					    .len  = IPSET_MAX_COMMENT_SIZE },
+ 		[IPSET_ATTR_SKBMARK]	= { .type = NLA_U64 },
+ 		[IPSET_ATTR_SKBPRIO]	= { .type = NLA_U32 },
+ 		[IPSET_ATTR_SKBQUEUE]	= { .type = NLA_U16 },
++>>>>>>> 037261866c8d (netfilter: ipset: Check for comment netlink attribute length)
  	},
  	.me		= THIS_MODULE,
  };
diff --cc net/netfilter/ipset/ip_set_hash_net.c
index 0a64dad156d9,2e63dad8644d..000000000000
--- a/net/netfilter/ipset/ip_set_hash_net.c
+++ b/net/netfilter/ipset/ip_set_hash_net.c
@@@ -425,6 -386,11 +425,14 @@@ static struct ip_set_type hash_net_typ
  		[IPSET_ATTR_CADT_FLAGS]	= { .type = NLA_U32 },
  		[IPSET_ATTR_BYTES]	= { .type = NLA_U64 },
  		[IPSET_ATTR_PACKETS]	= { .type = NLA_U64 },
++<<<<<<< HEAD
++=======
+ 		[IPSET_ATTR_COMMENT]	= { .type = NLA_NUL_STRING,
+ 					    .len  = IPSET_MAX_COMMENT_SIZE },
+ 		[IPSET_ATTR_SKBMARK]	= { .type = NLA_U64 },
+ 		[IPSET_ATTR_SKBPRIO]	= { .type = NLA_U32 },
+ 		[IPSET_ATTR_SKBQUEUE]	= { .type = NLA_U16 },
++>>>>>>> 037261866c8d (netfilter: ipset: Check for comment netlink attribute length)
  	},
  	.me		= THIS_MODULE,
  };
diff --cc net/netfilter/ipset/ip_set_hash_netiface.c
index 8bdeb0791689,07920b60bbf8..000000000000
--- a/net/netfilter/ipset/ip_set_hash_netiface.c
+++ b/net/netfilter/ipset/ip_set_hash_netiface.c
@@@ -684,6 -616,11 +684,14 @@@ static struct ip_set_type hash_netiface
  		[IPSET_ATTR_LINENO]	= { .type = NLA_U32 },
  		[IPSET_ATTR_BYTES]	= { .type = NLA_U64 },
  		[IPSET_ATTR_PACKETS]	= { .type = NLA_U64 },
++<<<<<<< HEAD
++=======
+ 		[IPSET_ATTR_COMMENT]	= { .type = NLA_NUL_STRING,
+ 					    .len  = IPSET_MAX_COMMENT_SIZE },
+ 		[IPSET_ATTR_SKBMARK]	= { .type = NLA_U64 },
+ 		[IPSET_ATTR_SKBPRIO]	= { .type = NLA_U32 },
+ 		[IPSET_ATTR_SKBQUEUE]	= { .type = NLA_U16 },
++>>>>>>> 037261866c8d (netfilter: ipset: Check for comment netlink attribute length)
  	},
  	.me		= THIS_MODULE,
  };
diff --cc net/netfilter/ipset/ip_set_hash_netport.c
index d98a685cd916,8273819c1a2f..000000000000
--- a/net/netfilter/ipset/ip_set_hash_netport.c
+++ b/net/netfilter/ipset/ip_set_hash_netport.c
@@@ -542,6 -492,11 +542,14 @@@ static struct ip_set_type hash_netport_
  		[IPSET_ATTR_CADT_FLAGS]	= { .type = NLA_U32 },
  		[IPSET_ATTR_BYTES]	= { .type = NLA_U64 },
  		[IPSET_ATTR_PACKETS]	= { .type = NLA_U64 },
++<<<<<<< HEAD
++=======
+ 		[IPSET_ATTR_COMMENT]	= { .type = NLA_NUL_STRING,
+ 					    .len  = IPSET_MAX_COMMENT_SIZE },
+ 		[IPSET_ATTR_SKBMARK]	= { .type = NLA_U64 },
+ 		[IPSET_ATTR_SKBPRIO]	= { .type = NLA_U32 },
+ 		[IPSET_ATTR_SKBQUEUE]	= { .type = NLA_U16 },
++>>>>>>> 037261866c8d (netfilter: ipset: Check for comment netlink attribute length)
  	},
  	.me		= THIS_MODULE,
  };
diff --cc net/netfilter/ipset/ip_set_list_set.c
index a9a97c07ecb4,5bd3b1eae3fa..000000000000
--- a/net/netfilter/ipset/ip_set_list_set.c
+++ b/net/netfilter/ipset/ip_set_list_set.c
@@@ -725,6 -678,11 +725,14 @@@ static struct ip_set_type list_set_typ
  		[IPSET_ATTR_CADT_FLAGS]	= { .type = NLA_U32 },
  		[IPSET_ATTR_BYTES]	= { .type = NLA_U64 },
  		[IPSET_ATTR_PACKETS]	= { .type = NLA_U64 },
++<<<<<<< HEAD
++=======
+ 		[IPSET_ATTR_COMMENT]	= { .type = NLA_NUL_STRING,
+ 					    .len  = IPSET_MAX_COMMENT_SIZE },
+ 		[IPSET_ATTR_SKBMARK]	= { .type = NLA_U64 },
+ 		[IPSET_ATTR_SKBPRIO]	= { .type = NLA_U32 },
+ 		[IPSET_ATTR_SKBQUEUE]	= { .type = NLA_U16 },
++>>>>>>> 037261866c8d (netfilter: ipset: Check for comment netlink attribute length)
  	},
  	.me		= THIS_MODULE,
  };
* Unmerged path net/netfilter/ipset/ip_set_hash_mac.c
* Unmerged path net/netfilter/ipset/ip_set_hash_netnet.c
* Unmerged path net/netfilter/ipset/ip_set_hash_netportnet.c
* Unmerged path net/netfilter/ipset/ip_set_bitmap_ip.c
* Unmerged path net/netfilter/ipset/ip_set_bitmap_ipmac.c
* Unmerged path net/netfilter/ipset/ip_set_bitmap_port.c
* Unmerged path net/netfilter/ipset/ip_set_hash_ip.c
* Unmerged path net/netfilter/ipset/ip_set_hash_ipmark.c
* Unmerged path net/netfilter/ipset/ip_set_hash_ipport.c
* Unmerged path net/netfilter/ipset/ip_set_hash_ipportip.c
* Unmerged path net/netfilter/ipset/ip_set_hash_ipportnet.c
* Unmerged path net/netfilter/ipset/ip_set_hash_mac.c
* Unmerged path net/netfilter/ipset/ip_set_hash_net.c
* Unmerged path net/netfilter/ipset/ip_set_hash_netiface.c
* Unmerged path net/netfilter/ipset/ip_set_hash_netnet.c
* Unmerged path net/netfilter/ipset/ip_set_hash_netport.c
* Unmerged path net/netfilter/ipset/ip_set_hash_netportnet.c
* Unmerged path net/netfilter/ipset/ip_set_list_set.c
