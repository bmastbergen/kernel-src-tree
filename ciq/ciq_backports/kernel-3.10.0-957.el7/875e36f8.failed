HID: hid-sensor-hub: Fix buggy report descriptors

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-957.el7
Rebuild_CHGLOG: - [hid] hid-sensor-hub: Fix buggy report descriptors (Tony Camuso) [1559170]
Rebuild_FUZZ: 94.62%
commit-author Srinivas Pandruvada <srinivas.pandruvada@linux.intel.com>
commit 875e36f8a2ce6cfc2010af6c91fb5351bd530d48
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-957.el7/875e36f8.failed

This addresses regression caused by commit id "751d17e23a9f7"
 iio: hid-sensors: Fix power and report state.
This commit removed a quirk, to change the enumeration base
to 1 from 0 based on an CONFIG paramter. There was objection to
add more changes under this quirk, instead suggested to add an
HID quirk. But there is no easy way to add HID qurik as the
reports are not properly using collection class.

The solution was to use logical minimum, which is a correct way.
There were changes done in firmware to address this.

Unfortunately some devices, still use old FW and can't be upgraded
to newer version on Linux devices as there is no FW upgrade tool
available for Linux devices. So we need to fix report descriptors,
for such devices. This will not have any impact, if the FW uses
logical 1 as minimum.

In this patch we look for usage id for "power and report state", and
modify logical minimum value to 1.

Background on enum:
In the original HID sensor hub firmwares all Named array enums were
to 0-based. But the most recent hub implemented as 1-based,
because of the implementation by one of the major OS vendor.
Using logical minimum for the field as the base of enum. So we add
logical minimum to the selector values before setting those fields.
Some sensor hub FWs already changed logical minimum from 0 to 1
to reflect this and hope every other vendor will follow.
There is no easy way to add a common HID quirk for NAry elements,
even if the standard specifies these field as NAry, the collection
used to describe selectors is still just "logical".

	Signed-off-by: Srinivas Pandruvada <srinivas.pandruvada@linux.intel.com>
	Signed-off-by: Jiri Kosina <jkosina@suse.cz>
(cherry picked from commit 875e36f8a2ce6cfc2010af6c91fb5351bd530d48)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/hid/hid-sensor-hub.c
diff --cc drivers/hid/hid-sensor-hub.c
index ec7cae7d2cb8,46f4480035bc..000000000000
--- a/drivers/hid/hid-sensor-hub.c
+++ b/drivers/hid/hid-sensor-hub.c
@@@ -654,7 -660,10 +692,14 @@@ static void sensor_hub_remove(struct hi
  
  static const struct hid_device_id sensor_hub_devices[] = {
  	{ HID_DEVICE(HID_BUS_ANY, HID_GROUP_SENSOR_HUB, USB_VENDOR_ID_INTEL_0,
++<<<<<<< HEAD
 +			0x22D8),
++=======
+ 			USB_DEVICE_ID_INTEL_HID_SENSOR),
+ 			.driver_data = HID_SENSOR_HUB_ENUM_QUIRK},
+ 	{ HID_DEVICE(HID_BUS_ANY, HID_GROUP_SENSOR_HUB, USB_VENDOR_ID_INTEL_1,
+ 			USB_DEVICE_ID_INTEL_HID_SENSOR),
++>>>>>>> 875e36f8a2ce (HID: hid-sensor-hub: Fix buggy report descriptors)
  			.driver_data = HID_SENSOR_HUB_ENUM_QUIRK},
  	{ HID_DEVICE(HID_BUS_ANY, HID_GROUP_SENSOR_HUB, HID_ANY_ID,
  		     HID_ANY_ID) },
@@@ -668,10 -677,11 +713,11 @@@ static struct hid_driver sensor_hub_dri
  	.probe = sensor_hub_probe,
  	.remove = sensor_hub_remove,
  	.raw_event = sensor_hub_raw_event,
+ 	.report_fixup = sensor_hub_report_fixup,
  #ifdef CONFIG_PM
  	.suspend = sensor_hub_suspend,
 -	.resume = sensor_hub_resume,
 -	.reset_resume = sensor_hub_reset_resume,
 +	.resume =  sensor_hub_resume,
 +	.reset_resume =  sensor_hub_reset_resume,
  #endif
  };
  module_hid_driver(sensor_hub_driver);
diff --git a/drivers/hid/hid-ids.h b/drivers/hid/hid-ids.h
index afd083843745..5f068dc5fb6c 100644
--- a/drivers/hid/hid-ids.h
+++ b/drivers/hid/hid-ids.h
@@ -471,6 +471,10 @@
 #define USB_VENDOR_ID_ILITEK		0x222a
 #define USB_DEVICE_ID_ILITEK_MULTITOUCH	0x0001
 
+#define USB_VENDOR_ID_INTEL_0		0x8086
+#define USB_VENDOR_ID_INTEL_1		0x8087
+#define USB_DEVICE_ID_INTEL_HID_SENSOR	0x09fa
+
 #define USB_VENDOR_ID_ION		0x15e4
 #define USB_DEVICE_ID_ICADE		0x0132
 
* Unmerged path drivers/hid/hid-sensor-hub.c
