r8169: remove nr_frags argument from rtl_tx_slots_avail

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-315.el8
commit-author Heiner Kallweit <hkallweit1@gmail.com>
commit 83c317d7b36bb3858cf1cb86d2635ec3f3bd6ea3
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-315.el8/83c317d7.failed

The only time when nr_frags isn't SKB_MAX_FRAGS is when entering
rtl8169_start_xmit(). However we can use SKB_MAX_FRAGS also here
because when queue isn't stopped there should always be room for
MAX_SKB_FRAGS + 1 descriptors.

	Signed-off-by: Heiner Kallweit <hkallweit1@gmail.com>
Link: https://lore.kernel.org/r/3d1f2ad7-31d5-2cac-4f4a-394f8a3cab63@gmail.com
	Signed-off-by: Jakub Kicinski <kuba@kernel.org>
(cherry picked from commit 83c317d7b36bb3858cf1cb86d2635ec3f3bd6ea3)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/realtek/r8169_main.c
diff --cc drivers/net/ethernet/realtek/r8169_main.c
index 4d5bc5246c0e,04101a81322f..000000000000
--- a/drivers/net/ethernet/realtek/r8169_main.c
+++ b/drivers/net/ethernet/realtek/r8169_main.c
@@@ -4226,9 -4225,9 +4225,9 @@@ static netdev_tx_t rtl8169_start_xmit(s
  	/* rtl_tx needs to see descriptor changes before updated tp->cur_tx */
  	smp_wmb();
  
 -	WRITE_ONCE(tp->cur_tx, tp->cur_tx + frags + 1);
 +	tp->cur_tx += frags + 1;
  
- 	stop_queue = !rtl_tx_slots_avail(tp, MAX_SKB_FRAGS);
+ 	stop_queue = !rtl_tx_slots_avail(tp);
  	if (unlikely(stop_queue)) {
  		/* Avoid wrongly optimistic queue wake-up: rtl_tx thread must
  		 * not miss a ring update when it notices a stopped queue.
@@@ -4249,11 -4241,15 +4248,16 @@@
  		 * status and forget to wake up queue, a racing rtl_tx thread
  		 * can't.
  		 */
++<<<<<<< HEAD
 +		smp_mb();
 +		if (rtl_tx_slots_avail(tp, MAX_SKB_FRAGS))
++=======
+ 		smp_mb__after_atomic();
+ 		if (rtl_tx_slots_avail(tp))
++>>>>>>> 83c317d7b36b (r8169: remove nr_frags argument from rtl_tx_slots_avail)
  			netif_start_queue(dev);
 -		door_bell = true;
  	}
  
 -	if (door_bell)
 -		rtl8169_doorbell(tp);
 -
  	return NETDEV_TX_OK;
  
  err_dma_1:
* Unmerged path drivers/net/ethernet/realtek/r8169_main.c
