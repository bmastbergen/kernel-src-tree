mt76: mt7615: keep mcu_add_bss_info enabled till interface removal

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-315.el8
commit-author Ryder Lee <ryder.lee@mediatek.com>
commit d9852ab2f362fc4fcf501f4350d007b08559ccc1
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-315.el8/d9852ab2.failed

BSS_INFO_BASIC is never called alone with inactive state, which always
follows beacon offload disable, so keep it enabled throughout interfaces
life cycle. Inactive state also removes sta record of all connected
stations, thurs causes connection lost which defeats the purpose of CSA.

Lastly, this is especially an unexpected behavior that keeping mt7622
failing beacon buffer recyled when scanning channels.

bss_conf change is updated with active state only, so just overwrite it.

	Signed-off-by: Ryder Lee <ryder.lee@mediatek.com>
	Signed-off-by: Felix Fietkau <nbd@nbd.name>
(cherry picked from commit d9852ab2f362fc4fcf501f4350d007b08559ccc1)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/wireless/mediatek/mt76/mt7615/main.c
diff --cc drivers/net/wireless/mediatek/mt76/mt7615/main.c
index f8409002c8b6,e30b256784e0..000000000000
--- a/drivers/net/wireless/mediatek/mt76/mt7615/main.c
+++ b/drivers/net/wireless/mediatek/mt76/mt7615/main.c
@@@ -248,11 -253,12 +248,16 @@@ static void mt7615_remove_interface(str
  	struct mt7615_phy *phy = mt7615_hw_phy(hw);
  	int idx = msta->wcid.idx;
  
- 	/* TODO: disable beacon for the bss */
- 
  	mt7615_mutex_acquire(dev);
  
++<<<<<<< HEAD
 +	mt76_testmode_reset(&dev->mt76, true);
++=======
+ 	mt7615_mcu_add_bss_info(phy, vif, NULL, false);
+ 	mt7615_mcu_sta_add(phy, vif, NULL, false);
+ 
+ 	mt76_testmode_reset(phy->mt76, true);
++>>>>>>> d9852ab2f362 (mt76: mt7615: keep mcu_add_bss_info enabled till interface removal)
  	if (vif == phy->monitor_vif)
  	    phy->monitor_vif = NULL;
  
@@@ -543,11 -559,11 +548,17 @@@ static void mt7615_bss_info_changed(str
  		}
  	}
  
++<<<<<<< HEAD
 +	if (changed & BSS_CHANGED_BEACON_ENABLED) {
 +		mt7615_mcu_add_bss_info(phy, vif, NULL, info->enable_beacon);
 +		mt7615_mcu_sta_add(dev, vif, NULL, info->enable_beacon);
++=======
+ 	if (changed & BSS_CHANGED_BEACON_ENABLED && info->enable_beacon) {
+ 		mt7615_mcu_add_bss_info(phy, vif, NULL, true);
+ 		mt7615_mcu_sta_add(phy, vif, NULL, true);
++>>>>>>> d9852ab2f362 (mt76: mt7615: keep mcu_add_bss_info enabled till interface removal)
  
- 		if (vif->p2p && info->enable_beacon)
+ 		if (vif->p2p)
  			mt7615_mcu_set_p2p_oppps(hw, vif);
  	}
  
* Unmerged path drivers/net/wireless/mediatek/mt76/mt7615/main.c
