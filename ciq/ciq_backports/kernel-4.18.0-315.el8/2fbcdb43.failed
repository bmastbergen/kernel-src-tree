mt76: reduce q->lock hold time

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-315.el8
commit-author Felix Fietkau <nbd@nbd.name>
commit 2fbcdb4386dda0a911b5485b33468540716251f8
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-315.el8/2fbcdb43.failed

Instead of holding it for the duration of an entire station schedule run,
which can block out competing tasks for a significant amount of time,
only hold it for scheduling one batch of packets for one station.
Improves responsiveness under load

	Signed-off-by: Felix Fietkau <nbd@nbd.name>
(cherry picked from commit 2fbcdb4386dda0a911b5485b33468540716251f8)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/wireless/mediatek/mt76/tx.c
diff --cc drivers/net/wireless/mediatek/mt76/tx.c
index 2d82e401427b,b8fe8adc43a3..000000000000
--- a/drivers/net/wireless/mediatek/mt76/tx.c
+++ b/drivers/net/wireless/mediatek/mt76/tx.c
@@@ -462,8 -467,10 +461,15 @@@ mt76_txq_schedule_list(struct mt76_phy 
  			break;
  		}
  
++<<<<<<< HEAD
 +		if (mt76_txq_stopped(q))
 +			break;
++=======
+ 		if (dev->queue_ops->tx_cleanup &&
+ 		    q->queued + 2 * MT_TXQ_FREE_THR >= q->ndesc) {
+ 			dev->queue_ops->tx_cleanup(dev, q, false);
+ 		}
++>>>>>>> 2fbcdb4386dd (mt76: reduce q->lock hold time)
  
  		txq = ieee80211_next_txq(phy->hw, qid);
  		if (!txq)
* Unmerged path drivers/net/wireless/mediatek/mt76/tx.c
