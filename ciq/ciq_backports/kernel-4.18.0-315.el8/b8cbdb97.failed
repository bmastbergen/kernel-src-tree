mt76: testmode: add attributes for ipg related parameters

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-315.el8
commit-author Shayne Chen <shayne.chen@mediatek.com>
commit b8cbdb97437c0e0c8370c650d51a7bcb165e5fed
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-315.el8/b8cbdb97.failed

Add attributes for setting tx inter-packet gap (ipg), duty cycle, and
transmission time in testmode.

	Signed-off-by: Shayne Chen <shayne.chen@mediatek.com>
	Signed-off-by: Felix Fietkau <nbd@nbd.name>
(cherry picked from commit b8cbdb97437c0e0c8370c650d51a7bcb165e5fed)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/wireless/mediatek/mt76/testmode.c
#	drivers/net/wireless/mediatek/mt76/testmode.h
diff --cc drivers/net/wireless/mediatek/mt76/testmode.c
index d1b171697e28,74cadf51df55..000000000000
--- a/drivers/net/wireless/mediatek/mt76/testmode.c
+++ b/drivers/net/wireless/mediatek/mt76/testmode.c
@@@ -14,8 -14,12 +14,11 @@@ static const struct nla_policy mt76_tm_
  	[MT76_TM_ATTR_TX_RATE_STBC] = { .type = NLA_U8 },
  	[MT76_TM_ATTR_TX_LTF] = { .type = NLA_U8 },
  	[MT76_TM_ATTR_TX_ANTENNA] = { .type = NLA_U8 },
 -	[MT76_TM_ATTR_TX_SPE_IDX] = { .type = NLA_U8 },
  	[MT76_TM_ATTR_TX_POWER_CONTROL] = { .type = NLA_U8 },
  	[MT76_TM_ATTR_TX_POWER] = { .type = NLA_NESTED },
+ 	[MT76_TM_ATTR_TX_DUTY_CYCLE] = { .type = NLA_U8 },
+ 	[MT76_TM_ATTR_TX_IPG] = { .type = NLA_U32 },
+ 	[MT76_TM_ATTR_TX_TIME] = { .type = NLA_U32 },
  	[MT76_TM_ATTR_FREQ_OFFSET] = { .type = NLA_U32 },
  };
  
@@@ -347,8 -361,11 +350,16 @@@ int mt76_testmode_cmd(struct ieee80211_
  	    mt76_tm_get_u8(tb[MT76_TM_ATTR_TX_RATE_LDPC], &td->tx_rate_ldpc, 0, 1) ||
  	    mt76_tm_get_u8(tb[MT76_TM_ATTR_TX_RATE_STBC], &td->tx_rate_stbc, 0, 1) ||
  	    mt76_tm_get_u8(tb[MT76_TM_ATTR_TX_LTF], &td->tx_ltf, 0, 2) ||
++<<<<<<< HEAD
 +	    mt76_tm_get_u8(tb[MT76_TM_ATTR_TX_ANTENNA], &td->tx_antenna_mask, 1,
 +			   phy->antenna_mask) ||
++=======
+ 	    mt76_tm_get_u8(tb[MT76_TM_ATTR_TX_ANTENNA], &td->tx_antenna_mask,
+ 			   1 << (ext_phy * 2), phy->antenna_mask << (ext_phy * 2)) ||
+ 	    mt76_tm_get_u8(tb[MT76_TM_ATTR_TX_SPE_IDX], &td->tx_spe_idx, 0, 27) ||
+ 	    mt76_tm_get_u8(tb[MT76_TM_ATTR_TX_DUTY_CYCLE],
+ 			   &td->tx_duty_cycle, 0, 99) ||
++>>>>>>> b8cbdb97437c (mt76: testmode: add attributes for ipg related parameters)
  	    mt76_tm_get_u8(tb[MT76_TM_ATTR_TX_POWER_CONTROL],
  			   &td->tx_power_control, 0, 1))
  		goto out;
@@@ -488,6 -512,14 +505,17 @@@ int mt76_testmode_dump(struct ieee80211
  	     nla_put_u8(msg, MT76_TM_ATTR_TX_LTF, td->tx_ltf)) ||
  	    (mt76_testmode_param_present(td, MT76_TM_ATTR_TX_ANTENNA) &&
  	     nla_put_u8(msg, MT76_TM_ATTR_TX_ANTENNA, td->tx_antenna_mask)) ||
++<<<<<<< HEAD
++=======
+ 	    (mt76_testmode_param_present(td, MT76_TM_ATTR_TX_SPE_IDX) &&
+ 	     nla_put_u8(msg, MT76_TM_ATTR_TX_SPE_IDX, td->tx_spe_idx)) ||
+ 	    (mt76_testmode_param_present(td, MT76_TM_ATTR_TX_DUTY_CYCLE) &&
+ 	     nla_put_u8(msg, MT76_TM_ATTR_TX_DUTY_CYCLE, td->tx_duty_cycle)) ||
+ 	    (mt76_testmode_param_present(td, MT76_TM_ATTR_TX_IPG) &&
+ 	     nla_put_u32(msg, MT76_TM_ATTR_TX_IPG, td->tx_ipg)) ||
+ 	    (mt76_testmode_param_present(td, MT76_TM_ATTR_TX_TIME) &&
+ 	     nla_put_u32(msg, MT76_TM_ATTR_TX_TIME, td->tx_time)) ||
++>>>>>>> b8cbdb97437c (mt76: testmode: add attributes for ipg related parameters)
  	    (mt76_testmode_param_present(td, MT76_TM_ATTR_TX_POWER_CONTROL) &&
  	     nla_put_u8(msg, MT76_TM_ATTR_TX_POWER_CONTROL, td->tx_power_control)) ||
  	    (mt76_testmode_param_present(td, MT76_TM_ATTR_FREQ_OFFSET) &&
diff --cc drivers/net/wireless/mediatek/mt76/testmode.h
index 7efad685a17c,90c4b2af5b01..000000000000
--- a/drivers/net/wireless/mediatek/mt76/testmode.h
+++ b/drivers/net/wireless/mediatek/mt76/testmode.h
@@@ -35,6 -35,13 +35,16 @@@
   * @MT76_TM_ATTR_FREQ_OFFSET: RF frequency offset (u32)
   *
   * @MT76_TM_ATTR_STATS: statistics (nested, see &enum mt76_testmode_stats_attr)
++<<<<<<< HEAD
++=======
+  *
+  * @MT76_TM_ATTR_TX_SPE_IDX: tx spatial extension index (u8)
+  *
+  * @MT76_TM_ATTR_TX_DUTY_CYCLE: packet tx duty cycle (u8)
+  * @MT76_TM_ATTR_TX_IPG: tx inter-packet gap, in unit of us (u32)
+  * @MT76_TM_ATTR_TX_TIME: packet transmission time, in unit of us (u32)
+  *
++>>>>>>> b8cbdb97437c (mt76: testmode: add attributes for ipg related parameters)
   */
  enum mt76_testmode_attr {
  	MT76_TM_ATTR_UNSPEC,
@@@ -63,6 -70,12 +73,15 @@@
  
  	MT76_TM_ATTR_STATS,
  
++<<<<<<< HEAD
++=======
+ 	MT76_TM_ATTR_TX_SPE_IDX,
+ 
+ 	MT76_TM_ATTR_TX_DUTY_CYCLE,
+ 	MT76_TM_ATTR_TX_IPG,
+ 	MT76_TM_ATTR_TX_TIME,
+ 
++>>>>>>> b8cbdb97437c (mt76: testmode: add attributes for ipg related parameters)
  	/* keep last */
  	NUM_MT76_TM_ATTRS,
  	MT76_TM_ATTR_MAX = NUM_MT76_TM_ATTRS - 1,
diff --git a/drivers/net/wireless/mediatek/mt76/mt76.h b/drivers/net/wireless/mediatek/mt76/mt76.h
index b1381101ffac..0fa48e15577a 100644
--- a/drivers/net/wireless/mediatek/mt76/mt76.h
+++ b/drivers/net/wireless/mediatek/mt76/mt76.h
@@ -536,6 +536,10 @@ struct mt76_testmode_data {
 
 	u8 tx_antenna_mask;
 
+	u8 tx_duty_cycle;
+	u32 tx_time;
+	u32 tx_ipg;
+
 	u32 freq_offset;
 
 	u8 tx_power[4];
* Unmerged path drivers/net/wireless/mediatek/mt76/testmode.c
* Unmerged path drivers/net/wireless/mediatek/mt76/testmode.h
