nl80211: call cfg80211_dev_rename() under RTNL

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-315.el8
commit-author Johannes Berg <johannes.berg@intel.com>
commit 0391a45c800780f0aa33984542710451acd71b90
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-315.el8/0391a45c.failed

This is required, and we have an assertion, move the RTNL
unlock down to cover cfg80211_dev_rename().

Fixes: a05829a7222e ("cfg80211: avoid holding the RTNL when calling the driver")
	Reported-by: syzbot+ed107c5fa3e21cdcd86e@syzkaller.appspotmail.com
Link: https://lore.kernel.org/r/20210128183454.16a4ea036740.I2beeb391dc322d6f1df3ee2612e714e0a7817397@changeid
	Signed-off-by: Johannes Berg <johannes.berg@intel.com>
(cherry picked from commit 0391a45c800780f0aa33984542710451acd71b90)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/wireless/nl80211.c
diff --cc net/wireless/nl80211.c
index 6ff26d687322,3b45a9593e71..000000000000
--- a/net/wireless/nl80211.c
+++ b/net/wireless/nl80211.c
@@@ -3089,6 -3219,8 +3089,11 @@@ static int nl80211_set_wiphy(struct sk_
  	} else
  		wdev = netdev->ieee80211_ptr;
  
++<<<<<<< HEAD
++=======
+ 	wiphy_lock(&rdev->wiphy);
+ 
++>>>>>>> 0391a45c8007 (nl80211: call cfg80211_dev_rename() under RTNL)
  	/*
  	 * end workaround code, by now the rdev is available
  	 * and locked, and wdev may or may not be NULL.
@@@ -3097,9 -3229,10 +3102,10 @@@
  	if (info->attrs[NL80211_ATTR_WIPHY_NAME])
  		result = cfg80211_dev_rename(
  			rdev, nla_data(info->attrs[NL80211_ATTR_WIPHY_NAME]));
+ 	rtnl_unlock();
  
  	if (result)
 -		goto out;
 +		return result;
  
  	if (info->attrs[NL80211_ATTR_WIPHY_TXQ_PARAMS]) {
  		struct ieee80211_txq_params txq_params;
* Unmerged path net/wireless/nl80211.c
