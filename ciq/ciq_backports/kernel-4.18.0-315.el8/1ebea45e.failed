mt76: mt7915: cleanup mcu tx queue in mt7915_dma_reset()

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-315.el8
commit-author Ryder Lee <ryder.lee@mediatek.com>
commit 1ebea45ef027ee31cd50ed92903071391e792edb
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-315.el8/1ebea45e.failed

Cleanup mcu queues in mt7915_mac_reset_work().

Fixes: e637763b606b ("mt76: move mcu queues to mt76_dev q_mcu array")
	Signed-off-by: Ryder Lee <ryder.lee@mediatek.com>
	Signed-off-by: Felix Fietkau <nbd@nbd.name>
(cherry picked from commit 1ebea45ef027ee31cd50ed92903071391e792edb)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/wireless/mediatek/mt76/mt7915/mac.c
diff --cc drivers/net/wireless/mediatek/mt76/mt7915/mac.c
index fe20a844fa3b,0924ae074db2..000000000000
--- a/drivers/net/wireless/mediatek/mt76/mt7915/mac.c
+++ b/drivers/net/wireless/mediatek/mt76/mt7915/mac.c
@@@ -1462,21 -1517,36 +1462,47 @@@ mt7915_update_beacons(struct mt7915_de
  static void
  mt7915_dma_reset(struct mt7915_dev *dev)
  {
++<<<<<<< HEAD
++=======
+ 	struct mt76_phy *mphy_ext = dev->mt76.phy2;
+ 	u32 hif1_ofs = MT_WFDMA1_PCIE1_BASE - MT_WFDMA1_BASE;
++>>>>>>> 1ebea45ef027 (mt76: mt7915: cleanup mcu tx queue in mt7915_dma_reset())
  	int i;
  
  	mt76_clear(dev, MT_WFDMA0_GLO_CFG,
  		   MT_WFDMA0_GLO_CFG_TX_DMA_EN | MT_WFDMA0_GLO_CFG_RX_DMA_EN);
  	mt76_clear(dev, MT_WFDMA1_GLO_CFG,
  		   MT_WFDMA1_GLO_CFG_TX_DMA_EN | MT_WFDMA1_GLO_CFG_RX_DMA_EN);
++<<<<<<< HEAD
 +	usleep_range(1000, 2000);
 +
 +	mt76_queue_tx_cleanup(dev, dev->mt76.q_mcu[MT_MCUQ_WA], true);
 +	for (i = 0; i < __MT_TXQ_MAX; i++)
 +		mt76_queue_tx_cleanup(dev, dev->mt76.q_tx[i], true);
++=======
+ 	if (dev->hif2) {
+ 		mt76_clear(dev, MT_WFDMA0_GLO_CFG + hif1_ofs,
+ 			   (MT_WFDMA0_GLO_CFG_TX_DMA_EN |
+ 			    MT_WFDMA0_GLO_CFG_RX_DMA_EN));
+ 		mt76_clear(dev, MT_WFDMA1_GLO_CFG + hif1_ofs,
+ 			   (MT_WFDMA1_GLO_CFG_TX_DMA_EN |
+ 			    MT_WFDMA1_GLO_CFG_RX_DMA_EN));
+ 	}
  
- 	mt76_for_each_q_rx(&dev->mt76, i) {
- 		mt76_queue_rx_reset(dev, i);
+ 	usleep_range(1000, 2000);
+ 
+ 	for (i = 0; i < __MT_TXQ_MAX; i++) {
+ 		mt76_queue_tx_cleanup(dev, dev->mphy.q_tx[i], true);
+ 		if (mphy_ext)
+ 			mt76_queue_tx_cleanup(dev, mphy_ext->q_tx[i], true);
  	}
++>>>>>>> 1ebea45ef027 (mt76: mt7915: cleanup mcu tx queue in mt7915_dma_reset())
+ 
+ 	for (i = 0; i < __MT_MCUQ_MAX; i++)
+ 		mt76_queue_tx_cleanup(dev, dev->mt76.q_mcu[i], true);
+ 
+ 	mt76_for_each_q_rx(&dev->mt76, i)
+ 		mt76_queue_rx_reset(dev, i);
  
  	/* re-init prefetch settings after reset */
  	mt7915_dma_prefetch(dev);
* Unmerged path drivers/net/wireless/mediatek/mt76/mt7915/mac.c
