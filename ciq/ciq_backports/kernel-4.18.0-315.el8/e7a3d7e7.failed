xfs: drop unnecessary setfilesize helper

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-315.el8
commit-author Brian Foster <bfoster@redhat.com>
commit e7a3d7e792a5ad50583a2e6c35e72bd2ca6096f4
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-315.el8/e7a3d7e7.failed

xfs_setfilesize() is the only remaining caller of the internal
__xfs_setfilesize() helper. Fold them into a single function.

	Signed-off-by: Brian Foster <bfoster@redhat.com>
	Reviewed-by: Christoph Hellwig <hch@lst.de>
	Reviewed-by: Darrick J. Wong <djwong@kernel.org>
	Signed-off-by: Darrick J. Wong <djwong@kernel.org>
(cherry picked from commit e7a3d7e792a5ad50583a2e6c35e72bd2ca6096f4)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	fs/xfs/xfs_aops.c
diff --cc fs/xfs/xfs_aops.c
index 58e937be24ce,fb66c5d20d26..000000000000
--- a/fs/xfs/xfs_aops.c
+++ b/fs/xfs/xfs_aops.c
@@@ -95,48 -74,6 +101,51 @@@ xfs_setfilesize
  	return xfs_trans_commit(tp);
  }
  
++<<<<<<< HEAD
 +int
 +xfs_setfilesize(
 +	struct xfs_inode	*ip,
 +	xfs_off_t		offset,
 +	size_t			size)
 +{
 +	struct xfs_mount	*mp = ip->i_mount;
 +	struct xfs_trans	*tp;
 +	int			error;
 +
 +	error = xfs_trans_alloc(mp, &M_RES(mp)->tr_fsyncts, 0, 0, 0, &tp);
 +	if (error)
 +		return error;
 +
 +	return __xfs_setfilesize(ip, tp, offset, size);
 +}
 +
 +STATIC int
 +xfs_setfilesize_ioend(
 +	struct iomap_ioend	*ioend,
 +	int			error)
 +{
 +	struct xfs_inode	*ip = XFS_I(ioend->io_inode);
 +	struct xfs_trans	*tp = ioend->io_private;
 +
 +	/*
 +	 * The transaction may have been allocated in the I/O submission thread,
 +	 * thus we need to mark ourselves as being in a transaction manually.
 +	 * Similarly for freeze protection.
 +	 */
 +	current_set_flags_nested(&tp->t_pflags, PF_MEMALLOC_NOFS);
 +	__sb_writers_acquired(VFS_I(ip)->i_sb, SB_FREEZE_FS);
 +
 +	/* we abort the update if there was an IO error */
 +	if (error) {
 +		xfs_trans_cancel(tp);
 +		return error;
 +	}
 +
 +	return __xfs_setfilesize(ip, tp, ioend->io_offset, ioend->io_size);
 +}
 +
++=======
++>>>>>>> e7a3d7e792a5 (xfs: drop unnecessary setfilesize helper)
  /*
   * IO write completion.
   */
* Unmerged path fs/xfs/xfs_aops.c
