net: sched: implement action-specific terse dump

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-315.el8
commit-author Vlad Buslov <vlad@buslov.dev>
commit 94f44f28836de320a318730f4952fde8601f4b58
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-315.el8/94f44f28.failed

Allow user to request action terse dump with new flag value
TCA_FLAG_TERSE_DUMP. Only output essential action info in terse dump (kind,
stats, index and cookie, if set by the user when creating the action). This
is different from filter terse dump where index is excluded (filter can be
identified by its own handle).

Move tcf_action_dump_terse() function to the beginning of source file in
order to call it from tcf_dump_walker().

	Signed-off-by: Vlad Buslov <vlad@buslov.dev>
	Suggested-by: Jamal Hadi Salim <jhs@mojatatu.com>
	Acked-by: Cong Wang <xiyou.wangcong@gmail.com>
Link: https://lore.kernel.org/r/20201102201243.287486-1-vlad@buslov.dev
	Signed-off-by: Jakub Kicinski <kuba@kernel.org>
(cherry picked from commit 94f44f28836de320a318730f4952fde8601f4b58)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/sched/act_api.c
diff --cc net/sched/act_api.c
index 7f1649deadf2,1341c59c2f40..000000000000
--- a/net/sched/act_api.c
+++ b/net/sched/act_api.c
@@@ -1493,9 -1472,9 +1497,14 @@@ static int tcf_action_add(struct net *n
  	return ret;
  }
  
 +static u32 tcaa_root_flags_allowed = TCA_FLAG_LARGE_DUMP_ON;
  static const struct nla_policy tcaa_policy[TCA_ROOT_MAX + 1] = {
++<<<<<<< HEAD
 +	[TCA_ROOT_FLAGS] = NLA_POLICY_BITFIELD32_PTR(&tcaa_root_flags_allowed),
++=======
+ 	[TCA_ROOT_FLAGS] = NLA_POLICY_BITFIELD32(TCA_FLAG_LARGE_DUMP_ON |
+ 						 TCA_FLAG_TERSE_DUMP),
++>>>>>>> 94f44f28836d (net: sched: implement action-specific terse dump)
  	[TCA_ROOT_TIME_DELTA]      = { .type = NLA_U32 },
  };
  
diff --git a/include/uapi/linux/rtnetlink.h b/include/uapi/linux/rtnetlink.h
index d4d126e933a7..a479cc6c4649 100644
--- a/include/uapi/linux/rtnetlink.h
+++ b/include/uapi/linux/rtnetlink.h
@@ -753,8 +753,12 @@ enum {
  * actions in a dump. All dump responses will contain the number of actions
  * being dumped stored in for user app's consumption in TCA_ROOT_COUNT
  *
+ * TCA_FLAG_TERSE_DUMP user->kernel to request terse (brief) dump that only
+ * includes essential action info (kind, index, etc.)
+ *
  */
 #define TCA_FLAG_LARGE_DUMP_ON		(1 << 0)
+#define TCA_FLAG_TERSE_DUMP		(1 << 1)
 
 /* New extended info filters for IFLA_EXT_MASK */
 #define RTEXT_FILTER_VF		(1 << 0)
* Unmerged path net/sched/act_api.c
