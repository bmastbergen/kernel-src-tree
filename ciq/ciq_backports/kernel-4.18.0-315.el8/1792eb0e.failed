mt76: mt7921: enable deep sleep when the device suspends

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-315.el8
commit-author Sean Wang <sean.wang@mediatek.com>
commit 1792eb0ecdc51282d37c7ad43167d088e2bf71df
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-315.el8/1792eb0e.failed

Enable the deep sleep mode in suspend handler to reduce the power
consumption further.

	Signed-off-by: Sean Wang <sean.wang@mediatek.com>
	Signed-off-by: Felix Fietkau <nbd@nbd.name>
(cherry picked from commit 1792eb0ecdc51282d37c7ad43167d088e2bf71df)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/wireless/mediatek/mt76/mt7921/pci.c
diff --cc drivers/net/wireless/mediatek/mt76/mt7921/pci.c
index 67d7e863d855,25f27e9d379b..000000000000
--- a/drivers/net/wireless/mediatek/mt76/mt7921/pci.c
+++ b/drivers/net/wireless/mediatek/mt76/mt7921/pci.c
@@@ -218,8 -242,12 +221,12 @@@ restore
  		napi_enable(&mdev->napi[i]);
  	}
  	napi_enable(&mdev->tx_napi);
+ 
+ 	if (!dev->pm.enable)
+ 		mt76_connac_mcu_set_deep_sleep(&dev->mt76, false);
+ 
  	if (hif_suspend)
 -		mt76_connac_mcu_set_hif_suspend(mdev, false);
 +		mt7921_mcu_set_hif_suspend(dev, false);
  
  	return err;
  }
@@@ -236,6 -264,12 +243,15 @@@ static int mt7921_pci_resume(struct pci
  
  	pci_restore_state(pdev);
  
++<<<<<<< HEAD
++=======
+ 	err = mt7921_mcu_drv_pmctrl(dev);
+ 	if (err < 0)
+ 		return err;
+ 
+ 	mt7921_wpdma_reinit_cond(dev);
+ 
++>>>>>>> 1792eb0ecdc5 (mt76: mt7921: enable deep sleep when the device suspends)
  	/* enable interrupt */
  	mt76_wr(dev, MT_PCIE_MAC_INT_ENABLE, 0xff);
  	mt7921_irq_enable(dev, MT_INT_RX_DONE_ALL | MT_INT_TX_DONE_ALL |
@@@ -253,8 -288,11 +269,11 @@@
  	napi_enable(&mdev->tx_napi);
  	napi_schedule(&mdev->tx_napi);
  
+ 	if (!dev->pm.enable)
+ 		mt76_connac_mcu_set_deep_sleep(&dev->mt76, false);
+ 
  	if (!test_bit(MT76_STATE_SUSPEND, &dev->mphy.state))
 -		err = mt76_connac_mcu_set_hif_suspend(mdev, false);
 +		err = mt7921_mcu_set_hif_suspend(dev, false);
  
  	return err;
  }
* Unmerged path drivers/net/wireless/mediatek/mt76/mt7921/pci.c
