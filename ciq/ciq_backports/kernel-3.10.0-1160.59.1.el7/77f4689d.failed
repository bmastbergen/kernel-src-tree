fix regression in "epoll: Keep a reference on files added to the check list"

jira LE-1907
cve CVE-2020-0466
Rebuild_History Non-Buildable kernel-3.10.0-1160.59.1.el7
commit-author Al Viro <viro@zeniv.linux.org.uk>
commit 77f4689de17c0887775bb77896f4cc11a39bf848
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1160.59.1.el7/77f4689d.failed

epoll_loop_check_proc() can run into a file already committed to destruction;
we can't grab a reference on those and don't need to add them to the set for
reverse path check anyway.

	Tested-by: Marc Zyngier <maz@kernel.org>
Fixes: a9ed4a6560b8 ("epoll: Keep a reference on files added to the check list")
	Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>
(cherry picked from commit 77f4689de17c0887775bb77896f4cc11a39bf848)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	fs/eventpoll.c
diff --cc fs/eventpoll.c
index 6731b99a481f,8107e06d7f6f..000000000000
--- a/fs/eventpoll.c
+++ b/fs/eventpoll.c
@@@ -1750,9 -1994,11 +1750,17 @@@ static int ep_loop_check_proc(void *pri
  			 * not already there, and calling reverse_path_check()
  			 * during ep_insert().
  			 */
++<<<<<<< HEAD
 +			if (list_empty(&epi->ffd.file->f_tfile_llink))
 +				list_add(&epi->ffd.file->f_tfile_llink,
 +					 &tfile_check_list);
++=======
+ 			if (list_empty(&epi->ffd.file->f_tfile_llink)) {
+ 				if (get_file_rcu(epi->ffd.file))
+ 					list_add(&epi->ffd.file->f_tfile_llink,
+ 						 &tfile_check_list);
+ 			}
++>>>>>>> 77f4689de17c (fix regression in "epoll: Keep a reference on files added to the check list")
  		}
  	}
  	mutex_unlock(&ep->mtx);
* Unmerged path fs/eventpoll.c
