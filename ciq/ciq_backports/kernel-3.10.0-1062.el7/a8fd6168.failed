s390: report new CPU capabilities

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1062.el7
Rebuild_CHGLOG: - [s390] report new CPU capabilities (Hendrik Brueckner) [1690843]
Rebuild_FUZZ: 90.00%
commit-author Martin Schwidefsky <schwidefsky@de.ibm.com>
commit a8fd61688dfad6fdce95fa64cacd8a66595697b8
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1062.el7/a8fd6168.failed

Add hardware capability bits and features tags to /proc/cpuinfo
for 4 new CPU features:
  "Vector-Enhancements Facility 2" (tag "vxe2", hwcap 2^15)
  "Vector-Packed-Decimal-Enhancement Facility" (tag "vxp", hwcap 2^16)
  "Enhanced-Sort Facility" (tag "sort", hwcap 2^17)
  "Deflate-Conversion Facility" (tag "dflt", hwcap 2^18)

	Reviewed-by: Heiko Carstens <heiko.carstens@de.ibm.com>
	Signed-off-by: Martin Schwidefsky <schwidefsky@de.ibm.com>
(cherry picked from commit a8fd61688dfad6fdce95fa64cacd8a66595697b8)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/s390/kernel/setup.c
diff --cc arch/s390/kernel/setup.c
index 0016bfa2fe72,12d136e567c4..000000000000
--- a/arch/s390/kernel/setup.c
+++ b/arch/s390/kernel/setup.c
@@@ -950,8 -919,15 +950,19 @@@ static void __init setup_hwcaps(void
  			elf_hwcap |= HWCAP_S390_VXRS_EXT;
  		if (test_facility(135))
  			elf_hwcap |= HWCAP_S390_VXRS_BCD;
+ 		if (test_facility(148))
+ 			elf_hwcap |= HWCAP_S390_VXRS_EXT2;
+ 		if (test_facility(152))
+ 			elf_hwcap |= HWCAP_S390_VXRS_PDE;
  	}
++<<<<<<< HEAD
 +#endif
++=======
+ 	if (test_facility(150))
+ 		elf_hwcap |= HWCAP_S390_SORT;
+ 	if (test_facility(151))
+ 		elf_hwcap |= HWCAP_S390_DFLT;
++>>>>>>> a8fd61688dfa (s390: report new CPU capabilities)
  
  	/*
  	 * Guarded storage support HWCAP_S390_GS is bit 12.
diff --git a/arch/s390/include/asm/elf.h b/arch/s390/include/asm/elf.h
index acb5598e81db..7d060b7fe936 100644
--- a/arch/s390/include/asm/elf.h
+++ b/arch/s390/include/asm/elf.h
@@ -106,6 +106,10 @@
 #define HWCAP_S390_VXRS_BCD	4096
 #define HWCAP_S390_VXRS_EXT	8192
 #define HWCAP_S390_GS		16384
+#define HWCAP_S390_VXRS_EXT2	32768
+#define HWCAP_S390_VXRS_PDE	65536
+#define HWCAP_S390_SORT		131072
+#define HWCAP_S390_DFLT		262144
 
 /* Internal bits, not exposed via elf */
 #define HWCAP_INT_SIE		1UL
diff --git a/arch/s390/kernel/processor.c b/arch/s390/kernel/processor.c
index c3627d6038aa..b37b131d64b7 100644
--- a/arch/s390/kernel/processor.c
+++ b/arch/s390/kernel/processor.c
@@ -63,7 +63,8 @@ static int show_cpuinfo(struct seq_file *m, void *v)
 {
 	static const char *hwcap_str[] = {
 		"esan3", "zarch", "stfle", "msa", "ldisp", "eimm", "dfp",
-		"edat", "etf3eh", "highgprs", "te", "vx", "vxd", "vxe", "gs"
+		"edat", "etf3eh", "highgprs", "te", "vx", "vxd", "vxe", "gs",
+		"vxe2", "vxp", "sort", "dflt"
 	};
 	static const char * const int_hwcap_str[] = {
 		"sie"
* Unmerged path arch/s390/kernel/setup.c
