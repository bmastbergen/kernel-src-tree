fuse: clean up fsync

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1062.el7
commit-author Miklos Szeredi <mszeredi@suse.cz>
commit 22401e7b7a686bff02549cd648ba6f73f8dba868
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1062.el7/22401e7b.failed

Don't need to start I/O twice (once without i_mutex and one within).

Also make sure that even if the userspace filesystem doesn't support FSYNC
we do all the steps other than sending the message.

	Signed-off-by: Miklos Szeredi <mszeredi@suse.cz>
(cherry picked from commit 22401e7b7a686bff02549cd648ba6f73f8dba868)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	fs/fuse/file.c
diff --cc fs/fuse/file.c
index 109621a5f183,65586a567d0d..000000000000
--- a/fs/fuse/file.c
+++ b/fs/fuse/file.c
@@@ -499,6 -503,14 +492,17 @@@ int fuse_fsync_common(struct file *file
  
  	fuse_sync_writes(inode);
  
++<<<<<<< HEAD
++=======
+ 	if (test_bit(FUSE_I_MTIME_DIRTY, &get_fuse_inode(inode)->state)) {
+ 		err = fuse_flush_mtime(file, false);
+ 		if (err)
+ 			goto out;
+ 	}
+ 	if ((!isdir && fc->no_fsync) || (isdir && fc->no_fsyncdir))
+ 		goto out;
+ 
++>>>>>>> 22401e7b7a68 (fuse: clean up fsync)
  	req = fuse_get_req_nopages(fc);
  	if (IS_ERR(req)) {
  		err = PTR_ERR(req);
* Unmerged path fs/fuse/file.c
