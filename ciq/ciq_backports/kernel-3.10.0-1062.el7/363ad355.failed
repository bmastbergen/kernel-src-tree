RDMA/restrack: Un-inline set task implementation

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1062.el7
Rebuild_CHGLOG: - [rdma] restrack: Un-inline set task implementation (Kamal Heib) [1655923]
Rebuild_FUZZ: 94.51%
commit-author Leon Romanovsky <leonro@mellanox.com>
commit 363ad35577de3a73cf97006ec5f00fccaee73172
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1062.el7/363ad355.failed

Prepare rdma_restrack_set_task() call to accommodate more
code by moving its implementation from *.h to *.c.

	Reviewed-by: Artemy Kovalyov <artemyko@mellanox.com>
	Reviewed-by: Yossi Itigin <yosefe@mellanox.com>
	Signed-off-by: Leon Romanovsky <leonro@mellanox.com>
	Reviewed-by: Steve Wise <swise@opengridcomputing.com>
	Signed-off-by: Jason Gunthorpe <jgg@mellanox.com>
(cherry picked from commit 363ad35577de3a73cf97006ec5f00fccaee73172)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	include/rdma/restrack.h
diff --cc include/rdma/restrack.h
index 5fd84d38d838,0bddbbdbaf7c..000000000000
--- a/include/rdma/restrack.h
+++ b/include/rdma/restrack.h
@@@ -150,4 -169,23 +150,26 @@@ int __must_check rdma_restrack_get(stru
   * @res:  resource entry
   */
  int rdma_restrack_put(struct rdma_restrack_entry *res);
++<<<<<<< HEAD
++=======
+ 
+ /**
+  * rdma_restrack_set_task() - set the task for this resource
+  * @res:  resource entry
+  * @task: task struct
+  */
+ void rdma_restrack_set_task(struct rdma_restrack_entry *res,
+ 			    struct task_struct *task);
+ 
+ /*
+  * Helper functions for rdma drivers when filling out
+  * nldev driver attributes.
+  */
+ int rdma_nl_put_driver_u32(struct sk_buff *msg, const char *name, u32 value);
+ int rdma_nl_put_driver_u32_hex(struct sk_buff *msg, const char *name,
+ 			       u32 value);
+ int rdma_nl_put_driver_u64(struct sk_buff *msg, const char *name, u64 value);
+ int rdma_nl_put_driver_u64_hex(struct sk_buff *msg, const char *name,
+ 			       u64 value);
++>>>>>>> 363ad35577de (RDMA/restrack: Un-inline set task implementation)
  #endif /* _RDMA_RESTRACK_H_ */
diff --git a/drivers/infiniband/core/restrack.c b/drivers/infiniband/core/restrack.c
index 340f64074ccd..800ea7e714f2 100644
--- a/drivers/infiniband/core/restrack.c
+++ b/drivers/infiniband/core/restrack.c
@@ -131,6 +131,16 @@ static bool res_is_user(struct rdma_restrack_entry *res)
 	}
 }
 
+void rdma_restrack_set_task(struct rdma_restrack_entry *res,
+			    struct task_struct *task)
+{
+	if (res->task)
+		put_task_struct(res->task);
+	get_task_struct(task);
+	res->task = task;
+}
+EXPORT_SYMBOL(rdma_restrack_set_task);
+
 void rdma_restrack_add(struct rdma_restrack_entry *res)
 {
 	struct ib_device *dev = res_to_dev(res);
* Unmerged path include/rdma/restrack.h
