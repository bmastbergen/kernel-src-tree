cxgb4: expose stats fetched from firmware via debugfs

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1062.el7
commit-author Rahul Lakkireddy <rahul.lakkireddy@chelsio.com>
commit 31e5f5c3e92f6560485d7625f772e36aec6d42ec
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1062.el7/31e5f5c3.failed

Expose stats obtained from firmware via debugfs. These stats can't
be part of ethtool -S because the slow firmware mailbox can cause
packet drops under heavy load.

	Signed-off-by: Rahul Lakkireddy <rahul.lakkireddy@chelsio.com>
	Signed-off-by: Ganesh Goudar <ganeshgr@chelsio.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 31e5f5c3e92f6560485d7625f772e36aec6d42ec)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/chelsio/cxgb4/cxgb4_debugfs.c
diff --cc drivers/net/ethernet/chelsio/cxgb4/cxgb4_debugfs.c
index 5bd37da0d0e0,511606fd1b20..000000000000
--- a/drivers/net/ethernet/chelsio/cxgb4/cxgb4_debugfs.c
+++ b/drivers/net/ethernet/chelsio/cxgb4/cxgb4_debugfs.c
@@@ -2956,58 -3148,60 +3119,66 @@@ int t4_setup_debugfs(struct adapter *ad
  	struct dentry *de;
  
  	static struct t4_debugfs_entry t4_debugfs_files[] = {
 -		{ "cim_la", &cim_la_fops, 0400, 0 },
 -		{ "cim_pif_la", &cim_pif_la_fops, 0400, 0 },
 -		{ "cim_ma_la", &cim_ma_la_fops, 0400, 0 },
 -		{ "cim_qcfg", &cim_qcfg_fops, 0400, 0 },
 -		{ "clk", &clk_debugfs_fops, 0400, 0 },
 -		{ "devlog", &devlog_fops, 0400, 0 },
 -		{ "mboxlog", &mboxlog_fops, 0400, 0 },
 -		{ "mbox0", &mbox_debugfs_fops, 0600, 0 },
 -		{ "mbox1", &mbox_debugfs_fops, 0600, 1 },
 -		{ "mbox2", &mbox_debugfs_fops, 0600, 2 },
 -		{ "mbox3", &mbox_debugfs_fops, 0600, 3 },
 -		{ "mbox4", &mbox_debugfs_fops, 0600, 4 },
 -		{ "mbox5", &mbox_debugfs_fops, 0600, 5 },
 -		{ "mbox6", &mbox_debugfs_fops, 0600, 6 },
 -		{ "mbox7", &mbox_debugfs_fops, 0600, 7 },
 -		{ "trace0", &mps_trc_debugfs_fops, 0600, 0 },
 -		{ "trace1", &mps_trc_debugfs_fops, 0600, 1 },
 -		{ "trace2", &mps_trc_debugfs_fops, 0600, 2 },
 -		{ "trace3", &mps_trc_debugfs_fops, 0600, 3 },
 -		{ "l2t", &t4_l2t_fops, 0400, 0},
 -		{ "mps_tcam", &mps_tcam_debugfs_fops, 0400, 0 },
 -		{ "rss", &rss_debugfs_fops, 0400, 0 },
 -		{ "rss_config", &rss_config_debugfs_fops, 0400, 0 },
 -		{ "rss_key", &rss_key_debugfs_fops, 0400, 0 },
 -		{ "rss_pf_config", &rss_pf_config_debugfs_fops, 0400, 0 },
 -		{ "rss_vf_config", &rss_vf_config_debugfs_fops, 0400, 0 },
 -		{ "resources", &resources_debugfs_fops, 0400, 0 },
 -		{ "sge_qinfo", &sge_qinfo_debugfs_fops, 0400, 0 },
 -		{ "ibq_tp0",  &cim_ibq_fops, 0400, 0 },
 -		{ "ibq_tp1",  &cim_ibq_fops, 0400, 1 },
 -		{ "ibq_ulp",  &cim_ibq_fops, 0400, 2 },
 -		{ "ibq_sge0", &cim_ibq_fops, 0400, 3 },
 -		{ "ibq_sge1", &cim_ibq_fops, 0400, 4 },
 -		{ "ibq_ncsi", &cim_ibq_fops, 0400, 5 },
 -		{ "obq_ulp0", &cim_obq_fops, 0400, 0 },
 -		{ "obq_ulp1", &cim_obq_fops, 0400, 1 },
 -		{ "obq_ulp2", &cim_obq_fops, 0400, 2 },
 -		{ "obq_ulp3", &cim_obq_fops, 0400, 3 },
 -		{ "obq_sge",  &cim_obq_fops, 0400, 4 },
 -		{ "obq_ncsi", &cim_obq_fops, 0400, 5 },
 -		{ "tp_la", &tp_la_fops, 0400, 0 },
 -		{ "ulprx_la", &ulprx_la_fops, 0400, 0 },
 -		{ "sensors", &sensors_debugfs_fops, 0400, 0 },
 -		{ "pm_stats", &pm_stats_debugfs_fops, 0400, 0 },
 -		{ "tx_rate", &tx_rate_debugfs_fops, 0400, 0 },
 -		{ "cctrl", &cctrl_tbl_debugfs_fops, 0400, 0 },
 +		{ "cim_la", &cim_la_fops, S_IRUSR, 0 },
 +		{ "cim_pif_la", &cim_pif_la_fops, S_IRUSR, 0 },
 +		{ "cim_ma_la", &cim_ma_la_fops, S_IRUSR, 0 },
 +		{ "cim_qcfg", &cim_qcfg_fops, S_IRUSR, 0 },
 +		{ "clk", &clk_debugfs_fops, S_IRUSR, 0 },
 +		{ "devlog", &devlog_fops, S_IRUSR, 0 },
 +		{ "mboxlog", &mboxlog_fops, S_IRUSR, 0 },
 +		{ "mbox0", &mbox_debugfs_fops, S_IRUSR | S_IWUSR, 0 },
 +		{ "mbox1", &mbox_debugfs_fops, S_IRUSR | S_IWUSR, 1 },
 +		{ "mbox2", &mbox_debugfs_fops, S_IRUSR | S_IWUSR, 2 },
 +		{ "mbox3", &mbox_debugfs_fops, S_IRUSR | S_IWUSR, 3 },
 +		{ "mbox4", &mbox_debugfs_fops, S_IRUSR | S_IWUSR, 4 },
 +		{ "mbox5", &mbox_debugfs_fops, S_IRUSR | S_IWUSR, 5 },
 +		{ "mbox6", &mbox_debugfs_fops, S_IRUSR | S_IWUSR, 6 },
 +		{ "mbox7", &mbox_debugfs_fops, S_IRUSR | S_IWUSR, 7 },
 +		{ "trace0", &mps_trc_debugfs_fops, S_IRUSR | S_IWUSR, 0 },
 +		{ "trace1", &mps_trc_debugfs_fops, S_IRUSR | S_IWUSR, 1 },
 +		{ "trace2", &mps_trc_debugfs_fops, S_IRUSR | S_IWUSR, 2 },
 +		{ "trace3", &mps_trc_debugfs_fops, S_IRUSR | S_IWUSR, 3 },
 +		{ "l2t", &t4_l2t_fops, S_IRUSR, 0},
 +		{ "mps_tcam", &mps_tcam_debugfs_fops, S_IRUSR, 0 },
 +		{ "rss", &rss_debugfs_fops, S_IRUSR, 0 },
 +		{ "rss_config", &rss_config_debugfs_fops, S_IRUSR, 0 },
 +		{ "rss_key", &rss_key_debugfs_fops, S_IRUSR, 0 },
 +		{ "rss_pf_config", &rss_pf_config_debugfs_fops, S_IRUSR, 0 },
 +		{ "rss_vf_config", &rss_vf_config_debugfs_fops, S_IRUSR, 0 },
 +		{ "sge_qinfo", &sge_qinfo_debugfs_fops, S_IRUSR, 0 },
 +		{ "ibq_tp0",  &cim_ibq_fops, S_IRUSR, 0 },
 +		{ "ibq_tp1",  &cim_ibq_fops, S_IRUSR, 1 },
 +		{ "ibq_ulp",  &cim_ibq_fops, S_IRUSR, 2 },
 +		{ "ibq_sge0", &cim_ibq_fops, S_IRUSR, 3 },
 +		{ "ibq_sge1", &cim_ibq_fops, S_IRUSR, 4 },
 +		{ "ibq_ncsi", &cim_ibq_fops, S_IRUSR, 5 },
 +		{ "obq_ulp0", &cim_obq_fops, S_IRUSR, 0 },
 +		{ "obq_ulp1", &cim_obq_fops, S_IRUSR, 1 },
 +		{ "obq_ulp2", &cim_obq_fops, S_IRUSR, 2 },
 +		{ "obq_ulp3", &cim_obq_fops, S_IRUSR, 3 },
 +		{ "obq_sge",  &cim_obq_fops, S_IRUSR, 4 },
 +		{ "obq_ncsi", &cim_obq_fops, S_IRUSR, 5 },
 +		{ "tp_la", &tp_la_fops, S_IRUSR, 0 },
 +		{ "ulprx_la", &ulprx_la_fops, S_IRUSR, 0 },
 +		{ "sensors", &sensors_debugfs_fops, S_IRUSR, 0 },
 +		{ "pm_stats", &pm_stats_debugfs_fops, S_IRUSR, 0 },
 +		{ "tx_rate", &tx_rate_debugfs_fops, S_IRUSR, 0 },
 +		{ "cctrl", &cctrl_tbl_debugfs_fops, S_IRUSR, 0 },
  #if IS_ENABLED(CONFIG_IPV6)
 -		{ "clip_tbl", &clip_tbl_debugfs_fops, 0400, 0 },
 +		{ "clip_tbl", &clip_tbl_debugfs_fops, S_IRUSR, 0 },
  #endif
++<<<<<<< HEAD
 +		{ "tids", &tid_info_debugfs_fops, S_IRUSR, 0},
 +		{ "blocked_fl", &blocked_fl_fops, S_IRUSR | S_IWUSR, 0 },
 +		{ "meminfo", &meminfo_fops, S_IRUSR, 0 },
 +		{ "crypto", &chcr_stats_debugfs_fops, S_IRUSR, 0 },
++=======
+ 		{ "tids", &tid_info_debugfs_fops, 0400, 0},
+ 		{ "blocked_fl", &blocked_fl_fops, 0600, 0 },
+ 		{ "meminfo", &meminfo_fops, 0400, 0 },
+ 		{ "crypto", &chcr_stats_debugfs_fops, 0400, 0 },
+ 		{ "tp_stats", &tp_stats_debugfs_fops, 0400, 0 },
++>>>>>>> 31e5f5c3e92f (cxgb4: expose stats fetched from firmware via debugfs)
  	};
  
  	/* Debug FS nodes common to all T5 and later adapters.
* Unmerged path drivers/net/ethernet/chelsio/cxgb4/cxgb4_debugfs.c
