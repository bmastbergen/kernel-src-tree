ixgbe: split XDP_TX tail and XDP_REDIRECT map flushing

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1062.el7
commit-author Jesper Dangaard Brouer <brouer@redhat.com>
commit ad088ec480768850db019a5cc543685e868a513d
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1062.el7/ad088ec4.failed

The driver was combining the XDP_TX tail flush and XDP_REDIRECT
map flushing (xdp_do_flush_map).  This is suboptimal, these two
flush operations should be kept separate.

Fixes: 11393cc9b9be ("xdp: Add batching support to redirect map")
	Signed-off-by: Jesper Dangaard Brouer <brouer@redhat.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit ad088ec480768850db019a5cc543685e868a513d)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/intel/ixgbe/ixgbe_main.c
diff --cc drivers/net/ethernet/intel/ixgbe/ixgbe_main.c
index 317b448bc746,62e57b05a0ae..000000000000
--- a/drivers/net/ethernet/intel/ixgbe/ixgbe_main.c
+++ b/drivers/net/ethernet/intel/ixgbe/ixgbe_main.c
@@@ -2222,12 -2186,13 +2222,13 @@@ static struct sk_buff *ixgbe_build_skb(
  	return skb;
  }
  
- #define IXGBE_XDP_PASS 0
- #define IXGBE_XDP_CONSUMED 1
- #define IXGBE_XDP_TX 2
+ #define IXGBE_XDP_PASS		0
+ #define IXGBE_XDP_CONSUMED	BIT(0)
+ #define IXGBE_XDP_TX		BIT(1)
+ #define IXGBE_XDP_REDIR		BIT(2)
  
  static int ixgbe_xmit_xdp_ring(struct ixgbe_adapter *adapter,
 -			       struct xdp_frame *xdpf);
 +			       struct xdp_buff *xdp);
  
  static struct sk_buff *ixgbe_run_xdp(struct ixgbe_adapter *adapter,
  				     struct ixgbe_ring *rx_ring,
@@@ -2248,7 -2216,19 +2249,23 @@@
  	case XDP_PASS:
  		break;
  	case XDP_TX:
++<<<<<<< HEAD
 +		result = ixgbe_xmit_xdp_ring(adapter, xdp);
++=======
+ 		xdpf = convert_to_xdp_frame(xdp);
+ 		if (unlikely(!xdpf)) {
+ 			result = IXGBE_XDP_CONSUMED;
+ 			break;
+ 		}
+ 		result = ixgbe_xmit_xdp_ring(adapter, xdpf);
+ 		break;
+ 	case XDP_REDIRECT:
+ 		err = xdp_do_redirect(adapter->netdev, xdp, xdp_prog);
+ 		if (!err)
+ 			result = IXGBE_XDP_REDIR;
+ 		else
+ 			result = IXGBE_XDP_CONSUMED;
++>>>>>>> ad088ec48076 (ixgbe: split XDP_TX tail and XDP_REDIRECT map flushing)
  		break;
  	default:
  		bpf_warn_invalid_xdp_action(act);
* Unmerged path drivers/net/ethernet/intel/ixgbe/ixgbe_main.c
