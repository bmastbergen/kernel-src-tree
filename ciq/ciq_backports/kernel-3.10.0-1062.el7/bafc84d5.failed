efivars: Use local variables instead of a pointer dereference

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1062.el7
commit-author Matt Fleming <matt.fleming@intel.com>
commit bafc84d539c0ffa916037840df54428623abc3e6
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1062.el7/bafc84d5.failed

In order to support a compat interface we need to stop passing pointers
to structures around, since the type of structure is going to depend on
whether the current task is a compat task.

	Cc: Mike Waychison <mikew@google.com>
	Signed-off-by: Matt Fleming <matt.fleming@intel.com>
(cherry picked from commit bafc84d539c0ffa916037840df54428623abc3e6)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/firmware/efi/efivars.c
diff --cc drivers/firmware/efi/efivars.c
index 5cbba0eea363,06ec6ee1c58a..000000000000
--- a/drivers/firmware/efi/efivars.c
+++ b/drivers/firmware/efi/efivars.c
@@@ -248,12 -236,9 +260,16 @@@ efivar_store_raw(struct efivar_entry *e
  		return -EINVAL;
  	}
  
 +	mutex_lock(&entry->var_data_mutex);
  	memcpy(&entry->var, new_var, count);
  
++<<<<<<< HEAD
 +	err = efivar_entry_set(entry, new_var->Attributes,
 +			       new_var->DataSize, new_var->Data, NULL);
 +	mutex_unlock(&entry->var_data_mutex);
++=======
+ 	err = efivar_entry_set(entry, attributes, size, data, NULL);
++>>>>>>> bafc84d539c0 (efivars: Use local variables instead of a pointer dereference)
  	if (err) {
  		printk(KERN_WARNING "efivars: set_variable() failed: status=%d\n", err);
  		return -EIO;
@@@ -376,15 -363,8 +399,20 @@@ static ssize_t efivar_create(struct fil
  
  	memcpy(&new_entry->var, new_var, sizeof(*new_var));
  
++<<<<<<< HEAD
 +	mutex_init(&new_entry->var_data_mutex);
 +
 +	/*
 +	 * No need to take the var_data_mutex since new_entry is not visible
 +	 * to other threads until inserted into the efivar_sysfs_list by
 +	 * efivar_create_sysfs_entry().
 +	 */
 +	err = efivar_entry_set(new_entry, new_var->Attributes, new_var->DataSize,
 +			       new_var->Data, &efivar_sysfs_list);
++=======
+ 	err = efivar_entry_set(new_entry, attributes, size,
+ 			       data, &efivar_sysfs_list);
++>>>>>>> bafc84d539c0 (efivars: Use local variables instead of a pointer dereference)
  	if (err) {
  		if (err == -EEXIST)
  			err = -EINVAL;
* Unmerged path drivers/firmware/efi/efivars.c
