net/ipv6: Display all addresses in output of /proc/net/if_inet6

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1062.el7
Rebuild_CHGLOG: - [net] ipv6: Display all addresses in output of /proc/net/if_inet6 (Stefano Brivio) [1661408]
Rebuild_FUZZ: 96.72%
commit-author Jeff Barnhill <0xeffeff@gmail.com>
commit 86f9bd1ff61c413a2a251fa736463295e4e24733
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1062.el7/86f9bd1f.failed

The backend handling for /proc/net/if_inet6 in addrconf.c doesn't properly
handle starting/stopping the iteration.  The problem is that at some point
during the iteration, an overflow is detected and the process is
subsequently stopped.  The item being shown via seq_printf() when the
overflow occurs is not actually shown, though.  When start() is
subsequently called to resume iterating, it returns the next item, and
thus the item that was being processed when the overflow occurred never
gets printed.

Alter the meaning of the private data member "offset".  Currently, when it
is not 0 (which only happens at the very beginning), "offset" represents
the next hlist item to be printed.  After this change, "offset" always
represents the current item.

This is also consistent with the private data member "bucket", which
represents the current bucket, and also the use of "pos" as defined in
seq_file.txt:
    The pos passed to start() will always be either zero, or the most
    recent pos used in the previous session.

	Signed-off-by: Jeff Barnhill <0xeffeff@gmail.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 86f9bd1ff61c413a2a251fa736463295e4e24733)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/ipv6/addrconf.c
diff --cc net/ipv6/addrconf.c
index a8297bbf8643,c63ccce6425f..000000000000
--- a/net/ipv6/addrconf.c
+++ b/net/ipv6/addrconf.c
@@@ -3922,9 -4224,9 +3921,14 @@@ static struct inet6_ifaddr *if6_get_nex
  		return ifa;
  	}
  
+ 	state->offset = 0;
  	while (++state->bucket < IN6_ADDR_HSIZE) {
++<<<<<<< HEAD
 +		state->offset = 0;
 +		hlist_for_each_entry_rcu_bh(ifa,
++=======
+ 		hlist_for_each_entry_rcu(ifa,
++>>>>>>> 86f9bd1ff61c (net/ipv6: Display all addresses in output of /proc/net/if_inet6)
  				     &inet6_addr_lst[state->bucket], addr_lst) {
  			if (!net_eq(dev_net(ifa->idev->dev), net))
  				continue;
* Unmerged path net/ipv6/addrconf.c
