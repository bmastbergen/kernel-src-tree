net/mlx5e: Fix selftest for small MTUs

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1062.el7
Rebuild_CHGLOG: - [netdrv] mlx5e: Fix selftest for small MTUs (Alaa Hleihel) [1642498]
Rebuild_FUZZ: 94.44%
commit-author Valentine Fatiev <valentinef@mellanox.com>
commit 228c4cd04dfd0667eda182c91504b83c17d97584
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1062.el7/228c4cd0.failed

Loopback test had fixed packet size, which can be bigger than configured
MTU. Shorten the loopback packet size to be bigger than minimal MTU
allowed by the device. Text field removed from struct 'mlx5ehdr'
as redundant to allow send small packets as minimal allowed MTU.

Fixes: d605d66 ("net/mlx5e: Add support for ethtool self diagnostics test")
	Signed-off-by: Valentine Fatiev <valentinef@mellanox.com>
	Reviewed-by: Eran Ben Elisha <eranbe@mellanox.com>
	Signed-off-by: Saeed Mahameed <saeedm@mellanox.com>
(cherry picked from commit 228c4cd04dfd0667eda182c91504b83c17d97584)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/mellanox/mlx5/core/en_selftest.c
diff --cc drivers/net/ethernet/mellanox/mlx5/core/en_selftest.c
index fe2d35ec1497,4382ef85488c..000000000000
--- a/drivers/net/ethernet/mellanox/mlx5/core/en_selftest.c
+++ b/drivers/net/ethernet/mellanox/mlx5/core/en_selftest.c
@@@ -98,12 -98,6 +98,15 @@@ static int mlx5e_test_link_speed(struc
  	return 1;
  }
  
++<<<<<<< HEAD
 +#ifdef CONFIG_INET
 +/* loopback test */
 +#define MLX5E_TEST_PKT_SIZE (MLX5_MPWRQ_SMALL_PACKET_THRESHOLD - NET_IP_ALIGN)
 +static const char mlx5e_test_text[ETH_GSTRING_LEN] = "MLX5E SELF TEST";
 +#define MLX5E_TEST_MAGIC 0x5AEED15C001ULL
 +
++=======
++>>>>>>> 228c4cd04dfd (net/mlx5e: Fix selftest for small MTUs)
  struct mlx5ehdr {
  	__be32 version;
  	__be64 magic;
@@@ -167,12 -164,9 +173,15 @@@ static struct sk_buff *mlx5e_test_get_u
  	ip_send_check(iph);
  
  	/* Fill test header and data */
 -	mlxh = skb_put(skb, sizeof(*mlxh));
 +	mlxh = (struct mlx5ehdr *)skb_put(skb, sizeof(*mlxh));
  	mlxh->version = 0;
  	mlxh->magic = cpu_to_be64(MLX5E_TEST_MAGIC);
++<<<<<<< HEAD
 +	strlcpy(mlxh->text, mlx5e_test_text, sizeof(mlxh->text));
 +	datalen -= sizeof(*mlxh);
 +	memset(skb_put(skb, datalen), 0, datalen);
++=======
++>>>>>>> 228c4cd04dfd (net/mlx5e: Fix selftest for small MTUs)
  
  	skb->csum = 0;
  	skb->ip_summed = CHECKSUM_PARTIAL;
* Unmerged path drivers/net/ethernet/mellanox/mlx5/core/en_selftest.c
