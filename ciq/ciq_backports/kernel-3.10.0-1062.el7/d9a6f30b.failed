fsnotify: introduce marks iteration helpers

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1062.el7
commit-author Amir Goldstein <amir73il@gmail.com>
commit d9a6f30bb89309a7f2473028a00b83b020049cb4
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1062.el7/d9a6f30b.failed

Introduce helpers fsnotify_iter_select_report_types() and
fsnotify_iter_next() to abstract the inode/vfsmount marks merged
list iteration.

This is a preparation patch before generalizing mark list
iteration to more mark object types (i.e. super block marks).

	Signed-off-by: Amir Goldstein <amir73il@gmail.com>
	Signed-off-by: Jan Kara <jack@suse.cz>
(cherry picked from commit d9a6f30bb89309a7f2473028a00b83b020049cb4)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	fs/notify/fsnotify.c
diff --cc fs/notify/fsnotify.c
index 0a2346cb87c4,98e91037b11d..000000000000
--- a/fs/notify/fsnotify.c
+++ b/fs/notify/fsnotify.c
@@@ -324,32 -368,14 +371,42 @@@ int fsnotify(struct inode *to_tell, __u
  	 * ignore masks are properly reflected for mount mark notifications.
  	 * That's why this traversal is so complicated...
  	 */
++<<<<<<< HEAD
 +	while (iter_info.inode_mark || iter_info.vfsmount_mark) {
 +		struct fsnotify_mark *inode_mark = iter_info.inode_mark;
 +		struct fsnotify_mark *vfsmount_mark = iter_info.vfsmount_mark;
 +
 +		if (inode_mark && vfsmount_mark) {
 +			int cmp = fsnotify_compare_groups(inode_mark->group,
 +							  vfsmount_mark->group);
 +			if (cmp > 0)
 +				inode_mark = NULL;
 +			else if (cmp < 0)
 +				vfsmount_mark = NULL;
 +		}
 +
 +		ret = send_to_group(to_tell, inode_mark, vfsmount_mark, mask,
 +				    data, data_is, cookie, file_name,
 +				    &iter_info);
++=======
+ 	while (fsnotify_iter_select_report_types(&iter_info)) {
+ 		ret = send_to_group(to_tell, mask, data, data_is, cookie,
+ 				    file_name, &iter_info);
++>>>>>>> d9a6f30bb893 (fsnotify: introduce marks iteration helpers)
  
  		if (ret && (mask & ALL_FSNOTIFY_PERM_EVENTS))
  			goto out;
  
++<<<<<<< HEAD
 +		if (inode_mark)
 +			iter_info.inode_mark =
 +				fsnotify_next_mark(iter_info.inode_mark);
 +		if (vfsmount_mark)
 +			iter_info.vfsmount_mark =
 +				fsnotify_next_mark(iter_info.vfsmount_mark);
++=======
+ 		fsnotify_iter_next(&iter_info);
++>>>>>>> d9a6f30bb893 (fsnotify: introduce marks iteration helpers)
  	}
  	ret = 0;
  out:
* Unmerged path fs/notify/fsnotify.c
