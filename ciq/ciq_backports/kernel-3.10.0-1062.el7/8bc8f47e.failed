scsi: hpsa: switch to generic DMA API

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1062.el7
Rebuild_CHGLOG: - [scsi] hpsa: switch to generic DMA API (Joseph Szczypek) [1641108]
Rebuild_FUZZ: 91.18%
commit-author Christoph Hellwig <hch@lst.de>
commit 8bc8f47ea3964ef141e91ffff912538a66a55d5f
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1062.el7/8bc8f47e.failed

Switch from the legacy PCI DMA API to the generic DMA API.

	Signed-off-by: Christoph Hellwig <hch@lst.de>
	Tested-by: Don Brace <don.brace@microchip.com>
	Acked-by: Don Brace <don.brace@microchip.com>
	Reviewed-by: Johannes Thumshirn <jthumshirn@suse.de>
	Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
(cherry picked from commit 8bc8f47ea3964ef141e91ffff912538a66a55d5f)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/scsi/hpsa.c
diff --cc drivers/scsi/hpsa.c
index 76507e2c820f,758ffd6419b4..000000000000
--- a/drivers/scsi/hpsa.c
+++ b/drivers/scsi/hpsa.c
@@@ -7906,15 -7930,15 +7907,22 @@@ static void hpsa_free_cmd_pool(struct c
  
  static int hpsa_alloc_cmd_pool(struct ctlr_info *h)
  {
++<<<<<<< HEAD
 +	h->cmd_pool_bits = kzalloc(
 +		DIV_ROUND_UP(h->nr_cmds, BITS_PER_LONG) *
 +		sizeof(unsigned long), GFP_KERNEL);
 +	h->cmd_pool = pci_alloc_consistent(h->pdev,
++=======
+ 	h->cmd_pool_bits = kcalloc(DIV_ROUND_UP(h->nr_cmds, BITS_PER_LONG),
+ 				   sizeof(unsigned long),
+ 				   GFP_KERNEL);
+ 	h->cmd_pool = dma_alloc_coherent(&h->pdev->dev,
++>>>>>>> 8bc8f47ea396 (scsi: hpsa: switch to generic DMA API)
  		    h->nr_cmds * sizeof(*h->cmd_pool),
- 		    &(h->cmd_pool_dhandle));
- 	h->errinfo_pool = pci_alloc_consistent(h->pdev,
+ 		    &h->cmd_pool_dhandle, GFP_KERNEL);
+ 	h->errinfo_pool = dma_alloc_coherent(&h->pdev->dev,
  		    h->nr_cmds * sizeof(*h->errinfo_pool),
- 		    &(h->errinfo_pool_dhandle));
+ 		    &h->errinfo_pool_dhandle, GFP_KERNEL);
  	if ((h->cmd_pool_bits == NULL)
  	    || (h->cmd_pool == NULL)
  	    || (h->errinfo_pool == NULL)) {
* Unmerged path drivers/scsi/hpsa.c
