powerpc/livepatch: small cleanups in save_stack_trace_tsk_reliable()

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1062.el7
Rebuild_CHGLOG: - [powerpc] livepatch: small cleanups in save_stack_trace_tsk_reliable() (Joe Lawrence) [1658435]
Rebuild_FUZZ: 93.75%
commit-author Joe Lawrence <joe.lawrence@redhat.com>
commit 29a77bbb0cf2cea41fa46f8fa176f6cb1e3182c4
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1062.el7/29a77bbb.failed

Mostly cosmetic changes:

- Group common stack pointer code at the top
- Simplify the first frame logic
- Code stackframe iteration into for...loop construct
- Check for trace->nr_entries overflow before adding any into the array

	Suggested-by: Nicolai Stange <nstange@suse.de>
	Signed-off-by: Joe Lawrence <joe.lawrence@redhat.com>
	Signed-off-by: Michael Ellerman <mpe@ellerman.id.au>
(cherry picked from commit 29a77bbb0cf2cea41fa46f8fa176f6cb1e3182c4)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/powerpc/kernel/stacktrace.c
diff --cc arch/powerpc/kernel/stacktrace.c
index c998074d2de5,28c3c25755d7..000000000000
--- a/arch/powerpc/kernel/stacktrace.c
+++ b/arch/powerpc/kernel/stacktrace.c
@@@ -88,17 -99,7 +89,21 @@@ save_stack_trace_tsk_reliable(struct ta
  	unsigned long stack_page = (unsigned long)task_stack_page(tsk);
  	unsigned long stack_end;
  	int graph_idx = 0;
++<<<<<<< HEAD
 +
 +	/*
 +	 * The last frame (unwinding first) may not yet have saved
 +	 * its LR onto the stack.
 +	 */
 +	int firstframe = 1;
 +
 +	if (tsk == current)
 +		sp = __get_SP();
 +	else
 +		sp = tsk->thread.ksp;
++=======
+ 	bool firstframe;
++>>>>>>> 29a77bbb0cf2 (powerpc/livepatch: small cleanups in save_stack_trace_tsk_reliable())
  
  	stack_end = stack_page + THREAD_SIZE;
  	if (!is_idle_task(tsk)) {
* Unmerged path arch/powerpc/kernel/stacktrace.c
