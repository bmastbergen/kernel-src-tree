net: phy: realtek: Support RTL8366RB variant

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1062.el7
Rebuild_CHGLOG: - [netdrv] phy: realtek: Support RTL8366RB variant (Corinna Vinschen) [1706531]
Rebuild_FUZZ: 93.98%
commit-author Linus Walleij <linus.walleij@linaro.org>
commit d85458256ad2583df95deb0bb7a3403b74be177a
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1062.el7/d8545825.failed

The RTL8366RB is an ASIC with five internal PHYs for
LAN0..LAN3 and WAN. The PHYs are spawn off the main
device so they can be handled in a distributed manner
by the Realtek PHY driver. All that is really needed
is the power save feature enablement and letting the
PHY driver core pick up the IRQ from the switch chip.

	Cc: Antti Seppälä <a.seppala@gmail.com>
	Cc: Roman Yeryomin <roman@advem.lv>
	Cc: Colin Leitner <colin.leitner@googlemail.com>
	Cc: Gabor Juhos <juhosg@openwrt.org>
	Cc: Florian Fainelli <f.fainelli@gmail.com>
	Signed-off-by: Linus Walleij <linus.walleij@linaro.org>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit d85458256ad2583df95deb0bb7a3403b74be177a)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/phy/realtek.c
diff --cc drivers/net/phy/realtek.c
index 7a1f3b68e3db,7fc8508b5231..000000000000
--- a/drivers/net/phy/realtek.c
+++ b/drivers/net/phy/realtek.c
@@@ -200,17 -174,43 +203,35 @@@ static int rtl8211f_config_init(struct 
  	/* enable TX-delay for rgmii-id and rgmii-txid, otherwise disable it */
  	if (phydev->interface == PHY_INTERFACE_MODE_RGMII_ID ||
  	    phydev->interface == PHY_INTERFACE_MODE_RGMII_TXID)
 -		val = RTL8211F_TX_DELAY;
 -
 -	return phy_modify_paged(phydev, 0xd08, 0x11, RTL8211F_TX_DELAY, val);
 -}
 -
 -static int rtl8211b_suspend(struct phy_device *phydev)
 -{
 -	phy_write(phydev, MII_MMD_DATA, BIT(9));
 -
 -	return genphy_suspend(phydev);
 -}
 +		val |= RTL8211F_TX_DELAY;
 +	else
 +		val &= ~RTL8211F_TX_DELAY;
  
 -static int rtl8211b_resume(struct phy_device *phydev)
 -{
 -	phy_write(phydev, MII_MMD_DATA, 0);
 +	ret = rtl8211x_page_write(phydev, 0xd08, 0x11, val);
 +	if (ret)
 +		return ret;
  
 -	return genphy_resume(phydev);
 +	return 0;
  }
  
+ static int rtl8366rb_config_init(struct phy_device *phydev)
+ {
+ 	int ret;
+ 
+ 	ret = genphy_config_init(phydev);
+ 	if (ret < 0)
+ 		return ret;
+ 
+ 	ret = phy_set_bits(phydev, RTL8366RB_POWER_SAVE,
+ 			   RTL8366RB_POWER_SAVE_ON);
+ 	if (ret) {
+ 		dev_err(&phydev->mdio.dev,
+ 			"error enabling power management\n");
+ 	}
+ 
+ 	return ret;
+ }
+ 
  static struct phy_driver realtek_drvs[] = {
  	{
  		.phy_id         = 0x00008201,
@@@ -299,7 -289,17 +320,21 @@@
  		.config_intr	= &rtl8211f_config_intr,
  		.suspend	= genphy_suspend,
  		.resume		= genphy_resume,
++<<<<<<< HEAD
 +		.driver		= { .owner = THIS_MODULE },
++=======
+ 		.read_page	= rtl821x_read_page,
+ 		.write_page	= rtl821x_write_page,
+ 	}, {
+ 		.phy_id		= 0x001cc961,
+ 		.name		= "RTL8366RB Gigabit Ethernet",
+ 		.phy_id_mask	= 0x001fffff,
+ 		.features	= PHY_GBIT_FEATURES,
+ 		.flags		= PHY_HAS_INTERRUPT,
+ 		.config_init	= &rtl8366rb_config_init,
+ 		.suspend	= genphy_suspend,
+ 		.resume		= genphy_resume,
++>>>>>>> d85458256ad2 (net: phy: realtek: Support RTL8366RB variant)
  	},
  };
  
* Unmerged path drivers/net/phy/realtek.c
