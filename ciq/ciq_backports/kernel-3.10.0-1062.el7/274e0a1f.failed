xfs: abstract out dev_t conversions

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1062.el7
commit-author Christoph Hellwig <hch@lst.de>
commit 274e0a1f4777b9362fc03a34e86358cc36003e48
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1062.el7/274e0a1f.failed

And move them to xfs_linux.h so that xfsprogs can stub them out more
easily.

	Signed-off-by: Christoph Hellwig <hch@lst.de>
	Reviewed-by: Darrick J. Wong <darrick.wong@oracle.com>
	Signed-off-by: Darrick J. Wong <darrick.wong@oracle.com>
(cherry picked from commit 274e0a1f4777b9362fc03a34e86358cc36003e48)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	fs/xfs/libxfs/xfs_inode_fork.c
diff --cc fs/xfs/libxfs/xfs_inode_fork.c
index f83028029221,c79a1616b79d..000000000000
--- a/fs/xfs/libxfs/xfs_inode_fork.c
+++ b/fs/xfs/libxfs/xfs_inode_fork.c
@@@ -780,7 -787,8 +780,12 @@@ xfs_iflush_fork
  	case XFS_DINODE_FMT_DEV:
  		if (iip->ili_fields & XFS_ILOG_DEV) {
  			ASSERT(whichfork == XFS_DATA_FORK);
++<<<<<<< HEAD
 +			xfs_dinode_put_rdev(dip, ip->i_df.if_u2.if_rdev);
++=======
+ 			xfs_dinode_put_rdev(dip,
+ 					linux_to_xfs_dev_t(VFS_I(ip)->i_rdev));
++>>>>>>> 274e0a1f4777 (xfs: abstract out dev_t conversions)
  		}
  		break;
  
* Unmerged path fs/xfs/libxfs/xfs_inode_fork.c
diff --git a/fs/xfs/xfs_linux.h b/fs/xfs/xfs_linux.h
index 6f940111f3ae..3e38f0d5caa6 100644
--- a/fs/xfs/xfs_linux.h
+++ b/fs/xfs/xfs_linux.h
@@ -198,6 +198,16 @@ static inline kgid_t xfs_gid_to_kgid(uint32_t gid)
 	return make_kgid(&init_user_ns, gid);
 }
 
+static inline dev_t xfs_to_linux_dev_t(xfs_dev_t dev)
+{
+	return MKDEV(sysv_major(dev) & 0x1ff, sysv_minor(dev));
+}
+
+static inline xfs_dev_t linux_to_xfs_dev_t(dev_t dev)
+{
+	return sysv_encode_dev(dev);
+}
+
 /*
  * Various platform dependent calls that don't fit anywhere else
  */
