cxgb4: Add VF Link state support

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1062.el7
commit-author Arjun Vynipadath <arjun@chelsio.com>
commit 8b965f3f649c50d68a7fbc3a7771fcc368d2b7b8
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1062.el7/8b965f3f.failed

Use ndo_set_vf_link_state to control the link states associated
with the virtual interfaces.

	Signed-off-by: Arjun Vynipadath <arjun@chelsio.com>
	Signed-off-by: Vishal Kulkarni <vishal@chelsio.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 8b965f3f649c50d68a7fbc3a7771fcc368d2b7b8)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/chelsio/cxgb4/cxgb4_main.c
diff --cc drivers/net/ethernet/chelsio/cxgb4/cxgb4_main.c
index c1c4e9550a7f,45093a620c3f..000000000000
--- a/drivers/net/ethernet/chelsio/cxgb4/cxgb4_main.c
+++ b/drivers/net/ethernet/chelsio/cxgb4/cxgb4_main.c
@@@ -3260,13 -3338,13 +3304,23 @@@ static const struct net_device_ops cxgb
  
  #ifdef CONFIG_PCI_IOV
  static const struct net_device_ops cxgb4_mgmt_netdev_ops = {
++<<<<<<< HEAD
 +	.ndo_size             = sizeof(struct net_device_ops),
 +	.ndo_open             = cxgb4_mgmt_open,
 +	.ndo_set_vf_mac       = cxgb4_mgmt_set_vf_mac,
 +	.ndo_get_vf_config    = cxgb4_mgmt_get_vf_config,
 +	.ndo_set_vf_rate      = cxgb4_mgmt_set_vf_rate,
 +	.ndo_get_phys_port_id = cxgb4_mgmt_get_phys_port_id,
 +	.extended.ndo_set_vf_vlan      = cxgb4_mgmt_set_vf_vlan,
++=======
+ 	.ndo_open               = cxgb4_mgmt_open,
+ 	.ndo_set_vf_mac         = cxgb4_mgmt_set_vf_mac,
+ 	.ndo_get_vf_config      = cxgb4_mgmt_get_vf_config,
+ 	.ndo_set_vf_rate        = cxgb4_mgmt_set_vf_rate,
+ 	.ndo_get_phys_port_id   = cxgb4_mgmt_get_phys_port_id,
+ 	.ndo_set_vf_vlan        = cxgb4_mgmt_set_vf_vlan,
+ 	.ndo_set_vf_link_state	= cxgb4_mgmt_set_vf_link_state,
++>>>>>>> 8b965f3f649c (cxgb4: Add VF Link state support)
  };
  #endif
  
diff --git a/drivers/net/ethernet/chelsio/cxgb4/cxgb4.h b/drivers/net/ethernet/chelsio/cxgb4/cxgb4.h
index a8897173511b..7960ccb090df 100644
--- a/drivers/net/ethernet/chelsio/cxgb4/cxgb4.h
+++ b/drivers/net/ethernet/chelsio/cxgb4/cxgb4.h
@@ -846,6 +846,7 @@ struct vf_info {
 	unsigned int tx_rate;
 	bool pf_set_mac;
 	u16 vlan;
+	int link_state;
 };
 
 enum {
* Unmerged path drivers/net/ethernet/chelsio/cxgb4/cxgb4_main.c
diff --git a/drivers/net/ethernet/chelsio/cxgb4/t4fw_api.h b/drivers/net/ethernet/chelsio/cxgb4/t4fw_api.h
index 48533087923f..b4c437d4d7cf 100644
--- a/drivers/net/ethernet/chelsio/cxgb4/t4fw_api.h
+++ b/drivers/net/ethernet/chelsio/cxgb4/t4fw_api.h
@@ -1270,6 +1270,14 @@ enum fw_params_param_pfvf {
 	FW_PARAMS_PARAM_PFVF_RAWF_END = 0x37,
 	FW_PARAMS_PARAM_PFVF_NCRYPTO_LOOKASIDE = 0x39,
 	FW_PARAMS_PARAM_PFVF_PORT_CAPS32 = 0x3A,
+	FW_PARAMS_PARAM_PFVF_LINK_STATE = 0x40,
+};
+
+/* Virtual link state as seen by the specified VF */
+enum vf_link_states {
+	FW_VF_LINK_STATE_AUTO		= 0x00,
+	FW_VF_LINK_STATE_ENABLE		= 0x01,
+	FW_VF_LINK_STATE_DISABLE	= 0x02,
 };
 
 /*
