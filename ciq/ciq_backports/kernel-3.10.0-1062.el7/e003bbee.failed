efivars: Check size of user object

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1062.el7
commit-author Matt Fleming <matt.fleming@intel.com>
commit e003bbee2a6a19a4c733335989284caf1b179e0d
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1062.el7/e003bbee.failed

Unbelieavably there are no checks to see whether the data structure
passed to 'new_var' and 'del_var' is the size that we expect. Let's add
some for better robustness.

	Cc: Mike Waychison <mikew@google.com>
	Signed-off-by: Matt Fleming <matt.fleming@intel.com>
(cherry picked from commit e003bbee2a6a19a4c733335989284caf1b179e0d)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/firmware/efi/efivars.c
diff --cc drivers/firmware/efi/efivars.c
index 5cbba0eea363,2c21cccc2572..000000000000
--- a/drivers/firmware/efi/efivars.c
+++ b/drivers/firmware/efi/efivars.c
@@@ -364,8 -347,15 +364,20 @@@ static ssize_t efivar_create(struct fil
  	if (!capable(CAP_SYS_ADMIN))
  		return -EACCES;
  
++<<<<<<< HEAD
 +	if ((new_var->Attributes & ~EFI_VARIABLE_MASK) != 0 ||
 +	    efivar_validate(new_var, new_var->Data, new_var->DataSize) == false) {
++=======
+ 	if (count != sizeof(*new_var))
+ 		return -EINVAL;
+ 
+ 	attributes = new_var->Attributes;
+ 	size = new_var->DataSize;
+ 	data = new_var->Data;
+ 
+ 	if ((attributes & ~EFI_VARIABLE_MASK) != 0 ||
+ 	    efivar_validate(new_var, data, size) == false) {
++>>>>>>> e003bbee2a6a (efivars: Check size of user object)
  		printk(KERN_ERR "efivars: Malformed variable content\n");
  		return -EINVAL;
  	}
@@@ -413,9 -398,14 +425,18 @@@ static ssize_t efivar_delete(struct fil
  	if (!capable(CAP_SYS_ADMIN))
  		return -EACCES;
  
++<<<<<<< HEAD
++=======
+ 	if (count != sizeof(*del_var))
+ 		return -EINVAL;
+ 
+ 	name = del_var->VariableName;
+ 	vendor = del_var->VendorGuid;
+ 
++>>>>>>> e003bbee2a6a (efivars: Check size of user object)
  	efivar_entry_iter_begin();
 -	entry = efivar_entry_find(name, vendor, &efivar_sysfs_list, true);
 +	entry = efivar_entry_find(del_var->VariableName, del_var->VendorGuid,
 +				  &efivar_sysfs_list, true);
  	if (!entry)
  		err = -EINVAL;
  	else if (__efivar_entry_delete(entry))
* Unmerged path drivers/firmware/efi/efivars.c
