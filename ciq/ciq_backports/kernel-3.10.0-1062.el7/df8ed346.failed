net: phy: fix flag masking in __set_phy_supported

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1062.el7
Rebuild_CHGLOG: - [netdrv] phy: fix flag masking in __set_phy_supported (Ivan Vecera) [1655590]
Rebuild_FUZZ: 94.62%
commit-author Heiner Kallweit <hkallweit1@gmail.com>
commit df8ed346d4a806a6eef2db5924285e839604b3f9
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1062.el7/df8ed346.failed

Currently also the pause flags are removed from phydev->supported because
they're not included in PHY_DEFAULT_FEATURES. I don't think this is
intended, especially when considering that this function can be called
via phy_set_max_speed() anywhere in a driver. Change the masking to mask
out only the values we're going to change. In addition remove the
misleading comment, job of this small function is just to adjust the
supported and advertised speeds.

Fixes: f3a6bd393c2c ("phylib: Add phy_set_max_speed helper")
	Signed-off-by: Heiner Kallweit <hkallweit1@gmail.com>
	Reviewed-by: Andrew Lunn <andrew@lunn.ch>
	Reviewed-by: Florian Fainelli <f.fainelli@gmail.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit df8ed346d4a806a6eef2db5924285e839604b3f9)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/phy/phy_device.c
diff --cc drivers/net/phy/phy_device.c
index 273a57729eef,b9f5f40a7ac1..000000000000
--- a/drivers/net/phy/phy_device.c
+++ b/drivers/net/phy/phy_device.c
@@@ -1208,8 -1715,31 +1208,34 @@@ int genphy_resume(struct phy_device *ph
  }
  EXPORT_SYMBOL(genphy_resume);
  
 -int genphy_loopback(struct phy_device *phydev, bool enable)
 +static int gen10g_resume(struct phy_device *phydev)
  {
++<<<<<<< HEAD
++=======
+ 	return phy_modify(phydev, MII_BMCR, BMCR_LOOPBACK,
+ 			  enable ? BMCR_LOOPBACK : 0);
+ }
+ EXPORT_SYMBOL(genphy_loopback);
+ 
+ static int __set_phy_supported(struct phy_device *phydev, u32 max_speed)
+ {
+ 	phydev->supported &= ~(PHY_1000BT_FEATURES | PHY_100BT_FEATURES |
+ 			       PHY_10BT_FEATURES);
+ 
+ 	switch (max_speed) {
+ 	default:
+ 		return -ENOTSUPP;
+ 	case SPEED_1000:
+ 		phydev->supported |= PHY_1000BT_FEATURES;
+ 		/* fall through */
+ 	case SPEED_100:
+ 		phydev->supported |= PHY_100BT_FEATURES;
+ 		/* fall through */
+ 	case SPEED_10:
+ 		phydev->supported |= PHY_10BT_FEATURES;
+ 	}
+ 
++>>>>>>> df8ed346d4a8 (net: phy: fix flag masking in __set_phy_supported)
  	return 0;
  }
  
* Unmerged path drivers/net/phy/phy_device.c
