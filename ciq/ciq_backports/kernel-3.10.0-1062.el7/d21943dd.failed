RDMA/core: Implement IB device rename function

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1062.el7
commit-author Leon Romanovsky <leonro@mellanox.com>
commit d21943dd19b5c79dc09bb0e8bf80cd5ee09c41c2
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1062.el7/d21943dd.failed

Generic implementation of IB device rename function.

	Signed-off-by: Leon Romanovsky <leonro@mellanox.com>
	Signed-off-by: Doug Ledford <dledford@redhat.com>
(cherry picked from commit d21943dd19b5c79dc09bb0e8bf80cd5ee09c41c2)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/infiniband/core/device.c
diff --cc drivers/infiniband/core/device.c
index 910f35ee49f7,5e70f5e1cfd9..000000000000
--- a/drivers/infiniband/core/device.c
+++ b/drivers/infiniband/core/device.c
@@@ -171,10 -171,34 +171,39 @@@ static struct ib_device *__ib_device_ge
  	return NULL;
  }
  
++<<<<<<< HEAD
 +static int alloc_name(char *name)
++=======
+ int ib_device_rename(struct ib_device *ibdev, const char *name)
+ {
+ 	struct ib_device *device;
+ 	int ret = 0;
+ 
+ 	if (!strcmp(name, dev_name(&ibdev->dev)))
+ 		return ret;
+ 
+ 	mutex_lock(&device_mutex);
+ 	list_for_each_entry(device, &device_list, core_list) {
+ 		if (!strcmp(name, dev_name(&device->dev))) {
+ 			ret = -EEXIST;
+ 			goto out;
+ 		}
+ 	}
+ 
+ 	ret = device_rename(&ibdev->dev, name);
+ 	if (ret)
+ 		goto out;
+ 	strlcpy(ibdev->name, name, IB_DEVICE_NAME_MAX);
+ out:
+ 	mutex_unlock(&device_mutex);
+ 	return ret;
+ }
+ 
+ static int alloc_name(struct ib_device *ibdev, const char *name)
++>>>>>>> d21943dd19b5 (RDMA/core: Implement IB device rename function)
  {
  	unsigned long *inuse;
 +	char buf[IB_DEVICE_NAME_MAX];
  	struct ib_device *device;
  	int i;
  
diff --git a/drivers/infiniband/core/core_priv.h b/drivers/infiniband/core/core_priv.h
index 695c109b0df7..df67eaa6c4a2 100644
--- a/drivers/infiniband/core/core_priv.h
+++ b/drivers/infiniband/core/core_priv.h
@@ -86,6 +86,7 @@ int  ib_device_register_sysfs(struct ib_device *device,
 			      int (*port_callback)(struct ib_device *,
 						   u8, struct kobject *));
 void ib_device_unregister_sysfs(struct ib_device *device);
+int ib_device_rename(struct ib_device *ibdev, const char *name);
 
 typedef void (*roce_netdev_callback)(struct ib_device *device, u8 port,
 	      struct net_device *idev, void *cookie);
* Unmerged path drivers/infiniband/core/device.c
