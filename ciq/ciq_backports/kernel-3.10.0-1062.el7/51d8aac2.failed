perf tools: Fix check-headers.sh AND list path of execution

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1062.el7
commit-author Alexander Kapshuk <alexander.kapshuk@gmail.com>
commit 51d8aac236493833acf60d9c3b6c42437a18da36
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1062.el7/51d8aac2.failed

The '||' path of execution in the 'test' block of the check_2() function
may also be taken if file2 does not exist, in which case the warning
message about the ABI headers being different would still be printed
where it should not be.  See below.

  % file1=file1; file2=file2
  % cmd="echo diff $file1 $file2"
  % test -f $file2 && \
    eval $cmd || echo "Warning: Kernel ABI header at 'tools/$file1'
                       differs from latest version at '$file2'" >&2
                       Warning: Kernel ABI header at 'tools/file1' differs from latest
                       version at 'file2'

The proposed patch converts the code following the '&&' operator into a
compound list to be executed in the current process environment only if file2
does exist. Should the files being compared differ, a diff command to compare
the files concerned is printed on standard output. E.g.

  $ diff -u tools/arch/x86/lib/memcpy_64.S arch/x86/lib/memcpy_64.S

Committer testing:

Remove a line from that tools/arch/x86/lib/memcpy_64.S file to test
this:

  BUILD:   Doing 'make -j4' parallel build
Warning: Kernel ABI header at 'tools/arch/x86/lib/memcpy_64.S' differs from latest version at 'arch/x86/lib/memcpy_64.S'
diff -u tools/arch/x86/lib/memcpy_64.S arch/x86/lib/memcpy_64.S
  CC       /tmp/build/perf/bench/mem-memcpy-x86-64-asm.o

	Signed-off-by: Alexander Kapshuk <alexander.kapshuk@gmail.com>
	Tested-by: Arnaldo Carvalho de Melo <acme@redhat.com>
	Acked-by: Jiri Olsa <jolsa@kernel.org>
	Cc: Alexander Shishkin <alexander.shishkin@linux.intel.com>
	Cc: David Ahern <dsahern@gmail.com>
	Cc: Namhyung Kim <namhyung@kernel.org>
	Cc: Peter Zijlstra <peterz@infradead.org>
Link: http://lkml.kernel.org/r/20180811083915.17471-1-alexander.kapshuk@gmail.com
	Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>
(cherry picked from commit 51d8aac236493833acf60d9c3b6c42437a18da36)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	tools/perf/check-headers.sh
diff --cc tools/perf/check-headers.sh
index 4b4b21bef21d,ea48aa6f8d19..000000000000
--- a/tools/perf/check-headers.sh
+++ b/tools/perf/check-headers.sh
@@@ -48,8 -55,26 +48,28 @@@ include/uapi/asm-generic/errno.
  include/uapi/asm-generic/errno-base.h
  include/uapi/asm-generic/ioctls.h
  include/uapi/asm-generic/mman-common.h
 -include/uapi/asm-generic/unistd.h
  '
  
++<<<<<<< HEAD
++=======
+ check_2 () {
+   file1=$1
+   file2=$2
+ 
+   shift
+   shift
+ 
+   cmd="diff $* $file1 $file2 > /dev/null"
+ 
+   test -f $file2 && {
+     eval $cmd || {
+       echo "Warning: Kernel ABI header at 'tools/$file' differs from latest version at '$file'" >&2
+       echo diff -u tools/$file $file
+     }
+   }
+ }
+ 
++>>>>>>> 51d8aac23649 (perf tools: Fix check-headers.sh AND list path of execution)
  check () {
    file=$1
  
* Unmerged path tools/perf/check-headers.sh
