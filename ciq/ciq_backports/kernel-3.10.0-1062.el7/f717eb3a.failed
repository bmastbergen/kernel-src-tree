slab: do not panic if we fail to create memcg cache

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1062.el7
commit-author Vladimir Davydov <vdavydov@parallels.com>
commit f717eb3abb5ea38f60e671dbfdbf512c2c93d22e
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1062.el7/f717eb3a.failed

There is no point in flooding logs with warnings or especially crashing
the system if we fail to create a cache for a memcg.  In this case we
will be accounting the memcg allocation to the root cgroup until we
succeed to create its own cache, but it isn't that critical.

	Signed-off-by: Vladimir Davydov <vdavydov@parallels.com>
	Cc: Michal Hocko <mhocko@suse.cz>
	Cc: Glauber Costa <glommer@gmail.com>
	Cc: Johannes Weiner <hannes@cmpxchg.org>
	Cc: Pekka Enberg <penberg@kernel.org>
	Cc: Christoph Lameter <cl@linux.com>
	Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
	Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
(cherry picked from commit f717eb3abb5ea38f60e671dbfdbf512c2c93d22e)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	mm/slab_common.c
diff --cc mm/slab_common.c
index 84ed8dc5b2d8,8e40321da091..000000000000
--- a/mm/slab_common.c
+++ b/mm/slab_common.c
@@@ -283,8 -233,14 +283,19 @@@ out_locked
  	mutex_unlock(&slab_mutex);
  	put_online_cpus();
  
++<<<<<<< HEAD
 +	if (err) {
 +
++=======
+ 	/*
+ 	 * There is no point in flooding logs with warnings or especially
+ 	 * crashing the system if we fail to create a cache for a memcg. In
+ 	 * this case we will be accounting the memcg allocation to the root
+ 	 * cgroup until we succeed to create its own cache, but it isn't that
+ 	 * critical.
+ 	 */
+ 	if (err && !memcg) {
++>>>>>>> f717eb3abb5e (slab: do not panic if we fail to create memcg cache)
  		if (flags & SLAB_PANIC)
  			panic("kmem_cache_create: Failed to create slab '%s'. Error %d\n",
  				name, err);
* Unmerged path mm/slab_common.c
