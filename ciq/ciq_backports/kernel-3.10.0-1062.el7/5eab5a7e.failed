perf llvm: Display eBPF compiling command in debug output

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1062.el7
commit-author Jiri Olsa <jolsa@kernel.org>
commit 5eab5a7ee032acaab3da8fc95a3614fec14687ac
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1062.el7/5eab5a7e.failed

In addition to template, display also the real compile command line with
all the variables substituted.

  llvm compiling command template: $CLANG_EXEC -D__KERNEL__ -D__NR_CPUS__=$NR_CPUS ...
  llvm compiling command : /usr/bin/clang -D__KERNEL__ -D__NR_CPUS__=24 -DLINUX_VERSION_CODE=0x41000 ...

	Signed-off-by: Jiri Olsa <jolsa@kernel.org>
	Cc: Alexander Shishkin <alexander.shishkin@linux.intel.com>
	Cc: David Ahern <dsahern@gmail.com>
	Cc: Namhyung Kim <namhyung@kernel.org>
	Cc: Peter Zijlstra <peterz@infradead.org>
Link: http://lkml.kernel.org/r/20180312094313.18738-3-jolsa@kernel.org
	Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>
(cherry picked from commit 5eab5a7ee032acaab3da8fc95a3614fec14687ac)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	tools/perf/util/llvm-utils.c
diff --cc tools/perf/util/llvm-utils.c
index 1094f8780b7a,1cca0a2fa641..000000000000
--- a/tools/perf/util/llvm-utils.c
+++ b/tools/perf/util/llvm-utils.c
@@@ -330,14 -423,17 +330,18 @@@ get_kbuild_opts(char **kbuild_dir, cha
  int llvm__compile_bpf(const char *path, void **p_obj_buf,
  		      size_t *p_obj_buf_sz)
  {
 -	size_t obj_buf_sz;
 -	void *obj_buf = NULL;
 -	int err, nr_cpus_avail;
 -	unsigned int kernel_version;
 -	char linux_version_code_str[64];
 +	int err;
  	const char *clang_opt = llvm_param.clang_opt;
 -	char clang_path[PATH_MAX], abspath[PATH_MAX], nr_cpus_avail_str[64];
 +	char clang_path[PATH_MAX], abspath[PATH_MAX];
  	char serr[STRERR_BUFSIZE];
 -	char *kbuild_dir = NULL, *kbuild_include_opts = NULL;
  	const char *template = llvm_param.clang_bpf_cmd_template;
++<<<<<<< HEAD
 +	char *kbuild_dir = NULL, *kbuild_include_opts = NULL;
 +	void *obj_buf = NULL;
 +	size_t obj_buf_sz;
++=======
+ 	char *command_echo, *command_out;
++>>>>>>> 5eab5a7ee032 (perf llvm: Display eBPF compiling command in debug output)
  
  	if (path[0] != '-' && realpath(path, abspath) == NULL) {
  		err = errno;
@@@ -390,8 -508,11 +404,10 @@@
  		goto errout;
  	}
  
+ 	free(command_echo);
+ 	free(command_out);
  	free(kbuild_dir);
  	free(kbuild_include_opts);
 -
  	if (!p_obj_buf)
  		free(obj_buf);
  	else
* Unmerged path tools/perf/util/llvm-utils.c
