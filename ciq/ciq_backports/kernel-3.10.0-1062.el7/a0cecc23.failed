Revert "drm/virtio: drop prime import/export callbacks"

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1062.el7
commit-author Dave Airlie <airlied@redhat.com>
commit a0cecc23cfcbf2626497a8c8770856dd56b67917
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1062.el7/a0cecc23.failed

This patch does more harm than good, as it breaks both Xwayland and
gnome-shell with X11.

Xwayland requires DRI3 & DRI3 requires PRIME.

X11 crash for obscure double-free reason which are hard to debug
(starting X11 by hand doesn't trigger the crash).

I don't see an apparent problem implementing those stub prime
functions, they may return an error at run-time, and it seems to be
handled fine by GNOME at least.

This reverts commit b318e3ff7ca065d6b107e424c85a63d7a6798a69.
[airlied:
This broke userspace for virtio-gpus, and regressed things from DRI3 to DRI2.

This brings back the original problem, but it's better than regressions.]

Fixes: b318e3ff7ca065d6b107e424c85a63d7a6798a ("drm/virtio: drop prime import/export callbacks")
	Signed-off-by: Marc-Andr√© Lureau <marcandre.lureau@redhat.com>
	Signed-off-by: Dave Airlie <airlied@redhat.com>
(cherry picked from commit a0cecc23cfcbf2626497a8c8770856dd56b67917)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/gpu/drm/virtio/virtgpu_prime.c
diff --cc drivers/gpu/drm/virtio/virtgpu_prime.c
index d27a1688714f,eb51a78e1199..000000000000
--- a/drivers/gpu/drm/virtio/virtgpu_prime.c
+++ b/drivers/gpu/drm/virtio/virtgpu_prime.c
@@@ -41,7 -41,6 +41,10 @@@ void virtgpu_gem_prime_unpin(struct drm
  
  struct sg_table *virtgpu_gem_prime_get_sg_table(struct drm_gem_object *obj)
  {
++<<<<<<< HEAD
 +	WARN_ONCE(1, "not implemented");
++=======
++>>>>>>> a0cecc23cfcb (Revert "drm/virtio: drop prime import/export callbacks")
  	return ERR_PTR(-ENODEV);
  }
  
@@@ -49,7 -48,6 +52,10 @@@ struct drm_gem_object *virtgpu_gem_prim
  	struct drm_device *dev, struct dma_buf_attachment *attach,
  	struct sg_table *table)
  {
++<<<<<<< HEAD
 +	WARN_ONCE(1, "not implemented");
++=======
++>>>>>>> a0cecc23cfcb (Revert "drm/virtio: drop prime import/export callbacks")
  	return ERR_PTR(-ENODEV);
  }
  
* Unmerged path drivers/gpu/drm/virtio/virtgpu_prime.c
