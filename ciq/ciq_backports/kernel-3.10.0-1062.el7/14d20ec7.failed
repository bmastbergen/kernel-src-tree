drm/amdgpu: psp_ring_destroy cause psp->km_ring.ring_mem NULL

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1062.el7
commit-author wentalou <Wentao.Lou@amd.com>
commit 14d20ec7f31ef96a2e7dcf7880b13dde1d473b56
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1062.el7/14d20ec7.failed

psp_ring_destroy inside psp_load_fw cause psp->km_ring.ring_mem NULL.
Call Trace occurred when psp_cmd_submit.
should be psp_ring_stop instead.

	Reviewed-by: Xiangliang Yu <Xiangliang.Yu@amd.com>
	Signed-off-by: Wentao Lou <Wentao.Lou@amd.com>
	Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
(cherry picked from commit 14d20ec7f31ef96a2e7dcf7880b13dde1d473b56)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/gpu/drm/amd/amdgpu/amdgpu_psp.c
diff --cc drivers/gpu/drm/amd/amdgpu/amdgpu_psp.c
index c7d43e064fc7,8189a90637f7..000000000000
--- a/drivers/gpu/drm/amd/amdgpu/amdgpu_psp.c
+++ b/drivers/gpu/drm/amd/amdgpu/amdgpu_psp.c
@@@ -322,8 -546,10 +322,13 @@@ static int psp_load_fw(struct amdgpu_de
  	int ret;
  	struct psp_context *psp = &adev->psp;
  
++<<<<<<< HEAD
 +	if (amdgpu_sriov_vf(adev) && adev->in_gpu_reset != 0)
++=======
+ 	if (amdgpu_sriov_vf(adev) && adev->in_gpu_reset) {
+ 		psp_ring_stop(psp, PSP_RING_TYPE__KM); /* should not destroy ring, only stop */
++>>>>>>> 14d20ec7f31e (drm/amdgpu: psp_ring_destroy cause psp->km_ring.ring_mem NULL)
  		goto skip_memalloc;
 -	}
  
  	psp->cmd = kzalloc(sizeof(struct psp_gfx_cmd_resp), GFP_KERNEL);
  	if (!psp->cmd)
* Unmerged path drivers/gpu/drm/amd/amdgpu/amdgpu_psp.c
