crypto: qat - don't leak pointers to authenc keys

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1062.el7
Rebuild_CHGLOG: - [crypto] qat - don't leak pointers to authenc keys (Neil Horman) [1641143]
Rebuild_FUZZ: 91.11%
commit-author Tudor-Dan Ambarus <tudor.ambarus@microchip.com>
commit ab6815d028f330ae9490bff01689cd234506fe97
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1062.el7/ab6815d0.failed

In qat_alg_aead_init_sessions we save pointers to the authenc keys
in a local variable of type struct crypto_authenc_keys and we don't
zeroize it after use. Fix this and don't leak pointers to the
authenc keys.

	Signed-off-by: Tudor Ambarus <tudor.ambarus@microchip.com>
	Signed-off-by: Herbert Xu <herbert@gondor.apana.org.au>
(cherry picked from commit ab6815d028f330ae9490bff01689cd234506fe97)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/crypto/qat/qat_common/qat_algs.c
diff --cc drivers/crypto/qat/qat_common/qat_algs.c
index c6d52ba29a2e,1138e41d6805..000000000000
--- a/drivers/crypto/qat/qat_common/qat_algs.c
+++ b/drivers/crypto/qat/qat_common/qat_algs.c
@@@ -550,17 -540,20 +550,24 @@@ static int qat_alg_aead_init_sessions(s
  	if (qat_alg_validate_key(keys.enckeylen, &alg, mode))
  		goto bad_key;
  
 -	if (qat_alg_aead_init_enc_session(tfm, alg, &keys, mode))
 +	if (qat_alg_aead_init_enc_session(ctx, alg, &keys, mode))
  		goto error;
  
 -	if (qat_alg_aead_init_dec_session(tfm, alg, &keys, mode))
 +	if (qat_alg_aead_init_dec_session(ctx, alg, &keys, mode))
  		goto error;
  
+ 	memzero_explicit(&keys, sizeof(keys));
  	return 0;
  bad_key:
++<<<<<<< HEAD
 +	crypto_tfm_set_flags(ctx->tfm, CRYPTO_TFM_RES_BAD_KEY_LEN);
++=======
+ 	crypto_aead_set_flags(tfm, CRYPTO_TFM_RES_BAD_KEY_LEN);
+ 	memzero_explicit(&keys, sizeof(keys));
++>>>>>>> ab6815d028f3 (crypto: qat - don't leak pointers to authenc keys)
  	return -EINVAL;
  error:
+ 	memzero_explicit(&keys, sizeof(keys));
  	return -EFAULT;
  }
  
* Unmerged path drivers/crypto/qat/qat_common/qat_algs.c
