net/mlx5e: TX, Use correct counter in dma_map error flow

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1062.el7
Rebuild_CHGLOG: - [netdrv] mlx5e: TX, Use correct counter in dma_map error flow (Alaa Hleihel) [1642498]
Rebuild_FUZZ: 96.30%
commit-author Tariq Toukan <tariqt@mellanox.com>
commit d9a96ec362e3da878c378854e25321c85bac52c2
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1062.el7/d9a96ec3.failed

In case of a dma_mapping_error, do not use wi->num_dma
as a parameter for dma unmap function because it's yet
to be set, and holds an out-of-date value.
Use actual value (local variable num_dma) instead.

Fixes: 34802a42b352 ("net/mlx5e: Do not modify the TX SKB")
Fixes: e586b3b0baee ("net/mlx5: Ethernet Datapath files")
	Signed-off-by: Tariq Toukan <tariqt@mellanox.com>
	Signed-off-by: Saeed Mahameed <saeedm@mellanox.com>
(cherry picked from commit d9a96ec362e3da878c378854e25321c85bac52c2)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/mellanox/mlx5/core/en_tx.c
diff --cc drivers/net/ethernet/mellanox/mlx5/core/en_tx.c
index 31cc86df395a,5532aa3675c7..000000000000
--- a/drivers/net/ethernet/mellanox/mlx5/core/en_tx.c
+++ b/drivers/net/ethernet/mellanox/mlx5/core/en_tx.c
@@@ -389,10 -391,8 +393,15 @@@ static netdev_tx_t mlx5e_sq_xmit(struc
  
  	return NETDEV_TX_OK;
  
++<<<<<<< HEAD
 +dma_unmap_wqe_err:
 +	stats->dropped++;
 +	mlx5e_dma_unmap_wqe_err(sq, wi->num_dma);
 +
++=======
+ err_drop:
+ 	sq->stats.dropped++;
++>>>>>>> d9a96ec362e3 (net/mlx5e: TX, Use correct counter in dma_map error flow)
  	dev_kfree_skb_any(skb);
  
  	return NETDEV_TX_OK;
@@@ -649,10 -654,8 +658,15 @@@ netdev_tx_t mlx5i_sq_xmit(struct mlx5e_
  
  	return NETDEV_TX_OK;
  
++<<<<<<< HEAD
 +dma_unmap_wqe_err:
 +	stats->dropped++;
 +	mlx5e_dma_unmap_wqe_err(sq, wi->num_dma);
 +
++=======
+ err_drop:
+ 	sq->stats.dropped++;
++>>>>>>> d9a96ec362e3 (net/mlx5e: TX, Use correct counter in dma_map error flow)
  	dev_kfree_skb_any(skb);
  
  	return NETDEV_TX_OK;
* Unmerged path drivers/net/ethernet/mellanox/mlx5/core/en_tx.c
