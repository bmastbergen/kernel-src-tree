scsi: mpt3sas: Introduce function to clone mpi reply.

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1062.el7
Rebuild_CHGLOG: - [scsi] mpt3sas: Introduce function to clone mpi reply (Tomas Henzl) [1513855]
Rebuild_FUZZ: 92.93%
commit-author Suganath Prabu Subramani <suganath-prabu.subramani@broadcom.com>
commit b4472d7180894c96b6133ef5ff3df50836591eaa
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1062.el7/b4472d71.failed

If the posted request has an error of any type, the IOC writes
a Reply message into a host-based system reply message frame.
This functions clone it in the BAR0 mapped region.

	Signed-off-by: Suganath Prabu S <suganath-prabu.subramani@broadcom.com>
	Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
(cherry picked from commit b4472d7180894c96b6133ef5ff3df50836591eaa)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/scsi/mpt3sas/mpt3sas_base.c
diff --cc drivers/scsi/mpt3sas/mpt3sas_base.c
index 2d5e2fd11ddb,7858c2d4a14a..000000000000
--- a/drivers/scsi/mpt3sas/mpt3sas_base.c
+++ b/drivers/scsi/mpt3sas/mpt3sas_base.c
@@@ -125,6 -126,70 +125,73 @@@ module_param_call(mpt3sas_fwfault_debug
  	param_get_int, &mpt3sas_fwfault_debug, 0644);
  
  /**
++<<<<<<< HEAD
++=======
+  * _base_clone_reply_to_sys_mem - copies reply to reply free iomem
+  *				  in BAR0 space.
+  *
+  * @ioc: per adapter object
+  * @reply: reply message frame(lower 32bit addr)
+  * @index: System request message index.
+  *
+  * @Returns - Nothing
+  */
+ static void
+ _base_clone_reply_to_sys_mem(struct MPT3SAS_ADAPTER *ioc, u32 reply,
+ 		u32 index)
+ {
+ 	/*
+ 	 * 256 is offset within sys register.
+ 	 * 256 offset MPI frame starts. Max MPI frame supported is 32.
+ 	 * 32 * 128 = 4K. From here, Clone of reply free for mcpu starts
+ 	 */
+ 	u16 cmd_credit = ioc->facts.RequestCredit + 1;
+ 	void __iomem *reply_free_iomem = (void __iomem *)ioc->chip +
+ 			MPI_FRAME_START_OFFSET +
+ 			(cmd_credit * ioc->request_sz) + (index * sizeof(u32));
+ 
+ 	writel(reply, reply_free_iomem);
+ }
+ 
+ /**
+  * _base_clone_mpi_to_sys_mem - Writes/copies MPI frames
+  *				to system/BAR0 region.
+  *
+  * @dst_iomem: Pointer to the destinaltion location in BAR0 space.
+  * @src: Pointer to the Source data.
+  * @size: Size of data to be copied.
+  */
+ static void
+ _base_clone_mpi_to_sys_mem(void *dst_iomem, void *src, u32 size)
+ {
+ 	int i;
+ 	u32 *src_virt_mem = (u32 *)src;
+ 
+ 	for (i = 0; i < size/4; i++)
+ 		writel((u32)src_virt_mem[i],
+ 				(void __iomem *)dst_iomem + (i * 4));
+ }
+ 
+ /**
+  * _base_clone_to_sys_mem - Writes/copies data to system/BAR0 region
+  *
+  * @dst_iomem: Pointer to the destination location in BAR0 space.
+  * @src: Pointer to the Source data.
+  * @size: Size of data to be copied.
+  */
+ static void
+ _base_clone_to_sys_mem(void __iomem *dst_iomem, void *src, u32 size)
+ {
+ 	int i;
+ 	u32 *src_virt_mem = (u32 *)(src);
+ 
+ 	for (i = 0; i < size/4; i++)
+ 		writel((u32)src_virt_mem[i],
+ 			(void __iomem *)dst_iomem + (i * 4));
+ }
+ 
+ /**
++>>>>>>> b4472d718089 (scsi: mpt3sas: Introduce function to clone mpi reply.)
   * _base_get_chain - Calculates and Returns virtual chain address
   *			 for the provided smid in BAR0 space.
   *
* Unmerged path drivers/scsi/mpt3sas/mpt3sas_base.c
