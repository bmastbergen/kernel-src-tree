IB/rxe: optimize the function duplicate_request

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1062.el7
commit-author Zhu Yanjun <yanjun.zhu@oracle.com>
commit 2e47350789ebbc002b06d4549f60b5f9cba326ea
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1062.el7/2e473507.failed

In the function duplicate_request, the reference of skb can be increased
to replace the function skb_clone.

This will make rxe performace better and save memory.

CC: Srinivas Eeda <srinivas.eeda@oracle.com>
CC: Junxiao Bi <junxiao.bi@oracle.com>
	Signed-off-by: Zhu Yanjun <yanjun.zhu@oracle.com>
	Reviewed-by: Bart Van Assche <bart.vanassche@wdc.com>
	Signed-off-by: Doug Ledford <dledford@redhat.com>
(cherry picked from commit 2e47350789ebbc002b06d4549f60b5f9cba326ea)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/infiniband/sw/rxe/rxe_resp.c
diff --cc drivers/infiniband/sw/rxe/rxe_resp.c
index 955ff3b6da9c,c4172edf1f07..000000000000
--- a/drivers/infiniband/sw/rxe/rxe_resp.c
+++ b/drivers/infiniband/sw/rxe/rxe_resp.c
@@@ -1121,23 -1124,13 +1121,17 @@@ static enum resp_states duplicate_reque
  		/* Find the operation in our list of responder resources. */
  		res = find_resource(qp, pkt->psn);
  		if (res) {
- 			struct sk_buff *skb_copy;
- 
- 			skb_copy = skb_clone(res->atomic.skb, GFP_ATOMIC);
- 			if (skb_copy) {
- 				rxe_add_ref(qp); /* for the new SKB */
- 			} else {
- 				pr_warn("Couldn't clone atomic resp\n");
- 				rc = RESPST_CLEANUP;
- 				goto out;
- 			}
- 
+ 			skb_get(res->atomic.skb);
  			/* Resend the result. */
  			rc = rxe_xmit_packet(to_rdev(qp->ibqp.device), qp,
- 					     pkt, skb_copy);
+ 					     pkt, res->atomic.skb);
  			if (rc) {
  				pr_err("Failed resending result. This flow is not handled - skb ignored\n");
++<<<<<<< HEAD
 +				rxe_drop_ref(qp);
++=======
+ 				kfree_skb(res->atomic.skb);
++>>>>>>> 2e47350789eb (IB/rxe: optimize the function duplicate_request)
  				rc = RESPST_CLEANUP;
  				goto out;
  			}
* Unmerged path drivers/infiniband/sw/rxe/rxe_resp.c
