KVM: x86: Expose CLDEMOTE CPU feature to guest VM

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1062.el7
commit-author Jingqi Liu <jingqi.liu@intel.com>
commit 0ea3286e2df74c9ec2fadbf91170cd3edd14e3e5
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1062.el7/0ea3286e.failed

The CLDEMOTE instruction hints to hardware that the cache line that
contains the linear address should be moved("demoted") from
the cache(s) closest to the processor core to a level more distant
from the processor core. This may accelerate subsequent accesses
to the line by other cores in the same coherence domain,
especially if the line was written by the core that demotes the line.

This patch exposes the cldemote feature to the guest.

The release document ref below link:
https://software.intel.com/sites/default/files/managed/c5/15/\
architecture-instruction-set-extensions-programming-reference.pdf
This patch has a dependency on https://lkml.org/lkml/2018/4/23/928

	Signed-off-by: Jingqi Liu <jingqi.liu@intel.com>
	Reviewed-by: Wei Wang <wei.w.wang@intel.com>
	Signed-off-by: Radim Krčmář <rkrcmar@redhat.com>
(cherry picked from commit 0ea3286e2df74c9ec2fadbf91170cd3edd14e3e5)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/x86/kvm/cpuid.c
diff --cc arch/x86/kvm/cpuid.c
index 4ad37e47520b,72d8c492d71d..000000000000
--- a/arch/x86/kvm/cpuid.c
+++ b/arch/x86/kvm/cpuid.c
@@@ -383,10 -401,10 +383,17 @@@ static inline int __do_cpuid_ent(struc
  
  	/* cpuid 7.0.ecx*/
  	const u32 kvm_cpuid_7_0_ecx_x86_features =
++<<<<<<< HEAD
 +		F(AVX512VBMI) | F(PKU) | 0 /*OSPKE*/ |
 +		F(AVX512_VPOPCNTDQ) | F(AVX512_VBMI2) | F(GFNI) |
 +		F(VAES) | F(VPCLMULQDQ) | F(AVX512_VNNI) | F(AVX512_BITALG) |
 +		F(UMIP);
++=======
+ 		F(AVX512VBMI) | F(LA57) | F(PKU) | 0 /*OSPKE*/ |
+ 		F(AVX512_VPOPCNTDQ) | F(UMIP) | F(AVX512_VBMI2) | F(GFNI) |
+ 		F(VAES) | F(VPCLMULQDQ) | F(AVX512_VNNI) | F(AVX512_BITALG) |
+ 		F(CLDEMOTE);
++>>>>>>> 0ea3286e2df7 (KVM: x86: Expose CLDEMOTE CPU feature to guest VM)
  
  	/* cpuid 7.0.edx*/
  	const u32 kvm_cpuid_7_0_edx_x86_features =
* Unmerged path arch/x86/kvm/cpuid.c
