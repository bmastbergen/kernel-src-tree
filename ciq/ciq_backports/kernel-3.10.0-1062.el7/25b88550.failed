scsi: target: loop, usb, vhost, xen: use target_remove_session

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1062.el7
commit-author Mike Christie <mchristi@redhat.com>
commit 25b88550b7d57c6ae91b0e5f4b1be2aaa73a60df
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1062.el7/25b88550.failed

This converts drivers that were only calling transport_deregister_session
to use target_remove_session. The calling of
transport_deregister_session_configfs via target_remove_session for these
types of drivers is ok, because they were not exporting info from fields
like sess_acl_list, sess->se_tpg and sess->fabric_sess_ptr from configfs
accessible functions, so they will see no difference.

	Signed-off-by: Mike Christie <mchristi@redhat.com>
	Reviewed-by: Bart Van Assche <bart.vanassche@wdc.com>
	Reviewed-by: Christoph Hellwig <hch@lst.de>
	Cc: Felipe Balbi <balbi@kernel.org>
	Cc: Sebastian Andrzej Siewior <bigeasy@linutronix.de>
	Cc: Andrzej Pietrasiewicz <andrzej.p@samsung.com>
	Cc: Michael S. Tsirkin <mst@redhat.com>
	Cc: Juergen Gross <jgross@suse.com>
	Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
(cherry picked from commit 25b88550b7d57c6ae91b0e5f4b1be2aaa73a60df)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/xen/xen-scsiback.c
* Unmerged path drivers/xen/xen-scsiback.c
diff --git a/drivers/target/loopback/tcm_loop.c b/drivers/target/loopback/tcm_loop.c
index 9c89c28a7bc3..d26f20fd7ed5 100644
--- a/drivers/target/loopback/tcm_loop.c
+++ b/drivers/target/loopback/tcm_loop.c
@@ -860,7 +860,7 @@ static int tcm_loop_drop_nexus(
 	/*
 	 * Release the SCSI I_T Nexus to the emulated Target Port
 	 */
-	transport_deregister_session(tl_nexus->se_sess);
+	target_remove_session(se_sess);
 	tpg->tl_nexus = NULL;
 	kfree(tl_nexus);
 	return 0;
diff --git a/drivers/usb/gadget/tcm_usb_gadget.c b/drivers/usb/gadget/tcm_usb_gadget.c
index 9891e23fa6cb..3a8c753189d0 100644
--- a/drivers/usb/gadget/tcm_usb_gadget.c
+++ b/drivers/usb/gadget/tcm_usb_gadget.c
@@ -1747,7 +1747,7 @@ static int tcm_usbg_drop_nexus(struct usbg_tpg *tpg)
 	/*
 	 * Release the SCSI I_T Nexus to the emulated vHost Target Port
 	 */
-	transport_deregister_session(tv_nexus->tvn_se_sess);
+	target_remove_session(se_sess);
 	tpg->tpg_nexus = NULL;
 
 	kfree(tv_nexus);
diff --git a/drivers/vhost/scsi.c b/drivers/vhost/scsi.c
index 2b14ae4c9782..9376a594f9ce 100644
--- a/drivers/vhost/scsi.c
+++ b/drivers/vhost/scsi.c
@@ -1558,7 +1558,7 @@ static int tcm_vhost_drop_nexus(struct tcm_vhost_tpg *tpg)
 	/*
 	 * Release the SCSI I_T Nexus to the emulated vhost Target Port
 	 */
-	transport_deregister_session(tv_nexus->tvn_se_sess);
+	target_remove_session(se_sess);
 	tpg->tpg_nexus = NULL;
 	mutex_unlock(&tpg->tv_tpg_mutex);
 
* Unmerged path drivers/xen/xen-scsiback.c
