IB/mlx5: Set correct write permissions for implicit ODP MR

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1062.el7
commit-author Moni Shoua <monis@mellanox.com>
commit 7095ec3ca00eba04553d4c323dc9dd160219dd68
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1062.el7/7095ec3c.failed

The write access of an implicit MR is inherited to all of its children.
Therefore we must set the correct write access to the parent MR.

Pass full access_flags when creating umem to let it calculate write access
correctly.

Fixes: da6a496a34f2 ("IB/mlx5: Ranges in implicit ODP MR inherit its write access")
	Signed-off-by: Moni Shoua <monis@mellanox.com>
	Reviewed-by: Artemy Kovalyov <artemyko@mellanox.com>
	Signed-off-by: Leon Romanovsky <leonro@mellanox.com>
	Signed-off-by: Jason Gunthorpe <jgg@mellanox.com>
(cherry picked from commit 7095ec3ca00eba04553d4c323dc9dd160219dd68)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/infiniband/hw/mlx5/odp.c
diff --cc drivers/infiniband/hw/mlx5/odp.c
index 10f5aaeff4a4,c20bfc41ecf1..000000000000
--- a/drivers/infiniband/hw/mlx5/odp.c
+++ b/drivers/infiniband/hw/mlx5/odp.c
@@@ -444,7 -522,7 +444,11 @@@ struct mlx5_ib_mr *mlx5_ib_alloc_implic
  	struct mlx5_ib_mr *imr;
  	struct ib_umem *umem;
  
++<<<<<<< HEAD
 +	umem = ib_umem_get(ctx, 0, 0, IB_ACCESS_ON_DEMAND, 0);
++=======
+ 	umem = ib_umem_get(udata, 0, 0, access_flags, 0);
++>>>>>>> 7095ec3ca00e (IB/mlx5: Set correct write permissions for implicit ODP MR)
  	if (IS_ERR(umem))
  		return ERR_CAST(umem);
  
* Unmerged path drivers/infiniband/hw/mlx5/odp.c
