perf buildid-cache: Support --list option

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1062.el7
commit-author Ravi Bangoria <ravi.bangoria@linux.vnet.ibm.com>
commit 8e1e0d74672f84e6c4b1e26ce2bb2e529aaf8676
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1062.el7/8e1e0d74.failed

'perf buildid-cache' allows to add/remove files into cache but there is
no option to list all cached files. Add --list option to list all
_valid_ cached files.

Ex,
  # perf buildid-cache --add /tmp/a.out
  # perf buildid-cache -l
    8a86ef73e44067bca52cc3f6cd3e5446c783391c /tmp/a.out

	Signed-off-by: Ravi Bangoria <ravi.bangoria@linux.vnet.ibm.com>
	Acked-by: Jiri Olsa <jolsa@kernel.org>
	Cc: Alexander Shishkin <alexander.shishkin@linux.intel.com>
	Cc: Kate Stewart <kstewart@linuxfoundation.org>
	Cc: Krister Johansen <kjlx@templeofstupid.com>
	Cc: Masami Hiramatsu <mhiramat@kernel.org>
	Cc: Namhyung Kim <namhyung@kernel.org>
	Cc: Peter Zijlstra <peterz@infradead.org>
	Cc: Philippe Ombredanne <pombredanne@nexb.com>
	Cc: Sihyeon Jang <uneedsihyeon@gmail.com>
	Cc: Thomas Gleixner <tglx@linutronix.de>
Link: http://lkml.kernel.org/r/20180417041346.5617-3-ravi.bangoria@linux.vnet.ibm.com
	Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>
(cherry picked from commit 8e1e0d74672f84e6c4b1e26ce2bb2e529aaf8676)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	tools/perf/builtin-buildid-cache.c
diff --cc tools/perf/builtin-buildid-cache.c
index 76cff7bc13f3,fd0a08661b42..000000000000
--- a/tools/perf/builtin-buildid-cache.c
+++ b/tools/perf/builtin-buildid-cache.c
@@@ -286,7 -323,10 +307,9 @@@ int cmd_buildid_cache(int argc, const c
  	struct strlist *list;
  	struct str_node *pos;
  	int ret = 0;
 -	int ns_id = -1;
  	bool force = false;
+ 	bool list_files = false;
+ 	bool opts_flag = false;
  	char const *add_name_list_str = NULL,
  		   *remove_name_list_str = NULL,
  		   *purge_name_list_str = NULL,
@@@ -325,11 -368,22 +349,25 @@@
  	argc = parse_options(argc, argv, buildid_cache_options,
  			     buildid_cache_usage, 0);
  
- 	if (argc || (!add_name_list_str && !kcore_filename &&
- 		     !remove_name_list_str && !purge_name_list_str &&
- 		     !missing_filename && !update_name_list_str))
+ 	opts_flag = add_name_list_str || kcore_filename ||
+ 		remove_name_list_str || purge_name_list_str ||
+ 		missing_filename || update_name_list_str;
+ 
+ 	if (argc || !(list_files || opts_flag))
  		usage_with_options(buildid_cache_usage, buildid_cache_options);
  
++<<<<<<< HEAD
++=======
+ 	/* -l is exclusive. It can not be used with other options. */
+ 	if (list_files && opts_flag) {
+ 		usage_with_options_msg(buildid_cache_usage,
+ 			buildid_cache_options, "-l is exclusive.\n");
+ 	}
+ 
+ 	if (ns_id > 0)
+ 		nsi = nsinfo__new(ns_id);
+ 
++>>>>>>> 8e1e0d74672f (perf buildid-cache: Support --list option)
  	if (missing_filename) {
  		data.file.path = missing_filename;
  		data.force     = force;
diff --git a/tools/perf/Documentation/perf-buildid-cache.txt b/tools/perf/Documentation/perf-buildid-cache.txt
index 0a93f271b143..f867ae0cd878 100644
--- a/tools/perf/Documentation/perf-buildid-cache.txt
+++ b/tools/perf/Documentation/perf-buildid-cache.txt
@@ -59,7 +59,9 @@ OPTIONS
 	exactly same build-id, that is replaced by new one. It can be used
 	to update kallsyms and kernel dso to vmlinux in order to support
 	annotation.
-
+-l::
+--list::
+	List all valid binaries from cache.
 -v::
 --verbose::
 	Be more verbose.
* Unmerged path tools/perf/builtin-buildid-cache.c
