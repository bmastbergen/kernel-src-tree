RDMA/mlx4: Ensure that maximal send/receive SGE less than supported by HW

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1062.el7
commit-author Leon Romanovsky <leonro@mellanox.com>
commit 8f28b178f71cc56eccf2a6e2c0ace17c82f900d7
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1062.el7/8f28b178.failed

In calculating the global maximum number of the Scatter/Gather elements
supported, the following four maximum parameters must be taken into
consideration: max_sg_rq, max_sg_sq, max_desc_sz_rq and max_desc_sz_sq.

However instead of bringing this complexity to query_device, which still
won't be sufficient anyway (the calculations are dependent on QP type),
the safer approach will be to restore old code, which will give us 32
SGEs.

Fixes: 33023fb85a42 ("IB/core: add max_send_sge and max_recv_sge attributes")
	Reported-by: Chuck Lever <chuck.lever@oracle.com>
	Signed-off-by: Leon Romanovsky <leonro@mellanox.com>
	Signed-off-by: Jason Gunthorpe <jgg@mellanox.com>
(cherry picked from commit 8f28b178f71cc56eccf2a6e2c0ace17c82f900d7)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/infiniband/hw/mlx4/main.c
diff --cc drivers/infiniband/hw/mlx4/main.c
index ef0c6f64d142,0bbeaaae47e0..000000000000
--- a/drivers/infiniband/hw/mlx4/main.c
+++ b/drivers/infiniband/hw/mlx4/main.c
@@@ -517,9 -517,11 +517,17 @@@ static int mlx4_ib_query_device(struct 
  	props->page_size_cap	   = dev->dev->caps.page_size_cap;
  	props->max_qp		   = dev->dev->quotas.qp;
  	props->max_qp_wr	   = dev->dev->caps.max_wqes - MLX4_IB_SQ_MAX_SPARE;
++<<<<<<< HEAD
 +	props->max_sge		   = min(dev->dev->caps.max_sq_sg,
 +					 dev->dev->caps.max_rq_sg);
 +	props->max_sge_rd	   = MLX4_MAX_SGE_RD;
++=======
+ 	props->max_send_sge =
+ 		min(dev->dev->caps.max_sq_sg, dev->dev->caps.max_rq_sg);
+ 	props->max_recv_sge =
+ 		min(dev->dev->caps.max_sq_sg, dev->dev->caps.max_rq_sg);
+ 	props->max_sge_rd = MLX4_MAX_SGE_RD;
++>>>>>>> 8f28b178f71c (RDMA/mlx4: Ensure that maximal send/receive SGE less than supported by HW)
  	props->max_cq		   = dev->dev->quotas.cq;
  	props->max_cqe		   = dev->dev->caps.max_cqes;
  	props->max_mr		   = dev->dev->quotas.mpt;
* Unmerged path drivers/infiniband/hw/mlx4/main.c
