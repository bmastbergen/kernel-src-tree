scsi: qla2xxx: Fix redundant fc_rport registration

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1062.el7
Rebuild_CHGLOG: - [scsi] qla2xxx: Fix redundant fc_rport registration (Himanshu Madhani) [1628301]
Rebuild_FUZZ: 93.62%
commit-author Quinn Tran <quinn.tran@cavium.com>
commit b63d8b895a1038e5ff762e19b46e9fe9fa3a19a2
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1062.el7/b63d8b89.failed

Prevent multiple registrations with transport layer for the same remote
port.

	Signed-off-by: Quinn Tran <quinn.tran@cavium.com>
	Signed-off-by: Himanshu Madhani <himanshu.madhani@cavium.com>
	Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
(cherry picked from commit b63d8b895a1038e5ff762e19b46e9fe9fa3a19a2)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/scsi/qla2xxx/qla_init.c
diff --cc drivers/scsi/qla2xxx/qla_init.c
index d7dabcc58986,df55fd4e1716..000000000000
--- a/drivers/scsi/qla2xxx/qla_init.c
+++ b/drivers/scsi/qla2xxx/qla_init.c
@@@ -5011,21 -5060,12 +5014,27 @@@ qla2x00_update_fcport(scsi_qla_host_t *
  	if (IS_SW_RESV_ADDR(fcport->d_id))
  		return;
  
- 	ql_dbg(ql_dbg_disc, vha, 0x20ef, "%s %8phC\n",
- 	    __func__, fcport->port_name);
+ 	fcport->flags &= ~(FCF_LOGIN_NEEDED | FCF_ASYNC_SENT);
+ 	fcport->disc_state = DSC_LOGIN_COMPLETE;
+ 	fcport->deleted = 0;
+ 	fcport->logout_on_delete = 1;
+ 	fcport->login_retry = vha->hw->login_retry_count;
  
++<<<<<<< HEAD
 +	if (IS_QLAFX00(vha->hw)) {
 +		qla2x00_set_fcport_state(fcport, FCS_ONLINE);
 +	} else {
 +		fcport->login_retry = 0;
 +		fcport->flags &= ~(FCF_LOGIN_NEEDED | FCF_ASYNC_SENT);
 +		fcport->disc_state = DSC_LOGIN_COMPLETE;
 +		fcport->deleted = 0;
 +		fcport->logout_on_delete = 1;
 +		qla2x00_set_fcport_state(fcport, FCS_ONLINE);
 +	}
 +
 +	qla2x00_set_fcport_state(fcport, FCS_ONLINE);
++=======
++>>>>>>> b63d8b895a10 (scsi: qla2xxx: Fix redundant fc_rport registration)
  	qla2x00_iidma_fcport(vha, fcport);
  
  	if (fcport->fc4f_nvme) {
* Unmerged path drivers/scsi/qla2xxx/qla_init.c
