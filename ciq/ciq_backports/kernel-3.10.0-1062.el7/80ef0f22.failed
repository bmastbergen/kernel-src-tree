net/sched: act_tunnel_key: Allow key-less tunnels

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1062.el7
Rebuild_CHGLOG: - [net] sched: act_tunnel_key: Allow key-less tunnels (Ivan Vecera) [1660903]
Rebuild_FUZZ: 95.74%
commit-author Adi Nissim <adin@mellanox.com>
commit 80ef0f22ceda1804cc572836722df7a33dec71c9
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1062.el7/80ef0f22.failed

Allow setting a tunnel without a tunnel key. This is required for
tunneling protocols, such as GRE, that define the key as an optional
field.

	Signed-off-by: Adi Nissim <adin@mellanox.com>
	Acked-by: Or Gerlitz <ogerlitz@mellanox.com>
	Reviewed-by: Oz Shlomo <ozsh@mellanox.com>
	Acked-by: Jiri Pirko <jiri@mellanox.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 80ef0f22ceda1804cc572836722df7a33dec71c9)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/sched/act_tunnel_key.c
diff --cc net/sched/act_tunnel_key.c
index 8a956b17d019,fad438c0f7a7..000000000000
--- a/net/sched/act_tunnel_key.c
+++ b/net/sched/act_tunnel_key.c
@@@ -240,14 -246,15 +240,21 @@@ static int tunnel_key_init(struct net *
  	case TCA_TUNNEL_KEY_ACT_RELEASE:
  		break;
  	case TCA_TUNNEL_KEY_ACT_SET:
++<<<<<<< HEAD
 +		if (!tb[TCA_TUNNEL_KEY_ENC_KEY_ID]) {
 +			ret = -EINVAL;
 +			goto err_out;
++=======
+ 		if (tb[TCA_TUNNEL_KEY_ENC_KEY_ID]) {
+ 			__be32 key32;
+ 
+ 			key32 = nla_get_be32(tb[TCA_TUNNEL_KEY_ENC_KEY_ID]);
+ 			key_id = key32_to_tunnel_id(key32);
+ 			flags = TUNNEL_KEY;
++>>>>>>> 80ef0f22ceda (net/sched: act_tunnel_key: Allow key-less tunnels)
  		}
  
- 		key_id = key32_to_tunnel_id(nla_get_be32(tb[TCA_TUNNEL_KEY_ENC_KEY_ID]));
- 
- 		flags = TUNNEL_KEY | TUNNEL_CSUM;
+ 		flags |= TUNNEL_CSUM;
  		if (tb[TCA_TUNNEL_KEY_NO_CSUM] &&
  		    nla_get_u8(tb[TCA_TUNNEL_KEY_NO_CSUM]))
  			flags &= ~TUNNEL_CSUM;
* Unmerged path net/sched/act_tunnel_key.c
