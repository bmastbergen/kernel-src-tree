ipmi: msghandler: Add and use pr_fmt and dev_fmt, remove PFX

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1062.el7
commit-author Joe Perches <joe@perches.com>
commit 445e2cbda928a3523c1c1da76788d19df52611c8
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1062.el7/445e2cbd.failed

Standardize the prefixing of output messages using the pr_fmt and dev_fmt
mechanisms instead of a separate #define PFX

Miscellanea:

o Because this message prefix is very long, use a non-standard define
  of #define pr_fmt(fmt) "%s" fmt, "IPMI message handler: "
  which removes ~170 bytes of object code in an x86-64 defconfig with ipmi
  (with even more object code reduction on 32 bit compilations)

	Signed-off-by: Joe Perches <joe@perches.com>
	Signed-off-by: Corey Minyard <cminyard@mvista.com>
(cherry picked from commit 445e2cbda928a3523c1c1da76788d19df52611c8)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/char/ipmi/ipmi_msghandler.c
diff --cc drivers/char/ipmi/ipmi_msghandler.c
index 5b5cc5cd2796,04f64c55e275..000000000000
--- a/drivers/char/ipmi/ipmi_msghandler.c
+++ b/drivers/char/ipmi/ipmi_msghandler.c
@@@ -8,29 -9,11 +8,32 @@@
   *         source@mvista.com
   *
   * Copyright 2002 MontaVista Software Inc.
 + *
 + *  This program is free software; you can redistribute it and/or modify it
 + *  under the terms of the GNU General Public License as published by the
 + *  Free Software Foundation; either version 2 of the License, or (at your
 + *  option) any later version.
 + *
 + *
 + *  THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESS OR IMPLIED
 + *  WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
 + *  MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
 + *  IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,
 + *  INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
 + *  BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS
 + *  OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 + *  ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR
 + *  TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE
 + *  USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 + *
 + *  You should have received a copy of the GNU General Public License along
 + *  with this program; if not, write to the Free Software Foundation, Inc.,
 + *  675 Mass Ave, Cambridge, MA 02139, USA.
   */
  
+ #define pr_fmt(fmt) "%s" fmt, "IPMI message handler: "
+ #define dev_fmt pr_fmt
+ 
  #include <linux/module.h>
  #include <linux/errno.h>
  #include <linux/poll.h>
@@@ -50,10 -33,6 +53,13 @@@
  #include <linux/workqueue.h>
  #include <linux/uuid.h>
  
++<<<<<<< HEAD
 +#include <linux/rh_kabi.h>
 +
 +#define PFX "IPMI message handler: "
 +
++=======
++>>>>>>> 445e2cbda928 (ipmi: msghandler: Add and use pr_fmt and dev_fmt, remove PFX)
  #define IPMI_DRIVER_VERSION "39.2"
  
  static struct ipmi_recv_msg *ipmi_alloc_recv_msg(void);
@@@ -5218,19 -5036,9 +5220,19 @@@ static int ipmi_init_msghandler(void
  		return rv;
  	}
  
- 	pr_info("ipmi message handler version " IPMI_DRIVER_VERSION "\n");
+ 	pr_info("version " IPMI_DRIVER_VERSION "\n");
  
 -	timer_setup(&ipmi_timer, ipmi_timeout, 0);
 +#ifdef CONFIG_IPMI_PROC_INTERFACE
 +	proc_ipmi_root = proc_mkdir("ipmi", NULL);
 +	if (!proc_ipmi_root) {
 +	    pr_err(PFX "Unable to create IPMI proc dir");
 +	    driver_unregister(&ipmidriver.driver);
 +	    return -ENOMEM;
 +	}
 +
 +#endif /* CONFIG_IPMI_PROC_INTERFACE */
 +
 +	setup_timer(&ipmi_timer, ipmi_timeout, 0);
  	mod_timer(&ipmi_timer, jiffies + IPMI_TIMEOUT_JIFFIES);
  
  	atomic_notifier_chain_register(&panic_notifier_list, &panic_block);
* Unmerged path drivers/char/ipmi/ipmi_msghandler.c
