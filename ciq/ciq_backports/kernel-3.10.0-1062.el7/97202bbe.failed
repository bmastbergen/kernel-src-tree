IB/uverbs: Do not use uverbs_cmd_mask in the ioctl path

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1062.el7
commit-author Jason Gunthorpe <jgg@mellanox.com>
commit 97202bbe22f8f0c225ba63a50acaf56d6796c990
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1062.el7/97202bbe.failed

Instead we are now checking the function pointers directly. Get rid of
both cases in ioctl and drop the nonsense idea that destroy can fail.

	Signed-off-by: Jason Gunthorpe <jgg@mellanox.com>
	Reviewed-by: Leon Romanovsky <leonro@mellanox.com>
(cherry picked from commit 97202bbe22f8f0c225ba63a50acaf56d6796c990)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/infiniband/core/uverbs_std_types_cq.c
diff --cc drivers/infiniband/core/uverbs_std_types_cq.c
index b0dbae9dd0d7,5a6154345fa0..000000000000
--- a/drivers/infiniband/core/uverbs_std_types_cq.c
+++ b/drivers/infiniband/core/uverbs_std_types_cq.c
@@@ -65,10 -68,9 +65,10 @@@ static int UVERBS_HANDLER(UVERBS_METHOD
  	struct ib_cq_init_attr attr = {};
  	struct ib_cq                   *cq;
  	struct ib_uverbs_completion_event_file    *ev_file = NULL;
 +	const struct uverbs_attr *ev_file_attr;
  	struct ib_uobject *ev_file_uobj;
  
- 	if (!(ib_dev->uverbs_cmd_mask & 1ULL << IB_USER_VERBS_CMD_CREATE_CQ))
+ 	if (!ib_dev->create_cq || !ib_dev->destroy_cq)
  		return -EOPNOTSUPP;
  
  	ret = uverbs_copy_from(&attr.comp_vector, attrs,
@@@ -170,15 -174,16 +170,22 @@@ static int UVERBS_HANDLER(UVERBS_METHOD
  						    struct ib_uverbs_file *file,
  						    struct uverbs_attr_bundle *attrs)
  {
 -	struct ib_uobject *uobj =
 -		uverbs_attr_get_uobject(attrs, UVERBS_ATTR_DESTROY_CQ_HANDLE);
  	struct ib_uverbs_destroy_cq_resp resp;
 -	struct ib_ucq_object *obj;
 +	struct ib_uobject *uobj =
 +		uverbs_attr_get(attrs, UVERBS_ATTR_DESTROY_CQ_HANDLE)->obj_attr.uobject;
 +	struct ib_ucq_object *obj = container_of(uobj, struct ib_ucq_object,
 +						 uobject);
  	int ret;
  
++<<<<<<< HEAD
 +	if (!(ib_dev->uverbs_cmd_mask & 1ULL << IB_USER_VERBS_CMD_DESTROY_CQ))
 +		return -EOPNOTSUPP;
++=======
+ 	if (IS_ERR(uobj))
+ 		return PTR_ERR(uobj);
+ 
+ 	obj = container_of(uobj, struct ib_ucq_object, uobject);
++>>>>>>> 97202bbe22f8 (IB/uverbs: Do not use uverbs_cmd_mask in the ioctl path)
  
  	ret = rdma_explicit_destroy(uobj);
  	if (ret)
* Unmerged path drivers/infiniband/core/uverbs_std_types_cq.c
