RDMA/nldev: Return port capability flag for IB only

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1062.el7
commit-author Leon Romanovsky <leonro@mellanox.com>
commit dd8028f1e912134f35698392652bc561ef0d9cb4
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1062.el7/dd8028f1.failed

Port capability flag represents IBTA PortInfo:CapabilityMask,
but was mistakenly mixed with non-relevant fields. Return that
information for IB only.

Link: https://patchwork.kernel.org/patch/10386245/
	Signed-off-by: Leon Romanovsky <leonro@mellanox.com>
	Signed-off-by: Jason Gunthorpe <jgg@mellanox.com>
(cherry picked from commit dd8028f1e912134f35698392652bc561ef0d9cb4)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/infiniband/core/nldev.c
diff --cc drivers/infiniband/core/nldev.c
index 67368b6847cb,0385ab438320..000000000000
--- a/drivers/infiniband/core/nldev.c
+++ b/drivers/infiniband/core/nldev.c
@@@ -130,15 -237,15 +130,26 @@@ static int fill_port_info(struct sk_buf
  	if (ret)
  		return ret;
  
++<<<<<<< HEAD
 +	BUILD_BUG_ON(sizeof(attr.port_cap_flags) > sizeof(u64));
 +	if (nla_put_u64_64bit(msg, RDMA_NLDEV_ATTR_CAP_FLAGS,
 +			      (u64)attr.port_cap_flags, 0))
 +		return -EMSGSIZE;
 +	if (rdma_protocol_ib(device, port) &&
 +	    nla_put_u64_64bit(msg, RDMA_NLDEV_ATTR_SUBNET_PREFIX,
 +			      attr.subnet_prefix, 0))
 +		return -EMSGSIZE;
++=======
++>>>>>>> dd8028f1e912 (RDMA/nldev: Return port capability flag for IB only)
  	if (rdma_protocol_ib(device, port)) {
+ 		BUILD_BUG_ON(sizeof(attr.port_cap_flags) > sizeof(u64));
+ 		if (nla_put_u64_64bit(msg, RDMA_NLDEV_ATTR_CAP_FLAGS,
+ 				      (u64)attr.port_cap_flags,
+ 				      RDMA_NLDEV_ATTR_PAD))
+ 			return -EMSGSIZE;
+ 		if (nla_put_u64_64bit(msg, RDMA_NLDEV_ATTR_SUBNET_PREFIX,
+ 				      attr.subnet_prefix, RDMA_NLDEV_ATTR_PAD))
+ 			return -EMSGSIZE;
  		if (nla_put_u32(msg, RDMA_NLDEV_ATTR_LID, attr.lid))
  			return -EMSGSIZE;
  		if (nla_put_u32(msg, RDMA_NLDEV_ATTR_SM_LID, attr.sm_lid))
* Unmerged path drivers/infiniband/core/nldev.c
