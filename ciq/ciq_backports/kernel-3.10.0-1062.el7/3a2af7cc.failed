mac80211_hwsim: Fix possible Spectre-v1 for hwsim_world_regdom_custom

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1062.el7
commit-author Jinbum Park <jinb.park7@gmail.com>
commit 3a2af7cccbbaf2362db9053a946a6084e12bfa73
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1062.el7/3a2af7cc.failed

User controls @idx which to be used as index of hwsim_world_regdom_custom.
So, It can be exploited via Spectre-like attack. (speculative execution)

This kind of attack leaks address of hwsim_world_regdom_custom,
It leads an attacker to bypass security mechanism such as KASLR.

So sanitize @idx before using it to prevent attack.

I leveraged strategy [1] to find and exploit this gadget.

[1] https://github.com/jinb-park/linux-exploit/tree/master/exploit-remaining-spectre-gadget/

	Signed-off-by: Jinbum Park <jinb.park7@gmail.com>
[johannes: unwrap URL]
	Signed-off-by: Johannes Berg <johannes.berg@intel.com>
(cherry picked from commit 3a2af7cccbbaf2362db9053a946a6084e12bfa73)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/wireless/mac80211_hwsim.c
diff --cc drivers/net/wireless/mac80211_hwsim.c
index 6015bd7f1e3d,80e2c8595c7c..000000000000
--- a/drivers/net/wireless/mac80211_hwsim.c
+++ b/drivers/net/wireless/mac80211_hwsim.c
@@@ -32,6 -32,8 +32,11 @@@
  #include <net/genetlink.h>
  #include <net/net_namespace.h>
  #include <net/netns/generic.h>
++<<<<<<< HEAD
++=======
+ #include <linux/rhashtable.h>
+ #include <linux/nospec.h>
++>>>>>>> 3a2af7cccbba (mac80211_hwsim: Fix possible Spectre-v1 for hwsim_world_regdom_custom)
  #include "mac80211_hwsim.h"
  
  #define WARN_QUEUE 100
* Unmerged path drivers/net/wireless/mac80211_hwsim.c
