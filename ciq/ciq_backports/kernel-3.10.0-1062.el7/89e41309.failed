tcp: do not use ipv6 header for ipv4 flow

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1062.el7
commit-author Eric Dumazet <edumazet@google.com>
commit 89e4130939a20304f4059ab72179da81f5347528
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1062.el7/89e41309.failed

When a dual stack tcp listener accepts an ipv4 flow,
it should not attempt to use an ipv6 header or tcp_v6_iif() helper.

Fixes: 1397ed35f22d ("ipv6: add flowinfo for tcp6 pkt_options for all cases")
Fixes: df3687ffc665 ("ipv6: add the IPV6_FL_F_REFLECT flag to IPV6_FL_A_GET")
Fixes: 1da177e4c3f4 ("Linux-2.6.12-rc2")
	Signed-off-by: Eric Dumazet <edumazet@google.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 89e4130939a20304f4059ab72179da81f5347528)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/ipv6/tcp_ipv6.c
diff --cc net/ipv6/tcp_ipv6.c
index eafbe1403cdc,44d431849d39..000000000000
--- a/net/ipv6/tcp_ipv6.c
+++ b/net/ipv6/tcp_ipv6.c
@@@ -1099,9 -1110,11 +1099,17 @@@ static struct sock *tcp_v6_syn_recv_soc
  		newnp->ipv6_fl_list = NULL;
  		newnp->pktoptions  = NULL;
  		newnp->opt	   = NULL;
++<<<<<<< HEAD
 +		newnp->mcast_oif   = inet6_iif(skb);
 +		newnp->mcast_hops  = ipv6_hdr(skb)->hop_limit;
 +		newnp->rcv_flowinfo = ip6_flowinfo(ipv6_hdr(skb));
++=======
+ 		newnp->mcast_oif   = inet_iif(skb);
+ 		newnp->mcast_hops  = ip_hdr(skb)->ttl;
+ 		newnp->rcv_flowinfo = 0;
+ 		if (np->repflow)
+ 			newnp->flow_label = 0;
++>>>>>>> 89e4130939a2 (tcp: do not use ipv6 header for ipv4 flow)
  
  		/*
  		 * No need to charge this sock to the relevant IPv6 refcnt debug socks count
* Unmerged path net/ipv6/tcp_ipv6.c
