bnxt_en: Fix ethtool self-test loopback.

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1062.el7
Rebuild_CHGLOG: - [netdrv] bnxt_en: Fix ethtool self-test loopback (Jonathan Toppins) [1643317]
Rebuild_FUZZ: 98.73%
commit-author Michael Chan <michael.chan@broadcom.com>
commit 84404d5fd5858588bbf694b0300dbc6310d02737
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1062.el7/84404d5f.failed

The current code has 2 problems.  It assumes that the RX ring for
the loopback packet is combined with the TX ring.  This is not
true if the ethtool channels are set to non-combined mode.  The
second problem is that it won't work on 57500 chips without
adjusting the logic to get the proper completion ring (cpr) pointer.
Fix both issues by locating the proper cpr pointer through the RX
ring.

Fixes: e44758b78ae8 ("bnxt_en: Use bnxt_cp_ring_info struct pointer as parameter for RX path.")
	Signed-off-by: Michael Chan <michael.chan@broadcom.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 84404d5fd5858588bbf694b0300dbc6310d02737)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/broadcom/bnxt/bnxt_ethtool.c
diff --cc drivers/net/ethernet/broadcom/bnxt/bnxt_ethtool.c
index c7fa186c8e4e,6b51f4de6017..000000000000
--- a/drivers/net/ethernet/broadcom/bnxt/bnxt_ethtool.c
+++ b/drivers/net/ethernet/broadcom/bnxt/bnxt_ethtool.c
@@@ -2725,12 -2572,17 +2725,23 @@@ static int bnxt_poll_loopback(struct bn
  static int bnxt_run_loopback(struct bnxt *bp)
  {
  	struct bnxt_tx_ring_info *txr = &bp->tx_ring[0];
++<<<<<<< HEAD
++=======
+ 	struct bnxt_rx_ring_info *rxr = &bp->rx_ring[0];
+ 	struct bnxt_cp_ring_info *cpr;
++>>>>>>> 84404d5fd585 (bnxt_en: Fix ethtool self-test loopback.)
  	int pkt_size, i = 0;
  	struct sk_buff *skb;
  	dma_addr_t map;
  	u8 *data;
  	int rc;
  
++<<<<<<< HEAD
++=======
+ 	cpr = &rxr->bnapi->cp_ring;
+ 	if (bp->flags & BNXT_FLAG_CHIP_P5)
+ 		cpr = cpr->cp_ring_arr[BNXT_RX_HDL];
++>>>>>>> 84404d5fd585 (bnxt_en: Fix ethtool self-test loopback.)
  	pkt_size = min(bp->dev->mtu + ETH_HLEN, bp->rx_copy_thresh);
  	skb = netdev_alloc_skb(bp->dev, pkt_size);
  	if (!skb)
* Unmerged path drivers/net/ethernet/broadcom/bnxt/bnxt_ethtool.c
