fsnotify: fix ignore mask logic in fsnotify()

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1062.el7
commit-author Amir Goldstein <amir73il@gmail.com>
commit 9bdda4e9cf2dcecb60a0683b10ffb8cd7e5f2f45
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1062.el7/9bdda4e9.failed

Commit 92183a42898d ("fsnotify: fix ignore mask logic in
send_to_group()") acknoledges the use case of ignoring an event on
an inode mark, because of an ignore mask on a mount mark of the same
group (i.e. I want to get all events on this file, except for the events
that came from that mount).

This change depends on correctly merging the inode marks and mount marks
group lists, so that the mount mark ignore mask would be tested in
send_to_group(). Alas, the merging of the lists did not take into
account the case where event in question is not in the mask of any of
the mount marks.

To fix this, completely remove the tests for inode and mount event masks
from the lists merging code.

Fixes: 92183a42898d ("fsnotify: fix ignore mask logic in send_to_group")
	Signed-off-by: Amir Goldstein <amir73il@gmail.com>
	Signed-off-by: Jan Kara <jack@suse.cz>
(cherry picked from commit 9bdda4e9cf2dcecb60a0683b10ffb8cd7e5f2f45)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	fs/notify/fsnotify.c
diff --cc fs/notify/fsnotify.c
index 17c81eef3fd4,ababdbfab537..000000000000
--- a/fs/notify/fsnotify.c
+++ b/fs/notify/fsnotify.c
@@@ -305,17 -351,10 +305,24 @@@ int fsnotify(struct inode *to_tell, __u
  
  	iter_info.srcu_idx = srcu_read_lock(&fsnotify_mark_srcu);
  
++<<<<<<< HEAD
 +	if ((mask & FS_MODIFY) ||
 +	    (test_mask & to_tell->i_fsnotify_mask)) {
 +		iter_info.inode_mark =
 +			fsnotify_first_mark(&to_tell->i_fsnotify_marks);
 +	}
 +
 +	if (mnt && ((mask & FS_MODIFY) ||
 +		    (test_mask & mnt->mnt_fsnotify_mask))) {
 +		iter_info.inode_mark =
 +			fsnotify_first_mark(&to_tell->i_fsnotify_marks);
 +		iter_info.vfsmount_mark =
++=======
+ 	iter_info.marks[FSNOTIFY_OBJ_TYPE_INODE] =
+ 		fsnotify_first_mark(&to_tell->i_fsnotify_marks);
+ 	if (mnt) {
+ 		iter_info.marks[FSNOTIFY_OBJ_TYPE_VFSMOUNT] =
++>>>>>>> 9bdda4e9cf2d (fsnotify: fix ignore mask logic in fsnotify())
  			fsnotify_first_mark(&mnt->mnt_fsnotify_marks);
  	}
  
* Unmerged path fs/notify/fsnotify.c
