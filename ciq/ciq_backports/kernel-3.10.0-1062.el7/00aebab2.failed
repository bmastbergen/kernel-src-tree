net/mlx5e: TLS, add Innova TLS rx data path

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1062.el7
Rebuild_CHGLOG: - [netdrv] mlx5e: TLS, add Innova TLS rx data path (Alaa Hleihel) [1642498]
Rebuild_FUZZ: 95.12%
commit-author Boris Pismenny <borisp@mellanox.com>
commit 00aebab27c8752c7420dce286270ccedc70ac39a
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1062.el7/00aebab2.failed

Implement the TLS rx offload data path according to the
requirements of the TLS generic NIC offload infrastructure.

Special metadata ethertype is used to pass information to
the hardware.

When hardware loses synchronization a special resync request
metadata message is used to request resync.

	Signed-off-by: Boris Pismenny <borisp@mellanox.com>
	Signed-off-by: Ilya Lesokhin <ilyal@mellanox.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 00aebab27c8752c7420dce286270ccedc70ac39a)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/infiniband/hw/ipath/ipath_wc_ppc64.c
#	drivers/net/ethernet/mellanox/mlx5/core/en_accel/tls_rxtx.c
#	drivers/net/ethernet/mellanox/mlx5/core/en_rx.c
diff --cc drivers/infiniband/hw/ipath/ipath_wc_ppc64.c
index 1d7bd82a1fb1,311667ec71b8..000000000000
--- a/drivers/infiniband/hw/ipath/ipath_wc_ppc64.c
+++ b/drivers/infiniband/hw/ipath/ipath_wc_ppc64.c
@@@ -28,35 -28,26 +28,50 @@@
   * ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
   * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
   * SOFTWARE.
 - *
   */
  
 -#ifndef __MLX5E_TLS_RXTX_H__
 -#define __MLX5E_TLS_RXTX_H__
 +/*
 + * This file is conditionally built on PowerPC only.  Otherwise weak symbol
 + * versions of the functions exported from here are used.
 + */
  
 -#ifdef CONFIG_MLX5_EN_TLS
 +#include "ipath_kernel.h"
  
 -#include <linux/skbuff.h>
 -#include "en.h"
 +/**
 + * ipath_enable_wc - enable write combining for MMIO writes to the device
 + * @dd: infinipath device
 + *
 + * Nothing to do on PowerPC, so just return without error.
 + */
 +int ipath_enable_wc(struct ipath_devdata *dd)
 +{
 +	return 0;
 +}
  
++<<<<<<< HEAD:drivers/infiniband/hw/ipath/ipath_wc_ppc64.c
 +/**
 + * ipath_unordered_wc - indicate whether write combining is unordered
 + *
 + * Because our performance depends on our ability to do write
 + * combining mmio writes in the most efficient way, we need to
 + * know if we are on a processor that may reorder stores when
 + * write combining.
 + */
 +int ipath_unordered_wc(void)
 +{
 +	return 1;
 +}
++=======
+ struct sk_buff *mlx5e_tls_handle_tx_skb(struct net_device *netdev,
+ 					struct mlx5e_txqsq *sq,
+ 					struct sk_buff *skb,
+ 					struct mlx5e_tx_wqe **wqe,
+ 					u16 *pi);
+ 
+ void mlx5e_tls_handle_rx_skb(struct net_device *netdev, struct sk_buff *skb,
+ 			     u32 *cqe_bcnt);
+ 
+ #endif /* CONFIG_MLX5_EN_TLS */
+ 
+ #endif /* __MLX5E_TLS_RXTX_H__ */
++>>>>>>> 00aebab27c87 (net/mlx5e: TLS, add Innova TLS rx data path):drivers/net/ethernet/mellanox/mlx5/core/en_accel/tls_rxtx.h
diff --cc drivers/net/ethernet/mellanox/mlx5/core/en_rx.c
index 3631c4f3022b,0f2bcc243235..000000000000
--- a/drivers/net/ethernet/mellanox/mlx5/core/en_rx.c
+++ b/drivers/net/ethernet/mellanox/mlx5/core/en_rx.c
@@@ -698,12 -793,16 +699,20 @@@ static inline void mlx5e_build_rx_skb(s
  				      struct mlx5e_rq *rq,
  				      struct sk_buff *skb)
  {
 -	u8 lro_num_seg = be32_to_cpu(cqe->srqn) >> 24;
  	struct mlx5e_rq_stats *stats = rq->stats;
  	struct net_device *netdev = rq->netdev;
 +	int lro_num_seg;
  
  	skb->mac_len = ETH_HLEN;
++<<<<<<< HEAD
 +	lro_num_seg = be32_to_cpu(cqe->srqn) >> 24;
++=======
+ 
+ #ifdef CONFIG_MLX5_EN_TLS
+ 	mlx5e_tls_handle_rx_skb(netdev, skb, &cqe_bcnt);
+ #endif
+ 
++>>>>>>> 00aebab27c87 (net/mlx5e: TLS, add Innova TLS rx data path)
  	if (lro_num_seg > 1) {
  		mlx5e_lro_update_hdr(skb, cqe, cqe_bcnt);
  		skb_shinfo(skb)->gso_size = DIV_ROUND_UP(cqe_bcnt, lro_num_seg);
* Unmerged path drivers/net/ethernet/mellanox/mlx5/core/en_accel/tls_rxtx.c
* Unmerged path drivers/infiniband/hw/ipath/ipath_wc_ppc64.c
* Unmerged path drivers/net/ethernet/mellanox/mlx5/core/en_accel/tls_rxtx.c
* Unmerged path drivers/net/ethernet/mellanox/mlx5/core/en_rx.c
