cls_flower: Fix incorrect idr release when failing to modify rule

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1062.el7
commit-author Paul Blakey <paulb@mellanox.com>
commit 8258d2da9f9f521dce7019e018360c28d116354e
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1062.el7/8258d2da.failed

When we fail to modify a rule, we incorrectly release the idr handle
of the unmodified old rule.

Fix that by checking if we need to release it.

Fixes: fe2502e49b58 ("net_sched: remove cls_flower idr on failure")
	Reported-by: Vlad Buslov <vladbu@mellanox.com>
	Reviewed-by: Roi Dayan <roid@mellanox.com>
	Acked-by: Jiri Pirko <jiri@mellanox.com>
	Signed-off-by: Paul Blakey <paulb@mellanox.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 8258d2da9f9f521dce7019e018360c28d116354e)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/sched/cls_flower.c
diff --cc net/sched/cls_flower.c
index eb4e6a91f3e1,c79f6e71512e..000000000000
--- a/net/sched/cls_flower.c
+++ b/net/sched/cls_flower.c
@@@ -1033,8 -977,8 +1033,13 @@@ static int fl_change(struct net *net, s
  	return 0;
  
  errout_idr:
++<<<<<<< HEAD
 +	if (fnew->handle)
 +		idr_remove_ext(&head->handle_idr, fnew->handle);
++=======
+ 	if (!fold)
+ 		idr_remove(&head->handle_idr, fnew->handle);
++>>>>>>> 8258d2da9f9f (cls_flower: Fix incorrect idr release when failing to modify rule)
  errout:
  	tcf_exts_destroy(&fnew->exts);
  	kfree(fnew);
* Unmerged path net/sched/cls_flower.c
