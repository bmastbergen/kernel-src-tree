ALSA: hda: hdmi - add Icelake support

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1062.el7
commit-author Jaroslav Kysela <perex@perex.cz>
commit b0d8bc50b9f221e3af76afe0473f7c171cebbb40
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1062.el7/b0d8bc50.failed

This is just a port of the ASoC Icelake HDMI codec code to the legacy
HDA driver with some cleanups.

ASoC commit 019033c854a20e10f691f6cc0e897df8817d9521:
  "ASoC: Intel: hdac_hdmi: add Icelake support"

	Signed-off-by: Jaroslav Kysela <perex@perex.cz>
	Cc: Bard liao <bard.liao@intel.com>
	Cc: Pierre-Louis Bossart <pierre-louis.bossart@linux.intel.com>
	Signed-off-by: Takashi Iwai <tiwai@suse.de>
(cherry picked from commit b0d8bc50b9f221e3af76afe0473f7c171cebbb40)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	sound/pci/hda/patch_hdmi.c
diff --cc sound/pci/hda/patch_hdmi.c
index 4648c40d4484,8b3ac690efa3..000000000000
--- a/sound/pci/hda/patch_hdmi.c
+++ b/sound/pci/hda/patch_hdmi.c
@@@ -181,9 -182,11 +182,11 @@@ struct hdmi_spec 
  
  	struct hdac_chmap chmap;
  	hda_nid_t vendor_nid;
+ 	const int *port_map;
+ 	int port_num;
  };
  
 -#ifdef CONFIG_SND_HDA_COMPONENT
 +#ifdef CONFIG_SND_HDA_I915
  static inline bool codec_has_acomp(struct hda_codec *codec)
  {
  	struct hdmi_spec *spec = codec->spec;
@@@ -2478,6 -2480,56 +2480,59 @@@ static void haswell_set_power_state(str
  	snd_hda_codec_set_power_to_all(codec, fg, power_state);
  }
  
++<<<<<<< HEAD
++=======
+ /* There is a fixed mapping between audio pin node and display port.
+  * on SNB, IVY, HSW, BSW, SKL, BXT, KBL:
+  * Pin Widget 5 - PORT B (port = 1 in i915 driver)
+  * Pin Widget 6 - PORT C (port = 2 in i915 driver)
+  * Pin Widget 7 - PORT D (port = 3 in i915 driver)
+  *
+  * on VLV, ILK:
+  * Pin Widget 4 - PORT B (port = 1 in i915 driver)
+  * Pin Widget 5 - PORT C (port = 2 in i915 driver)
+  * Pin Widget 6 - PORT D (port = 3 in i915 driver)
+  */
+ static int intel_base_nid(struct hda_codec *codec)
+ {
+ 	switch (codec->core.vendor_id) {
+ 	case 0x80860054: /* ILK */
+ 	case 0x80862804: /* ILK */
+ 	case 0x80862882: /* VLV */
+ 		return 4;
+ 	default:
+ 		return 5;
+ 	}
+ }
+ 
+ static int intel_pin2port(void *audio_ptr, int pin_nid)
+ {
+ 	struct hda_codec *codec = audio_ptr;
+ 	struct hdmi_spec *spec = codec->spec;
+ 	int base_nid, i;
+ 
+ 	if (!spec->port_num) {
+ 		base_nid = intel_base_nid(codec);
+ 		if (WARN_ON(pin_nid < base_nid || pin_nid >= base_nid + 3))
+ 			return -1;
+ 		return pin_nid - base_nid + 1; /* intel port is 1-based */
+ 	}
+ 
+ 	/*
+ 	 * looking for the pin number in the mapping table and return
+ 	 * the index which indicate the port number
+ 	 */
+ 	for (i = 0; i < spec->port_num; i++) {
+ 		if (pin_nid == spec->port_map[i])
+ 			return i + 1;
+ 	}
+ 
+ 	/* return -1 if pin number exceeds our expectation */
+ 	codec_info(codec, "Can't find the HDMI/DP port for pin %d\n", pin_nid);
+ 	return -1;
+ }
+ 
++>>>>>>> b0d8bc50b9f2 (ALSA: hda: hdmi - add Icelake support)
  static void intel_pin_eld_notify(void *audio_ptr, int port, int pipe)
  {
  	struct hda_codec *codec = audio_ptr;
* Unmerged path sound/pci/hda/patch_hdmi.c
