perf symbols: kallsyms__delta() needs the kmap, not the map

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1062.el7
commit-author Arnaldo Carvalho de Melo <acme@redhat.com>
commit 019c6820d540d67608018238d91e57447ca7060f
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1062.el7/019c6820.failed

It was only using the map to obtain its kmap, so do the validation in
its called, __dso__load_kallsyms() and pass the kmap, that will be used
in the following patches in similar simplifications.

	Cc: Adrian Hunter <adrian.hunter@intel.com>
	Cc: David Ahern <dsahern@gmail.com>
	Cc: Jiri Olsa <jolsa@kernel.org>
	Cc: Namhyung Kim <namhyung@kernel.org>
	Cc: Wang Nan <wangnan0@huawei.com>
Link: https://lkml.kernel.org/n/tip-u6p9hbonlqzpl6o1z9xzxd75@git.kernel.org
	Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>
(cherry picked from commit 019c6820d540d67608018238d91e57447ca7060f)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	tools/perf/util/symbol.c
diff --cc tools/perf/util/symbol.c
index a88541280bf8,76de63cecf98..000000000000
--- a/tools/perf/util/symbol.c
+++ b/tools/perf/util/symbol.c
@@@ -1330,14 -1290,17 +1327,21 @@@ int __dso__load_kallsyms(struct dso *ds
  	if (symbol__restricted_filename(filename, "/proc/kallsyms"))
  		return -1;
  
++<<<<<<< HEAD
 +	if (dso__load_all_kallsyms(dso, filename, map) < 0)
++=======
+ 	if (!kmap || !kmap->kmaps)
+ 		return -1;
+ 
+ 	if (dso__load_all_kallsyms(dso, filename) < 0)
++>>>>>>> 019c6820d540 (perf symbols: kallsyms__delta() needs the kmap, not the map)
  		return -1;
  
- 	if (kallsyms__delta(map, filename, &delta))
+ 	if (kallsyms__delta(kmap, filename, &delta))
  		return -1;
  
 -	symbols__fixup_end(&dso->symbols);
 -	symbols__fixup_duplicate(&dso->symbols);
 +	symbols__fixup_end(&dso->symbols[map->type]);
 +	symbols__fixup_duplicate(&dso->symbols[map->type]);
  
  	if (dso->kernel == DSO_TYPE_GUEST_KERNEL)
  		dso->symtab_type = DSO_BINARY_TYPE__GUEST_KALLSYMS;
* Unmerged path tools/perf/util/symbol.c
