scsi: core: introduce force_blk_mq

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1062.el7
Rebuild_CHGLOG: - [scsi] core: introduce force_blk_mq (Ewan Milne) [1659146]
Rebuild_FUZZ: 90.32%
commit-author Ming Lei <ming.lei@redhat.com>
commit 2f31115e940c4afd49b99c33123534e2ac924ffb
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1062.el7/2f31115e.failed

This patch introduces 'force_blk_mq' to the scsi_host_template so that
drivers that have no desire to support the legacy I/O path can signal
blk-mq only support.

[mkp: commit desc]

	Cc: Omar Sandoval <osandov@fb.com>,
	Cc: "Martin K. Petersen" <martin.petersen@oracle.com>,
	Cc: James Bottomley <james.bottomley@hansenpartnership.com>,
	Cc: Christoph Hellwig <hch@lst.de>,
	Cc: Don Brace <don.brace@microsemi.com>
	Cc: Kashyap Desai <kashyap.desai@broadcom.com>
	Cc: Mike Snitzer <snitzer@redhat.com>
	Cc: Laurence Oberman <loberman@redhat.com>
	Signed-off-by: Ming Lei <ming.lei@redhat.com>
	Reviewed-by: Hannes Reinecke <hare@suse.de>
	Reviewed-by: Christoph Hellwig <hch@lst.de>
	Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
(cherry picked from commit 2f31115e940c4afd49b99c33123534e2ac924ffb)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/scsi/hosts.c
diff --cc drivers/scsi/hosts.c
index b8568a2c697d,ef22b275d050..000000000000
--- a/drivers/scsi/hosts.c
+++ b/drivers/scsi/hosts.c
@@@ -479,7 -473,8 +479,12 @@@ struct Scsi_Host *scsi_host_alloc(struc
  	else
  		shost->dma_boundary = 0xffffffff;
  
++<<<<<<< HEAD
 +	shost->use_blk_mq = scsi_use_blk_mq && !shost->hostt->disable_blk_mq;
++=======
+ 	shost->use_blk_mq = scsi_use_blk_mq;
+ 	shost->use_blk_mq = scsi_use_blk_mq || shost->hostt->force_blk_mq;
++>>>>>>> 2f31115e940c (scsi: core: introduce force_blk_mq)
  
  	device_initialize(&shost->shost_gendev);
  	dev_set_name(&shost->shost_gendev, "host%d", shost->host_no);
* Unmerged path drivers/scsi/hosts.c
diff --git a/include/scsi/scsi_host.h b/include/scsi/scsi_host.h
index 5dd325330a2a..e0b024e544d6 100644
--- a/include/scsi/scsi_host.h
+++ b/include/scsi/scsi_host.h
@@ -484,6 +484,9 @@ struct scsi_host_template {
 	/* True if the controller does not support WRITE SAME */
 	unsigned no_write_same:1;
 
+	/* True if the low-level driver supports blk-mq only */
+	unsigned force_blk_mq:1;
+
 	/*
 	 * True if asynchronous aborts are not supported
 	 */
