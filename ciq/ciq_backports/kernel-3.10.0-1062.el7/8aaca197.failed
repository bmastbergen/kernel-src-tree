net/mlx5: Allow co-enablement of uplink LAG and SRIOV

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1062.el7
Rebuild_CHGLOG: - [netdrv] mlx5: Allow co-enablement of uplink LAG and SRIOV (Alaa Hleihel) [1642355 1642498]
Rebuild_FUZZ: 96.08%
commit-author Rabie Loulou <rabiel@mellanox.com>
commit 8aaca1976e2757e15edf43866a0549b321a4222f
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1062.el7/8aaca197.failed

Enable setting uplink LAG if sriov is enabled on both ports in switchdev
mode.

Once the sriov mode is changed from switchdev for any of the ports, the
LAG instance is disabled.

	Signed-off-by: Rabie Loulou <rabiel@mellanox.com>
	Signed-off-by: Aviv Heller <avivh@mellanox.com>
	Signed-off-by: Jianbo Liu <jianbol@mellanox.com>
	Signed-off-by: Saeed Mahameed <saeedm@mellanox.com>
(cherry picked from commit 8aaca1976e2757e15edf43866a0549b321a4222f)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/mellanox/mlx5/core/eswitch.c
diff --cc drivers/net/ethernet/mellanox/mlx5/core/eswitch.c
index 8798f4084ee6,ef2bec50423d..000000000000
--- a/drivers/net/ethernet/mellanox/mlx5/core/eswitch.c
+++ b/drivers/net/ethernet/mellanox/mlx5/core/eswitch.c
@@@ -2220,3 -2229,14 +2220,17 @@@ u8 mlx5_eswitch_mode(struct mlx5_eswitc
  	return ESW_ALLOWED(esw) ? esw->mode : SRIOV_NONE;
  }
  EXPORT_SYMBOL_GPL(mlx5_eswitch_mode);
++<<<<<<< HEAD
++=======
+ 
+ bool mlx5_esw_lag_prereq(struct mlx5_core_dev *dev0, struct mlx5_core_dev *dev1)
+ {
+ 	if ((dev0->priv.eswitch->mode == SRIOV_NONE &&
+ 	     dev1->priv.eswitch->mode == SRIOV_NONE) ||
+ 	    (dev0->priv.eswitch->mode == SRIOV_OFFLOADS &&
+ 	     dev1->priv.eswitch->mode == SRIOV_OFFLOADS))
+ 		return true;
+ 
+ 	return false;
+ }
++>>>>>>> 8aaca1976e27 (net/mlx5: Allow co-enablement of uplink LAG and SRIOV)
* Unmerged path drivers/net/ethernet/mellanox/mlx5/core/eswitch.c
