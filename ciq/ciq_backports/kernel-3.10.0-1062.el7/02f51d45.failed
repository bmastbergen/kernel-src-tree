autofs: fix slab out of bounds read in getname_kernel()

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1062.el7
commit-author Tomas Bortoli <tomasbortoli@gmail.com>
commit 02f51d45937f7bc7f4dee21e9f85b2d5eac37104
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1062.el7/02f51d45.failed

The autofs subsystem does not check that the "path" parameter is present
for all cases where it is required when it is passed in via the "param"
struct.

In particular it isn't checked for the AUTOFS_DEV_IOCTL_OPENMOUNT_CMD
ioctl command.

To solve it, modify validate_dev_ioctl(function to check that a path has
been provided for ioctl commands that require it.

Link: http://lkml.kernel.org/r/153060031527.26631.18306637892746301555.stgit@pluto.themaw.net
	Signed-off-by: Tomas Bortoli <tomasbortoli@gmail.com>
	Signed-off-by: Ian Kent <raven@themaw.net>
	Reported-by: syzbot+60c837b428dc84e83a93@syzkaller.appspotmail.com
	Cc: Dmitry Vyukov <dvyukov@google.com>
	Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
	Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
(cherry picked from commit 02f51d45937f7bc7f4dee21e9f85b2d5eac37104)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	fs/autofs4/dev-ioctl.c
diff --cc fs/autofs4/dev-ioctl.c
index 64cab87d7825,86eafda4a652..000000000000
--- a/fs/autofs4/dev-ioctl.c
+++ b/fs/autofs4/dev-ioctl.c
@@@ -450,10 -443,7 +460,14 @@@ static int autofs_dev_ioctl_requester(s
  	dev_t devid;
  	int err = -ENOENT;
  
++<<<<<<< HEAD:fs/autofs4/dev-ioctl.c
 +	if (param->size <= sizeof(*param)) {
 +		err = -EINVAL;
 +		goto out;
 +	}
++=======
+ 	/* param->path has been checked in validate_dev_ioctl() */
++>>>>>>> 02f51d45937f (autofs: fix slab out of bounds read in getname_kernel()):fs/autofs/dev-ioctl.c
  
  	devid = sbi->sb->s_dev;
  
@@@ -538,10 -528,7 +552,14 @@@ static int autofs_dev_ioctl_ismountpoin
  	unsigned int devid, magic;
  	int err = -ENOENT;
  
++<<<<<<< HEAD:fs/autofs4/dev-ioctl.c
 +	if (param->size <= sizeof(*param)) {
 +		err = -EINVAL;
 +		goto out;
 +	}
++=======
+ 	/* param->path has been checked in validate_dev_ioctl() */
++>>>>>>> 02f51d45937f (autofs: fix slab out of bounds read in getname_kernel()):fs/autofs/dev-ioctl.c
  
  	name = param->path;
  	type = param->ismountpoint.in.type;
* Unmerged path fs/autofs4/dev-ioctl.c
