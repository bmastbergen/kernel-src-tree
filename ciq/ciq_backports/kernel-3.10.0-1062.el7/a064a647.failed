scsi: mpt3sas: Refactor mpt3sas_wait_for_ioc function

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1062.el7
Rebuild_CHGLOG: - [scsi] mpt3sas: Refactor mpt3sas_wait_for_ioc function (Tomas Henzl) [1642370]
Rebuild_FUZZ: 94.00%
commit-author Suganath Prabu <suganath-prabu.subramani@broadcom.com>
commit a064a6470be32981470c05082d1119da320e1d7e
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1062.el7/a064a647.failed

No functional change. Doing code refactor of function
mpt3sas_wait_for_ioc() for better readability.

	Signed-off-by: Suganath Prabu <suganath-prabu.subramani@broadcom.com>
	Reviewed-by: Bjorn Helgaas <bhelgaas@google.com>
	Reviewed-by: Andy Shevchenko <andy.shevchenko@gmail.com>
	Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
(cherry picked from commit a064a6470be32981470c05082d1119da320e1d7e)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/scsi/mpt3sas/mpt3sas_base.c
diff --cc drivers/scsi/mpt3sas/mpt3sas_base.c
index 909e8d966528,f25bc3c4f5ac..000000000000
--- a/drivers/scsi/mpt3sas/mpt3sas_base.c
+++ b/drivers/scsi/mpt3sas/mpt3sas_base.c
@@@ -4234,6 -5078,39 +4234,42 @@@ _base_send_ioc_reset(struct MPT3SAS_ADA
  }
  
  /**
++<<<<<<< HEAD
++=======
+  * mpt3sas_wait_for_ioc - IOC's operational state is checked here.
+  * @ioc: per adapter object
+  * @wait_count: timeout in seconds
+  *
+  * Return: Waits up to timeout seconds for the IOC to
+  * become operational. Returns 0 if IOC is present
+  * and operational; otherwise returns -EFAULT.
+  */
+ 
+ int
+ mpt3sas_wait_for_ioc(struct MPT3SAS_ADAPTER *ioc, int timeout)
+ {
+ 	int wait_state_count = 0;
+ 	u32 ioc_state;
+ 
+ 	do {
+ 		ioc_state = mpt3sas_base_get_iocstate(ioc, 1);
+ 		if (ioc_state == MPI2_IOC_STATE_OPERATIONAL)
+ 			break;
+ 		ssleep(1);
+ 		ioc_info(ioc, "%s: waiting for operational state(count=%d)\n",
+ 				__func__, ++wait_state_count);
+ 	} while (--timeout);
+ 	if (!timeout) {
+ 		ioc_err(ioc, "%s: failed due to ioc not operational\n", __func__);
+ 		return -EFAULT;
+ 	}
+ 	if (wait_state_count)
+ 		ioc_info(ioc, "ioc is operational\n");
+ 	return 0;
+ }
+ 
+ /**
++>>>>>>> a064a6470be3 (scsi: mpt3sas: Refactor mpt3sas_wait_for_ioc function)
   * _base_handshake_req_reply_wait - send request thru doorbell interface
   * @ioc: per adapter object
   * @request_bytes: request length
* Unmerged path drivers/scsi/mpt3sas/mpt3sas_base.c
