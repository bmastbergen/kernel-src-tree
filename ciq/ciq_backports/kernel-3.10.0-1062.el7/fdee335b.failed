perf stat: Move 'no_merge' data to 'struct perf_stat_config'

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1062.el7
commit-author Jiri Olsa <jolsa@kernel.org>
commit fdee335b00b0807e8d65b8e3d81214556f07bed3
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1062.el7/fdee335b.failed

Move the static variable 'no_merge' to 'struct perf_stat_config', so
that it can be passed around and used outside 'perf stat' command.

	Signed-off-by: Jiri Olsa <jolsa@kernel.org>
	Cc: Alexander Shishkin <alexander.shishkin@linux.intel.com>
	Cc: Andi Kleen <andi@firstfloor.org>
	Cc: David Ahern <dsahern@gmail.com>
	Cc: Namhyung Kim <namhyung@kernel.org>
	Cc: Peter Zijlstra <peterz@infradead.org>
Link: http://lkml.kernel.org/r/20180830063252.23729-40-jolsa@kernel.org
	Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>
(cherry picked from commit fdee335b00b0807e8d65b8e3d81214556f07bed3)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	tools/perf/builtin-stat.c
#	tools/perf/util/stat.h
diff --cc tools/perf/builtin-stat.c
index 13693124ed08,c4df076f1e54..000000000000
--- a/tools/perf/builtin-stat.c
+++ b/tools/perf/builtin-stat.c
@@@ -163,26 -156,15 +163,25 @@@ static bool			group				= false
  static const char		*pre_cmd			= NULL;
  static const char		*post_cmd			= NULL;
  static bool			sync_run			= false;
 +static unsigned int		unit_width			= 4; /* strlen("unit") */
  static bool			forever				= false;
 +static bool			metric_only			= false;
  static bool			force_metric_only		= false;
- static bool			no_merge			= false;
  static bool			walltime_run_table		= false;
  static struct timespec		ref_time;
 +static struct cpu_map		*aggr_map;
 +static aggr_get_id_t		aggr_get_id;
  static bool			append_file;
  static bool			interval_count;
 +static bool			interval_clear;
  static const char		*output_name;
  static int			output_fd;
 +static int			print_free_counters_hint;
 +static int			print_mixed_hw_group_error;
  static u64			*walltime_run;
 +static bool			ru_display			= false;
 +static struct rusage		ru_data;
 +static unsigned int		metric_only_len			= METRIC_ONLY_LEN;
  
  struct perf_stat {
  	bool			 record;
@@@ -1303,11 -1171,11 +1302,16 @@@ static bool collect_data(struct perf_ev
  {
  	if (counter->merged_stat)
  		return false;
++<<<<<<< HEAD
 +	cb(counter, data, true);
 +	if (no_merge)
++=======
+ 	cb(config, counter, data, true);
+ 	if (config->no_merge)
++>>>>>>> fdee335b00b0 (perf stat: Move 'no_merge' data to 'struct perf_stat_config')
  		uniquify_event_name(counter);
  	else if (counter->auto_merge_stats)
 -		collect_all_aliases(config, counter, cb, data);
 +		collect_all_aliases(counter, cb, data);
  	return true;
  }
  
@@@ -1945,8 -1901,8 +1949,13 @@@ static const struct option stat_options
  		    "list of cpus to monitor in system-wide"),
  	OPT_SET_UINT('A', "no-aggr", &stat_config.aggr_mode,
  		    "disable CPU count aggregation", AGGR_NONE),
++<<<<<<< HEAD
 +	OPT_BOOLEAN(0, "no-merge", &no_merge, "Do not merge identical named events"),
 +	OPT_STRING('x', "field-separator", &csv_sep, "separator",
++=======
+ 	OPT_BOOLEAN(0, "no-merge", &stat_config.no_merge, "Do not merge identical named events"),
+ 	OPT_STRING('x', "field-separator", &stat_config.csv_sep, "separator",
++>>>>>>> fdee335b00b0 (perf stat: Move 'no_merge' data to 'struct perf_stat_config')
  		   "print counts with custom separator"),
  	OPT_CALLBACK('G', "cgroup", &evsel_list, "name",
  		     "monitor event in cgroup name only", parse_cgroups),
diff --cc tools/perf/util/stat.h
index 4b88aef959fb,0758107fe56f..000000000000
--- a/tools/perf/util/stat.h
+++ b/tools/perf/util/stat.h
@@@ -89,6 -98,13 +89,16 @@@ struct perf_stat_config 
  	bool			 scale;
  	bool			 no_inherit;
  	bool			 identifier;
++<<<<<<< HEAD
++=======
+ 	bool			 csv_output;
+ 	bool			 interval_clear;
+ 	bool			 metric_only;
+ 	bool			 null_run;
+ 	bool			 ru_display;
+ 	bool			 big_num;
+ 	bool			 no_merge;
++>>>>>>> fdee335b00b0 (perf stat: Move 'no_merge' data to 'struct perf_stat_config')
  	FILE			*output;
  	unsigned int		 interval;
  	unsigned int		 timeout;
* Unmerged path tools/perf/builtin-stat.c
* Unmerged path tools/perf/util/stat.h
