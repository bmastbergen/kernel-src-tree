IB/uverbs: Replace ib_ucq_object uverbs_file with the one in ib_uobject

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1062.el7
commit-author Jason Gunthorpe <jgg@mellanox.com>
commit 76bc79ccceea09a19f681dff7fd633fb8fb95c79
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1062.el7/76bc79cc.failed

Now that ib_uobject has a ib_uverbs_file we don't need this extra one in
ib_ucq_object.

	Signed-off-by: Jason Gunthorpe <jgg@mellanox.com>
(cherry picked from commit 76bc79ccceea09a19f681dff7fd633fb8fb95c79)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/infiniband/core/uverbs_std_types_cq.c
diff --cc drivers/infiniband/core/uverbs_std_types_cq.c
index b0dbae9dd0d7,ce9c9c66bae4..000000000000
--- a/drivers/infiniband/core/uverbs_std_types_cq.c
+++ b/drivers/infiniband/core/uverbs_std_types_cq.c
@@@ -102,10 -102,9 +102,13 @@@ static int UVERBS_HANDLER(UVERBS_METHOD
  		goto err_event_file;
  	}
  
 -	obj = container_of(uverbs_attr_get_uobject(attrs,
 -						   UVERBS_ATTR_CREATE_CQ_HANDLE),
 +	obj = container_of(uverbs_attr_get(attrs,
 +					   UVERBS_ATTR_CREATE_CQ_HANDLE)->obj_attr.uobject,
  			   typeof(*obj), uobject);
++<<<<<<< HEAD
 +	obj->uverbs_file	   = ucontext->ufile;
++=======
++>>>>>>> 76bc79ccceea (IB/uverbs: Replace ib_ucq_object uverbs_file with the one in ib_uobject)
  	obj->comp_events_reported  = 0;
  	obj->async_events_reported = 0;
  	INIT_LIST_HEAD(&obj->comp_list);
diff --git a/drivers/infiniband/core/uverbs.h b/drivers/infiniband/core/uverbs.h
index cbf36c75d546..eb84b9798f60 100644
--- a/drivers/infiniband/core/uverbs.h
+++ b/drivers/infiniband/core/uverbs.h
@@ -196,7 +196,6 @@ struct ib_uwq_object {
 
 struct ib_ucq_object {
 	struct ib_uobject	uobject;
-	struct ib_uverbs_file  *uverbs_file;
 	struct list_head	comp_list;
 	struct list_head	async_list;
 	u32			comp_events_reported;
diff --git a/drivers/infiniband/core/uverbs_cmd.c b/drivers/infiniband/core/uverbs_cmd.c
index bb6b556a3d12..e5fe7b80f1a3 100644
--- a/drivers/infiniband/core/uverbs_cmd.c
+++ b/drivers/infiniband/core/uverbs_cmd.c
@@ -966,7 +966,6 @@ static struct ib_ucq_object *create_cq(struct ib_uverbs_file *file,
 	}
 
 	obj->uobject.user_handle = cmd->user_handle;
-	obj->uverbs_file	   = file;
 	obj->comp_events_reported  = 0;
 	obj->async_events_reported = 0;
 	INIT_LIST_HEAD(&obj->comp_list);
diff --git a/drivers/infiniband/core/uverbs_main.c b/drivers/infiniband/core/uverbs_main.c
index 9b53f7b4a4a8..262ac695813c 100644
--- a/drivers/infiniband/core/uverbs_main.c
+++ b/drivers/infiniband/core/uverbs_main.c
@@ -531,7 +531,7 @@ void ib_uverbs_cq_event_handler(struct ib_event *event, void *context_ptr)
 	struct ib_ucq_object *uobj = container_of(event->element.cq->uobject,
 						  struct ib_ucq_object, uobject);
 
-	ib_uverbs_async_handler(uobj->uverbs_file, uobj->uobject.user_handle,
+	ib_uverbs_async_handler(uobj->uobject.ufile, uobj->uobject.user_handle,
 				event->event, &uobj->async_list,
 				&uobj->async_events_reported);
 }
* Unmerged path drivers/infiniband/core/uverbs_std_types_cq.c
