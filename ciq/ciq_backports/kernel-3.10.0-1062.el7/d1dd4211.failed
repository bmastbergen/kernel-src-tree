ALSA: hda/realtek - Disable headset Mic VREF for headset mode of ALC225

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1062.el7
commit-author Kailang Yang <kailang@realtek.com>
commit d1dd42110d2727e81b9265841a62bc84c454c3a2
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1062.el7/d1dd4211.failed

Disable Headset Mic VREF for headset mode of ALC225.
This will be controlled by coef bits of headset mode functions.

[ Fixed a compile warning and code simplification -- tiwai ]

	Signed-off-by: Kailang Yang <kailang@realtek.com>
	Cc: <stable@vger.kernel.org>
	Signed-off-by: Takashi Iwai <tiwai@suse.de>
(cherry picked from commit d1dd42110d2727e81b9265841a62bc84c454c3a2)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	sound/pci/hda/patch_realtek.c
diff --cc sound/pci/hda/patch_realtek.c
index 63da85302ac7,0b3e7a18ca78..000000000000
--- a/sound/pci/hda/patch_realtek.c
+++ b/sound/pci/hda/patch_realtek.c
@@@ -5347,6 -5381,73 +5347,76 @@@ static void alc285_fixup_invalidate_dac
  	snd_hda_override_wcaps(codec, 0x03, 0);
  }
  
++<<<<<<< HEAD
++=======
+ static const struct hda_jack_keymap alc_headset_btn_keymap[] = {
+ 	{ SND_JACK_BTN_0, KEY_PLAYPAUSE },
+ 	{ SND_JACK_BTN_1, KEY_VOICECOMMAND },
+ 	{ SND_JACK_BTN_2, KEY_VOLUMEUP },
+ 	{ SND_JACK_BTN_3, KEY_VOLUMEDOWN },
+ 	{}
+ };
+ 
+ static void alc_headset_btn_callback(struct hda_codec *codec,
+ 				     struct hda_jack_callback *jack)
+ {
+ 	int report = 0;
+ 
+ 	if (jack->unsol_res & (7 << 13))
+ 		report |= SND_JACK_BTN_0;
+ 
+ 	if (jack->unsol_res  & (1 << 16 | 3 << 8))
+ 		report |= SND_JACK_BTN_1;
+ 
+ 	/* Volume up key */
+ 	if (jack->unsol_res & (7 << 23))
+ 		report |= SND_JACK_BTN_2;
+ 
+ 	/* Volume down key */
+ 	if (jack->unsol_res & (7 << 10))
+ 		report |= SND_JACK_BTN_3;
+ 
+ 	jack->jack->button_state = report;
+ }
+ 
+ static void alc_fixup_headset_jack(struct hda_codec *codec,
+ 				    const struct hda_fixup *fix, int action)
+ {
+ 
+ 	switch (action) {
+ 	case HDA_FIXUP_ACT_PRE_PROBE:
+ 		snd_hda_jack_detect_enable_callback(codec, 0x55,
+ 						    alc_headset_btn_callback);
+ 		snd_hda_jack_add_kctl(codec, 0x55, "Headset Jack", false,
+ 				      SND_JACK_HEADSET, alc_headset_btn_keymap);
+ 		break;
+ 	case HDA_FIXUP_ACT_INIT:
+ 		switch (codec->core.vendor_id) {
+ 		case 0x10ec0225:
+ 		case 0x10ec0295:
+ 		case 0x10ec0299:
+ 			alc_write_coef_idx(codec, 0x48, 0xd011);
+ 			alc_update_coef_idx(codec, 0x49, 0x007f, 0x0045);
+ 			alc_update_coef_idx(codec, 0x44, 0x007f << 8, 0x0045 << 8);
+ 			break;
+ 		case 0x10ec0236:
+ 		case 0x10ec0256:
+ 			alc_write_coef_idx(codec, 0x48, 0xd011);
+ 			alc_update_coef_idx(codec, 0x49, 0x007f, 0x0045);
+ 			break;
+ 		}
+ 		break;
+ 	}
+ }
+ 
+ static void alc_fixup_disable_mic_vref(struct hda_codec *codec,
+ 				  const struct hda_fixup *fix, int action)
+ {
+ 	if (action == HDA_FIXUP_ACT_PRE_PROBE)
+ 		snd_hda_codec_set_pin_target(codec, 0x19, PIN_VREFHIZ);
+ }
+ 
++>>>>>>> d1dd42110d27 (ALSA: hda/realtek - Disable headset Mic VREF for headset mode of ALC225)
  /* for hda_fixup_thinkpad_acpi() */
  #include "thinkpad_helper.c"
  
* Unmerged path sound/pci/hda/patch_realtek.c
