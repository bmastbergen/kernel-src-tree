ALSA: rawmidi: Simplify error paths

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1062.el7
commit-author Takashi Iwai <tiwai@suse.de>
commit 7fdc9b08071b6a3fc85bf90b79e13f6e973a7e5e
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1062.el7/7fdc9b08.failed

Apply the standard idiom: rewrite the multiple unlocks in error paths
in the goto-error-and-single-unlock way.

Just a code refactoring, and no functional changes.

	Signed-off-by: Takashi Iwai <tiwai@suse.de>
(cherry picked from commit 7fdc9b08071b6a3fc85bf90b79e13f6e973a7e5e)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	sound/core/rawmidi.c
diff --cc sound/core/rawmidi.c
index edf6ff52bbea,6b24c2d2dae6..000000000000
--- a/sound/core/rawmidi.c
+++ b/sound/core/rawmidi.c
@@@ -330,10 -335,10 +330,10 @@@ static int rawmidi_open_priv(struct snd
  
  /* called from sound/core/seq/seq_midi.c */
  int snd_rawmidi_kernel_open(struct snd_card *card, int device, int subdevice,
 -			    int mode, struct snd_rawmidi_file *rfile)
 +			    int mode, struct snd_rawmidi_file * rfile)
  {
  	struct snd_rawmidi *rmidi;
- 	int err;
+ 	int err = 0;
  
  	if (snd_BUG_ON(!rfile))
  		return -EINVAL;
@@@ -1566,24 -1575,22 +1564,43 @@@ int snd_rawmidi_new(struct snd_card *ca
  	rmidi->dev.release = release_rawmidi_device;
  	dev_set_name(&rmidi->dev, "midiC%iD%i", card->number, device);
  
++<<<<<<< HEAD
 +	if ((err = snd_rawmidi_alloc_substreams(rmidi,
 +						&rmidi->streams[SNDRV_RAWMIDI_STREAM_INPUT],
 +						SNDRV_RAWMIDI_STREAM_INPUT,
 +						input_count)) < 0) {
 +		snd_rawmidi_free(rmidi);
 +		return err;
 +	}
 +	if ((err = snd_rawmidi_alloc_substreams(rmidi,
 +						&rmidi->streams[SNDRV_RAWMIDI_STREAM_OUTPUT],
 +						SNDRV_RAWMIDI_STREAM_OUTPUT,
 +						output_count)) < 0) {
 +		snd_rawmidi_free(rmidi);
 +		return err;
 +	}
 +	if ((err = snd_device_new(card, SNDRV_DEV_RAWMIDI, rmidi, &ops)) < 0) {
 +		snd_rawmidi_free(rmidi);
 +		return err;
 +	}
++=======
+ 	err = snd_rawmidi_alloc_substreams(rmidi,
+ 					   &rmidi->streams[SNDRV_RAWMIDI_STREAM_INPUT],
+ 					   SNDRV_RAWMIDI_STREAM_INPUT,
+ 					   input_count);
+ 	if (err < 0)
+ 		goto error;
+ 	err = snd_rawmidi_alloc_substreams(rmidi,
+ 					   &rmidi->streams[SNDRV_RAWMIDI_STREAM_OUTPUT],
+ 					   SNDRV_RAWMIDI_STREAM_OUTPUT,
+ 					   output_count);
+ 	if (err < 0)
+ 		goto error;
+ 	err = snd_device_new(card, SNDRV_DEV_RAWMIDI, rmidi, &ops);
+ 	if (err < 0)
+ 		goto error;
+ 
++>>>>>>> 7fdc9b08071b (ALSA: rawmidi: Simplify error paths)
  	if (rrawmidi)
  		*rrawmidi = rmidi;
  	return 0;
* Unmerged path sound/core/rawmidi.c
