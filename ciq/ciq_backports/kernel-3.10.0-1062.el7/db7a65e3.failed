ip6_tunnel: better validate user provided tunnel names

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1062.el7
commit-author Eric Dumazet <edumazet@google.com>
commit db7a65e3ab78e5b1c4b17c0870ebee35a4ee3257
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1062.el7/db7a65e3.failed

Use valid_name() to make sure user does not provide illegal
device name.

Fixes: 1da177e4c3f4 ("Linux-2.6.12-rc2")
	Signed-off-by: Eric Dumazet <edumazet@google.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit db7a65e3ab78e5b1c4b17c0870ebee35a4ee3257)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/ipv6/ip6_tunnel.c
diff --cc net/ipv6/ip6_tunnel.c
index bcfc9acb8320,da66aaac51ce..000000000000
--- a/net/ipv6/ip6_tunnel.c
+++ b/net/ipv6/ip6_tunnel.c
@@@ -286,15 -297,19 +286,25 @@@ static struct ip6_tnl *ip6_tnl_create(s
  	struct net_device *dev;
  	struct ip6_tnl *t;
  	char name[IFNAMSIZ];
- 	int err = -ENOMEM;
+ 	int err = -E2BIG;
  
- 	if (p->name[0])
+ 	if (p->name[0]) {
+ 		if (!dev_valid_name(p->name))
+ 			goto failed;
  		strlcpy(name, p->name, IFNAMSIZ);
- 	else
+ 	} else {
  		sprintf(name, "ip6tnl%%d");
++<<<<<<< HEAD
 +
 +	dev = alloc_netdev(sizeof (*t), name, ip6_tnl_dev_setup);
 +	if (dev == NULL)
++=======
+ 	}
+ 	err = -ENOMEM;
+ 	dev = alloc_netdev(sizeof(*t), name, NET_NAME_UNKNOWN,
+ 			   ip6_tnl_dev_setup);
+ 	if (!dev)
++>>>>>>> db7a65e3ab78 (ip6_tunnel: better validate user provided tunnel names)
  		goto failed;
  
  	dev_net_set(dev, net);
* Unmerged path net/ipv6/ip6_tunnel.c
