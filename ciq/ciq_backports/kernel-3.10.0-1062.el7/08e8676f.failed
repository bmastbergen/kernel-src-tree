IB/mlx5: Add support for 50Gbps per lane link modes

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1062.el7
commit-author Aya Levin <ayal@mellanox.com>
commit 08e8676f1607925adf36e399f0faa8ce3b10bb86
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1062.el7/08e8676f.failed

Driver now supports new link modes: 50Gbps per lane support for
50G/100G/200G. This patch reads the correct field (legacy vs. extended)
based on a FW indication bit, and adds a translation function (link
modes to IB width and speed) to the new link modes.

	Signed-off-by: Aya Levin <ayal@mellanox.com>
	Reviewed-by: Leon Romanovsky <leonro@mellanox.com>
	Signed-off-by: Saeed Mahameed <saeedm@mellanox.com>
(cherry picked from commit 08e8676f1607925adf36e399f0faa8ce3b10bb86)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/infiniband/hw/mlx5/main.c
diff --cc drivers/infiniband/hw/mlx5/main.c
index db7406c6b74d,581ae11e2fc9..000000000000
--- a/drivers/infiniband/hw/mlx5/main.c
+++ b/drivers/infiniband/hw/mlx5/main.c
@@@ -398,19 -473,21 +454,24 @@@ static int mlx5_query_port_roce(struct 
  	/* Possible bad flows are checked before filling out props so in case
  	 * of an error it will still be zeroed out.
  	 */
 -	err = mlx5_query_port_ptys(mdev, out, sizeof(out), MLX5_PTYS_EN,
 -				   mdev_port_num);
 +	err = mlx5_query_port_eth_proto_oper(mdev, &eth_prot_oper,
 +					     mdev_port_num);
  	if (err)
  		goto out;
++<<<<<<< HEAD
++=======
+ 	ext = MLX5_CAP_PCAM_FEATURE(dev->mdev, ptys_extended_ethernet);
+ 	eth_prot_oper = MLX5_GET_ETH_PROTO(ptys_reg, out, ext, eth_proto_oper);
++>>>>>>> 08e8676f1607 (IB/mlx5: Add support for 50Gbps per lane link modes)
  
  	props->active_width     = IB_WIDTH_4X;
  	props->active_speed     = IB_SPEED_QDR;
  
  	translate_eth_proto_oper(eth_prot_oper, &props->active_speed,
- 				 &props->active_width);
+ 				 &props->active_width, ext);
  
 -	props->port_cap_flags |= IB_PORT_CM_SUP;
 -	props->ip_gids = true;
 +	props->port_cap_flags  |= IB_PORT_CM_SUP;
 +	props->port_cap_flags  |= IB_PORT_IP_BASED_GIDS;
  
  	props->gid_tbl_len      = MLX5_CAP_ROCE(dev->mdev,
  						roce_address_table_size);
* Unmerged path drivers/infiniband/hw/mlx5/main.c
