IB: Enable uverbs_destroy_def_handler to be used by drivers

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1062.el7
commit-author Yishai Hadas <yishaih@mellanox.com>
commit 528922afd41cdd1da6a4b33e2c82e38c1746561c
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1062.el7/528922af.failed

Enable uverbs_destroy_def_handler to be used by drivers and replace
current code to use it.

	Signed-off-by: Yishai Hadas <yishaih@mellanox.com>
	Signed-off-by: Leon Romanovsky <leonro@mellanox.com>
	Signed-off-by: Jason Gunthorpe <jgg@mellanox.com>
(cherry picked from commit 528922afd41cdd1da6a4b33e2c82e38c1746561c)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/infiniband/core/uverbs_std_types.c
#	drivers/infiniband/hw/mlx5/devx.c
diff --cc drivers/infiniband/core/uverbs_std_types.c
index f83837ce24d4,718c8430d364..000000000000
--- a/drivers/infiniband/core/uverbs_std_types.c
+++ b/drivers/infiniband/core/uverbs_std_types.c
@@@ -203,17 -209,13 +203,27 @@@ static int uverbs_hot_unplug_completion
  	return 0;
  };
  
++<<<<<<< HEAD
 +/*
 + * This spec is used in order to pass information to the hardware driver in a
 + * legacy way. Every verb that could get driver specific data should get this
 + * spec.
 + */
 +const struct uverbs_attr_def uverbs_uhw_compat_in =
 +	UVERBS_ATTR_PTR_IN_SZ(UVERBS_ATTR_UHW_IN, UVERBS_ATTR_MIN_SIZE(0),
 +			      UA_FLAGS(UVERBS_ATTR_SPEC_F_MIN_SZ_OR_ZERO));
 +const struct uverbs_attr_def uverbs_uhw_compat_out =
 +	UVERBS_ATTR_PTR_OUT_SZ(UVERBS_ATTR_UHW_OUT, UVERBS_ATTR_MIN_SIZE(0),
 +			       UA_FLAGS(UVERBS_ATTR_SPEC_F_MIN_SZ_OR_ZERO));
++=======
+ int uverbs_destroy_def_handler(struct ib_device *ib_dev,
+ 			       struct ib_uverbs_file *file,
+ 			       struct uverbs_attr_bundle *attrs)
+ {
+ 	return 0;
+ }
+ EXPORT_SYMBOL(uverbs_destroy_def_handler);
++>>>>>>> 528922afd41c (IB: Enable uverbs_destroy_def_handler to be used by drivers)
  
  void create_udata(struct uverbs_attr_bundle *ctx, struct ib_udata *udata)
  {
* Unmerged path drivers/infiniband/hw/mlx5/devx.c
* Unmerged path drivers/infiniband/core/uverbs_std_types.c
* Unmerged path drivers/infiniband/hw/mlx5/devx.c
diff --git a/include/rdma/ib_verbs.h b/include/rdma/ib_verbs.h
index d90947756c9b..0e28f8d01bff 100644
--- a/include/rdma/ib_verbs.h
+++ b/include/rdma/ib_verbs.h
@@ -4051,4 +4051,7 @@ void rdma_roce_rescan_device(struct ib_device *ibdev);
 
 struct ib_ucontext *ib_uverbs_get_ucontext(struct ib_uverbs_file *ufile);
 
+int uverbs_destroy_def_handler(struct ib_device *ib_dev,
+			       struct ib_uverbs_file *file,
+			       struct uverbs_attr_bundle *attrs);
 #endif /* IB_VERBS_H */
