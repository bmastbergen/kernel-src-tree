net/mlx5e: TLS, build TLS netdev from capabilities

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1062.el7
Rebuild_CHGLOG: - [netdrv] mlx5e: TLS, build TLS netdev from capabilities (Alaa Hleihel) [1642498]
Rebuild_FUZZ: 95.83%
commit-author Boris Pismenny <borisp@mellanox.com>
commit 790af90c00d277b7fc8bd2ba18fcfa40941bf134
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1062.el7/790af90c.failed

This patch enables TLS Rx based on available HW capabilities.

	Signed-off-by: Boris Pismenny <borisp@mellanox.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 790af90c00d277b7fc8bd2ba18fcfa40941bf134)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/mellanox/mlx5/core/en_accel/tls.c
diff --cc drivers/net/ethernet/mellanox/mlx5/core/en_accel/tls.c
index 821afce60a87,eddd7702680b..000000000000
--- a/drivers/net/ethernet/mellanox/mlx5/core/en_accel/tls.c
+++ b/drivers/net/ethernet/mellanox/mlx5/core/en_accel/tls.c
@@@ -185,5 -189,42 +186,23 @@@ void mlx5e_tls_build_netdev(struct mlx5
  	if (!mlx5_accel_is_tls_device(priv->mdev))
  		return;
  
++<<<<<<< HEAD
++=======
+ 	if (caps & MLX5_ACCEL_TLS_TX) {
+ 		netdev->features          |= NETIF_F_HW_TLS_TX;
+ 		netdev->hw_features       |= NETIF_F_HW_TLS_TX;
+ 	}
+ 
+ 	if (caps & MLX5_ACCEL_TLS_RX) {
+ 		netdev->features          |= NETIF_F_HW_TLS_RX;
+ 		netdev->hw_features       |= NETIF_F_HW_TLS_RX;
+ 	}
+ 
+ 	if (!(caps & MLX5_ACCEL_TLS_LRO)) {
+ 		netdev->features          &= ~NETIF_F_LRO;
+ 		netdev->hw_features       &= ~NETIF_F_LRO;
+ 	}
+ 
++>>>>>>> 790af90c00d2 (net/mlx5e: TLS, build TLS netdev from capabilities)
  	netdev->tlsdev_ops = &mlx5e_tls_ops;
  }
 -
 -int mlx5e_tls_init(struct mlx5e_priv *priv)
 -{
 -	struct mlx5e_tls *tls = kzalloc(sizeof(*tls), GFP_KERNEL);
 -
 -	if (!tls)
 -		return -ENOMEM;
 -
 -	priv->tls = tls;
 -	return 0;
 -}
 -
 -void mlx5e_tls_cleanup(struct mlx5e_priv *priv)
 -{
 -	struct mlx5e_tls *tls = priv->tls;
 -
 -	if (!tls)
 -		return;
 -
 -	kfree(tls);
 -	priv->tls = NULL;
 -}
* Unmerged path drivers/net/ethernet/mellanox/mlx5/core/en_accel/tls.c
