net/mlx5e: Use the inner headers to determine tc/pedit offload limitation on decap flows

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1062.el7
Rebuild_CHGLOG: - [netdrv] mlx5e: Use the inner headers to determine tc/pedit offload limitation on decap flows (Alaa Hleihel) [1683975]
Rebuild_FUZZ: 97.67%
commit-author Guy Shattah <sguy@mellanox.com>
commit 1651925d403e077e3fc86f961905e27c6810e132
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1062.el7/1651925d.failed

In packets that need to be decaped the internal headers
have to be checked, not the external ones.

Fixes: bdd66ac0aeed ("net/mlx5e: Disallow TC offloading of unsupported match/action combinations")
	Signed-off-by: Guy Shattah <sguy@mellanox.com>
	Reviewed-by: Or Gerlitz <ogerlitz@mellanox.com>
	Signed-off-by: Saeed Mahameed <saeedm@mellanox.com>
(cherry picked from commit 1651925d403e077e3fc86f961905e27c6810e132)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/mellanox/mlx5/core/en_tc.c
diff --cc drivers/net/ethernet/mellanox/mlx5/core/en_tc.c
index fbb4f1b36627,1c3c9fa26b55..000000000000
--- a/drivers/net/ethernet/mellanox/mlx5/core/en_tc.c
+++ b/drivers/net/ethernet/mellanox/mlx5/core/en_tc.c
@@@ -1937,7 -2180,9 +1937,13 @@@ static bool csum_offload_supported(stru
  }
  
  static bool modify_header_match_supported(struct mlx5_flow_spec *spec,
++<<<<<<< HEAD
 +					  struct tcf_exts *exts)
++=======
+ 					  struct tcf_exts *exts,
+ 					  u32 actions,
+ 					  struct netlink_ext_ack *extack)
++>>>>>>> 1651925d403e (net/mlx5e: Use the inner headers to determine tc/pedit offload limitation on decap flows)
  {
  	const struct tc_action *a;
  	bool modify_ip_header;
@@@ -1999,7 -2251,8 +2009,12 @@@ static bool actions_match_supported(str
  		return false;
  
  	if (actions & MLX5_FLOW_CONTEXT_ACTION_MOD_HDR)
++<<<<<<< HEAD
 +		return modify_header_match_supported(&parse_attr->spec, exts);
++=======
+ 		return modify_header_match_supported(&parse_attr->spec, exts,
+ 						     actions, extack);
++>>>>>>> 1651925d403e (net/mlx5e: Use the inner headers to determine tc/pedit offload limitation on decap flows)
  
  	return true;
  }
* Unmerged path drivers/net/ethernet/mellanox/mlx5/core/en_tc.c
