netfilter: don't pull include/linux/netfilter.h from netns headers

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1062.el7
commit-author Pablo Neira Ayuso <pablo@netfilter.org>
commit a263653ed798216c0069922d7b5237ca49436007
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1062.el7/a263653e.failed

This pulls the full hook netfilter definitions from all those that include
net_namespace.h.

Instead let's just include the bare minimum required in the new
linux/netfilter_defs.h file, and use it from the netfilter netns header files.

I also needed to include in.h and in6.h from linux/netfilter.h otherwise we hit
this compilation error:

In file included from include/linux/netfilter_defs.h:4:0,
                 from include/net/netns/netfilter.h:4,
                 from include/net/net_namespace.h:22,
                 from include/linux/netdevice.h:43,
                 from net/netfilter/nfnetlink_queue_core.c:23:
include/uapi/linux/netfilter.h:76:17: error: field ‘in’ has incomplete type struct in_addr in;

And also explicit include linux/netfilter.h in several spots.

	Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
	Signed-off-by: Eric W. Biederman <ebiederm@xmission.com>
(cherry picked from commit a263653ed798216c0069922d7b5237ca49436007)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	include/linux/netfilter.h
#	include/net/netns/netfilter.h
#	net/ipv6/output_core.c
diff --cc include/linux/netfilter.h
index 8b4b3ccb3eb8,00050dfd9f23..000000000000
--- a/include/linux/netfilter.h
+++ b/include/linux/netfilter.h
@@@ -9,7 -9,9 +9,13 @@@
  #include <linux/in6.h>
  #include <linux/wait.h>
  #include <linux/list.h>
++<<<<<<< HEAD
 +#include <uapi/linux/netfilter.h>
++=======
+ #include <linux/static_key.h>
+ #include <linux/netfilter_defs.h>
+ 
++>>>>>>> a263653ed798 (netfilter: don't pull include/linux/netfilter.h from netns headers)
  #ifdef CONFIG_NETFILTER
  static inline int NF_DROP_GETERR(int verdict)
  {
diff --cc include/net/netns/netfilter.h
index 88740024ccf3,532e4ba64f49..000000000000
--- a/include/net/netns/netfilter.h
+++ b/include/net/netns/netfilter.h
@@@ -1,9 -1,9 +1,13 @@@
  #ifndef __NETNS_NETFILTER_H
  #define __NETNS_NETFILTER_H
  
++<<<<<<< HEAD
 +#include <linux/proc_fs.h>
 +#include <linux/netfilter.h>
++=======
+ #include <linux/netfilter_defs.h>
++>>>>>>> a263653ed798 (netfilter: don't pull include/linux/netfilter.h from netns headers)
  
 -struct proc_dir_entry;
  struct nf_logger;
  
  struct netns_nf {
diff --cc net/ipv6/output_core.c
index 2de247de6eb4,928a0fb0b744..000000000000
--- a/net/ipv6/output_core.c
+++ b/net/ipv6/output_core.c
@@@ -7,6 -7,8 +7,11 @@@
  #include <net/ipv6.h>
  #include <net/ip6_fib.h>
  #include <net/addrconf.h>
++<<<<<<< HEAD
++=======
+ #include <net/secure_seq.h>
+ #include <linux/netfilter.h>
++>>>>>>> a263653ed798 (netfilter: don't pull include/linux/netfilter.h from netns headers)
  
  static u32 __ipv6_select_ident(struct net *net, u32 hashrnd,
  			       const struct in6_addr *dst,
* Unmerged path include/linux/netfilter.h
diff --git a/include/linux/netfilter_defs.h b/include/linux/netfilter_defs.h
new file mode 100644
index 000000000000..d3a7f8597e82
--- /dev/null
+++ b/include/linux/netfilter_defs.h
@@ -0,0 +1,9 @@
+#ifndef __LINUX_NETFILTER_CORE_H_
+#define __LINUX_NETFILTER_CORE_H_
+
+#include <uapi/linux/netfilter.h>
+
+/* Largest hook number + 1, see uapi/linux/netfilter_decnet.h */
+#define NF_MAX_HOOKS 8
+
+#endif
* Unmerged path include/net/netns/netfilter.h
diff --git a/include/net/netns/x_tables.h b/include/net/netns/x_tables.h
index c24060ee411e..32a475d7c85d 100644
--- a/include/net/netns/x_tables.h
+++ b/include/net/netns/x_tables.h
@@ -2,7 +2,7 @@
 #define __NETNS_X_TABLES_H
 
 #include <linux/list.h>
-#include <linux/netfilter.h>
+#include <linux/netfilter_defs.h>
 
 struct ebt_table;
 
diff --git a/include/uapi/linux/netfilter.h b/include/uapi/linux/netfilter.h
index ef1b1f88ca18..750c04e41b6d 100644
--- a/include/uapi/linux/netfilter.h
+++ b/include/uapi/linux/netfilter.h
@@ -4,7 +4,8 @@
 #include <linux/types.h>
 #include <linux/compiler.h>
 #include <linux/sysctl.h>
-
+#include <linux/in.h>
+#include <linux/in6.h>
 
 /* Responses from hook functions. */
 #define NF_DROP 0
* Unmerged path net/ipv6/output_core.c
