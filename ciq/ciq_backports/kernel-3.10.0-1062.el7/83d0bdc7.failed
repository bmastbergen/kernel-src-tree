ptp: check gettime64 return code in PTP_SYS_OFFSET ioctl

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1062.el7
commit-author Miroslav Lichvar <mlichvar@redhat.com>
commit 83d0bdc7390b890905634186baaa294475cd6a06
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1062.el7/83d0bdc7.failed

If a gettime64 call fails, return the error and avoid copying data back
to user.

	Cc: Richard Cochran <richardcochran@gmail.com>
	Cc: Jacob Keller <jacob.e.keller@intel.com>
	Signed-off-by: Miroslav Lichvar <mlichvar@redhat.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 83d0bdc7390b890905634186baaa294475cd6a06)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/ptp/ptp_chardev.c
diff --cc drivers/ptp/ptp_chardev.c
index ddd1acf31245,3c681bed5703..000000000000
--- a/drivers/ptp/ptp_chardev.c
+++ b/drivers/ptp/ptp_chardev.c
@@@ -234,12 -228,9 +234,18 @@@ long ptp_ioctl(struct posix_clock *pc, 
  			pct->sec = ts.tv_sec;
  			pct->nsec = ts.tv_nsec;
  			pct++;
++<<<<<<< HEAD
 +			if (ptp->info->gettime64) {
 +				ptp->info->gettime64(ptp->info, &ts);
 +			} else {
 +				ptp->info->gettime(ptp->info, &t2);
 +				ts = timespec_to_timespec64(t2);
 +			}
++=======
+ 			err = ptp->info->gettime64(ptp->info, &ts);
+ 			if (err)
+ 				goto out;
++>>>>>>> 83d0bdc7390b (ptp: check gettime64 return code in PTP_SYS_OFFSET ioctl)
  			pct->sec = ts.tv_sec;
  			pct->nsec = ts.tv_nsec;
  			pct++;
* Unmerged path drivers/ptp/ptp_chardev.c
