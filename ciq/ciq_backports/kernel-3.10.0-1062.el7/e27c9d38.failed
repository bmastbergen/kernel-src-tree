fuse: fuse: add time_gran to INIT_OUT

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1062.el7
commit-author Miklos Szeredi <mszeredi@suse.cz>
commit e27c9d3877a0d0479711a55f5cdd7ee91442da53
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1062.el7/e27c9d38.failed

Allow userspace fs to specify time granularity.

This is needed because with writeback_cache mode the kernel is responsible
for generating mtime and ctime, but if the underlying filesystem doesn't
support nanosecond granularity then the cache will contain a different
value from the one stored on the filesystem resulting in a change of times
after a cache flush.

Make the default granularity 1s.

	Signed-off-by: Miklos Szeredi <mszeredi@suse.cz>
(cherry picked from commit e27c9d3877a0d0479711a55f5cdd7ee91442da53)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	fs/fuse/inode.c
#	include/uapi/linux/fuse.h
diff --cc fs/fuse/inode.c
index 4fc9c23e42fa,560eafcdd6a7..000000000000
--- a/fs/fuse/inode.c
+++ b/fs/fuse/inode.c
@@@ -885,6 -889,13 +885,16 @@@ static void process_init_reply(struct f
  			}
  			if (arg->flags & FUSE_ASYNC_DIO)
  				fc->async_dio = 1;
++<<<<<<< HEAD
++=======
+ 			if (arg->flags & FUSE_WRITEBACK_CACHE)
+ 				fc->writeback_cache = 1;
+ 			if (arg->time_gran && arg->time_gran <= 1000000000)
+ 				fc->sb->s_time_gran = arg->time_gran;
+ 			else
+ 				fc->sb->s_time_gran = 1000000000;
+ 
++>>>>>>> e27c9d3877a0 (fuse: fuse: add time_gran to INIT_OUT)
  		} else {
  			ra_pages = fc->max_read / PAGE_CACHE_SIZE;
  			fc->no_lock = 1;
diff --cc include/uapi/linux/fuse.h
index 5d0f06afda03,d1b4e2ca9672..000000000000
--- a/include/uapi/linux/fuse.h
+++ b/include/uapi/linux/fuse.h
@@@ -98,12 -98,6 +98,15 @@@
   *  - add FUSE_WRITEBACK_CACHE
   *  - add time_gran to fuse_init_out
   *  - add reserved space to fuse_init_out
++<<<<<<< HEAD
 + *  - add FATTR_CTIME
 + *  - add ctime and ctimensec to fuse_setattr_in
 + *  - add FUSE_RENAME2 request
 + *
 + *  7.24
 + *  - add FUSE_LSEEK for SEEK_HOLE and SEEK_DATA support
++=======
++>>>>>>> e27c9d3877a0 (fuse: fuse: add time_gran to INIT_OUT)
   */
  
  #ifndef _LINUX_FUSE_H
* Unmerged path fs/fuse/inode.c
* Unmerged path include/uapi/linux/fuse.h
