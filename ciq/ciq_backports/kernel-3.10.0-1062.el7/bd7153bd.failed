r8169: remove unneeded mmiowb barriers

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1062.el7
commit-author Heiner Kallweit <hkallweit1@gmail.com>
commit bd7153bd83b806bfcc2e79b7a6f43aa653d06ef3
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1062.el7/bd7153bd.failed

writex() has implicit barriers, that's what makes it different from
writex_relaxed(). Therefore these calls to mmiowb() can be removed.

	Signed-off-by: Heiner Kallweit <hkallweit1@gmail.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit bd7153bd83b806bfcc2e79b7a6f43aa653d06ef3)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/realtek/r8169.c
diff --cc drivers/net/ethernet/realtek/r8169.c
index a071f530b728,e26c48bd54a2..000000000000
--- a/drivers/net/ethernet/realtek/r8169.c
+++ b/drivers/net/ethernet/realtek/r8169.c
@@@ -1369,14 -1288,8 +1368,13 @@@ static void rtl_ack_events(struct rtl81
  static void rtl_irq_disable(struct rtl8169_private *tp)
  {
  	RTL_W16(tp, IntrMask, 0);
- 	mmiowb();
  }
  
 +static void rtl_irq_enable(struct rtl8169_private *tp, u16 bits)
 +{
 +	RTL_W16(tp, IntrMask, bits);
 +}
 +
  #define RTL_EVENT_NAPI_RX	(RxOK | RxErr)
  #define RTL_EVENT_NAPI_TX	(TxOK | TxErr)
  #define RTL_EVENT_NAPI		(RTL_EVENT_NAPI_RX | RTL_EVENT_NAPI_TX)
@@@ -6377,16 -6121,14 +6375,24 @@@ static netdev_tx_t rtl8169_start_xmit(s
  
  	tp->cur_tx += frags + 1;
  
 -	stop_queue = !rtl_tx_slots_avail(tp, MAX_SKB_FRAGS);
 -	if (unlikely(stop_queue))
 +	RTL_W8(tp, TxPoll, NPQ);
 +
 +	mmiowb();
 +
 +	if (!rtl_tx_slots_avail(tp, MAX_SKB_FRAGS)) {
 +		/* Avoid wrongly optimistic queue wake-up: rtl_tx thread must
 +		 * not miss a ring update when it notices a stopped queue.
 +		 */
 +		smp_wmb();
  		netif_stop_queue(dev);
++<<<<<<< HEAD
++=======
+ 
+ 	if (__netdev_sent_queue(dev, skb->len, skb->xmit_more))
+ 		RTL_W8(tp, TxPoll, NPQ);
+ 
+ 	if (unlikely(stop_queue)) {
++>>>>>>> bd7153bd83b8 (r8169: remove unneeded mmiowb barriers)
  		/* Sync with rtl_tx:
  		 * - publish queue status and cur_tx ring index (write barrier)
  		 * - refresh dirty_tx ring index (read barrier).
@@@ -6744,9 -6477,7 +6750,13 @@@ static int rtl8169_poll(struct napi_str
  
  	if (work_done < budget) {
  		napi_complete_done(napi, work_done);
++<<<<<<< HEAD
 +
 +		rtl_irq_enable(tp, enable_mask);
 +		mmiowb();
++=======
+ 		rtl_irq_enable(tp);
++>>>>>>> bd7153bd83b8 (r8169: remove unneeded mmiowb barriers)
  	}
  
  	return work_done;
* Unmerged path drivers/net/ethernet/realtek/r8169.c
