pktgen: adjust flag NO_TIMESTAMP to be more pktgen compliant

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1062.el7
commit-author Jesper Dangaard Brouer <brouer@redhat.com>
commit f1f00d8ff60ca056db3805406507483eeb3794d7
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1062.el7/f1f00d8f.failed

Allow flag NO_TIMESTAMP to turn timestamping on again, like other flags,
with a negation of the flag like !NO_TIMESTAMP.

Also document the option flag NO_TIMESTAMP.

Fixes: afb84b626184 ("pktgen: add flag NO_TIMESTAMP to disable timestamping")
	Signed-off-by: Jesper Dangaard Brouer <brouer@redhat.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit f1f00d8ff60ca056db3805406507483eeb3794d7)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	Documentation/networking/pktgen.txt
diff --cc Documentation/networking/pktgen.txt
index 19368c442c98,6199ee6a040b..000000000000
--- a/Documentation/networking/pktgen.txt
+++ b/Documentation/networking/pktgen.txt
@@@ -133,13 -133,19 +133,20 @@@ Examples
                           The 'minimum' MAC is what you set with dstmac.
  
   pgset "flag [name]"     Set a flag to determine behaviour.  Current flags
 -                         are: IPSRC_RND # IP source is random (between min/max)
 -                              IPDST_RND # IP destination is random
 -                              UDPSRC_RND, UDPDST_RND,
 -                              MACSRC_RND, MACDST_RND
 -                              TXSIZE_RND, IPV6,
 +                         are: IPSRC_RND #IP Source is random (between min/max),
 +                              IPDST_RND, UDPSRC_RND,
 +                              UDPDST_RND, MACSRC_RND, MACDST_RND 
                                MPLS_RND, VID_RND, SVID_RND
 -                              FLOW_SEQ,
                                QUEUE_MAP_RND # queue map random
                                QUEUE_MAP_CPU # queue map mirrors smp_processor_id()
++<<<<<<< HEAD
 +                              IPSEC # Make IPsec encapsulation for packet
++=======
+                               UDPCSUM,
+                               IPSEC # IPsec encapsulation (needs CONFIG_XFRM)
+                               NODE_ALLOC # node specific memory allocation
+                               NO_TIMESTAMP # disable timestamping
++>>>>>>> f1f00d8ff60c (pktgen: adjust flag NO_TIMESTAMP to be more pktgen compliant)
  
   pgset spi SPI_VALUE     Set specific SA used to transform packet.
  
@@@ -272,7 -277,18 +279,12 @@@ fla
    UDPDST_RND
    MACSRC_RND
    MACDST_RND
 -  TXSIZE_RND
 -  IPV6
 -  MPLS_RND
 -  VID_RND
 -  SVID_RND
 -  FLOW_SEQ
 -  QUEUE_MAP_RND
 -  QUEUE_MAP_CPU
 -  UDPCSUM
    IPSEC
++<<<<<<< HEAD
++=======
+   NODE_ALLOC
+   NO_TIMESTAMP
++>>>>>>> f1f00d8ff60c (pktgen: adjust flag NO_TIMESTAMP to be more pktgen compliant)
  
  dst_min
  dst_max
* Unmerged path Documentation/networking/pktgen.txt
diff --git a/net/core/pktgen.c b/net/core/pktgen.c
index e016cad5bef8..0f1a354eb1a7 100644
--- a/net/core/pktgen.c
+++ b/net/core/pktgen.c
@@ -1267,6 +1267,9 @@ static ssize_t pktgen_if_write(struct file *file,
 		else if (strcmp(f, "NO_TIMESTAMP") == 0)
 			pkt_dev->flags |= F_NO_TIMESTAMP;
 
+		else if (strcmp(f, "!NO_TIMESTAMP") == 0)
+			pkt_dev->flags &= ~F_NO_TIMESTAMP;
+
 		else {
 			sprintf(pg_result,
 				"Flag -:%s:- unknown\nAvailable flags, (prepend ! to un-set flag):\n%s",
