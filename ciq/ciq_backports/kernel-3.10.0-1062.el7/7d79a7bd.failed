x86: Replace cpu_**_mask() with topology_**_cpumask()

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1062.el7
Rebuild_CHGLOG: - [x86] Replace cpu_**_mask() with topology_**_cpumask() (David Arcari) [1700822]
Rebuild_FUZZ: 95.05%
commit-author Bartosz Golaszewski <bgolaszewski@baylibre.com>
commit 7d79a7bd7554d420313451fb805ebc37a8da97fe
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1062.el7/7d79a7bd.failed

The former duplicate the functionalities of the latter but are
neither documented nor arch-independent.

	Signed-off-by: Bartosz Golaszewski <bgolaszewski@baylibre.com>
	Reviewed-by: Thomas Gleixner <tglx@linutronix.de>
	Cc: Benoit Cousson <bcousson@baylibre.com>
	Cc: Catalin Marinas <catalin.marinas@arm.com>
	Cc: Fenghua Yu <fenghua.yu@intel.com>
	Cc: Guenter Roeck <linux@roeck-us.net>
	Cc: Jean Delvare <jdelvare@suse.de>
	Cc: Jonathan Corbet <corbet@lwn.net>
	Cc: Linus Torvalds <torvalds@linux-foundation.org>
	Cc: Oleg Drokin <oleg.drokin@intel.com>
	Cc: Peter Zijlstra <peterz@infradead.org>
	Cc: Rafael J. Wysocki <rjw@rjwysocki.net>
	Cc: Russell King <linux@arm.linux.org.uk>
	Cc: Viresh Kumar <viresh.kumar@linaro.org>
Link: http://lkml.kernel.org/r/1432645896-12588-9-git-send-email-bgolaszewski@baylibre.com
	Signed-off-by: Ingo Molnar <mingo@kernel.org>
(cherry picked from commit 7d79a7bd7554d420313451fb805ebc37a8da97fe)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/x86/kernel/smpboot.c
diff --cc arch/x86/kernel/smpboot.c
index 806566a8a0ba,0e8209619455..000000000000
--- a/arch/x86/kernel/smpboot.c
+++ b/arch/x86/kernel/smpboot.c
@@@ -1144,10 -1011,17 +1146,10 @@@ static __init void disable_smp(void
  		physid_set_mask_of_physid(boot_cpu_physical_apicid, &phys_cpu_present_map);
  	else
  		physid_set_mask_of_physid(0, &phys_cpu_present_map);
- 	cpumask_set_cpu(0, cpu_sibling_mask(0));
- 	cpumask_set_cpu(0, cpu_core_mask(0));
+ 	cpumask_set_cpu(0, topology_sibling_cpumask(0));
+ 	cpumask_set_cpu(0, topology_core_cpumask(0));
  }
  
 -enum {
 -	SMP_OK,
 -	SMP_NO_CONFIG,
 -	SMP_NO_APIC,
 -	SMP_FORCE_UP,
 -};
 -
  /*
   * Various sanity checks.
   */
@@@ -1526,12 -1309,11 +1528,18 @@@ static void remove_siblinginfo(int cpu
  	for_each_cpu(sibling, cpu_llc_shared_mask(cpu))
  		cpumask_clear_cpu(cpu, cpu_llc_shared_mask(sibling));
  	cpumask_clear(cpu_llc_shared_mask(cpu));
++<<<<<<< HEAD
 +	cpumask_clear(cpu_sibling_mask(cpu));
 +	cpumask_clear(cpu_core_mask(cpu));
++=======
+ 	cpumask_clear(topology_sibling_cpumask(cpu));
+ 	cpumask_clear(topology_core_cpumask(cpu));
+ 	c->phys_proc_id = 0;
++>>>>>>> 7d79a7bd7554 (x86: Replace cpu_**_mask() with topology_**_cpumask())
  	c->cpu_core_id = 0;
 +	c->booted_cores = 0;
  	cpumask_clear_cpu(cpu, cpu_sibling_setup_mask);
 +	recompute_smt_state();
  }
  
  static void __ref remove_cpu_from_maps(int cpu)
diff --git a/arch/x86/kernel/cpu/proc.c b/arch/x86/kernel/cpu/proc.c
index 4fd6d4037d14..c6073d324950 100644
--- a/arch/x86/kernel/cpu/proc.c
+++ b/arch/x86/kernel/cpu/proc.c
@@ -12,7 +12,8 @@ static void show_cpuinfo_core(struct seq_file *m, struct cpuinfo_x86 *c,
 {
 #ifdef CONFIG_SMP
 	seq_printf(m, "physical id\t: %d\n", c->phys_proc_id);
-	seq_printf(m, "siblings\t: %d\n", cpumask_weight(cpu_core_mask(cpu)));
+	seq_printf(m, "siblings\t: %d\n",
+		   cpumask_weight(topology_core_cpumask(cpu)));
 	seq_printf(m, "core id\t\t: %d\n", c->cpu_core_id);
 	seq_printf(m, "cpu cores\t: %d\n", c->booted_cores);
 	seq_printf(m, "apicid\t\t: %d\n", c->apicid);
* Unmerged path arch/x86/kernel/smpboot.c
diff --git a/arch/x86/kernel/tsc_sync.c b/arch/x86/kernel/tsc_sync.c
index 6f1e8052c1fd..128e84a56c3c 100644
--- a/arch/x86/kernel/tsc_sync.c
+++ b/arch/x86/kernel/tsc_sync.c
@@ -299,7 +299,7 @@ static cycles_t check_tsc_warp(unsigned int timeout)
  */
 static inline unsigned int loop_timeout(int cpu)
 {
-	return (cpumask_weight(cpu_core_mask(cpu)) > 1) ? 2 : 20;
+	return (cpumask_weight(topology_core_cpumask(cpu)) > 1) ? 2 : 20;
 }
 
 /*
