netfilter: rpfilter: bypass ipv4 lbcast packets with zeronet source

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1062.el7
commit-author Liping Zhang <zlpnobody@gmail.com>
commit 3b760dcb0fd304873dfde9ff072a49f893c6f5c4
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1062.el7/3b760dcb.failed

Otherwise, DHCP Discover packets(0.0.0.0->255.255.255.255) may be
dropped incorrectly.

	Signed-off-by: Liping Zhang <zlpnobody@gmail.com>
	Acked-by: Florian Westphal <fw@strlen.de>
	Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
(cherry picked from commit 3b760dcb0fd304873dfde9ff072a49f893c6f5c4)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/ipv4/netfilter/ipt_rpfilter.c
#	net/ipv4/netfilter/nft_fib_ipv4.c
diff --cc net/ipv4/netfilter/ipt_rpfilter.c
index 56dd8ac6d28b,f273098e48fd..000000000000
--- a/net/ipv4/netfilter/ipt_rpfilter.c
+++ b/net/ipv4/netfilter/ipt_rpfilter.c
@@@ -84,14 -83,13 +84,24 @@@ static bool rpfilter_mt(const struct sk
  		return true ^ invert;
  
  	iph = ip_hdr(skb);
++<<<<<<< HEAD
 +	if (ipv4_is_multicast(iph->daddr)) {
 +		if (ipv4_is_zeronet(iph->saddr))
 +			return ipv4_is_local_multicast(iph->daddr) ^ invert;
 +		flow.flowi4_iif = 0;
 +	} else {
 +		flow.flowi4_iif = LOOPBACK_IFINDEX;
 +	}
 +
++=======
+ 	if (ipv4_is_zeronet(iph->saddr)) {
+ 		if (ipv4_is_lbcast(iph->daddr) ||
+ 		    ipv4_is_local_multicast(iph->daddr))
+ 			return true ^ invert;
+ 	}
+ 
+ 	flow.flowi4_iif = LOOPBACK_IFINDEX;
++>>>>>>> 3b760dcb0fd3 (netfilter: rpfilter: bypass ipv4 lbcast packets with zeronet source)
  	flow.daddr = iph->saddr;
  	flow.saddr = rpfilter_get_saddr(iph->daddr);
  	flow.flowi4_oif = 0;
* Unmerged path net/ipv4/netfilter/nft_fib_ipv4.c
* Unmerged path net/ipv4/netfilter/ipt_rpfilter.c
* Unmerged path net/ipv4/netfilter/nft_fib_ipv4.c
