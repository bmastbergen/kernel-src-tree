netfilter: use skb_to_full_sk in ip6_route_me_harder

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1062.el7
commit-author Eric Dumazet <edumazet@google.com>
commit 7d98386d55a5afaa65de77e1e9197edeb8a42079
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1062.el7/7d98386d.failed

For some reason, Florian forgot to apply to ip6_route_me_harder
the fix that went in commit 29e09229d9f2 ("netfilter: use
skb_to_full_sk in ip_route_me_harder")

Fixes: ca6fb0651883 ("tcp: attach SYNACK messages to request sockets instead of listener")Â 
	Signed-off-by: Eric Dumazet <edumazet@google.com>
	Reported-by: syzbot <syzkaller@googlegroups.com>
	Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
(cherry picked from commit 7d98386d55a5afaa65de77e1e9197edeb8a42079)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/ipv6/netfilter.c
diff --cc net/ipv6/netfilter.c
index a9957c7115a9,531d6957af36..000000000000
--- a/net/ipv6/netfilter.c
+++ b/net/ipv6/netfilter.c
@@@ -18,15 -18,16 +18,20 @@@
  #include <net/ip6_checksum.h>
  #include <net/netfilter/nf_queue.h>
  
 -int ip6_route_me_harder(struct net *net, struct sk_buff *skb)
 +int ip6_route_me_harder(struct sk_buff *skb)
  {
 +	struct net *net = dev_net(skb_dst(skb)->dev);
  	const struct ipv6hdr *iph = ipv6_hdr(skb);
+ 	struct sock *sk = sk_to_full_sk(skb->sk);
  	unsigned int hh_len;
  	struct dst_entry *dst;
  	struct flowi6 fl6 = {
- 		.flowi6_oif = skb->sk ? skb->sk->sk_bound_dev_if : 0,
+ 		.flowi6_oif = sk ? sk->sk_bound_dev_if : 0,
  		.flowi6_mark = skb->mark,
++<<<<<<< HEAD
++=======
+ 		.flowi6_uid = sock_net_uid(net, sk),
++>>>>>>> 7d98386d55a5 (netfilter: use skb_to_full_sk in ip6_route_me_harder)
  		.daddr = iph->daddr,
  		.saddr = iph->saddr,
  	};
* Unmerged path net/ipv6/netfilter.c
