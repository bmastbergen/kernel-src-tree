ipmi: Remove platform driver overrides and use the id_table

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1062.el7
commit-author Corey Minyard <cminyard@mvista.com>
commit b3096c70b3faf0b08d7d461f359eb4b0447dff8e
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1062.el7/b3096c70.failed

The IPMI DMI code was adding platform overrides, which is not
really an ideal solution.  Switch to using the id_table in
the drivers to identify the devices.

	Signed-off-by: Corey Minyard <cminyard@mvista.com>
(cherry picked from commit b3096c70b3faf0b08d7d461f359eb4b0447dff8e)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/char/ipmi/ipmi_dmi.c
diff --cc drivers/char/ipmi/ipmi_dmi.c
index 1e63c9a6748a,249880457b17..000000000000
--- a/drivers/char/ipmi/ipmi_dmi.c
+++ b/drivers/char/ipmi/ipmi_dmi.c
@@@ -48,9 -51,10 +48,16 @@@ static void __init dmi_add_platform_ipm
  
  	memset(p, 0, sizeof(p));
  
++<<<<<<< HEAD
 +	name = "ipmi_si";
 +	switch (type) {
 +	case IPMI_DMI_TYPE_SSIF:
++=======
+ 	name = "dmi-ipmi-si";
+ 	switch (type) {
+ 	case IPMI_DMI_TYPE_SSIF:
+ 		name = "dmi-ipmi-ssif";
++>>>>>>> b3096c70b3fa (ipmi: Remove platform driver overrides and use the id_table)
  		offset = 1;
  		size = 1;
  		si_type = SI_TYPE_INVALID;
* Unmerged path drivers/char/ipmi/ipmi_dmi.c
diff --git a/drivers/char/ipmi/ipmi_si_platform.c b/drivers/char/ipmi/ipmi_si_platform.c
index f807009a6a13..c57fe90c6f78 100644
--- a/drivers/char/ipmi/ipmi_si_platform.c
+++ b/drivers/char/ipmi/ipmi_si_platform.c
@@ -420,6 +420,11 @@ static int ipmi_remove(struct platform_device *pdev)
 	return ipmi_si_remove_by_dev(&pdev->dev);
 }
 
+static const struct platform_device_id si_plat_ids[] = {
+    { "dmi-ipmi-si", 0 },
+    { }
+};
+
 struct platform_driver ipmi_platform_driver = {
 	.driver = {
 		.name = DEVICE_NAME,
@@ -428,6 +433,7 @@ struct platform_driver ipmi_platform_driver = {
 	},
 	.probe		= ipmi_probe,
 	.remove		= ipmi_remove,
+	.id_table       = si_plat_ids
 };
 
 void ipmi_si_platform_init(void)
diff --git a/drivers/char/ipmi/ipmi_ssif.c b/drivers/char/ipmi/ipmi_ssif.c
index f848b5306c6a..cc496cecc55f 100644
--- a/drivers/char/ipmi/ipmi_ssif.c
+++ b/drivers/char/ipmi/ipmi_ssif.c
@@ -2119,12 +2119,18 @@ static int ssif_platform_remove(struct platform_device *dev)
 	return 0;
 }
 
+static const struct platform_device_id ssif_plat_ids[] = {
+    { "dmi-ipmi-ssif", 0 },
+    { }
+};
+
 static struct platform_driver ipmi_driver = {
 	.driver = {
 		.name = DEVICE_NAME,
 	},
 	.probe		= ssif_platform_probe,
 	.remove		= ssif_platform_remove,
+	.id_table       = ssif_plat_ids
 };
 
 static int init_ipmi_ssif(void)
