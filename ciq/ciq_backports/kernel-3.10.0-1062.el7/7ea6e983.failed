perf tools: Make check-headers.sh check based on kernel dir

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1062.el7
commit-author Jiri Olsa <jolsa@kernel.org>
commit 7ea6e983b2cce9a4277ea602c2976d18bd75a908
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1062.el7/7ea6e983.failed

Changing the logic to compare files with paths relative to kernel source
base dir. This way we can keep the output message for 2 unrelated files,
which is coming in following patch.

Committer testing:

Remove a line from tools/arch/x86/lib/memcpy_64.S to have it detected:

make: Entering directory '/home/acme/git/perf/tools/perf'
  BUILD:   Doing 'make -j4' parallel build
Warning: Kernel ABI header at 'tools/arch/x86/lib/memcpy_64.S' differs from latest version at 'arch/x86/lib/memcpy_64.S'
diff -u tools/arch/x86/lib/memcpy_64.S arch/x86/lib/memcpy_64.S
  INSTALL  GTK UI
  INSTALL  binaries

	Signed-off-by: Jiri Olsa <jolsa@kernel.org>
	Tested-by: Arnaldo Carvalho de Melo <acme@redhat.com>
	Cc: Alexander Kapshuk <alexander.kapshuk@gmail.com>
	Cc: Alexander Shishkin <alexander.shishkin@linux.intel.com>
	Cc: David Ahern <dsahern@gmail.com>
	Cc: Michael Ellerman <mpe@ellerman.id.au>
	Cc: Namhyung Kim <namhyung@kernel.org>
	Cc: Peter Zijlstra <peterz@infradead.org>
Link: http://lkml.kernel.org/r/20180813111504.3568-1-jolsa@kernel.org
Link: http://lkml.kernel.org/r/20180814072726.GA13931@krava
[ Do not use pushd/popd, its a bashism, reported by Michael Ellerman, fixed by Jiri Olsa ]
	Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>
(cherry picked from commit 7ea6e983b2cce9a4277ea602c2976d18bd75a908)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	tools/perf/check-headers.sh
diff --cc tools/perf/check-headers.sh
index 4b4b21bef21d,b61f8a4dfca3..000000000000
--- a/tools/perf/check-headers.sh
+++ b/tools/perf/check-headers.sh
@@@ -48,25 -55,34 +48,49 @@@ include/uapi/asm-generic/errno.
  include/uapi/asm-generic/errno-base.h
  include/uapi/asm-generic/ioctls.h
  include/uapi/asm-generic/mman-common.h
 -include/uapi/asm-generic/unistd.h
  '
  
++<<<<<<< HEAD
++=======
+ check_2 () {
+   file1=$1
+   file2=$2
+ 
+   shift
+   shift
+ 
+   cmd="diff $* $file1 $file2 > /dev/null"
+ 
+   test -f $file2 && {
+     eval $cmd || {
+       echo "Warning: Kernel ABI header at '$file1' differs from latest version at '$file2'" >&2
+       echo diff -u $file1 $file2
+     }
+   }
+ }
+ 
++>>>>>>> 7ea6e983b2cc (perf tools: Make check-headers.sh check based on kernel dir)
  check () {
    file=$1
  
    shift
 +  opts=
 +  while [ -n "$*" ]; do
 +    opts="$opts \"$1\""
 +    shift
 +  done
  
++<<<<<<< HEAD
 +  cmd="diff $opts ../$file ../../$file > /dev/null"
 +
 +  test -f ../../$file &&
 +  eval $cmd || echo "Warning: Kernel ABI header at 'tools/$file' differs from latest version at '$file'" >&2
++=======
+   check_2 tools/$file $file $*
++>>>>>>> 7ea6e983b2cc (perf tools: Make check-headers.sh check based on kernel dir)
  }
  
 +
  # Check if we have the kernel headers (tools/perf/../../include), else
  # we're probably on a detached tarball, so no point in trying to check
  # differences.
@@@ -78,5 -96,9 +104,14 @@@ for i in $HEADERS; d
  done
  
  # diff with extra ignore lines
++<<<<<<< HEAD
 +check include/uapi/asm-generic/mman.h -I "^#include <\(uapi/\)*asm-generic/mman-common.h>"
 +check include/uapi/linux/mman.h       -I "^#include <\(uapi/\)*asm/mman.h>"
++=======
+ check arch/x86/lib/memcpy_64.S        '-I "^EXPORT_SYMBOL" -I "^#include <asm/export.h>"'
+ check arch/x86/lib/memset_64.S        '-I "^EXPORT_SYMBOL" -I "^#include <asm/export.h>"'
+ check include/uapi/asm-generic/mman.h '-I "^#include <\(uapi/\)*asm-generic/mman-common.h>"'
+ check include/uapi/linux/mman.h       '-I "^#include <\(uapi/\)*asm/mman.h>"'
+ 
+ cd tools/perf
++>>>>>>> 7ea6e983b2cc (perf tools: Make check-headers.sh check based on kernel dir)
* Unmerged path tools/perf/check-headers.sh
