devlink: double free in devlink_resource_fill()

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1062.el7
commit-author Dan Carpenter <dan.carpenter@oracle.com>
commit 83fe9a966111b51a34f10c35e568e45bff34de48
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1062.el7/83fe9a96.failed

Smatch reports that devlink_dpipe_send_and_alloc_skb() frees the skb
on error so this is a double free.  We fixed a bunch of these bugs in
commit 7fe4d6dcbcb4 ("devlink: Remove redundant free on error path") but
we accidentally overlooked this one.

Fixes: d9f9b9a4d05f ("devlink: Add support for resource abstraction")
	Signed-off-by: Dan Carpenter <dan.carpenter@oracle.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 83fe9a966111b51a34f10c35e568e45bff34de48)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/core/devlink.c
diff --cc net/core/devlink.c
index ed32fe0e53b8,8c0ed225e280..000000000000
--- a/net/core/devlink.c
+++ b/net/core/devlink.c
@@@ -2596,8 -2600,6 +2596,11 @@@ send_done
  nla_put_failure:
  	err = -EMSGSIZE;
  err_resource_put:
++<<<<<<< HEAD
 +err_skb_send_alloc:
 +	genlmsg_cancel(skb, hdr);
++=======
++>>>>>>> 83fe9a966111 (devlink: double free in devlink_resource_fill())
  	nlmsg_free(skb);
  	return err;
  }
* Unmerged path net/core/devlink.c
