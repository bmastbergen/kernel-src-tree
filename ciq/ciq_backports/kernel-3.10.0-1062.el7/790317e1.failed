cpuset: initialize effective masks when clone_children is enabled

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1062.el7
commit-author Zefan Li <lizefan@huawei.com>
commit 790317e1b266c776765a4bdcedefea706ff0fada
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1062.el7/790317e1.failed

If clone_children is enabled, effective masks won't be initialized
due to the bug:

  # mount -t cgroup -o cpuset xxx /mnt
  # echo 1 > cgroup.clone_children
  # mkdir /mnt/tmp
  # cat /mnt/tmp/
  # cat cpuset.effective_cpus

  # cat cpuset.cpus
  0-15

And then this cpuset won't constrain the tasks in it.

Either the bug or the fix has no effect on unified hierarchy, as
there's no clone_chidren flag there any more.

	Reported-by: Christian Brauner <christianvanbrauner@gmail.com>
	Reported-by: Serge Hallyn <serge.hallyn@ubuntu.com>
	Cc: <stable@vger.kernel.org> # 3.17+
	Signed-off-by: Zefan Li <lizefan@huawei.com>
	Signed-off-by: Tejun Heo <tj@kernel.org>
	Tested-by: Serge Hallyn <serge.hallyn@canonical.com>
(cherry picked from commit 790317e1b266c776765a4bdcedefea706ff0fada)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	kernel/cpuset.c
diff --cc kernel/cpuset.c
index 13ab000c5f37,89d4ed08afba..000000000000
--- a/kernel/cpuset.c
+++ b/kernel/cpuset.c
@@@ -2173,10 -1977,12 +2173,16 @@@ static int cpuset_css_online(struct cgr
  	}
  	rcu_read_unlock();
  
 -	spin_lock_irq(&callback_lock);
 +	mutex_lock(&callback_mutex);
  	cs->mems_allowed = parent->mems_allowed;
+ 	cs->effective_mems = parent->mems_allowed;
  	cpumask_copy(cs->cpus_allowed, parent->cpus_allowed);
++<<<<<<< HEAD
 +	mutex_unlock(&callback_mutex);
++=======
+ 	cpumask_copy(cs->effective_cpus, parent->cpus_allowed);
+ 	spin_unlock_irq(&callback_lock);
++>>>>>>> 790317e1b266 (cpuset: initialize effective masks when clone_children is enabled)
  out_unlock:
  	mutex_unlock(&cpuset_mutex);
  	return 0;
* Unmerged path kernel/cpuset.c
