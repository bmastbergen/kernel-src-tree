drm/amd/display: support spdif

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-193.el8
commit-author Charlene Liu <charlene.liu@amd.com>
commit b5a41620bb88efb9fb31a4fa5e652e3d5bead7d4
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-193.el8/b5a41620.failed

[Description]
port spdif fix to staging:
 spdif hardwired to afmt inst 1.
 spdif func pointer
 spdif resource allocation (reserve last audio endpoint for spdif only)

	Signed-off-by: Charlene Liu <charlene.liu@amd.com>
	Reviewed-by: Dmytro Laktyushkin <Dmytro.Laktyushkin@amd.com>
	Acked-by: Bhawanpreet Lakha <Bhawanpreet.Lakha@amd.com>
	Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
(cherry picked from commit b5a41620bb88efb9fb31a4fa5e652e3d5bead7d4)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/gpu/drm/amd/display/dc/core/dc_resource.c
diff --cc drivers/gpu/drm/amd/display/dc/core/dc_resource.c
index 4c06eb52ab73,ac908141b395..000000000000
--- a/drivers/gpu/drm/amd/display/dc/core/dc_resource.c
+++ b/drivers/gpu/drm/amd/display/dc/core/dc_resource.c
@@@ -1608,9 -1631,13 +1609,16 @@@ static struct audio *find_first_free_au
  			return pool->audios[i];
  		}
  	}
++<<<<<<< HEAD
++=======
+ 
+ 	/* use engine id to find free audio */
+ 	if ((id < available_audio_count) && (res_ctx->is_audio_acquired[id] == false)) {
+ 		return pool->audios[id];
+ 	}
++>>>>>>> b5a41620bb88 (drm/amd/display: support spdif)
  	/*not found the matching one, first come first serve*/
- 	for (i = 0; i < pool->audio_count; i++) {
+ 	for (i = 0; i < available_audio_count; i++) {
  		if (res_ctx->is_audio_acquired[i] == false) {
  			return pool->audios[i];
  		}
* Unmerged path drivers/gpu/drm/amd/display/dc/core/dc_resource.c
diff --git a/drivers/gpu/drm/amd/display/dc/dce/dce_audio.c b/drivers/gpu/drm/amd/display/dc/dce/dce_audio.c
index 7f6d724686f1..abb559ce6408 100644
--- a/drivers/gpu/drm/amd/display/dc/dce/dce_audio.c
+++ b/drivers/gpu/drm/amd/display/dc/dce/dce_audio.c
@@ -611,6 +611,8 @@ void dce_aud_az_configure(
 
 	AZ_REG_WRITE(AZALIA_F0_CODEC_PIN_CONTROL_SINK_INFO1,
 		value);
+	DC_LOG_HW_AUDIO("\n\tAUDIO:az_configure: index: %u data, 0x%x, displayName %s: \n",
+		audio->inst, value, audio_info->display_name);
 
 	/*
 	*write the port ID:
@@ -922,7 +924,6 @@ static const struct audio_funcs funcs = {
 	.az_configure = dce_aud_az_configure,
 	.destroy = dce_aud_destroy,
 };
-
 void dce_aud_destroy(struct audio **audio)
 {
 	struct dce_audio *aud = DCE_AUD(*audio);
@@ -953,7 +954,6 @@ struct audio *dce_audio_create(
 	audio->regs = reg;
 	audio->shifts = shifts;
 	audio->masks = masks;
-
 	return &audio->base;
 }
 
