drm/i915: update rawclk also on resume

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-193.el8
commit-author Jani Nikula <jani.nikula@intel.com>
commit 59ed05ccdded5eb18ce012eff3d01798ac8535fa
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-193.el8/59ed05cc.failed

Since CNP it's possible for rawclk to have two different values, 19.2
and 24 MHz. If the value indicated by SFUSE_STRAP register is different
from the power on default for PCH_RAWCLK_FREQ, we'll end up having a
mismatch between the rawclk hardware and software states after
suspend/resume. On previous platforms this used to work by accident,
because the power on defaults worked just fine.

Update the rawclk also on resume. The natural place to do this would be
intel_modeset_init_hw(), however VLV/CHV need it done before
intel_power_domains_init_hw(). Thus put it there even if it feels
slightly out of place.

v2: Call intel_update_rawclck() in intel_power_domains_init_hw() for all
    platforms (Ville).

	Reported-by: Shawn Lee <shawn.c.lee@intel.com>
	Cc: Shawn Lee <shawn.c.lee@intel.com>
	Cc: Ville Syrjala <ville.syrjala@linux.intel.com>
	Reviewed-by: Ville Syrjälä <ville.syrjala@linux.intel.com>
	Tested-by: Shawn Lee <shawn.c.lee@intel.com>
	Signed-off-by: Jani Nikula <jani.nikula@intel.com>
Link: https://patchwork.freedesktop.org/patch/msgid/20191101142024.13877-1-jani.nikula@intel.com
(cherry picked from commit 59ed05ccdded5eb18ce012eff3d01798ac8535fa)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/gpu/drm/i915/display/intel_display_power.c
#	drivers/gpu/drm/i915/i915_drv.c
diff --cc drivers/gpu/drm/i915/i915_drv.c
index 5fde05038258,82e4e6bf08c3..000000000000
--- a/drivers/gpu/drm/i915/i915_drv.c
+++ b/drivers/gpu/drm/i915/i915_drv.c
@@@ -680,14 -296,11 +680,18 @@@ static int i915_load_modeset_init(struc
  	if (ret)
  		goto cleanup_vga_client;
  
++<<<<<<< HEAD
 +	/* must happen before intel_power_domains_init_hw() on VLV/CHV */
 +	intel_update_rawclk(dev_priv);
 +
 +	intel_power_domains_init_hw(dev_priv, false);
++=======
+ 	intel_power_domains_init_hw(i915, false);
++>>>>>>> 59ed05ccdded (drm/i915: update rawclk also on resume)
  
 -	intel_csr_ucode_init(i915);
 +	intel_csr_ucode_init(dev_priv);
  
 -	ret = intel_irq_install(i915);
 +	ret = intel_irq_install(dev_priv);
  	if (ret)
  		goto cleanup_csr;
  
* Unmerged path drivers/gpu/drm/i915/display/intel_display_power.c
* Unmerged path drivers/gpu/drm/i915/display/intel_display_power.c
* Unmerged path drivers/gpu/drm/i915/i915_drv.c
