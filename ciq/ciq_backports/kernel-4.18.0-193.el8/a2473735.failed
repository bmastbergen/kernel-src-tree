xfs: simplify xfs_chain_bio

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-193.el8
commit-author Christoph Hellwig <hch@lst.de>
commit a247373596677bd38a88fcaf1606be51a44c614d
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-193.el8/a2473735.failed

Move setting up operation and write hint to xfs_alloc_ioend, and
then just copy over all needed information from the previous bio
in xfs_chain_bio and stop passing various parameters to it.

	Signed-off-by: Christoph Hellwig <hch@lst.de>
	Reviewed-by: Darrick J. Wong <darrick.wong@oracle.com>
	Signed-off-by: Darrick J. Wong <darrick.wong@oracle.com>
(cherry picked from commit a247373596677bd38a88fcaf1606be51a44c614d)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	fs/xfs/xfs_aops.c
diff --cc fs/xfs/xfs_aops.c
index 7b8bb6bde981,9cceb90e77c5..000000000000
--- a/fs/xfs/xfs_aops.c
+++ b/fs/xfs/xfs_aops.c
@@@ -658,15 -770,15 +657,20 @@@ xfs_add_to_ioend
  		if (wpc->ioend)
  			list_add(&wpc->ioend->io_list, iolist);
  		wpc->ioend = xfs_alloc_ioend(inode, wpc->fork,
- 				wpc->imap.br_state, offset, bdev, sector);
+ 				wpc->imap.br_state, offset, bdev, sector, wbc);
  	}
  
 -	if (!__bio_try_merge_page(wpc->ioend->io_bio, page, len, poff, true)) {
 +	if (!__bio_try_merge_page(wpc->ioend->io_bio, page, len, poff)) {
  		if (iop)
  			atomic_inc(&iop->write_count);
  		if (bio_full(wpc->ioend->io_bio))
++<<<<<<< HEAD
 +			xfs_chain_bio(wpc->ioend, wbc, bdev, sector);
 +		__bio_add_page(wpc->ioend->io_bio, page, len, poff);
++=======
+ 			wpc->ioend->io_bio = xfs_chain_bio(wpc->ioend->io_bio);
+ 		bio_add_page(wpc->ioend->io_bio, page, len, poff);
++>>>>>>> a24737359667 (xfs: simplify xfs_chain_bio)
  	}
  
  	wpc->ioend->io_size += len;
* Unmerged path fs/xfs/xfs_aops.c
