powerpc/fadump: consider reserved ranges while releasing memory

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-193.el8
commit-author Hari Bathini <hbathini@linux.ibm.com>
commit dda9dbfeeb7a855a75965b8ba7269f4edb35cde7
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-193.el8/dda9dbfe.failed

Commit 0962e8004e97 ("powerpc/prom: Scan reserved-ranges node for
memory reservations") enabled support to parse 'reserved-ranges' DT
node to reserve kernel memory falling in these ranges for firmware
purposes. Along with the preserved area memory, ensure memory in
reserved ranges is not overlapped with memory released by capture
kernel aftering saving vmcore. Also, fix the off-by-one error in
fadump_release_reserved_area function while releasing memory.

	Signed-off-by: Hari Bathini <hbathini@linux.ibm.com>
	Signed-off-by: Michael Ellerman <mpe@ellerman.id.au>
Link: https://lore.kernel.org/r/156821371358.5656.6061214942558818661.stgit@hbathini.in.ibm.com
(cherry picked from commit dda9dbfeeb7a855a75965b8ba7269f4edb35cde7)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/powerpc/kernel/fadump.c
diff --cc arch/powerpc/kernel/fadump.c
index 56526469b148,502e49ab4b98..000000000000
--- a/arch/powerpc/kernel/fadump.c
+++ b/arch/powerpc/kernel/fadump.c
@@@ -45,17 -32,11 +45,22 @@@
  #include <asm/fadump-internal.h>
  #include <asm/setup.h>
  
 +#include "../platforms/pseries/rtas-fadump.h"
 +
  static struct fw_dump fw_dump;
 +static struct rtas_fadump_mem_struct fdm;
 +static const struct rtas_fadump_mem_struct *fdm_active;
  
  static DEFINE_MUTEX(fadump_mutex);
++<<<<<<< HEAD
 +struct fad_crash_memory_ranges *crash_memory_ranges;
 +int crash_memory_ranges_size;
 +int crash_mem_ranges;
 +int max_crash_mem_ranges;
++=======
+ struct fadump_mrange_info crash_mrange_info = { "crash", NULL, 0, 0, 0 };
+ struct fadump_mrange_info reserved_mrange_info = { "reserved", NULL, 0, 0, 0 };
++>>>>>>> dda9dbfeeb7a (powerpc/fadump: consider reserved ranges while releasing memory)
  
  #ifdef CONFIG_CMA
  static struct cma *fadump_cma;
* Unmerged path arch/powerpc/kernel/fadump.c
