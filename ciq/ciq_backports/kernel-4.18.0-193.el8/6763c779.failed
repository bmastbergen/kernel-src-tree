bnxt_en: Add new FW devlink_health_reporter

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-193.el8
commit-author Vasundhara Volam <vasundhara-v.volam@broadcom.com>
commit 6763c779c2d8b568b2e174f3eeeaf644fa38b34d
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-193.el8/6763c779.failed

Create new FW devlink_health_reporter, to know the current health
status of FW.

Command example and output:
$ devlink health show pci/0000:af:00.0 reporter fw

pci/0000:af:00.0:
  name fw
    state healthy error 0 recover 0

 FW status: Healthy; Reset count: 1

	Cc: Jiri Pirko <jiri@mellanox.com>
	Signed-off-by: Vasundhara Volam <vasundhara-v.volam@broadcom.com>
	Signed-off-by: Michael Chan <michael.chan@broadcom.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 6763c779c2d8b568b2e174f3eeeaf644fa38b34d)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/broadcom/bnxt/bnxt.h
#	drivers/net/ethernet/broadcom/bnxt/bnxt_devlink.c
diff --cc drivers/net/ethernet/broadcom/bnxt/bnxt.h
index ec38cf13f1c9,a75fe16cf2e6..000000000000
--- a/drivers/net/ethernet/broadcom/bnxt/bnxt.h
+++ b/drivers/net/ethernet/broadcom/bnxt/bnxt.h
@@@ -1325,6 -1344,47 +1325,50 @@@ struct bnxt_ctx_mem_info 
  	struct bnxt_ctx_pg_info *tqm_mem[9];
  };
  
++<<<<<<< HEAD
++=======
+ struct bnxt_fw_health {
+ 	u32 flags;
+ 	u32 polling_dsecs;
+ 	u32 master_func_wait_dsecs;
+ 	u32 normal_func_wait_dsecs;
+ 	u32 post_reset_wait_dsecs;
+ 	u32 post_reset_max_wait_dsecs;
+ 	u32 regs[4];
+ 	u32 mapped_regs[4];
+ #define BNXT_FW_HEALTH_REG		0
+ #define BNXT_FW_HEARTBEAT_REG		1
+ #define BNXT_FW_RESET_CNT_REG		2
+ #define BNXT_FW_RESET_INPROG_REG	3
+ 	u32 fw_reset_inprog_reg_mask;
+ 	u32 last_fw_heartbeat;
+ 	u32 last_fw_reset_cnt;
+ 	u8 enabled:1;
+ 	u8 master:1;
+ 	u8 tmr_multiplier;
+ 	u8 tmr_counter;
+ 	u8 fw_reset_seq_cnt;
+ 	u32 fw_reset_seq_regs[16];
+ 	u32 fw_reset_seq_vals[16];
+ 	u32 fw_reset_seq_delay_msec[16];
+ 	struct devlink_health_reporter	*fw_reporter;
+ };
+ 
+ #define BNXT_FW_HEALTH_REG_TYPE_MASK	3
+ #define BNXT_FW_HEALTH_REG_TYPE_CFG	0
+ #define BNXT_FW_HEALTH_REG_TYPE_GRC	1
+ #define BNXT_FW_HEALTH_REG_TYPE_BAR0	2
+ #define BNXT_FW_HEALTH_REG_TYPE_BAR1	3
+ 
+ #define BNXT_FW_HEALTH_REG_TYPE(reg)	((reg) & BNXT_FW_HEALTH_REG_TYPE_MASK)
+ #define BNXT_FW_HEALTH_REG_OFF(reg)	((reg) & ~BNXT_FW_HEALTH_REG_TYPE_MASK)
+ 
+ #define BNXT_FW_HEALTH_WIN_BASE		0x3000
+ #define BNXT_FW_HEALTH_WIN_MAP_OFF	8
+ 
+ #define BNXT_FW_STATUS_HEALTHY		0x8000
+ 
++>>>>>>> 6763c779c2d8 (bnxt_en: Add new FW devlink_health_reporter)
  struct bnxt {
  	void __iomem		*bar0;
  	void __iomem		*bar1;
diff --cc drivers/net/ethernet/broadcom/bnxt/bnxt_devlink.c
index 336fbceafb45,e15d5dc78725..000000000000
--- a/drivers/net/ethernet/broadcom/bnxt/bnxt_devlink.c
+++ b/drivers/net/ethernet/broadcom/bnxt/bnxt_devlink.c
@@@ -225,10 -306,34 +303,12 @@@ int bnxt_dl_register(struct bnxt *bp
  		goto err_dl_unreg;
  	}
  
 -	devlink_port_attrs_set(&bp->dl_port, DEVLINK_PORT_FLAVOUR_PHYSICAL,
 -			       bp->pf.port_id, false, 0,
 -			       bp->switch_id, sizeof(bp->switch_id));
 -	rc = devlink_port_register(dl, &bp->dl_port, bp->pf.port_id);
 -	if (rc) {
 -		netdev_err(bp->dev, "devlink_port_register failed");
 -		goto err_dl_param_unreg;
 -	}
 -	devlink_port_type_eth_set(&bp->dl_port, bp->dev);
 -
 -	rc = devlink_port_params_register(&bp->dl_port, bnxt_dl_port_params,
 -					  ARRAY_SIZE(bnxt_dl_port_params));
 -	if (rc) {
 -		netdev_err(bp->dev, "devlink_port_params_register failed");
 -		goto err_dl_port_unreg;
 -	}
 -
  	devlink_params_publish(dl);
  
+ 	bnxt_dl_fw_reporters_create(bp);
+ 
  	return 0;
  
 -err_dl_port_unreg:
 -	devlink_port_unregister(&bp->dl_port);
 -err_dl_param_unreg:
 -	devlink_params_unregister(dl, bnxt_dl_params,
 -				  ARRAY_SIZE(bnxt_dl_params));
  err_dl_unreg:
  	devlink_unregister(dl);
  err_dl_free:
@@@ -244,6 -349,10 +324,13 @@@ void bnxt_dl_unregister(struct bnxt *bp
  	if (!dl)
  		return;
  
++<<<<<<< HEAD
++=======
+ 	bnxt_dl_fw_reporters_destroy(bp);
+ 	devlink_port_params_unregister(&bp->dl_port, bnxt_dl_port_params,
+ 				       ARRAY_SIZE(bnxt_dl_port_params));
+ 	devlink_port_unregister(&bp->dl_port);
++>>>>>>> 6763c779c2d8 (bnxt_en: Add new FW devlink_health_reporter)
  	devlink_params_unregister(dl, bnxt_dl_params,
  				  ARRAY_SIZE(bnxt_dl_params));
  	devlink_unregister(dl);
* Unmerged path drivers/net/ethernet/broadcom/bnxt/bnxt.h
* Unmerged path drivers/net/ethernet/broadcom/bnxt/bnxt_devlink.c
