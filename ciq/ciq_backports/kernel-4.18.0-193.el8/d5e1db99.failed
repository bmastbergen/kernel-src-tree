selftests/bpf: remove logic duplication in test_verifier

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-193.el8
commit-author Andrii Nakryiko <andriin@fb.com>
commit d5e1db990fcce571a4af2434d6fc2b312d94b45e
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-193.el8/d5e1db99.failed

test_verifier tests can specify single- and multi-runs tests. Internally
logic of handling them is duplicated. Get rid of it by making single run
retval/data specification to be a first run spec.

	Signed-off-by: Andrii Nakryiko <andriin@fb.com>
	Cc: Krzesimir Nowak <krzesimir@kinvolk.io>
	Signed-off-by: Daniel Borkmann <daniel@iogearbox.net>
(cherry picked from commit d5e1db990fcce571a4af2434d6fc2b312d94b45e)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	tools/testing/selftests/bpf/test_verifier.c
diff --cc tools/testing/selftests/bpf/test_verifier.c
index 96071fae318d,84135d5f4b35..000000000000
--- a/tools/testing/selftests/bpf/test_verifier.c
+++ b/tools/testing/selftests/bpf/test_verifier.c
@@@ -80,9 -80,14 +80,14 @@@ struct bpf_test 
  	int fixup_cgroup_storage[MAX_FIXUPS];
  	int fixup_percpu_cgroup_storage[MAX_FIXUPS];
  	int fixup_map_spin_lock[MAX_FIXUPS];
 -	int fixup_map_array_ro[MAX_FIXUPS];
 -	int fixup_map_array_wo[MAX_FIXUPS];
 -	int fixup_map_array_small[MAX_FIXUPS];
 -	int fixup_sk_storage_map[MAX_FIXUPS];
  	const char *errstr;
  	const char *errstr_unpriv;
++<<<<<<< HEAD
 +	uint32_t retval, retval_unpriv, insn_processed;
++=======
+ 	uint32_t insn_processed;
+ 	int prog_len;
++>>>>>>> d5e1db990fcc (selftests/bpf: remove logic duplication in test_verifier)
  	enum {
  		UNDEF,
  		ACCEPT,
@@@ -90,16 -95,21 +95,31 @@@
  	} result, result_unpriv;
  	enum bpf_prog_type prog_type;
  	uint8_t flags;
- 	__u8 data[TEST_DATA_LEN];
  	void (*fill_helper)(struct bpf_test *self);
  	uint8_t runs;
++<<<<<<< HEAD
 +	struct {
 +		uint32_t retval, retval_unpriv;
 +		union {
 +			__u8 data[TEST_DATA_LEN];
 +			__u64 data64[TEST_DATA_LEN / 8];
 +		};
 +	} retvals[MAX_TEST_RUNS];
++=======
+ #define bpf_testdata_struct_t					\
+ 	struct {						\
+ 		uint32_t retval, retval_unpriv;			\
+ 		union {						\
+ 			__u8 data[TEST_DATA_LEN];		\
+ 			__u64 data64[TEST_DATA_LEN / 8];	\
+ 		};						\
+ 	}
+ 	union {
+ 		bpf_testdata_struct_t;
+ 		bpf_testdata_struct_t retvals[MAX_TEST_RUNS];
+ 	};
+ 	enum bpf_attach_type expected_attach_type;
++>>>>>>> d5e1db990fcc (selftests/bpf: remove logic duplication in test_verifier)
  };
  
  /* Note we want this to be 64 bit aligned so that the end of our array is
* Unmerged path tools/testing/selftests/bpf/test_verifier.c
