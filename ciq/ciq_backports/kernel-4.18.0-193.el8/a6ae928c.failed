Revert "printk: make sure to print log on console."

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-193.el8
commit-author Petr Mladek <pmladek@suse.com>
commit a6ae928c25835ca18deb4a527079f169b68ed292
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-193.el8/a6ae928c.failed

This reverts commit 375899cddcbb26881b03cb3fbdcfd600e4e67f4a.

The visibility of early messages did not longer take into account
"quiet", "debug", and "loglevel" early parameters.

It would be possible to invalidate and recompute LOG_NOCONS flag
for the affected messages. But it would be hairy.

Instead this patch just reverts the problematic commit. We could
come up with a better solution for the original problem. For example,
we could simplify the logic and just mark messages that should always
be visible or always invisible on the console.

Also this patch reverts the related build fix commit ffaa619af1b06
("printk: Fix warning about unused suppress_message_printing").

Finally, this patch does not put back the unused LOG_NOCONS flag.

Link: http://lkml.kernel.org/r/20180910145747.emvfzv4mzlk5dfqk@pathway.suse.cz
	Cc: Thomas Gleixner <tglx@linutronix.de>
	Cc: Ingo Molnar <mingo@redhat.com>
	Cc: "H . Peter Anvin" <hpa@zytor.com>
	Cc: x86@kernel.org
	Cc: linux-kernel@vger.kernel.org
	Cc: Steven Rostedt <rostedt@goodmis.org>
	Cc: Maninder Singh <maninder1.s@samsung.com>
	Reported-by: Hans de Goede <hdegoede@redhat.com>
	Acked-by: Hans de Goede <hdegoede@redhat.com>
	Acked-by: Sergey Senozhatsky <sergey.senozhatsky@gmail.com>
	Signed-off-by: Petr Mladek <pmladek@suse.com>
(cherry picked from commit a6ae928c25835ca18deb4a527079f169b68ed292)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	kernel/printk/printk.c
diff --cc kernel/printk/printk.c
index 4c034d58f98d,e30e5023511b..000000000000
--- a/kernel/printk/printk.c
+++ b/kernel/printk/printk.c
@@@ -1899,11 -1878,29 +1898,17 @@@ asmlinkage int vprintk_emit(int facilit
  	if (dict)
  		lflags |= LOG_PREFIX|LOG_NEWLINE;
  
++<<<<<<< HEAD
 +	if (suppress_message_printing(level))
 +		lflags |= LOG_NOCONS;
 +
 +	printed_len = log_output(facility, level, lflags, dict, dictlen, text, text_len);
++=======
+ 	return log_output(facility, level, lflags,
+ 			  dict, dictlen, text, text_len);
+ }
++>>>>>>> a6ae928c2583 (Revert "printk: make sure to print log on console.")
  
 -asmlinkage int vprintk_emit(int facility, int level,
 -			    const char *dict, size_t dictlen,
 -			    const char *fmt, va_list args)
 -{
 -	int printed_len;
 -	bool in_sched = false;
 -	unsigned long flags;
 -
 -	if (level == LOGLEVEL_SCHED) {
 -		level = LOGLEVEL_DEFAULT;
 -		in_sched = true;
 -	}
 -
 -	boot_delay_msec(level);
 -	printk_delay();
 -
 -	/* This stops the holder of console_sem just where we want him */
 -	logbuf_lock_irqsave(flags);
 -	printed_len = vprintk_store(facility, level, dict, dictlen, fmt, args);
  	logbuf_unlock_irqrestore(flags);
  
  	/* If called from the scheduler, we can not call up(). */
* Unmerged path kernel/printk/printk.c
