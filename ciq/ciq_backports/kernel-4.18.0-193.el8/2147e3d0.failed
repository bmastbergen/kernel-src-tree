ibmvnic: Terminate waiting device threads after loss of service

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-193.el8
commit-author Thomas Falcon <tlfalcon@linux.ibm.com>
commit 2147e3d09e9ba6edc54b1b4bb7d8fc3cca96776b
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-193.el8/2147e3d0.failed

If we receive a notification that the device has been deactivated
or removed, force a completion of all waiting threads.

	Signed-off-by: Thomas Falcon <tlfalcon@linux.ibm.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 2147e3d09e9ba6edc54b1b4bb7d8fc3cca96776b)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/ibm/ibmvnic.c
diff --cc drivers/net/ethernet/ibm/ibmvnic.c
index d611942bd0ed,dc1b88116330..000000000000
--- a/drivers/net/ethernet/ibm/ibmvnic.c
+++ b/drivers/net/ethernet/ibm/ibmvnic.c
@@@ -4415,7 -4505,16 +4415,20 @@@ static void ibmvnic_handle_crq(union ib
  	case IBMVNIC_CRQ_XPORT_EVENT:
  		netif_carrier_off(netdev);
  		adapter->crq.active = false;
++<<<<<<< HEAD
 +		if (adapter->resetting)
++=======
+ 		/* terminate any thread waiting for a response
+ 		 * from the device
+ 		 */
+ 		if (!completion_done(&adapter->fw_done)) {
+ 			adapter->fw_done_rc = -EIO;
+ 			complete(&adapter->fw_done);
+ 		}
+ 		if (!completion_done(&adapter->stats_done))
+ 			complete(&adapter->stats_done);
+ 		if (test_bit(0, &adapter->resetting))
++>>>>>>> 2147e3d09e9b (ibmvnic: Terminate waiting device threads after loss of service)
  			adapter->force_reset_recovery = true;
  		if (gen_crq->cmd == IBMVNIC_PARTITION_MIGRATED) {
  			dev_info(dev, "Migrated, re-enabling adapter\n");
* Unmerged path drivers/net/ethernet/ibm/ibmvnic.c
