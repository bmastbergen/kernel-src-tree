seltests/powerpc: Add a selftest for memcpy_mcsafe

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-193.el8
commit-author Santosh Sivaraj <santosh@fossix.org>
commit 6f62a8223e65c0571e48225d5d7e56de95225bae
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-193.el8/6f62a822.failed

Appropriate self tests for memcpy_mcsafe

	Suggested-by: Michael Ellerman <mpe@ellerman.id.au>
	Signed-off-by: Santosh Sivaraj <santosh@fossix.org>
	Signed-off-by: Michael Ellerman <mpe@ellerman.id.au>
Link: https://lore.kernel.org/r/20190903214359.23887-2-santosh@fossix.org
(cherry picked from commit 6f62a8223e65c0571e48225d5d7e56de95225bae)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	tools/testing/selftests/powerpc/copyloops/.gitignore
#	tools/testing/selftests/powerpc/copyloops/Makefile
#	tools/testing/selftests/powerpc/copyloops/asm/export.h
diff --cc tools/testing/selftests/powerpc/copyloops/.gitignore
index 25a192f62c4d,12ef5b031974..000000000000
--- a/tools/testing/selftests/powerpc/copyloops/.gitignore
+++ b/tools/testing/selftests/powerpc/copyloops/.gitignore
@@@ -1,4 -1,14 +1,21 @@@
++<<<<<<< HEAD
 +copyuser_64
 +copyuser_power7
 +memcpy_64
 +memcpy_power7
++=======
+ copyuser_64_t0
+ copyuser_64_t1
+ copyuser_64_t2
+ copyuser_p7_t0
+ copyuser_p7_t1
+ memcpy_64_t0
+ memcpy_64_t1
+ memcpy_64_t2
+ memcpy_p7_t0
+ memcpy_p7_t1
+ copyuser_64_exc_t0
+ copyuser_64_exc_t1
+ copyuser_64_exc_t2
+ memcpy_mcsafe_64
++>>>>>>> 6f62a8223e65 (seltests/powerpc: Add a selftest for memcpy_mcsafe)
diff --cc tools/testing/selftests/powerpc/copyloops/Makefile
index ccc90f85f252,0917983a1c78..000000000000
--- a/tools/testing/selftests/powerpc/copyloops/Makefile
+++ b/tools/testing/selftests/powerpc/copyloops/Makefile
@@@ -8,15 -9,50 +8,58 @@@ CFLAGS += -maltive
  # Use our CFLAGS for the implicit .S rule & set the asm machine type
  ASFLAGS = $(CFLAGS) -Wa,-mpower4
  
++<<<<<<< HEAD
 +TEST_GEN_PROGS := copyuser_64 copyuser_power7 memcpy_64 memcpy_power7
 +EXTRA_SOURCES := validate.c ../harness.c
++=======
+ TEST_GEN_PROGS := copyuser_64_t0 copyuser_64_t1 copyuser_64_t2 \
+ 		copyuser_p7_t0 copyuser_p7_t1 \
+ 		memcpy_64_t0 memcpy_64_t1 memcpy_64_t2 \
+ 		memcpy_p7_t0 memcpy_p7_t1 memcpy_mcsafe_64 \
+ 		copyuser_64_exc_t0 copyuser_64_exc_t1 copyuser_64_exc_t2
+ 
+ EXTRA_SOURCES := validate.c ../harness.c stubs.S
++>>>>>>> 6f62a8223e65 (seltests/powerpc: Add a selftest for memcpy_mcsafe)
  
  top_srcdir = ../../../../..
  include ../../lib.mk
  
 -$(OUTPUT)/copyuser_64_t%:	copyuser_64.S $(EXTRA_SOURCES)
 -	$(CC) $(CPPFLAGS) $(CFLAGS) \
 -		-D COPY_LOOP=test___copy_tofrom_user_base \
 -		-D SELFTEST_CASE=$(subst copyuser_64_t,,$(notdir $@)) \
 -		-o $@ $^
 +$(OUTPUT)/copyuser_64:     CPPFLAGS += -D COPY_LOOP=test___copy_tofrom_user_base
 +$(OUTPUT)/copyuser_power7: CPPFLAGS += -D COPY_LOOP=test___copy_tofrom_user_power7
 +$(OUTPUT)/memcpy_64:       CPPFLAGS += -D COPY_LOOP=test_memcpy
 +$(OUTPUT)/memcpy_power7:   CPPFLAGS += -D COPY_LOOP=test_memcpy_power7
  
++<<<<<<< HEAD
 +$(TEST_GEN_PROGS): $(EXTRA_SOURCES)
++=======
+ $(OUTPUT)/copyuser_p7_t%:	copyuser_power7.S $(EXTRA_SOURCES)
+ 	$(CC) $(CPPFLAGS) $(CFLAGS) \
+ 		-D COPY_LOOP=test___copy_tofrom_user_power7 \
+ 		-D SELFTEST_CASE=$(subst copyuser_p7_t,,$(notdir $@)) \
+ 		-o $@ $^
+ 
+ # Strictly speaking, we only need the memcpy_64 test cases for big-endian
+ $(OUTPUT)/memcpy_64_t%:	memcpy_64.S $(EXTRA_SOURCES)
+ 	$(CC) $(CPPFLAGS) $(CFLAGS) \
+ 		-D COPY_LOOP=test_memcpy \
+ 		-D SELFTEST_CASE=$(subst memcpy_64_t,,$(notdir $@)) \
+ 		-o $@ $^
+ 
+ $(OUTPUT)/memcpy_p7_t%:	memcpy_power7.S $(EXTRA_SOURCES)
+ 	$(CC) $(CPPFLAGS) $(CFLAGS) \
+ 		-D COPY_LOOP=test_memcpy_power7 \
+ 		-D SELFTEST_CASE=$(subst memcpy_p7_t,,$(notdir $@)) \
+ 		-o $@ $^
+ 
+ $(OUTPUT)/memcpy_mcsafe_64: memcpy_mcsafe_64.S $(EXTRA_SOURCES)
+ 	$(CC) $(CPPFLAGS) $(CFLAGS) \
+ 		-D COPY_LOOP=test_memcpy_mcsafe \
+ 		-o $@ $^
+ 
+ $(OUTPUT)/copyuser_64_exc_t%: copyuser_64.S exc_validate.c ../harness.c \
+ 		copy_tofrom_user_reference.S stubs.S
+ 	$(CC) $(CPPFLAGS) $(CFLAGS) \
+ 		-D COPY_LOOP=test___copy_tofrom_user_base \
+ 		-D SELFTEST_CASE=$(subst copyuser_64_exc_t,,$(notdir $@)) \
+ 		-o $@ $^
++>>>>>>> 6f62a8223e65 (seltests/powerpc: Add a selftest for memcpy_mcsafe)
diff --cc tools/testing/selftests/powerpc/copyloops/asm/export.h
index 0bab35f6777a,e6b80d5fbd14..000000000000
--- a/tools/testing/selftests/powerpc/copyloops/asm/export.h
+++ b/tools/testing/selftests/powerpc/copyloops/asm/export.h
@@@ -1,2 -1,4 +1,7 @@@
  /* SPDX-License-Identifier: GPL-2.0 */
  #define EXPORT_SYMBOL(x)
++<<<<<<< HEAD
++=======
+ #define EXPORT_SYMBOL_GPL(x)
+ #define EXPORT_SYMBOL_KASAN(x)
++>>>>>>> 6f62a8223e65 (seltests/powerpc: Add a selftest for memcpy_mcsafe)
* Unmerged path tools/testing/selftests/powerpc/copyloops/.gitignore
* Unmerged path tools/testing/selftests/powerpc/copyloops/Makefile
* Unmerged path tools/testing/selftests/powerpc/copyloops/asm/export.h
diff --git a/tools/testing/selftests/powerpc/copyloops/memcpy_mcsafe_64.S b/tools/testing/selftests/powerpc/copyloops/memcpy_mcsafe_64.S
new file mode 120000
index 000000000000..f0feef3062f6
--- /dev/null
+++ b/tools/testing/selftests/powerpc/copyloops/memcpy_mcsafe_64.S
@@ -0,0 +1 @@
+../../../../../arch/powerpc/lib/memcpy_mcsafe_64.S
\ No newline at end of file
