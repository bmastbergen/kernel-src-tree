netlink: replace __NLA_ENSURE implementation

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-193.el8
commit-author Johannes Berg <johannes.berg@intel.com>
commit 5886d932e52acfbe12ea5aac8e7c3ad6f16364d1
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-193.el8/5886d932.failed

We already have BUILD_BUG_ON_ZERO() which I just hadn't found
before, so we should use it here instead of open-coding another
implementation thereof.

	Signed-off-by: Johannes Berg <johannes.berg@intel.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 5886d932e52acfbe12ea5aac8e7c3ad6f16364d1)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	include/net/netlink.h
diff --cc include/net/netlink.h
index a87ec367a90a,4c1e99303b5a..000000000000
--- a/include/net/netlink.h
+++ b/include/net/netlink.h
@@@ -270,6 -311,44 +270,47 @@@ struct nla_policy 
  #define NLA_POLICY_NESTED_ARRAY(maxattr, policy) \
  	{ .type = NLA_NESTED_ARRAY, .validation_data = policy, .len = maxattr }
  
++<<<<<<< HEAD
++=======
+ #define __NLA_ENSURE(condition) BUILD_BUG_ON_ZERO(!(condition))
+ #define NLA_ENSURE_INT_TYPE(tp)				\
+ 	(__NLA_ENSURE(tp == NLA_S8 || tp == NLA_U8 ||	\
+ 		      tp == NLA_S16 || tp == NLA_U16 ||	\
+ 		      tp == NLA_S32 || tp == NLA_U32 ||	\
+ 		      tp == NLA_S64 || tp == NLA_U64) + tp)
+ #define NLA_ENSURE_NO_VALIDATION_PTR(tp)		\
+ 	(__NLA_ENSURE(tp != NLA_BITFIELD32 &&		\
+ 		      tp != NLA_REJECT &&		\
+ 		      tp != NLA_NESTED &&		\
+ 		      tp != NLA_NESTED_ARRAY) + tp)
+ 
+ #define NLA_POLICY_RANGE(tp, _min, _max) {		\
+ 	.type = NLA_ENSURE_INT_TYPE(tp),		\
+ 	.validation_type = NLA_VALIDATE_RANGE,		\
+ 	.min = _min,					\
+ 	.max = _max					\
+ }
+ 
+ #define NLA_POLICY_MIN(tp, _min) {			\
+ 	.type = NLA_ENSURE_INT_TYPE(tp),		\
+ 	.validation_type = NLA_VALIDATE_MIN,		\
+ 	.min = _min,					\
+ }
+ 
+ #define NLA_POLICY_MAX(tp, _max) {			\
+ 	.type = NLA_ENSURE_INT_TYPE(tp),		\
+ 	.validation_type = NLA_VALIDATE_MAX,		\
+ 	.max = _max,					\
+ }
+ 
+ #define NLA_POLICY_VALIDATE_FN(tp, fn, ...) {		\
+ 	.type = NLA_ENSURE_NO_VALIDATION_PTR(tp),	\
+ 	.validation_type = NLA_VALIDATE_FUNCTION,	\
+ 	.validate = fn,					\
+ 	.len = __VA_ARGS__ + 0,				\
+ }
+ 
++>>>>>>> 5886d932e52a (netlink: replace __NLA_ENSURE implementation)
  /**
   * struct nl_info - netlink source information
   * @nlh: Netlink message header of original request
* Unmerged path include/net/netlink.h
