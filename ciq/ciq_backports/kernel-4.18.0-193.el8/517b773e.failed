RDMA/nldev: Share with user-space object IDs

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-193.el8
commit-author Leon Romanovsky <leon@kernel.org>
commit 517b773e0f612d608cbc62a08c55601bd56f73f6
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-193.el8/517b773e.failed

Give to the user space tools unique identifier for PD, MR, CQ and CM_ID
objects, so they can be able to query on them with .doit callbacks.

QP .doit is not supported yet, till all drivers will be updated to provide
their LQPN to be equal to their restrack ID.

	Signed-off-by: Leon Romanovsky <leonro@mellanox.com>
	Signed-off-by: Jason Gunthorpe <jgg@mellanox.com>
(cherry picked from commit 517b773e0f612d608cbc62a08c55601bd56f73f6)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/infiniband/core/nldev.c
diff --cc drivers/infiniband/core/nldev.c
index efccd8e0fb77,81d7ee3dcb20..000000000000
--- a/drivers/infiniband/core/nldev.c
+++ b/drivers/infiniband/core/nldev.c
@@@ -920,21 -908,32 +936,44 @@@ static const struct nldev_fill_res_entr
  		.fill_res_func = fill_res_cm_id_entry,
  		.nldev_cmd = RDMA_NLDEV_CMD_RES_CM_ID_GET,
  		.nldev_attr = RDMA_NLDEV_ATTR_RES_CM_ID,
++<<<<<<< HEAD
++=======
+ 		.entry = RDMA_NLDEV_ATTR_RES_CM_ID_ENTRY,
+ 		.id = RDMA_NLDEV_ATTR_RES_CM_IDN,
++>>>>>>> 517b773e0f61 (RDMA/nldev: Share with user-space object IDs)
  	},
  	[RDMA_RESTRACK_CQ] = {
  		.fill_res_func = fill_res_cq_entry,
  		.nldev_cmd = RDMA_NLDEV_CMD_RES_CQ_GET,
  		.nldev_attr = RDMA_NLDEV_ATTR_RES_CQ,
++<<<<<<< HEAD
++=======
+ 		.flags = NLDEV_PER_DEV,
+ 		.entry = RDMA_NLDEV_ATTR_RES_CQ_ENTRY,
+ 		.id = RDMA_NLDEV_ATTR_RES_CQN,
++>>>>>>> 517b773e0f61 (RDMA/nldev: Share with user-space object IDs)
  	},
  	[RDMA_RESTRACK_MR] = {
  		.fill_res_func = fill_res_mr_entry,
  		.nldev_cmd = RDMA_NLDEV_CMD_RES_MR_GET,
  		.nldev_attr = RDMA_NLDEV_ATTR_RES_MR,
++<<<<<<< HEAD
++=======
+ 		.flags = NLDEV_PER_DEV,
+ 		.entry = RDMA_NLDEV_ATTR_RES_MR_ENTRY,
+ 		.id = RDMA_NLDEV_ATTR_RES_MRN,
++>>>>>>> 517b773e0f61 (RDMA/nldev: Share with user-space object IDs)
  	},
  	[RDMA_RESTRACK_PD] = {
  		.fill_res_func = fill_res_pd_entry,
  		.nldev_cmd = RDMA_NLDEV_CMD_RES_PD_GET,
  		.nldev_attr = RDMA_NLDEV_ATTR_RES_PD,
++<<<<<<< HEAD
++=======
+ 		.flags = NLDEV_PER_DEV,
+ 		.entry = RDMA_NLDEV_ATTR_RES_PD_ENTRY,
+ 		.id = RDMA_NLDEV_ATTR_RES_PDN,
++>>>>>>> 517b773e0f61 (RDMA/nldev: Share with user-space object IDs)
  	},
  };
  
* Unmerged path drivers/infiniband/core/nldev.c
diff --git a/include/uapi/rdma/rdma_netlink.h b/include/uapi/rdma/rdma_netlink.h
index 3a9e681e4257..43362132e0d7 100644
--- a/include/uapi/rdma/rdma_netlink.h
+++ b/include/uapi/rdma/rdma_netlink.h
@@ -456,6 +456,15 @@ enum rdma_nldev_attr {
 	RDMA_NLDEV_ATTR_DRIVER_S64,		/* s64 */
 	RDMA_NLDEV_ATTR_DRIVER_U64,		/* u64 */
 
+	/*
+	 * Indexes to get/set secific entry,
+	 * for QP use RDMA_NLDEV_ATTR_RES_LQPN
+	 */
+	RDMA_NLDEV_ATTR_RES_PDN,               /* u32 */
+	RDMA_NLDEV_ATTR_RES_CQN,               /* u32 */
+	RDMA_NLDEV_ATTR_RES_MRN,               /* u32 */
+	RDMA_NLDEV_ATTR_RES_CM_IDN,            /* u32 */
+
 	/*
 	 * Always the end
 	 */
