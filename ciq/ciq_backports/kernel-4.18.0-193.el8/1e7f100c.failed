drm/amd/display: fix trigger not generated for freesync

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-193.el8
commit-author Yogesh Mohan Marimuthu <yogesh.mohanmarimuthu@amd.com>
commit 1e7f100ce8c0640634b794604880d9204480c9f1
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-193.el8/1e7f100c.failed

[Why]
In newer hardware MANUAL_FLOW_CONTROL is not a trigger bit. Due to this
front porch is fixed and in these hardware freesync does not work.

[How]
Change the programming to generate a pulse so that the event will be
triggered, front porch will be cut short and freesync will work.

	Signed-off-by: Yogesh Mohan Marimuthu <yogesh.mohanmarimuthu@amd.com>
	Reviewed-by: Anthony Koo <Anthony.Koo@amd.com>
	Acked-by: Bhawanpreet Lakha <Bhawanpreet.Lakha@amd.com>
	Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
(cherry picked from commit 1e7f100ce8c0640634b794604880d9204480c9f1)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/gpu/drm/amd/display/dc/dcn10/dcn10_optc.c
diff --cc drivers/gpu/drm/amd/display/dc/dcn10/dcn10_optc.c
index 0345d51e9d6f,e98e6bab4808..000000000000
--- a/drivers/gpu/drm/amd/display/dc/dcn10/dcn10_optc.c
+++ b/drivers/gpu/drm/amd/display/dc/dcn10/dcn10_optc.c
@@@ -754,6 -801,35 +754,38 @@@ void optc1_set_static_screen_control
  			OTG_STATIC_SCREEN_FRAME_COUNT, 2);
  }
  
++<<<<<<< HEAD
++=======
+ void optc1_setup_manual_trigger(struct timing_generator *optc)
+ {
+ 	struct optc *optc1 = DCN10TG_FROM_TG(optc);
+ 
+ 	REG_SET(OTG_GLOBAL_CONTROL2, 0,
+ 			MANUAL_FLOW_CONTROL_SEL, optc->inst);
+ 
+ 	REG_SET_8(OTG_TRIGA_CNTL, 0,
+ 			OTG_TRIGA_SOURCE_SELECT, 22,
+ 			OTG_TRIGA_SOURCE_PIPE_SELECT, optc->inst,
+ 			OTG_TRIGA_RISING_EDGE_DETECT_CNTL, 1,
+ 			OTG_TRIGA_FALLING_EDGE_DETECT_CNTL, 0,
+ 			OTG_TRIGA_POLARITY_SELECT, 0,
+ 			OTG_TRIGA_FREQUENCY_SELECT, 0,
+ 			OTG_TRIGA_DELAY, 0,
+ 			OTG_TRIGA_CLEAR, 1);
+ }
+ 
+ void optc1_program_manual_trigger(struct timing_generator *optc)
+ {
+ 	struct optc *optc1 = DCN10TG_FROM_TG(optc);
+ 
+ 	REG_SET(OTG_MANUAL_FLOW_CONTROL, 0,
+ 			MANUAL_FLOW_CONTROL, 1);
+ 
+ 	REG_SET(OTG_MANUAL_FLOW_CONTROL, 0,
+ 			MANUAL_FLOW_CONTROL, 0);
+ }
+ 
++>>>>>>> 1e7f100ce8c0 (drm/amd/display: fix trigger not generated for freesync)
  
  /**
   *****************************************************************************
* Unmerged path drivers/gpu/drm/amd/display/dc/dcn10/dcn10_optc.c
