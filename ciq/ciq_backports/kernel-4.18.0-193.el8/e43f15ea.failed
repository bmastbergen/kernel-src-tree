PCI/PM: Decode D3cold power state correctly

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-193.el8
commit-author Bjorn Helgaas <bhelgaas@google.com>
commit e43f15ea2f6d6858675fa1baa5cb624f17269af0
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-193.el8/e43f15ea.failed

Use pci_power_name() to print pci_power_t correctly.  This changes:

  "state 0" or "D0"   to   "D0"
  "state 1" or "D1"   to   "D1"
  "state 2" or "D2"   to   "D2"
  "state 3" or "D3"   to   "D3hot"
  "state 4" or "D4"   to   "D3cold"

Changes dmesg logging only, no other functional change intended.

Link: https://lore.kernel.org/r/20190822200551.129039-3-helgaas@kernel.org
	Signed-off-by: Bjorn Helgaas <bhelgaas@google.com>
	Reviewed-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>
	Reviewed-by: Keith Busch <kbusch@kernel.org>
	Reviewed-by: Mika Westerberg <mika.westerberg@linux.intel.com>
(cherry picked from commit e43f15ea2f6d6858675fa1baa5cb624f17269af0)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/pci/pci.c
diff --cc drivers/pci/pci.c
index 811e89657235,3376c663035d..000000000000
--- a/drivers/pci/pci.c
+++ b/drivers/pci/pci.c
@@@ -832,9 -833,11 +832,17 @@@ static int pci_raw_set_power_state(stru
  	if (state < PCI_D0 || state > PCI_D3hot)
  		return -EINVAL;
  
++<<<<<<< HEAD
 +	/* Validate current state:
 +	 * Can enter D0 from any state, but if we can only go deeper
 +	 * to sleep if we're already in a low power state
++=======
+ 	/*
+ 	 * Validate transition: We can enter D0 from any state, but if
+ 	 * we're already in a low-power state, we can only go deeper.  E.g.,
+ 	 * we can go from D1 to D3, but we can't go directly from D3 to D1;
+ 	 * we'd have to go from D3 to D0, then to D1.
++>>>>>>> e43f15ea2f6d (PCI/PM: Decode D3cold power state correctly)
  	 */
  	if (state != PCI_D0 && dev->current_state <= PCI_D3cold
  	    && dev->current_state > state) {
@@@ -885,9 -892,10 +894,16 @@@
  
  	pci_read_config_word(dev, dev->pm_cap + PCI_PM_CTRL, &pmcsr);
  	dev->current_state = (pmcsr & PCI_PM_CTRL_STATE_MASK);
++<<<<<<< HEAD
 +	if (dev->current_state != state && printk_ratelimit())
 +		pci_info(dev, "Refused to change power state, currently in D%d\n",
 +			 dev->current_state);
++=======
+ 	if (dev->current_state != state)
+ 		pci_info_ratelimited(dev, "refused to change power state from %s to %s\n",
+ 			 pci_power_name(dev->current_state),
+ 			 pci_power_name(state));
++>>>>>>> e43f15ea2f6d (PCI/PM: Decode D3cold power state correctly)
  
  	/*
  	 * According to section 5.4.1 of the "PCI BUS POWER MANAGEMENT
* Unmerged path drivers/pci/pci.c
