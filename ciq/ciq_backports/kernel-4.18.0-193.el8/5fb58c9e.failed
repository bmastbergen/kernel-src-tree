RDMA/mlx5: Don't create IB representors when in multiport RoCE mode

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-193.el8
commit-author Mark Bloch <markb@mellanox.com>
commit 5fb58c9e2fb11edd12379b20be01ee54a7bac026
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-193.el8/5fb58c9e.failed

Switchdev mode and mutiport RoCE mode aren't compatible at this point.
Don't create IB reps when a user switches to switchdev mode and the driver
operates in that mode.

	Signed-off-by: Mark Bloch <markb@mellanox.com>
	Signed-off-by: Leon Romanovsky <leonro@mellanox.com>
	Signed-off-by: Jason Gunthorpe <jgg@mellanox.com>
(cherry picked from commit 5fb58c9e2fb11edd12379b20be01ee54a7bac026)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/infiniband/hw/mlx5/main.c
diff --cc drivers/infiniband/hw/mlx5/main.c
index 4d780fff17de,d40c39434637..000000000000
--- a/drivers/infiniband/hw/mlx5/main.c
+++ b/drivers/infiniband/hw/mlx5/main.c
@@@ -6596,6 -6627,14 +6596,16 @@@ static void *mlx5_ib_add(struct mlx5_co
  
  	printk_once(KERN_INFO "%s", mlx5_version);
  
++<<<<<<< HEAD
++=======
+ 	if (MLX5_ESWITCH_MANAGER(mdev) &&
+ 	    mlx5_ib_eswitch_mode(mdev->priv.eswitch) == SRIOV_OFFLOADS) {
+ 		if (!mlx5_core_mp_enabled(mdev))
+ 			mlx5_ib_register_vport_reps(mdev);
+ 		return mdev;
+ 	}
+ 
++>>>>>>> 5fb58c9e2fb1 (RDMA/mlx5: Don't create IB representors when in multiport RoCE mode)
  	port_type_cap = MLX5_CAP_GEN(mdev, port_type);
  	ll = mlx5_port_type_cap_to_rdma_ll(port_type_cap);
  
* Unmerged path drivers/infiniband/hw/mlx5/main.c
