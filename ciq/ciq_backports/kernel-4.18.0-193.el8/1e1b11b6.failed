nl80211/cfg80211: Specify band specific min RSSI thresholds with sched scan

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-193.el8
commit-author vamsi krishna <vamsin@codeaurora.org>
commit 1e1b11b6a1111cd9e8af1fd6ccda270a9fa3eacf
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-193.el8/1e1b11b6.failed

This commit adds the support to specify the RSSI thresholds per
band for each match set. This enhances the current behavior which
specifies a single rssi_threshold across all the bands by
introducing the rssi_threshold_per_band. These per band rssi
thresholds are referred through NL80211_BAND_* (enum nl80211_band)
variables  as attribute types. Such attributes/values per each
band are nested through NL80211_ATTR_SCHED_SCAN_MIN_RSSI.
These band specific rssi thresholds shall take precedence over
the current rssi_thold per match set.
Drivers indicate this support through
%NL80211_EXT_FEATURE_SCHED_SCAN_BAND_SPECIFIC_RSSI_THOLD.
These per band rssi attributes/values does not specify
"default RSSI filter" as done by
NL80211_SCHED_SCAN_MATCH_ATTR_RSSI to stay backward compatible.
That said, these per band rssi values have to be specified for
the corresponding matchset.

	Signed-off-by: vamsi krishna <vamsin@codeaurora.org>
	Signed-off-by: Srinivas Dasari <dasaris@codeaurora.org>
[rebase on refactoring, add policy]
	Signed-off-by: Johannes Berg <johannes.berg@intel.com>
(cherry picked from commit 1e1b11b6a1111cd9e8af1fd6ccda270a9fa3eacf)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	include/uapi/linux/nl80211.h
#	net/wireless/nl80211.c
diff --cc include/uapi/linux/nl80211.h
index ce2530138aa4,4a9404958fbe..000000000000
--- a/include/uapi/linux/nl80211.h
+++ b/include/uapi/linux/nl80211.h
@@@ -5398,9 -5355,6 +5398,12 @@@ enum nl80211_feature_flags 
   * @NL80211_EXT_FEATURE_SCHED_SCAN_BAND_SPECIFIC_RSSI_THOLD: Driver supports
   *	filtering of sched scan results using band specific RSSI thresholds.
   *
++<<<<<<< HEAD
 + * @NL80211_EXT_FEATURE_STA_TX_PWR: This driver supports controlling tx power
 + *	to a station.
 + *
++=======
++>>>>>>> 1e1b11b6a111 (nl80211/cfg80211: Specify band specific min RSSI thresholds with sched scan)
   * @NUM_NL80211_EXT_FEATURES: number of extended features.
   * @MAX_NL80211_EXT_FEATURES: highest extended feature index.
   */
@@@ -5443,7 -5397,6 +5446,10 @@@ enum nl80211_ext_feature_index 
  	NL80211_EXT_FEATURE_AIRTIME_FAIRNESS,
  	NL80211_EXT_FEATURE_AP_PMKSA_CACHING,
  	NL80211_EXT_FEATURE_SCHED_SCAN_BAND_SPECIFIC_RSSI_THOLD,
++<<<<<<< HEAD
 +	NL80211_EXT_FEATURE_STA_TX_PWR,
++=======
++>>>>>>> 1e1b11b6a111 (nl80211/cfg80211: Specify band specific min RSSI thresholds with sched scan)
  
  	/* add new features before the definition below */
  	NUM_NL80211_EXT_FEATURES,
diff --cc net/wireless/nl80211.c
index 4e1c052bca2e,62f96d6c02f0..000000000000
--- a/net/wireless/nl80211.c
+++ b/net/wireless/nl80211.c
@@@ -589,7 -621,6 +589,10 @@@ static const struct nla_polic
  nl80211_match_band_rssi_policy[NUM_NL80211_BANDS] = {
  	[NL80211_BAND_2GHZ] = { .type = NLA_S32 },
  	[NL80211_BAND_5GHZ] = { .type = NLA_S32 },
++<<<<<<< HEAD
 +	[NL80211_BAND_6GHZ] = { .type = NLA_S32 },
++=======
++>>>>>>> 1e1b11b6a111 (nl80211/cfg80211: Specify band specific min RSSI thresholds with sched scan)
  	[NL80211_BAND_60GHZ] = { .type = NLA_S32 },
  };
  
@@@ -599,10 -630,8 +602,15 @@@ nl80211_match_policy[NL80211_SCHED_SCAN
  						 .len = IEEE80211_MAX_SSID_LEN },
  	[NL80211_SCHED_SCAN_MATCH_ATTR_BSSID] = { .len = ETH_ALEN },
  	[NL80211_SCHED_SCAN_MATCH_ATTR_RSSI] = { .type = NLA_U32 },
++<<<<<<< HEAD
 +#if 0 /* Not in RHEL */
 +	[NL80211_SCHED_SCAN_MATCH_PER_BAND_RSSI] =
 +		NLA_POLICY_NESTED(nl80211_match_band_rssi_policy),
 +#endif
++=======
+ 	[NL80211_SCHED_SCAN_MATCH_PER_BAND_RSSI] =
+ 		NLA_POLICY_NESTED(nl80211_match_band_rssi_policy),
++>>>>>>> 1e1b11b6a111 (nl80211/cfg80211: Specify band specific min RSSI thresholds with sched scan)
  };
  
  static const struct nla_policy
* Unmerged path include/uapi/linux/nl80211.h
* Unmerged path net/wireless/nl80211.c
