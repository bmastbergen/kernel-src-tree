vfio/type1: remove duplicate retrieval of reserved regions

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-193.el8
Rebuild_CHGLOG: - [vfio] type1: remove duplicate retrieval of reserved regions (Auger Eric) [1704597]
Rebuild_FUZZ: 95.50%
commit-author Shameer Kolothum <shameerali.kolothum.thodi@huawei.com>
commit b09d6e47397409faf12f72edd140956e4cfe3011
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-193.el8/b09d6e47.failed

As we now already have the reserved regions list, just pass that into
vfio_iommu_has_sw_msi() fn.

	Signed-off-by: Shameer Kolothum <shameerali.kolothum.thodi@huawei.com>
	Reviewed-by: Eric Auger <eric.auger@redhat.com>
	Signed-off-by: Alex Williamson <alex.williamson@redhat.com>
(cherry picked from commit b09d6e47397409faf12f72edd140956e4cfe3011)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/vfio/vfio_iommu_type1.c
diff --cc drivers/vfio/vfio_iommu_type1.c
index 504254d68095,a68405f24fbf..000000000000
--- a/drivers/vfio/vfio_iommu_type1.c
+++ b/drivers/vfio/vfio_iommu_type1.c
@@@ -1445,7 -1729,43 +1442,47 @@@ static int vfio_iommu_type1_attach_grou
  	if (ret)
  		goto out_domain;
  
++<<<<<<< HEAD
 +	resv_msi = vfio_iommu_has_sw_msi(iommu_group, &resv_msi_base);
++=======
+ 	/* Get aperture info */
+ 	iommu_domain_get_attr(domain->domain, DOMAIN_ATTR_GEOMETRY, &geo);
+ 
+ 	if (vfio_iommu_aper_conflict(iommu, geo.aperture_start,
+ 				     geo.aperture_end)) {
+ 		ret = -EINVAL;
+ 		goto out_detach;
+ 	}
+ 
+ 	ret = iommu_get_group_resv_regions(iommu_group, &group_resv_regions);
+ 	if (ret)
+ 		goto out_detach;
+ 
+ 	if (vfio_iommu_resv_conflict(iommu, &group_resv_regions)) {
+ 		ret = -EINVAL;
+ 		goto out_detach;
+ 	}
+ 
+ 	/*
+ 	 * We don't want to work on the original iova list as the list
+ 	 * gets modified and in case of failure we have to retain the
+ 	 * original list. Get a copy here.
+ 	 */
+ 	ret = vfio_iommu_iova_get_copy(iommu, &iova_copy);
+ 	if (ret)
+ 		goto out_detach;
+ 
+ 	ret = vfio_iommu_aper_resize(&iova_copy, geo.aperture_start,
+ 				     geo.aperture_end);
+ 	if (ret)
+ 		goto out_detach;
+ 
+ 	ret = vfio_iommu_resv_exclude(&iova_copy, &group_resv_regions);
+ 	if (ret)
+ 		goto out_detach;
+ 
+ 	resv_msi = vfio_iommu_has_sw_msi(&group_resv_regions, &resv_msi_base);
++>>>>>>> b09d6e473974 (vfio/type1: remove duplicate retrieval of reserved regions)
  
  	INIT_LIST_HEAD(&domain->group_list);
  	list_add(&group->next, &domain->group_list);
* Unmerged path drivers/vfio/vfio_iommu_type1.c
