drm/i915: Auto detect DPCD backlight support by default

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-193.el8
commit-author Lyude Paul <lyude@redhat.com>
commit 9ac7d53d70a2b4f43360e3aa0f14a2514339328f
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-193.el8/9ac7d53d.failed

Turns out we actually already have some companies, such as Lenovo,
shipping machines with AMOLED screens that don't allow controlling the
backlight through the usual PWM interface and only allow controlling it
through the standard EDP DPCD interface. One example of one of these
laptops is the X1 Extreme 2nd Generation.

Since we've got systems that need this turned on by default now to have
backlight controls working out of the box, let's start auto-detecting it
for systems by default based on what the VBT tells us. We do this by
changing the default value for the enable_dpcd_backlight module param
from 0 to -1.

	Tested-by: AceLan Kao <acelan.kao@canonical.com>
	Tested-by: Perry Yuan <pyuan@redhat.com>
	Signed-off-by: Lyude Paul <lyude@redhat.com>
	Signed-off-by: Jani Nikula <jani.nikula@intel.com>
Link: https://patchwork.freedesktop.org/patch/msgid/20200116211623.53799-6-lyude@redhat.com
(cherry picked from commit 9ac7d53d70a2b4f43360e3aa0f14a2514339328f)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/gpu/drm/i915/i915_params.c
#	drivers/gpu/drm/i915/i915_params.h
diff --cc drivers/gpu/drm/i915/i915_params.c
index b5be0abbba35,905decc36e53..000000000000
--- a/drivers/gpu/drm/i915/i915_params.c
+++ b/drivers/gpu/drm/i915/i915_params.c
@@@ -166,8 -170,9 +166,14 @@@ i915_param_named_unsafe(inject_load_fai
  	"Force an error after a number of failure check points (0:disabled (default), N:force failure at the Nth failure check point)");
  #endif
  
++<<<<<<< HEAD
 +i915_param_named(enable_dpcd_backlight, bool, 0600,
 +	"Enable support for DPCD backlight control (default:false)");
++=======
+ i915_param_named(enable_dpcd_backlight, int, 0600,
+ 	"Enable support for DPCD backlight control"
+ 	"(-1=use per-VBT LFP backlight type setting [default], 0=disabled, 1=enabled)");
++>>>>>>> 9ac7d53d70a2 (drm/i915: Auto detect DPCD backlight support by default)
  
  #if IS_ENABLED(CONFIG_DRM_I915_GVT)
  i915_param_named(enable_gvt, bool, 0400,
diff --cc drivers/gpu/drm/i915/i915_params.h
index 3f14e9881a0d,947d0a38fa3c..000000000000
--- a/drivers/gpu/drm/i915/i915_params.h
+++ b/drivers/gpu/drm/i915/i915_params.h
@@@ -36,47 -36,51 +36,74 @@@ struct drm_printer
  /*
   * Invoke param, a function-like macro, for each i915 param, with arguments:
   *
 - * param(type, name, value, mode)
 + * param(type, name, value)
   *
 - * type: parameter type, one of {bool, int, unsigned int, unsigned long, char *}
 + * type: parameter type, one of {bool, int, unsigned int, char *}
   * name: name of the parameter
   * value: initial/default value of the parameter
 - * mode: debugfs file permissions, one of {0400, 0600, 0}, use 0 to not create
 - *       debugfs file
   */
  #define I915_PARAMS_FOR_EACH(param) \
++<<<<<<< HEAD
 +	param(char *, vbt_firmware, NULL) \
 +	param(int, modeset, -1) \
 +	param(int, lvds_channel_mode, 0) \
 +	param(int, panel_use_ssc, -1) \
 +	param(int, vbt_sdvo_panel_type, -1) \
 +	param(int, enable_dc, -1) \
 +	param(int, enable_fbc, -1) \
 +	param(int, enable_psr, -1) \
 +	param(int, disable_power_well, -1) \
 +	param(int, enable_ips, 1) \
 +	param(int, invert_brightness, 0) \
 +	param(int, enable_guc, 0) \
 +	param(int, guc_log_level, -1) \
 +	param(char *, guc_firmware_path, NULL) \
 +	param(char *, huc_firmware_path, NULL) \
 +	param(char *, dmc_firmware_path, NULL) \
 +	param(int, mmio_debug, 0) \
 +	param(int, edp_vswing, 0) \
 +	param(int, reset, 2) \
 +	param(unsigned int, inject_load_failure, 0) \
 +	param(int, fastboot, -1) \
++=======
+ 	param(char *, vbt_firmware, NULL, 0400) \
+ 	param(int, modeset, -1, 0400) \
+ 	param(int, lvds_channel_mode, 0, 0400) \
+ 	param(int, panel_use_ssc, -1, 0600) \
+ 	param(int, vbt_sdvo_panel_type, -1, 0400) \
+ 	param(int, enable_dc, -1, 0400) \
+ 	param(int, enable_fbc, -1, 0600) \
+ 	param(int, enable_psr, -1, 0600) \
+ 	param(int, disable_power_well, -1, 0400) \
+ 	param(int, enable_ips, 1, 0600) \
+ 	param(int, invert_brightness, 0, 0600) \
+ 	param(int, enable_guc, 0, 0400) \
+ 	param(int, guc_log_level, -1, 0400) \
+ 	param(char *, guc_firmware_path, NULL, 0400) \
+ 	param(char *, huc_firmware_path, NULL, 0400) \
+ 	param(char *, dmc_firmware_path, NULL, 0400) \
+ 	param(int, mmio_debug, -IS_ENABLED(CONFIG_DRM_I915_DEBUG_MMIO), 0600) \
+ 	param(int, edp_vswing, 0, 0400) \
+ 	param(int, reset, 3, 0600) \
+ 	param(unsigned int, inject_probe_failure, 0, 0600) \
+ 	param(int, fastboot, -1, 0600) \
+ 	param(int, enable_dpcd_backlight, -1, 0600) \
+ 	param(char *, force_probe, CONFIG_DRM_I915_FORCE_PROBE, 0400) \
+ 	param(unsigned long, fake_lmem_start, 0, 0400) \
++>>>>>>> 9ac7d53d70a2 (drm/i915: Auto detect DPCD backlight support by default)
  	/* leave bools at the end to not create holes */ \
 -	param(bool, alpha_support, IS_ENABLED(CONFIG_DRM_I915_ALPHA_SUPPORT), 0400) \
 -	param(bool, enable_hangcheck, true, 0600) \
 -	param(bool, prefault_disable, false, 0600) \
 -	param(bool, load_detect_test, false, 0600) \
 -	param(bool, force_reset_modeset_test, false, 0600) \
 -	param(bool, error_capture, true, 0600) \
 -	param(bool, disable_display, false, 0400) \
 -	param(bool, verbose_state_checks, true, 0) \
 -	param(bool, nuclear_pageflip, false, 0400) \
 -	param(bool, enable_dp_mst, true, 0600) \
 -	param(bool, enable_gvt, false, 0400)
 +	param(bool, alpha_support, IS_ENABLED(CONFIG_DRM_I915_ALPHA_SUPPORT)) \
 +	param(bool, enable_hangcheck, true) \
 +	param(bool, prefault_disable, false) \
 +	param(bool, load_detect_test, false) \
 +	param(bool, force_reset_modeset_test, false) \
 +	param(bool, error_capture, true) \
 +	param(bool, disable_display, false) \
 +	param(bool, verbose_state_checks, true) \
 +	param(bool, nuclear_pageflip, false) \
 +	param(bool, enable_dp_mst, true) \
 +	param(bool, enable_dpcd_backlight, false) \
 +	param(bool, enable_gvt, false)
  
  #define MEMBER(T, member, ...) T member;
  struct i915_params {
* Unmerged path drivers/gpu/drm/i915/i915_params.c
* Unmerged path drivers/gpu/drm/i915/i915_params.h
