ALSA: fireworks: code refactoring for initialization/destruction of AMDTP streams

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-193.el8
commit-author Takashi Sakamoto <o-takashi@sakamocchi.jp>
commit 94491c175d6bf4b838043a3fb5adabd731d8fbab
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-193.el8/94491c17.failed

This commit is a preparation to support AMDTP domain.

	Signed-off-by: Takashi Sakamoto <o-takashi@sakamocchi.jp>
	Signed-off-by: Takashi Iwai <tiwai@suse.de>
(cherry picked from commit 94491c175d6bf4b838043a3fb5adabd731d8fbab)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	sound/firewire/fireworks/fireworks_stream.c
diff --cc sound/firewire/fireworks/fireworks_stream.c
index e659a0b89ba5,0f62c50055e9..000000000000
--- a/sound/firewire/fireworks/fireworks_stream.c
+++ b/sound/firewire/fireworks/fireworks_stream.c
@@@ -131,28 -147,7 +147,32 @@@ int snd_efw_stream_init_duplex(struct s
  
  	err = init_stream(efw, &efw->tx_stream);
  	if (err < 0)
++<<<<<<< HEAD
 +		goto end;
 +	/* Fireworks transmits NODATA packets with TAG0. */
 +	efw->tx_stream.flags |= CIP_EMPTY_WITH_TAG0;
 +	/* Fireworks has its own meaning for dbc. */
 +	efw->tx_stream.flags |= CIP_DBC_IS_END_EVENT;
 +	/* Fireworks reset dbc at bus reset. */
 +	efw->tx_stream.flags |= CIP_SKIP_DBC_ZERO_CHECK;
 +	/*
 +	 * But Recent firmwares starts packets with non-zero dbc.
 +	 * Driver version 5.7.6 installs firmware version 5.7.3.
 +	 */
 +	if (efw->is_fireworks3 &&
 +	    (efw->firmware_version == 0x5070000 ||
 +	     efw->firmware_version == 0x5070300 ||
 +	     efw->firmware_version == 0x5080000))
 +		efw->tx_stream.ctx_data.tx.first_dbc = 0x02;
 +	/* AudioFire9 always reports wrong dbs. */
 +	if (efw->is_af9)
 +		efw->tx_stream.flags |= CIP_WRONG_DBS;
 +	/* Firmware version 5.5 reports fixed interval for dbc. */
 +	if (efw->firmware_version == 0x5050000)
 +		efw->tx_stream.ctx_data.tx.dbc_interval = 8;
++=======
+ 		return err;
++>>>>>>> 94491c175d6b (ALSA: fireworks: code refactoring for initialization/destruction of AMDTP streams)
  
  	err = init_stream(efw, &efw->rx_stream);
  	if (err < 0) {
* Unmerged path sound/firewire/fireworks/fireworks_stream.c
