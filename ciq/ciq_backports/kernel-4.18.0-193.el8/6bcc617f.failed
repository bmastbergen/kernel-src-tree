selftests/bpf: build tests with debug info

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-193.el8
commit-author Andrii Nakryiko <andriin@fb.com>
commit 6bcc617f842cdb5f3d66b3a3f06614a62fab992b
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-193.el8/6bcc617f.failed

Non-BPF (user land) part of selftests is built without debug info making
occasional debugging with gdb terrible. Build with debug info always.

	Signed-off-by: Andrii Nakryiko <andriin@fb.com>
	Signed-off-by: Daniel Borkmann <daniel@iogearbox.net>
(cherry picked from commit 6bcc617f842cdb5f3d66b3a3f06614a62fab992b)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	tools/testing/selftests/bpf/Makefile
diff --cc tools/testing/selftests/bpf/Makefile
index 9bfa8b025d92,faeb8220daa2..000000000000
--- a/tools/testing/selftests/bpf/Makefile
+++ b/tools/testing/selftests/bpf/Makefile
@@@ -10,15 -10,16 +10,26 @@@ ifneq ($(wildcard $(GENHDR)),
    GENFLAGS := -DHAVE_GENHDR
  endif
  
++<<<<<<< HEAD
 +CFLAGS += -Wall -O2 -I$(APIDIR) -I$(LIBDIR) -I$(BPFDIR) -I$(GENDIR) $(GENFLAGS) -I../../../include
++=======
+ CLANG		?= clang
+ LLC		?= llc
+ LLVM_OBJCOPY	?= llvm-objcopy
+ LLVM_READELF	?= llvm-readelf
+ BTF_PAHOLE	?= pahole
+ CFLAGS += -g -Wall -O2 -I$(APIDIR) -I$(LIBDIR) -I$(BPFDIR) -I$(GENDIR) $(GENFLAGS) -I../../../include \
+ 	  -Dbpf_prog_load=bpf_prog_test_load \
+ 	  -Dbpf_load_program=bpf_test_load_program
++>>>>>>> 6bcc617f842c (selftests/bpf: build tests with debug info)
  LDLIBS += -lcap -lelf -lrt -lpthread
  
 +TEST_CUSTOM_PROGS = $(OUTPUT)/urandom_read
 +all: $(TEST_CUSTOM_PROGS)
 +
 +$(TEST_CUSTOM_PROGS): $(OUTPUT)/%: %.c
 +	$(CC) -o $(TEST_CUSTOM_PROGS) $< -Wl,--build-id
 +
  # Order correspond to 'make run_tests' order
  TEST_GEN_PROGS = test_verifier test_tag test_maps test_lru_map test_lpm_map test_progs \
  	test_align test_verifier_log test_dev_cgroup test_tcpbpf_user \
* Unmerged path tools/testing/selftests/bpf/Makefile
