ASoC: Intel: Skylake: Remove static table index when parsing topology

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-193.el8
Rebuild_CHGLOG: - [sound] ALSA: ASoC: Intel: Skylake: Remove static table index when parsing topology (Jaroslav Kysela) [1738610]
Rebuild_FUZZ: 95.83%
commit-author Amadeusz Sławiński <amadeuszx.slawinski@linux.intel.com>
commit 096769ea95380ef3048765aef676e8947bc368d4
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-193.el8/096769ea.failed

Currently when we remove and reload driver we use previous ref_count
value to start iterating over skl->modules which leads to out of table
access. To fix this just inline the function and calculate indexes
everytime we parse UUID token.

	Signed-off-by: Amadeusz Sławiński <amadeuszx.slawinski@linux.intel.com>
	Reviewed-by: Pierre-Louis Bossart <pierre-louis.bossart@linux.intel.com>
Link: https://lore.kernel.org/r/20190726090929.27946-2-amadeuszx.slawinski@linux.intel.com
	Signed-off-by: Mark Brown <broonie@kernel.org>
(cherry picked from commit 096769ea95380ef3048765aef676e8947bc368d4)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	sound/soc/intel/skylake/skl-topology.c
diff --cc sound/soc/intel/skylake/skl-topology.c
index c1a64d6597c2,c1c37ce759bd..000000000000
--- a/sound/soc/intel/skylake/skl-topology.c
+++ b/sound/soc/intel/skylake/skl-topology.c
@@@ -3463,25 -3333,6 +3463,28 @@@ static int skl_tplg_get_int_tkn(struct 
  	return tkn_count;
  }
  
++<<<<<<< HEAD
 +static int skl_tplg_get_manifest_uuid(struct device *dev,
 +				struct skl *skl,
 +				struct snd_soc_tplg_vendor_uuid_elem *uuid_tkn)
 +{
 +	static int ref_count;
 +	struct skl_module *mod;
 +
 +	if (uuid_tkn->token == SKL_TKN_UUID) {
 +		mod = skl->modules[ref_count];
 +		guid_copy(&mod->uuid, (guid_t *)&uuid_tkn->uuid);
 +		ref_count++;
 +	} else {
 +		dev_err(dev, "Not an UUID token tkn %d\n", uuid_tkn->token);
 +		return -EINVAL;
 +	}
 +
 +	return 0;
 +}
 +
++=======
++>>>>>>> 096769ea9538 (ASoC: Intel: Skylake: Remove static table index when parsing topology)
  /*
   * Fill the manifest structure by parsing the tokens based on the
   * type.
* Unmerged path sound/soc/intel/skylake/skl-topology.c
