mt76: mmio: move mt76x02_set_irq_mask in mt76 module

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-193.el8
commit-author Lorenzo Bianconi <lorenzo@kernel.org>
commit 9220f695c17b8b82ee97a38b5f11f85abdfde1e6
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-193.el8/9220f695.failed

Move mt76x02_set_irq_mask in mt76 module in order to be reused
adding support for mt7603 driver and remove duplicated code

	Signed-off-by: Lorenzo Bianconi <lorenzo@kernel.org>
	Signed-off-by: Felix Fietkau <nbd@nbd.name>
(cherry picked from commit 9220f695c17b8b82ee97a38b5f11f85abdfde1e6)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/wireless/mediatek/mt76/mt76x02.h
diff --cc drivers/net/wireless/mediatek/mt76/mt76x02.h
index f7fd53a1738a,9f972eeab914..000000000000
--- a/drivers/net/wireless/mediatek/mt76/mt76x02.h
+++ b/drivers/net/wireless/mediatek/mt76/mt76x02.h
@@@ -192,19 -185,8 +192,22 @@@ void mt76x02_bss_info_changed(struct ie
  			      struct ieee80211_vif *vif,
  			      struct ieee80211_bss_conf *info, u32 changed);
  
 -extern const u16 mt76x02_beacon_offsets[16];
 +struct beacon_bc_data {
 +	struct mt76x02_dev *dev;
 +	struct sk_buff_head q;
 +	struct sk_buff *tail[8];
 +};
  void mt76x02_init_beacon_config(struct mt76x02_dev *dev);
++<<<<<<< HEAD
 +void mt76x02e_init_beacon_config(struct mt76x02_dev *dev);
 +void mt76x02_resync_beacon_timer(struct mt76x02_dev *dev);
 +void mt76x02_update_beacon_iter(void *priv, u8 *mac, struct ieee80211_vif *vif);
 +void mt76x02_enqueue_buffered_bc(struct mt76x02_dev *dev,
 +				 struct beacon_bc_data *data,
 +				 int max_nframes);
 +
++=======
++>>>>>>> 9220f695c17b (mt76: mmio: move mt76x02_set_irq_mask in mt76 module)
  void mt76x02_mac_start(struct mt76x02_dev *dev);
  
  void mt76x02_init_debugfs(struct mt76x02_dev *dev);
diff --git a/drivers/net/wireless/mediatek/mt76/mt7603/core.c b/drivers/net/wireless/mediatek/mt76/mt7603/core.c
index 1086dcd376a0..e32a16f2ebe8 100644
--- a/drivers/net/wireless/mediatek/mt76/mt7603/core.c
+++ b/drivers/net/wireless/mediatek/mt76/mt7603/core.c
@@ -2,17 +2,6 @@
 
 #include "mt7603.h"
 
-void mt7603_set_irq_mask(struct mt7603_dev *dev, u32 clear, u32 set)
-{
-	unsigned long flags;
-
-	spin_lock_irqsave(&dev->mt76.mmio.irq_lock, flags);
-	dev->mt76.mmio.irqmask &= ~clear;
-	dev->mt76.mmio.irqmask |= set;
-	mt76_wr(dev, MT_INT_MASK_CSR, dev->mt76.mmio.irqmask);
-	spin_unlock_irqrestore(&dev->mt76.mmio.irq_lock, flags);
-}
-
 void mt7603_rx_poll_complete(struct mt76_dev *mdev, enum mt76_rxq_id q)
 {
 	struct mt7603_dev *dev = container_of(mdev, struct mt7603_dev, mt76);
diff --git a/drivers/net/wireless/mediatek/mt76/mt7603/mt7603.h b/drivers/net/wireless/mediatek/mt76/mt7603/mt7603.h
index 6049f3b7c8fe..3273e9f4fb0e 100644
--- a/drivers/net/wireless/mediatek/mt76/mt7603/mt7603.h
+++ b/drivers/net/wireless/mediatek/mt76/mt7603/mt7603.h
@@ -179,16 +179,14 @@ void mt7603_dma_cleanup(struct mt7603_dev *dev);
 int mt7603_mcu_init(struct mt7603_dev *dev);
 void mt7603_init_debugfs(struct mt7603_dev *dev);
 
-void mt7603_set_irq_mask(struct mt7603_dev *dev, u32 clear, u32 set);
-
 static inline void mt7603_irq_enable(struct mt7603_dev *dev, u32 mask)
 {
-	mt7603_set_irq_mask(dev, 0, mask);
+	mt76_set_irq_mask(&dev->mt76, MT_INT_MASK_CSR, 0, mask);
 }
 
 static inline void mt7603_irq_disable(struct mt7603_dev *dev, u32 mask)
 {
-	mt7603_set_irq_mask(dev, mask, 0);
+	mt76_set_irq_mask(&dev->mt76, MT_INT_MASK_CSR, mask, 0);
 }
 
 void mt7603_mac_dma_start(struct mt7603_dev *dev);
* Unmerged path drivers/net/wireless/mediatek/mt76/mt76x02.h
