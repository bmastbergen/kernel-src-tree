SUNRPC: Simplify xprt_prepare_transmit()

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-193.el8
commit-author Trond Myklebust <trond.myklebust@hammerspace.com>
commit 5f2f6bd98736f904c803912c5578db311c09fe89
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-193.el8/5f2f6bd9.failed

Remove the checks for whether or not we need to transmit, and whether
or not a reply has been received. Those are already handled in
call_transmit() itself.

	Signed-off-by: Trond Myklebust <trond.myklebust@hammerspace.com>
(cherry picked from commit 5f2f6bd98736f904c803912c5578db311c09fe89)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/sunrpc/xprt.c
diff --cc net/sunrpc/xprt.c
index eacde9249456,dca822be194d..000000000000
--- a/net/sunrpc/xprt.c
+++ b/net/sunrpc/xprt.c
@@@ -967,29 -1126,15 +967,31 @@@ bool xprt_prepare_transmit(struct rpc_t
  
  	dprintk("RPC: %5u xprt_prepare_transmit\n", task->tk_pid);
  
++<<<<<<< HEAD
 +	spin_lock_bh(&xprt->transport_lock);
 +	if (!req->rq_bytes_sent) {
 +		if (req->rq_reply_bytes_recvd) {
 +			task->tk_status = req->rq_reply_bytes_recvd;
 +			goto out_unlock;
 +		}
 +		if ((task->tk_flags & RPC_TASK_NO_RETRANS_TIMEOUT)
 +		    && xprt_connected(xprt)
 +		    && req->rq_connect_cookie == xprt->connect_cookie) {
 +			xprt->ops->set_retrans_timeout(task);
 +			rpc_sleep_on(&xprt->pending, task, xprt_timer);
 +			goto out_unlock;
 +		}
++=======
+ 	if (!xprt_lock_write(xprt, task)) {
+ 		/* Race breaker: someone may have transmitted us */
+ 		if (!test_bit(RPC_TASK_NEED_XMIT, &task->tk_runstate))
+ 			rpc_wake_up_queued_task_set_status(&xprt->sending,
+ 					task, 0);
+ 		return false;
+ 
++>>>>>>> 5f2f6bd98736 (SUNRPC: Simplify xprt_prepare_transmit())
  	}
- 	if (!xprt->ops->reserve_xprt(xprt, task)) {
- 		task->tk_status = -EAGAIN;
- 		goto out_unlock;
- 	}
- 	ret = true;
- out_unlock:
- 	spin_unlock_bh(&xprt->transport_lock);
- 	return ret;
+ 	return true;
  }
  
  void xprt_end_transmit(struct rpc_task *task)
* Unmerged path net/sunrpc/xprt.c
