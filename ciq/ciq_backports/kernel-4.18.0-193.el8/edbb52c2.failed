libnvdimm/pfn_dev: Add page size and struct page size to pfn superblock

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-193.el8
commit-author Aneesh Kumar K.V <aneesh.kumar@linux.ibm.com>
commit edbb52c24441ab5203b969eca759483cb533f36d
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-193.el8/edbb52c2.failed

This is needed so that pmem probe don't wrongly initialize a namespace
which doesn't have enough space reserved for holding struct pages
with the current kernel.

	Signed-off-by: Aneesh Kumar K.V <aneesh.kumar@linux.ibm.com>
Link: https://lore.kernel.org/r/20190905154603.10349-5-aneesh.kumar@linux.ibm.com
	Signed-off-by: Dan Williams <dan.j.williams@intel.com>
(cherry picked from commit edbb52c24441ab5203b969eca759483cb533f36d)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/nvdimm/pfn_devs.c
diff --cc drivers/nvdimm/pfn_devs.c
index 8762ec764857,ce9ef18282dd..000000000000
--- a/drivers/nvdimm/pfn_devs.c
+++ b/drivers/nvdimm/pfn_devs.c
@@@ -774,10 -751,10 +795,16 @@@ static int nd_pfn_init(struct nd_pfn *n
  	memcpy(pfn_sb->uuid, nd_pfn->uuid, 16);
  	memcpy(pfn_sb->parent_uuid, nd_dev_to_uuid(&ndns->dev), 16);
  	pfn_sb->version_major = cpu_to_le16(1);
++<<<<<<< HEAD
 +	pfn_sb->version_minor = cpu_to_le16(3);
 +	pfn_sb->start_pad = cpu_to_le32(start_pad);
 +	pfn_sb->end_trunc = cpu_to_le32(end_trunc);
++=======
+ 	pfn_sb->version_minor = cpu_to_le16(4);
++>>>>>>> edbb52c24441 (libnvdimm/pfn_dev: Add page size and struct page size to pfn superblock)
  	pfn_sb->align = cpu_to_le32(nd_pfn->align);
+ 	pfn_sb->page_struct_size = cpu_to_le16(MAX_STRUCT_PAGE_SIZE);
+ 	pfn_sb->page_size = cpu_to_le32(PAGE_SIZE);
  	checksum = nd_sb_checksum((struct nd_gen_sb *) pfn_sb);
  	pfn_sb->checksum = cpu_to_le64(checksum);
  
diff --git a/drivers/nvdimm/pfn.h b/drivers/nvdimm/pfn.h
index e901e3a3b04c..a52e451a99f8 100644
--- a/drivers/nvdimm/pfn.h
+++ b/drivers/nvdimm/pfn.h
@@ -37,7 +37,10 @@ struct nd_pfn_sb {
 	/* minor-version-2 record the base alignment of the mapping */
 	__le32 align;
 	/* minor-version-3 guarantee the padding and flags are zero */
-	u8 padding[4000];
+	/* minor-version-4 record the page size and struct page size */
+	__le32 page_size;
+	__le16 page_struct_size;
+	u8 padding[3994];
 	__le64 checksum;
 };
 
* Unmerged path drivers/nvdimm/pfn_devs.c
