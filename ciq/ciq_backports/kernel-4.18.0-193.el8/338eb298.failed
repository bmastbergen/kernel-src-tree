KVM: selftests: Create VM earlier for dirty log test

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-193.el8
commit-author Peter Xu <peterx@redhat.com>
commit 338eb29876b9e571273175f167fcd58d9441ac8e
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-193.el8/338eb298.failed

Since we've just removed the dependency of vm type in previous patch,
now we can create the vm much earlier.  Note that to move it earlier
we used an approximation of number of extra pages but it should be
fine.

This prepares for the follow up patches to finally remove the
duplication of guest mode parsings.

	Reviewed-by: Andrew Jones <drjones@redhat.com>
	Signed-off-by: Peter Xu <peterx@redhat.com>
	Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>
(cherry picked from commit 338eb29876b9e571273175f167fcd58d9441ac8e)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	tools/testing/selftests/kvm/dirty_log_test.c
diff --cc tools/testing/selftests/kvm/dirty_log_test.c
index a310c854f969,cf2099abb121..000000000000
--- a/tools/testing/selftests/kvm/dirty_log_test.c
+++ b/tools/testing/selftests/kvm/dirty_log_test.c
@@@ -285,7 -333,11 +300,15 @@@ static void run_test(enum vm_guest_mod
  	 * A little more than 1G of guest page sized pages.  Cover the
  	 * case where the size is not aligned to 64 pages.
  	 */
++<<<<<<< HEAD
 +	guest_num_pages = (1ul << (30 - guest_page_shift)) + 16;
++=======
+ 	guest_num_pages = (1ul << (DIRTY_MEM_BITS - guest_page_shift)) + 16;
+ #ifdef __s390x__
+ 	/* Round up to multiple of 1M (segment size) */
+ 	guest_num_pages = (guest_num_pages + 0xff) & ~0xffUL;
+ #endif
++>>>>>>> 338eb29876b9 (KVM: selftests: Create VM earlier for dirty log test)
  	host_page_size = getpagesize();
  	host_num_pages = (guest_num_pages * guest_page_size) / host_page_size +
  			 !!((guest_num_pages * guest_page_size) % host_page_size);
* Unmerged path tools/testing/selftests/kvm/dirty_log_test.c
