net/mlx5: E-Switch, Use iterator for vlan and min-inline setups

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-193.el8
Rebuild_CHGLOG: - [netdrv] mlx5: E-Switch, Use iterator for vlan and min-inline setups (Alaa Hleihel) [1724327 1724336]
Rebuild_FUZZ: 96.72%
commit-author Bodong Wang <bodong@mellanox.com>
commit db68cc569eecff7dea5e346a217ce9ca5d2a0ede
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-193.el8/db68cc56.failed

Use the defined iterators to traversal VF reps/vport. Also, rely on
num of VFs rather than the counter of enabled vports as PF will also
be enabled from ECPF side, and the counter will be different from
num of VFs.

	Signed-off-by: Bodong Wang <bodong@mellanox.com>
	Reviewed-by: Parav Pandit <parav@mellanox.com>
	Signed-off-by: Saeed Mahameed <saeedm@mellanox.com>
(cherry picked from commit db68cc569eecff7dea5e346a217ce9ca5d2a0ede)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/mellanox/mlx5/core/eswitch_offloads.c
diff --cc drivers/net/ethernet/mellanox/mlx5/core/eswitch_offloads.c
index 2a02050a09e7,aecfb636fbc6..000000000000
--- a/drivers/net/ethernet/mellanox/mlx5/core/eswitch_offloads.c
+++ b/drivers/net/ethernet/mellanox/mlx5/core/eswitch_offloads.c
@@@ -317,9 -347,8 +317,14 @@@ static int esw_set_global_vlan_pop(stru
  	int vf_vport, err = 0;
  
  	esw_debug(esw->dev, "%s applying global %s policy\n", __func__, val ? "pop" : "none");
++<<<<<<< HEAD
 +	for (vf_vport = 1; vf_vport < esw->enabled_vports; vf_vport++) {
 +		rep = &esw->offloads.vport_reps[vf_vport];
 +		if (!rep->rep_if[REP_ETH].valid)
++=======
+ 	mlx5_esw_for_each_vf_rep(esw, vf_vport, rep, esw->esw_funcs.num_vfs) {
+ 		if (atomic_read(&rep->rep_data[REP_ETH].state) != REP_LOADED)
++>>>>>>> db68cc569eec (net/mlx5: E-Switch, Use iterator for vlan and min-inline setups)
  			continue;
  
  		err = __mlx5_eswitch_set_vport_vlan(esw, rep->vport, 0, 0, val);
@@@ -1875,7 -2389,7 +1881,11 @@@ int mlx5_eswitch_inline_mode_get(struc
  	}
  
  query_vports:
++<<<<<<< HEAD
 +	for (vport = 1; vport <= nvfs; vport++) {
++=======
+ 	mlx5_esw_for_each_vf_vport_num(esw, vport, esw->esw_funcs.num_vfs) {
++>>>>>>> db68cc569eec (net/mlx5: E-Switch, Use iterator for vlan and min-inline setups)
  		mlx5_query_nic_vport_min_inline(dev, vport, &mlx5_mode);
  		if (vport > 1 && prev_mlx5_mode != mlx5_mode)
  			return -EINVAL;
* Unmerged path drivers/net/ethernet/mellanox/mlx5/core/eswitch_offloads.c
