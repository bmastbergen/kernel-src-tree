HID: logitech-hidpp: do all FF cleanup in hidpp_ff_destroy()

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-193.el8
Rebuild_CHGLOG: - [hid] logitech-hidpp: do all FF cleanup in hidpp_ff_destroy() (Benjamin Tissoires) [1740778]
Rebuild_FUZZ: 95.65%
commit-author Andrey Smirnov <andrew.smirnov@gmail.com>
commit 08c453f6d073f069cf8e30e03cd3c16262c9b953
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-193.el8/08c453f6.failed

All of the FF-related resources belong to corresponding FF device, so
they should be freed as a part of hidpp_ff_destroy() to avoid
potential race condidions.

Fixes: ff21a635dd1a ("HID: logitech-hidpp: Force feedback support for the Logitech G920")
	Suggested-by: Benjamin Tissoires <benjamin.tissoires@redhat.com>
	Signed-off-by: Andrey Smirnov <andrew.smirnov@gmail.com>
	Cc: Jiri Kosina <jikos@kernel.org>
	Cc: Benjamin Tissoires <benjamin.tissoires@redhat.com>
	Cc: Henrik Rydberg <rydberg@bitmath.org>
	Cc: Pierre-Loup A. Griffais <pgriffais@valvesoftware.com>
	Cc: Austin Palmer <austinp@valvesoftware.com>
	Cc: linux-input@vger.kernel.org
	Cc: linux-kernel@vger.kernel.org
	Cc: stable@vger.kernel.org # 5.2+
	Signed-off-by: Benjamin Tissoires <benjamin.tissoires@redhat.com>
(cherry picked from commit 08c453f6d073f069cf8e30e03cd3c16262c9b953)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/hid/hid-logitech-hidpp.c
diff --cc drivers/hid/hid-logitech-hidpp.c
index 31cfa2c12192,8e91e2f06cb4..000000000000
--- a/drivers/hid/hid-logitech-hidpp.c
+++ b/drivers/hid/hid-logitech-hidpp.c
@@@ -3313,12 -3688,11 +3293,15 @@@ static void hidpp_remove(struct hid_dev
  {
  	struct hidpp_device *hidpp = hid_get_drvdata(hdev);
  
 -	if (!hidpp)
 -		return hid_hw_stop(hdev);
 -
  	sysfs_remove_group(&hdev->dev.kobj, &ps_attribute_group);
  
++<<<<<<< HEAD
 +	if (hidpp->quirks & HIDPP_QUIRK_CLASS_G920) {
 +		hidpp_ff_deinit(hdev);
 +		hid_hw_close(hdev);
 +	}
++=======
++>>>>>>> 08c453f6d073 (HID: logitech-hidpp: do all FF cleanup in hidpp_ff_destroy())
  	hid_hw_stop(hdev);
  	cancel_work_sync(&hidpp->work);
  	mutex_destroy(&hidpp->send_mutex);
* Unmerged path drivers/hid/hid-logitech-hidpp.c
