scsi: lpfc: Resolve checker warning for lpfc_new_io_buf()

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-193.el8
commit-author James Smart <jsmart2021@gmail.com>
commit 7f9989bace91a7a36051d64cbf46f7760c52bbf0
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-193.el8/7f9989ba.failed

Per Dan Carpenter:

The patch d79c9e9d4b3d: "scsi: lpfc: Support dynamic unbounded SGL lists on
G7 hardware." from Aug 14, 2019, leads to the following static checker
warning:

   drivers/scsi/lpfc/lpfc_init.c:4107 lpfc_new_io_buf()
  error: not allocating enough data 784 vs 768

There was no need to compare sizes nor to allocate size based on a define.

Change allocation to use actual structure length

	Signed-off-by: Dick Kennedy <dick.kennedy@broadcom.com>
	Signed-off-by: James Smart <jsmart2021@gmail.com>
CC: Dan Carpenter <dan.carpenter@oracle.com>
	Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
(cherry picked from commit 7f9989bace91a7a36051d64cbf46f7760c52bbf0)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/scsi/lpfc/lpfc_sli4.h
diff --cc drivers/scsi/lpfc/lpfc_sli4.h
index 2d1823e449aa,4bdd58de4692..000000000000
--- a/drivers/scsi/lpfc/lpfc_sli4.h
+++ b/drivers/scsi/lpfc/lpfc_sli4.h
@@@ -44,14 -44,6 +44,17 @@@
  #define LPFC_HBA_HDWQ_MAX	128
  #define LPFC_HBA_HDWQ_DEF	0
  
++<<<<<<< HEAD
 +/* FCP MQ queue count limiting */
 +#define LPFC_FCP_MQ_THRESHOLD_MIN	0
 +#define LPFC_FCP_MQ_THRESHOLD_MAX	128
 +#define LPFC_FCP_MQ_THRESHOLD_DEF	8
 +
 +/* Common buffer size to accomidate SCSI and NVME IO buffers */
 +#define LPFC_COMMON_IO_BUF_SZ	768
 +
++=======
++>>>>>>> 7f9989bace91 (scsi: lpfc: Resolve checker warning for lpfc_new_io_buf())
  /*
   * Provide the default FCF Record attributes used by the driver
   * when nonFIP mode is configured and there is no other default
diff --git a/drivers/scsi/lpfc/lpfc_init.c b/drivers/scsi/lpfc/lpfc_init.c
index 1ac9d5d8ea81..40079665e8b7 100644
--- a/drivers/scsi/lpfc/lpfc_init.c
+++ b/drivers/scsi/lpfc/lpfc_init.c
@@ -3966,18 +3966,9 @@ lpfc_new_io_buf(struct lpfc_hba *phba, int num_to_alloc)
 	LIST_HEAD(post_nblist);
 	LIST_HEAD(nvme_nblist);
 
-	/* Sanity check to ensure our sizing is right for both SCSI and NVME */
-	if (sizeof(struct lpfc_io_buf) > LPFC_COMMON_IO_BUF_SZ) {
-		lpfc_printf_log(phba, KERN_ERR, LOG_FCP,
-				"6426 Common buffer size %zd exceeds %d\n",
-				sizeof(struct lpfc_io_buf),
-				LPFC_COMMON_IO_BUF_SZ);
-		return 0;
-	}
-
 	phba->sli4_hba.io_xri_cnt = 0;
 	for (bcnt = 0; bcnt < num_to_alloc; bcnt++) {
-		lpfc_ncmd = kzalloc(LPFC_COMMON_IO_BUF_SZ, GFP_KERNEL);
+		lpfc_ncmd = kzalloc(sizeof(*lpfc_ncmd), GFP_KERNEL);
 		if (!lpfc_ncmd)
 			break;
 		/*
* Unmerged path drivers/scsi/lpfc/lpfc_sli4.h
