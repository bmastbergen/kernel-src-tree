net: xdp: allow generic and driver XDP on one interface

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-193.el8
Rebuild_CHGLOG: - [net] xdp: allow generic and driver XDP on one interface (Jiri Benc) [1749812]
Rebuild_FUZZ: 95.24%
commit-author Jakub Kicinski <jakub.kicinski@netronome.com>
commit 9ee963d6a1a03a4302b230cd21476a3c269af284
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-193.el8/9ee963d6.failed

Since commit a25717d2b604 ("xdp: support simultaneous driver and
hw XDP attachment") users can load an XDP program for offload and
in native driver mode simultaneously.  Allow a similar mix of
offload and SKB mode/generic XDP.

	Signed-off-by: Jakub Kicinski <jakub.kicinski@netronome.com>
	Reviewed-by: Quentin Monnet <quentin.monnet@netronome.com>
	Signed-off-by: Daniel Borkmann <daniel@iogearbox.net>
(cherry picked from commit 9ee963d6a1a03a4302b230cd21476a3c269af284)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/core/dev.c
diff --cc net/core/dev.c
index e4251d737441,78c3b48392e1..000000000000
--- a/net/core/dev.c
+++ b/net/core/dev.c
@@@ -7784,9 -7981,8 +7785,14 @@@ int dev_change_xdp_fd(struct net_devic
  
  	ASSERT_RTNL();
  
++<<<<<<< HEAD
 +	rh_mark_used_feature("eBPF/xdp");
 +
 +	query = flags & XDP_FLAGS_HW_MODE ? XDP_QUERY_PROG_HW : XDP_QUERY_PROG;
++=======
+ 	offload = flags & XDP_FLAGS_HW_MODE;
+ 	query = offload ? XDP_QUERY_PROG_HW : XDP_QUERY_PROG;
++>>>>>>> 9ee963d6a1a0 (net: xdp: allow generic and driver XDP on one interface)
  
  	bpf_op = bpf_chk = ops->ndo_bpf;
  	if (!bpf_op && (flags & (XDP_FLAGS_DRV_MODE | XDP_FLAGS_HW_MODE))) {
* Unmerged path net/core/dev.c
