PCI: pciehp: Add DMI table for in-band presence detection disabled

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-193.el8
Rebuild_CHGLOG: - [pci] PCI: pciehp: Add DMI table for in-band presence disabled (Myron Stowe) [1749528]
Rebuild_FUZZ: 91.80%
commit-author Stuart Hayes <stuart.w.hayes@gmail.com>
commit 0b382546d863f2f09eecaccda95a0b4bfd148f92
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-193.el8/0b382546.failed

Some systems have in-band presence detection disabled for hot-plug PCI
slots but do not report this in the slot capabilities 2 (SLTCAP2) register.
On these systems, presence detect can become active well after the link is
reported to be active, which can cause the slots to be disabled after a
device is connected.

Add a DMI table to flag these systems as having in-band presence detect
disabled.

Link: https://lore.kernel.org/r/20191025190047.38130-4-stuart.w.hayes@gmail.com
	Signed-off-by: Stuart Hayes <stuart.w.hayes@gmail.com>
	Signed-off-by: Bjorn Helgaas <bhelgaas@google.com>
	Reviewed-by: Andy Shevchenko <andy.shevchenko@gmail.com>
	Reviewed-by: Lukas Wunner <lukas@wunner.de>
(cherry picked from commit 0b382546d863f2f09eecaccda95a0b4bfd148f92)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/pci/hotplug/pciehp_hpc.c
diff --cc drivers/pci/hotplug/pciehp_hpc.c
index 2dc9944b9a5c,e4627c68b30f..000000000000
--- a/drivers/pci/hotplug/pciehp_hpc.c
+++ b/drivers/pci/hotplug/pciehp_hpc.c
@@@ -890,6 -921,16 +909,19 @@@ struct controller *pcie_init(struct pci
  	ctrl->state = list_empty(&subordinate->devices) ? OFF_STATE : ON_STATE;
  	up_read(&pci_bus_sem);
  
++<<<<<<< HEAD
++=======
+ 	pcie_capability_read_dword(pdev, PCI_EXP_SLTCAP2, &slot_cap2);
+ 	if (slot_cap2 & PCI_EXP_SLTCAP2_IBPD) {
+ 		pcie_write_cmd_nowait(ctrl, PCI_EXP_SLTCTL_IBPD_DISABLE,
+ 				      PCI_EXP_SLTCTL_IBPD_DISABLE);
+ 		ctrl->inband_presence_disabled = 1;
+ 	}
+ 
+ 	if (dmi_first_match(inband_presence_disabled_dmi_table))
+ 		ctrl->inband_presence_disabled = 1;
+ 
++>>>>>>> 0b382546d863 (PCI: pciehp: Add DMI table for in-band presence detection disabled)
  	/* Check if Data Link Layer Link Active Reporting is implemented */
  	pcie_capability_read_dword(pdev, PCI_EXP_LNKCAP, &link_cap);
  
* Unmerged path drivers/pci/hotplug/pciehp_hpc.c
