ALSA: usb-audio: Unify audioformat release code

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-193.el8
commit-author Takashi Iwai <tiwai@suse.de>
commit c1ae5e7f057beb1daa72831ab22ec06e71669af7
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-193.el8/c1ae5e7f.failed

There are many open code for releasing audioformat object.
Provide a unified helper and call it from the all places.

Only a cleanup, no functional changes.

	Signed-off-by: Takashi Iwai <tiwai@suse.de>
(cherry picked from commit c1ae5e7f057beb1daa72831ab22ec06e71669af7)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	sound/usb/stream.c
diff --cc sound/usb/stream.c
index d9e3de495c16,963d425004f8..000000000000
--- a/sound/usb/stream.c
+++ b/sound/usb/stream.c
@@@ -38,7 -26,16 +38,15 @@@
  #include "clock.h"
  #include "stream.h"
  #include "power.h"
 -#include "media.h"
  
+ static void audioformat_free(struct audioformat *fp)
+ {
+ 	list_del(&fp->list); /* unlink for avoiding double-free */
+ 	kfree(fp->rate_table);
+ 	kfree(fp->chmap);
+ 	kfree(fp);
+ }
+ 
  /*
   * free a substream
   */
@@@ -48,13 -45,11 +56,10 @@@ static void free_substream(struct snd_u
  
  	if (!subs->num_formats)
  		return; /* not initialized */
- 	list_for_each_entry_safe(fp, n, &subs->fmt_list, list) {
- 		kfree(fp->rate_table);
- 		kfree(fp->chmap);
- 		kfree(fp);
- 	}
+ 	list_for_each_entry_safe(fp, n, &subs->fmt_list, list)
+ 		audioformat_free(fp);
  	kfree(subs->rate_list.list);
  	kfree(subs->str_pd);
 -	snd_media_stream_delete(subs);
  }
  
  
@@@ -1053,8 -1047,7 +1057,12 @@@ found_clock
  
  		pd = kzalloc(sizeof(*pd), GFP_KERNEL);
  		if (!pd) {
++<<<<<<< HEAD
 +			kfree(fp->rate_table);
 +			kfree(fp);
++=======
+ 			audioformat_free(fp);
++>>>>>>> c1ae5e7f057b (ALSA: usb-audio: Unify audioformat release code)
  			return NULL;
  		}
  		pd->pd_id = (stream == SNDRV_PCM_STREAM_PLAYBACK) ?
* Unmerged path sound/usb/stream.c
