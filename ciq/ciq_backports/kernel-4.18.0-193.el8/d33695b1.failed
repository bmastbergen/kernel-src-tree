mm/memory_hotplug: poison memmap in remove_pfn_range_from_zone()

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-193.el8
Rebuild_CHGLOG: - [mm] memory_hotplug: poison memmap in remove_pfn_range_from_zone() (Christoph von Recklinghausen) [1766491]
Rebuild_FUZZ: 97.60%
commit-author David Hildenbrand <david@redhat.com>
commit d33695b16a9f0b5f62aefb0a4e073509690ee533
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-193.el8/d33695b1.failed

Let's poison the pages similar to when adding new memory in
sparse_add_section().  Also call remove_pfn_range_from_zone() from
memunmap_pages(), so we can poison the memmap from there as well.

Link: http://lkml.kernel.org/r/20191006085646.5768-7-david@redhat.com
	Signed-off-by: David Hildenbrand <david@redhat.com>
	Cc: Michal Hocko <mhocko@suse.com>
	Cc: "Matthew Wilcox (Oracle)" <willy@infradead.org>
	Cc: "Aneesh Kumar K.V" <aneesh.kumar@linux.ibm.com>
	Cc: Pavel Tatashin <pasha.tatashin@soleen.com>
	Cc: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
	Cc: Dan Williams <dan.j.williams@intel.com>
	Cc: Logan Gunthorpe <logang@deltatee.com>
	Cc: Oscar Salvador <osalvador@suse.de>
	Cc: Pankaj Gupta <pagupta@redhat.com>
	Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
	Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
(cherry picked from commit d33695b16a9f0b5f62aefb0a4e073509690ee533)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	mm/memremap.c
* Unmerged path mm/memremap.c
diff --git a/mm/memory_hotplug.c b/mm/memory_hotplug.c
index a3e9f0ce7c23..012d5ffcd1b2 100644
--- a/mm/memory_hotplug.c
+++ b/mm/memory_hotplug.c
@@ -469,6 +469,9 @@ static void __remove_zone(struct zone *zone, unsigned long start_pfn)
 	int nr_pages = PAGES_PER_SECTION;
 	unsigned long flags;
 
+	/* Poison struct pages because they are now uninitialized again. */
+	page_init_poison(pfn_to_page(start_pfn), sizeof(struct page) * nr_pages);
+
 #ifdef CONFIG_ZONE_DEVICE
 	/*
 	 * Zone shrinking code cannot properly deal with ZONE_DEVICE. So
* Unmerged path mm/memremap.c
