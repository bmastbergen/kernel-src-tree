drm/i915: Add Wa_1407352427:icl,ehl

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-193.el8
commit-author Matt Roper <matthew.d.roper@intel.com>
commit 1cd21a7c5679015352e8a6f46813aced51d71bb8
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-193.el8/1cd21a7c.failed

The workaround database now indicates we need to disable psdunit clock
gating as well.

v3:
 - Rebase on top of other workarounds that have landed.
 - Restrict cc:stable tag to 5.2+ since that's when ICL was first
   officially supported.

Bspec: 32354
Bspec: 33450
Bspec: 33451
	Suggested-by: Lionel Landwerlin <lionel.g.landwerlin@intel.com>
	Cc: stable@vger.kernel.org # v5.2+
	Cc: Lionel Landwerlin <lionel.g.landwerlin@intel.com>
	Cc: Lucas De Marchi <lucas.demarchi@intel.com>
	Cc: Matt Atwood <matthew.s.atwood@intel.com>
	Signed-off-by: Matt Roper <matthew.d.roper@intel.com>
	Acked-by: Lionel Landwerlin <lionel.g.landwerlin@intel.com>
Link: https://patchwork.freedesktop.org/patch/msgid/20191231190713.1549533-1-matthew.d.roper@intel.com
(cherry picked from commit 1cd21a7c5679015352e8a6f46813aced51d71bb8)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/gpu/drm/i915/i915_reg.h
diff --cc drivers/gpu/drm/i915/i915_reg.h
index fb2634d24821,cf770793be54..000000000000
--- a/drivers/gpu/drm/i915/i915_reg.h
+++ b/drivers/gpu/drm/i915/i915_reg.h
@@@ -4015,6 -4181,10 +4015,13 @@@ enum 
  #define   HSUNIT_CLKGATE_DIS		REG_BIT(8)
  #define   VSUNIT_CLKGATE_DIS		REG_BIT(3)
  
++<<<<<<< HEAD
++=======
+ #define UNSLICE_UNIT_LEVEL_CLKGATE2	_MMIO(0x94e4)
+ #define   VSUNIT_CLKGATE_DIS_TGL	REG_BIT(19)
+ #define   PSDUNIT_CLKGATE_DIS		REG_BIT(5)
+ 
++>>>>>>> 1cd21a7c5679 (drm/i915: Add Wa_1407352427:icl,ehl)
  #define INF_UNIT_LEVEL_CLKGATE		_MMIO(0x9560)
  #define   CGPSF_CLKGATE_DIS		(1 << 3)
  
* Unmerged path drivers/gpu/drm/i915/i915_reg.h
diff --git a/drivers/gpu/drm/i915/intel_pm.c b/drivers/gpu/drm/i915/intel_pm.c
index 87d7d1812136..4278a2b93721 100644
--- a/drivers/gpu/drm/i915/intel_pm.c
+++ b/drivers/gpu/drm/i915/intel_pm.c
@@ -9075,6 +9075,9 @@ static void icl_init_clock_gating(struct drm_i915_private *dev_priv)
 	intel_uncore_rmw(&dev_priv->uncore, UNSLICE_UNIT_LEVEL_CLKGATE,
 			 0, VSUNIT_CLKGATE_DIS | HSUNIT_CLKGATE_DIS);
 
+	/* Wa_1407352427:icl,ehl */
+	intel_uncore_rmw(&dev_priv->uncore, UNSLICE_UNIT_LEVEL_CLKGATE2,
+			 0, PSDUNIT_CLKGATE_DIS);
 }
 
 static void cnp_init_clock_gating(struct drm_i915_private *dev_priv)
