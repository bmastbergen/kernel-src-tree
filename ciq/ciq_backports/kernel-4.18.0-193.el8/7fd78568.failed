btf: rename /sys/kernel/btf/kernel into /sys/kernel/btf/vmlinux

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-193.el8
commit-author Andrii Nakryiko <andriin@fb.com>
commit 7fd785685e2243bb639b31557e258d11464c3489
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-193.el8/7fd78568.failed

Expose kernel's BTF under the name vmlinux to be more uniform with using
kernel module names as file names in the future.

Fixes: 341dfcf8d78e ("btf: expose BTF info through sysfs")
	Suggested-by: Daniel Borkmann <daniel@iogearbox.net>
	Signed-off-by: Andrii Nakryiko <andriin@fb.com>
	Signed-off-by: Daniel Borkmann <daniel@iogearbox.net>
(cherry picked from commit 7fd785685e2243bb639b31557e258d11464c3489)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	Documentation/ABI/testing/sysfs-kernel-btf
#	kernel/bpf/sysfs_btf.c
#	scripts/link-vmlinux.sh
diff --cc scripts/link-vmlinux.sh
index 4b776595ffb3,f7933c606f27..000000000000
--- a/scripts/link-vmlinux.sh
+++ b/scripts/link-vmlinux.sh
@@@ -127,11 -107,19 +127,21 @@@ gen_btf(
  	pahole_ver=$(${PAHOLE} --version | sed -E 's/v([0-9]+)\.([0-9]+)/\1\2/')
  	if [ "${pahole_ver}" -lt "113" ]; then
  		info "BTF" "${1}: pahole version $(${PAHOLE} --version) is too old, need at least v1.13"
 -		return 1
 +		return 0
  	fi
  
 -	info "BTF" ${2}
 -	vmlinux_link ${1}
 +	info "BTF" ${1}
  	LLVM_OBJCOPY=${OBJCOPY} ${PAHOLE} -J ${1}
++<<<<<<< HEAD
++=======
+ 
+ 	# dump .BTF section into raw binary file to link with final vmlinux
+ 	bin_arch=$(${OBJDUMP} -f ${1} | grep architecture | \
+ 		cut -d, -f1 | cut -d' ' -f2)
+ 	${OBJCOPY} --dump-section .BTF=.btf.vmlinux.bin ${1} 2>/dev/null
+ 	${OBJCOPY} -I binary -O ${CONFIG_OUTPUT_FORMAT} -B ${bin_arch} \
+ 		--rename-section .data=.BTF .btf.vmlinux.bin ${2}
++>>>>>>> 7fd785685e22 (btf: rename /sys/kernel/btf/kernel into /sys/kernel/btf/vmlinux)
  }
  
  # Create ${2} .o file with all symbols from the ${1} object file
@@@ -245,6 -224,16 +255,19 @@@ modpost_link vmlinux.
  # modpost vmlinux.o to check for section mismatches
  ${MAKE} -f "${srctree}/scripts/Makefile.modpost" vmlinux.o
  
++<<<<<<< HEAD
++=======
+ info MODINFO modules.builtin.modinfo
+ ${OBJCOPY} -j .modinfo -O binary vmlinux.o modules.builtin.modinfo
+ 
+ btf_vmlinux_bin_o=""
+ if [ -n "${CONFIG_DEBUG_INFO_BTF}" ]; then
+ 	if gen_btf .tmp_vmlinux.btf .btf.vmlinux.bin.o ; then
+ 		btf_vmlinux_bin_o=.btf.vmlinux.bin.o
+ 	fi
+ fi
+ 
++>>>>>>> 7fd785685e22 (btf: rename /sys/kernel/btf/kernel into /sys/kernel/btf/vmlinux)
  kallsymso=""
  kallsyms_vmlinux=""
  if [ -n "${CONFIG_KALLSYMS}" ]; then
@@@ -276,11 -265,11 +299,19 @@@
  	kallsyms_vmlinux=.tmp_vmlinux2
  
  	# step 1
++<<<<<<< HEAD
 +	vmlinux_link "" .tmp_vmlinux1
 +	kallsyms .tmp_vmlinux1 .tmp_kallsyms1.o
 +
 +	# step 2
 +	vmlinux_link .tmp_kallsyms1.o .tmp_vmlinux2
++=======
+ 	vmlinux_link .tmp_vmlinux1 ${btf_vmlinux_bin_o}
+ 	kallsyms .tmp_vmlinux1 .tmp_kallsyms1.o
+ 
+ 	# step 2
+ 	vmlinux_link .tmp_vmlinux2 .tmp_kallsyms1.o ${btf_vmlinux_bin_o}
++>>>>>>> 7fd785685e22 (btf: rename /sys/kernel/btf/kernel into /sys/kernel/btf/vmlinux)
  	kallsyms .tmp_vmlinux2 .tmp_kallsyms2.o
  
  	# step 3
@@@ -291,18 -280,13 +322,26 @@@
  		kallsymso=.tmp_kallsyms3.o
  		kallsyms_vmlinux=.tmp_vmlinux3
  
++<<<<<<< HEAD
 +		vmlinux_link .tmp_kallsyms2.o .tmp_vmlinux3
 +
++=======
+ 		vmlinux_link .tmp_vmlinux3 .tmp_kallsyms2.o ${btf_vmlinux_bin_o}
++>>>>>>> 7fd785685e22 (btf: rename /sys/kernel/btf/kernel into /sys/kernel/btf/vmlinux)
  		kallsyms .tmp_vmlinux3 .tmp_kallsyms3.o
  	fi
  fi
  
  info LD vmlinux
++<<<<<<< HEAD
 +vmlinux_link "${kallsymso}" vmlinux
 +
 +if [ -n "${CONFIG_DEBUG_INFO_BTF}" ]; then
 +	gen_btf vmlinux
 +fi
++=======
+ vmlinux_link vmlinux "${kallsymso}" "${btf_vmlinux_bin_o}"
++>>>>>>> 7fd785685e22 (btf: rename /sys/kernel/btf/kernel into /sys/kernel/btf/vmlinux)
  
  if [ -n "${CONFIG_BUILDTIME_EXTABLE_SORT}" ]; then
  	info SORTEX vmlinux
* Unmerged path Documentation/ABI/testing/sysfs-kernel-btf
* Unmerged path kernel/bpf/sysfs_btf.c
* Unmerged path Documentation/ABI/testing/sysfs-kernel-btf
* Unmerged path kernel/bpf/sysfs_btf.c
* Unmerged path scripts/link-vmlinux.sh
