ALSA: bebob: expand delay of start for IR context just for version 3 firmware

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-193.el8
commit-author Takashi Sakamoto <o-takashi@sakamocchi.jp>
commit da5e83374f463a4dd91321428d5ea5230b6d87b4
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-193.el8/da5e8337.failed

As long as I investigated, there's some cases about the delay for device
between establishing OUTPUT_PLUG and transmitting first isoc packet. For
devices which support BeBoB protocol version 1 can transmit the packet
within several hundred milliseconds, while for devices which support
BeBoB protocol version 3 can transmit the packet within 2 seconds.

Devices with protocol version 1:
 * Edirol FA-66
 * Yamaha GO46
 * Terratec Phase x24 FW
 * M-Audio FireWire AudioPhile
 * M-Audio FireWire Solo
 * M-Audio FireWire 1814
 * M-Audio FireWire 410
 * Focusrite Saffire Pro 26 I/O

Devices with protocol version 3:
 * M-Audio Profire Lightbridge
 * Behringer FCA610
 * Phonic Firefly 202

At present ALSA bebob driver postpones starting IR context during
1.5 sec for all of supported devices. The delay is too long for
devices with protocol version 1, while it's not enough for devices with
protocol version 3.

This commit improves the delay for these protocols.

	Signed-off-by: Takashi Sakamoto <o-takashi@sakamocchi.jp>
Link: https://lore.kernel.org/r/20191101131323.17300-3-o-takashi@sakamocchi.jp
	Signed-off-by: Takashi Iwai <tiwai@suse.de>
(cherry picked from commit da5e83374f463a4dd91321428d5ea5230b6d87b4)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	sound/firewire/bebob/bebob_stream.c
diff --cc sound/firewire/bebob/bebob_stream.c
index 977ab097377f,895a113635af..000000000000
--- a/sound/firewire/bebob/bebob_stream.c
+++ b/sound/firewire/bebob/bebob_stream.c
@@@ -657,7 -659,20 +658,24 @@@ int snd_bebob_stream_start_duplex(struc
  		if (err < 0)
  			goto error;
  
++<<<<<<< HEAD
 +		err = amdtp_domain_start(&bebob->domain);
++=======
+ 		// The device postpones start of transmission mostly for 1 sec
+ 		// after receives packets firstly. For safe, IR context starts
+ 		// 0.4 sec (=3200 cycles) later to version 1 or 2 firmware,
+ 		// 2.0 sec (=16000 cycles) for version 3 firmware. This is
+ 		// within 2.5 sec (=CALLBACK_TIMEOUT).
+ 		// Furthermore, some devices transfer isoc packets with
+ 		// discontinuous counter in the beginning of packet streaming.
+ 		// The delay has an effect to avoid detection of this
+ 		// discontinuity.
+ 		if (bebob->version < 2)
+ 			ir_delay_cycle = 3200;
+ 		else
+ 			ir_delay_cycle = 16000;
+ 		err = amdtp_domain_start(&bebob->domain, ir_delay_cycle);
++>>>>>>> da5e83374f46 (ALSA: bebob: expand delay of start for IR context just for version 3 firmware)
  		if (err < 0)
  			goto error;
  
* Unmerged path sound/firewire/bebob/bebob_stream.c
