net/mlx5: E-Switch, Fix the warning on vport index out of range

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-193.el8
Rebuild_CHGLOG: - [netdrv] mlx5: E-Switch, Fix the warning on vport index out of range (Alaa Hleihel) [1724333]
Rebuild_FUZZ: 96.72%
commit-author Bodong Wang <bodong@mellanox.com>
commit acad70731e63aa3a901bc04a81a4a152cadbe9bf
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-193.el8/acad7073.failed

When eswitch gets vport data structure, the index should not be out
of the range of the vport array. Driver mistakenly used vport number
to check the range.

Fixes: 22b8ddc86bf4 ("net/mlx5: E-Switch, Assign a different position for uplink rep and vport")
	Signed-off-by: Bodong Wang <bodong@mellanox.com>
	Signed-off-by: Saeed Mahameed <saeedm@mellanox.com>
(cherry picked from commit acad70731e63aa3a901bc04a81a4a152cadbe9bf)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/mellanox/mlx5/core/eswitch.c
diff --cc drivers/net/ethernet/mellanox/mlx5/core/eswitch.c
index c2e828153dd7,d4f6859bf58c..000000000000
--- a/drivers/net/ethernet/mellanox/mlx5/core/eswitch.c
+++ b/drivers/net/ethernet/mellanox/mlx5/core/eswitch.c
@@@ -70,6 -69,28 +70,31 @@@ enum 
  			    MC_ADDR_CHANGE | \
  			    PROMISC_CHANGE)
  
++<<<<<<< HEAD
++=======
+ /* The vport getter/iterator are only valid after esw->total_vports
+  * and vport->vport are initialized in mlx5_eswitch_init.
+  */
+ #define mlx5_esw_for_all_vports(esw, i, vport)			\
+ 	for ((i) = MLX5_VPORT_PF;				\
+ 	     (vport) = &(esw)->vports[i],			\
+ 	     (i) < (esw)->total_vports; (i)++)
+ 
+ #define mlx5_esw_for_each_vf_vport(esw, i, vport, nvfs)	\
+ 	for ((i) = MLX5_VPORT_FIRST_VF;				\
+ 	     (vport) = &(esw)->vports[i],			\
+ 	     (i) <= (nvfs); (i)++)
+ 
+ static struct mlx5_vport *mlx5_eswitch_get_vport(struct mlx5_eswitch *esw,
+ 						 u16 vport_num)
+ {
+ 	u16 idx = mlx5_eswitch_vport_num_to_index(esw, vport_num);
+ 
+ 	WARN_ON(idx > esw->total_vports - 1);
+ 	return &esw->vports[idx];
+ }
+ 
++>>>>>>> acad70731e63 (net/mlx5: E-Switch, Fix the warning on vport index out of range)
  static int arm_vport_context_events_cmd(struct mlx5_core_dev *dev, u16 vport,
  					u32 events_mask)
  {
* Unmerged path drivers/net/ethernet/mellanox/mlx5/core/eswitch.c
