perf script: Assume native_arch for pipe mode

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-193.el8
commit-author Song Liu <songliubraving@fb.com>
commit 9d49169c5958e429ffa6874fbef734ae7502ad65
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-193.el8/9d49169c.failed

In pipe mode, session->header.env.arch is not populated until the events
are processed. Therefore, the following command crashes:

   perf record -o - | perf script

(gdb) bt

It fails when we try to compare env.arch against uts.machine:

        if (!strcmp(uts.machine, session->header.env.arch) ||
            (!strcmp(uts.machine, "x86_64") &&
             !strcmp(session->header.env.arch, "i386")))
                native_arch = true;

In pipe mode, it is tricky to find env.arch at this stage. To keep it
simple, let's just assume native_arch is always true for pipe mode.

	Reported-by: David Carrillo Cisneros <davidca@fb.com>
	Signed-off-by: Song Liu <songliubraving@fb.com>
	Tested-by: Arnaldo Carvalho de Melo <acme@redhat.com>
	Cc: Andi Kleen <ak@linux.intel.com>
	Cc: Jiri Olsa <jolsa@kernel.org>
	Cc: Namhyung Kim <namhyung@kernel.org>
	Cc: kernel-team@fb.com
	Cc: stable@vger.kernel.org #v5.1+
Fixes: 3ab481a1cfe1 ("perf script: Support insn output for normal samples")
Link: http://lkml.kernel.org/r/20190621014438.810342-1-songliubraving@fb.com
	Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>
(cherry picked from commit 9d49169c5958e429ffa6874fbef734ae7502ad65)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	tools/perf/builtin-script.c
diff --cc tools/perf/builtin-script.c
index 4efaae5c4818,79367087bd18..000000000000
--- a/tools/perf/builtin-script.c
+++ b/tools/perf/builtin-script.c
@@@ -3737,6 -3751,13 +3737,16 @@@ int cmd_script(int argc, const char **a
  	if (symbol__init(&session->header.env) < 0)
  		goto out_delete;
  
++<<<<<<< HEAD
++=======
+ 	uname(&uts);
+ 	if (data.is_pipe ||  /* assume pipe_mode indicates native_arch */
+ 	    !strcmp(uts.machine, session->header.env.arch) ||
+ 	    (!strcmp(uts.machine, "x86_64") &&
+ 	     !strcmp(session->header.env.arch, "i386")))
+ 		native_arch = true;
+ 
++>>>>>>> 9d49169c5958 (perf script: Assume native_arch for pipe mode)
  	script.session = session;
  	script__setup_sample_type(&script);
  
* Unmerged path tools/perf/builtin-script.c
