ACPI / scan: Create platform device for fwnodes with multiple i2c devices

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-193.el8
commit-author Hans de Goede <hdegoede@redhat.com>
commit aba941392aeef2d1bc064a1e4b09293473ef7b9b
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-193.el8/aba94139.failed

Some devices have multiple I2cSerialBus resources and for things to work
an i2c-client must be instantiated for each, each with its own
i2c_device_id.

Normally we only instantiate an i2c-client for the first resource, using
the ACPI HID as id.

This commit adds a list of HIDs of devices, which need multiple i2c-clients
instantiated from a single fwnode, to acpi_device_enumeration_by_parent and
makes acpi_device_enumeration_by_parent return false for these devices so
that a platform device will be instantiated.

This allows the drivers/platform/x86/i2c-multi-instantiate.c driver, which
knows which i2c_device_id to use for each resource, to bind to the fwnode
and initiate an i2c-client for each resource.

	Signed-off-by: Hans de Goede <hdegoede@redhat.com>
	Reviewed-by: Andy Shevchenko <andriy.shevchenko@linux.intel.com>
	Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>
(cherry picked from commit aba941392aeef2d1bc064a1e4b09293473ef7b9b)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/acpi/scan.c
diff --cc drivers/acpi/scan.c
index 66f5d0fc7630,e1b6231cfa1c..000000000000
--- a/drivers/acpi/scan.c
+++ b/drivers/acpi/scan.c
@@@ -1541,13 -1563,8 +1553,18 @@@ static bool acpi_device_enumeration_by_
  	     fwnode_property_present(&device->fwnode, "baud")))
  		return true;
  
++<<<<<<< HEAD
 +	/*
 +	 * Firmware on some arm64 X-Gene platforms will make the UART
 +	 * device appear as both a UART and a slave of that UART. Just
 +	 * bail out here for X-Gene UARTs.
 +	 */
 +	if (IS_ENABLED(CONFIG_ARM64) &&
 +	    !strcmp(acpi_device_hid(device), "APMC0D08"))
++=======
+ 	/* Instantiate a pdev for the i2c-multi-instantiate drv to bind to */
+ 	if (!acpi_match_device_ids(device, i2c_multi_instantiate_ids))
++>>>>>>> aba941392aee (ACPI / scan: Create platform device for fwnodes with multiple i2c devices)
  		return false;
  
  	INIT_LIST_HEAD(&resource_list);
* Unmerged path drivers/acpi/scan.c
