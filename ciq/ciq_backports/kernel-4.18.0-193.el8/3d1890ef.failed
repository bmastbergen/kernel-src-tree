drm/nouveau/kms/nv50-: fix panel scaling

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-193.el8
commit-author Ben Skeggs <bskeggs@redhat.com>
commit 3d1890ef8023e61934e070021b06cc9f417260c0
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-193.el8/3d1890ef.failed

Under certain circumstances, encoder atomic_check() can be entered
without adjusted_mode having been reset to the same as mode, which
confuses the scaling logic and can lead to a misprogrammed display.

Fix this by checking against the user-provided mode directly.

Link: https://bugs.freedesktop.org/show_bug.cgi?id=108615
Link: https://gitlab.freedesktop.org/xorg/driver/xf86-video-nouveau/issues/464
	Signed-off-by: Ben Skeggs <bskeggs@redhat.com>
(cherry picked from commit 3d1890ef8023e61934e070021b06cc9f417260c0)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/gpu/drm/nouveau/dispnv50/disp.c
diff --cc drivers/gpu/drm/nouveau/dispnv50/disp.c
index 5216b642fff4,63425e246018..000000000000
--- a/drivers/gpu/drm/nouveau/dispnv50/disp.c
+++ b/drivers/gpu/drm/nouveau/dispnv50/disp.c
@@@ -322,8 -322,13 +322,18 @@@ nv50_outp_atomic_check_view(struct drm_
  		switch (connector->connector_type) {
  		case DRM_MODE_CONNECTOR_LVDS:
  		case DRM_MODE_CONNECTOR_eDP:
++<<<<<<< HEAD
 +			/* Force use of scaler for non-EDID modes. */
 +			if (adjusted_mode->type & DRM_MODE_TYPE_DRIVER)
++=======
+ 			/* Don't force scaler for EDID modes with
+ 			 * same size as the native one (e.g. different
+ 			 * refresh rate)
+ 			 */
+ 			if (mode->hdisplay == native_mode->hdisplay &&
+ 			    mode->vdisplay == native_mode->vdisplay &&
+ 			    mode->type & DRM_MODE_TYPE_DRIVER)
++>>>>>>> 3d1890ef8023 (drm/nouveau/kms/nv50-: fix panel scaling)
  				break;
  			mode = native_mode;
  			asyc->scaler.full = true;
* Unmerged path drivers/gpu/drm/nouveau/dispnv50/disp.c
