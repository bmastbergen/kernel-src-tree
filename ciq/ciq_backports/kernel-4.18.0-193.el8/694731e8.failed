selftests/bpf: Adjust CO-RE reloc tests for new bpf_core_read() macro

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-193.el8
commit-author Andrii Nakryiko <andriin@fb.com>
commit 694731e8ea7f6bbcf0c57763ed4f24faa14bf056
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-193.el8/694731e8.failed

To allow adding a variadic BPF_CORE_READ macro with slightly different
syntax and semantics, define CORE_READ in CO-RE reloc tests, which is
a thin wrapper around low-level bpf_core_read() macro, which in turn is
just a wrapper around bpf_probe_read().

	Signed-off-by: Andrii Nakryiko <andriin@fb.com>
	Signed-off-by: Daniel Borkmann <daniel@iogearbox.net>
	Acked-by: John Fastabend <john.fastabend@gmail.com>
	Acked-by: Song Liu <songliubraving@fb.com>
Link: https://lore.kernel.org/bpf/20191008175942.1769476-4-andriin@fb.com
(cherry picked from commit 694731e8ea7f6bbcf0c57763ed4f24faa14bf056)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	tools/testing/selftests/bpf/progs/test_core_reloc_arrays.c
#	tools/testing/selftests/bpf/progs/test_core_reloc_flavors.c
#	tools/testing/selftests/bpf/progs/test_core_reloc_ints.c
#	tools/testing/selftests/bpf/progs/test_core_reloc_kernel.c
#	tools/testing/selftests/bpf/progs/test_core_reloc_misc.c
#	tools/testing/selftests/bpf/progs/test_core_reloc_mods.c
#	tools/testing/selftests/bpf/progs/test_core_reloc_nesting.c
#	tools/testing/selftests/bpf/progs/test_core_reloc_primitives.c
#	tools/testing/selftests/bpf/progs/test_core_reloc_ptr_as_arr.c
* Unmerged path tools/testing/selftests/bpf/progs/test_core_reloc_arrays.c
* Unmerged path tools/testing/selftests/bpf/progs/test_core_reloc_flavors.c
* Unmerged path tools/testing/selftests/bpf/progs/test_core_reloc_ints.c
* Unmerged path tools/testing/selftests/bpf/progs/test_core_reloc_kernel.c
* Unmerged path tools/testing/selftests/bpf/progs/test_core_reloc_misc.c
* Unmerged path tools/testing/selftests/bpf/progs/test_core_reloc_mods.c
* Unmerged path tools/testing/selftests/bpf/progs/test_core_reloc_nesting.c
* Unmerged path tools/testing/selftests/bpf/progs/test_core_reloc_primitives.c
* Unmerged path tools/testing/selftests/bpf/progs/test_core_reloc_ptr_as_arr.c
diff --git a/tools/testing/selftests/bpf/bpf_helpers.h b/tools/testing/selftests/bpf/bpf_helpers.h
index bf703810e4c3..660cb5070714 100644
--- a/tools/testing/selftests/bpf/bpf_helpers.h
+++ b/tools/testing/selftests/bpf/bpf_helpers.h
@@ -457,7 +457,7 @@ struct pt_regs;
 #endif
 
 /*
- * BPF_CORE_READ abstracts away bpf_probe_read() call and captures offset
+ * bpf_core_read() abstracts away bpf_probe_read() call and captures offset
  * relocation for source address using __builtin_preserve_access_index()
  * built-in, provided by Clang.
  *
@@ -472,8 +472,8 @@ struct pt_regs;
  * actual field offset, based on target kernel BTF type that matches original
  * (local) BTF, used to record relocation.
  */
-#define BPF_CORE_READ(dst, src)						\
-	bpf_probe_read((dst), sizeof(*(src)),				\
-		       __builtin_preserve_access_index(src))
+#define bpf_core_read(dst, sz, src)					    \
+	bpf_probe_read(dst, sz,						    \
+		       (const void *)__builtin_preserve_access_index(src))
 
 #endif
* Unmerged path tools/testing/selftests/bpf/progs/test_core_reloc_arrays.c
* Unmerged path tools/testing/selftests/bpf/progs/test_core_reloc_flavors.c
* Unmerged path tools/testing/selftests/bpf/progs/test_core_reloc_ints.c
* Unmerged path tools/testing/selftests/bpf/progs/test_core_reloc_kernel.c
* Unmerged path tools/testing/selftests/bpf/progs/test_core_reloc_misc.c
* Unmerged path tools/testing/selftests/bpf/progs/test_core_reloc_mods.c
* Unmerged path tools/testing/selftests/bpf/progs/test_core_reloc_nesting.c
* Unmerged path tools/testing/selftests/bpf/progs/test_core_reloc_primitives.c
* Unmerged path tools/testing/selftests/bpf/progs/test_core_reloc_ptr_as_arr.c
