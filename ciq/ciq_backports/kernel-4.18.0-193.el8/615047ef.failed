fuse: convert init to simple api

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-193.el8
commit-author Miklos Szeredi <mszeredi@redhat.com>
commit 615047eff10886bb5ef8e97232b431348bad06d1
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-193.el8/615047ef.failed

Bypass the fc->initialized check by setting the force flag.

	Signed-off-by: Miklos Szeredi <mszeredi@redhat.com>
(cherry picked from commit 615047eff10886bb5ef8e97232b431348bad06d1)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	fs/fuse/inode.c
diff --cc fs/fuse/inode.c
index 523a1f18c557,2cec25ad54b7..000000000000
--- a/fs/fuse/inode.c
+++ b/fs/fuse/inode.c
@@@ -1089,10 -1101,9 +1106,9 @@@ static int fuse_fill_super(struct super
  	struct fuse_dev *fud;
  	struct fuse_conn *fc;
  	struct inode *root;
 +	struct fuse_mount_data d;
  	struct file *file;
  	struct dentry *root_dentry;
- 	struct fuse_req *init_req;
  	int err;
  	int is_bdev = sb->s_bdev != NULL;
  
@@@ -1186,17 -1198,6 +1202,20 @@@
  	/* Root dentry doesn't have .d_revalidate */
  	sb->s_d_op = &fuse_dentry_operations;
  
++<<<<<<< HEAD
 +	init_req = fuse_request_alloc(0);
 +	if (!init_req)
 +		goto err_put_root;
 +	__set_bit(FR_BACKGROUND, &init_req->flags);
 +
 +	if (is_bdev) {
 +		fc->destroy_req = fuse_request_alloc(0);
 +		if (!fc->destroy_req)
 +			goto err_free_init_req;
 +	}
 +
++=======
++>>>>>>> 615047eff108 (fuse: convert init to simple api)
  	mutex_lock(&fuse_mutex);
  	err = -EINVAL;
  	if (file->private_data)
@@@ -1223,9 -1224,6 +1242,12 @@@
  
   err_unlock:
  	mutex_unlock(&fuse_mutex);
++<<<<<<< HEAD
 + err_free_init_req:
 +	fuse_request_free(init_req);
 + err_put_root:
++=======
++>>>>>>> 615047eff108 (fuse: convert init to simple api)
  	dput(root_dentry);
   err_dev_free:
  	fuse_dev_free(fud);
* Unmerged path fs/fuse/inode.c
