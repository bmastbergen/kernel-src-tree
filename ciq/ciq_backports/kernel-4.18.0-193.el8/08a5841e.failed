ASoC: soc-core: use snd_soc_dai_link_component for CPU

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-193.el8
Rebuild_CHGLOG: - [sound] ALSA: ASoC: soc-core: use snd_soc_dai_link_component for CPU (Jaroslav Kysela) [1738610]
Rebuild_FUZZ: 94.74%
commit-author Kuninori Morimoto <kuninori.morimoto.gx@renesas.com>
commit 08a5841e3a109f9ea7bfa9c64109aefa95a318c7
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-193.el8/08a5841e.failed

current ALSA SoC is starting to support modern style dai_linke
(= struct snd_soc_dai_link_component) which is mainly used for
multipul DAI/component connection.
Now Codec has full multi-codec support, Platform is using modern
style but still for single Platform.
Only CPU is not yet supporting modern style yet.
If we could support it for CPU, we can switch to modern style
dai_link on all CPU/Codec/Platform, and remove legacy style
from ALSA SoC.

Multi-CPU will be supported in the future.
This patch is initial support for modern style for CPU

	Signed-off-by: Kuninori Morimoto <kuninori.morimoto.gx@renesas.com>
	Signed-off-by: Mark Brown <broonie@kernel.org>
(cherry picked from commit 08a5841e3a109f9ea7bfa9c64109aefa95a318c7)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	sound/soc/soc-core.c
diff --cc sound/soc/soc-core.c
index 13d7a329daa0,f86ee4f48f06..000000000000
--- a/sound/soc/soc-core.c
+++ b/sound/soc/soc-core.c
@@@ -2808,6 -2853,23 +2863,23 @@@ int snd_soc_register_card(struct snd_so
  	if (!card->name || !card->dev)
  		return -EINVAL;
  
++<<<<<<< HEAD
++=======
+ 	mutex_lock(&client_mutex);
+ 	for_each_card_prelinks(card, i, link) {
+ 
+ 		ret = soc_init_dai_link(card, link);
+ 		if (ret) {
+ 			soc_cleanup_legacy(card);
+ 			dev_err(card->dev, "ASoC: failed to init link %s\n",
+ 				link->name);
+ 			mutex_unlock(&client_mutex);
+ 			return ret;
+ 		}
+ 	}
+ 	mutex_unlock(&client_mutex);
+ 
++>>>>>>> 08a5841e3a10 (ASoC: soc-core: use snd_soc_dai_link_component for CPU)
  	dev_set_drvdata(card->dev, card);
  
  	snd_soc_initialize_card_lists(card);
diff --git a/include/sound/soc.h b/include/sound/soc.h
index 482b4ea87c3c..e9771cb29942 100644
--- a/include/sound/soc.h
+++ b/include/sound/soc.h
@@ -927,6 +927,9 @@ struct snd_soc_dai_link {
 	 */
 	const char *cpu_dai_name;
 
+	struct snd_soc_dai_link_component *cpus;
+	unsigned int num_cpus;
+
 	/*
 	 *	codec_name
 	 *	codec_of_node
@@ -1035,6 +1038,7 @@ struct snd_soc_dai_link {
 	 * drivers should not modify this value.
 	 */
 	unsigned int legacy_platform:1;
+	unsigned int legacy_cpu:1;
 
 	struct list_head list; /* DAI link list of the soc card */
 	struct snd_soc_dobj dobj; /* For topology */
* Unmerged path sound/soc/soc-core.c
