powerpc/pseries: Account for SPURR ticks on idle CPUs

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-240.el8
commit-author Gautham R. Shenoy <ego@linux.vnet.ibm.com>
commit dc8afce5f45b099e3ea52a16b2f90e92f90f3af0
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-240.el8/dc8afce5.failed

On Pseries LPARs, to calculate utilization, we need to know the
[S]PURR ticks when the CPUs were busy or idle.

Via pseries_idle_prolog(), pseries_idle_epilog(), we track the idle
PURR ticks in the VPA variable "wait_state_cycles". This patch extends
the support to account for the idle SPURR ticks.

	Signed-off-by: Gautham R. Shenoy <ego@linux.vnet.ibm.com>
	Signed-off-by: Michael Ellerman <mpe@ellerman.id.au>
Link: https://lore.kernel.org/r/1586249263-14048-4-git-send-email-ego@linux.vnet.ibm.com
(cherry picked from commit dc8afce5f45b099e3ea52a16b2f90e92f90f3af0)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/powerpc/include/asm/idle.h
#	arch/powerpc/platforms/pseries/setup.c
diff --cc arch/powerpc/platforms/pseries/setup.c
index 16d0569700f5,1b55e804927d..000000000000
--- a/arch/powerpc/platforms/pseries/setup.c
+++ b/arch/powerpc/platforms/pseries/setup.c
@@@ -303,6 -318,9 +303,12 @@@ static int alloc_dispatch_log_kmem_cach
  }
  machine_early_initcall(pseries, alloc_dispatch_log_kmem_cache);
  
++<<<<<<< HEAD
++=======
+ DEFINE_PER_CPU(u64, idle_spurr_cycles);
+ DEFINE_PER_CPU(u64, idle_entry_purr_snap);
+ DEFINE_PER_CPU(u64, idle_entry_spurr_snap);
++>>>>>>> dc8afce5f45b (powerpc/pseries: Account for SPURR ticks on idle CPUs)
  static void pseries_lpar_idle(void)
  {
  	/*
* Unmerged path arch/powerpc/include/asm/idle.h
* Unmerged path arch/powerpc/include/asm/idle.h
* Unmerged path arch/powerpc/platforms/pseries/setup.c
