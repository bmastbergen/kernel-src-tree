bluetooth: hci_bcm: Give more time to come out of reset

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-240.el8
commit-author Ondrej Jirman <megous@megous.com>
commit 16946de5905fff243c1e4415c4565803945e8c47
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-240.el8/16946de5.failed

Some supported devices need more time to come out of reset (eg.
BCM4345C5 in AP6256).

I don't have/found a datasheet, so the value was arrive at
experimentally with the Oprange Pi 3 board. Without increased delay,
I got intermittent failures during probe. This is a Bluetooth 5.0
device, so maybe that's why it takes longer to initialize than the
others.

	Signed-off-by: Ondrej Jirman <megous@megous.com>
	Signed-off-by: Marcel Holtmann <marcel@holtmann.org>
(cherry picked from commit 16946de5905fff243c1e4415c4565803945e8c47)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/bluetooth/hci_bcm.c
diff --cc drivers/bluetooth/hci_bcm.c
index 25f16d67c597,7646636f2d18..000000000000
--- a/drivers/bluetooth/hci_bcm.c
+++ b/drivers/bluetooth/hci_bcm.c
@@@ -228,10 -247,22 +228,25 @@@ static int bcm_gpio_set_power(struct bc
  	if (err)
  		goto err_revert_shutdown;
  
 -	if (!powered && dev->res_enabled) {
 -		clk_disable_unprepare(dev->txco_clk);
 -		clk_disable_unprepare(dev->lpo_clk);
 +	if (!powered && !IS_ERR(dev->clk) && dev->clk_enabled)
 +		clk_disable_unprepare(dev->clk);
  
++<<<<<<< HEAD
 +	dev->clk_enabled = powered;
++=======
+ 		/* Intel Macs use bcm_apple_get_resources() and don't
+ 		 * have regulator supplies configured.
+ 		 */
+ 		if (dev->supplies[0].supply)
+ 			regulator_bulk_disable(BCM_NUM_SUPPLIES,
+ 					       dev->supplies);
+ 	}
+ 
+ 	/* wait for device to power on and come out of reset */
+ 	usleep_range(100000, 120000);
+ 
+ 	dev->res_enabled = powered;
++>>>>>>> 16946de5905f (bluetooth: hci_bcm: Give more time to come out of reset)
  
  	return 0;
  
* Unmerged path drivers/bluetooth/hci_bcm.c
