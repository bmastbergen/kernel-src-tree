netfilter: nf_flow_table_offload: add IPv6 support

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-240.el8
commit-author Pablo Neira Ayuso <pablo@netfilter.org>
commit 5c27d8d76ce810c6254cf5917a6019d824f34bd2
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-240.el8/5c27d8d7.failed

Add nf_flow_rule_route_ipv6() and use it from the IPv6 and the inet
flowtable type definitions. Rename the nf_flow_rule_route() function to
nf_flow_rule_route_ipv4().

Adjust maximum number of actions, which now becomes 16 to leave
sufficient room for the IPv6 address mangling for NAT.

	Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
(cherry picked from commit 5c27d8d76ce810c6254cf5917a6019d824f34bd2)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	include/net/netfilter/nf_flow_table.h
#	net/ipv4/netfilter/nf_flow_table_ipv4.c
#	net/ipv6/netfilter/nf_flow_table_ipv6.c
#	net/netfilter/nf_flow_table_inet.c
#	net/netfilter/nf_flow_table_offload.c
diff --cc include/net/netfilter/nf_flow_table.h
index ebceddb778ea,f0897b3c97fb..000000000000
--- a/include/net/netfilter/nf_flow_table.h
+++ b/include/net/netfilter/nf_flow_table.h
@@@ -130,4 -152,25 +130,29 @@@ unsigned int nf_flow_offload_ipv6_hook(
  #define MODULE_ALIAS_NF_FLOWTABLE(family)	\
  	MODULE_ALIAS("nf-flowtable-" __stringify(family))
  
++<<<<<<< HEAD
 +#endif /* _FLOW_OFFLOAD_H */
++=======
+ void nf_flow_offload_add(struct nf_flowtable *flowtable,
+ 			 struct flow_offload *flow);
+ void nf_flow_offload_del(struct nf_flowtable *flowtable,
+ 			 struct flow_offload *flow);
+ void nf_flow_offload_stats(struct nf_flowtable *flowtable,
+ 			   struct flow_offload *flow);
+ 
+ void nf_flow_table_offload_flush(struct nf_flowtable *flowtable);
+ int nf_flow_table_offload_setup(struct nf_flowtable *flowtable,
+ 				struct net_device *dev,
+ 				enum flow_block_command cmd);
+ int nf_flow_rule_route_ipv4(struct net *net, const struct flow_offload *flow,
+ 			    enum flow_offload_tuple_dir dir,
+ 			    struct nf_flow_rule *flow_rule);
+ int nf_flow_rule_route_ipv6(struct net *net, const struct flow_offload *flow,
+ 			    enum flow_offload_tuple_dir dir,
+ 			    struct nf_flow_rule *flow_rule);
+ 
+ int nf_flow_table_offload_init(void);
+ void nf_flow_table_offload_exit(void);
+ 
+ #endif /* _NF_FLOW_TABLE_H */
++>>>>>>> 5c27d8d76ce8 (netfilter: nf_flow_table_offload: add IPv6 support)
diff --cc net/ipv4/netfilter/nf_flow_table_ipv4.c
index e1e56d7123d2,e32e41b99f0f..000000000000
--- a/net/ipv4/netfilter/nf_flow_table_ipv4.c
+++ b/net/ipv4/netfilter/nf_flow_table_ipv4.c
@@@ -8,6 -9,8 +8,11 @@@
  static struct nf_flowtable_type flowtable_ipv4 = {
  	.family		= NFPROTO_IPV4,
  	.init		= nf_flow_table_init,
++<<<<<<< HEAD
++=======
+ 	.setup		= nf_flow_table_offload_setup,
+ 	.action		= nf_flow_rule_route_ipv4,
++>>>>>>> 5c27d8d76ce8 (netfilter: nf_flow_table_offload: add IPv6 support)
  	.free		= nf_flow_table_free,
  	.hook		= nf_flow_offload_ip_hook,
  	.owner		= THIS_MODULE,
diff --cc net/ipv6/netfilter/nf_flow_table_ipv6.c
index c511d206bf9b,a8566ee12e83..000000000000
--- a/net/ipv6/netfilter/nf_flow_table_ipv6.c
+++ b/net/ipv6/netfilter/nf_flow_table_ipv6.c
@@@ -9,6 -10,8 +9,11 @@@
  static struct nf_flowtable_type flowtable_ipv6 = {
  	.family		= NFPROTO_IPV6,
  	.init		= nf_flow_table_init,
++<<<<<<< HEAD
++=======
+ 	.setup		= nf_flow_table_offload_setup,
+ 	.action		= nf_flow_rule_route_ipv6,
++>>>>>>> 5c27d8d76ce8 (netfilter: nf_flow_table_offload: add IPv6 support)
  	.free		= nf_flow_table_free,
  	.hook		= nf_flow_offload_ipv6_hook,
  	.owner		= THIS_MODULE,
diff --cc net/netfilter/nf_flow_table_inet.c
index 99771aa7e7ea,88bedf1ff1ae..000000000000
--- a/net/netfilter/nf_flow_table_inet.c
+++ b/net/netfilter/nf_flow_table_inet.c
@@@ -23,6 -47,8 +46,11 @@@ static int nf_flow_rule_route_inet(stru
  static struct nf_flowtable_type flowtable_inet = {
  	.family		= NFPROTO_INET,
  	.init		= nf_flow_table_init,
++<<<<<<< HEAD
++=======
+ 	.setup		= nf_flow_table_offload_setup,
+ 	.action		= nf_flow_rule_route_inet,
++>>>>>>> 5c27d8d76ce8 (netfilter: nf_flow_table_offload: add IPv6 support)
  	.free		= nf_flow_table_free,
  	.hook		= nf_flow_offload_inet_hook,
  	.owner		= THIS_MODULE,
* Unmerged path net/netfilter/nf_flow_table_offload.c
* Unmerged path include/net/netfilter/nf_flow_table.h
* Unmerged path net/ipv4/netfilter/nf_flow_table_ipv4.c
* Unmerged path net/ipv6/netfilter/nf_flow_table_ipv6.c
* Unmerged path net/netfilter/nf_flow_table_inet.c
* Unmerged path net/netfilter/nf_flow_table_offload.c
