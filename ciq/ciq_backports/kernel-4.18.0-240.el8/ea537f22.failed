perf report/top: Do not offer annotation for symbols without samples

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-240.el8
commit-author Arnaldo Carvalho de Melo <acme@redhat.com>
commit ea537f22f6e5b3e2026fc58419cc937d833b1a61
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-240.el8/ea537f22.failed

This can happen in the --children mode, i.e. the default mode when
callchains are present, where one of the main entries may be a callchain
entry with no samples.

So far we were not providing any information about why an annotation
couldn't be provided even offering the Annotation option in the popup
menu.

Work is needed to allow for no-samples "annotation', i.e. to show the
disassembly anyway and allow for navigation, etc.

	Reviewed-by: Jiri Olsa <jolsa@kernel.org>
	Cc: Adrian Hunter <adrian.hunter@intel.com>
	Cc: Andi Kleen <ak@linux.intel.com>
	Cc: Jin Yao <yao.jin@linux.intel.com>
	Cc: Kan Liang <kan.liang@intel.com>
	Cc: Linus Torvalds <torvalds@linux-foundation.org>
	Cc: Namhyung Kim <namhyung@kernel.org>
Link: https://lkml.kernel.org/n/tip-0hhzj2de15o88cguy7h66zre@git.kernel.org
	Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>
(cherry picked from commit ea537f22f6e5b3e2026fc58419cc937d833b1a61)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	tools/perf/ui/browsers/hists.c
diff --cc tools/perf/ui/browsers/hists.c
index 3386768d57cb,3bec8de89880..000000000000
--- a/tools/perf/ui/browsers/hists.c
+++ b/tools/perf/ui/browsers/hists.c
@@@ -2442,16 -2463,16 +2442,21 @@@ do_annotate(struct hist_browser *browse
  static int
  add_annotate_opt(struct hist_browser *browser __maybe_unused,
  		 struct popup_action *act, char **optstr,
 -		 struct map_symbol *ms)
 +		 struct map *map, struct symbol *sym)
  {
++<<<<<<< HEAD
 +	if (sym == NULL || map->dso->annotate_warned)
++=======
+ 	if (ms->sym == NULL || ms->map->dso->annotate_warned ||
+ 	    symbol__annotation(ms->sym)->src == NULL)
++>>>>>>> ea537f22f6e5 (perf report/top: Do not offer annotation for symbols without samples)
  		return 0;
  
 -	if (asprintf(optstr, "Annotate %s", ms->sym->name) < 0)
 +	if (asprintf(optstr, "Annotate %s", sym->name) < 0)
  		return 0;
  
 -	act->ms = *ms;
 +	act->ms.map = map;
 +	act->ms.sym = sym;
  	act->fn = do_annotate;
  	return 1;
  }
* Unmerged path tools/perf/ui/browsers/hists.c
