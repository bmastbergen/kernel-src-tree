openvswitch: use after free in __ovs_ct_free_action()

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-240.el8
commit-author Dan Carpenter <dan.carpenter@oracle.com>
commit 6d670497e01803b486aa72cc1a718401ab986896
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-240.el8/6d670497.failed

We free "ct_info->ct" and then use it on the next line when we pass it
to nf_ct_destroy_timeout().  This patch swaps the order to avoid the use
after free.

Fixes: 06bd2bdf19d2 ("openvswitch: Add timeout support to ct action")
	Signed-off-by: Dan Carpenter <dan.carpenter@oracle.com>
	Acked-by: Yi-Hung Wei <yihung.wei@gmail.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 6d670497e01803b486aa72cc1a718401ab986896)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/openvswitch/conntrack.c
diff --cc net/openvswitch/conntrack.c
index edb57c07c767,0be3ab5bde26..000000000000
--- a/net/openvswitch/conntrack.c
+++ b/net/openvswitch/conntrack.c
@@@ -1815,15 -1801,13 +1815,22 @@@ void ovs_ct_free_action(const struct nl
  
  static void __ovs_ct_free_action(struct ovs_conntrack_info *ct_info)
  {
 -	if (ct_info->helper)
 +	if (ct_info->helper) {
 +#ifdef CONFIG_NF_NAT_NEEDED
 +		if (ct_info->nat)
 +			nf_nat_helper_put(ct_info->helper);
 +#endif
  		nf_conntrack_helper_put(ct_info->helper);
++<<<<<<< HEAD
++=======
+ 	if (ct_info->ct) {
+ 		if (ct_info->timeout[0])
+ 			nf_ct_destroy_timeout(ct_info->ct);
+ 		nf_ct_tmpl_free(ct_info->ct);
++>>>>>>> 6d670497e018 (openvswitch: use after free in __ovs_ct_free_action())
  	}
 +	if (ct_info->ct)
 +		nf_ct_tmpl_free(ct_info->ct);
  }
  
  #if	IS_ENABLED(CONFIG_NETFILTER_CONNCOUNT)
* Unmerged path net/openvswitch/conntrack.c
