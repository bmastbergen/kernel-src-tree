iommu/amd: Remove dev_data->passthrough

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-240.el8
commit-author Joerg Roedel <jroedel@suse.de>
commit 57f9842e48840684f596db1de936d7c6d44cd087
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-240.el8/57f9842e.failed

Make use of generic IOMMU infrastructure to gather the same information
carried in dev_data->passthrough and remove the struct member.

	Signed-off-by: Joerg Roedel <jroedel@suse.de>
Link: https://lore.kernel.org/r/20200429133712.31431-15-joro@8bytes.org
	Signed-off-by: Joerg Roedel <jroedel@suse.de>
(cherry picked from commit 57f9842e48840684f596db1de936d7c6d44cd087)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/iommu/amd_iommu.c
diff --cc drivers/iommu/amd_iommu.c
index f0fbc2eb0ed2,0b4b4faa876d..000000000000
--- a/drivers/iommu/amd_iommu.c
+++ b/drivers/iommu/amd_iommu.c
@@@ -2294,10 -2191,8 +2296,15 @@@ static int amd_iommu_add_device(struct 
  
  	/* Domains are initialized for this device - have a look what we ended up with */
  	domain = iommu_get_domain_for_dev(dev);
++<<<<<<< HEAD
 +	if (domain->type == IOMMU_DOMAIN_IDENTITY)
 +		dev_data->passthrough = true;
 +	else
 +		dev->dma_ops = &amd_iommu_dma_ops;
++=======
+ 	if (domain->type == IOMMU_DOMAIN_DMA)
+ 		iommu_setup_dma_ops(dev, IOVA_START_PFN << PAGE_SHIFT, 0);
++>>>>>>> 57f9842e4884 (iommu/amd: Remove dev_data->passthrough)
  
  out:
  	iommu_completion_wait(iommu);
* Unmerged path drivers/iommu/amd_iommu.c
diff --git a/drivers/iommu/amd_iommu_types.h b/drivers/iommu/amd_iommu_types.h
index 34d7de7b2ee7..a85be3ed9620 100644
--- a/drivers/iommu/amd_iommu_types.h
+++ b/drivers/iommu/amd_iommu_types.h
@@ -652,7 +652,6 @@ struct iommu_dev_data {
 	struct pci_dev *pdev;
 	u16 devid;			  /* PCI Device ID */
 	bool iommu_v2;			  /* Device can make use of IOMMUv2 */
-	bool passthrough;		  /* Device is identity mapped */
 	struct {
 		bool enabled;
 		int qdep;
