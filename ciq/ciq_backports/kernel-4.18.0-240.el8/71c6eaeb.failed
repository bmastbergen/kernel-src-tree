net/mlx5e: Set netdev name space on creation

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-240.el8
commit-author Michael Guralnik <michaelgur@mellanox.com>
commit 71c6eaebf06aa8353b0dcd57786b801b96fe2c08
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-240.el8/71c6eaeb.failed

Use devlink instance name space to set the netdev net namespace.

Preparation patch for devlink reload implementation.

	Signed-off-by: Michael Guralnik <michaelgur@mellanox.com>
	Acked-by: Jiri Pirko <jiri@mellanox.com>
	Signed-off-by: Saeed Mahameed <saeedm@mellanox.com>
(cherry picked from commit 71c6eaebf06aa8353b0dcd57786b801b96fe2c08)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/mellanox/mlx5/core/en_main.c
#	drivers/net/ethernet/mellanox/mlx5/core/en_rep.c
diff --cc drivers/net/ethernet/mellanox/mlx5/core/en_main.c
index 70b435972bbd,06a592fb62bf..000000000000
--- a/drivers/net/ethernet/mellanox/mlx5/core/en_main.c
+++ b/drivers/net/ethernet/mellanox/mlx5/core/en_main.c
@@@ -62,6 -62,8 +62,11 @@@
  #include "en/xsk/setup.h"
  #include "en/xsk/rx.h"
  #include "en/xsk/tx.h"
++<<<<<<< HEAD
++=======
+ #include "en/hv_vhca_stats.h"
+ #include "lib/mlx5.h"
++>>>>>>> 71c6eaebf06a (net/mlx5e: Set netdev name space on creation)
  
  
  bool mlx5e_check_fragmented_striding_rq_cap(struct mlx5_core_dev *mdev)
diff --cc drivers/net/ethernet/mellanox/mlx5/core/en_rep.c
index cec5177e43fc,c7f98f1fd9b1..000000000000
--- a/drivers/net/ethernet/mellanox/mlx5/core/en_rep.c
+++ b/drivers/net/ethernet/mellanox/mlx5/core/en_rep.c
@@@ -47,9 -47,12 +47,15 @@@
  #include "en/tc_tun.h"
  #include "fs_core.h"
  #include "lib/port_tun.h"
++<<<<<<< HEAD
++=======
+ #include "lib/mlx5.h"
+ #define CREATE_TRACE_POINTS
+ #include "diag/en_rep_tracepoint.h"
++>>>>>>> 71c6eaebf06a (net/mlx5e: Set netdev name space on creation)
  
  #define MLX5E_REP_PARAMS_DEF_LOG_SQ_SIZE \
 -        max(0x7, MLX5E_PARAMS_MINIMUM_LOG_SQ_SIZE)
 +	max(0x7, MLX5E_PARAMS_MINIMUM_LOG_SQ_SIZE)
  #define MLX5E_REP_PARAMS_DEF_NUM_CHANNELS 1
  
  static const char mlx5e_rep_driver_name[] = "mlx5e_rep";
* Unmerged path drivers/net/ethernet/mellanox/mlx5/core/en_main.c
* Unmerged path drivers/net/ethernet/mellanox/mlx5/core/en_rep.c
diff --git a/drivers/net/ethernet/mellanox/mlx5/core/lib/mlx5.h b/drivers/net/ethernet/mellanox/mlx5/core/lib/mlx5.h
index b99d469e4e64..249539247e2e 100644
--- a/drivers/net/ethernet/mellanox/mlx5/core/lib/mlx5.h
+++ b/drivers/net/ethernet/mellanox/mlx5/core/lib/mlx5.h
@@ -84,4 +84,9 @@ int mlx5_create_encryption_key(struct mlx5_core_dev *mdev,
 			       void *key, u32 sz_bytes, u32 *p_key_id);
 void mlx5_destroy_encryption_key(struct mlx5_core_dev *mdev, u32 key_id);
 
+static inline struct net *mlx5_core_net(struct mlx5_core_dev *dev)
+{
+	return devlink_net(priv_to_devlink(dev));
+}
+
 #endif
