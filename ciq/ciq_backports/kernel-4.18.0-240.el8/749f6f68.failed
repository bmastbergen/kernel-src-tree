net: phy: dp83867: w/a for fld detect threshold bootstrapping issue

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-240.el8
commit-author Grygorii Strashko <grygorii.strashko@ti.com>
commit 749f6f6843115b424680f1aada3c0dd613ad807c
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-240.el8/749f6f68.failed

When the DP83867 PHY is strapped to enable Fast Link Drop (FLD) feature
STRAP_STS2.STRAP_ FLD (reg 0x006F bit 10), the Energy Lost Threshold for
FLD Energy Lost Mode FLD_THR_CFG.ENERGY_LOST_FLD_THR (reg 0x002e bits 2:0)
will be defaulted to 0x2. This may cause the phy link to be unstable. The
new DP83867 DM recommends to always restore ENERGY_LOST_FLD_THR to 0x1.

Hence, restore default value of FLD_THR_CFG.ENERGY_LOST_FLD_THR to 0x1 when
FLD is enabled by bootstrapping as recommended by DM.

	Signed-off-by: Grygorii Strashko <grygorii.strashko@ti.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 749f6f6843115b424680f1aada3c0dd613ad807c)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/phy/dp83867.c
diff --cc drivers/net/phy/dp83867.c
index f703f601ac01,9a07ad137c2e..000000000000
--- a/drivers/net/phy/dp83867.c
+++ b/drivers/net/phy/dp83867.c
@@@ -21,11 -23,13 +21,12 @@@
  #define MII_DP83867_PHYCTRL	0x10
  #define MII_DP83867_MICR	0x12
  #define MII_DP83867_ISR		0x13
 -#define DP83867_CFG2		0x14
 -#define DP83867_CFG3		0x1e
  #define DP83867_CTRL		0x1f
 +#define DP83867_CFG3		0x1e
  
  /* Extended Registers */
- #define DP83867_CFG4            0x0031
+ #define DP83867_FLD_THR_CFG	0x002e
+ #define DP83867_CFG4		0x0031
  #define DP83867_CFG4_SGMII_ANEG_MASK (BIT(5) | BIT(6))
  #define DP83867_CFG4_SGMII_ANEG_TIMER_11MS   (3 << 5)
  #define DP83867_CFG4_SGMII_ANEG_TIMER_800US  (2 << 5)
@@@ -63,6 -76,24 +64,17 @@@
  /* STRAP_STS1 bits */
  #define DP83867_STRAP_STS1_RESERVED		BIT(11)
  
++<<<<<<< HEAD
++=======
+ /* STRAP_STS2 bits */
+ #define DP83867_STRAP_STS2_CLK_SKEW_TX_MASK	GENMASK(6, 4)
+ #define DP83867_STRAP_STS2_CLK_SKEW_TX_SHIFT	4
+ #define DP83867_STRAP_STS2_CLK_SKEW_RX_MASK	GENMASK(2, 0)
+ #define DP83867_STRAP_STS2_CLK_SKEW_RX_SHIFT	0
+ #define DP83867_STRAP_STS2_CLK_SKEW_NONE	BIT(2)
+ #define DP83867_STRAP_STS2_STRAP_FLD		BIT(10)
+ 
++>>>>>>> 749f6f684311 (net: phy: dp83867: w/a for fld detect threshold bootstrapping issue)
  /* PHY CTRL bits */
  #define DP83867_PHYCR_TX_FIFO_DEPTH_SHIFT	14
  #define DP83867_PHYCR_RX_FIFO_DEPTH_SHIFT	12
* Unmerged path drivers/net/phy/dp83867.c
