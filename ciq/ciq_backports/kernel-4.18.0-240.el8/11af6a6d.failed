net/mlx5e: Add helper functions for reporter's basics

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-240.el8
commit-author Aya Levin <ayal@mellanox.com>
commit 11af6a6d09e9a90e05f4a21564232b30c6c25d69
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-240.el8/11af6a6d.failed

Introduce helper functions for create and destroy reporters and update
channels. In the following patch, rx reporter is added and it will use
these helpers too.

	Signed-off-by: Aya Levin <ayal@mellanox.com>
	Reviewed-by: Tariq Toukan <tariqt@mellanox.com>
	Acked-by: Jiri Pirko <jiri@mellanox.com>
	Signed-off-by: Saeed Mahameed <saeedm@mellanox.com>
(cherry picked from commit 11af6a6d09e9a90e05f4a21564232b30c6c25d69)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/mellanox/mlx5/core/en/health.c
#	drivers/net/ethernet/mellanox/mlx5/core/en/health.h
#	drivers/net/ethernet/mellanox/mlx5/core/en_main.c
diff --cc drivers/net/ethernet/mellanox/mlx5/core/en/health.h
index cee840e40a05,b2c0ccc79b22..000000000000
--- a/drivers/net/ethernet/mellanox/mlx5/core/en/health.h
+++ b/drivers/net/ethernet/mellanox/mlx5/core/en/health.h
@@@ -6,9 -6,32 +6,39 @@@
  
  #include "en.h"
  
++<<<<<<< HEAD
 +int mlx5e_tx_reporter_create(struct mlx5e_priv *priv);
 +void mlx5e_tx_reporter_destroy(struct mlx5e_priv *priv);
 +void mlx5e_tx_reporter_err_cqe(struct mlx5e_txqsq *sq);
 +int mlx5e_tx_reporter_timeout(struct mlx5e_txqsq *sq);
++=======
+ int mlx5e_reporter_tx_create(struct mlx5e_priv *priv);
+ void mlx5e_reporter_tx_destroy(struct mlx5e_priv *priv);
+ void mlx5e_reporter_tx_err_cqe(struct mlx5e_txqsq *sq);
+ int mlx5e_reporter_tx_timeout(struct mlx5e_txqsq *sq);
+ 
+ int mlx5e_reporter_cq_diagnose(struct mlx5e_cq *cq, struct devlink_fmsg *fmsg);
+ int mlx5e_reporter_cq_common_diagnose(struct mlx5e_cq *cq, struct devlink_fmsg *fmsg);
+ int mlx5e_reporter_named_obj_nest_start(struct devlink_fmsg *fmsg, char *name);
+ int mlx5e_reporter_named_obj_nest_end(struct devlink_fmsg *fmsg);
+ 
+ #define MLX5E_REPORTER_PER_Q_MAX_LEN 256
+ 
+ struct mlx5e_err_ctx {
+ 	int (*recover)(void *ctx);
+ 	void *ctx;
+ };
+ 
+ int mlx5e_health_sq_to_ready(struct mlx5e_channel *channel, u32 sqn);
+ int mlx5e_health_channel_eq_recover(struct mlx5_eq_comp *eq, struct mlx5e_channel *channel);
+ int mlx5e_health_recover_channels(struct mlx5e_priv *priv);
+ int mlx5e_health_report(struct mlx5e_priv *priv,
+ 			struct devlink_health_reporter *reporter, char *err_str,
+ 			struct mlx5e_err_ctx *err_ctx);
+ int mlx5e_health_create_reporters(struct mlx5e_priv *priv);
+ void mlx5e_health_destroy_reporters(struct mlx5e_priv *priv);
+ void mlx5e_health_channels_update(struct mlx5e_priv *priv);
+ 
++>>>>>>> 11af6a6d09e9 (net/mlx5e: Add helper functions for reporter's basics)
  
  #endif
diff --cc drivers/net/ethernet/mellanox/mlx5/core/en_main.c
index fec94ef40e8b,f3bcb9ddca58..000000000000
--- a/drivers/net/ethernet/mellanox/mlx5/core/en_main.c
+++ b/drivers/net/ethernet/mellanox/mlx5/core/en_main.c
@@@ -3209,9 -3196,10 +3206,14 @@@ err_close_tises
  
  static void mlx5e_cleanup_nic_tx(struct mlx5e_priv *priv)
  {
 -	int tc;
  
++<<<<<<< HEAD
 +	mlx5e_tx_reporter_destroy(priv);
 +	mlx5e_destroy_tises(priv);
++=======
+ 	for (tc = 0; tc < priv->profile->max_tc; tc++)
+ 		mlx5e_destroy_tis(priv->mdev, priv->tisn[tc]);
++>>>>>>> 11af6a6d09e9 (net/mlx5e: Add helper functions for reporter's basics)
  }
  
  static void mlx5e_build_indir_tir_ctx_common(struct mlx5e_priv *priv,
@@@ -4970,6 -4964,8 +4972,11 @@@ static int mlx5e_nic_init(struct mlx5_c
  	if (err)
  		mlx5_core_err(mdev, "TLS initialization failed, %d\n", err);
  	mlx5e_build_nic_netdev(netdev);
++<<<<<<< HEAD
++=======
+ 	mlx5e_build_tc2txq_maps(priv);
+ 	mlx5e_health_create_reporters(priv);
++>>>>>>> 11af6a6d09e9 (net/mlx5e: Add helper functions for reporter's basics)
  
  	return 0;
  }
@@@ -5078,7 -5075,6 +5086,10 @@@ static int mlx5e_init_nic_tx(struct mlx
  #ifdef CONFIG_MLX5_CORE_EN_DCB
  	mlx5e_dcbnl_initialize(priv);
  #endif
++<<<<<<< HEAD
 +	mlx5e_tx_reporter_create(priv);
++=======
++>>>>>>> 11af6a6d09e9 (net/mlx5e: Add helper functions for reporter's basics)
  	return 0;
  }
  
* Unmerged path drivers/net/ethernet/mellanox/mlx5/core/en/health.c
* Unmerged path drivers/net/ethernet/mellanox/mlx5/core/en/health.c
* Unmerged path drivers/net/ethernet/mellanox/mlx5/core/en/health.h
* Unmerged path drivers/net/ethernet/mellanox/mlx5/core/en_main.c
