perf record: Support synthesizing cgroup events

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-240.el8
commit-author Namhyung Kim <namhyung@kernel.org>
commit ab64069f1a6604a43daec5fc4a4294b0b77a8b93
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-240.el8/ab64069f.failed

Synthesize cgroup events by iterating cgroup filesystem directories.
The cgroup event only saves the portion of cgroup path after the mount
point and the cgroup id (which actually is a file handle).

	Signed-off-by: Namhyung Kim <namhyung@kernel.org>
	Tested-by: Arnaldo Carvalho de Melo <acme@redhat.com>
	Cc: Alexander Shishkin <alexander.shishkin@linux.intel.com>
	Cc: Jiri Olsa <jolsa@redhat.com>
	Cc: Mark Rutland <mark.rutland@arm.com>
	Cc: Peter Zijlstra <peterz@infradead.org>
Link: http://lore.kernel.org/lkml/20200325124536.2800725-7-namhyung@kernel.org
Link: http://lore.kernel.org/lkml/20200402015249.3800462-1-namhyung@kernel.org
[ Extracted the HAVE_FILE_HANDLE from the followup patch, added missing __maybe_unused ]
	Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>
(cherry picked from commit ab64069f1a6604a43daec5fc4a4294b0b77a8b93)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	tools/perf/builtin-record.c
#	tools/perf/util/synthetic-events.c
#	tools/perf/util/synthetic-events.h
diff --cc tools/perf/builtin-record.c
index 8d9bbe9f78ab,2802de9538ff..000000000000
--- a/tools/perf/builtin-record.c
+++ b/tools/perf/builtin-record.c
@@@ -1347,7 -1397,12 +1347,16 @@@ static int record__synthesize(struct re
  	if (err < 0)
  		pr_warning("Couldn't synthesize bpf events.\n");
  
++<<<<<<< HEAD
 +	err = __machine__synthesize_threads(machine, tool, &opts->target, rec->evlist->threads,
++=======
+ 	err = perf_event__synthesize_cgroups(tool, process_synthesized_event,
+ 					     machine);
+ 	if (err < 0)
+ 		pr_warning("Couldn't synthesize cgroup events.\n");
+ 
+ 	err = __machine__synthesize_threads(machine, tool, &opts->target, rec->evlist->core.threads,
++>>>>>>> ab64069f1a66 (perf record: Support synthesizing cgroup events)
  					    process_synthesized_event, opts->sample_address,
  					    1);
  out:
* Unmerged path tools/perf/util/synthetic-events.c
* Unmerged path tools/perf/util/synthetic-events.h
* Unmerged path tools/perf/builtin-record.c
* Unmerged path tools/perf/util/synthetic-events.c
* Unmerged path tools/perf/util/synthetic-events.h
diff --git a/tools/perf/util/tool.h b/tools/perf/util/tool.h
index 9096a6e3de59..fdf86149060f 100644
--- a/tools/perf/util/tool.h
+++ b/tools/perf/util/tool.h
@@ -78,6 +78,7 @@ struct perf_tool {
 	bool		ordered_events;
 	bool		ordering_requires_timestamps;
 	bool		namespace_events;
+	bool		cgroup_events;
 	bool		no_warn;
 	enum show_feature_header show_feat_hdr;
 };
