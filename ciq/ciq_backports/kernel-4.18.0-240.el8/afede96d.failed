KVM: Drop kvm_arch_vcpu_setup()

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-240.el8
commit-author Sean Christopherson <sean.j.christopherson@intel.com>
commit afede96df55e9cba948c8cc8a682e962244285b4
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-240.el8/afede96d.failed

Remove kvm_arch_vcpu_setup() now that all arch specific implementations
are nops.

	Acked-by: Christoffer Dall <christoffer.dall@arm.com>
	Signed-off-by: Sean Christopherson <sean.j.christopherson@intel.com>
	Reviewed-by: Cornelia Huck <cohuck@redhat.com>
	Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>
(cherry picked from commit afede96df55e9cba948c8cc8a682e962244285b4)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/mips/kvm/mips.c
#	arch/s390/kvm/kvm-s390.c
#	include/linux/kvm_host.h
diff --cc arch/mips/kvm/mips.c
index 6d4b49925bf8,06366e2415a6..000000000000
--- a/arch/mips/kvm/mips.c
+++ b/arch/mips/kvm/mips.c
@@@ -1258,12 -1244,6 +1258,15 @@@ int kvm_arch_vcpu_ioctl_translate(struc
  	return 0;
  }
  
++<<<<<<< HEAD
 +/* Initial guest state */
 +int kvm_arch_vcpu_setup(struct kvm_vcpu *vcpu)
 +{
 +	return kvm_mips_callbacks->vcpu_setup(vcpu);
 +}
 +
++=======
++>>>>>>> afede96df55e (KVM: Drop kvm_arch_vcpu_setup())
  static void kvm_mips_set_c0_status(void)
  {
  	u32 status = read_c0_status();
diff --cc arch/s390/kvm/kvm-s390.c
index d6b727e2f0a2,a1bb47c7ba1e..000000000000
--- a/arch/s390/kvm/kvm-s390.c
+++ b/arch/s390/kvm/kvm-s390.c
@@@ -2937,7 -2931,7 +2937,11 @@@ static void kvm_s390_vcpu_setup_model(s
  		vcpu->arch.sie_block->fac = (u32)(u64) model->fac_list;
  }
  
++<<<<<<< HEAD
 +int kvm_arch_vcpu_setup(struct kvm_vcpu *vcpu)
++=======
+ static int kvm_s390_vcpu_setup(struct kvm_vcpu *vcpu)
++>>>>>>> afede96df55e (KVM: Drop kvm_arch_vcpu_setup())
  {
  	int rc = 0;
  
diff --cc include/linux/kvm_host.h
index 76c481d92694,87ca40f62b06..000000000000
--- a/include/linux/kvm_host.h
+++ b/include/linux/kvm_host.h
@@@ -877,8 -871,8 +877,13 @@@ void kvm_arch_sched_in(struct kvm_vcpu 
  
  void kvm_arch_vcpu_load(struct kvm_vcpu *vcpu, int cpu);
  void kvm_arch_vcpu_put(struct kvm_vcpu *vcpu);
++<<<<<<< HEAD
 +struct kvm_vcpu *kvm_arch_vcpu_create(struct kvm *kvm, unsigned int id);
 +int kvm_arch_vcpu_setup(struct kvm_vcpu *vcpu);
++=======
+ int kvm_arch_vcpu_precreate(struct kvm *kvm, unsigned int id);
+ int kvm_arch_vcpu_create(struct kvm_vcpu *vcpu);
++>>>>>>> afede96df55e (KVM: Drop kvm_arch_vcpu_setup())
  void kvm_arch_vcpu_postcreate(struct kvm_vcpu *vcpu);
  void kvm_arch_vcpu_destroy(struct kvm_vcpu *vcpu);
  
diff --git a/arch/arm/kvm/guest.c b/arch/arm/kvm/guest.c
index 2b8de885b2bf..f4a40df99151 100644
--- a/arch/arm/kvm/guest.c
+++ b/arch/arm/kvm/guest.c
@@ -42,11 +42,6 @@ struct kvm_stats_debugfs_item debugfs_entries[] = {
 	{ NULL }
 };
 
-int kvm_arch_vcpu_setup(struct kvm_vcpu *vcpu)
-{
-	return 0;
-}
-
 static u64 core_reg_offset_from_id(u64 id)
 {
 	return id & ~(KVM_REG_ARCH_MASK | KVM_REG_SIZE_MASK | KVM_REG_ARM_CORE);
diff --git a/arch/arm64/kvm/guest.c b/arch/arm64/kvm/guest.c
index b0c2ad739a60..4692fd9bdb4a 100644
--- a/arch/arm64/kvm/guest.c
+++ b/arch/arm64/kvm/guest.c
@@ -54,11 +54,6 @@ struct kvm_stats_debugfs_item debugfs_entries[] = {
 	{ NULL }
 };
 
-int kvm_arch_vcpu_setup(struct kvm_vcpu *vcpu)
-{
-	return 0;
-}
-
 static bool core_reg_offset_is_vreg(u64 off)
 {
 	return off >= KVM_REG_ARM_CORE_REG(fp_regs.vregs) &&
* Unmerged path arch/mips/kvm/mips.c
diff --git a/arch/powerpc/kvm/book3s.c b/arch/powerpc/kvm/book3s.c
index 32518d2161c0..78893235e2a9 100644
--- a/arch/powerpc/kvm/book3s.c
+++ b/arch/powerpc/kvm/book3s.c
@@ -500,11 +500,6 @@ int kvmppc_load_last_inst(struct kvm_vcpu *vcpu,
 }
 EXPORT_SYMBOL_GPL(kvmppc_load_last_inst);
 
-int kvm_arch_vcpu_setup(struct kvm_vcpu *vcpu)
-{
-	return 0;
-}
-
 int kvmppc_subarch_vcpu_init(struct kvm_vcpu *vcpu)
 {
 	return 0;
diff --git a/arch/powerpc/kvm/booke.c b/arch/powerpc/kvm/booke.c
index 18fa732cc9e7..2ef915027fad 100644
--- a/arch/powerpc/kvm/booke.c
+++ b/arch/powerpc/kvm/booke.c
@@ -1388,11 +1388,6 @@ static void kvmppc_set_tsr(struct kvm_vcpu *vcpu, u32 new_tsr)
 	update_timer_ints(vcpu);
 }
 
-int kvm_arch_vcpu_setup(struct kvm_vcpu *vcpu)
-{
-	return 0;
-}
-
 int kvmppc_subarch_vcpu_init(struct kvm_vcpu *vcpu)
 {
 	/* setup watchdog timer once */
* Unmerged path arch/s390/kvm/kvm-s390.c
* Unmerged path include/linux/kvm_host.h
diff --git a/virt/kvm/kvm_main.c b/virt/kvm/kvm_main.c
index c6256c9afce6..d411d852f6b5 100644
--- a/virt/kvm/kvm_main.c
+++ b/virt/kvm/kvm_main.c
@@ -2738,10 +2738,6 @@ static int kvm_vm_ioctl_create_vcpu(struct kvm *kvm, u32 id)
 
 	preempt_notifier_init(&vcpu->preempt_notifier, &kvm_preempt_ops);
 
-	r = kvm_arch_vcpu_setup(vcpu);
-	if (r)
-		goto vcpu_destroy;
-
 	kvm_create_vcpu_debugfs(vcpu);
 
 	mutex_lock(&kvm->lock);
@@ -2777,7 +2773,6 @@ static int kvm_vm_ioctl_create_vcpu(struct kvm *kvm, u32 id)
 unlock_vcpu_destroy:
 	mutex_unlock(&kvm->lock);
 	debugfs_remove_recursive(vcpu->debugfs_dentry);
-vcpu_destroy:
 	kvm_arch_vcpu_destroy(vcpu);
 vcpu_decrement:
 	mutex_lock(&kvm->lock);
