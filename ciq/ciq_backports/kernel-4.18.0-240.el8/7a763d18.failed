IB/core: Introduce rdma_user_mmap_entry_insert_range() API

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-240.el8
commit-author Yishai Hadas <yishaih@mellanox.com>
commit 7a763d18ff2a75cfd1014800327f4120840bef09
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-240.el8/7a763d18.failed

Introduce rdma_user_mmap_entry_insert_range() API to be used once the
required key for the given entry should be in a given range.

	Signed-off-by: Yishai Hadas <yishaih@mellanox.com>
	Signed-off-by: Leon Romanovsky <leonro@mellanox.com>
Link: https://lore.kernel.org/r/20191212100237.330654-2-leon@kernel.org
	Signed-off-by: Doug Ledford <dledford@redhat.com>
(cherry picked from commit 7a763d18ff2a75cfd1014800327f4120840bef09)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/infiniband/core/ib_core_uverbs.c
#	include/rdma/ib_verbs.h
diff --cc include/rdma/ib_verbs.h
index 9206ee9a8df3,5608e14e3aad..000000000000
--- a/include/rdma/ib_verbs.h
+++ b/include/rdma/ib_verbs.h
@@@ -2772,18 -2826,26 +2772,40 @@@ void  ib_set_client_data(struct ib_devi
  void ib_set_device_ops(struct ib_device *device,
  		       const struct ib_device_ops *ops);
  
 +#if IS_ENABLED(CONFIG_INFINIBAND_USER_ACCESS)
  int rdma_user_mmap_io(struct ib_ucontext *ucontext, struct vm_area_struct *vma,
++<<<<<<< HEAD
 +		      unsigned long pfn, unsigned long size, pgprot_t prot);
 +#else
 +static inline int rdma_user_mmap_io(struct ib_ucontext *ucontext,
 +				    struct vm_area_struct *vma,
 +				    unsigned long pfn, unsigned long size,
 +				    pgprot_t prot)
 +{
 +	return -EINVAL;
 +}
 +#endif
++=======
+ 		      unsigned long pfn, unsigned long size, pgprot_t prot,
+ 		      struct rdma_user_mmap_entry *entry);
+ int rdma_user_mmap_entry_insert(struct ib_ucontext *ucontext,
+ 				struct rdma_user_mmap_entry *entry,
+ 				size_t length);
+ int rdma_user_mmap_entry_insert_range(struct ib_ucontext *ucontext,
+ 				      struct rdma_user_mmap_entry *entry,
+ 				      size_t length, u32 min_pgoff,
+ 				      u32 max_pgoff);
+ 
+ struct rdma_user_mmap_entry *
+ rdma_user_mmap_entry_get_pgoff(struct ib_ucontext *ucontext,
+ 			       unsigned long pgoff);
+ struct rdma_user_mmap_entry *
+ rdma_user_mmap_entry_get(struct ib_ucontext *ucontext,
+ 			 struct vm_area_struct *vma);
+ void rdma_user_mmap_entry_put(struct rdma_user_mmap_entry *entry);
+ 
+ void rdma_user_mmap_entry_remove(struct rdma_user_mmap_entry *entry);
++>>>>>>> 7a763d18ff2a (IB/core: Introduce rdma_user_mmap_entry_insert_range() API)
  
  static inline int ib_copy_from_udata(void *dest, struct ib_udata *udata, size_t len)
  {
* Unmerged path drivers/infiniband/core/ib_core_uverbs.c
* Unmerged path drivers/infiniband/core/ib_core_uverbs.c
* Unmerged path include/rdma/ib_verbs.h
