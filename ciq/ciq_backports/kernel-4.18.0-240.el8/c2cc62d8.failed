arm64: Enable and document ARM errata 1319367 and 1319537

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-240.el8
Rebuild_CHGLOG: - [arm64] Enable and document ARM errata 1319367 and 1319537 (Gavin Shan) [1814009]
Rebuild_FUZZ: 93.46%
commit-author Marc Zyngier <maz@kernel.org>
commit c2cc62d831863151fd0cb7da7ac9a0c324aab871
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-240.el8/c2cc62d8.failed

Now that everything is in place, let's get the ball rolling
by allowing the corresponding config option to be selected.
Also add the required information to silicon_errata.rst.

	Acked-by: Catalin Marinas <catalin.marinas@arm.com>
	Signed-off-by: Marc Zyngier <maz@kernel.org>
(cherry picked from commit c2cc62d831863151fd0cb7da7ac9a0c324aab871)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	Documentation/arm64/silicon-errata.txt
diff --cc Documentation/arm64/silicon-errata.txt
index cb28aba3d2a4,0808be134fce..000000000000
--- a/Documentation/arm64/silicon-errata.txt
+++ b/Documentation/arm64/silicon-errata.txt
@@@ -42,48 -46,94 +42,58 @@@ file acts as a registry of software wor
  will be updated when new workarounds are committed and backported to
  stable kernels.
  
 -+----------------+-----------------+-----------------+-----------------------------+
  | Implementor    | Component       | Erratum ID      | Kconfig                     |
 -+================+=================+=================+=============================+
 -| Allwinner      | A64/R18         | UNKNOWN1        | SUN50I_ERRATUM_UNKNOWN1     |
 -+----------------+-----------------+-----------------+-----------------------------+
  +----------------+-----------------+-----------------+-----------------------------+
  | ARM            | Cortex-A53      | #826319         | ARM64_ERRATUM_826319        |
 -+----------------+-----------------+-----------------+-----------------------------+
  | ARM            | Cortex-A53      | #827319         | ARM64_ERRATUM_827319        |
 -+----------------+-----------------+-----------------+-----------------------------+
  | ARM            | Cortex-A53      | #824069         | ARM64_ERRATUM_824069        |
 -+----------------+-----------------+-----------------+-----------------------------+
  | ARM            | Cortex-A53      | #819472         | ARM64_ERRATUM_819472        |
 -+----------------+-----------------+-----------------+-----------------------------+
  | ARM            | Cortex-A53      | #845719         | ARM64_ERRATUM_845719        |
 -+----------------+-----------------+-----------------+-----------------------------+
  | ARM            | Cortex-A53      | #843419         | ARM64_ERRATUM_843419        |
 -+----------------+-----------------+-----------------+-----------------------------+
  | ARM            | Cortex-A57      | #832075         | ARM64_ERRATUM_832075        |
 -+----------------+-----------------+-----------------+-----------------------------+
  | ARM            | Cortex-A57      | #852523         | N/A                         |
 -+----------------+-----------------+-----------------+-----------------------------+
  | ARM            | Cortex-A57      | #834220         | ARM64_ERRATUM_834220        |
++<<<<<<< HEAD:Documentation/arm64/silicon-errata.txt
 +| ARM            | Cortex-A72      | #853709         | N/A                         |
++=======
+ +----------------+-----------------+-----------------+-----------------------------+
+ | ARM            | Cortex-A57      | #1319537        | ARM64_ERRATUM_1319367       |
+ +----------------+-----------------+-----------------+-----------------------------+
+ | ARM            | Cortex-A72      | #853709         | N/A                         |
+ +----------------+-----------------+-----------------+-----------------------------+
+ | ARM            | Cortex-A72      | #1319367        | ARM64_ERRATUM_1319367       |
+ +----------------+-----------------+-----------------+-----------------------------+
++>>>>>>> c2cc62d83186 (arm64: Enable and document ARM errata 1319367 and 1319537):Documentation/arm64/silicon-errata.rst
  | ARM            | Cortex-A73      | #858921         | ARM64_ERRATUM_858921        |
 -+----------------+-----------------+-----------------+-----------------------------+
  | ARM            | Cortex-A55      | #1024718        | ARM64_ERRATUM_1024718       |
 -+----------------+-----------------+-----------------+-----------------------------+
  | ARM            | Cortex-A76      | #1188873,1418040| ARM64_ERRATUM_1418040       |
 -+----------------+-----------------+-----------------+-----------------------------+
  | ARM            | Cortex-A76      | #1165522        | ARM64_ERRATUM_1165522       |
 -+----------------+-----------------+-----------------+-----------------------------+
  | ARM            | Cortex-A76      | #1286807        | ARM64_ERRATUM_1286807       |
 -+----------------+-----------------+-----------------+-----------------------------+
  | ARM            | Cortex-A76      | #1463225        | ARM64_ERRATUM_1463225       |
 -+----------------+-----------------+-----------------+-----------------------------+
 +| ARM            | Neoverse-N1     | #1349291        | N/A                         |
  | ARM            | Neoverse-N1     | #1188873,1418040| ARM64_ERRATUM_1418040       |
 -+----------------+-----------------+-----------------+-----------------------------+
  | ARM            | Neoverse-N1     | #1349291        | N/A                         |
 -+----------------+-----------------+-----------------+-----------------------------+
 +| ARM            | Neoverse-N1     | #1542419        | ARM64_ERRATUM_1542419       |
  | ARM            | MMU-500         | #841119,826419  | N/A                         |
 -+----------------+-----------------+-----------------+-----------------------------+
 -+----------------+-----------------+-----------------+-----------------------------+
 +|                |                 |                 |                             |
  | Cavium         | ThunderX ITS    | #22375,24313    | CAVIUM_ERRATUM_22375        |
 -+----------------+-----------------+-----------------+-----------------------------+
  | Cavium         | ThunderX ITS    | #23144          | CAVIUM_ERRATUM_23144        |
 -+----------------+-----------------+-----------------+-----------------------------+
  | Cavium         | ThunderX GICv3  | #23154          | CAVIUM_ERRATUM_23154        |
 -+----------------+-----------------+-----------------+-----------------------------+
  | Cavium         | ThunderX Core   | #27456          | CAVIUM_ERRATUM_27456        |
 -+----------------+-----------------+-----------------+-----------------------------+
  | Cavium         | ThunderX Core   | #30115          | CAVIUM_ERRATUM_30115        |
 -+----------------+-----------------+-----------------+-----------------------------+
  | Cavium         | ThunderX SMMUv2 | #27704          | N/A                         |
 -+----------------+-----------------+-----------------+-----------------------------+
  | Cavium         | ThunderX2 SMMUv3| #74             | N/A                         |
 -+----------------+-----------------+-----------------+-----------------------------+
  | Cavium         | ThunderX2 SMMUv3| #126            | N/A                         |
 -+----------------+-----------------+-----------------+-----------------------------+
 -+----------------+-----------------+-----------------+-----------------------------+
 +| Cavium         | ThunderX2 Core  | #219            | CAVIUM_TX2_ERRATUM_219      |
 +|                |                 |                 |                             |
  | Freescale/NXP  | LS2080A/LS1043A | A-008585        | FSL_ERRATUM_A008585         |
 -+----------------+-----------------+-----------------+-----------------------------+
 -+----------------+-----------------+-----------------+-----------------------------+
 +|                |                 |                 |                             |
  | Hisilicon      | Hip0{5,6,7}     | #161010101      | HISILICON_ERRATUM_161010101 |
 -+----------------+-----------------+-----------------+-----------------------------+
  | Hisilicon      | Hip0{6,7}       | #161010701      | N/A                         |
 -+----------------+-----------------+-----------------+-----------------------------+
 -| Hisilicon      | Hip0{6,7}       | #161010803      | N/A                         |
 -+----------------+-----------------+-----------------+-----------------------------+
  | Hisilicon      | Hip07           | #161600802      | HISILICON_ERRATUM_161600802 |
 -+----------------+-----------------+-----------------+-----------------------------+
 -| Hisilicon      | Hip08 SMMU PMCG | #162001800      | N/A                         |
 -+----------------+-----------------+-----------------+-----------------------------+
 -+----------------+-----------------+-----------------+-----------------------------+
 +|                |                 |                 |                             |
  | Qualcomm Tech. | Kryo/Falkor v1  | E1003           | QCOM_FALKOR_ERRATUM_1003    |
 -+----------------+-----------------+-----------------+-----------------------------+
  | Qualcomm Tech. | Falkor v1       | E1009           | QCOM_FALKOR_ERRATUM_1009    |
 -+----------------+-----------------+-----------------+-----------------------------+
  | Qualcomm Tech. | QDF2400 ITS     | E0065           | QCOM_QDF2400_ERRATUM_0065   |
 -+----------------+-----------------+-----------------+-----------------------------+
  | Qualcomm Tech. | Falkor v{1,2}   | E1041           | QCOM_FALKOR_ERRATUM_1041    |
 -+----------------+-----------------+-----------------+-----------------------------+
 -+----------------+-----------------+-----------------+-----------------------------+
  | Fujitsu        | A64FX           | E#010001        | FUJITSU_ERRATUM_010001      |
 -+----------------+-----------------+-----------------+-----------------------------+
* Unmerged path Documentation/arm64/silicon-errata.txt
diff --git a/arch/arm64/Kconfig b/arch/arm64/Kconfig
index d9a7ce52dbae..683050d297b8 100644
--- a/arch/arm64/Kconfig
+++ b/arch/arm64/Kconfig
@@ -538,6 +538,16 @@ config ARM64_ERRATUM_1286807
 	  invalidated has been observed by other observers. The
 	  workaround repeats the TLBI+DSB operation.
 
+config ARM64_ERRATUM_1319367
+	bool "Cortex-A57/A72: Speculative AT instruction using out-of-context translation regime could cause subsequent request to generate an incorrect translation"
+	default y
+	help
+	  This option adds work arounds for ARM Cortex-A57 erratum 1319537
+	  and A72 erratum 1319367
+
+	  Cortex-A57 and A72 cores could end-up with corrupted TLBs by
+	  speculating an AT instruction during a guest context switch.
+
 	  If unsure, say Y.
 
 config ARM64_ERRATUM_1463225
