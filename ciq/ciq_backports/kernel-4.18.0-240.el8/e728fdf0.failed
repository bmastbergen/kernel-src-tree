net: phy: improve definition of __ETHTOOL_LINK_MODE_MASK_NBITS

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-240.el8
Rebuild_CHGLOG: - [net] phy: improve definition of __ETHTOOL_LINK_MODE_MASK_NBITS (Ivan Vecera) [1828942]
Rebuild_FUZZ: 95.80%
commit-author Heiner Kallweit <hkallweit1@gmail.com>
commit e728fdf0628971d43cb4e48860defc6e8a553761
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-240.el8/e728fdf0.failed

The way to define __ETHTOOL_LINK_MODE_MASK_NBITS seems to be overly
complicated, go with a standard approach instead.
Whilst we're at it, move the comment to the right place.

v2:
- rebased

	Signed-off-by: Heiner Kallweit <hkallweit1@gmail.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit e728fdf0628971d43cb4e48860defc6e8a553761)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	include/uapi/linux/ethtool.h
diff --cc include/uapi/linux/ethtool.h
index 1bc43c6656f6,3652b239dad1..000000000000
--- a/include/uapi/linux/ethtool.h
+++ b/include/uapi/linux/ethtool.h
@@@ -1481,22 -1476,8 +1488,27 @@@ enum ethtool_link_mode_bit_indices 
  	ETHTOOL_LINK_MODE_200000baseDR4_Full_BIT	 = 65,
  	ETHTOOL_LINK_MODE_200000baseCR4_Full_BIT	 = 66,
  
++<<<<<<< HEAD
 +	/* Last allowed bit for __ETHTOOL_LINK_MODE_LEGACY_MASK is bit
 +	 * 31. Please do NOT define any SUPPORTED_* or ADVERTISED_*
 +	 * macro for bits > 31. The only way to use indices > 31 is to
 +	 * use the new ETHTOOL_GLINKSETTINGS/ETHTOOL_SLINKSETTINGS API.
 +	 */
 +
 +	/* RHEL */
 +	__ETHTOOL_LINK_MODE_LAST_RH80
 +	  = ETHTOOL_LINK_MODE_FEC_BASER_BIT,
 +
 +	__ETHTOOL_LINK_MODE_LAST
 +#ifndef __GENKSYMS__
 +	  = ETHTOOL_LINK_MODE_200000baseCR4_Full_BIT,
 +#else
 +	  = __ETHTOOL_LINK_MODE_LAST_RH80,
 +#endif
++=======
+ 	/* must be last entry */
+ 	__ETHTOOL_LINK_MODE_MASK_NBITS
++>>>>>>> e728fdf06289 (net: phy: improve definition of __ETHTOOL_LINK_MODE_MASK_NBITS)
  };
  
  #define __ETHTOOL_LINK_MODE_LEGACY_MASK(base_name)	\
diff --git a/include/linux/ethtool.h b/include/linux/ethtool.h
index bac06075a24b..8365362ce311 100644
--- a/include/linux/ethtool.h
+++ b/include/linux/ethtool.h
@@ -100,10 +100,6 @@ static inline u32 ethtool_rxfh_indir_default(u32 index, u32 n_rx_rings)
 	return index % n_rx_rings;
 }
 
-/* number of link mode bits/ulongs handled internally by kernel */
-#define __ETHTOOL_LINK_MODE_MASK_NBITS			\
-	(__ETHTOOL_LINK_MODE_LAST + 1)
-
 /* declare a link mode bitmap */
 #define __ETHTOOL_DECLARE_LINK_MODE_MASK(name)		\
 	DECLARE_BITMAP(name, __ETHTOOL_LINK_MODE_MASK_NBITS)
* Unmerged path include/uapi/linux/ethtool.h
