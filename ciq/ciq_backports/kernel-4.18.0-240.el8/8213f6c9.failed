net: be2net: reject unsupported coalescing params

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-240.el8
commit-author Jakub Kicinski <kuba@kernel.org>
commit 8213f6c9a275da084dc9363f36f93138547f46f1
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-240.el8/8213f6c9.failed

Set ethtool_ops->supported_coalesce_params to let
the core reject unsupported coalescing parameters.

This driver did not previously reject unsupported parameters.

	Signed-off-by: Jakub Kicinski <kuba@kernel.org>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 8213f6c9a275da084dc9363f36f93138547f46f1)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	include/linux/ethtool.h
diff --cc include/linux/ethtool.h
index bac06075a24b,acfce915a02b..000000000000
--- a/include/linux/ethtool.h
+++ b/include/linux/ethtool.h
@@@ -183,8 -177,48 +183,53 @@@ void ethtool_convert_legacy_u32_to_link
  bool ethtool_convert_link_mode_to_legacy_u32(u32 *legacy_u32,
  				     const unsigned long *src);
  
++<<<<<<< HEAD
 +struct ethtool_ops_extended_rh {
 +};
++=======
+ #define ETHTOOL_COALESCE_RX_USECS		BIT(0)
+ #define ETHTOOL_COALESCE_RX_MAX_FRAMES		BIT(1)
+ #define ETHTOOL_COALESCE_RX_USECS_IRQ		BIT(2)
+ #define ETHTOOL_COALESCE_RX_MAX_FRAMES_IRQ	BIT(3)
+ #define ETHTOOL_COALESCE_TX_USECS		BIT(4)
+ #define ETHTOOL_COALESCE_TX_MAX_FRAMES		BIT(5)
+ #define ETHTOOL_COALESCE_TX_USECS_IRQ		BIT(6)
+ #define ETHTOOL_COALESCE_TX_MAX_FRAMES_IRQ	BIT(7)
+ #define ETHTOOL_COALESCE_STATS_BLOCK_USECS	BIT(8)
+ #define ETHTOOL_COALESCE_USE_ADAPTIVE_RX	BIT(9)
+ #define ETHTOOL_COALESCE_USE_ADAPTIVE_TX	BIT(10)
+ #define ETHTOOL_COALESCE_PKT_RATE_LOW		BIT(11)
+ #define ETHTOOL_COALESCE_RX_USECS_LOW		BIT(12)
+ #define ETHTOOL_COALESCE_RX_MAX_FRAMES_LOW	BIT(13)
+ #define ETHTOOL_COALESCE_TX_USECS_LOW		BIT(14)
+ #define ETHTOOL_COALESCE_TX_MAX_FRAMES_LOW	BIT(15)
+ #define ETHTOOL_COALESCE_PKT_RATE_HIGH		BIT(16)
+ #define ETHTOOL_COALESCE_RX_USECS_HIGH		BIT(17)
+ #define ETHTOOL_COALESCE_RX_MAX_FRAMES_HIGH	BIT(18)
+ #define ETHTOOL_COALESCE_TX_USECS_HIGH		BIT(19)
+ #define ETHTOOL_COALESCE_TX_MAX_FRAMES_HIGH	BIT(20)
+ #define ETHTOOL_COALESCE_RATE_SAMPLE_INTERVAL	BIT(21)
+ 
+ #define ETHTOOL_COALESCE_USECS						\
+ 	(ETHTOOL_COALESCE_RX_USECS | ETHTOOL_COALESCE_TX_USECS)
+ #define ETHTOOL_COALESCE_MAX_FRAMES					\
+ 	(ETHTOOL_COALESCE_RX_MAX_FRAMES | ETHTOOL_COALESCE_TX_MAX_FRAMES)
+ #define ETHTOOL_COALESCE_USECS_IRQ					\
+ 	(ETHTOOL_COALESCE_RX_USECS_IRQ | ETHTOOL_COALESCE_TX_USECS_IRQ)
+ #define ETHTOOL_COALESCE_MAX_FRAMES_IRQ		\
+ 	(ETHTOOL_COALESCE_RX_MAX_FRAMES_IRQ |	\
+ 	 ETHTOOL_COALESCE_TX_MAX_FRAMES_IRQ)
+ #define ETHTOOL_COALESCE_USE_ADAPTIVE					\
+ 	(ETHTOOL_COALESCE_USE_ADAPTIVE_RX | ETHTOOL_COALESCE_USE_ADAPTIVE_TX)
+ #define ETHTOOL_COALESCE_USECS_LOW_HIGH					\
+ 	(ETHTOOL_COALESCE_RX_USECS_LOW | ETHTOOL_COALESCE_TX_USECS_LOW | \
+ 	 ETHTOOL_COALESCE_RX_USECS_HIGH | ETHTOOL_COALESCE_TX_USECS_HIGH)
+ #define ETHTOOL_COALESCE_PKT_RATE_RX_USECS				\
+ 	(ETHTOOL_COALESCE_USE_ADAPTIVE_RX |				\
+ 	 ETHTOOL_COALESCE_RX_USECS_LOW | ETHTOOL_COALESCE_RX_USECS_HIGH | \
+ 	 ETHTOOL_COALESCE_PKT_RATE_LOW | ETHTOOL_COALESCE_PKT_RATE_HIGH | \
+ 	 ETHTOOL_COALESCE_RATE_SAMPLE_INTERVAL)
++>>>>>>> 8213f6c9a275 (net: be2net: reject unsupported coalescing params)
  
  /**
   * struct ethtool_ops - optional netdev operations
diff --git a/drivers/net/ethernet/emulex/benet/be_ethtool.c b/drivers/net/ethernet/emulex/benet/be_ethtool.c
index 5bb5abf99588..7036b8371a69 100644
--- a/drivers/net/ethernet/emulex/benet/be_ethtool.c
+++ b/drivers/net/ethernet/emulex/benet/be_ethtool.c
@@ -1409,6 +1409,9 @@ static int be_set_priv_flags(struct net_device *netdev, u32 flags)
 }
 
 const struct ethtool_ops be_ethtool_ops = {
+	.supported_coalesce_params = ETHTOOL_COALESCE_USECS |
+				     ETHTOOL_COALESCE_USE_ADAPTIVE |
+				     ETHTOOL_COALESCE_USECS_LOW_HIGH,
 	.get_drvinfo = be_get_drvinfo,
 	.get_wol = be_get_wol,
 	.set_wol = be_set_wol,
* Unmerged path include/linux/ethtool.h
