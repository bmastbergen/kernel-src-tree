nfsd: avoid a NULL dereference in __cld_pipe_upcall()

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-240.el8
commit-author Scott Mayhew <smayhew@redhat.com>
commit df60446cd1fb487becd1f36f4c0da9e0e523c0cf
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-240.el8/df60446c.failed

If the rpc_pipefs is unmounted, then the rpc_pipe->dentry becomes NULL
and dereferencing the dentry->d_sb will trigger an oops.  The only
reason we're doing that is to determine the nfsd_net, which could
instead be passed in by the caller.  So do that instead.

Fixes: 11a60d159259 ("nfsd: add a "GetVersion" upcall for nfsdcld")
	Signed-off-by: Scott Mayhew <smayhew@redhat.com>
	Signed-off-by: Chuck Lever <chuck.lever@oracle.com>
(cherry picked from commit df60446cd1fb487becd1f36f4c0da9e0e523c0cf)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	fs/nfsd/nfs4recover.c
diff --cc fs/nfsd/nfs4recover.c
index 3e80f9f6ea99,186fa2c2c6ba..000000000000
--- a/fs/nfsd/nfs4recover.c
+++ b/fs/nfsd/nfs4recover.c
@@@ -1446,8 -1429,8 +1444,13 @@@ nfsd4_cld_grace_done_v0(struct nfsd_ne
  	}
  
  	cup->cu_u.cu_msg.cm_cmd = Cld_GraceDone;
++<<<<<<< HEAD
 +	cup->cu_u.cu_msg.cm_u.cm_gracetime = (int64_t)nn->boot_time;
 +	ret = cld_pipe_upcall(cn->cn_pipe, &cup->cu_u.cu_msg);
++=======
+ 	cup->cu_u.cu_msg.cm_u.cm_gracetime = nn->boot_time;
+ 	ret = cld_pipe_upcall(cn->cn_pipe, &cup->cu_u.cu_msg, nn);
++>>>>>>> df60446cd1fb (nfsd: avoid a NULL dereference in __cld_pipe_upcall())
  	if (!ret)
  		ret = cup->cu_u.cu_msg.cm_status;
  
* Unmerged path fs/nfsd/nfs4recover.c
