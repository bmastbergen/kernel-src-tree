perf pmu: Refactor pmu_add_cpu_aliases()

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-240.el8
commit-author John Garry <john.garry@huawei.com>
commit e45ad701e784e0eed8a07b537b47afb302c59dab
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-240.el8/e45ad701.failed

Create pmu_add_cpu_aliases_map() from pmu_add_cpu_aliases(), so the caller
can pass the map; the pmu-events test would use this since there would
be no CPUID matching to a mapfile there.

	Signed-off-by: John Garry <john.garry@huawei.com>
	Acked-by: Jiri Olsa <jolsa@redhat.com>
	Cc: Alexander Shishkin <alexander.shishkin@linux.intel.com>
	Cc: Andi Kleen <ak@linux.intel.com>
	Cc: James Clark <james.clark@arm.com>
	Cc: Joakim Zhang <qiangqing.zhang@nxp.com>
	Cc: Mark Rutland <mark.rutland@arm.com>
	Cc: Namhyung Kim <namhyung@kernel.org>
	Cc: Peter Zijlstra <peterz@infradead.org>
	Cc: Will Deacon <will@kernel.org>
	Cc: linuxarm@huawei.com
Link: http://lore.kernel.org/lkml/1584442939-8911-4-git-send-email-john.garry@huawei.com
	Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>
(cherry picked from commit e45ad701e784e0eed8a07b537b47afb302c59dab)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	tools/perf/util/pmu.c
diff --cc tools/perf/util/pmu.c
index 1820b31e1c9b,c616a06a34a8..000000000000
--- a/tools/perf/util/pmu.c
+++ b/tools/perf/util/pmu.c
@@@ -15,13 -16,14 +15,16 @@@
  #include <api/fs/fs.h>
  #include <locale.h>
  #include <regex.h>
 -#include <perf/cpumap.h>
 -#include "debug.h"
  #include "pmu.h"
  #include "parse-events.h"
 +#include "cpumap.h"
  #include "header.h"
++<<<<<<< HEAD
 +#include "pmu-events/pmu-events.h"
 +#include "cache.h"
++=======
++>>>>>>> e45ad701e784 (perf pmu: Refactor pmu_add_cpu_aliases())
  #include "string2.h"
 -#include "strbuf.h"
 -#include "fncache.h"
  
  struct perf_pmu_format {
  	char *name;
* Unmerged path tools/perf/util/pmu.c
diff --git a/tools/perf/util/pmu.h b/tools/perf/util/pmu.h
index 2cd150bd5ec8..7d1ef0ef9ba8 100644
--- a/tools/perf/util/pmu.h
+++ b/tools/perf/util/pmu.h
@@ -7,6 +7,7 @@
 #include <linux/perf_event.h>
 #include <stdbool.h>
 #include "parse-events.h"
+#include "pmu-events/pmu-events.h"
 
 struct perf_evsel_config_term;
 
@@ -95,6 +96,8 @@ int perf_pmu__scan_file(struct perf_pmu *pmu, const char *name, const char *fmt,
 int perf_pmu__test(void);
 
 struct perf_event_attr *perf_pmu__get_default_config(struct perf_pmu *pmu);
+void pmu_add_cpu_aliases_map(struct list_head *head, struct perf_pmu *pmu,
+			     struct pmu_events_map *map);
 
 struct pmu_events_map *perf_pmu__find_map(struct perf_pmu *pmu);
 
