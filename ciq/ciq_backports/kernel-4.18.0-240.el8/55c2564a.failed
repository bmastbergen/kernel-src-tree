iommu: amd: Use generic_iommu_put_resv_regions()

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-240.el8
commit-author Thierry Reding <treding@nvidia.com>
commit 55c2564a6852d27d34938ec748a5f3903b335a0b
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-240.el8/55c2564a.failed

Use the new standard function instead of open-coding it.

	Signed-off-by: Thierry Reding <treding@nvidia.com>
	Signed-off-by: Joerg Roedel <jroedel@suse.de>
(cherry picked from commit 55c2564a6852d27d34938ec748a5f3903b335a0b)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/iommu/amd_iommu.c
diff --cc drivers/iommu/amd_iommu.c
index 6213e619c569,2c336b87f340..000000000000
--- a/drivers/iommu/amd_iommu.c
+++ b/drivers/iommu/amd_iommu.c
@@@ -3228,28 -2641,6 +3228,31 @@@ static void amd_iommu_get_resv_regions(
  	list_add_tail(&region->list, head);
  }
  
++<<<<<<< HEAD
 +static void amd_iommu_put_resv_regions(struct device *dev,
 +				     struct list_head *head)
 +{
 +	struct iommu_resv_region *entry, *next;
 +
 +	list_for_each_entry_safe(entry, next, head, list)
 +		kfree(entry);
 +}
 +
 +static void amd_iommu_apply_resv_region(struct device *dev,
 +				      struct iommu_domain *domain,
 +				      struct iommu_resv_region *region)
 +{
 +	struct dma_ops_domain *dma_dom = to_dma_ops_domain(to_pdomain(domain));
 +	unsigned long start, end;
 +
 +	start = IOVA_PFN(region->start);
 +	end   = IOVA_PFN(region->start + region->length - 1);
 +
 +	WARN_ON_ONCE(reserve_iova(&dma_dom->iovad, start, end) == NULL);
 +}
 +
++=======
++>>>>>>> 55c2564a6852 (iommu: amd: Use generic_iommu_put_resv_regions())
  static bool amd_iommu_is_attach_deferred(struct iommu_domain *domain,
  					 struct device *dev)
  {
@@@ -3286,9 -2677,9 +3289,13 @@@ const struct iommu_ops amd_iommu_ops = 
  	.add_device = amd_iommu_add_device,
  	.remove_device = amd_iommu_remove_device,
  	.device_group = amd_iommu_device_group,
 -	.domain_get_attr = amd_iommu_domain_get_attr,
  	.get_resv_regions = amd_iommu_get_resv_regions,
++<<<<<<< HEAD
 +	.put_resv_regions = amd_iommu_put_resv_regions,
 +	.apply_resv_region = amd_iommu_apply_resv_region,
++=======
+ 	.put_resv_regions = generic_iommu_put_resv_regions,
++>>>>>>> 55c2564a6852 (iommu: amd: Use generic_iommu_put_resv_regions())
  	.is_attach_deferred = amd_iommu_is_attach_deferred,
  	.pgsize_bitmap	= AMD_IOMMU_PGSIZES,
  	.flush_iotlb_all = amd_iommu_flush_iotlb_all,
* Unmerged path drivers/iommu/amd_iommu.c
