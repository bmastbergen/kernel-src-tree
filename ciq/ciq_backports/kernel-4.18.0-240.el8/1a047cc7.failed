powerpc/pseries/dma: Enable SWIOTLB

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-240.el8
commit-author Alexey Kardashevskiy <aik@ozlabs.ru>
commit 1a047cc7e53cb10e4706c09f6e92b2fa911a2bf2
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-240.el8/1a047cc7.failed

So far the pseries platforms has always been using IOMMU making
SWIOTLB unnecessary. Now we want secure guests which means devices can
only access certain areas of guest physical memory; we are going to
use SWIOTLB for this purpose.

This allows SWIOTLB for pseries. By default there is no change in
behavior.

This enables SWIOTLB when the "swiotlb" kernel parameter is set to
"force".

With the SWIOTLB enabled, the kernel creates a directly mapped DMA
window (using the usual DDW mechanism) and implements SWIOTLB on top
of that.

	Signed-off-by: Alexey Kardashevskiy <aik@ozlabs.ru>
	Signed-off-by: Michael Ellerman <mpe@ellerman.id.au>
(cherry picked from commit 1a047cc7e53cb10e4706c09f6e92b2fa911a2bf2)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/powerpc/platforms/pseries/setup.c
diff --cc arch/powerpc/platforms/pseries/setup.c
index 16d0569700f5,30d72b587ac5..000000000000
--- a/arch/powerpc/platforms/pseries/setup.c
+++ b/arch/powerpc/platforms/pseries/setup.c
@@@ -70,6 -71,8 +71,11 @@@
  #include <asm/kexec.h>
  #include <asm/isa-bridge.h>
  #include <asm/security_features.h>
++<<<<<<< HEAD
++=======
+ #include <asm/asm-const.h>
+ #include <asm/swiotlb.h>
++>>>>>>> 1a047cc7e53c (powerpc/pseries/dma: Enable SWIOTLB)
  
  #include "pseries.h"
  #include "../../../../drivers/pci/pci.h"
* Unmerged path arch/powerpc/platforms/pseries/setup.c
