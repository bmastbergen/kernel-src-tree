xprtrdma: Replace dprintk in xprt_rdma_set_port

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-240.el8
commit-author Chuck Lever <chuck.lever@oracle.com>
commit a52c23b8b207d676d6cdf531af482a79fa622b9d
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-240.el8/a52c23b8.failed

	Signed-off-by: Chuck Lever <chuck.lever@oracle.com>
	Signed-off-by: Anna Schumaker <Anna.Schumaker@Netapp.com>
(cherry picked from commit a52c23b8b207d676d6cdf531af482a79fa622b9d)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	include/trace/events/rpcrdma.h
diff --cc include/trace/events/rpcrdma.h
index cfe761e490ec,69a8278e5cef..000000000000
--- a/include/trace/events/rpcrdma.h
+++ b/include/trace/events/rpcrdma.h
@@@ -370,10 -414,38 +370,43 @@@ DEFINE_RXPRT_EVENT(xprtrdma_create)
  DEFINE_RXPRT_EVENT(xprtrdma_op_destroy);
  DEFINE_RXPRT_EVENT(xprtrdma_remove);
  DEFINE_RXPRT_EVENT(xprtrdma_reinsert);
 +DEFINE_RXPRT_EVENT(xprtrdma_reconnect);
  DEFINE_RXPRT_EVENT(xprtrdma_op_inject_dsc);
  DEFINE_RXPRT_EVENT(xprtrdma_op_close);
++<<<<<<< HEAD
 +DEFINE_RXPRT_EVENT(xprtrdma_op_connect);
++=======
+ DEFINE_RXPRT_EVENT(xprtrdma_op_setport);
+ 
+ TRACE_EVENT(xprtrdma_op_connect,
+ 	TP_PROTO(
+ 		const struct rpcrdma_xprt *r_xprt,
+ 		unsigned long delay
+ 	),
+ 
+ 	TP_ARGS(r_xprt, delay),
+ 
+ 	TP_STRUCT__entry(
+ 		__field(const void *, r_xprt)
+ 		__field(unsigned long, delay)
+ 		__string(addr, rpcrdma_addrstr(r_xprt))
+ 		__string(port, rpcrdma_portstr(r_xprt))
+ 	),
+ 
+ 	TP_fast_assign(
+ 		__entry->r_xprt = r_xprt;
+ 		__entry->delay = delay;
+ 		__assign_str(addr, rpcrdma_addrstr(r_xprt));
+ 		__assign_str(port, rpcrdma_portstr(r_xprt));
+ 	),
+ 
+ 	TP_printk("peer=[%s]:%s r_xprt=%p delay=%lu",
+ 		__get_str(addr), __get_str(port), __entry->r_xprt,
+ 		__entry->delay
+ 	)
+ );
+ 
++>>>>>>> a52c23b8b207 (xprtrdma: Replace dprintk in xprt_rdma_set_port)
  
  TRACE_EVENT(xprtrdma_op_set_cto,
  	TP_PROTO(
* Unmerged path include/trace/events/rpcrdma.h
diff --git a/net/sunrpc/xprtrdma/transport.c b/net/sunrpc/xprtrdma/transport.c
index ac2053971f3a..eb7e62828992 100644
--- a/net/sunrpc/xprtrdma/transport.c
+++ b/net/sunrpc/xprtrdma/transport.c
@@ -451,12 +451,6 @@ xprt_rdma_set_port(struct rpc_xprt *xprt, u16 port)
 	struct sockaddr *sap = (struct sockaddr *)&xprt->addr;
 	char buf[8];
 
-	dprintk("RPC:       %s: setting port for xprt %p (%s:%s) to %u\n",
-		__func__, xprt,
-		xprt->address_strings[RPC_DISPLAY_ADDR],
-		xprt->address_strings[RPC_DISPLAY_PORT],
-		port);
-
 	rpc_set_port(sap, port);
 
 	kfree(xprt->address_strings[RPC_DISPLAY_PORT]);
@@ -466,6 +460,9 @@ xprt_rdma_set_port(struct rpc_xprt *xprt, u16 port)
 	kfree(xprt->address_strings[RPC_DISPLAY_HEX_PORT]);
 	snprintf(buf, sizeof(buf), "%4hx", port);
 	xprt->address_strings[RPC_DISPLAY_HEX_PORT] = kstrdup(buf, GFP_KERNEL);
+
+	trace_xprtrdma_op_setport(container_of(xprt, struct rpcrdma_xprt,
+					       rx_xprt));
 }
 
 /**
