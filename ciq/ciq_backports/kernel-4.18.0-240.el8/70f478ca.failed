net/mlx5e: Fix nest_level for vlan pop action

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-240.el8
commit-author Dmytro Linkin <dmitrolin@mellanox.com>
commit 70f478ca085deec4d6c1f187f773f5827ddce7e8
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-240.el8/70f478ca.failed

Current value of nest_level, assigned from net_device lower_level value,
does not reflect the actual number of vlan headers, needed to pop.
For ex., if we have untagged ingress traffic sended over vlan devices,
instead of one pop action, driver will perform two pop actions.
To fix that, calculate nest_level as difference between vlan device and
parent device lower_levels.

Fixes: f3b0a18bb6cb ("net: remove unnecessary variables and callback")
	Signed-off-by: Dmytro Linkin <dmitrolin@mellanox.com>
	Signed-off-by: Roi Dayan <roid@mellanox.com>
	Signed-off-by: Saeed Mahameed <saeedm@mellanox.com>
(cherry picked from commit 70f478ca085deec4d6c1f187f773f5827ddce7e8)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/mellanox/mlx5/core/en_tc.c
diff --cc drivers/net/ethernet/mellanox/mlx5/core/en_tc.c
index 123069223147,e3fee837c7a3..000000000000
--- a/drivers/net/ethernet/mellanox/mlx5/core/en_tc.c
+++ b/drivers/net/ethernet/mellanox/mlx5/core/en_tc.c
@@@ -3226,7 -3558,6 +3226,10 @@@ static int add_vlan_pop_action(struct m
  			       struct mlx5_esw_flow_attr *attr,
  			       u32 *action)
  {
++<<<<<<< HEAD
 +	int nest_level = vlan_get_encap_level(attr->parse_attr->filter_dev);
++=======
++>>>>>>> 70f478ca085d (net/mlx5e: Fix nest_level for vlan pop action)
  	struct flow_action_entry vlan_act = {
  		.id = FLOW_ACTION_VLAN_POP,
  	};
* Unmerged path drivers/net/ethernet/mellanox/mlx5/core/en_tc.c
