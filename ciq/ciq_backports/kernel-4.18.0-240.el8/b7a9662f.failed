iommu/arm-smmu-v3: Use accessor functions for iommu private data

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-240.el8
commit-author Joerg Roedel <jroedel@suse.de>
commit b7a9662f2c809e9778437aaf0e339279f4c8f3a1
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-240.el8/b7a9662f.failed

Make use of dev_iommu_priv_set/get() functions in the code.

	Signed-off-by: Joerg Roedel <jroedel@suse.de>
	Tested-by: Hanjun Guo <guohanjun@huawei.com>
	Reviewed-by: Jean-Philippe Brucker <jean-philippe@linaro.org>
Link: https://lore.kernel.org/r/20200326150841.10083-10-joro@8bytes.org
(cherry picked from commit b7a9662f2c809e9778437aaf0e339279f4c8f3a1)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/iommu/arm-smmu-v3.c
diff --cc drivers/iommu/arm-smmu-v3.c
index 1b61de0d69f6,2b68498dfb66..000000000000
--- a/drivers/iommu/arm-smmu-v3.c
+++ b/drivers/iommu/arm-smmu-v3.c
@@@ -2572,13 -2829,31 +2572,25 @@@ static int arm_smmu_add_device(struct d
  		}
  	}
  
 -	master->ssid_bits = min(smmu->ssid_bits, fwspec->num_pasid_bits);
 -
 -	if (!(smmu->features & ARM_SMMU_FEAT_2_LVL_CDTAB))
 -		master->ssid_bits = min_t(u8, master->ssid_bits,
 -					  CTXDESC_LINEAR_CDMAX);
 -
 -	ret = iommu_device_link(&smmu->iommu, dev);
 -	if (ret)
 -		goto err_free_master;
 -
  	group = iommu_group_get_for_dev(dev);
 -	if (IS_ERR(group)) {
 -		ret = PTR_ERR(group);
 -		goto err_unlink;
 +	if (!IS_ERR(group)) {
 +		iommu_group_put(group);
 +		iommu_device_link(&smmu->iommu, dev);
  	}
  
++<<<<<<< HEAD
 +	return PTR_ERR_OR_ZERO(group);
++=======
+ 	iommu_group_put(group);
+ 	return 0;
+ 
+ err_unlink:
+ 	iommu_device_unlink(&smmu->iommu, dev);
+ err_free_master:
+ 	kfree(master);
+ 	dev_iommu_priv_set(dev, NULL);
+ 	return ret;
++>>>>>>> b7a9662f2c80 (iommu/arm-smmu-v3: Use accessor functions for iommu private data)
  }
  
  static void arm_smmu_remove_device(struct device *dev)
* Unmerged path drivers/iommu/arm-smmu-v3.c
