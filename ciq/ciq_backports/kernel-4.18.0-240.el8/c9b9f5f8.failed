vdpa: move to drivers/vdpa

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-240.el8
commit-author Michael S. Tsirkin <mst@redhat.com>
commit c9b9f5f8c0f3cdb893cb86c168cdaa3aa5ed7278
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-240.el8/c9b9f5f8.failed

We have both vhost and virtio drivers that depend on vdpa.
It's easier to locate it at a top level directory otherwise
we run into issues e.g. if vhost is built-in but virtio
is modular.  Let's just move it up a level.

	Reported-by: Randy Dunlap <rdunlap@infradead.org>
	Signed-off-by: Michael S. Tsirkin <mst@redhat.com>
(cherry picked from commit c9b9f5f8c0f3cdb893cb86c168cdaa3aa5ed7278)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/Kconfig
#	drivers/virtio/Makefile
diff --cc drivers/Kconfig
index 95b9ccc08165,ac23d520e916..000000000000
--- a/drivers/Kconfig
+++ b/drivers/Kconfig
@@@ -131,6 -138,10 +131,13 @@@ source "drivers/virt/Kconfig
  
  source "drivers/virtio/Kconfig"
  
++<<<<<<< HEAD
++=======
+ source "drivers/vdpa/Kconfig"
+ 
+ source "drivers/vhost/Kconfig"
+ 
++>>>>>>> c9b9f5f8c0f3 (vdpa: move to drivers/vdpa)
  source "drivers/hv/Kconfig"
  
  source "drivers/xen/Kconfig"
diff --cc drivers/virtio/Makefile
index fdf5eacd0d0a,29a1386ecc03..000000000000
--- a/drivers/virtio/Makefile
+++ b/drivers/virtio/Makefile
@@@ -6,4 -6,4 +6,8 @@@ virtio_pci-y := virtio_pci_modern.o vir
  virtio_pci-$(CONFIG_VIRTIO_PCI_LEGACY) += virtio_pci_legacy.o
  obj-$(CONFIG_VIRTIO_BALLOON) += virtio_balloon.o
  obj-$(CONFIG_VIRTIO_INPUT) += virtio_input.o
++<<<<<<< HEAD
 +obj-$(CONFIG_VDPA) += vdpa/
++=======
+ obj-$(CONFIG_VIRTIO_VDPA) += virtio_vdpa.o
++>>>>>>> c9b9f5f8c0f3 (vdpa: move to drivers/vdpa)
diff --git a/MAINTAINERS b/MAINTAINERS
index a20cfdf8332d..8390175f08d1 100644
--- a/MAINTAINERS
+++ b/MAINTAINERS
@@ -15393,6 +15393,7 @@ L:	virtualization@lists.linux-foundation.org
 S:	Maintained
 F:	Documentation/devicetree/bindings/virtio/
 F:	drivers/virtio/
+F:	drivers/vdpa/
 F:	tools/virtio/
 F:	drivers/net/virtio_net.c
 F:	drivers/block/virtio_blk.c
* Unmerged path drivers/Kconfig
diff --git a/drivers/Makefile b/drivers/Makefile
index f800e3ae17ee..fe32b75340ca 100644
--- a/drivers/Makefile
+++ b/drivers/Makefile
@@ -42,6 +42,7 @@ obj-$(CONFIG_DMADEVICES)	+= dma/
 obj-y				+= soc/
 
 obj-$(CONFIG_VIRTIO)		+= virtio/
+obj-$(CONFIG_VDPA)		+= vdpa/
 obj-$(CONFIG_XEN)		+= xen/
 
 # regulators early, since some subsystems rely on them to initialize
diff --git a/drivers/virtio/vdpa/Kconfig b/drivers/vdpa/Kconfig
similarity index 100%
rename from drivers/virtio/vdpa/Kconfig
rename to drivers/vdpa/Kconfig
diff --git a/drivers/virtio/vdpa/Makefile b/drivers/vdpa/Makefile
similarity index 100%
rename from drivers/virtio/vdpa/Makefile
rename to drivers/vdpa/Makefile
diff --git a/drivers/virtio/vdpa/ifcvf/Makefile b/drivers/vdpa/ifcvf/Makefile
similarity index 100%
rename from drivers/virtio/vdpa/ifcvf/Makefile
rename to drivers/vdpa/ifcvf/Makefile
diff --git a/drivers/virtio/vdpa/ifcvf/ifcvf_base.c b/drivers/vdpa/ifcvf/ifcvf_base.c
similarity index 100%
rename from drivers/virtio/vdpa/ifcvf/ifcvf_base.c
rename to drivers/vdpa/ifcvf/ifcvf_base.c
diff --git a/drivers/virtio/vdpa/ifcvf/ifcvf_base.h b/drivers/vdpa/ifcvf/ifcvf_base.h
similarity index 100%
rename from drivers/virtio/vdpa/ifcvf/ifcvf_base.h
rename to drivers/vdpa/ifcvf/ifcvf_base.h
diff --git a/drivers/virtio/vdpa/ifcvf/ifcvf_main.c b/drivers/vdpa/ifcvf/ifcvf_main.c
similarity index 100%
rename from drivers/virtio/vdpa/ifcvf/ifcvf_main.c
rename to drivers/vdpa/ifcvf/ifcvf_main.c
diff --git a/drivers/virtio/vdpa/vdpa.c b/drivers/vdpa/vdpa.c
similarity index 100%
rename from drivers/virtio/vdpa/vdpa.c
rename to drivers/vdpa/vdpa.c
diff --git a/drivers/virtio/vdpa/vdpa_sim/Makefile b/drivers/vdpa/vdpa_sim/Makefile
similarity index 100%
rename from drivers/virtio/vdpa/vdpa_sim/Makefile
rename to drivers/vdpa/vdpa_sim/Makefile
diff --git a/drivers/virtio/vdpa/vdpa_sim/vdpa_sim.c b/drivers/vdpa/vdpa_sim/vdpa_sim.c
similarity index 100%
rename from drivers/virtio/vdpa/vdpa_sim/vdpa_sim.c
rename to drivers/vdpa/vdpa_sim/vdpa_sim.c
diff --git a/drivers/virtio/Kconfig b/drivers/virtio/Kconfig
index 47c55003bf80..35897649c24f 100644
--- a/drivers/virtio/Kconfig
+++ b/drivers/virtio/Kconfig
@@ -84,5 +84,3 @@ config VIRTIO_MMIO_CMDLINE_DEVICES
 	 If unsure, say 'N'.
 
 endif # VIRTIO_MENU
-
-source "drivers/virtio/vdpa/Kconfig"
* Unmerged path drivers/virtio/Makefile
