io_uring: ensure registered buffer import returns the IO length

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-240.el8
commit-author Jens Axboe <axboe@kernel.dk>
commit 5e559561a8d7e6d4adfce6aa8fbf3daa3dec1577
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-240.el8/5e559561.failed

A test case was reported where two linked reads with registered buffers
failed the second link always. This is because we set the expected value
of a request in req->result, and if we don't get this result, then we
fail the dependent links. For some reason the registered buffer import
returned -ERROR/0, while the normal import returns -ERROR/length. This
broke linked commands with registered buffers.

Fix this by making io_import_fixed() correctly return the mapped length.

	Cc: stable@vger.kernel.org # v5.3
	Reported-by: 李通洲 <carter.li@eoitek.com>
	Signed-off-by: Jens Axboe <axboe@kernel.dk>
(cherry picked from commit 5e559561a8d7e6d4adfce6aa8fbf3daa3dec1577)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	fs/io_uring.c
diff --cc fs/io_uring.c
index f656b9c7fa46,2c819c3c855d..000000000000
--- a/fs/io_uring.c
+++ b/fs/io_uring.c
@@@ -1171,9 -1230,7 +1171,13 @@@ static int io_import_fixed(struct io_ri
  		}
  	}
  
++<<<<<<< HEAD
 +	/* don't drop a reference to these pages */
 +	iter->type |= ITER_BVEC_FLAG_NO_REF;
 +	return 0;
++=======
+ 	return len;
++>>>>>>> 5e559561a8d7 (io_uring: ensure registered buffer import returns the IO length)
  }
  
  static ssize_t io_import_iovec(struct io_ring_ctx *ctx, int rw,
* Unmerged path fs/io_uring.c
