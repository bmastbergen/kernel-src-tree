netfilter: flowtable: Add API for registering to flow table events

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-240.el8
commit-author Paul Blakey <paulb@mellanox.com>
commit 978703f42549ac7d1a354bafbfc346a3ccf15f0d
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-240.el8/978703f4.failed

Let drivers to add their cb allowing them to receive flow offload events
of type TC_SETUP_CLSFLOWER (REPLACE/DEL/STATS) for flows managed by the
flow table.

	Signed-off-by: Paul Blakey <paulb@mellanox.com>
	Reviewed-by: Jiri Pirko <jiri@mellanox.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 978703f42549ac7d1a354bafbfc346a3ccf15f0d)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	include/net/netfilter/nf_flow_table.h
#	net/netfilter/nf_flow_table_core.c
#	net/netfilter/nf_flow_table_offload.c
diff --cc include/net/netfilter/nf_flow_table.h
index ebceddb778ea,d9d0945b696e..000000000000
--- a/include/net/netfilter/nf_flow_table.h
+++ b/include/net/netfilter/nf_flow_table.h
@@@ -26,8 -42,17 +26,15 @@@ struct nf_flowtable 
  	int				priority;
  	const struct nf_flowtable_type	*type;
  	struct delayed_work		gc_work;
++<<<<<<< HEAD
++=======
+ 	unsigned int			flags;
+ 	struct flow_block		flow_block;
+ 	struct mutex			flow_block_lock; /* Guards flow_block */
+ 	possible_net_t			net;
++>>>>>>> 978703f42549 (netfilter: flowtable: Add API for registering to flow table events)
  };
  
 -static inline bool nf_flowtable_hw_offload(struct nf_flowtable *flowtable)
 -{
 -	return flowtable->flags & NF_FLOWTABLE_HW_OFFLOAD;
 -}
 -
  enum flow_offload_tuple_dir {
  	FLOW_OFFLOAD_DIR_ORIGINAL = IP_CT_DIR_ORIGINAL,
  	FLOW_OFFLOAD_DIR_REPLY = IP_CT_DIR_REPLY,
diff --cc net/netfilter/nf_flow_table_core.c
index c6d7e473b2c2,4af0327992cf..000000000000
--- a/net/netfilter/nf_flow_table_core.c
+++ b/net/netfilter/nf_flow_table_core.c
@@@ -483,6 -537,8 +527,11 @@@ int nf_flow_table_init(struct nf_flowta
  	int err;
  
  	INIT_DEFERRABLE_WORK(&flowtable->gc_work, nf_flow_offload_work_gc);
++<<<<<<< HEAD
++=======
+ 	flow_block_init(&flowtable->flow_block);
+ 	mutex_init(&flowtable->flow_block_lock);
++>>>>>>> 978703f42549 (netfilter: flowtable: Add API for registering to flow table events)
  
  	err = rhashtable_init(&flowtable->rhashtable,
  			      &nf_flow_offload_rhash_params);
* Unmerged path net/netfilter/nf_flow_table_offload.c
* Unmerged path include/net/netfilter/nf_flow_table.h
* Unmerged path net/netfilter/nf_flow_table_core.c
* Unmerged path net/netfilter/nf_flow_table_offload.c
