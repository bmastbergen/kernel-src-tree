powerpc/kvm/book3s: Add helper for host page table walk

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-240.el8
Rebuild_CHGLOG: - [powerpc] kvm/book3s: Add helper for host page table walk (Greg Kurz) [1748772]
Rebuild_FUZZ: 92.16%
commit-author Aneesh Kumar K.V <aneesh.kumar@linux.ibm.com>
commit 35528876a92917b60c20077121e5c6805936cd7d
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-240.el8/35528876.failed

	Signed-off-by: Aneesh Kumar K.V <aneesh.kumar@linux.ibm.com>
	Signed-off-by: Michael Ellerman <mpe@ellerman.id.au>
Link: https://lore.kernel.org/r/20200505071729.54912-13-aneesh.kumar@linux.ibm.com
(cherry picked from commit 35528876a92917b60c20077121e5c6805936cd7d)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/powerpc/include/asm/kvm_book3s_64.h
diff --cc arch/powerpc/include/asm/kvm_book3s_64.h
index 21b1ed5df888,1ca1f6495012..000000000000
--- a/arch/powerpc/include/asm/kvm_book3s_64.h
+++ b/arch/powerpc/include/asm/kvm_book3s_64.h
@@@ -645,6 -635,37 +645,40 @@@ extern void kvmhv_remove_nest_rmap_rang
  				unsigned long gpa, unsigned long hpa,
  				unsigned long nbytes);
  
++<<<<<<< HEAD
++=======
+ static inline pte_t *find_kvm_secondary_pte(struct kvm *kvm, unsigned long ea,
+ 					    unsigned *hshift)
+ {
+ 	pte_t *pte;
+ 
+ 	VM_WARN(!spin_is_locked(&kvm->mmu_lock),
+ 		"%s called with kvm mmu_lock not held \n", __func__);
+ 	pte = __find_linux_pte(kvm->arch.pgtable, ea, NULL, hshift);
+ 
+ 	return pte;
+ }
+ 
+ static inline pte_t *find_kvm_host_pte(struct kvm *kvm, unsigned long mmu_seq,
+ 				       unsigned long ea, unsigned *hshift)
+ {
+ 	pte_t *pte;
+ 
+ 	VM_WARN(!spin_is_locked(&kvm->mmu_lock),
+ 		"%s called with kvm mmu_lock not held \n", __func__);
+ 
+ 	if (mmu_notifier_retry(kvm, mmu_seq))
+ 		return NULL;
+ 
+ 	pte = __find_linux_pte(kvm->mm->pgd, ea, NULL, hshift);
+ 
+ 	return pte;
+ }
+ 
+ extern pte_t *find_kvm_nested_guest_pte(struct kvm *kvm, unsigned long lpid,
+ 					unsigned long ea, unsigned *hshift);
+ 
++>>>>>>> 35528876a929 (powerpc/kvm/book3s: Add helper for host page table walk)
  #endif /* CONFIG_KVM_BOOK3S_HV_POSSIBLE */
  
  #endif /* __ASM_KVM_BOOK3S_64_H__ */
* Unmerged path arch/powerpc/include/asm/kvm_book3s_64.h
