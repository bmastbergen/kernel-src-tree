vdpa: make vhost, virtio depend on menu

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-240.el8
commit-author Michael S. Tsirkin <mst@redhat.com>
commit 58ad13729a8a3e0a354de46eaf9969f9116d4763
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-240.el8/58ad1372.failed

If user did not configure any vdpa drivers, neither vhost
nor virtio vdpa are going to be useful. So there's no point
in prompting for these and selecting vdpa core automatically.
Simplify configuration by making virtio and vhost vdpa
drivers depend on vdpa menu entry. Once done, we no longer
need a separate menu entry, so also get rid of this.
While at it, fix up the IFC entry: VDPA->vDPA for consistency
with other places.

	Signed-off-by: Michael S. Tsirkin <mst@redhat.com>
	Acked-by: Jason Wang <jasowang@redhat.com>
(cherry picked from commit 58ad13729a8a3e0a354de46eaf9969f9116d4763)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/vhost/Kconfig
#	drivers/virtio/Kconfig
diff --cc drivers/vhost/Kconfig
index b580885243f7,2c75d164b827..000000000000
--- a/drivers/vhost/Kconfig
+++ b/drivers/vhost/Kconfig
@@@ -33,11 -61,17 +33,25 @@@ config VHOST_VSOC
  	To compile this driver as a module, choose M here: the module will be called
  	vhost_vsock.
  
++<<<<<<< HEAD
 +config VHOST
 +	tristate
 +	---help---
 +	  This option is selected by any driver which needs to access
 +	  the core of vhost.
++=======
+ config VHOST_VDPA
+ 	tristate "Vhost driver for vDPA-based backend"
+ 	depends on EVENTFD
+ 	select VHOST
+ 	depends on VDPA
+ 	help
+ 	  This kernel module can be loaded in host kernel to accelerate
+ 	  guest virtio devices with the vDPA-based backends.
+ 
+ 	  To compile this driver as a module, choose M here: the module
+ 	  will be called vhost_vdpa.
++>>>>>>> 58ad13729a8a (vdpa: make vhost, virtio depend on menu)
  
  config VHOST_CROSS_ENDIAN_LEGACY
  	bool "Cross-endian support for vhost"
diff --cc drivers/virtio/Kconfig
index 47c55003bf80,69a32dfc318a..000000000000
--- a/drivers/virtio/Kconfig
+++ b/drivers/virtio/Kconfig
@@@ -42,6 -43,30 +42,33 @@@ config VIRTIO_PCI_LEGAC
  
  	  If unsure, say Y.
  
++<<<<<<< HEAD
++=======
+ config VIRTIO_VDPA
+ 	tristate "vDPA driver for virtio devices"
+ 	depends on VDPA
+ 	select VIRTIO
+ 	help
+ 	  This driver provides support for virtio based paravirtual
+ 	  device driver over vDPA bus. For this to be useful, you need
+ 	  an appropriate vDPA device implementation that operates on a
+ 	  physical device to allow the datapath of virtio to be
+ 	  offloaded to hardware.
+ 
+ 	  If unsure, say M.
+ 
+ config VIRTIO_PMEM
+ 	tristate "Support for virtio pmem driver"
+ 	depends on VIRTIO
+ 	depends on LIBNVDIMM
+ 	help
+ 	  This driver provides access to virtio-pmem devices, storage devices
+ 	  that are mapped into the physical address space - similar to NVDIMMs
+ 	   - with a virtio-based flushing interface.
+ 
+ 	  If unsure, say Y.
+ 
++>>>>>>> 58ad13729a8a (vdpa: make vhost, virtio depend on menu)
  config VIRTIO_BALLOON
  	tristate "Virtio balloon driver"
  	depends on VIRTIO
* Unmerged path drivers/vhost/Kconfig
* Unmerged path drivers/virtio/Kconfig
diff --git a/drivers/virtio/vdpa/Kconfig b/drivers/virtio/vdpa/Kconfig
index 42c32b789b97..3e1ceb8e9f2b 100644
--- a/drivers/virtio/vdpa/Kconfig
+++ b/drivers/virtio/vdpa/Kconfig
@@ -1,21 +1,16 @@
 # SPDX-License-Identifier: GPL-2.0-only
-config VDPA
-	tristate
+menuconfig VDPA
+	tristate "vDPA drivers"
 	help
 	  Enable this module to support vDPA device that uses a
 	  datapath which complies with virtio specifications with
 	  vendor specific control path.
 
-menuconfig VDPA_MENU
-	bool "VDPA drivers"
-	default n
-
-if VDPA_MENU
+if VDPA
 
 config VDPA_SIM
 	tristate "vDPA device simulator"
 	depends on RUNTIME_TESTING_MENU && HAS_DMA
-	select VDPA
 	select VHOST_RING
 	default n
 	help
@@ -24,9 +19,8 @@ config VDPA_SIM
 	  development of vDPA.
 
 config IFCVF
-	tristate "Intel IFC VF VDPA driver"
+	tristate "Intel IFC VF vDPA driver"
 	depends on PCI_MSI
-	select VDPA
 	default n
 	help
 	  This kernel module can drive Intel IFC VF NIC to offload
@@ -34,4 +28,4 @@ config IFCVF
 	  To compile this driver as a module, choose M here: the module will
 	  be called ifcvf.
 
-endif # VDPA_MENU
+endif # VDPA
