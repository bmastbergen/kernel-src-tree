Bluetooth: hci_bcm: Disallow set_baudrate for BCM4354

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-240.el8
commit-author Abhishek Pandit-Subedi <abhishekpandit@chromium.org>
commit 5d6f391073d5c1c903ac12be72c66b96b2ae93f4
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-240.el8/5d6f3910.failed

Without updating the patchram, the BCM4354 does not support a higher
operating speed. The normal bcm_setup follows the correct order
(init_speed, patchram and then oper_speed) but the serdev driver will
set the operating speed before calling the hu->setup function. Thus,
for the BCM4354, don't set the operating speed before patchram.

	Signed-off-by: Abhishek Pandit-Subedi <abhishekpandit@chromium.org>
	Signed-off-by: Marcel Holtmann <marcel@holtmann.org>
	Signed-off-by: Johan Hedberg <johan.hedberg@intel.com>
(cherry picked from commit 5d6f391073d5c1c903ac12be72c66b96b2ae93f4)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/bluetooth/hci_bcm.c
diff --cc drivers/bluetooth/hci_bcm.c
index 70da7a5e5d81,0200eff12bc9..000000000000
--- a/drivers/bluetooth/hci_bcm.c
+++ b/drivers/bluetooth/hci_bcm.c
@@@ -51,8 -37,24 +51,16 @@@
  #define BCM_LM_DIAG_PKT 0x07
  #define BCM_LM_DIAG_SIZE 63
  
 -#define BCM_TYPE49_PKT 0x31
 -#define BCM_TYPE49_SIZE 0
 -
 -#define BCM_TYPE52_PKT 0x34
 -#define BCM_TYPE52_SIZE 0
 -
  #define BCM_AUTOSUSPEND_DELAY	5000 /* default autosleep delay */
  
 -#define BCM_NUM_SUPPLIES 2
 -
+ /**
+  * struct bcm_device_data - device specific data
+  * @no_early_set_baudrate: Disallow set baudrate before driver setup()
+  */
+ struct bcm_device_data {
+ 	bool	no_early_set_baudrate;
+ };
+ 
  /**
   * struct bcm_device - device driver resources
   * @serdev_hu: HCI UART controller struct
@@@ -1318,9 -1442,17 +1341,18 @@@ static void bcm_serdev_remove(struct se
  }
  
  #ifdef CONFIG_OF
+ static struct bcm_device_data bcm4354_device_data = {
+ 	.no_early_set_baudrate = true,
+ };
+ 
  static const struct of_device_id bcm_bluetooth_of_match[] = {
 -	{ .compatible = "brcm,bcm20702a1" },
 -	{ .compatible = "brcm,bcm4345c5" },
 -	{ .compatible = "brcm,bcm4330-bt" },
  	{ .compatible = "brcm,bcm43438-bt" },
++<<<<<<< HEAD
 +	{ .compatible = "brcm,bcm43540-bt" },
++=======
+ 	{ .compatible = "brcm,bcm43540-bt", .data = &bcm4354_device_data },
+ 	{ .compatible = "brcm,bcm4335a0" },
++>>>>>>> 5d6f391073d5 (Bluetooth: hci_bcm: Disallow set_baudrate for BCM4354)
  	{ },
  };
  MODULE_DEVICE_TABLE(of, bcm_bluetooth_of_match);
* Unmerged path drivers/bluetooth/hci_bcm.c
