net/mlx5e: Use devlink virtual flavour for VF devlink port

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-240.el8
commit-author Parav Pandit <parav@mellanox.com>
commit 162add8cbae4635cf0598c640a24d5ed2849774f
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-240.el8/162add8c.failed

Use newly introduce 'virtual' port flavour for devlink
port of PCI VF devlink device in non-representors mode.

While at it, remove recently introduced empty lines at end of the file.

	Reviewed-by: Jiri Pirko <jiri@mellanox.com>
	Signed-off-by: Parav Pandit <parav@mellanox.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 162add8cbae4635cf0598c640a24d5ed2849774f)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/mellanox/mlx5/core/en.h
#	drivers/net/ethernet/mellanox/mlx5/core/en/devlink.c
#	drivers/net/ethernet/mellanox/mlx5/core/en/devlink.h
#	drivers/net/ethernet/mellanox/mlx5/core/en_main.c
diff --cc drivers/net/ethernet/mellanox/mlx5/core/en.h
index 3afd7528aef6,23032b4ddedd..000000000000
--- a/drivers/net/ethernet/mellanox/mlx5/core/en.h
+++ b/drivers/net/ethernet/mellanox/mlx5/core/en.h
@@@ -857,7 -879,13 +857,12 @@@ struct mlx5e_priv 
  	struct mlx5e_tls          *tls;
  #endif
  	struct devlink_health_reporter *tx_reporter;
++<<<<<<< HEAD
++=======
+ 	struct devlink_health_reporter *rx_reporter;
+ 	struct devlink_port            dl_port;
++>>>>>>> 162add8cbae4 (net/mlx5e: Use devlink virtual flavour for VF devlink port)
  	struct mlx5e_xsk           xsk;
 -#if IS_ENABLED(CONFIG_PCI_HYPERV_INTERFACE)
 -	struct mlx5e_hv_vhca_stats_agent stats_agent;
 -#endif
 -	struct mlx5e_scratchpad    scratchpad;
  };
  
  struct mlx5e_profile {
diff --cc drivers/net/ethernet/mellanox/mlx5/core/en_main.c
index ea998980a21e,f9c928afec89..000000000000
--- a/drivers/net/ethernet/mellanox/mlx5/core/en_main.c
+++ b/drivers/net/ethernet/mellanox/mlx5/core/en_main.c
@@@ -4617,6 -4606,7 +4617,10 @@@ const struct net_device_ops mlx5e_netde
  	.ndo_set_vf_link_state   = mlx5e_set_vf_link_state,
  	.ndo_get_vf_stats        = mlx5e_get_vf_stats,
  #endif
++<<<<<<< HEAD
++=======
+ 	.ndo_get_devlink_port    = mlx5e_get_devlink_port,
++>>>>>>> 162add8cbae4 (net/mlx5e: Use devlink virtual flavour for VF devlink port)
  };
  
  static int mlx5e_check_required_hca_cap(struct mlx5_core_dev *mdev)
@@@ -5453,6 -5473,12 +5457,15 @@@ static void *mlx5e_add(struct mlx5_core
  		goto err_detach;
  	}
  
++<<<<<<< HEAD
++=======
+ 	err = mlx5e_devlink_port_register(netdev);
+ 	if (err) {
+ 		mlx5_core_err(mdev, "mlx5e_devlink_phy_port_register failed, %d\n", err);
+ 		goto err_unregister_netdev;
+ 	}
+ 
++>>>>>>> 162add8cbae4 (net/mlx5e: Use devlink virtual flavour for VF devlink port)
  #ifdef CONFIG_MLX5_CORE_EN_DCB
  	mlx5e_dcbnl_init_app(priv);
  #endif
@@@ -5479,6 -5507,7 +5492,10 @@@ static void mlx5e_remove(struct mlx5_co
  #ifdef CONFIG_MLX5_CORE_EN_DCB
  	mlx5e_dcbnl_delete_app(priv);
  #endif
++<<<<<<< HEAD
++=======
+ 	mlx5e_devlink_port_unregister(priv);
++>>>>>>> 162add8cbae4 (net/mlx5e: Use devlink virtual flavour for VF devlink port)
  	unregister_netdev(priv->netdev);
  	mlx5e_detach(mdev, vpriv);
  	mlx5e_destroy_netdev(priv);
* Unmerged path drivers/net/ethernet/mellanox/mlx5/core/en/devlink.c
* Unmerged path drivers/net/ethernet/mellanox/mlx5/core/en/devlink.h
* Unmerged path drivers/net/ethernet/mellanox/mlx5/core/en.h
* Unmerged path drivers/net/ethernet/mellanox/mlx5/core/en/devlink.c
* Unmerged path drivers/net/ethernet/mellanox/mlx5/core/en/devlink.h
* Unmerged path drivers/net/ethernet/mellanox/mlx5/core/en_main.c
