Drivers: hv: vmbus: Only notify Hyper-V for die events that are oops

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-240.el8
Rebuild_CHGLOG: - [hv] hv: vmbus: Only notify Hyper-V for die events that are oops (Vitaly Kuznetsov) [1868131]
Rebuild_FUZZ: 92.91%
commit-author Michael Kelley <mikelley@microsoft.com>
commit 608a973bd52ef1705941b18f55e39655fcfe9cdb
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-240.el8/608a973b.failed

Hyper-V currently may be notified of a panic for any die event. But
this results in false panic notifications for various user space traps
that are die events. Fix this by ignoring die events that aren't oops.

Fixes: 510f7aef65bb ("Drivers: hv: vmbus: prefer 'die' notification chain to 'panic'")
	Signed-off-by: Michael Kelley <mikelley@microsoft.com>
	Reviewed-by: Vitaly Kuznetsov <vkuznets@redhat.com>
Link: https://lore.kernel.org/r/1596730935-11564-1-git-send-email-mikelley@microsoft.com
	Signed-off-by: Wei Liu <wei.liu@kernel.org>
(cherry picked from commit 608a973bd52ef1705941b18f55e39655fcfe9cdb)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/hv/vmbus_drv.c
diff --cc drivers/hv/vmbus_drv.c
index 12bce1b87223,45c954d75e70..000000000000
--- a/drivers/hv/vmbus_drv.c
+++ b/drivers/hv/vmbus_drv.c
@@@ -75,7 -87,17 +75,21 @@@ static int hyperv_die_event(struct noti
  	struct die_args *die = (struct die_args *)args;
  	struct pt_regs *regs = die->regs;
  
++<<<<<<< HEAD
 +	hyperv_report_panic(regs, val);
++=======
+ 	/* Don't notify Hyper-V if the die event is other than oops */
+ 	if (val != DIE_OOPS)
+ 		return NOTIFY_DONE;
+ 
+ 	/*
+ 	 * Hyper-V should be notified only once about a panic.  If we will be
+ 	 * doing hyperv_report_panic_msg() later with kmsg data, don't do
+ 	 * the notification here.
+ 	 */
+ 	if (hyperv_report_reg())
+ 		hyperv_report_panic(regs, val, true);
++>>>>>>> 608a973bd52e (Drivers: hv: vmbus: Only notify Hyper-V for die events that are oops)
  	return NOTIFY_DONE;
  }
  
* Unmerged path drivers/hv/vmbus_drv.c
