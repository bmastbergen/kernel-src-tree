perf evsel: Fall back to global 'perf_env' in perf_evsel__env()

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-240.el8
commit-author Arnaldo Carvalho de Melo <acme@redhat.com>
commit 9db0e3635fb35b6695275774ab909c51221b66ad
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-240.el8/9db0e363.failed

I.e. if evsel->evlist or evsel->evlist->env isn't set, return the
environment for the running machine, as that would be set if reading
from a perf.data file.

	Cc: Adrian Hunter <adrian.hunter@intel.com>
	Cc: Jiri Olsa <jolsa@kernel.org>
	Cc: Namhyung Kim <namhyung@kernel.org>
Link: https://lkml.kernel.org/n/tip-uqq4grmhbi12rwb0lfpo6lfu@git.kernel.org
	Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>
(cherry picked from commit 9db0e3635fb35b6695275774ab909c51221b66ad)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	tools/perf/util/evsel.c
#	tools/perf/util/python.c
diff --cc tools/perf/util/evsel.c
index 90bfc2303a40,abc7fda4a0fe..000000000000
--- a/tools/perf/util/evsel.c
+++ b/tools/perf/util/evsel.c
@@@ -26,10 -25,16 +26,16 @@@
  #include "asm/bug.h"
  #include "callchain.h"
  #include "cgroup.h"
 -#include "counts.h"
  #include "event.h"
  #include "evsel.h"
++<<<<<<< HEAD
++=======
+ #include "util/env.h"
+ #include "util/evsel_config.h"
+ #include "util/evsel_fprintf.h"
++>>>>>>> 9db0e3635fb3 (perf evsel: Fall back to global 'perf_env' in perf_evsel__env())
  #include "evlist.h"
 -#include <perf/cpumap.h>
 +#include "cpumap.h"
  #include "thread_map.h"
  #include "target.h"
  #include "perf_regs.h"
@@@ -3046,10 -2513,10 +3052,10 @@@ struct perf_env *perf_evsel__env(struc
  {
  	if (evsel && evsel->evlist)
  		return evsel->evlist->env;
- 	return NULL;
+ 	return &perf_env;
  }
  
 -static int store_evsel_ids(struct evsel *evsel, struct evlist *evlist)
 +static int store_evsel_ids(struct perf_evsel *evsel, struct perf_evlist *evlist)
  {
  	int cpu, thread;
  
diff --cc tools/perf/util/python.c
index 9c3b43665909,02460362256d..000000000000
--- a/tools/perf/util/python.c
+++ b/tools/perf/util/python.c
@@@ -8,11 -10,13 +8,17 @@@
  #include "callchain.h"
  #include "evsel.h"
  #include "event.h"
 +#include "cpumap.h"
  #include "print_binary.h"
  #include "thread_map.h"
 -#include "trace-event.h"
  #include "mmap.h"
++<<<<<<< HEAD
 +#include "util.h"
++=======
+ #include "util/env.h"
+ #include <internal/lib.h>
+ #include "../perf-sys.h"
++>>>>>>> 9db0e3635fb3 (perf evsel: Fall back to global 'perf_env' in perf_evsel__env())
  
  #if PY_MAJOR_VERSION < 3
  #define _PyUnicode_FromString(arg) \
* Unmerged path tools/perf/util/evsel.c
* Unmerged path tools/perf/util/python.c
