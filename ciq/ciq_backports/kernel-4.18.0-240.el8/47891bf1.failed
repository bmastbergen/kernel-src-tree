drm/amdgpu: drop unnecessary cancel_delayed_work_sync on PG ungate

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-240.el8
commit-author Evan Quan <evan.quan@amd.com>
commit 47891bf1da31ccba95974b58a853a346924ed341
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-240.el8/47891bf1.failed

As this is already properly handled in amdgpu_gfx_off_ctrl(). In fact,
this unnecessary cancel_delayed_work_sync may leave a small time window
for race condition and is dangerous.

	Signed-off-by: Evan Quan <evan.quan@amd.com>
	Reviewed-by: Alex Deucher <alexander.deucher@amd.com>
	Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
(cherry picked from commit 47891bf1da31ccba95974b58a853a346924ed341)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/gpu/drm/amd/amdgpu/gfx_v10_0.c
#	drivers/gpu/drm/amd/amdgpu/gfx_v9_0.c
diff --cc drivers/gpu/drm/amd/amdgpu/gfx_v10_0.c
index 4195a2ee47ee,1532fca9076c..000000000000
--- a/drivers/gpu/drm/amd/amdgpu/gfx_v10_0.c
+++ b/drivers/gpu/drm/amd/amdgpu/gfx_v10_0.c
@@@ -4078,14 -7112,15 +4078,19 @@@ static int gfx_v10_0_set_powergating_st
  					  enum amd_powergating_state state)
  {
  	struct amdgpu_device *adev = (struct amdgpu_device *)handle;
 -	bool enable = (state == AMD_PG_STATE_GATE);
 -
 -	if (amdgpu_sriov_vf(adev))
 -		return 0;
 -
 +	bool enable = (state == AMD_PG_STATE_GATE) ? true : false;
  	switch (adev->asic_type) {
  	case CHIP_NAVI10:
++<<<<<<< HEAD
 +		if (!enable) {
 +			amdgpu_gfx_off_ctrl(adev, false);
 +			cancel_delayed_work_sync(&adev->gfx.gfx_off_delay_work);
 +		} else
 +			amdgpu_gfx_off_ctrl(adev, true);
++=======
+ 	case CHIP_NAVI14:
+ 		amdgpu_gfx_off_ctrl(adev, enable);
++>>>>>>> 47891bf1da31 (drm/amdgpu: drop unnecessary cancel_delayed_work_sync on PG ungate)
  		break;
  	default:
  		break;
diff --cc drivers/gpu/drm/amd/amdgpu/gfx_v9_0.c
index d9abaab67c88,f6a72b09d008..000000000000
--- a/drivers/gpu/drm/amd/amdgpu/gfx_v9_0.c
+++ b/drivers/gpu/drm/amd/amdgpu/gfx_v9_0.c
@@@ -4249,10 -5038,10 +4249,14 @@@ static int gfx_v9_0_set_powergating_sta
  
  	switch (adev->asic_type) {
  	case CHIP_RAVEN:
++<<<<<<< HEAD
 +		if (!enable) {
++=======
+ 	case CHIP_RENOIR:
+ 		if (!enable)
++>>>>>>> 47891bf1da31 (drm/amdgpu: drop unnecessary cancel_delayed_work_sync on PG ungate)
  			amdgpu_gfx_off_ctrl(adev, false);
- 			cancel_delayed_work_sync(&adev->gfx.gfx_off_delay_work);
- 		}
+ 
  		if (adev->pg_flags & AMD_PG_SUPPORT_RLC_SMU_HS) {
  			gfx_v9_0_enable_sck_slow_down_on_power_up(adev, true);
  			gfx_v9_0_enable_sck_slow_down_on_power_down(adev, true);
* Unmerged path drivers/gpu/drm/amd/amdgpu/gfx_v10_0.c
* Unmerged path drivers/gpu/drm/amd/amdgpu/gfx_v9_0.c
