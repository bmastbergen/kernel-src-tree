KVM: SVM: allow AVIC without split irqchip

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-240.el8
commit-author Paolo Bonzini <pbonzini@redhat.com>
commit e8ef2a19a051b755b0b9973ef1b3f81e895e2bce
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-240.el8/e8ef2a19.failed

SVM is now able to disable AVIC dynamically whenever the in-kernel PIT sets
up an ack notifier, so we can enable it even if in-kernel IOAPIC/PIC/PIT
are in use.

	Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>
(cherry picked from commit e8ef2a19a051b755b0b9973ef1b3f81e895e2bce)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/x86/kvm/svm.c
diff --cc arch/x86/kvm/svm.c
index 0b5d8983224a,bf0556588ad0..000000000000
--- a/arch/x86/kvm/svm.c
+++ b/arch/x86/kvm/svm.c
@@@ -2073,6 -2065,18 +2073,21 @@@ free_avic
  	return err;
  }
  
++<<<<<<< HEAD
++=======
+ static int svm_vm_init(struct kvm *kvm)
+ {
+ 	if (avic) {
+ 		int ret = avic_vm_init(kvm);
+ 		if (ret)
+ 			return ret;
+ 	}
+ 
+ 	kvm_apicv_init(kvm, avic);
+ 	return 0;
+ }
+ 
++>>>>>>> e8ef2a19a051 (KVM: SVM: allow AVIC without split irqchip)
  static inline int
  avic_update_iommu_vcpu_affinity(struct kvm_vcpu *vcpu, int cpu, bool r)
  {
* Unmerged path arch/x86/kvm/svm.c
