net/sched: act_ct: Fix skb double-free in tcf_ct_handle_fragments() error flow

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-240.el8
Rebuild_CHGLOG: - [net] sched: act_ct: Fix skb double-free in tcf_ct_handle_fragments() error flow (Marcelo Leitner) [1866391]
Rebuild_FUZZ: 97.37%
commit-author Alaa Hleihel <alaa@mellanox.com>
commit eda814b97dfb8d9f4808eb2f65af9bd3705c4cae
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-240.el8/eda814b9.failed

tcf_ct_handle_fragments() shouldn't free the skb when ip_defrag() call
fails. Otherwise, we will cause a double-free bug.
In such cases, just return the error to the caller.

Fixes: b57dc7c13ea9 ("net/sched: Introduce action ct")
	Signed-off-by: Alaa Hleihel <alaa@mellanox.com>
	Reviewed-by: Roi Dayan <roid@mellanox.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit eda814b97dfb8d9f4808eb2f65af9bd3705c4cae)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/sched/act_ct.c
diff --cc net/sched/act_ct.c
index e2ea3f8194b4,2c3619165680..000000000000
--- a/net/sched/act_ct.c
+++ b/net/sched/act_ct.c
@@@ -178,7 -704,12 +178,16 @@@ static int tcf_ct_handle_fragments(stru
  		err = ip_defrag(net, skb, user);
  		local_bh_enable();
  		if (err && err != -EINPROGRESS)
++<<<<<<< HEAD
 +			goto out_free;
++=======
+ 			return err;
+ 
+ 		if (!err) {
+ 			*defrag = true;
+ 			cb.mru = IPCB(skb)->frag_max_size;
+ 		}
++>>>>>>> eda814b97dfb (net/sched: act_ct: Fix skb double-free in tcf_ct_handle_fragments() error flow)
  	} else { /* NFPROTO_IPV6 */
  #if IS_ENABLED(CONFIG_NF_DEFRAG_IPV6)
  		enum ip6_defrag_users user = IP6_DEFRAG_CONNTRACK_IN + zone;
* Unmerged path net/sched/act_ct.c
