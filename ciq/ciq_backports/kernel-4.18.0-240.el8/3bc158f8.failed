netfilter: nf_tables: map basechain priority to hardware priority

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-240.el8
commit-author Pablo Neira Ayuso <pablo@netfilter.org>
commit 3bc158f8d0330f0ac58597c023acca2234c14616
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-240.el8/3bc158f8.failed

This patch adds initial support for offloading basechains using the
priority range from 1 to 65535. This is restricting the netfilter
priority range to 16-bit integer since this is what most drivers assume
so far from tc. It should be possible to extend this range of supported
priorities later on once drivers are updated to support for 32-bit
integer priorities.

	Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 3bc158f8d0330f0ac58597c023acca2234c14616)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	include/net/netfilter/nf_tables_offload.h
#	net/netfilter/nf_tables_api.c
#	net/netfilter/nf_tables_offload.c
diff --cc net/netfilter/nf_tables_api.c
index b6b54e6a024b,d47469f824a1..000000000000
--- a/net/netfilter/nf_tables_api.c
+++ b/net/netfilter/nf_tables_api.c
@@@ -1650,8 -1665,13 +1650,16 @@@ static int nf_tables_addchain(struct nf
  		ops->hook	= hook.type->hooks[ops->hooknum];
  		ops->dev	= hook.dev;
  
 -		chain->flags |= NFT_BASE_CHAIN | flags;
 +		chain->flags |= NFT_BASE_CHAIN;
  		basechain->policy = NF_ACCEPT;
++<<<<<<< HEAD
++=======
+ 		if (chain->flags & NFT_CHAIN_HW_OFFLOAD &&
+ 		    nft_chain_offload_priority(basechain) < 0)
+ 			return -EOPNOTSUPP;
+ 
+ 		flow_block_init(&basechain->flow_block);
++>>>>>>> 3bc158f8d033 (netfilter: nf_tables: map basechain priority to hardware priority)
  	} else {
  		chain = kzalloc(sizeof(*chain), GFP_KERNEL);
  		if (chain == NULL)
* Unmerged path include/net/netfilter/nf_tables_offload.h
* Unmerged path net/netfilter/nf_tables_offload.c
* Unmerged path include/net/netfilter/nf_tables_offload.h
* Unmerged path net/netfilter/nf_tables_api.c
* Unmerged path net/netfilter/nf_tables_offload.c
