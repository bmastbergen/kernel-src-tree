sysfs: Wrap __compat_only_sysfs_link_entry_to_kobj function to change the symlink name

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-240.el8
commit-author Sourabh Jain <sourabhjain@linux.ibm.com>
commit 9255782f70614c89b1a15ec6997c4b72ce9e630a
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-240.el8/9255782f.failed

The __compat_only_sysfs_link_entry_to_kobj function creates a symlink
to a kobject but doesn't provide an option to change the symlink file
name.

This patch adds a wrapper function compat_only_sysfs_link_entry_to_kobj
that extends the __compat_only_sysfs_link_entry_to_kobj functionality
which allows function caller to customize the symlink name.

	Signed-off-by: Sourabh Jain <sourabhjain@linux.ibm.com>
[mpe: Fix compile error when CONFIG_SYSFS=n]
	Signed-off-by: Michael Ellerman <mpe@ellerman.id.au>
Link: https://lore.kernel.org/r/20191211160910.21656-3-sourabhjain@linux.ibm.com
(cherry picked from commit 9255782f70614c89b1a15ec6997c4b72ce9e630a)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	fs/sysfs/group.c
diff --cc fs/sysfs/group.c
index f900534ffaaf,1e2a096057bc..000000000000
--- a/fs/sysfs/group.c
+++ b/fs/sysfs/group.c
@@@ -437,9 -467,12 +456,18 @@@ int compat_only_sysfs_link_entry_to_kob
  		return -ENOENT;
  	}
  
++<<<<<<< HEAD
 +	link = kernfs_create_link(kobj->sd, target_name, entry);
 +	if (IS_ERR(link) && PTR_ERR(link) == -EEXIST)
 +		sysfs_warn_dup(kobj->sd, target_name);
++=======
+ 	if (!symlink_name)
+ 		symlink_name = target_name;
+ 
+ 	link = kernfs_create_link(kobj->sd, symlink_name, entry);
+ 	if (PTR_ERR(link) == -EEXIST)
+ 		sysfs_warn_dup(kobj->sd, symlink_name);
++>>>>>>> 9255782f7061 (sysfs: Wrap __compat_only_sysfs_link_entry_to_kobj function to change the symlink name)
  
  	kernfs_put(entry);
  	kernfs_put(target);
* Unmerged path fs/sysfs/group.c
diff --git a/include/linux/sysfs.h b/include/linux/sysfs.h
index 7338321a13bc..be47f553415a 100644
--- a/include/linux/sysfs.h
+++ b/include/linux/sysfs.h
@@ -300,6 +300,10 @@ void sysfs_remove_link_from_group(struct kobject *kobj, const char *group_name,
 int __compat_only_sysfs_link_entry_to_kobj(struct kobject *kobj,
 				      struct kobject *target_kobj,
 				      const char *target_name);
+int compat_only_sysfs_link_entry_to_kobj(struct kobject *kobj,
+					 struct kobject *target_kobj,
+					 const char *target_name,
+					 const char *symlink_name);
 
 void sysfs_notify(struct kobject *kobj, const char *dir, const char *attr);
 
@@ -508,6 +512,14 @@ static inline int __compat_only_sysfs_link_entry_to_kobj(
 	return 0;
 }
 
+static inline int compat_only_sysfs_link_entry_to_kobj(struct kobject *kobj,
+						       struct kobject *target_kobj,
+						       const char *target_name,
+						       const char *symlink_name)
+{
+	return 0;
+}
+
 static inline void sysfs_notify(struct kobject *kobj, const char *dir,
 				const char *attr)
 {
