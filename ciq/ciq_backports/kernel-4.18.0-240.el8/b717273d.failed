netfilter: nf_tables: don't fail when updating base chain policy

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-240.el8
commit-author Florian Westphal <fw@strlen.de>
commit b717273ddb66a0c576d8c9884a6cfa70a5f49f6b
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-240.el8/b717273d.failed

The following nftables test case fails on nf-next:

tests/shell/run-tests.sh tests/shell/testcases/transactions/0011chain_0

The test case contains:
add chain x y { type filter hook input priority 0; }
add chain x y { policy drop; }"

The new test
if (chain->flags ^ flags)
	return -EOPNOTSUPP;

triggers here, because chain->flags has NFT_BASE_CHAIN set, but flags
is 0 because no flag attribute was present in the policy update.

Just fetch the current flag settings of a pre-existing chain in case
userspace did not provide any.

Fixes: c9626a2cbdb20 ("netfilter: nf_tables: add hardware offload support")
	Signed-off-by: Florian Westphal <fw@strlen.de>
	Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
(cherry picked from commit b717273ddb66a0c576d8c9884a6cfa70a5f49f6b)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/netfilter/nf_tables_api.c
diff --cc net/netfilter/nf_tables_api.c
index b6b54e6a024b,014e06b0b5cf..000000000000
--- a/net/netfilter/nf_tables_api.c
+++ b/net/netfilter/nf_tables_api.c
@@@ -1883,6 -1898,11 +1883,14 @@@ static int nf_tables_newchain(struct ne
  		}
  	}
  
++<<<<<<< HEAD
++=======
+ 	if (nla[NFTA_CHAIN_FLAGS])
+ 		flags = ntohl(nla_get_be32(nla[NFTA_CHAIN_FLAGS]));
+ 	else if (chain)
+ 		flags = chain->flags;
+ 
++>>>>>>> b717273ddb66 (netfilter: nf_tables: don't fail when updating base chain policy)
  	nft_ctx_init(&ctx, net, skb, nlh, family, table, chain, nla);
  
  	if (chain != NULL) {
* Unmerged path net/netfilter/nf_tables_api.c
