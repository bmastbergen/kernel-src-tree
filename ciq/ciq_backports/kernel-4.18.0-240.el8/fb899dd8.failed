drm/i915: Apply Wa_1406680159:icl,ehl as an engine workaround

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-240.el8
Rebuild_CHGLOG: - [drm] drm/i915: Apply Wa_1406680159:icl, ehl as an engine workaround (Lyude Paul) [1814893]
Rebuild_FUZZ: 99.19%
commit-author Matt Roper <matthew.d.roper@intel.com>
commit fb899dd8ea9c4ac5928b86946e6536790981adae
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-240.el8/fb899dd8.failed

The register this workaround updates is a render engine register in the
MCR range, so we should initialize this in rcs_engine_wa_init() rather
than gt_wa_init().

Closes: https://gitlab.freedesktop.org/drm/intel/issues/1222
Fixes: 36204d80bacb ("drm/i915/icl: Wa_1406680159")
	Cc: Mika Kuoppala <mika.kuoppala@linux.intel.com>
	Signed-off-by: Matt Roper <matthew.d.roper@intel.com>
Link: https://patchwork.freedesktop.org/patch/msgid/20200311162300.1838847-6-matthew.d.roper@intel.com
	Reviewed-by: Mika Kuoppala <mika.kuoppala@linux.intel.com>
(cherry picked from commit fb899dd8ea9c4ac5928b86946e6536790981adae)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/gpu/drm/i915/gt/intel_workarounds.c
diff --cc drivers/gpu/drm/i915/gt/intel_workarounds.c
index f8ed29b62e58,cbfc8d5ebb3e..000000000000
--- a/drivers/gpu/drm/i915/gt/intel_workarounds.c
+++ b/drivers/gpu/drm/i915/gt/intel_workarounds.c
@@@ -1296,10 -1461,36 +1291,39 @@@ rcs_engine_wa_init(struct intel_engine_
  		wa_write_or(wal,
  			    GEN7_SARCHKMD,
  			    GEN7_DISABLE_SAMPLER_PREFETCH);
++<<<<<<< HEAD
++=======
+ 
+ 		/* Wa_1409178092:icl */
+ 		wa_write_masked_or(wal,
+ 				   GEN11_SCRATCH2,
+ 				   GEN11_COHERENT_PARTIAL_WRITE_MERGE_ENABLE,
+ 				   0);
+ 
+ 		/* WaEnable32PlaneMode:icl */
+ 		wa_masked_en(wal, GEN9_CSFE_CHICKEN1_RCS,
+ 			     GEN11_ENABLE_32_PLANE_MODE);
+ 
+ 		/*
+ 		 * Wa_1408615072:icl,ehl  (vsunit)
+ 		 * Wa_1407596294:icl,ehl  (hsunit)
+ 		 */
+ 		wa_write_or(wal, UNSLICE_UNIT_LEVEL_CLKGATE,
+ 			    VSUNIT_CLKGATE_DIS | HSUNIT_CLKGATE_DIS);
+ 
+ 		/* Wa_1407352427:icl,ehl */
+ 		wa_write_or(wal, UNSLICE_UNIT_LEVEL_CLKGATE2,
+ 			    PSDUNIT_CLKGATE_DIS);
+ 
+ 		/* Wa_1406680159:icl,ehl */
+ 		wa_write_or(wal,
+ 			    SUBSLICE_UNIT_LEVEL_CLKGATE,
+ 			    GWUNIT_CLKGATE_DIS);
++>>>>>>> fb899dd8ea9c (drm/i915: Apply Wa_1406680159:icl,ehl as an engine workaround)
  	}
  
 -	if (IS_GEN_RANGE(i915, 9, 12)) {
 -		/* FtrPerCtxtPreemptionGranularityControl:skl,bxt,kbl,cfl,cnl,icl,tgl */
 +	if (IS_GEN_RANGE(i915, 9, 11)) {
 +		/* FtrPerCtxtPreemptionGranularityControl:skl,bxt,kbl,cfl,cnl,icl */
  		wa_masked_en(wal,
  			     GEN7_FF_SLICE_CS_CHICKEN1,
  			     GEN9_FFSC_PERCTX_PREEMPT_CTRL);
* Unmerged path drivers/gpu/drm/i915/gt/intel_workarounds.c
