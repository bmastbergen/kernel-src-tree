PCI: sysfs: Change DEVICE_ATTR() to DEVICE_ATTR_WO()

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-240.el8
commit-author Kelsey Skunberg <skunberg.kelsey@gmail.com>
commit 4e2b79436e4f22b225ee445832705bb7c4675807
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-240.el8/4e2b7943.failed

DEVICE_ATTR() should only be used when files have unusual permissions.
Change DEVICE_ATTR() with '0220' write-only permissions to
DEVICE_ATTR_WO(), e.g.,

  - static DEVICE_ATTR(_name, (S_IWUSR | S_IWGRP), NULL, _store);
  + static DEVICE_ATTR_WO(_name);

Since _store is no longer passed, make the _name passed by DEVICE_ATTR_WO()
and the related _name##_store() name match with each other, e.g.,

  DEVICE_ATTR_WO(bus_rescan) must be able to call bus_rescan_store()

Link: https://lore.kernel.org/r/20190815153352.86143-4-skunberg.kelsey@gmail.com
	Signed-off-by: Kelsey Skunberg <skunberg.kelsey@gmail.com>
	Signed-off-by: Bjorn Helgaas <bhelgaas@google.com>
	Reviewed-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
	Reviewed-by: Donald Dutile <ddutile@redhat.com>
(cherry picked from commit 4e2b79436e4f22b225ee445832705bb7c4675807)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/pci/pci-sysfs.c
diff --cc drivers/pci/pci-sysfs.c
index 3a8cc580cfdb,4fe988d54807..000000000000
--- a/drivers/pci/pci-sysfs.c
+++ b/drivers/pci/pci-sysfs.c
@@@ -461,9 -464,7 +461,13 @@@ static ssize_t dev_rescan_store(struct 
  	}
  	return count;
  }
++<<<<<<< HEAD
 +static struct device_attribute dev_rescan_attr = __ATTR(rescan,
 +							(S_IWUSR|S_IWGRP),
 +							NULL, dev_rescan_store);
++=======
+ static DEVICE_ATTR_WO(dev_rescan);
++>>>>>>> 4e2b79436e4f (PCI: sysfs: Change DEVICE_ATTR() to DEVICE_ATTR_WO())
  
  static ssize_t remove_store(struct device *dev, struct device_attribute *attr,
  			    const char *buf, size_t count)
@@@ -477,13 -478,12 +481,13 @@@
  		pci_stop_and_remove_bus_device_locked(to_pci_dev(dev));
  	return count;
  }
 -static DEVICE_ATTR_IGNORE_LOCKDEP(remove, (S_IWUSR | S_IWGRP), NULL,
 -				  remove_store);
 +static struct device_attribute dev_remove_attr = __ATTR(remove,
 +							(S_IWUSR|S_IWGRP),
 +							NULL, remove_store);
  
- static ssize_t dev_bus_rescan_store(struct device *dev,
- 				    struct device_attribute *attr,
- 				    const char *buf, size_t count)
+ static ssize_t bus_rescan_store(struct device *dev,
+ 				struct device_attribute *attr,
+ 				const char *buf, size_t count)
  {
  	unsigned long val;
  	struct pci_bus *bus = to_pci_bus(dev);
@@@ -501,7 -501,7 +505,11 @@@
  	}
  	return count;
  }
++<<<<<<< HEAD
 +static DEVICE_ATTR(rescan, (S_IWUSR|S_IWGRP), NULL, dev_bus_rescan_store);
++=======
+ static DEVICE_ATTR_WO(bus_rescan);
++>>>>>>> 4e2b79436e4f (PCI: sysfs: Change DEVICE_ATTR() to DEVICE_ATTR_WO())
  
  #if defined(CONFIG_PM) && defined(CONFIG_ACPI)
  static ssize_t d3cold_allowed_store(struct device *dev,
@@@ -1630,8 -1619,8 +1638,13 @@@ static umode_t pci_dev_attrs_are_visibl
  }
  
  static struct attribute *pci_dev_hp_attrs[] = {
++<<<<<<< HEAD
 +	&dev_remove_attr.attr,
 +	&dev_rescan_attr.attr,
++=======
+ 	&dev_attr_remove.attr,
+ 	&dev_attr_dev_rescan.attr,
++>>>>>>> 4e2b79436e4f (PCI: sysfs: Change DEVICE_ATTR() to DEVICE_ATTR_WO())
  	NULL,
  };
  
* Unmerged path drivers/pci/pci-sysfs.c
