usb: simplify usbport trigger

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-240.el8
commit-author Uwe Kleine-König <u.kleine-koenig@pengutronix.de>
commit 6f7b0bad88397ad5d7901ce63696163ac8b481ce
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-240.el8/6f7b0bad.failed

The led trigger core learned a few things that allow to simplify the
trigger drivers.  Make use of automated trigger attributes and error
checking of the activate callback. Also use the wrappers to set and get
trigger_data.

	Acked-by: Pavel Machek <pavel@ucw.cz>
	Acked-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
	Signed-off-by: Uwe Kleine-König <u.kleine-koenig@pengutronix.de>
	Signed-off-by: Jacek Anaszewski <jacek.anaszewski@gmail.com>
(cherry picked from commit 6f7b0bad88397ad5d7901ce63696163ac8b481ce)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/usb/core/ledtrig-usbport.c
diff --cc drivers/usb/core/ledtrig-usbport.c
index d775ffea20c3,dc7f7fd71684..000000000000
--- a/drivers/usb/core/ledtrig-usbport.c
+++ b/drivers/usb/core/ledtrig-usbport.c
@@@ -298,14 -304,13 +304,17 @@@ static int usbport_trig_notify(struct n
  	return NOTIFY_DONE;
  }
  
 -static int usbport_trig_activate(struct led_classdev *led_cdev)
 +static void usbport_trig_activate(struct led_classdev *led_cdev)
  {
  	struct usbport_trig_data *usbport_data;
- 	int err;
  
  	usbport_data = kzalloc(sizeof(*usbport_data), GFP_KERNEL);
  	if (!usbport_data)
++<<<<<<< HEAD
 +		return;
++=======
+ 		return -ENOMEM;
++>>>>>>> 6f7b0bad8839 (usb: simplify usbport trigger)
  	usbport_data->led_cdev = led_cdev;
  
  	/* List of ports */
@@@ -317,15 -319,11 +323,19 @@@
  	usbport_trig_update_count(usbport_data);
  
  	/* Notifications */
- 	usbport_data->nb.notifier_call = usbport_trig_notify,
- 	led_cdev->trigger_data = usbport_data;
+ 	usbport_data->nb.notifier_call = usbport_trig_notify;
+ 	led_set_trigger_data(led_cdev, usbport_data);
  	usb_register_notify(&usbport_data->nb);
  
++<<<<<<< HEAD
 +	led_cdev->activated = true;
 +	return;
 +
 +err_free:
 +	kfree(usbport_data);
++=======
+ 	return 0;
++>>>>>>> 6f7b0bad8839 (usb: simplify usbport trigger)
  }
  
  static void usbport_trig_deactivate(struct led_classdev *led_cdev)
* Unmerged path drivers/usb/core/ledtrig-usbport.c
