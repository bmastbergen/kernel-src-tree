drm/amdgpu: fix gfx hang during suspend with video playback (v2)

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-240.el8
commit-author Prike Liang <Prike.Liang@amd.com>
commit 487eca11a321ef33bcf4ca5adb3c0c4954db1b58
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-240.el8/487eca11.failed

The system will be hang up during S3 suspend because of SMU is pending
for GC not respose the register CP_HQD_ACTIVE access request.This issue
root cause of accessing the GC register under enter GFX CGGPG and can
be fixed by disable GFX CGPG before perform suspend.

v2: Use disable the GFX CGPG instead of RLC safe mode guard.

	Signed-off-by: Prike Liang <Prike.Liang@amd.com>
	Tested-by: Mengbing Wang <Mengbing.Wang@amd.com>
	Reviewed-by: Huang Rui <ray.huang@amd.com>
	Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
	Cc: stable@vger.kernel.org
(cherry picked from commit 487eca11a321ef33bcf4ca5adb3c0c4954db1b58)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/gpu/drm/amd/amdgpu/amdgpu_device.c
diff --cc drivers/gpu/drm/amd/amdgpu/amdgpu_device.c
index 2877ce84aef2,559dc24ef436..000000000000
--- a/drivers/gpu/drm/amd/amdgpu/amdgpu_device.c
+++ b/drivers/gpu/drm/amd/amdgpu/amdgpu_device.c
@@@ -2973,7 -3354,10 +2971,14 @@@ int amdgpu_device_suspend(struct drm_de
  		}
  	}
  
++<<<<<<< HEAD
 +	amdgpu_amdkfd_suspend(adev);
++=======
+ 	amdgpu_device_set_pg_state(adev, AMD_PG_STATE_UNGATE);
+ 	amdgpu_device_set_cg_state(adev, AMD_CG_STATE_UNGATE);
+ 
+ 	amdgpu_amdkfd_suspend(adev, !fbcon);
++>>>>>>> 487eca11a321 (drm/amdgpu: fix gfx hang during suspend with video playback (v2))
  
  	amdgpu_ras_suspend(adev);
  
* Unmerged path drivers/gpu/drm/amd/amdgpu/amdgpu_device.c
