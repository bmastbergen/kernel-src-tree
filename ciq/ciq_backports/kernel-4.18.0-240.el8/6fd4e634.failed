ceph: allow object copies across different filesystems in the same cluster

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-240.el8
commit-author Luis Henriques <lhenriques@suse.com>
commit 6fd4e634835208ddb331234bfa51d75396a5c42c
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-240.el8/6fd4e634.failed

OSDs are able to perform object copies across different pools.  Thus,
there's no need to prevent copy_file_range from doing remote copies if the
source and destination superblocks are different.  Only return -EXDEV if
they have different fsid (the cluster ID).

	Signed-off-by: Luis Henriques <lhenriques@suse.com>
	Reviewed-by: Jeff Layton <jlayton@kernel.org>
	Signed-off-by: Ilya Dryomov <idryomov@gmail.com>
(cherry picked from commit 6fd4e634835208ddb331234bfa51d75396a5c42c)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	fs/ceph/file.c
diff --cc fs/ceph/file.c
index dbc64bff395f,d277f71abe0b..000000000000
--- a/fs/ceph/file.c
+++ b/fs/ceph/file.c
@@@ -1964,6 -1953,9 +1973,12 @@@ static ssize_t __ceph_copy_file_range(s
  	 * efficient).
  	 */
  
++<<<<<<< HEAD
++=======
+ 	if (ceph_test_mount_opt(src_fsc, NOCOPYFROM))
+ 		return -EOPNOTSUPP;
+ 
++>>>>>>> 6fd4e6348352 (ceph: allow object copies across different filesystems in the same cluster)
  	if ((src_ci->i_layout.stripe_unit != dst_ci->i_layout.stripe_unit) ||
  	    (src_ci->i_layout.stripe_count != dst_ci->i_layout.stripe_count) ||
  	    (src_ci->i_layout.object_size != dst_ci->i_layout.object_size))
* Unmerged path fs/ceph/file.c
