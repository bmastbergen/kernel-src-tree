timers: Lower base clock forwarding threshold

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-240.el8
commit-author Frederic Weisbecker <frederic@kernel.org>
commit 36cd28a4cdd05d47ccb62a2d86e8f37839cc879a
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-240.el8/36cd28a4.failed

There is nothing that prevents from forwarding the base clock if it's one
jiffy off. The reason for this arbitrary limit of two jiffies is historical
and does not longer exist.

	Signed-off-by: Frederic Weisbecker <frederic@kernel.org>
	Signed-off-by: Thomas Gleixner <tglx@linutronix.de>
	Tested-by: Juri Lelli <juri.lelli@redhat.com>
Link: https://lkml.kernel.org/r/20200717140551.29076-13-frederic@kernel.org

(cherry picked from commit 36cd28a4cdd05d47ccb62a2d86e8f37839cc879a)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	kernel/time/timer.c
diff --cc kernel/time/timer.c
index a75a103821b7,77e21e98ec32..000000000000
--- a/kernel/time/timer.c
+++ b/kernel/time/timer.c
@@@ -884,20 -887,14 +884,24 @@@ get_target_base(struct timer_base *base
  
  static inline void forward_timer_base(struct timer_base *base)
  {
 -	unsigned long jnow = READ_ONCE(jiffies);
 +#ifdef CONFIG_NO_HZ_COMMON
 +	unsigned long jnow;
  
  	/*
 -	 * No need to forward if we are close enough below jiffies.
 -	 * Also while executing timers, base->clk is 1 offset ahead
 -	 * of jiffies to avoid endless requeuing to current jffies.
 +	 * We only forward the base when we are idle or have just come out of
 +	 * idle (must_forward_clk logic), and have a delta between base clock
 +	 * and jiffies. In the common case, run_timers will take care of it.
  	 */
++<<<<<<< HEAD
 +	if (likely(!base->must_forward_clk))
 +		return;
 +
 +	jnow = READ_ONCE(jiffies);
 +	base->must_forward_clk = base->is_idle;
 +	if ((long)(jnow - base->clk) < 2)
++=======
+ 	if ((long)(jnow - base->clk) < 1)
++>>>>>>> 36cd28a4cdd0 (timers: Lower base clock forwarding threshold)
  		return;
  
  	/*
* Unmerged path kernel/time/timer.c
