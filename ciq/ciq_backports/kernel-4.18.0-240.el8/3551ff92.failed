drm/i915/gen11: Moving WAs to rcs_engine_wa_init()

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-240.el8
commit-author José Roberto de Souza <jose.souza@intel.com>
commit 3551ff92874405674b58ac0f5742069a5ddfc462
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-240.el8/3551ff92.failed

This are register of render engine, so after a render reset those
would return to the default value and init_clock_gating() is not
called for single engine reset.
So here moving it rcs_engine_wa_init() that will guarantee that this
WAs will not be lost.

	Cc: Matt Roper <matthew.d.roper@intel.com>
	Signed-off-by: José Roberto de Souza <jose.souza@intel.com>
	Reviewed-by: Matt Roper <matthew.d.roper@intel.com>
Link: https://patchwork.freedesktop.org/patch/msgid/20200302231421.224322-1-jose.souza@intel.com
(cherry picked from commit 3551ff92874405674b58ac0f5742069a5ddfc462)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/gpu/drm/i915/gt/intel_workarounds.c
diff --cc drivers/gpu/drm/i915/gt/intel_workarounds.c
index 8f75882ded3f,90e1c48dd6be..000000000000
--- a/drivers/gpu/drm/i915/gt/intel_workarounds.c
+++ b/drivers/gpu/drm/i915/gt/intel_workarounds.c
@@@ -1290,6 -1448,27 +1290,30 @@@ rcs_engine_wa_init(struct intel_engine_
  		wa_write_or(wal,
  			    GEN7_SARCHKMD,
  			    GEN7_DISABLE_SAMPLER_PREFETCH);
++<<<<<<< HEAD
++=======
+ 
+ 		/* Wa_1409178092:icl */
+ 		wa_write_masked_or(wal,
+ 				   GEN11_SCRATCH2,
+ 				   GEN11_COHERENT_PARTIAL_WRITE_MERGE_ENABLE,
+ 				   0);
+ 
+ 		/* WaEnable32PlaneMode:icl */
+ 		wa_masked_en(wal, GEN9_CSFE_CHICKEN1_RCS,
+ 			     GEN11_ENABLE_32_PLANE_MODE);
+ 
+ 		/*
+ 		 * Wa_1408615072:icl,ehl  (vsunit)
+ 		 * Wa_1407596294:icl,ehl  (hsunit)
+ 		 */
+ 		wa_masked_en(wal, UNSLICE_UNIT_LEVEL_CLKGATE,
+ 			     VSUNIT_CLKGATE_DIS | HSUNIT_CLKGATE_DIS);
+ 
+ 		/* Wa_1407352427:icl,ehl */
+ 		wa_masked_en(wal, UNSLICE_UNIT_LEVEL_CLKGATE2,
+ 			     PSDUNIT_CLKGATE_DIS);
++>>>>>>> 3551ff928744 (drm/i915/gen11: Moving WAs to rcs_engine_wa_init())
  	}
  
  	if (IS_GEN_RANGE(i915, 9, 11)) {
* Unmerged path drivers/gpu/drm/i915/gt/intel_workarounds.c
diff --git a/drivers/gpu/drm/i915/intel_pm.c b/drivers/gpu/drm/i915/intel_pm.c
index a63d278b5173..9c7f5a6c8eea 100644
--- a/drivers/gpu/drm/i915/intel_pm.c
+++ b/drivers/gpu/drm/i915/intel_pm.c
@@ -9196,21 +9196,6 @@ static void icl_init_clock_gating(struct drm_i915_private *dev_priv)
 	I915_WRITE(GEN10_DFR_RATIO_EN_AND_CHICKEN,
 		   I915_READ(GEN10_DFR_RATIO_EN_AND_CHICKEN) & ~DFR_DISABLE);
 
-	/* WaEnable32PlaneMode:icl */
-	I915_WRITE(GEN9_CSFE_CHICKEN1_RCS,
-		   _MASKED_BIT_ENABLE(GEN11_ENABLE_32_PLANE_MODE));
-
-	/*
-	 * Wa_1408615072:icl,ehl  (vsunit)
-	 * Wa_1407596294:icl,ehl  (hsunit)
-	 */
-	intel_uncore_rmw(&dev_priv->uncore, UNSLICE_UNIT_LEVEL_CLKGATE,
-			 0, VSUNIT_CLKGATE_DIS | HSUNIT_CLKGATE_DIS);
-
-	/* Wa_1407352427:icl,ehl */
-	intel_uncore_rmw(&dev_priv->uncore, UNSLICE_UNIT_LEVEL_CLKGATE2,
-			 0, PSDUNIT_CLKGATE_DIS);
-
 	/*Wa_14010594013:icl, ehl */
 	intel_uncore_rmw(&dev_priv->uncore, GEN8_CHICKEN_DCPR_1,
 			 0, CNL_DELAY_PMRSP);
