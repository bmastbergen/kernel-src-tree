mlxsw: Add OVERLAY_SMAC_MC trap

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-240.el8
commit-author Amit Cohen <amitc@mellanox.com>
commit 3aed0722f7d75240ab7ea0ee2813f6a82f53c60e
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-240.el8/3aed0722.failed

Add a trap for NVE packets that the device decided to drop because their
overlay source MAC is multicast.

	Signed-off-by: Amit Cohen <amitc@mellanox.com>
	Acked-by: Jiri Pirko <jiri@mellanox.com>
	Signed-off-by: Ido Schimmel <idosch@mellanox.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 3aed0722f7d75240ab7ea0ee2813f6a82f53c60e)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/mellanox/mlxsw/spectrum_trap.c
#	drivers/net/ethernet/mellanox/mlxsw/trap.h
diff --cc drivers/net/ethernet/mellanox/mlxsw/spectrum_trap.c
index 189c0b7dcd78,60205aa3f6a5..000000000000
--- a/drivers/net/ethernet/mellanox/mlxsw/spectrum_trap.c
+++ b/drivers/net/ethernet/mellanox/mlxsw/spectrum_trap.c
@@@ -58,6 -78,11 +58,14 @@@ static struct devlink_trap mlxsw_sp_tra
  	MLXSW_SP_TRAP_EXCEPTION(UNRESOLVED_NEIGH, L3_DROPS),
  	MLXSW_SP_TRAP_EXCEPTION(IPV4_LPM_UNICAST_MISS, L3_DROPS),
  	MLXSW_SP_TRAP_EXCEPTION(IPV6_LPM_UNICAST_MISS, L3_DROPS),
++<<<<<<< HEAD
++=======
+ 	MLXSW_SP_TRAP_DRIVER_DROP(IRIF_DISABLED, L3_DROPS),
+ 	MLXSW_SP_TRAP_DRIVER_DROP(ERIF_DISABLED, L3_DROPS),
+ 	MLXSW_SP_TRAP_DROP(NON_ROUTABLE, L3_DROPS),
+ 	MLXSW_SP_TRAP_EXCEPTION(DECAP_ERROR, TUNNEL_DROPS),
+ 	MLXSW_SP_TRAP_DROP(OVERLAY_SMAC_MC, TUNNEL_DROPS),
++>>>>>>> 3aed0722f7d7 (mlxsw: Add OVERLAY_SMAC_MC trap)
  };
  
  static struct mlxsw_listener mlxsw_sp_listeners_arr[] = {
@@@ -90,6 -115,15 +98,18 @@@
  			       TRAP_EXCEPTION_TO_CPU),
  	MLXSW_SP_RXL_EXCEPTION(DISCARD_ROUTER_LPM6, ROUTER_EXP,
  			       TRAP_EXCEPTION_TO_CPU),
++<<<<<<< HEAD
++=======
+ 	MLXSW_SP_RXL_DISCARD(ROUTER_IRIF_EN, L3_DISCARDS),
+ 	MLXSW_SP_RXL_DISCARD(ROUTER_ERIF_EN, L3_DISCARDS),
+ 	MLXSW_SP_RXL_DISCARD(NON_ROUTABLE, L3_DISCARDS),
+ 	MLXSW_SP_RXL_EXCEPTION(DECAP_ECN0, ROUTER_EXP, TRAP_EXCEPTION_TO_CPU),
+ 	MLXSW_SP_RXL_EXCEPTION(IPIP_DECAP_ERROR, ROUTER_EXP,
+ 			       TRAP_EXCEPTION_TO_CPU),
+ 	MLXSW_SP_RXL_EXCEPTION(DISCARD_DEC_PKT, TUNNEL_DISCARDS,
+ 			       TRAP_EXCEPTION_TO_CPU),
+ 	MLXSW_SP_RXL_DISCARD(OVERLAY_SMAC_MC, TUNNEL_DISCARDS),
++>>>>>>> 3aed0722f7d7 (mlxsw: Add OVERLAY_SMAC_MC trap)
  };
  
  /* Mapping between hardware trap and devlink trap. Multiple hardware traps can
@@@ -123,6 -157,13 +143,16 @@@ static u16 mlxsw_sp_listener_devlink_ma
  	DEVLINK_TRAP_GENERIC_ID_UNRESOLVED_NEIGH,
  	DEVLINK_TRAP_GENERIC_ID_IPV4_LPM_UNICAST_MISS,
  	DEVLINK_TRAP_GENERIC_ID_IPV6_LPM_UNICAST_MISS,
++<<<<<<< HEAD
++=======
+ 	DEVLINK_MLXSW_TRAP_ID_IRIF_DISABLED,
+ 	DEVLINK_MLXSW_TRAP_ID_ERIF_DISABLED,
+ 	DEVLINK_TRAP_GENERIC_ID_NON_ROUTABLE,
+ 	DEVLINK_TRAP_GENERIC_ID_DECAP_ERROR,
+ 	DEVLINK_TRAP_GENERIC_ID_DECAP_ERROR,
+ 	DEVLINK_TRAP_GENERIC_ID_DECAP_ERROR,
+ 	DEVLINK_TRAP_GENERIC_ID_OVERLAY_SMAC_MC,
++>>>>>>> 3aed0722f7d7 (mlxsw: Add OVERLAY_SMAC_MC trap)
  };
  
  static int mlxsw_sp_rx_listener(struct mlxsw_sp *mlxsw_sp, struct sk_buff *skb,
diff --cc drivers/net/ethernet/mellanox/mlxsw/trap.h
index 3d2331be05d8,12e1fa998d42..000000000000
--- a/drivers/net/ethernet/mellanox/mlxsw/trap.h
+++ b/drivers/net/ethernet/mellanox/mlxsw/trap.h
@@@ -88,8 -89,12 +88,13 @@@ enum 
  	MLXSW_TRAP_ID_DISCARD_ING_ROUTER_IPV4_SIP_BC = 0x16A,
  	MLXSW_TRAP_ID_DISCARD_ING_ROUTER_IPV4_DIP_LOCAL_NET = 0x16B,
  	MLXSW_TRAP_ID_DISCARD_ING_ROUTER_DIP_LINK_LOCAL = 0x16C,
 -	MLXSW_TRAP_ID_DISCARD_ROUTER_IRIF_EN = 0x178,
 -	MLXSW_TRAP_ID_DISCARD_ROUTER_ERIF_EN = 0x179,
  	MLXSW_TRAP_ID_DISCARD_ROUTER_LPM4 = 0x17B,
  	MLXSW_TRAP_ID_DISCARD_ROUTER_LPM6 = 0x17C,
++<<<<<<< HEAD
++=======
+ 	MLXSW_TRAP_ID_DISCARD_DEC_PKT = 0x188,
+ 	MLXSW_TRAP_ID_DISCARD_OVERLAY_SMAC_MC = 0x190,
++>>>>>>> 3aed0722f7d7 (mlxsw: Add OVERLAY_SMAC_MC trap)
  	MLXSW_TRAP_ID_DISCARD_IPV6_MC_DIP_RESERVED_SCOPE = 0x1B0,
  	MLXSW_TRAP_ID_DISCARD_IPV6_MC_DIP_INTERFACE_LOCAL_SCOPE = 0x1B1,
  	MLXSW_TRAP_ID_ACL0 = 0x1C0,
* Unmerged path drivers/net/ethernet/mellanox/mlxsw/spectrum_trap.c
* Unmerged path drivers/net/ethernet/mellanox/mlxsw/trap.h
