RDMA/efa: Allow passing of optional access flags for MR registration

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-240.el8
commit-author Michael Guralnik <michaelgur@mellanox.com>
commit 86dd738cf20cee4ac316274743e5707c4ccb6039
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-240.el8/86dd738c.failed

As part of adding a range of optional access flags that drivers need to be
able to accept, mask this range inside efa driver.  This will prevent the
driver from failing when an access flag from that range is passed.

Link: https://lore.kernel.org/r/1578506740-22188-8-git-send-email-yishaih@mellanox.com
	Signed-off-by: Michael Guralnik <michaelgur@mellanox.com>
	Signed-off-by: Yishai Hadas <yishaih@mellanox.com>
	Signed-off-by: Jason Gunthorpe <jgg@mellanox.com>
(cherry picked from commit 86dd738cf20cee4ac316274743e5707c4ccb6039)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/infiniband/hw/efa/efa_verbs.c
diff --cc drivers/infiniband/hw/efa/efa_verbs.c
index 96834fe1448f,a556572058ff..000000000000
--- a/drivers/infiniband/hw/efa/efa_verbs.c
+++ b/drivers/infiniband/hw/efa/efa_verbs.c
@@@ -1383,10 -1363,15 +1383,19 @@@ struct ib_mr *efa_reg_mr(struct ib_pd *
  		goto err_out;
  	}
  
++<<<<<<< HEAD
 +	if (access_flags & ~EFA_SUPPORTED_ACCESS_FLAGS) {
++=======
+ 	supp_access_flags =
+ 		IB_ACCESS_LOCAL_WRITE |
+ 		(is_rdma_read_cap(dev) ? IB_ACCESS_REMOTE_READ : 0);
+ 
+ 	access_flags &= ~IB_UVERBS_ACCESS_OPTIONAL_RANGE;
+ 	if (access_flags & ~supp_access_flags) {
++>>>>>>> 86dd738cf20c (RDMA/efa: Allow passing of optional access flags for MR registration)
  		ibdev_dbg(&dev->ibdev,
  			  "Unsupported access flags[%#x], supported[%#x]\n",
 -			  access_flags, supp_access_flags);
 +			  access_flags, EFA_SUPPORTED_ACCESS_FLAGS);
  		err = -EOPNOTSUPP;
  		goto err_out;
  	}
* Unmerged path drivers/infiniband/hw/efa/efa_verbs.c
