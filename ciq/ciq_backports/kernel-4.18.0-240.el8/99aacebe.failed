selftests: do not use .ONESHELL

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-240.el8
commit-author Yauheni Kaliuta <yauheni.kaliuta@redhat.com>
commit 99aacebecb75c61e6a6a1bc29f5d87c9453f3b73
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-240.el8/99aacebe.failed

Using one shell for the whole recipe with long lists can cause

make[1]: execvp: /bin/sh: Argument list too long

with some shells. Triggered by commit 309b81f0fdc4 ("selftests/bpf:
Install generated test progs")

It requires to change the rule which rely on the one shell
behaviour (run_tests).

Simplify also INSTALL_SINGLE_RULE, remove extra echo, required to
workaround .ONESHELL.

	Signed-off-by: Yauheni Kaliuta <yauheni.kaliuta@redhat.com>
	Cc: Jiri Benc <jbenc@redhat.com>
	Cc: Shuah Khan <shuah@kernel.org>
	Signed-off-by: Shuah Khan <skhan@linuxfoundation.org>
(cherry picked from commit 99aacebecb75c61e6a6a1bc29f5d87c9453f3b73)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	tools/testing/selftests/lib.mk
diff --cc tools/testing/selftests/lib.mk
index 20f8b5a63412,5b82433d88e3..000000000000
--- a/tools/testing/selftests/lib.mk
+++ b/tools/testing/selftests/lib.mk
@@@ -42,17 -69,17 +41,23 @@@ define RUN_TEST
  endef
  
  run_tests: all
++<<<<<<< HEAD
 +ifneq ($(KBUILD_SRC),)
 +	@if [ "X$(TEST_PROGS) $(TEST_PROGS_EXTENDED) $(TEST_FILES)" != "X" ]; then
 +		@rsync -aq $(TEST_PROGS) $(TEST_PROGS_EXTENDED) $(TEST_FILES) $(OUTPUT)
++=======
+ ifdef building_out_of_srctree
+ 	@if [ "X$(TEST_PROGS) $(TEST_PROGS_EXTENDED) $(TEST_FILES)" != "X" ]; then \
+ 		rsync -aq $(TEST_PROGS) $(TEST_PROGS_EXTENDED) $(TEST_FILES) $(OUTPUT); \
++>>>>>>> 99aacebecb75 (selftests: do not use .ONESHELL)
  	fi
- 	@if [ "X$(TEST_PROGS)" != "X" ]; then
- 		$(call RUN_TESTS, $(TEST_GEN_PROGS) $(TEST_CUSTOM_PROGS) $(OUTPUT)/$(TEST_PROGS))
- 	else
- 		$(call RUN_TESTS, $(TEST_GEN_PROGS) $(TEST_CUSTOM_PROGS))
+ 	@if [ "X$(TEST_PROGS)" != "X" ]; then \
+ 		$(call RUN_TESTS, $(TEST_GEN_PROGS) $(TEST_CUSTOM_PROGS) $(OUTPUT)/$(TEST_PROGS)) ; \
+ 	else \
+ 		$(call RUN_TESTS, $(TEST_GEN_PROGS) $(TEST_CUSTOM_PROGS)); \
  	fi
  else
- 	$(call RUN_TESTS, $(TEST_GEN_PROGS) $(TEST_CUSTOM_PROGS) $(TEST_PROGS))
+ 	@$(call RUN_TESTS, $(TEST_GEN_PROGS) $(TEST_CUSTOM_PROGS) $(TEST_PROGS))
  endif
  
  define INSTALL_SINGLE_RULE
* Unmerged path tools/testing/selftests/lib.mk
