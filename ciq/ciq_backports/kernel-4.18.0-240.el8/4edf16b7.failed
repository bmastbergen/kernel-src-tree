bpf, lsm: Make BPF_LSM depend on BPF_EVENTS

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-240.el8
commit-author KP Singh <kpsingh@google.com>
commit 4edf16b72c57bb0faad5da143f812384df0c43f6
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-240.el8/4edf16b7.failed

LSM and tracing programs share their helpers with bpf_tracing_func_proto
which is only defined (in bpf_trace.c) when BPF_EVENTS is enabled.

Instead of adding __weak symbol, make BPF_LSM depend on BPF_EVENTS so
that both tracing and LSM programs can actually share helpers.

Fixes: fc611f47f218 ("bpf: Introduce BPF_PROG_TYPE_LSM")
	Reported-by: Randy Dunlap <rdunlap@infradead.org>
	Signed-off-by: KP Singh <kpsingh@google.com>
	Signed-off-by: Daniel Borkmann <daniel@iogearbox.net>
Link: https://lore.kernel.org/bpf/20200330204059.13024-1-kpsingh@chromium.org
(cherry picked from commit 4edf16b72c57bb0faad5da143f812384df0c43f6)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	init/Kconfig
diff --cc init/Kconfig
index 3b1ea0bbdb4e,7b7ea70e64ac..000000000000
--- a/init/Kconfig
+++ b/init/Kconfig
@@@ -1469,9 -1616,21 +1469,25 @@@ config KALLSYMS_BASE_RELATIV
  # end of the "standard kernel features (expert users)" menu
  
  # syscall, maps, verifier
++<<<<<<< HEAD
++=======
+ 
+ config BPF_LSM
+ 	bool "LSM Instrumentation with BPF"
+ 	depends on BPF_EVENTS
+ 	depends on BPF_SYSCALL
+ 	depends on SECURITY
+ 	depends on BPF_JIT
+ 	help
+ 	  Enables instrumentation of the security hooks with eBPF programs for
+ 	  implementing dynamic MAC and Audit Policies.
+ 
+ 	  If you are unsure how to answer this question, answer N.
+ 
++>>>>>>> 4edf16b72c57 (bpf, lsm: Make BPF_LSM depend on BPF_EVENTS)
  config BPF_SYSCALL
  	bool "Enable bpf() system call"
 +	select ANON_INODES
  	select BPF
  	select IRQ_WORK
  	default n
* Unmerged path init/Kconfig
