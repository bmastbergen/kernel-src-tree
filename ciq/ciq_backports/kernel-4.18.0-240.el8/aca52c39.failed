mm: remove CONFIG_HAVE_MEMBLOCK

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-240.el8
commit-author Mike Rapoport <rppt@linux.vnet.ibm.com>
commit aca52c39838910605b1063a2243f553aa2a02d5c
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-240.el8/aca52c39.failed

All architecures use memblock for early memory management. There is no need
for the CONFIG_HAVE_MEMBLOCK configuration option.

[rppt@linux.vnet.ibm.com: of/fdt: fixup #ifdefs]
  Link: http://lkml.kernel.org/r/20180919103457.GA20545@rapoport-lnx
[rppt@linux.vnet.ibm.com: csky: fixups after bootmem removal]
  Link: http://lkml.kernel.org/r/20180926112744.GC4628@rapoport-lnx
[rppt@linux.vnet.ibm.com: remove stale #else and the code it protects]
  Link: http://lkml.kernel.org/r/1538067825-24835-1-git-send-email-rppt@linux.vnet.ibm.com
Link: http://lkml.kernel.org/r/1536927045-23536-4-git-send-email-rppt@linux.vnet.ibm.com
	Signed-off-by: Mike Rapoport <rppt@linux.vnet.ibm.com>
	Acked-by: Michal Hocko <mhocko@suse.com>
	Tested-by: Jonathan Cameron <jonathan.cameron@huawei.com>
	Cc: Catalin Marinas <catalin.marinas@arm.com>
	Cc: Chris Zankel <chris@zankel.net>
	Cc: "David S. Miller" <davem@davemloft.net>
	Cc: Geert Uytterhoeven <geert@linux-m68k.org>
	Cc: Greentime Hu <green.hu@gmail.com>
	Cc: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
	Cc: Guan Xuetao <gxt@pku.edu.cn>
	Cc: Ingo Molnar <mingo@redhat.com>
	Cc: "James E.J. Bottomley" <jejb@parisc-linux.org>
	Cc: Jonas Bonn <jonas@southpole.se>
	Cc: Jonathan Corbet <corbet@lwn.net>
	Cc: Ley Foon Tan <lftan@altera.com>
	Cc: Mark Salter <msalter@redhat.com>
	Cc: Martin Schwidefsky <schwidefsky@de.ibm.com>
	Cc: Matt Turner <mattst88@gmail.com>
	Cc: Michael Ellerman <mpe@ellerman.id.au>
	Cc: Michal Simek <monstr@monstr.eu>
	Cc: Palmer Dabbelt <palmer@sifive.com>
	Cc: Paul Burton <paul.burton@mips.com>
	Cc: Richard Kuo <rkuo@codeaurora.org>
	Cc: Richard Weinberger <richard@nod.at>
	Cc: Rich Felker <dalias@libc.org>
	Cc: Russell King <linux@armlinux.org.uk>
	Cc: Serge Semin <fancer.lancer@gmail.com>
	Cc: Thomas Gleixner <tglx@linutronix.de>
	Cc: Tony Luck <tony.luck@intel.com>
	Cc: Vineet Gupta <vgupta@synopsys.com>
	Cc: Yoshinori Sato <ysato@users.sourceforge.jp>
	Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
	Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
(cherry picked from commit aca52c39838910605b1063a2243f553aa2a02d5c)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/csky/Kconfig
#	arch/csky/kernel/setup.c
#	arch/csky/mm/highmem.c
#	arch/csky/mm/init.c
#	arch/hexagon/Kconfig
#	arch/m68k/Kconfig
#	arch/microblaze/Kconfig
#	arch/nios2/Kconfig
#	arch/parisc/Kconfig
#	arch/um/Kconfig.um
#	arch/unicore32/Kconfig
#	include/linux/bootmem.h
#	mm/Makefile
diff --cc arch/hexagon/Kconfig
index 7b25f4fe4f92,2b688af379e6..000000000000
--- a/arch/hexagon/Kconfig
+++ b/arch/hexagon/Kconfig
@@@ -19,6 -21,7 +19,10 @@@ config HEXAGO
  	select GENERIC_IRQ_SHOW
  	select HAVE_ARCH_KGDB
  	select HAVE_ARCH_TRACEHOOK
++<<<<<<< HEAD
++=======
+ 	select ARCH_DISCARD_MEMBLOCK
++>>>>>>> aca52c398389 (mm: remove CONFIG_HAVE_MEMBLOCK)
  	select NEED_SG_DMA_LENGTH
  	select NO_IOPORT_MAP
  	select GENERIC_IOMAP
diff --cc arch/m68k/Kconfig
index afadda00401e,1bc9f1ba759a..000000000000
--- a/arch/m68k/Kconfig
+++ b/arch/m68k/Kconfig
@@@ -24,6 -26,8 +24,11 @@@ config M68
  	select MODULES_USE_ELF_RELA
  	select OLD_SIGSUSPEND3
  	select OLD_SIGACTION
++<<<<<<< HEAD
++=======
+ 	select DMA_DIRECT_OPS if HAS_DMA
+ 	select ARCH_DISCARD_MEMBLOCK
++>>>>>>> aca52c398389 (mm: remove CONFIG_HAVE_MEMBLOCK)
  
  config CPU_BIG_ENDIAN
  	def_bool y
diff --cc arch/microblaze/Kconfig
index 3218a8b35f9c,effed2efd306..000000000000
--- a/arch/microblaze/Kconfig
+++ b/arch/microblaze/Kconfig
@@@ -23,8 -28,6 +23,11 @@@ config MICROBLAZ
  	select HAVE_FTRACE_MCOUNT_RECORD
  	select HAVE_FUNCTION_GRAPH_TRACER
  	select HAVE_FUNCTION_TRACER
++<<<<<<< HEAD
 +	select NO_BOOTMEM
 +	select HAVE_MEMBLOCK
++=======
++>>>>>>> aca52c398389 (mm: remove CONFIG_HAVE_MEMBLOCK)
  	select HAVE_MEMBLOCK_NODE_MAP
  	select HAVE_OPROFILE
  	select IRQ_DOMAIN
diff --cc arch/nios2/Kconfig
index c6ff28b77c86,7e95506e957a..000000000000
--- a/arch/nios2/Kconfig
+++ b/arch/nios2/Kconfig
@@@ -19,6 -23,7 +19,10 @@@ config NIOS
  	select SPARSE_IRQ
  	select USB_ARCH_HAS_HCD if USB_SUPPORT
  	select CPU_NO_EFFICIENT_FFS
++<<<<<<< HEAD
++=======
+ 	select ARCH_DISCARD_MEMBLOCK
++>>>>>>> aca52c398389 (mm: remove CONFIG_HAVE_MEMBLOCK)
  
  config GENERIC_CSUM
  	def_bool y
diff --cc arch/parisc/Kconfig
index e212ceceacc5,92a339ee28b3..000000000000
--- a/arch/parisc/Kconfig
+++ b/arch/parisc/Kconfig
@@@ -15,8 -15,6 +15,11 @@@ config PARIS
  	select RTC_CLASS
  	select RTC_DRV_GENERIC
  	select INIT_ALL_POSSIBLE
++<<<<<<< HEAD
 +	select HAVE_MEMBLOCK
 +	select NO_BOOTMEM
++=======
++>>>>>>> aca52c398389 (mm: remove CONFIG_HAVE_MEMBLOCK)
  	select BUG
  	select BUILDTIME_EXTABLE_SORT
  	select HAVE_PERF_EVENTS
diff --cc arch/um/Kconfig.um
index 20da5a8ca949,6b9938919f0b..000000000000
--- a/arch/um/Kconfig.um
+++ b/arch/um/Kconfig.um
@@@ -1,4 -1,70 +1,73 @@@
  # SPDX-License-Identifier: GPL-2.0
++<<<<<<< HEAD:arch/um/Kconfig.um
++=======
+ 
+ menu "UML-specific options"
+ 
+ config UML
+ 	bool
+ 	default y
+ 	select ARCH_HAS_KCOV
+ 	select ARCH_NO_PREEMPT
+ 	select HAVE_ARCH_AUDITSYSCALL
+ 	select HAVE_ARCH_SECCOMP_FILTER
+ 	select HAVE_UID16
+ 	select HAVE_FUTEX_CMPXCHG if FUTEX
+ 	select HAVE_DEBUG_KMEMLEAK
+ 	select GENERIC_IRQ_SHOW
+ 	select GENERIC_CPU_DEVICES
+ 	select GENERIC_CLOCKEVENTS
+ 	select HAVE_GCC_PLUGINS
+ 	select TTY # Needed for line.c
+ 
+ config MMU
+ 	bool
+ 	default y
+ 
+ config NO_IOMEM
+ 	def_bool y
+ 
+ config ISA
+ 	bool
+ 
+ config SBUS
+ 	bool
+ 
+ config PCI
+ 	bool
+ 
+ config PCMCIA
+ 	bool
+ 
+ config TRACE_IRQFLAGS_SUPPORT
+ 	bool
+ 	default y
+ 
+ config LOCKDEP_SUPPORT
+ 	bool
+ 	default y
+ 
+ config STACKTRACE_SUPPORT
+ 	bool
+ 	default y
+ 	select STACKTRACE
+ 
+ config GENERIC_CALIBRATE_DELAY
+ 	bool
+ 	default y
+ 
+ config HZ
+ 	int
+ 	default 100
+ 
+ config NR_CPUS
+ 	int
+ 	range 1 1
+ 	default 1
+ 
+ source "arch/$(HEADER_ARCH)/um/Kconfig"
+ 
++>>>>>>> aca52c398389 (mm: remove CONFIG_HAVE_MEMBLOCK):arch/um/Kconfig
  config STATIC_LINK
  	bool "Force a static link"
  	default n
diff --cc arch/unicore32/Kconfig
index 4dd7d14574cb,a4c05159dca5..000000000000
--- a/arch/unicore32/Kconfig
+++ b/arch/unicore32/Kconfig
@@@ -4,7 -4,7 +4,11 @@@ config UNICORE3
  	select ARCH_HAS_DEVMEM_IS_ALLOWED
  	select ARCH_MIGHT_HAVE_PC_PARPORT
  	select ARCH_MIGHT_HAVE_PC_SERIO
++<<<<<<< HEAD
 +	select HAVE_MEMBLOCK
++=======
+ 	select DMA_DIRECT_OPS
++>>>>>>> aca52c398389 (mm: remove CONFIG_HAVE_MEMBLOCK)
  	select HAVE_GENERIC_DMA_COHERENT
  	select HAVE_KERNEL_GZIP
  	select HAVE_KERNEL_BZIP2
diff --cc include/linux/bootmem.h
index 42515195d7d8,ee61ac355104..000000000000
--- a/include/linux/bootmem.h
+++ b/include/linux/bootmem.h
@@@ -164,9 -132,6 +164,12 @@@ extern void *__alloc_bootmem_low_node(p
  #define alloc_bootmem_low_pages_node(pgdat, x) \
  	__alloc_bootmem_low_node(pgdat, x, PAGE_SIZE, 0)
  
++<<<<<<< HEAD
 +
 +#if defined(CONFIG_HAVE_MEMBLOCK) && defined(CONFIG_NO_BOOTMEM)
 +
++=======
++>>>>>>> aca52c398389 (mm: remove CONFIG_HAVE_MEMBLOCK)
  /* FIXME: use MEMBLOCK_ALLOC_* variants here */
  #define BOOTMEM_ALLOC_ACCESSIBLE	0
  #define BOOTMEM_ALLOC_ANYWHERE		(~(phys_addr_t)0)
@@@ -266,115 -231,6 +269,118 @@@ static inline void __init memblock_free
  	__memblock_free_late(base, size);
  }
  
++<<<<<<< HEAD
 +#else
 +
 +#define BOOTMEM_ALLOC_ACCESSIBLE	0
 +
 +
 +/* Fall back to all the existing bootmem APIs */
 +static inline void * __init memblock_virt_alloc(
 +					phys_addr_t size,  phys_addr_t align)
 +{
 +	if (!align)
 +		align = SMP_CACHE_BYTES;
 +	return __alloc_bootmem(size, align, BOOTMEM_LOW_LIMIT);
 +}
 +
 +static inline void * __init memblock_virt_alloc_raw(
 +					phys_addr_t size,  phys_addr_t align)
 +{
 +	if (!align)
 +		align = SMP_CACHE_BYTES;
 +	return __alloc_bootmem_nopanic(size, align, BOOTMEM_LOW_LIMIT);
 +}
 +
 +static inline void * __init memblock_virt_alloc_nopanic(
 +					phys_addr_t size, phys_addr_t align)
 +{
 +	if (!align)
 +		align = SMP_CACHE_BYTES;
 +	return __alloc_bootmem_nopanic(size, align, BOOTMEM_LOW_LIMIT);
 +}
 +
 +static inline void * __init memblock_virt_alloc_low(
 +					phys_addr_t size, phys_addr_t align)
 +{
 +	if (!align)
 +		align = SMP_CACHE_BYTES;
 +	return __alloc_bootmem_low(size, align, 0);
 +}
 +
 +static inline void * __init memblock_virt_alloc_low_nopanic(
 +					phys_addr_t size, phys_addr_t align)
 +{
 +	if (!align)
 +		align = SMP_CACHE_BYTES;
 +	return __alloc_bootmem_low_nopanic(size, align, 0);
 +}
 +
 +static inline void * __init memblock_virt_alloc_from_nopanic(
 +		phys_addr_t size, phys_addr_t align, phys_addr_t min_addr)
 +{
 +	return __alloc_bootmem_nopanic(size, align, min_addr);
 +}
 +
 +static inline void * __init memblock_virt_alloc_node(
 +						phys_addr_t size, int nid)
 +{
 +	return __alloc_bootmem_node(NODE_DATA(nid), size, SMP_CACHE_BYTES,
 +				     BOOTMEM_LOW_LIMIT);
 +}
 +
 +static inline void * __init memblock_virt_alloc_node_nopanic(
 +						phys_addr_t size, int nid)
 +{
 +	return __alloc_bootmem_node_nopanic(NODE_DATA(nid), size,
 +					     SMP_CACHE_BYTES,
 +					     BOOTMEM_LOW_LIMIT);
 +}
 +
 +static inline void * __init memblock_virt_alloc_try_nid(phys_addr_t size,
 +	phys_addr_t align, phys_addr_t min_addr, phys_addr_t max_addr, int nid)
 +{
 +	return __alloc_bootmem_node_high(NODE_DATA(nid), size, align,
 +					  min_addr);
 +}
 +
 +static inline void * __init memblock_virt_alloc_try_nid_raw(
 +			phys_addr_t size, phys_addr_t align,
 +			phys_addr_t min_addr, phys_addr_t max_addr, int nid)
 +{
 +	return ___alloc_bootmem_node_nopanic(NODE_DATA(nid), size, align,
 +				min_addr, max_addr);
 +}
 +
 +static inline void * __init memblock_virt_alloc_try_nid_nopanic(
 +			phys_addr_t size, phys_addr_t align,
 +			phys_addr_t min_addr, phys_addr_t max_addr, int nid)
 +{
 +	return ___alloc_bootmem_node_nopanic(NODE_DATA(nid), size, align,
 +				min_addr, max_addr);
 +}
 +
 +static inline void __init memblock_free_early(
 +					phys_addr_t base, phys_addr_t size)
 +{
 +	free_bootmem(base, size);
 +}
 +
 +static inline void __init memblock_free_early_nid(
 +				phys_addr_t base, phys_addr_t size, int nid)
 +{
 +	free_bootmem_node(NODE_DATA(nid), base, size);
 +}
 +
 +static inline void __init memblock_free_late(
 +					phys_addr_t base, phys_addr_t size)
 +{
 +	free_bootmem_late(base, size);
 +}
 +#endif /* defined(CONFIG_HAVE_MEMBLOCK) && defined(CONFIG_NO_BOOTMEM) */
 +
++=======
++>>>>>>> aca52c398389 (mm: remove CONFIG_HAVE_MEMBLOCK)
  extern void *alloc_large_system_hash(const char *tablename,
  				     unsigned long bucketsize,
  				     unsigned long numentries,
diff --cc mm/Makefile
index 4f58ee2f3f0e,ca3c844d7a56..000000000000
--- a/mm/Makefile
+++ b/mm/Makefile
@@@ -41,18 -41,9 +41,23 @@@ obj-y			:= filemap.o mempool.o oom_kill
  			   interval_tree.o list_lru.o workingset.o \
  			   debug.o $(mmu-y)
  
 +# Give 'page_alloc' its own module-parameter namespace
 +page-alloc-y := page_alloc.o
 +page-alloc-$(CONFIG_SHUFFLE_PAGE_ALLOCATOR) += shuffle.o
 +
 +obj-y += page-alloc.o
  obj-y += init-mm.o
++<<<<<<< HEAD
 +
 +ifdef CONFIG_NO_BOOTMEM
 +	obj-y		+= nobootmem.o
 +else
 +	obj-y		+= bootmem.o
 +endif
++=======
+ obj-y += nobootmem.o
+ obj-y += memblock.o
++>>>>>>> aca52c398389 (mm: remove CONFIG_HAVE_MEMBLOCK)
  
  ifdef CONFIG_MMU
  	obj-$(CONFIG_ADVISE_SYSCALLS)	+= madvise.o
* Unmerged path arch/csky/Kconfig
* Unmerged path arch/csky/kernel/setup.c
* Unmerged path arch/csky/mm/highmem.c
* Unmerged path arch/csky/mm/init.c
diff --git a/arch/arc/Kconfig b/arch/arc/Kconfig
index 753b0cdde165..b4671095525f 100644
--- a/arch/arc/Kconfig
+++ b/arch/arc/Kconfig
@@ -32,7 +32,6 @@ config ARC
 	select HAVE_IOREMAP_PROT
 	select HAVE_KPROBES
 	select HAVE_KRETPROBES
-	select HAVE_MEMBLOCK
 	select HAVE_MOD_ARCH_SPECIFIC
 	select HAVE_OPROFILE
 	select HAVE_PERF_EVENTS
diff --git a/arch/arm/Kconfig b/arch/arm/Kconfig
index c23576a9a9d8..a92c3d1a4797 100644
--- a/arch/arm/Kconfig
+++ b/arch/arm/Kconfig
@@ -81,7 +81,6 @@ config ARM
 	select HAVE_KERNEL_XZ
 	select HAVE_KPROBES if !XIP_KERNEL && !CPU_ENDIAN_BE32 && !CPU_V7M
 	select HAVE_KRETPROBES if (HAVE_KPROBES)
-	select HAVE_MEMBLOCK
 	select HAVE_MOD_ARCH_SPECIFIC
 	select HAVE_NMI
 	select HAVE_OPROFILE if (HAVE_PERF_EVENTS)
diff --git a/arch/arm64/Kconfig b/arch/arm64/Kconfig
index 073cc7eed904..3c181b231109 100644
--- a/arch/arm64/Kconfig
+++ b/arch/arm64/Kconfig
@@ -139,7 +139,6 @@ config ARM64
 	select HAVE_GENERIC_DMA_COHERENT
 	select HAVE_HW_BREAKPOINT if PERF_EVENTS
 	select HAVE_IRQ_TIME_ACCOUNTING
-	select HAVE_MEMBLOCK
 	select HAVE_MEMBLOCK_NODE_MAP if NUMA
 	select HAVE_NMI
 	select HAVE_PATA_PLATFORM
diff --git a/arch/c6x/Kconfig b/arch/c6x/Kconfig
index ad53996d0bd1..44a4ba3c906c 100644
--- a/arch/c6x/Kconfig
+++ b/arch/c6x/Kconfig
@@ -13,7 +13,6 @@ config C6X
 	select GENERIC_ATOMIC64
 	select GENERIC_IRQ_SHOW
 	select HAVE_ARCH_TRACEHOOK
-	select HAVE_MEMBLOCK
 	select SPARSE_IRQ
 	select IRQ_DOMAIN
 	select OF
* Unmerged path arch/csky/Kconfig
* Unmerged path arch/csky/kernel/setup.c
* Unmerged path arch/csky/mm/highmem.c
* Unmerged path arch/csky/mm/init.c
diff --git a/arch/h8300/Kconfig b/arch/h8300/Kconfig
index eccc8ce8a119..a3ad6723bf27 100644
--- a/arch/h8300/Kconfig
+++ b/arch/h8300/Kconfig
@@ -15,7 +15,6 @@ config H8300
 	select OF
 	select OF_IRQ
 	select OF_EARLY_FLATTREE
-	select HAVE_MEMBLOCK
 	select TIMER_OF
 	select H8300_TMR8
 	select HAVE_KERNEL_GZIP
* Unmerged path arch/hexagon/Kconfig
diff --git a/arch/ia64/Kconfig b/arch/ia64/Kconfig
index d45b2b4bf85b..d6f777303de9 100644
--- a/arch/ia64/Kconfig
+++ b/arch/ia64/Kconfig
@@ -30,7 +30,6 @@ config IA64
 	select HAVE_FUNCTION_TRACER
 	select TTY
 	select HAVE_ARCH_TRACEHOOK
-	select HAVE_MEMBLOCK
 	select HAVE_MEMBLOCK_NODE_MAP
 	select HAVE_VIRT_CPU_ACCOUNTING
 	select ARCH_HAS_DMA_MARK_CLEAN
* Unmerged path arch/m68k/Kconfig
* Unmerged path arch/microblaze/Kconfig
diff --git a/arch/mips/Kconfig b/arch/mips/Kconfig
index 29f3ec40278f..8ef87c03cf44 100644
--- a/arch/mips/Kconfig
+++ b/arch/mips/Kconfig
@@ -58,7 +58,6 @@ config MIPS
 	select HAVE_IRQ_TIME_ACCOUNTING
 	select HAVE_KPROBES
 	select HAVE_KRETPROBES
-	select HAVE_MEMBLOCK
 	select HAVE_MEMBLOCK_NODE_MAP
 	select HAVE_MOD_ARCH_SPECIFIC
 	select HAVE_NMI
diff --git a/arch/nds32/Kconfig b/arch/nds32/Kconfig
index 222265db21bc..77c72af91711 100644
--- a/arch/nds32/Kconfig
+++ b/arch/nds32/Kconfig
@@ -29,7 +29,6 @@ config NDS32
 	select HANDLE_DOMAIN_IRQ
 	select HAVE_ARCH_TRACEHOOK
 	select HAVE_DEBUG_KMEMLEAK
-	select HAVE_MEMBLOCK
 	select HAVE_REGS_AND_STACK_ACCESS_API
 	select IRQ_DOMAIN
 	select LOCKDEP_SUPPORT
* Unmerged path arch/nios2/Kconfig
diff --git a/arch/openrisc/Kconfig b/arch/openrisc/Kconfig
index 7eeff90f2a0d..3b90b6ba29ed 100644
--- a/arch/openrisc/Kconfig
+++ b/arch/openrisc/Kconfig
@@ -10,7 +10,6 @@ config OPENRISC
 	select OF_EARLY_FLATTREE
 	select IRQ_DOMAIN
 	select HANDLE_DOMAIN_IRQ
-	select HAVE_MEMBLOCK
 	select GPIOLIB
         select HAVE_ARCH_TRACEHOOK
 	select SPARSE_IRQ
* Unmerged path arch/parisc/Kconfig
diff --git a/arch/powerpc/Kconfig b/arch/powerpc/Kconfig
index e53a4f79ab92..7d51b805aa52 100644
--- a/arch/powerpc/Kconfig
+++ b/arch/powerpc/Kconfig
@@ -199,7 +199,6 @@ config PPC
 	select HAVE_KRETPROBES
 	select HAVE_LD_DEAD_CODE_DATA_ELIMINATION
 	select HAVE_LIVEPATCH			if HAVE_DYNAMIC_FTRACE_WITH_REGS
-	select HAVE_MEMBLOCK
 	select HAVE_MEMBLOCK_NODE_MAP
 	select HAVE_MOD_ARCH_SPECIFIC
 	select HAVE_NMI				if PERF_EVENTS || (PPC64 && PPC_BOOK3S)
diff --git a/arch/riscv/Kconfig b/arch/riscv/Kconfig
index b87622866158..4e866ed7e2cb 100644
--- a/arch/riscv/Kconfig
+++ b/arch/riscv/Kconfig
@@ -28,7 +28,6 @@ config RISCV
 	select GENERIC_STRNLEN_USER
 	select GENERIC_SMP_IDLE_THREAD
 	select GENERIC_ATOMIC64 if !64BIT || !RISCV_ISA_A
-	select HAVE_MEMBLOCK
 	select HAVE_MEMBLOCK_NODE_MAP
 	select HAVE_DMA_CONTIGUOUS
 	select HAVE_GENERIC_DMA_COHERENT
diff --git a/arch/s390/Kconfig b/arch/s390/Kconfig
index 03371828326b..93827b0c8f80 100644
--- a/arch/s390/Kconfig
+++ b/arch/s390/Kconfig
@@ -157,7 +157,6 @@ config S390
 	select HAVE_LIVEPATCH
 	select HAVE_PERF_REGS
 	select HAVE_PERF_USER_STACK_DUMP
-	select HAVE_MEMBLOCK
 	select HAVE_MEMBLOCK_NODE_MAP
 	select HAVE_MEMBLOCK_PHYS_MAP
 	select HAVE_MOD_ARCH_SPECIFIC
diff --git a/arch/sh/Kconfig b/arch/sh/Kconfig
index b58249fed0f7..2c12980576ef 100644
--- a/arch/sh/Kconfig
+++ b/arch/sh/Kconfig
@@ -8,7 +8,6 @@ config SUPERH
 	select HAVE_PATA_PLATFORM
 	select CLKDEV_LOOKUP
 	select HAVE_IDE if HAS_IOPORT_MAP
-	select HAVE_MEMBLOCK
 	select HAVE_MEMBLOCK_NODE_MAP
 	select NO_BOOTMEM
 	select ARCH_DISCARD_MEMBLOCK
* Unmerged path arch/um/Kconfig.um
* Unmerged path arch/unicore32/Kconfig
diff --git a/arch/x86/Kconfig b/arch/x86/Kconfig
index 70c5effebd49..2a627b4507e2 100644
--- a/arch/x86/Kconfig
+++ b/arch/x86/Kconfig
@@ -167,7 +167,6 @@ config X86
 	select HAVE_KRETPROBES
 	select HAVE_KVM
 	select HAVE_LIVEPATCH			if X86_64
-	select HAVE_MEMBLOCK
 	select HAVE_MEMBLOCK_NODE_MAP
 	select HAVE_MIXED_BREAKPOINTS_REGS
 	select HAVE_MOD_ARCH_SPECIFIC
diff --git a/arch/xtensa/Kconfig b/arch/xtensa/Kconfig
index bc963501b763..75ef371461ea 100644
--- a/arch/xtensa/Kconfig
+++ b/arch/xtensa/Kconfig
@@ -24,7 +24,6 @@ config XTENSA
 	select HAVE_FUTEX_CMPXCHG if !MMU
 	select HAVE_HW_BREAKPOINT if PERF_EVENTS
 	select HAVE_IRQ_TIME_ACCOUNTING
-	select HAVE_MEMBLOCK
 	select HAVE_OPROFILE
 	select HAVE_PERF_EVENTS
 	select HAVE_STACKPROTECTOR
diff --git a/drivers/of/fdt.c b/drivers/of/fdt.c
index 6da20b9688f7..0a36d1d174ee 100644
--- a/drivers/of/fdt.c
+++ b/drivers/of/fdt.c
@@ -1122,7 +1122,6 @@ int __init early_init_dt_scan_chosen(unsigned long node, const char *uname,
 	return 1;
 }
 
-#ifdef CONFIG_HAVE_MEMBLOCK
 #ifndef MIN_MEMBLOCK_ADDR
 #define MIN_MEMBLOCK_ADDR	__pa(PAGE_OFFSET)
 #endif
@@ -1184,26 +1183,6 @@ int __init __weak early_init_dt_reserve_memory_arch(phys_addr_t base,
 	return memblock_reserve(base, size);
 }
 
-#else
-void __init __weak early_init_dt_add_memory_arch(u64 base, u64 size)
-{
-	WARN_ON(1);
-}
-
-int __init __weak early_init_dt_mark_hotplug_memory_arch(u64 base, u64 size)
-{
-	return -ENOSYS;
-}
-
-int __init __weak early_init_dt_reserve_memory_arch(phys_addr_t base,
-					phys_addr_t size, bool nomap)
-{
-	pr_err("Reserved memory not supported, ignoring range %pa - %pa%s\n",
-		  &base, &size, nomap ? " (nomap)" : "");
-	return -ENOSYS;
-}
-#endif
-
 static void * __init early_init_dt_alloc_memory_arch(u64 size, u64 align)
 {
 	return memblock_virt_alloc(size, align);
diff --git a/drivers/of/of_reserved_mem.c b/drivers/of/of_reserved_mem.c
index 895c83e0c7b6..d6255c276a41 100644
--- a/drivers/of/of_reserved_mem.c
+++ b/drivers/of/of_reserved_mem.c
@@ -20,13 +20,12 @@
 #include <linux/of_reserved_mem.h>
 #include <linux/sort.h>
 #include <linux/slab.h>
+#include <linux/memblock.h>
 
 #define MAX_RESERVED_REGIONS	32
 static struct reserved_mem reserved_mem[MAX_RESERVED_REGIONS];
 static int reserved_mem_count;
 
-#if defined(CONFIG_HAVE_MEMBLOCK)
-#include <linux/memblock.h>
 int __init __weak early_init_dt_alloc_reserved_memory_arch(phys_addr_t size,
 	phys_addr_t align, phys_addr_t start, phys_addr_t end, bool nomap,
 	phys_addr_t *res_base)
@@ -54,16 +53,6 @@ int __init __weak early_init_dt_alloc_reserved_memory_arch(phys_addr_t size,
 		return memblock_remove(base, size);
 	return 0;
 }
-#else
-int __init __weak early_init_dt_alloc_reserved_memory_arch(phys_addr_t size,
-	phys_addr_t align, phys_addr_t start, phys_addr_t end, bool nomap,
-	phys_addr_t *res_base)
-{
-	pr_err("Reserved memory not supported, ignoring region 0x%llx%s\n",
-		  size, nomap ? " (nomap)" : "");
-	return -ENOSYS;
-}
-#endif
 
 /**
  * res_mem_save_node() - save fdt node for second pass initialization
diff --git a/drivers/staging/android/ion/Kconfig b/drivers/staging/android/ion/Kconfig
index c16dd16afe6a..0fdda6f62953 100644
--- a/drivers/staging/android/ion/Kconfig
+++ b/drivers/staging/android/ion/Kconfig
@@ -1,6 +1,6 @@
 menuconfig ION
 	bool "Ion Memory Manager"
-	depends on HAVE_MEMBLOCK && HAS_DMA && MMU
+	depends on HAS_DMA && MMU
 	select GENERIC_ALLOCATOR
 	select DMA_SHARED_BUFFER
 	help
diff --git a/fs/pstore/Kconfig b/fs/pstore/Kconfig
index 09c19ef91526..1f878395d2db 100644
--- a/fs/pstore/Kconfig
+++ b/fs/pstore/Kconfig
@@ -130,7 +130,6 @@ config PSTORE_RAM
 	tristate "Log panic/oops to a RAM buffer"
 	depends on PSTORE
 	depends on HAS_IOMEM
-	depends on HAVE_MEMBLOCK
 	select REED_SOLOMON
 	select REED_SOLOMON_ENC8
 	select REED_SOLOMON_DEC8
* Unmerged path include/linux/bootmem.h
diff --git a/include/linux/memblock.h b/include/linux/memblock.h
index f5dd780ddfc5..258709d95f29 100644
--- a/include/linux/memblock.h
+++ b/include/linux/memblock.h
@@ -2,7 +2,6 @@
 #define _LINUX_MEMBLOCK_H
 #ifdef __KERNEL__
 
-#ifdef CONFIG_HAVE_MEMBLOCK
 /*
  * Logical memory blocks.
  *
@@ -441,12 +440,6 @@ static inline void early_memtest(phys_addr_t start, phys_addr_t end)
 {
 }
 #endif
-#else
-static inline phys_addr_t memblock_alloc(phys_addr_t size, phys_addr_t align)
-{
-	return 0;
-}
-#endif /* CONFIG_HAVE_MEMBLOCK */
 
 #endif /* __KERNEL__ */
 
diff --git a/include/linux/mm.h b/include/linux/mm.h
index 7814b1c09166..df0a9449f94a 100644
--- a/include/linux/mm.h
+++ b/include/linux/mm.h
@@ -2154,7 +2154,7 @@ extern int __meminit __early_pfn_to_nid(unsigned long pfn,
 					struct mminit_pfnnid_cache *state);
 #endif
 
-#if defined(CONFIG_HAVE_MEMBLOCK) && !defined(CONFIG_FLAT_NODE_MEM_MAP)
+#if !defined(CONFIG_FLAT_NODE_MEM_MAP)
 void zero_resv_unavail(void);
 #else
 static inline void zero_resv_unavail(void) {}
diff --git a/lib/Kconfig.debug b/lib/Kconfig.debug
index bdfb152416e9..d60d4c6e1056 100644
--- a/lib/Kconfig.debug
+++ b/lib/Kconfig.debug
@@ -1324,7 +1324,7 @@ config DEBUG_KOBJECT
 	depends on DEBUG_KERNEL
 	help
 	  If you say Y here, some extra kobject debugging messages will be sent
-	  to the syslog. 
+	  to the syslog.
 
 config DEBUG_KOBJECT_RELEASE
 	bool "kobject release debugging"
@@ -2040,7 +2040,6 @@ endif # RUNTIME_TESTING_MENU
 
 config MEMTEST
 	bool "Memtest"
-	depends on HAVE_MEMBLOCK
 	---help---
 	  This option adds a kernel parameter 'memtest', which allows memtest
 	  to be set.
diff --git a/mm/Kconfig b/mm/Kconfig
index 12645fb714e8..5dc8d906f8a7 100644
--- a/mm/Kconfig
+++ b/mm/Kconfig
@@ -124,9 +124,6 @@ config SPARSEMEM_VMEMMAP
 	 pfn_to_page and page_to_pfn operations.  This is the most
 	 efficient option when sufficient kernel resources are available.
 
-config HAVE_MEMBLOCK
-	bool
-
 config HAVE_MEMBLOCK_NODE_MAP
 	bool
 
@@ -478,7 +475,7 @@ config FRONTSWAP
 
 config CMA
 	bool "Contiguous Memory Allocator"
-	depends on HAVE_MEMBLOCK && MMU
+	depends on MMU
 	select MIGRATION
 	select MEMORY_ISOLATION
 	help
* Unmerged path mm/Makefile
diff --git a/mm/nobootmem.c b/mm/nobootmem.c
index 439af3b765a7..d4d0cd474087 100644
--- a/mm/nobootmem.c
+++ b/mm/nobootmem.c
@@ -23,10 +23,6 @@
 
 #include "internal.h"
 
-#ifndef CONFIG_HAVE_MEMBLOCK
-#error CONFIG_HAVE_MEMBLOCK not defined
-#endif
-
 #ifndef CONFIG_NEED_MULTIPLE_NODES
 struct pglist_data __refdata contig_page_data;
 EXPORT_SYMBOL(contig_page_data);
diff --git a/mm/page_alloc.c b/mm/page_alloc.c
index 9fb621db90ec..7f38e5a98303 100644
--- a/mm/page_alloc.c
+++ b/mm/page_alloc.c
@@ -6495,8 +6495,7 @@ void __paginginit free_area_init_node(int nid, unsigned long *zones_size,
 	free_area_init_core(pgdat);
 }
 
-#if defined(CONFIG_HAVE_MEMBLOCK) && !defined(CONFIG_FLAT_NODE_MEM_MAP)
-
+#if !defined(CONFIG_FLAT_NODE_MEM_MAP)
 /*
  * Zero all valid struct pages in range [spfn, epfn), return number of struct
  * pages zeroed
@@ -6556,7 +6555,7 @@ void __paginginit zero_resv_unavail(void)
 	if (pgcnt)
 		pr_info("Zeroed struct page in unavailable ranges: %lld pages", pgcnt);
 }
-#endif /* CONFIG_HAVE_MEMBLOCK && !CONFIG_FLAT_NODE_MEM_MAP */
+#endif /* !CONFIG_FLAT_NODE_MEM_MAP */
 
 #ifdef CONFIG_HAVE_MEMBLOCK_NODE_MAP
 
