KVM: x86: Check for Intel PT MSR virtualization using KVM cpu caps

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-240.el8
commit-author Sean Christopherson <sean.j.christopherson@intel.com>
commit 7b874c26a62487acaf2e7e179715991c70db25db
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-240.el8/7b874c26.failed

Use kvm_cpu_cap_has() to check for Intel PT when processing the list of
virtualized MSRs to pave the way toward removing ->pt_supported().

No functional change intended.

	Reviewed-by: Vitaly Kuznetsov <vkuznets@redhat.com>
	Signed-off-by: Sean Christopherson <sean.j.christopherson@intel.com>
	Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>
(cherry picked from commit 7b874c26a62487acaf2e7e179715991c70db25db)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/x86/kvm/x86.c
diff --cc arch/x86/kvm/x86.c
index 4ad9e50bf3f6,f3fac68f0612..000000000000
--- a/arch/x86/kvm/x86.c
+++ b/arch/x86/kvm/x86.c
@@@ -5181,8 -5236,8 +5181,13 @@@ static void kvm_init_msr_list(void
  				continue;
  			break;
  		case MSR_IA32_RTIT_ADDR0_A ... MSR_IA32_RTIT_ADDR3_B: {
++<<<<<<< HEAD
 +			if (!kvm_x86_ops->pt_supported() ||
 +				msrs_to_save[i] - MSR_IA32_RTIT_ADDR0_A >=
++=======
+ 			if (!kvm_cpu_cap_has(X86_FEATURE_INTEL_PT) ||
+ 				msrs_to_save_all[i] - MSR_IA32_RTIT_ADDR0_A >=
++>>>>>>> 7b874c26a624 (KVM: x86: Check for Intel PT MSR virtualization using KVM cpu caps)
  				intel_pt_validate_hw_cap(PT_CAP_num_address_ranges) * 2)
  				continue;
  			break;
* Unmerged path arch/x86/kvm/x86.c
