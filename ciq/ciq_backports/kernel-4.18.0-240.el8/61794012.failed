net/ipv6: need update peer route when modify metric

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-240.el8
Rebuild_CHGLOG: - [net] ipv6: need update peer route when modify metric (Hangbin Liu) [1816506]
Rebuild_FUZZ: 95.92%
commit-author Hangbin Liu <liuhangbin@gmail.com>
commit 617940123e0140521f3080d2befc2bf55bcda094
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-240.el8/61794012.failed

When we modify the route metric, the peer address's route need also
be updated. Before the fix:

+ ip addr add dev dummy1 2001:db8::1 peer 2001:db8::2 metric 60
+ ip -6 route show dev dummy1
2001:db8::1 proto kernel metric 60 pref medium
2001:db8::2 proto kernel metric 60 pref medium
+ ip addr change dev dummy1 2001:db8::1 peer 2001:db8::2 metric 61
+ ip -6 route show dev dummy1
2001:db8::1 proto kernel metric 61 pref medium
2001:db8::2 proto kernel metric 60 pref medium

After the fix:
+ ip addr change dev dummy1 2001:db8::1 peer 2001:db8::2 metric 61
+ ip -6 route show dev dummy1
2001:db8::1 proto kernel metric 61 pref medium
2001:db8::2 proto kernel metric 61 pref medium

Fixes: 8308f3ff1753 ("net/ipv6: Add support for specifying metric of connected routes")
	Signed-off-by: Hangbin Liu <liuhangbin@gmail.com>
	Reviewed-by: David Ahern <dsahern@gmail.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 617940123e0140521f3080d2befc2bf55bcda094)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/ipv6/addrconf.c
diff --cc net/ipv6/addrconf.c
index 523e44cb0c62,4fb72028ca45..000000000000
--- a/net/ipv6/addrconf.c
+++ b/net/ipv6/addrconf.c
@@@ -4593,10 -4592,9 +4594,16 @@@ static int modify_prefix_route(struct i
  	struct fib6_info *f6i;
  	u32 prio;
  
++<<<<<<< HEAD
 +	f6i = addrconf_get_prefix_route(&ifp->addr,
 +					ifp->prefix_len,
 +					ifp->idev->dev,
 +					0, RTF_GATEWAY | RTF_DEFAULT);
++=======
+ 	f6i = addrconf_get_prefix_route(modify_peer ? &ifp->peer_addr : &ifp->addr,
+ 					ifp->prefix_len,
+ 					ifp->idev->dev, 0, RTF_DEFAULT, true);
++>>>>>>> 617940123e01 (net/ipv6: need update peer route when modify metric)
  	if (!f6i)
  		return -ENOENT;
  
* Unmerged path net/ipv6/addrconf.c
