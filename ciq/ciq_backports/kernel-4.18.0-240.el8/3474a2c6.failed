netfilter: nf_tables_offload: move indirect flow_block callback logic to core

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-240.el8
commit-author Pablo Neira Ayuso <pablo@netfilter.org>
commit 3474a2c62ff9694ee627bdb51cf9a60021d9e814
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-240.el8/3474a2c6.failed

Add nft_offload_init() and nft_offload_exit() function to deal with the
init and the exit path of the offload infrastructure.

Rename nft_indr_block_get_and_ing_cmd() to nft_indr_block_cb().

	Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
(cherry picked from commit 3474a2c62ff9694ee627bdb51cf9a60021d9e814)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	include/net/netfilter/nf_tables_offload.h
#	net/netfilter/nf_tables_api.c
#	net/netfilter/nf_tables_offload.c
diff --cc net/netfilter/nf_tables_api.c
index b6b54e6a024b,efd0c97cc2a3..000000000000
--- a/net/netfilter/nf_tables_api.c
+++ b/net/netfilter/nf_tables_api.c
@@@ -7615,17 -7697,18 +7615,23 @@@ static int __init nf_tables_module_init
  	/* must be last */
  	err = nfnetlink_subsys_register(&nf_tables_subsys);
  	if (err < 0)
 -		goto err5;
 +		goto err6;
  
++<<<<<<< HEAD
++=======
+ 	nft_chain_route_init();
+ 	nft_offload_init();
+ 
++>>>>>>> 3474a2c62ff9 (netfilter: nf_tables_offload: move indirect flow_block callback logic to core)
  	return err;
 -err5:
 +err6:
  	rhltable_destroy(&nft_objname_ht);
 -err4:
 +err5:
  	unregister_netdevice_notifier(&nf_tables_flowtable_notifier);
 -err3:
 +err4:
  	nf_tables_core_module_exit();
 +err3:
 +	kfree(info);
  err2:
  	nft_chain_filter_fini();
  err1:
@@@ -7635,6 -7718,7 +7641,10 @@@
  
  static void __exit nf_tables_module_exit(void)
  {
++<<<<<<< HEAD
++=======
+ 	nft_offload_exit();
++>>>>>>> 3474a2c62ff9 (netfilter: nf_tables_offload: move indirect flow_block callback logic to core)
  	nfnetlink_subsys_unregister(&nf_tables_subsys);
  	unregister_netdevice_notifier(&nf_tables_flowtable_notifier);
  	nft_chain_filter_fini();
* Unmerged path include/net/netfilter/nf_tables_offload.h
* Unmerged path net/netfilter/nf_tables_offload.c
* Unmerged path include/net/netfilter/nf_tables_offload.h
* Unmerged path net/netfilter/nf_tables_api.c
* Unmerged path net/netfilter/nf_tables_offload.c
