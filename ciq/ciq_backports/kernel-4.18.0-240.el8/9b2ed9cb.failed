mm: remove CONFIG_MIGRATE_VMA_HELPER

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-240.el8
commit-author Christoph Hellwig <hch@lst.de>
commit 9b2ed9cb975c63f5534daaebeb225ab52b589372
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-240.el8/9b2ed9cb.failed

CONFIG_MIGRATE_VMA_HELPER guards helpers that are required for proper
devic private memory support.  Remove the option and just check for
CONFIG_DEVICE_PRIVATE instead.

Link: https://lore.kernel.org/r/20190814075928.23766-11-hch@lst.de
	Signed-off-by: Christoph Hellwig <hch@lst.de>
	Reviewed-by: Jason Gunthorpe <jgg@mellanox.com>
	Tested-by: Ralph Campbell <rcampbell@nvidia.com>
	Signed-off-by: Jason Gunthorpe <jgg@mellanox.com>
(cherry picked from commit 9b2ed9cb975c63f5534daaebeb225ab52b589372)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/gpu/drm/nouveau/Kconfig
#	mm/Kconfig
diff --cc drivers/gpu/drm/nouveau/Kconfig
index 33ccf11bd70d,3558df043592..000000000000
--- a/drivers/gpu/drm/nouveau/Kconfig
+++ b/drivers/gpu/drm/nouveau/Kconfig
@@@ -87,9 -86,10 +87,14 @@@ config DRM_NOUVEAU_SV
  	bool "(EXPERIMENTAL) Enable SVM (Shared Virtual Memory) support"
  	depends on DEVICE_PRIVATE
  	depends on DRM_NOUVEAU
 -	depends on MMU
 +	depends on HMM_MIRROR
  	depends on STAGING
++<<<<<<< HEAD
 +	select MIGRATE_VMA_HELPER
++=======
+ 	select HMM_MIRROR
+ 	select MMU_NOTIFIER
++>>>>>>> 9b2ed9cb975c (mm: remove CONFIG_MIGRATE_VMA_HELPER)
  	default n
  	help
  	  Say Y here if you want to enable experimental support for
diff --cc mm/Kconfig
index f5cd8d5575a1,2fe4902ad755..000000000000
--- a/mm/Kconfig
+++ b/mm/Kconfig
@@@ -679,19 -669,6 +679,22 @@@ config ZONE_DEVIC
  
  	  If FS_DAX is enabled, then say Y.
  
++<<<<<<< HEAD
 +config ARCH_HAS_HMM
 +	bool
 +	default y
 +	depends on (X86_64 || PPC64)
 +	depends on ZONE_DEVICE
 +	depends on MMU && 64BIT
 +	depends on MEMORY_HOTPLUG
 +	depends on MEMORY_HOTREMOVE
 +	depends on SPARSEMEM_VMEMMAP
 +
 +config MIGRATE_VMA_HELPER
 +	bool
 +
++=======
++>>>>>>> 9b2ed9cb975c (mm: remove CONFIG_MIGRATE_VMA_HELPER)
  config DEV_PAGEMAP_OPS
  	bool
  
* Unmerged path drivers/gpu/drm/nouveau/Kconfig
* Unmerged path mm/Kconfig
diff --git a/mm/migrate.c b/mm/migrate.c
index 88c7080dca57..0cb87afc0b27 100644
--- a/mm/migrate.c
+++ b/mm/migrate.c
@@ -2122,7 +2122,7 @@ int migrate_misplaced_transhuge_page(struct mm_struct *mm,
 
 #endif /* CONFIG_NUMA */
 
-#if defined(CONFIG_MIGRATE_VMA_HELPER)
+#ifdef CONFIG_DEVICE_PRIVATE
 static int migrate_vma_collect_hole(unsigned long start,
 				    unsigned long end,
 				    struct mm_walk *walk)
@@ -2946,4 +2946,4 @@ void migrate_vma_finalize(struct migrate_vma *migrate)
 	}
 }
 EXPORT_SYMBOL(migrate_vma_finalize);
-#endif /* defined(MIGRATE_VMA_HELPER) */
+#endif /* CONFIG_DEVICE_PRIVATE */
