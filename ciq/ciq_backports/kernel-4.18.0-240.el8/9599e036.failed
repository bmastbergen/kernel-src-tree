bnxt_en: Add support for devlink info command

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-240.el8
commit-author Vasundhara Volam <vasundhara-v.volam@broadcom.com>
commit 9599e036b161243d7c62399a1b6c250573e08a43
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-240.el8/9599e036.failed

Display the following information via devlink info command:
  - Driver name
  - Board id
  - Broad revision
  - Board Serial number
  - Board FW version
  - FW parameter set version
  - FW App version
  - FW management version
  - FW RoCE version

  Standard output example:
  $ devlink dev info pci/0000:3b:00.0
  pci/0000:3b:00.0:
  driver bnxt_en
  serial_number 00-10-18-FF-FE-AD-05-00
  versions:
      fixed:
        asic.id D802
        asic.rev 1
      running:
        fw 216.1.124.0
        fw.psid 0.0.0
        fw.app 216.1.122.0
        fw.mgmt 864.0.32.0
        fw.roce 216.1.15.0

[ This version has incorporated changes suggested by Jakub Kicinski to
  use generic devlink version tags. ]

v2: Use fw.psid

	Cc: Jiri Pirko <jiri@mellanox.com>
	Cc: Jakub Kicinski <kuba@kernel.org>
	Signed-off-by: Vasundhara Volam <vasundhara-v.volam@broadcom.com>
	Signed-off-by: Michael Chan <michael.chan@broadcom.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 9599e036b161243d7c62399a1b6c250573e08a43)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/broadcom/bnxt/bnxt_devlink.c
diff --cc drivers/net/ethernet/broadcom/bnxt/bnxt_devlink.c
index e6f4d6626b4c,eec0168330b7..000000000000
--- a/drivers/net/ethernet/broadcom/bnxt/bnxt_devlink.c
+++ b/drivers/net/ethernet/broadcom/bnxt/bnxt_devlink.c
@@@ -250,6 -254,39 +250,42 @@@ void bnxt_devlink_health_report(struct 
  	}
  }
  
++<<<<<<< HEAD
++=======
+ void bnxt_dl_health_status_update(struct bnxt *bp, bool healthy)
+ {
+ 	struct bnxt_fw_health *health = bp->fw_health;
+ 	u8 state;
+ 
+ 	if (healthy)
+ 		state = DEVLINK_HEALTH_REPORTER_STATE_HEALTHY;
+ 	else
+ 		state = DEVLINK_HEALTH_REPORTER_STATE_ERROR;
+ 
+ 	if (health->fatal)
+ 		devlink_health_reporter_state_update(health->fw_fatal_reporter,
+ 						     state);
+ 	else
+ 		devlink_health_reporter_state_update(health->fw_reset_reporter,
+ 						     state);
+ 
+ 	health->fatal = false;
+ }
+ 
+ void bnxt_dl_health_recovery_done(struct bnxt *bp)
+ {
+ 	struct bnxt_fw_health *hlth = bp->fw_health;
+ 
+ 	if (hlth->fatal)
+ 		devlink_health_reporter_recovery_done(hlth->fw_fatal_reporter);
+ 	else
+ 		devlink_health_reporter_recovery_done(hlth->fw_reset_reporter);
+ }
+ 
+ static int bnxt_dl_info_get(struct devlink *dl, struct devlink_info_req *req,
+ 			    struct netlink_ext_ack *extack);
+ 
++>>>>>>> 9599e036b161 (bnxt_en: Add support for devlink info command)
  static const struct devlink_ops bnxt_dl_ops = {
  #ifdef CONFIG_BNXT_SRIOV
  	.eswitch_mode_set = bnxt_dl_eswitch_mode_set,
* Unmerged path drivers/net/ethernet/broadcom/bnxt/bnxt_devlink.c
diff --git a/drivers/net/ethernet/broadcom/bnxt/bnxt_devlink.h b/drivers/net/ethernet/broadcom/bnxt/bnxt_devlink.h
index 689c47ab2155..121028263693 100644
--- a/drivers/net/ethernet/broadcom/bnxt/bnxt_devlink.h
+++ b/drivers/net/ethernet/broadcom/bnxt/bnxt_devlink.h
@@ -38,6 +38,10 @@ static inline void bnxt_link_bp_to_dl(struct bnxt *bp, struct devlink *dl)
 #define NVM_OFF_IGNORE_ARI		164
 #define NVM_OFF_DIS_GRE_VER_CHECK	171
 #define NVM_OFF_ENABLE_SRIOV		401
+#define NVM_OFF_NVM_CFG_VER		602
+
+#define BNXT_NVM_CFG_VER_BITS		24
+#define BNXT_NVM_CFG_VER_BYTES		4
 
 #define BNXT_MSIX_VEC_MAX	1280
 #define BNXT_MSIX_VEC_MIN_MAX	128
