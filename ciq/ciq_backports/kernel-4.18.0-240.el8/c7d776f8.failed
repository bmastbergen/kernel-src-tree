null_blk: Fix REQ_OP_ZONE_CLOSE handling

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-240.el8
commit-author Damien Le Moal <damien.lemoal@wdc.com>
commit c7d776f85dfe5159ebf621ee1e50e555237b1a25
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-240.el8/c7d776f8.failed

In order to match ZBC defined behavior, closing an empty zone must
result in the "empty" zone condition instead of the "closed" condition.

Fixes: da644b2cc1a4 ("null_blk: add zone open, close, and finish support")
	Signed-off-by: Damien Le Moal <damien.lemoal@wdc.com>
	Signed-off-by: Jens Axboe <axboe@kernel.dk>
(cherry picked from commit c7d776f85dfe5159ebf621ee1e50e555237b1a25)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/block/null_blk_zoned.c
diff --cc drivers/block/null_blk_zoned.c
index 176ae5c83b71,5cf49d9db95e..000000000000
--- a/drivers/block/null_blk_zoned.c
+++ b/drivers/block/null_blk_zoned.c
@@@ -146,6 -172,32 +146,35 @@@ void null_zone_reset(struct nullb_cmd *
  		zone->cond = BLK_ZONE_COND_EMPTY;
  		zone->wp = zone->start;
  		break;
++<<<<<<< HEAD
++=======
+ 	case REQ_OP_ZONE_OPEN:
+ 		if (zone->type == BLK_ZONE_TYPE_CONVENTIONAL)
+ 			return BLK_STS_IOERR;
+ 		if (zone->cond == BLK_ZONE_COND_FULL)
+ 			return BLK_STS_IOERR;
+ 
+ 		zone->cond = BLK_ZONE_COND_EXP_OPEN;
+ 		break;
+ 	case REQ_OP_ZONE_CLOSE:
+ 		if (zone->type == BLK_ZONE_TYPE_CONVENTIONAL)
+ 			return BLK_STS_IOERR;
+ 		if (zone->cond == BLK_ZONE_COND_FULL)
+ 			return BLK_STS_IOERR;
+ 
+ 		if (zone->wp == zone->start)
+ 			zone->cond = BLK_ZONE_COND_EMPTY;
+ 		else
+ 			zone->cond = BLK_ZONE_COND_CLOSED;
+ 		break;
+ 	case REQ_OP_ZONE_FINISH:
+ 		if (zone->type == BLK_ZONE_TYPE_CONVENTIONAL)
+ 			return BLK_STS_IOERR;
+ 
+ 		zone->cond = BLK_ZONE_COND_FULL;
+ 		zone->wp = zone->start + zone->len;
+ 		break;
++>>>>>>> c7d776f85dfe (null_blk: Fix REQ_OP_ZONE_CLOSE handling)
  	default:
  		return BLK_STS_NOTSUPP;
  	}
* Unmerged path drivers/block/null_blk_zoned.c
