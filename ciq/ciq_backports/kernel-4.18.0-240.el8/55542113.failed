perf tools: Propagate CFLAGS to libperf

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-240.el8
commit-author Jiri Olsa <jolsa@kernel.org>
commit 55542113c690a567e728e40d4181d7d037fc21b0
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-240.el8/55542113.failed

Andi reported that 'make DEBUG=1' does not propagate to the libbperf
code. It's true also for the other flags. Changing the code to propagate
the global build flags to libperf compilation.

	Reported-by: Andi Kleen <ak@linux.intel.com>
	Signed-off-by: Jiri Olsa <jolsa@kernel.org>
	Cc: Alexander Shishkin <alexander.shishkin@linux.intel.com>
	Cc: Michael Petlan <mpetlan@redhat.com>
	Cc: Namhyung Kim <namhyung@kernel.org>
	Cc: Peter Zijlstra <peterz@infradead.org>
Link: http://lore.kernel.org/lkml/20191011122155.15738-1-jolsa@kernel.org
	Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>
(cherry picked from commit 55542113c690a567e728e40d4181d7d037fc21b0)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	tools/perf/Makefile.config
#	tools/perf/lib/core.c
diff --cc tools/perf/Makefile.config
index 39c2d941d769,063202c53b64..000000000000
--- a/tools/perf/Makefile.config
+++ b/tools/perf/Makefile.config
@@@ -240,12 -245,12 +240,21 @@@ FEATURE_CHECK_LDFLAGS-libaio = -lr
  
  FEATURE_CHECK_LDFLAGS-disassembler-four-args = -lbfd -lopcodes -ldl
  
++<<<<<<< HEAD
 +CFLAGS += -fno-omit-frame-pointer
 +CFLAGS += -g
 +CFLAGS += -funwind-tables
 +CFLAGS += -Wall
 +CFLAGS += -Wextra
 +CFLAGS += -std=gnu99
++=======
+ CORE_CFLAGS += -fno-omit-frame-pointer
+ CORE_CFLAGS += -ggdb3
+ CORE_CFLAGS += -funwind-tables
+ CORE_CFLAGS += -Wall
+ CORE_CFLAGS += -Wextra
+ CORE_CFLAGS += -std=gnu99
++>>>>>>> 55542113c690 (perf tools: Propagate CFLAGS to libperf)
  
  CXXFLAGS += -std=gnu++11 -fno-exceptions -fno-rtti
  CXXFLAGS += -Wall
diff --cc tools/perf/lib/core.c
index 29d5e3348718,58fc894b76c5..000000000000
--- a/tools/perf/lib/core.c
+++ b/tools/perf/lib/core.c
@@@ -4,10 -4,13 +4,15 @@@
  
  #include <stdio.h>
  #include <stdarg.h>
++<<<<<<< HEAD
++=======
+ #include <unistd.h>
+ #include <linux/compiler.h>
++>>>>>>> 55542113c690 (perf tools: Propagate CFLAGS to libperf)
  #include <perf/core.h>
 -#include <internal/lib.h>
  #include "internal.h"
  
- static int __base_pr(enum libperf_print_level level, const char *format,
+ static int __base_pr(enum libperf_print_level level __maybe_unused, const char *format,
  		     va_list args)
  {
  	return vfprintf(stderr, format, args);
* Unmerged path tools/perf/Makefile.config
diff --git a/tools/perf/Makefile.perf b/tools/perf/Makefile.perf
index d48b66c8266f..44f2b630e592 100644
--- a/tools/perf/Makefile.perf
+++ b/tools/perf/Makefile.perf
@@ -765,7 +765,7 @@ $(LIBBPF)-clean:
 	$(Q)$(MAKE) -C $(BPF_DIR) O=$(OUTPUT) clean >/dev/null
 
 $(LIBPERF): FORCE
-	$(Q)$(MAKE) -C $(LIBPERF_DIR) O=$(OUTPUT) $(OUTPUT)libperf.a
+	$(Q)$(MAKE) -C $(LIBPERF_DIR) EXTRA_CFLAGS="$(LIBPERF_CFLAGS)" O=$(OUTPUT) $(OUTPUT)libperf.a
 
 $(LIBPERF)-clean:
 	$(call QUIET_CLEAN, libperf)
* Unmerged path tools/perf/lib/core.c
