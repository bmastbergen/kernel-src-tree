tipc: allow to build NACK message in link timeout function

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-240.el8
commit-author Tung Nguyen <tung.q.nguyen@dektech.com.au>
commit 6ef9dcb78046b346b5508ca1659848b136a343c2
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-240.el8/6ef9dcb7.failed

Commit 02288248b051 ("tipc: eliminate gap indicator from ACK messages")
eliminated sending of the 'gap' indicator in regular ACK messages and
only allowed to build NACK message with enabled probe/probe_reply.
However, necessary correction for building NACK message was missed
in tipc_link_timeout() function. This leads to significant delay and
link reset (due to retransmission failure) in lossy environment.

This commit fixes it by setting the 'probe' flag to 'true' when
the receive deferred queue is not empty. As a result, NACK message
will be built to send back to another peer.

Fixes: 02288248b051 ("tipc: eliminate gap indicator from ACK messages")
	Acked-by: Jon Maloy <jmaloy@redhat.com>
	Signed-off-by: Tung Nguyen <tung.q.nguyen@dektech.com.au>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 6ef9dcb78046b346b5508ca1659848b136a343c2)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/tipc/link.c
diff --cc net/tipc/link.c
index 91be69d1779e,d40f8e5b7683..000000000000
--- a/net/tipc/link.c
+++ b/net/tipc/link.c
@@@ -794,6 -831,12 +793,15 @@@ int tipc_link_timeout(struct tipc_link 
  		probe |= l->silent_intv_cnt;
  		if (probe || mstate->monitoring)
  			l->silent_intv_cnt++;
++<<<<<<< HEAD
++=======
+ 		probe |= !skb_queue_empty(&l->deferdq);
+ 		if (l->snd_nxt == l->checkpoint) {
+ 			tipc_link_update_cwin(l, 0, 0);
+ 			probe = true;
+ 		}
+ 		l->checkpoint = l->snd_nxt;
++>>>>>>> 6ef9dcb78046 (tipc: allow to build NACK message in link timeout function)
  		break;
  	case LINK_RESET:
  		setup = l->rst_cnt++ <= 4;
* Unmerged path net/tipc/link.c
