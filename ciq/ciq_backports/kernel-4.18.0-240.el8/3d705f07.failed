net: Remove switchdev_ops

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-240.el8
Rebuild_CHGLOG: - [net] Remove switchdev_ops (Ivan Vecera) [1821402]
Rebuild_FUZZ: 88.89%
commit-author Florian Fainelli <f.fainelli@gmail.com>
commit 3d705f07d16b1d872c556b4ebf44deabeca0e9c1
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-240.el8/3d705f07.failed

Now that we have converted all possible callers to using a switchdev
notifier for attributes we do not have a need for implementing
switchdev_ops anymore, and this can be removed from all drivers the
net_device structure.

	Signed-off-by: Florian Fainelli <f.fainelli@gmail.com>
	Reviewed-by: Ido Schimmel <idosch@mellanox.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 3d705f07d16b1d872c556b4ebf44deabeca0e9c1)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/mellanox/mlxsw/spectrum.c
#	drivers/net/ethernet/mellanox/mlxsw/spectrum_switchdev.c
#	drivers/net/ethernet/rocker/rocker_main.c
#	drivers/staging/fsl-dpaa2/ethsw/ethsw.c
#	include/net/switchdev.h
#	net/dsa/slave.c
diff --cc drivers/net/ethernet/mellanox/mlxsw/spectrum.c
index e8c909531608,6c797e322be8..000000000000
--- a/drivers/net/ethernet/mellanox/mlxsw/spectrum.c
+++ b/drivers/net/ethernet/mellanox/mlxsw/spectrum.c
@@@ -3794,10 -3660,6 +3794,13 @@@ static int mlxsw_sp_port_create(struct 
  	}
  	mlxsw_sp_port->default_vlan = mlxsw_sp_port_vlan;
  
++<<<<<<< HEAD
 +	INIT_DELAYED_WORK(&mlxsw_sp_port->ptp.shaper_dw,
 +			  mlxsw_sp->ptp_ops->shaper_work);
 +
 +	mlxsw_sp_port_switchdev_init(mlxsw_sp_port);
++=======
++>>>>>>> 3d705f07d16b (net: Remove switchdev_ops)
  	mlxsw_sp->ports[local_port] = mlxsw_sp_port;
  	err = register_netdev(dev);
  	if (err) {
diff --cc drivers/net/ethernet/mellanox/mlxsw/spectrum_switchdev.c
index c39ddad2daee,f6ce386c3036..000000000000
--- a/drivers/net/ethernet/mellanox/mlxsw/spectrum_switchdev.c
+++ b/drivers/net/ethernet/mellanox/mlxsw/spectrum_switchdev.c
@@@ -1944,11 -1938,6 +1944,14 @@@ static struct mlxsw_sp_port *mlxsw_sp_l
  	return NULL;
  }
  
++<<<<<<< HEAD
 +static const struct switchdev_ops mlxsw_sp_port_switchdev_ops = {
 +	.switchdev_port_attr_get	= mlxsw_sp_port_attr_get,
 +	.switchdev_port_attr_set	= mlxsw_sp_port_attr_set,
 +};
 +
++=======
++>>>>>>> 3d705f07d16b (net: Remove switchdev_ops)
  static int
  mlxsw_sp_bridge_8021q_port_join(struct mlxsw_sp_bridge_device *bridge_device,
  				struct mlxsw_sp_bridge_port *bridge_port,
diff --cc drivers/net/ethernet/rocker/rocker_main.c
index c06a7a50400c,c883aa89b7ca..000000000000
--- a/drivers/net/ethernet/rocker/rocker_main.c
+++ b/drivers/net/ethernet/rocker/rocker_main.c
@@@ -2160,11 -2142,6 +2160,14 @@@ static int rocker_port_obj_del(struct n
  	return err;
  }
  
++<<<<<<< HEAD
 +static const struct switchdev_ops rocker_port_switchdev_ops = {
 +	.switchdev_port_attr_get	= rocker_port_attr_get,
 +	.switchdev_port_attr_set	= rocker_port_attr_set,
 +};
 +
++=======
++>>>>>>> 3d705f07d16b (net: Remove switchdev_ops)
  struct rocker_fib_event_work {
  	struct work_struct work;
  	union {
diff --cc drivers/staging/fsl-dpaa2/ethsw/ethsw.c
index 1f9a4c8ef2da,ad577beeb052..000000000000
--- a/drivers/staging/fsl-dpaa2/ethsw/ethsw.c
+++ b/drivers/staging/fsl-dpaa2/ethsw/ethsw.c
@@@ -932,10 -925,18 +932,25 @@@ static int swdev_port_obj_del(struct ne
  	return err;
  }
  
++<<<<<<< HEAD
 +static const struct switchdev_ops ethsw_port_switchdev_ops = {
 +	.switchdev_port_attr_get	= swdev_port_attr_get,
 +	.switchdev_port_attr_set	= swdev_port_attr_set,
 +};
++=======
+ static int
+ ethsw_switchdev_port_attr_set_event(struct net_device *netdev,
+ 		struct switchdev_notifier_port_attr_info *port_attr_info)
+ {
+ 	int err;
+ 
+ 	err = swdev_port_attr_set(netdev, port_attr_info->attr,
+ 				  port_attr_info->trans);
+ 
+ 	port_attr_info->handled = true;
+ 	return notifier_from_errno(err);
+ }
++>>>>>>> 3d705f07d16b (net: Remove switchdev_ops)
  
  /* For the moment, only flood setting needs to be updated */
  static int port_bridge_join(struct net_device *netdev,
diff --cc include/net/switchdev.h
index a597dfb387d4,e4f751e19ecf..000000000000
--- a/include/net/switchdev.h
+++ b/include/net/switchdev.h
@@@ -126,34 -112,6 +126,37 @@@ void *switchdev_trans_item_dequeue(stru
  
  typedef int switchdev_obj_dump_cb_t(struct switchdev_obj *obj);
  
++<<<<<<< HEAD
 +struct switchdev_ops_extended_rh {
 +};
 +
 +/**
 + * struct switchdev_ops - switchdev operations
 + *
 + * @switchdev_port_attr_set: Set a port attribute (see switchdev_attr).
 + */
 +struct switchdev_ops {
 +	int	(*switchdev_port_attr_set)(struct net_device *dev,
 +					   const struct switchdev_attr *attr,
 +					   struct switchdev_trans *trans);
 +	RH_KABI_DEPRECATE_FN(int, switchdev_port_obj_add, struct net_device *dev,
 +					  const struct switchdev_obj *obj,
 +					  struct switchdev_trans *trans)
 +	RH_KABI_DEPRECATE_FN(int, switchdev_port_obj_del, struct net_device *dev,
 +					  const struct switchdev_obj *obj)
 +
 +	RH_KABI_RESERVE(1)
 +	RH_KABI_RESERVE(2)
 +	RH_KABI_RESERVE(3)
 +	RH_KABI_RESERVE(4)
 +	RH_KABI_RESERVE(5)
 +	RH_KABI_RESERVE(6)
 +	RH_KABI_RESERVE(7)
 +	RH_KABI_SIZE_AND_EXTEND(switchdev_ops_extended)
 +};
 +
++=======
++>>>>>>> 3d705f07d16b (net: Remove switchdev_ops)
  enum switchdev_notifier_type {
  	SWITCHDEV_FDB_ADD_TO_BRIDGE = 1,
  	SWITCHDEV_FDB_DEL_TO_BRIDGE,
diff --cc net/dsa/slave.c
index fb4f949cd420,1808a2cd6872..000000000000
--- a/net/dsa/slave.c
+++ b/net/dsa/slave.c
@@@ -1069,13 -1114,10 +1069,16 @@@ static const struct net_device_ops dsa_
  	.ndo_setup_tc		= dsa_slave_setup_tc,
  	.ndo_get_stats64	= dsa_slave_get_stats64,
  	.ndo_get_port_parent_id	= dsa_slave_get_port_parent_id,
 -	.ndo_vlan_rx_add_vid	= dsa_slave_vlan_rx_add_vid,
 -	.ndo_vlan_rx_kill_vid	= dsa_slave_vlan_rx_kill_vid,
  };
  
++<<<<<<< HEAD
 +static const struct switchdev_ops dsa_slave_switchdev_ops = {
 +	.switchdev_port_attr_get	= dsa_slave_port_attr_get,
 +	.switchdev_port_attr_set	= dsa_slave_port_attr_set,
 +};
 +
++=======
++>>>>>>> 3d705f07d16b (net: Remove switchdev_ops)
  static struct device_type dsa_type = {
  	.name	= "dsa",
  };
* Unmerged path drivers/net/ethernet/mellanox/mlxsw/spectrum.c
diff --git a/drivers/net/ethernet/mellanox/mlxsw/spectrum.h b/drivers/net/ethernet/mellanox/mlxsw/spectrum.h
index 209b2f4c4707..5c3bbad93f21 100644
--- a/drivers/net/ethernet/mellanox/mlxsw/spectrum.h
+++ b/drivers/net/ethernet/mellanox/mlxsw/spectrum.h
@@ -434,8 +434,6 @@ extern const struct mlxsw_sp_sb_vals mlxsw_sp2_sb_vals;
 /* spectrum_switchdev.c */
 int mlxsw_sp_switchdev_init(struct mlxsw_sp *mlxsw_sp);
 void mlxsw_sp_switchdev_fini(struct mlxsw_sp *mlxsw_sp);
-void mlxsw_sp_port_switchdev_init(struct mlxsw_sp_port *mlxsw_sp_port);
-void mlxsw_sp_port_switchdev_fini(struct mlxsw_sp_port *mlxsw_sp_port);
 int mlxsw_sp_rif_fdb_op(struct mlxsw_sp *mlxsw_sp, const char *mac, u16 fid,
 			bool adding);
 void
* Unmerged path drivers/net/ethernet/mellanox/mlxsw/spectrum_switchdev.c
diff --git a/drivers/net/ethernet/mscc/ocelot.c b/drivers/net/ethernet/mscc/ocelot.c
index fb1208bf823d..2c9150e42e53 100644
--- a/drivers/net/ethernet/mscc/ocelot.c
+++ b/drivers/net/ethernet/mscc/ocelot.c
@@ -1047,10 +1047,6 @@ static int ocelot_port_obj_del(struct net_device *dev,
 	return ret;
 }
 
-static const struct switchdev_ops ocelot_port_switchdev_ops = {
-	.switchdev_port_attr_set	= ocelot_port_attr_set,
-};
-
 static int ocelot_port_bridge_join(struct ocelot_port *ocelot_port,
 				   struct net_device *bridge)
 {
@@ -1195,7 +1191,6 @@ int ocelot_probe_port(struct ocelot *ocelot, u8 port,
 
 	dev->netdev_ops = &ocelot_port_netdev_ops;
 	dev->ethtool_ops = &ocelot_ethtool_ops;
-	dev->switchdev_ops = &ocelot_port_switchdev_ops;
 
 	memcpy(dev->dev_addr, ocelot->base_mac, ETH_ALEN);
 	dev->dev_addr[ETH_ALEN - 1] += port;
* Unmerged path drivers/net/ethernet/rocker/rocker_main.c
* Unmerged path drivers/staging/fsl-dpaa2/ethsw/ethsw.c
diff --git a/include/linux/netdevice.h b/include/linux/netdevice.h
index 65944a2aa5bb..9efd70ab5d43 100644
--- a/include/linux/netdevice.h
+++ b/include/linux/netdevice.h
@@ -1956,9 +1956,6 @@ struct net_device {
 #endif
 	const struct net_device_ops *netdev_ops;
 	const struct ethtool_ops *ethtool_ops;
-#ifdef CONFIG_NET_SWITCHDEV
-	const struct switchdev_ops *switchdev_ops;
-#endif
 #ifdef CONFIG_NET_L3_MASTER_DEV
 	const struct l3mdev_ops	*l3mdev_ops;
 #endif
* Unmerged path include/net/switchdev.h
* Unmerged path net/dsa/slave.c
