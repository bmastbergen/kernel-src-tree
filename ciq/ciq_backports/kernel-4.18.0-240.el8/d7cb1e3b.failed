flow_offload: introduce "disabled" HW stats type and allow it in mlxsw

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-240.el8
commit-author Jiri Pirko <jiri@mellanox.com>
commit d7cb1e3ba12e004e92e9ad2e8d272220db0a541c
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-240.el8/d7cb1e3b.failed

Introduce new type for disabled HW stats and allow the value in
mlxsw offload.

	Signed-off-by: Jiri Pirko <jiri@mellanox.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit d7cb1e3ba12e004e92e9ad2e8d272220db0a541c)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	include/net/flow_offload.h
diff --cc include/net/flow_offload.h
index 33bf4724731c,64807aa03cee..000000000000
--- a/include/net/flow_offload.h
+++ b/include/net/flow_offload.h
@@@ -154,7 -156,10 +154,14 @@@ enum flow_action_mangle_base 
  };
  
  #define FLOW_ACTION_HW_STATS_TYPE_IMMEDIATE BIT(0)
++<<<<<<< HEAD
 +#define FLOW_ACTION_HW_STATS_TYPE_ANY FLOW_ACTION_HW_STATS_TYPE_IMMEDIATE
++=======
+ #define FLOW_ACTION_HW_STATS_TYPE_DELAYED BIT(1)
+ #define FLOW_ACTION_HW_STATS_TYPE_ANY (FLOW_ACTION_HW_STATS_TYPE_IMMEDIATE | \
+ 				       FLOW_ACTION_HW_STATS_TYPE_DELAYED)
+ #define FLOW_ACTION_HW_STATS_TYPE_DISABLED 0
++>>>>>>> d7cb1e3ba12e (flow_offload: introduce "disabled" HW stats type and allow it in mlxsw)
  
  typedef void (*action_destr)(void *priv);
  
diff --git a/drivers/net/ethernet/mellanox/mlxsw/spectrum_flower.c b/drivers/net/ethernet/mellanox/mlxsw/spectrum_flower.c
index 95387525a11b..e08a71febef7 100644
--- a/drivers/net/ethernet/mellanox/mlxsw/spectrum_flower.c
+++ b/drivers/net/ethernet/mellanox/mlxsw/spectrum_flower.c
@@ -35,7 +35,7 @@ static int mlxsw_sp_flower_parse_actions(struct mlxsw_sp *mlxsw_sp,
 		err = mlxsw_sp_acl_rulei_act_count(mlxsw_sp, rulei, extack);
 		if (err)
 			return err;
-	} else {
+	} else if (act->hw_stats_type != FLOW_ACTION_HW_STATS_TYPE_DISABLED) {
 		NL_SET_ERR_MSG_MOD(extack, "Unsupported action HW stats type");
 		return -EOPNOTSUPP;
 	}
* Unmerged path include/net/flow_offload.h
