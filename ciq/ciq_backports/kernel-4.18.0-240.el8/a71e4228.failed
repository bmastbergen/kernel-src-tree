xfs: fix xfs_rmap_has_other_keys usage of ECANCELED

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-240.el8
commit-author Darrick J. Wong <darrick.wong@oracle.com>
commit a71e4228e6f2a4fe6519d8ed081d0a164967fa31
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-240.el8/a71e4228.failed

In e7ee96dfb8c26, we converted all ITER_ABORT users to use ECANCELED
instead, but we forgot to teach xfs_rmap_has_other_keys not to return
that magic value to callers.  Fix it now by using ECANCELED both to
abort the iteration and to signal that we found another reverse mapping.
This enables us to drop the separate boolean flag.

Fixes: e7ee96dfb8c26 ("xfs: remove all *_ITER_ABORT values")
	Signed-off-by: Darrick J. Wong <darrick.wong@oracle.com>
	Reviewed-by: Dave Chinner <dchinner@redhat.com>
	Reviewed-by: Christoph Hellwig <hch@lst.de>
(cherry picked from commit a71e4228e6f2a4fe6519d8ed081d0a164967fa31)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	fs/xfs/libxfs/xfs_rmap.c
diff --cc fs/xfs/libxfs/xfs_rmap.c
index 8ed885507dd8,dae1a2bf28eb..000000000000
--- a/fs/xfs/libxfs/xfs_rmap.c
+++ b/fs/xfs/libxfs/xfs_rmap.c
@@@ -2517,8 -2708,7 +2516,12 @@@ xfs_rmap_has_other_keys_helper
  	if (rks->owner == rec->rm_owner && rks->offset == rec->rm_offset &&
  	    ((rks->flags & rec->rm_flags) & XFS_RMAP_KEY_FLAGS) == rks->flags)
  		return 0;
++<<<<<<< HEAD
 +	rks->has_rmap = true;
 +	return XFS_BTREE_QUERY_RANGE_ABORT;
++=======
+ 	return -ECANCELED;
++>>>>>>> a71e4228e6f2 (xfs: fix xfs_rmap_has_other_keys usage of ECANCELED)
  }
  
  /*
@@@ -2547,7 -2737,11 +2550,15 @@@ xfs_rmap_has_other_keys
  
  	error = xfs_rmap_query_range(cur, &low, &high,
  			xfs_rmap_has_other_keys_helper, &rks);
++<<<<<<< HEAD
 +	*has_rmap = rks.has_rmap;
++=======
+ 	if (error == -ECANCELED) {
+ 		*has_rmap = true;
+ 		return 0;
+ 	}
+ 
++>>>>>>> a71e4228e6f2 (xfs: fix xfs_rmap_has_other_keys usage of ECANCELED)
  	return error;
  }
  
* Unmerged path fs/xfs/libxfs/xfs_rmap.c
