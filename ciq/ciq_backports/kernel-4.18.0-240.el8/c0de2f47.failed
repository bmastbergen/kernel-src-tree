net: phylink: split phylink_sfp_module_insert()

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-240.el8
commit-author Russell King <rmk+kernel@armlinux.org.uk>
commit c0de2f47202941d936f0482ccd5b010b642a0008
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-240.el8/c0de2f47.failed

Split out the configuration step from phylink_sfp_module_insert() so
we can re-use this later.

	Reviewed-by: Andrew Lunn <andrew@lunn.ch>
	Signed-off-by: Russell King <rmk+kernel@armlinux.org.uk>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit c0de2f47202941d936f0482ccd5b010b642a0008)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/phy/phylink.c
diff --cc drivers/net/phy/phylink.c
index d2ef72edac49,571521d928f2..000000000000
--- a/drivers/net/phy/phylink.c
+++ b/drivers/net/phy/phylink.c
@@@ -1646,30 -1713,28 +1642,42 @@@ static int phylink_sfp_config(struct ph
  		return ret;
  	}
  
- 	linkmode_copy(support1, support);
- 
  	iface = sfp_select_interface(pl->sfp_bus, config.advertising);
  	if (iface == PHY_INTERFACE_MODE_NA) {
 -		phylink_err(pl,
 -			    "selection of interface failed, advertisement %*pb\n",
 -			    __ETHTOOL_LINK_MODE_MASK_NBITS, config.advertising);
 +		netdev_err(pl->netdev,
 +			   "selection of interface failed, advertisement %*pb\n",
 +			   __ETHTOOL_LINK_MODE_MASK_NBITS, config.advertising);
  		return -EINVAL;
  	}
  
  	config.interface = iface;
+ 	linkmode_copy(support1, support);
  	ret = phylink_validate(pl, support1, &config);
  	if (ret) {
++<<<<<<< HEAD
 +		netdev_err(pl->netdev, "validation of %s/%s with support %*pb failed: %d\n",
 +			   phylink_an_mode_str(MLO_AN_INBAND),
 +			   phy_modes(config.interface),
 +			   __ETHTOOL_LINK_MODE_MASK_NBITS, support, ret);
 +		return ret;
 +	}
 +
 +	netdev_dbg(pl->netdev, "requesting link mode %s/%s with support %*pb\n",
 +		   phylink_an_mode_str(MLO_AN_INBAND),
 +		   phy_modes(config.interface),
 +		   __ETHTOOL_LINK_MODE_MASK_NBITS, support);
++=======
+ 		phylink_err(pl, "validation of %s/%s with support %*pb failed: %d\n",
+ 			    phylink_an_mode_str(mode),
+ 			    phy_modes(config.interface),
+ 			    __ETHTOOL_LINK_MODE_MASK_NBITS, support, ret);
+ 		return ret;
+ 	}
+ 
+ 	phylink_dbg(pl, "requesting link mode %s/%s with support %*pb\n",
+ 		    phylink_an_mode_str(mode), phy_modes(config.interface),
+ 		    __ETHTOOL_LINK_MODE_MASK_NBITS, support);
++>>>>>>> c0de2f472029 (net: phylink: split phylink_sfp_module_insert())
  
  	if (phy_interface_mode_is_8023z(iface) && pl->phydev)
  		return -EINVAL;
@@@ -1680,16 -1745,16 +1688,29 @@@
  		linkmode_copy(pl->link_config.advertising, config.advertising);
  	}
  
++<<<<<<< HEAD
 +	if (pl->link_an_mode != MLO_AN_INBAND ||
 +	    pl->link_config.interface != config.interface) {
 +		pl->link_config.interface = config.interface;
 +		pl->link_an_mode = MLO_AN_INBAND;
 +
 +		changed = true;
 +
 +		netdev_info(pl->netdev, "switched to %s/%s link mode\n",
 +			    phylink_an_mode_str(MLO_AN_INBAND),
 +			    phy_modes(config.interface));
++=======
+ 	if (pl->cur_link_an_mode != mode ||
+ 	    pl->link_config.interface != config.interface) {
+ 		pl->link_config.interface = config.interface;
+ 		pl->cur_link_an_mode = mode;
+ 
+ 		changed = true;
+ 
+ 		phylink_info(pl, "switched to %s/%s link mode\n",
+ 			     phylink_an_mode_str(mode),
+ 			     phy_modes(config.interface));
++>>>>>>> c0de2f472029 (net: phylink: split phylink_sfp_module_insert())
  	}
  
  	pl->link_port = port;
* Unmerged path drivers/net/phy/phylink.c
