mlxsw: spectrum_router: Start using new IPv6 route notifications

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-240.el8
commit-author Ido Schimmel <idosch@mellanox.com>
commit dacad7b34b59fb06a242ef2cf64205f04f7c5339
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-240.el8/dacad7b3.failed

With the new notifications mlxsw does not need to handle identical
routes itself, as this is taken care of by the core IPv6 code.

Instead, mlxsw only needs to take care of inserting and removing routes
from the device.

Convert mlxsw to use the new IPv6 route notifications and simplify the
code.

	Signed-off-by: Ido Schimmel <idosch@mellanox.com>
	Reviewed-by: Jiri Pirko <jiri@mellanox.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit dacad7b34b59fb06a242ef2cf64205f04f7c5339)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/mellanox/mlxsw/spectrum_router.c
diff --cc drivers/net/ethernet/mellanox/mlxsw/spectrum_router.c
index 52037acf49a1,295cdcb1c4c0..000000000000
--- a/drivers/net/ethernet/mellanox/mlxsw/spectrum_router.c
+++ b/drivers/net/ethernet/mellanox/mlxsw/spectrum_router.c
@@@ -4896,12 -4989,6 +4896,15 @@@ static void mlxsw_sp_rt6_destroy(struc
  	kfree(mlxsw_sp_rt6);
  }
  
++<<<<<<< HEAD
 +static bool mlxsw_sp_fib6_rt_can_mp(const struct fib6_info *rt)
 +{
 +	/* RTF_CACHE routes are ignored */
 +	return (rt->fib6_flags & (RTF_GATEWAY | RTF_ADDRCONF)) == RTF_GATEWAY;
 +}
 +
++=======
++>>>>>>> dacad7b34b59 (mlxsw: spectrum_router: Start using new IPv6 route notifications)
  static struct fib6_info *
  mlxsw_sp_fib6_entry_rt(const struct mlxsw_sp_fib6_entry *fib6_entry)
  {
@@@ -6146,7 -6174,8 +6081,12 @@@ static int mlxsw_sp_router_fib_event(st
  		return notifier_from_errno(err);
  	case FIB_EVENT_ENTRY_ADD: /* fall through */
  	case FIB_EVENT_ENTRY_REPLACE: /* fall through */
++<<<<<<< HEAD
 +	case FIB_EVENT_ENTRY_REPLACE_TMP:
++=======
+ 	case FIB_EVENT_ENTRY_REPLACE_TMP: /* fall through */
+ 	case FIB_EVENT_ENTRY_APPEND:
++>>>>>>> dacad7b34b59 (mlxsw: spectrum_router: Start using new IPv6 route notifications)
  		if (router->aborted) {
  			NL_SET_ERR_MSG_MOD(info->extack, "FIB offload was aborted. Not configuring route");
  			return notifier_from_errno(-EINVAL);
* Unmerged path drivers/net/ethernet/mellanox/mlxsw/spectrum_router.c
