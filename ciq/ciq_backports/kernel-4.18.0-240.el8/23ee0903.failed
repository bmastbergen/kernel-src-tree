ASoC: SOF: Intel: refactor i915_get/put functions

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-240.el8
Rebuild_CHGLOG: - [sound] ALSA: ASoC: SOF: Intel: refactor i915_get/put functions (Jaroslav Kysela) [1797509]
Rebuild_FUZZ: 94.23%
commit-author Kai Vehmanen <kai.vehmanen@linux.intel.com>
commit 23ee09032d44736c5e8c7becbe03170dbc6f2e8d
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-240.el8/23ee0903.failed

The current interface to control i915 display power is misleading.
The hda_codec_i915_get() and hda_codec_i915_put() names suggest
a refcounting based interface. This is confusing as no refcounting
is done and the underlying HDAC library interface does not support
refcounts eithers.

Clarify the code by replacing the functions with a single
hda_codec_i915_display_power() that is aligned with
snd_hdac_display_power().

	Signed-off-by: Kai Vehmanen <kai.vehmanen@linux.intel.com>
Link: https://lore.kernel.org/r/20200120160117.29130-2-kai.vehmanen@linux.intel.com
	Acked-by: Pierre-Louis Bossart <pierre-louis.bossart@linux.intel.com>
	Signed-off-by: Mark Brown <broonie@kernel.org>
(cherry picked from commit 23ee09032d44736c5e8c7becbe03170dbc6f2e8d)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	sound/soc/sof/intel/hda-codec.c
diff --cc sound/soc/sof/intel/hda-codec.c
index 9eae2be41b28,9106ab8dac6f..000000000000
--- a/sound/soc/sof/intel/hda-codec.c
+++ b/sound/soc/sof/intel/hda-codec.c
@@@ -174,19 -174,10 +174,23 @@@ void hda_codec_i915_display_power(struc
  {
  	struct hdac_bus *bus = sof_to_bus(sdev);
  
- 	dev_dbg(bus->dev, "Turning i915 HDAC power on\n");
- 	snd_hdac_display_power(bus, HDA_CODEC_IDX_CONTROLLER, true);
+ 	dev_dbg(bus->dev, "Turning i915 HDAC power %d\n", enable);
+ 	snd_hdac_display_power(bus, HDA_CODEC_IDX_CONTROLLER, enable);
  }
++<<<<<<< HEAD
 +EXPORT_SYMBOL(hda_codec_i915_get);
 +
 +void hda_codec_i915_put(struct snd_sof_dev *sdev)
 +{
 +	struct hdac_bus *bus = sof_to_bus(sdev);
 +
 +	dev_dbg(bus->dev, "Turning i915 HDAC power off\n");
 +	snd_hdac_display_power(bus, HDA_CODEC_IDX_CONTROLLER, false);
 +}
 +EXPORT_SYMBOL(hda_codec_i915_put);
++=======
+ EXPORT_SYMBOL_NS(hda_codec_i915_display_power, SND_SOC_SOF_HDA_AUDIO_CODEC_I915);
++>>>>>>> 23ee09032d44 (ASoC: SOF: Intel: refactor i915_get/put functions)
  
  int hda_codec_i915_init(struct snd_sof_dev *sdev)
  {
* Unmerged path sound/soc/sof/intel/hda-codec.c
diff --git a/sound/soc/sof/intel/hda.c b/sound/soc/sof/intel/hda.c
index bfdb817b3780..3f0ed8f7b179 100644
--- a/sound/soc/sof/intel/hda.c
+++ b/sound/soc/sof/intel/hda.c
@@ -478,7 +478,7 @@ static int hda_init_caps(struct snd_sof_dev *sdev)
 	/* create codec instances */
 	hda_codec_probe_bus(sdev, hda_codec_use_common_hdmi);
 
-	hda_codec_i915_put(sdev);
+	hda_codec_i915_display_power(sdev, false);
 
 	/*
 	 * we are done probing so decrement link counts
diff --git a/sound/soc/sof/intel/hda.h b/sound/soc/sof/intel/hda.h
index 9f071fd5f2ea..1159125a3499 100644
--- a/sound/soc/sof/intel/hda.h
+++ b/sound/soc/sof/intel/hda.h
@@ -586,15 +586,14 @@ void hda_codec_jack_check(struct snd_sof_dev *sdev);
 	(IS_ENABLED(CONFIG_SND_HDA_CODEC_HDMI) || \
 	 IS_ENABLED(CONFIG_SND_SOC_HDAC_HDMI))
 
-void hda_codec_i915_get(struct snd_sof_dev *sdev);
-void hda_codec_i915_put(struct snd_sof_dev *sdev);
+void hda_codec_i915_display_power(struct snd_sof_dev *sdev, bool enable);
 int hda_codec_i915_init(struct snd_sof_dev *sdev);
 int hda_codec_i915_exit(struct snd_sof_dev *sdev);
 
 #else
 
-static inline void hda_codec_i915_get(struct snd_sof_dev *sdev)  { }
-static inline void hda_codec_i915_put(struct snd_sof_dev *sdev)  { }
+static inline void hda_codec_i915_display_power(struct snd_sof_dev *sdev,
+						bool enable) { }
 static inline int hda_codec_i915_init(struct snd_sof_dev *sdev) { return 0; }
 static inline int hda_codec_i915_exit(struct snd_sof_dev *sdev) { return 0; }
 
