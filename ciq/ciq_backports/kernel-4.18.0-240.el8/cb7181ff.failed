iomap: move the main iteration code into a separate file

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-240.el8
commit-author Darrick J. Wong <darrick.wong@oracle.com>
commit cb7181ff4b1ca1e4a9dbea8a3982142ce4ed73fd
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-240.el8/cb7181ff.failed

Move the main iteration code into a separate file so that we can group
related functions in a single file instead of having a single enormous
source file.

	Signed-off-by: Darrick J. Wong <darrick.wong@oracle.com>
	Reviewed-by: Christoph Hellwig <hch@lst.de>
(cherry picked from commit cb7181ff4b1ca1e4a9dbea8a3982142ce4ed73fd)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	fs/Makefile
#	fs/iomap/Makefile
diff --cc fs/Makefile
index 8e15d6fc4340,d60089fd689b..000000000000
--- a/fs/Makefile
+++ b/fs/Makefile
@@@ -51,7 -52,7 +51,11 @@@ obj-$(CONFIG_COREDUMP)		+= coredump.
  obj-$(CONFIG_SYSCTL)		+= drop_caches.o
  
  obj-$(CONFIG_FHANDLE)		+= fhandle.o
++<<<<<<< HEAD
 +obj-$(CONFIG_FS_IOMAP)		+= iomap.o
++=======
+ obj-y				+= iomap/
++>>>>>>> cb7181ff4b1c (iomap: move the main iteration code into a separate file)
  
  obj-y				+= quota/
  
* Unmerged path fs/iomap/Makefile
* Unmerged path fs/Makefile
* Unmerged path fs/iomap/Makefile
diff --git a/fs/iomap.c b/fs/iomap/apply.c
similarity index 99%
rename from fs/iomap.c
rename to fs/iomap/apply.c
index 7e0c1adb7ff5..944e720c93e6 100644
--- a/fs/iomap.c
+++ b/fs/iomap/apply.c
@@ -7,23 +7,8 @@
 #include <linux/compiler.h>
 #include <linux/fs.h>
 #include <linux/iomap.h>
-#include <linux/uaccess.h>
-#include <linux/gfp.h>
-#include <linux/migrate.h>
-#include <linux/mm.h>
-#include <linux/mm_inline.h>
-#include <linux/swap.h>
-#include <linux/pagemap.h>
-#include <linux/pagevec.h>
-#include <linux/file.h>
-#include <linux/uio.h>
-#include <linux/backing-dev.h>
-#include <linux/buffer_head.h>
-#include <linux/task_io_accounting_ops.h>
-#include <linux/dax.h>
-#include <linux/sched/signal.h>
-
-#include "internal.h"
+
+#include "../internal.h"
 
 /*
  * Execute a iomap write on a segment of the mapping that spans a
