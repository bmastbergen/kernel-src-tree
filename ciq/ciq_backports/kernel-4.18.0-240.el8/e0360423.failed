selftests/bpf: Run SYN cookies with reuseport BPF test only for TCP

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-240.el8
commit-author Jakub Sitnicki <jakub@cloudflare.com>
commit e0360423d0204eb22f97ed89ba56da496bb9a094
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-240.el8/e0360423.failed

Currently we run SYN cookies test for all socket types and mark the test as
skipped if socket type is not compatible. This causes confusion because
skipped test might indicate a problem with the testing environment.

Instead, run the test only for the socket type which supports SYN cookies.

Also, switch to using designated initializers when setting up tests, so
that we can tweak only some test parameters, leaving the rest initialized
to default values.

Fixes: eecd618b4516 ("selftests/bpf: Mark SYN cookie test skipped for UDP sockets")
	Reported-by: Alexei Starovoitov <ast@kernel.org>
	Signed-off-by: Jakub Sitnicki <jakub@cloudflare.com>
	Signed-off-by: Alexei Starovoitov <ast@kernel.org>
	Acked-by: Martin KaFai Lau <kafai@fb.com>
Link: https://lore.kernel.org/bpf/20200224135327.121542-2-jakub@cloudflare.com
(cherry picked from commit e0360423d0204eb22f97ed89ba56da496bb9a094)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	tools/testing/selftests/bpf/prog_tests/select_reuseport.c
diff --cc tools/testing/selftests/bpf/prog_tests/select_reuseport.c
index 0800036ed654,a1dd13b34d4b..000000000000
--- a/tools/testing/selftests/bpf/prog_tests/select_reuseport.c
+++ b/tools/testing/selftests/bpf/prog_tests/select_reuseport.c
@@@ -780,8 -805,18 +778,16 @@@ static void test_config(int sotype, sa_
  	char s[MAX_TEST_NAME];
  	const struct test *t;
  
 -	/* SOCKMAP/SOCKHASH don't support UDP yet */
 -	if (sotype == SOCK_DGRAM &&
 -	    (inner_map_type == BPF_MAP_TYPE_SOCKMAP ||
 -	     inner_map_type == BPF_MAP_TYPE_SOCKHASH))
 -		return;
 -
  	for (t = tests; t < tests + ARRAY_SIZE(tests); t++) {
++<<<<<<< HEAD
 +		snprintf(s, sizeof(s), "%s/%s %s %s",
++=======
+ 		if (t->need_sotype && t->need_sotype != sotype)
+ 			continue; /* test not compatible with socket type */
+ 
+ 		snprintf(s, sizeof(s), "%s %s/%s %s %s",
+ 			 maptype_str(inner_map_type),
++>>>>>>> e0360423d020 (selftests/bpf: Run SYN cookies with reuseport BPF test only for TCP)
  			 family_str(family), sotype_str(sotype),
  			 inany ? "INANY" : "LOOPBACK", t->name);
  
* Unmerged path tools/testing/selftests/bpf/prog_tests/select_reuseport.c
