scsi: zfcp: enhance handling of FC Endpoint Security errors

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-240.el8
commit-author Jens Remus <jremus@linux.ibm.com>
commit e53d92856e9f1cfa0be284fa1dc3367130ce433a
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-240.el8/e53d9285.failed

Enable for explicit FCP channel FC Endpoint Security error reporting and
handle any FSF security errors according to specification. Take the
following recovery actions when a FSF_SECURITY_ERROR is reported for the
specified FSF commands:

- Open Port: Retry the command if possible
- Send FCP : Physically close the remote port and reopen

For Open Port the command status is set to error, which triggers a retry.
For Send FCP the command status is set to error and recovery is triggered
to physically reopen the remote port.

Link: https://lore.kernel.org/r/20200312174505.51294-10-maier@linux.ibm.com
	Reviewed-by: Steffen Maier <maier@linux.ibm.com>
	Signed-off-by: Jens Remus <jremus@linux.ibm.com>
	Signed-off-by: Steffen Maier <maier@linux.ibm.com>
	Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
(cherry picked from commit e53d92856e9f1cfa0be284fa1dc3367130ce433a)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/s390/scsi/zfcp_fsf.c
diff --cc drivers/s390/scsi/zfcp_fsf.c
index aaa4066c5699,e8d0bf0ec10f..000000000000
--- a/drivers/s390/scsi/zfcp_fsf.c
+++ b/drivers/s390/scsi/zfcp_fsf.c
@@@ -1236,7 -1404,9 +1236,13 @@@ int zfcp_fsf_exchange_config_data(struc
  
  	req->qtcb->bottom.config.feature_selection =
  			FSF_FEATURE_NOTIFICATION_LOST |
++<<<<<<< HEAD
 +			FSF_FEATURE_UPDATE_ALERT;
++=======
+ 			FSF_FEATURE_UPDATE_ALERT |
+ 			FSF_FEATURE_REQUEST_SFP_DATA |
+ 			FSF_FEATURE_FC_SECURITY;
++>>>>>>> e53d92856e9f (scsi: zfcp: enhance handling of FC Endpoint Security errors)
  	req->erp_action = erp_action;
  	req->handler = zfcp_fsf_exchange_config_data_handler;
  	erp_action->fsf_req_id = req->req_id;
@@@ -1275,7 -1459,9 +1281,13 @@@ int zfcp_fsf_exchange_config_data_sync(
  
  	req->qtcb->bottom.config.feature_selection =
  			FSF_FEATURE_NOTIFICATION_LOST |
++<<<<<<< HEAD
 +			FSF_FEATURE_UPDATE_ALERT;
++=======
+ 			FSF_FEATURE_UPDATE_ALERT |
+ 			FSF_FEATURE_REQUEST_SFP_DATA |
+ 			FSF_FEATURE_FC_SECURITY;
++>>>>>>> e53d92856e9f (scsi: zfcp: enhance handling of FC Endpoint Security errors)
  
  	if (data)
  		req->data = data;
* Unmerged path drivers/s390/scsi/zfcp_fsf.c
diff --git a/drivers/s390/scsi/zfcp_fsf.h b/drivers/s390/scsi/zfcp_fsf.h
index 535628b92f0a..1d165c846b8d 100644
--- a/drivers/s390/scsi/zfcp_fsf.h
+++ b/drivers/s390/scsi/zfcp_fsf.h
@@ -78,6 +78,7 @@
 #define FSF_BLOCK_GUARD_CHECK_FAILURE		0x00000081
 #define FSF_APP_TAG_CHECK_FAILURE		0x00000082
 #define FSF_REF_TAG_CHECK_FAILURE		0x00000083
+#define FSF_SECURITY_ERROR			0x00000090
 #define FSF_ADAPTER_STATUS_AVAILABLE		0x000000AD
 #define FSF_FCP_RSP_AVAILABLE			0x000000AF
 #define FSF_UNKNOWN_COMMAND			0x000000E2
