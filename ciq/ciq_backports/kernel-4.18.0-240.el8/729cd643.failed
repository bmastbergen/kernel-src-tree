mptcp: cope better with MP_JOIN failure

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-240.el8
commit-author Paolo Abeni <pabeni@redhat.com>
commit 729cd6436f359b6e618c2f14836d419f40444503
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-240.el8/729cd643.failed

Currently, on MP_JOIN failure we reset the child
socket, but leave the request socket untouched.

tcp_check_req will deal with it according to the
'tcp_abort_on_overflow' sysctl value - by default the
req socket will stay alive.

The above leads to inconsistent behavior on MP JOIN
failure, and bad listener overflow accounting.

This patch addresses the issue leveraging the infrastructure
just introduced to ask the TCP stack to drop the req on
failure.

The child socket is not freed anymore by subflow_syn_recv_sock(),
instead it's moved to a dead state and will be disposed by the
next sock_put done by the TCP stack, so that listener overflow
accounting is not affected by MP JOIN failure.

	Signed-off-by: Paolo Abeni <pabeni@redhat.com>
	Reviewed-by: Christoph Paasch <cpaasch@apple.com>
	Reviewed-by: Mat Martineau <mathew.j.martineau@linux.intel.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 729cd6436f359b6e618c2f14836d419f40444503)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/mptcp/subflow.c
diff --cc net/mptcp/subflow.c
index c928ab97b1e2,3cf2eeea9d80..000000000000
--- a/net/mptcp/subflow.c
+++ b/net/mptcp/subflow.c
@@@ -469,7 -511,10 +469,14 @@@ create_child
  
  			ctx->conn = (struct sock *)owner;
  			if (!mptcp_finish_join(child))
++<<<<<<< HEAD
 +				goto close_child;
++=======
+ 				goto dispose_child;
+ 
+ 			SUBFLOW_REQ_INC_STATS(req, MPTCP_MIB_JOINACKRX);
+ 			tcp_rsk(req)->drop_req = true;
++>>>>>>> 729cd6436f35 (mptcp: cope better with MP_JOIN failure)
  		}
  	}
  
* Unmerged path net/mptcp/subflow.c
