scsi: megaraid_sas: Set no_write_same only for Virtual Disk

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-240.el8
commit-author Anand Lodnoor <anand.lodnoor@broadcom.com>
commit a7faf81d7858b504279713d6cb98053f0ff00082
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-240.el8/a7faf81d.failed

Disable WRITE_SAME (no_write_same) for Virtual Disks only.  For System PDs
and EPDs (Enhanced PDs), WRITE_SAME need not be disabled by default.

Link: https://lore.kernel.org/r/1579000882-20246-3-git-send-email-anand.lodnoor@broadcom.com
	Signed-off-by: Anand Lodnoor <anand.lodnoor@broadcom.com>
	Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
(cherry picked from commit a7faf81d7858b504279713d6cb98053f0ff00082)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/scsi/megaraid/megaraid_sas_base.c
diff --cc drivers/scsi/megaraid/megaraid_sas_base.c
index 74c4ba914dcf,167a3e5edc45..000000000000
--- a/drivers/scsi/megaraid/megaraid_sas_base.c
+++ b/drivers/scsi/megaraid/megaraid_sas_base.c
@@@ -3408,9 -3418,8 +3412,13 @@@ static struct scsi_host_template megasa
  	.eh_timed_out = megasas_reset_timer,
  	.shost_attrs = megaraid_host_attrs,
  	.bios_param = megasas_bios_param,
 +	.use_clustering = ENABLE_CLUSTERING,
  	.change_queue_depth = scsi_change_queue_depth,
++<<<<<<< HEAD
 +	.no_write_same = 1,
++=======
+ 	.max_segment_size = 0xffffffff,
++>>>>>>> a7faf81d7858 (scsi: megaraid_sas: Set no_write_same only for Virtual Disk)
  };
  
  /**
* Unmerged path drivers/scsi/megaraid/megaraid_sas_base.c
diff --git a/drivers/scsi/megaraid/megaraid_sas_fusion.h b/drivers/scsi/megaraid/megaraid_sas_fusion.h
index 6fe334348c46..a155ae60dfe6 100644
--- a/drivers/scsi/megaraid/megaraid_sas_fusion.h
+++ b/drivers/scsi/megaraid/megaraid_sas_fusion.h
@@ -876,9 +876,20 @@ struct MR_LD_RAID {
 	u8	regTypeReqOnRead;
 	__le16     seqNum;
 
-	struct {
-		u32 ldSyncRequired:1;
-		u32 reserved:31;
+struct {
+#ifndef MFI_BIG_ENDIAN
+	u32 ldSyncRequired:1;
+	u32 regTypeReqOnReadIsValid:1;
+	u32 isEPD:1;
+	u32 enableSLDOnAllRWIOs:1;
+	u32 reserved:28;
+#else
+	u32 reserved:28;
+	u32 enableSLDOnAllRWIOs:1;
+	u32 isEPD:1;
+	u32 regTypeReqOnReadIsValid:1;
+	u32 ldSyncRequired:1;
+#endif
 	} flags;
 
 	u8	LUN[8]; /* 0x24 8 byte LUN field used for SCSI IO's */
