drm/i915/dp: Return the right vswing tables

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-240.el8
commit-author José Roberto de Souza <jose.souza@intel.com>
commit 70988115ac69ecc249aa0f8e8265e8daf87bc28c
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-240.el8/70988115.failed

DDI ports have its encoders initialized with INTEL_OUTPUT_DDI type and
later eDP ports that have the type changed to INTEL_OUTPUT_EDP.
But for all other DDI ports it can drive HDMI or DP depending on what
user connects to the ports.

ehl_get_combo_buf_trans() and tgl_get_combo_buf_trans() was checking
for INTEL_OUTPUT_DP that was never true, causing wrong vswing tables
being used.

So here replacing the INTEL_OUTPUT_DP checks by the valid output types
that this functions receives as parameters. HDMI cases will be
correctly handled as it do not use encoder->type, instead it calls the
functions with INTEL_OUTPUT_HDMI as type parameter and HDMI don't have
retraining.

v2:
changed INTEL_OUTPUT_DDI to INTEL_OUTPUT_EDP and INTEL_OUTPUT_HDMI

Fixes: bd3cf6f7ce20 ("drm/i915/dp/tgl+: Update combo phy vswing tables")
	Cc: Clinton A Taylor <clinton.a.taylor@intel.com>
	Cc: Matt Roper <matthew.d.roper@intel.com>
	Cc: Ville Syrjälä <ville.syrjala@linux.intel.com>
	Reviewed-by: Ville Syrjälä <ville.syrjala@linux.intel.com>
	Signed-off-by: José Roberto de Souza <jose.souza@intel.com>
Link: https://patchwork.freedesktop.org/patch/msgid/20200330210044.130510-1-jose.souza@intel.com
(cherry picked from commit 70988115ac69ecc249aa0f8e8265e8daf87bc28c)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/gpu/drm/i915/display/intel_ddi.c
diff --cc drivers/gpu/drm/i915/display/intel_ddi.c
index fd58aa20d02e,a4bc5dfe4a1a..000000000000
--- a/drivers/gpu/drm/i915/display/intel_ddi.c
+++ b/drivers/gpu/drm/i915/display/intel_ddi.c
@@@ -864,15 -943,50 +864,45 @@@ icl_get_combo_buf_trans(struct drm_i915
  	return icl_combo_phy_ddi_translations_dp_hbr2;
  }
  
 -static const struct cnl_ddi_buf_trans *
 -ehl_get_combo_buf_trans(struct drm_i915_private *dev_priv, int type, int rate,
 -			int *n_entries)
 +static int intel_ddi_hdmi_level(struct drm_i915_private *dev_priv, enum port port)
  {
++<<<<<<< HEAD
++=======
+ 	if (type != INTEL_OUTPUT_HDMI && type != INTEL_OUTPUT_EDP &&
+ 	    rate > 270000) {
+ 		*n_entries = ARRAY_SIZE(ehl_combo_phy_ddi_translations_hbr2_hbr3);
+ 		return ehl_combo_phy_ddi_translations_hbr2_hbr3;
+ 	}
+ 
+ 	return icl_get_combo_buf_trans(dev_priv, type, rate, n_entries);
+ }
+ 
+ static const struct cnl_ddi_buf_trans *
+ tgl_get_combo_buf_trans(struct drm_i915_private *dev_priv, int type, int rate,
+ 			int *n_entries)
+ {
+ 	if (type == INTEL_OUTPUT_HDMI || type == INTEL_OUTPUT_EDP) {
+ 		return icl_get_combo_buf_trans(dev_priv, type, rate, n_entries);
+ 	} else if (rate > 270000) {
+ 		*n_entries = ARRAY_SIZE(tgl_combo_phy_ddi_translations_dp_hbr2);
+ 		return tgl_combo_phy_ddi_translations_dp_hbr2;
+ 	}
+ 
+ 	*n_entries = ARRAY_SIZE(tgl_combo_phy_ddi_translations_dp_hbr);
+ 	return tgl_combo_phy_ddi_translations_dp_hbr;
+ }
+ 
+ static int intel_ddi_hdmi_level(struct intel_encoder *encoder)
+ {
+ 	struct drm_i915_private *dev_priv = to_i915(encoder->base.dev);
++>>>>>>> 70988115ac69 (drm/i915/dp: Return the right vswing tables)
  	int n_entries, level, default_entry;
 -	enum phy phy = intel_port_to_phy(dev_priv, encoder->port);
  
 -	if (INTEL_GEN(dev_priv) >= 12) {
 -		if (intel_phy_is_combo(dev_priv, phy))
 -			tgl_get_combo_buf_trans(dev_priv, INTEL_OUTPUT_HDMI,
 -						0, &n_entries);
 -		else
 -			n_entries = ARRAY_SIZE(tgl_dkl_phy_hdmi_ddi_trans);
 -		default_entry = n_entries - 1;
 -	} else if (INTEL_GEN(dev_priv) == 11) {
 -		if (intel_phy_is_combo(dev_priv, phy))
 -			icl_get_combo_buf_trans(dev_priv, INTEL_OUTPUT_HDMI,
 +	level = dev_priv->vbt.ddi_port_info[port].hdmi_level_shift;
 +
 +	if (INTEL_GEN(dev_priv) >= 11) {
 +		if (intel_port_is_combophy(dev_priv, port))
 +			icl_get_combo_buf_trans(dev_priv, port, INTEL_OUTPUT_HDMI,
  						0, &n_entries);
  		else
  			n_entries = ARRAY_SIZE(icl_mg_phy_ddi_translations);
* Unmerged path drivers/gpu/drm/i915/display/intel_ddi.c
