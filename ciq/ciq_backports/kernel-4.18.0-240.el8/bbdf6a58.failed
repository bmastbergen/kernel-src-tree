drm/nouveau/kms/nv50-: Move 8BPC limit for MST into nv50_mstc_get_modes()

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-240.el8
commit-author Lyude Paul <lyude@redhat.com>
commit bbdf6a5891fc46b23a91c16941cc8b18ff37ac43
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-240.el8/bbdf6a58.failed

This just limits the BPC for MST connectors to a maximum of 8 from
nv50_mstc_get_modes(), instead of doing so during
nv50_msto_atomic_check(). This doesn't introduce any functional changes
yet (other then userspace now lying about the max bpc, but we can't
support that yet anyway so meh). But, we'll need this in a moment so
that we can share mode validation between SST and MST which will fix
some real world issues.

	Signed-off-by: Lyude Paul <lyude@redhat.com>
	Signed-off-by: Ben Skeggs <bskeggs@redhat.com>
(cherry picked from commit bbdf6a5891fc46b23a91c16941cc8b18ff37ac43)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/gpu/drm/nouveau/dispnv50/disp.c
diff --cc drivers/gpu/drm/nouveau/dispnv50/disp.c
index da6dd0902c41,ae2c90868caf..000000000000
--- a/drivers/gpu/drm/nouveau/dispnv50/disp.c
+++ b/drivers/gpu/drm/nouveau/dispnv50/disp.c
@@@ -910,15 -908,9 +910,21 @@@ nv50_msto_atomic_check(struct drm_encod
  	if (!state->duplicated) {
  		const int clock = crtc_state->adjusted_mode.clock;
  
++<<<<<<< HEAD
 +		/*
 +		 * XXX: Since we don't use HDR in userspace quite yet, limit
 +		 * the bpc to 8 to save bandwidth on the topology. In the
 +		 * future, we'll want to properly fix this by dynamically
 +		 * selecting the highest possible bpc that would fit in the
 +		 * topology
 +		 */
 +		asyh->or.bpc = min(connector->display_info.bpc, 8U);
 +		asyh->dp.pbn = drm_dp_calc_pbn_mode(clock, asyh->or.bpc * 3);
++=======
+ 		asyh->or.bpc = connector->display_info.bpc;
+ 		asyh->dp.pbn = drm_dp_calc_pbn_mode(clock, asyh->or.bpc * 3,
+ 						    false);
++>>>>>>> bbdf6a5891fc (drm/nouveau/kms/nv50-: Move 8BPC limit for MST into nv50_mstc_get_modes())
  	}
  
  	slots = drm_dp_atomic_find_vcpi_slots(state, &mstm->mgr, mstc->port,
* Unmerged path drivers/gpu/drm/nouveau/dispnv50/disp.c
