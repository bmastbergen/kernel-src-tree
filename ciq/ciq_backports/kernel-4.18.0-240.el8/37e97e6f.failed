ASoC: SOF: core: free trace on errors

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-240.el8
Rebuild_CHGLOG: - [sound] ALSA: ASoC: SOF: core: free trace on errors (Jaroslav Kysela) [1797509]
Rebuild_FUZZ: 92.50%
commit-author Pierre-Louis Bossart <pierre-louis.bossart@linux.intel.com>
commit 37e97e6faeabda405d0c4319f8419dcc3da14b2b
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-240.el8/37e97e6f.failed

free_trace() is not called on probe errors, fix

	Reviewed-by: Kai Vehmanen <kai.vehmanen@linux.intel.com>
	Signed-off-by: Pierre-Louis Bossart <pierre-louis.bossart@linux.intel.com>
Link: https://lore.kernel.org/r/20200124213625.30186-3-pierre-louis.bossart@linux.intel.com
	Signed-off-by: Mark Brown <broonie@kernel.org>
	Cc: stable@vger.kernel.org
(cherry picked from commit 37e97e6faeabda405d0c4319f8419dcc3da14b2b)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	sound/soc/sof/core.c
diff --cc sound/soc/sof/core.c
index d8446fb9fdde,f517ab448a1d..000000000000
--- a/sound/soc/sof/core.c
+++ b/sound/soc/sof/core.c
@@@ -335,25 -224,12 +335,31 @@@ static int sof_probe_continue(struct sn
  	if (ret < 0) {
  		dev_err(sdev->dev,
  			"error: failed to register DSP DAI driver %d\n", ret);
- 		goto fw_run_err;
+ 		goto fw_trace_err;
  	}
  
++<<<<<<< HEAD
 +	drv_name = plat_data->machine->drv_name;
 +	mach = (const void *)plat_data->machine;
 +	size = sizeof(*plat_data->machine);
 +
 +	/* register machine driver, pass machine info as pdata */
 +	plat_data->pdev_mach =
 +		platform_device_register_data(sdev->dev, drv_name,
 +					      PLATFORM_DEVID_NONE, mach, size);
 +
 +	if (IS_ERR(plat_data->pdev_mach)) {
 +		ret = PTR_ERR(plat_data->pdev_mach);
 +		goto fw_run_err;
 +	}
 +
 +	dev_dbg(sdev->dev, "created machine %s\n",
 +		dev_name(&plat_data->pdev_mach->dev));
++=======
+ 	ret = snd_sof_machine_register(sdev, plat_data);
+ 	if (ret < 0)
+ 		goto fw_trace_err;
++>>>>>>> 37e97e6faeab (ASoC: SOF: core: free trace on errors)
  
  	/*
  	 * Some platforms in SOF, ex: BYT, may not have their platform PM
* Unmerged path sound/soc/sof/core.c
