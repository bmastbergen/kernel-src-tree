perf report/top TUI: Support hotkey 'a' for annotation of unresolved addresses

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-240.el8
commit-author Jin Yao <yao.jin@linux.intel.com>
commit ec0479a63b7657e57665a9fc81d11a99131cfc62
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-240.el8/ec0479a6.failed

In previous patch, we have supported the annotation functionality even
without symbols.

For this patch, it supports the hotkey 'a' on address in report view.
Note that, for branch mode, we only support the annotation for "branch
to" address.

	Signed-off-by: Jin Yao <yao.jin@linux.intel.com>
	Tested-by: Arnaldo Carvalho de Melo <acme@redhat.com>
	Acked-by: Jiri Olsa <jolsa@kernel.org>
	Cc: Alexander Shishkin <alexander.shishkin@linux.intel.com>
	Cc: Andi Kleen <ak@linux.intel.com>
	Cc: Kan Liang <kan.liang@linux.intel.com>
	Cc: Peter Zijlstra <peterz@infradead.org>
Link: http://lore.kernel.org/lkml/20200227043939.4403-4-yao.jin@linux.intel.com
	Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>
(cherry picked from commit ec0479a63b7657e57665a9fc81d11a99131cfc62)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	tools/perf/ui/browsers/hists.c
diff --cc tools/perf/ui/browsers/hists.c
index 3386768d57cb,1103a019d83f..000000000000
--- a/tools/perf/ui/browsers/hists.c
+++ b/tools/perf/ui/browsers/hists.c
@@@ -3006,13 -3061,45 +3006,55 @@@ static int perf_evsel__hists_browse(str
  				continue;
  			}
  
++<<<<<<< HEAD
 +			if (browser->selection == NULL ||
 +			    browser->selection->sym == NULL ||
 +			    browser->selection->map->dso->annotate_warned)
 +				continue;
 +
 +			actions->ms.map = browser->selection->map;
 +			actions->ms.sym = browser->selection->sym;
++=======
+ 			if (!browser->selection ||
+ 			    !browser->selection->map ||
+ 			    !browser->selection->map->dso ||
+ 			    browser->selection->map->dso->annotate_warned) {
+ 				continue;
+ 			}
+ 
+ 			if (!browser->selection->sym) {
+ 				if (!browser->he_selection)
+ 					continue;
+ 
+ 				if (sort__mode == SORT_MODE__BRANCH) {
+ 					bi = browser->he_selection->branch_info;
+ 					if (!bi || !bi->to.ms.map)
+ 						continue;
+ 
+ 					actions->ms.sym = symbol__new_unresolved(bi->to.al_addr, bi->to.ms.map);
+ 					actions->ms.map = bi->to.ms.map;
+ 				} else {
+ 					actions->ms.sym = symbol__new_unresolved(browser->he_selection->ip,
+ 										 browser->selection->map);
+ 					actions->ms.map = browser->selection->map;
+ 				}
+ 
+ 				if (!actions->ms.sym)
+ 					continue;
+ 			} else {
+ 				if (symbol__annotation(browser->selection->sym)->src == NULL) {
+ 					ui_browser__warning(&browser->b, delay_secs * 2,
+ 						"No samples for the \"%s\" symbol.\n\n"
+ 						"Probably appeared just in a callchain",
+ 						browser->selection->sym->name);
+ 					continue;
+ 				}
+ 
+ 				actions->ms.map = browser->selection->map;
+ 				actions->ms.sym = browser->selection->sym;
+ 			}
+ 
++>>>>>>> ec0479a63b76 (perf report/top TUI: Support hotkey 'a' for annotation of unresolved addresses)
  			do_annotate(browser, actions);
  			continue;
  		case 'P':
* Unmerged path tools/perf/ui/browsers/hists.c
