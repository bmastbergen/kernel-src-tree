KVM: PPC: Fix nested guest RC bits update

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-240.el8
commit-author Alexey Kardashevskiy <aik@ozlabs.ru>
commit e881bfaf5a5f409390973e076333281465f2b0d9
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-240.el8/e881bfaf.failed

Before commit 6cdf30375f82 ("powerpc/kvm/book3s: Use kvm helpers
to walk shadow or secondary table") we called __find_linux_pte() with
a page table pointer from a kvm_nested_guest struct but
now we rely on kvmhv_find_nested() which takes an L1 LPID and returns
a kvm_nested_guest pointer, however we pass a L0 LPID there and
the L2 guest hangs.

This fixes the LPID passed to kvmppc_hv_handle_set_rc().

Fixes: 6cdf30375f82 ("powerpc/kvm/book3s: Use kvm helpers to walk shadow or secondary table")
	Signed-off-by: Alexey Kardashevskiy <aik@ozlabs.ru>
	Signed-off-by: Michael Ellerman <mpe@ellerman.id.au>
Link: https://lore.kernel.org/r/20200611030559.75257-1-aik@ozlabs.ru
(cherry picked from commit e881bfaf5a5f409390973e076333281465f2b0d9)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/powerpc/kvm/book3s_hv_nested.c
diff --cc arch/powerpc/kvm/book3s_hv_nested.c
index 1cc2fc090b46,75993f44519b..000000000000
--- a/arch/powerpc/kvm/book3s_hv_nested.c
+++ b/arch/powerpc/kvm/book3s_hv_nested.c
@@@ -1234,8 -1233,8 +1234,13 @@@ static long kvmhv_handle_nested_set_rc(
  	}
  
  	/* Set the rc bit in the pte of the shadow_pgtable for the nest guest */
++<<<<<<< HEAD
 +	ret = kvmppc_hv_handle_set_rc(kvm, gp->shadow_pgtable, writing, n_gpa,
 +				      gp->shadow_lpid);
++=======
+ 	ret = kvmppc_hv_handle_set_rc(kvm, true, writing,
+ 				      n_gpa, gp->l1_lpid);
++>>>>>>> e881bfaf5a5f (KVM: PPC: Fix nested guest RC bits update)
  	if (!ret)
  		ret = -EINVAL;
  	else
* Unmerged path arch/powerpc/kvm/book3s_hv_nested.c
