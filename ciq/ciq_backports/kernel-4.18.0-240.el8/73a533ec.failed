mlxsw: core: Enable devlink reload only on probe

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-240.el8
commit-author Jiri Pirko <jiri@mellanox.com>
commit 73a533ecf0af5f73ff72dd7c96d1c8598ca93649
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-240.el8/73a533ec.failed

Call devlink enable only during probe time and avoid deadlock
during reload.

	Reported-by: Shalom Toledo <shalomt@mellanox.com>
Fixes: 5a508a254bed ("devlink: disallow reload operation during device cleanup")
	Signed-off-by: Jiri Pirko <jiri@mellanox.com>
	Tested-by: Shalom Toledo <shalomt@mellanox.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 73a533ecf0af5f73ff72dd7c96d1c8598ca93649)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/mellanox/mlxsw/core.c
diff --cc drivers/net/ethernet/mellanox/mlxsw/core.c
index 57ec00573603,0a0884d86d44..000000000000
--- a/drivers/net/ethernet/mellanox/mlxsw/core.c
+++ b/drivers/net/ethernet/mellanox/mlxsw/core.c
@@@ -1198,6 -1188,9 +1198,12 @@@ __mlxsw_core_bus_device_register(const 
  
  	if (mlxsw_driver->params_register)
  		devlink_params_publish(devlink);
++<<<<<<< HEAD
++=======
+ 
+ 	if (!reload)
+ 		devlink_reload_enable(devlink);
++>>>>>>> 73a533ecf0af (mlxsw: core: Enable devlink reload only on probe)
  
  	return 0;
  
* Unmerged path drivers/net/ethernet/mellanox/mlxsw/core.c
