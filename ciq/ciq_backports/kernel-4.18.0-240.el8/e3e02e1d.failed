selftests/bpf: test_progs: convert test_sockopt_inherit

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-240.el8
commit-author Stanislav Fomichev <sdf@google.com>
commit e3e02e1d9c24b0c3a36f9c854ae80e61fd62b2a9
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-240.el8/e3e02e1d.failed

Move the files, adjust includes, remove entry from Makefile & .gitignore

I also added pthread_cond_wait for the server thread startup. We don't
want to connect to the server that's not yet up (for some reason
this existing race is now more prominent with test_progs).

	Signed-off-by: Stanislav Fomichev <sdf@google.com>
	Signed-off-by: Alexei Starovoitov <ast@kernel.org>
(cherry picked from commit e3e02e1d9c24b0c3a36f9c854ae80e61fd62b2a9)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	tools/testing/selftests/bpf/.gitignore
#	tools/testing/selftests/bpf/Makefile
#	tools/testing/selftests/bpf/prog_tests/sockopt_inherit.c
diff --cc tools/testing/selftests/bpf/.gitignore
index 159e0044042b,5b06bb45b500..000000000000
--- a/tools/testing/selftests/bpf/.gitignore
+++ b/tools/testing/selftests/bpf/.gitignore
@@@ -22,5 -22,21 +22,23 @@@ test_lirc_mode2_use
  get_cgroup_id_user
  test_skb_cgroup_id_user
  test_socket_cookie
 -test_cgroup_attach
  test_cgroup_storage
  test_select_reuseport
++<<<<<<< HEAD
++=======
+ test_flow_dissector
+ flow_dissector_load
+ test_netcnt
+ test_section_names
+ test_tcpnotify_user
+ test_libbpf
+ test_tcp_check_syncookie_user
+ test_sysctl
+ alu32
+ libbpf.pc
+ libbpf.so.*
+ test_hashmap
+ test_btf_dump
+ xdping
+ test_tcp_rtt
++>>>>>>> e3e02e1d9c24 (selftests/bpf: test_progs: convert test_sockopt_inherit)
diff --cc tools/testing/selftests/bpf/Makefile
index 4b1fee746c30,4d9a0304a011..000000000000
--- a/tools/testing/selftests/bpf/Makefile
+++ b/tools/testing/selftests/bpf/Makefile
@@@ -29,8 -28,7 +29,12 @@@ TEST_GEN_PROGS = test_verifier test_ta
  	test_sock test_btf test_sockmap get_cgroup_id_user test_socket_cookie \
  	test_cgroup_storage test_select_reuseport test_section_names \
  	test_netcnt test_tcpnotify_user test_sock_fields test_sysctl test_hashmap \
++<<<<<<< HEAD
 +	test_btf_dump test_cgroup_attach test_sockopt test_sockopt_sk \
 +	test_sockopt_multi test_tcp_rtt
++=======
+ 	test_btf_dump test_cgroup_attach xdping test_tcp_rtt
++>>>>>>> e3e02e1d9c24 (selftests/bpf: test_progs: convert test_sockopt_inherit)
  
  BPF_OBJ_FILES = $(patsubst %.c,%.o, $(notdir $(wildcard progs/*.c)))
  TEST_GEN_FILES = $(BPF_OBJ_FILES)
@@@ -118,9 -112,6 +122,12 @@@ $(OUTPUT)/test_netcnt: cgroup_helpers.
  $(OUTPUT)/test_sock_fields: cgroup_helpers.c
  $(OUTPUT)/test_sysctl: cgroup_helpers.c
  $(OUTPUT)/test_cgroup_attach: cgroup_helpers.c
++<<<<<<< HEAD
 +$(OUTPUT)/test_sockopt: cgroup_helpers.c
 +$(OUTPUT)/test_sockopt_sk: cgroup_helpers.c
 +$(OUTPUT)/test_sockopt_multi: cgroup_helpers.c
++=======
++>>>>>>> e3e02e1d9c24 (selftests/bpf: test_progs: convert test_sockopt_inherit)
  $(OUTPUT)/test_tcp_rtt: cgroup_helpers.c
  
  .PHONY: force
* Unmerged path tools/testing/selftests/bpf/prog_tests/sockopt_inherit.c
* Unmerged path tools/testing/selftests/bpf/.gitignore
* Unmerged path tools/testing/selftests/bpf/Makefile
* Unmerged path tools/testing/selftests/bpf/prog_tests/sockopt_inherit.c
