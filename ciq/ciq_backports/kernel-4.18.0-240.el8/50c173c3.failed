mlxsw: spectrum_router: Take router lock from exported helpers

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-240.el8
commit-author Ido Schimmel <idosch@mellanox.com>
commit 50c173c3a1810d3441aaa074c3ba452238cad60a
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-240.el8/50c173c3.failed

The routing code exports some helper functions that can be called from
other driver modules such as the bridge. These helpers are never called
with the router lock already held and therefore need to take it in order
to serialize access to shared router structures.

	Signed-off-by: Ido Schimmel <idosch@mellanox.com>
	Acked-by: Jiri Pirko <jiri@mellanox.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 50c173c3a1810d3441aaa074c3ba452238cad60a)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/mellanox/mlxsw/spectrum_router.c
diff --cc drivers/net/ethernet/mellanox/mlxsw/spectrum_router.c
index c468bc58986a,0f5ecb47d0c2..000000000000
--- a/drivers/net/ethernet/mellanox/mlxsw/spectrum_router.c
+++ b/drivers/net/ethernet/mellanox/mlxsw/spectrum_router.c
@@@ -6818,6 -6748,16 +6844,19 @@@ mlxsw_sp_port_vlan_router_leave(struct 
  	mlxsw_sp_rif_subport_put(rif);
  }
  
++<<<<<<< HEAD
++=======
+ void
+ mlxsw_sp_port_vlan_router_leave(struct mlxsw_sp_port_vlan *mlxsw_sp_port_vlan)
+ {
+ 	struct mlxsw_sp *mlxsw_sp = mlxsw_sp_port_vlan->mlxsw_sp_port->mlxsw_sp;
+ 
+ 	mutex_lock(&mlxsw_sp->router->lock);
+ 	__mlxsw_sp_port_vlan_router_leave(mlxsw_sp_port_vlan);
+ 	mutex_unlock(&mlxsw_sp->router->lock);
+ }
+ 
++>>>>>>> 50c173c3a181 (mlxsw: spectrum_router: Take router lock from exported helpers)
  static int mlxsw_sp_inetaddr_port_vlan_event(struct net_device *l3_dev,
  					     struct net_device *port_dev,
  					     unsigned long event, u16 vid,
* Unmerged path drivers/net/ethernet/mellanox/mlxsw/spectrum_router.c
