bluetooth: bcm: Add support for loading firmware for BCM4345C5

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-240.el8
commit-author Ondrej Jirman <megous@megous.com>
commit 52c8c7a766ecc49ff2e4c1db30b0a24a019e31d4
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-240.el8/52c8c7a7.failed

Detect BCM4345C5 and load a corresponding firmware file.

	Signed-off-by: Ondrej Jirman <megous@megous.com>
	Signed-off-by: Marcel Holtmann <marcel@holtmann.org>
(cherry picked from commit 52c8c7a766ecc49ff2e4c1db30b0a24a019e31d4)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/bluetooth/btbcm.c
#	drivers/bluetooth/hci_bcm.c
diff --cc drivers/bluetooth/btbcm.c
index 99cde1f9467d,2d2e6d862068..000000000000
--- a/drivers/bluetooth/btbcm.c
+++ b/drivers/bluetooth/btbcm.c
@@@ -33,8 -18,13 +33,13 @@@
  #define VERSION "0.1"
  
  #define BDADDR_BCM20702A0 (&(bdaddr_t) {{0x00, 0xa0, 0x02, 0x70, 0x20, 0x00}})
 -#define BDADDR_BCM20702A1 (&(bdaddr_t) {{0x00, 0x00, 0xa0, 0x02, 0x70, 0x20}})
 -#define BDADDR_BCM2076B1 (&(bdaddr_t) {{0x79, 0x56, 0x00, 0xa0, 0x76, 0x20}})
 -#define BDADDR_BCM43430A0 (&(bdaddr_t) {{0xac, 0x1f, 0x12, 0xa0, 0x43, 0x43}})
  #define BDADDR_BCM4324B3 (&(bdaddr_t) {{0x00, 0x00, 0x00, 0xb3, 0x24, 0x43}})
  #define BDADDR_BCM4330B1 (&(bdaddr_t) {{0x00, 0x00, 0x00, 0xb1, 0x30, 0x43}})
++<<<<<<< HEAD
++=======
+ #define BDADDR_BCM4345C5 (&(bdaddr_t) {{0xac, 0x1f, 0x00, 0xc5, 0x45, 0x43}})
+ #define BDADDR_BCM43341B (&(bdaddr_t) {{0xac, 0x1f, 0x00, 0x1b, 0x34, 0x43}})
++>>>>>>> 52c8c7a766ec (bluetooth: bcm: Add support for loading firmware for BCM4345C5)
  
  int btbcm_check_bdaddr(struct hci_dev *hdev)
  {
@@@ -69,10 -65,18 +74,17 @@@
  	 *
  	 * The address 43:30:B1:00:00:00 indicates a BCM4330B1 controller
  	 * with waiting for configuration state.
 -	 *
 -	 * The address 43:43:A0:12:1F:AC indicates a BCM43430A0 controller
 -	 * with no configured address.
  	 */
  	if (!bacmp(&bda->bdaddr, BDADDR_BCM20702A0) ||
 -	    !bacmp(&bda->bdaddr, BDADDR_BCM20702A1) ||
 -	    !bacmp(&bda->bdaddr, BDADDR_BCM2076B1) ||
  	    !bacmp(&bda->bdaddr, BDADDR_BCM4324B3) ||
++<<<<<<< HEAD
 +	    !bacmp(&bda->bdaddr, BDADDR_BCM4330B1)) {
++=======
+ 	    !bacmp(&bda->bdaddr, BDADDR_BCM4330B1) ||
+ 	    !bacmp(&bda->bdaddr, BDADDR_BCM4345C5) ||
+ 	    !bacmp(&bda->bdaddr, BDADDR_BCM43430A0) ||
+ 	    !bacmp(&bda->bdaddr, BDADDR_BCM43341B)) {
++>>>>>>> 52c8c7a766ec (bluetooth: bcm: Add support for loading firmware for BCM4345C5)
  		bt_dev_info(hdev, "BCM: Using default device address (%pMR)",
  			    &bda->bdaddr);
  		set_bit(HCI_QUIRK_INVALID_BDADDR, &hdev->quirks);
@@@ -328,7 -334,11 +340,8 @@@ static const struct bcm_subver_table bc
  	{ 0x2122, "BCM4343A0"	},	/* 001.001.034 */
  	{ 0x2209, "BCM43430A1"  },	/* 001.002.009 */
  	{ 0x6119, "BCM4345C0"	},	/* 003.001.025 */
+ 	{ 0x6606, "BCM4345C5"	},	/* 003.006.006 */
  	{ 0x230f, "BCM4356A2"	},	/* 001.003.015 */
 -	{ 0x220e, "BCM20702A1"  },	/* 001.002.014 */
 -	{ 0x4217, "BCM4329B1"   },	/* 002.002.023 */
 -	{ 0x6106, "BCM4359C0"	},	/* 003.001.006 */
  	{ }
  };
  
diff --cc drivers/bluetooth/hci_bcm.c
index 25f16d67c597,95c312ae94cf..000000000000
--- a/drivers/bluetooth/hci_bcm.c
+++ b/drivers/bluetooth/hci_bcm.c
@@@ -1317,6 -1418,9 +1317,12 @@@ static void bcm_serdev_remove(struct se
  
  #ifdef CONFIG_OF
  static const struct of_device_id bcm_bluetooth_of_match[] = {
++<<<<<<< HEAD
++=======
+ 	{ .compatible = "brcm,bcm20702a1" },
+ 	{ .compatible = "brcm,bcm4345c5" },
+ 	{ .compatible = "brcm,bcm4330-bt" },
++>>>>>>> 52c8c7a766ec (bluetooth: bcm: Add support for loading firmware for BCM4345C5)
  	{ .compatible = "brcm,bcm43438-bt" },
  	{ },
  };
* Unmerged path drivers/bluetooth/btbcm.c
* Unmerged path drivers/bluetooth/hci_bcm.c
