perf annotate: Align struct annotate_args

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-240.el8
commit-author Ravi Bangoria <ravi.bangoria@linux.ibm.com>
commit d3c03147bf8019bda821334428e0ba31ce4fb425
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-240.el8/d3c03147.failed

Align fields of struct annotate_args.

	Signed-off-by: Ravi Bangoria <ravi.bangoria@linux.ibm.com>
	Acked-by: Jiri Olsa <jolsa@redhat.com>
	Cc: Ian Rogers <irogers@google.com>
	Cc: Jin Yao <yao.jin@linux.intel.com>
	Cc: Namhyung Kim <namhyung@kernel.org>
	Cc: Song Liu <songliubraving@fb.com>
Link: http://lore.kernel.org/lkml/20200204045233.474937-4-ravi.bangoria@linux.ibm.com
	Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>
(cherry picked from commit d3c03147bf8019bda821334428e0ba31ce4fb425)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	tools/perf/util/annotate.c
diff --cc tools/perf/util/annotate.c
index b06815227267,c816e5840166..000000000000
--- a/tools/perf/util/annotate.c
+++ b/tools/perf/util/annotate.c
@@@ -1140,60 -1143,36 +1140,66 @@@ out
  }
  
  struct annotate_args {
++<<<<<<< HEAD
 +	size_t			 privsize;
 +	struct arch		*arch;
 +	struct map_symbol	 ms;
 +	struct perf_evsel	*evsel;
++=======
+ 	struct arch		  *arch;
+ 	struct map_symbol	  ms;
+ 	struct evsel		  *evsel;
++>>>>>>> d3c03147bf80 (perf annotate: Align struct annotate_args)
  	struct annotation_options *options;
- 	s64			 offset;
- 	char			*line;
- 	int			 line_nr;
+ 	s64			  offset;
+ 	char			  *line;
+ 	int			  line_nr;
  };
  
 -static void annotation_line__init(struct annotation_line *al,
 -				  struct annotate_args *args,
 -				  int nr)
 +static void annotation_line__delete(struct annotation_line *al)
  {
 -	al->offset = args->offset;
 -	al->line = strdup(args->line);
 -	al->line_nr = args->line_nr;
 -	al->data_nr = nr;
 -}
 +	void *ptr = (void *) al - al->privsize;
  
 -static void annotation_line__exit(struct annotation_line *al)
 -{
  	free_srcline(al->path);
  	zfree(&al->line);
 +	free(ptr);
  }
  
 -static size_t disasm_line_size(int nr)
 +/*
 + * Allocating the annotation line data with following
 + * structure:
 + *
 + *    --------------------------------------
 + *    private space | struct annotation_line
 + *    --------------------------------------
 + *
 + * Size of the private space is stored in 'struct annotation_line'.
 + *
 + */
 +static struct annotation_line *
 +annotation_line__new(struct annotate_args *args, size_t privsize)
  {
  	struct annotation_line *al;
 +	struct perf_evsel *evsel = args->evsel;
 +	size_t size = privsize + sizeof(*al);
 +	int nr = 1;
 +
 +	if (perf_evsel__is_group_event(evsel))
 +		nr = evsel->nr_members;
 +
 +	size += sizeof(al->data[0]) * nr;
 +
 +	al = zalloc(size);
 +	if (al) {
 +		al = (void *) al + privsize;
 +		al->privsize   = privsize;
 +		al->offset     = args->offset;
 +		al->line       = strdup(args->line);
 +		al->line_nr    = args->line_nr;
 +		al->data_nr    = nr;
 +	}
  
 -	return (sizeof(struct disasm_line) + (sizeof(al->data[0]) * nr));
 +	return al;
  }
  
  /*
* Unmerged path tools/perf/util/annotate.c
