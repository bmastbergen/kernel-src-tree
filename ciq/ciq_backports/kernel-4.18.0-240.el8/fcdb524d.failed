powerpc/kernel/sysfs: Refactor current sysfs.c

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-240.el8
commit-author Madhavan Srinivasan <maddy@linux.ibm.com>
commit fcdb524d440d6326c286006e16f252b40ba4fd6a
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-240.el8/fcdb524d.failed

An attempt to refactor the current sysfs.c file.
To start with a big chuck of macro #defines and dscr
functions are moved to start of the file. Secondly,
HAS_ #define macros are cleanup based on CONFIG_ options

Finally new HAS_ macro added:
1. HAS_PPC_PA6T (for PA6T) to separate out non-PMU SPRs.
2. HAS_PPC_PMC56 to separate out PMC SPR's from HAS_PPC_PMC_CLASSIC
   which come under CONFIG_PPC64.

	Signed-off-by: Madhavan Srinivasan <maddy@linux.ibm.com>
	Signed-off-by: Michael Ellerman <mpe@ellerman.id.au>
Link: https://lore.kernel.org/r/20200214080606.26872-1-kjain@linux.ibm.com
(cherry picked from commit fcdb524d440d6326c286006e16f252b40ba4fd6a)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/powerpc/kernel/sysfs.c
diff --cc arch/powerpc/kernel/sysfs.c
index ca768395f4a2,74da5ebf088e..000000000000
--- a/arch/powerpc/kernel/sysfs.c
+++ b/arch/powerpc/kernel/sysfs.c
@@@ -454,29 -562,9 +561,32 @@@ EXPORT_SYMBOL(ppc_enable_pmcs)
   * that are implemented on the current processor
   */
  
- #if defined(CONFIG_PPC64)
+ #if defined(CONFIG_PPC64) || defined(CONFIG_PPC_BOOK3S_32)
  #define HAS_PPC_PMC_CLASSIC	1
  #define HAS_PPC_PMC_IBM		1
++<<<<<<< HEAD
 +#define HAS_PPC_PMC_PA6T	1
 +#elif defined(CONFIG_6xx)
 +#define HAS_PPC_PMC_CLASSIC	1
 +#define HAS_PPC_PMC_IBM		1
 +#define HAS_PPC_PMC_G4		1
 +#endif
 +
 +
 +#ifdef HAS_PPC_PMC_CLASSIC
 +SYSFS_PMCSETUP(mmcr0, SPRN_MMCR0);
 +SYSFS_PMCSETUP(mmcr1, SPRN_MMCR1);
 +SYSFS_PMCSETUP(pmc1, SPRN_PMC1);
 +SYSFS_PMCSETUP(pmc2, SPRN_PMC2);
 +SYSFS_PMCSETUP(pmc3, SPRN_PMC3);
 +SYSFS_PMCSETUP(pmc4, SPRN_PMC4);
 +SYSFS_PMCSETUP(pmc5, SPRN_PMC5);
 +SYSFS_PMCSETUP(pmc6, SPRN_PMC6);
 +
 +#ifdef HAS_PPC_PMC_G4
 +SYSFS_PMCSETUP(mmcr2, SPRN_MMCR2);
++=======
++>>>>>>> fcdb524d440d (powerpc/kernel/sysfs: Refactor current sysfs.c)
  #endif
  
  #ifdef CONFIG_PPC64
@@@ -611,7 -633,9 +655,13 @@@ SYSFS_PMCSETUP(pa6t_pmc2, SPRN_PA6T_PMC
  SYSFS_PMCSETUP(pa6t_pmc3, SPRN_PA6T_PMC3);
  SYSFS_PMCSETUP(pa6t_pmc4, SPRN_PA6T_PMC4);
  SYSFS_PMCSETUP(pa6t_pmc5, SPRN_PA6T_PMC5);
++<<<<<<< HEAD
 +#ifdef CONFIG_DEBUG_KERNEL
++=======
+ #endif
+ 
+ #ifdef HAS_PPC_PA6T
++>>>>>>> fcdb524d440d (powerpc/kernel/sysfs: Refactor current sysfs.c)
  SYSFS_SPRSETUP(hid0, SPRN_HID0);
  SYSFS_SPRSETUP(hid1, SPRN_HID1);
  SYSFS_SPRSETUP(hid4, SPRN_HID4);
@@@ -640,8 -664,7 +690,12 @@@ SYSFS_SPRSETUP(tsr0, SPRN_PA6T_TSR0)
  SYSFS_SPRSETUP(tsr1, SPRN_PA6T_TSR1);
  SYSFS_SPRSETUP(tsr2, SPRN_PA6T_TSR2);
  SYSFS_SPRSETUP(tsr3, SPRN_PA6T_TSR3);
++<<<<<<< HEAD
 +#endif /* CONFIG_DEBUG_KERNEL */
 +#endif /* HAS_PPC_PMC_PA6T */
++=======
+ #endif /* HAS_PPC_PA6T */
++>>>>>>> fcdb524d440d (powerpc/kernel/sysfs: Refactor current sysfs.c)
  
  #ifdef HAS_PPC_PMC_IBM
  static struct device_attribute ibm_common_attrs[] = {
@@@ -681,7 -707,8 +738,12 @@@ static struct device_attribute pa6t_att
  	__ATTR(pmc3, 0600, show_pa6t_pmc3, store_pa6t_pmc3),
  	__ATTR(pmc4, 0600, show_pa6t_pmc4, store_pa6t_pmc4),
  	__ATTR(pmc5, 0600, show_pa6t_pmc5, store_pa6t_pmc5),
++<<<<<<< HEAD
 +#ifdef CONFIG_DEBUG_KERNEL
++=======
+ #endif
+ #ifdef HAS_PPC_PA6T
++>>>>>>> fcdb524d440d (powerpc/kernel/sysfs: Refactor current sysfs.c)
  	__ATTR(hid0, 0600, show_hid0, store_hid0),
  	__ATTR(hid1, 0600, show_hid1, store_hid1),
  	__ATTR(hid4, 0600, show_hid4, store_hid4),
@@@ -710,10 -737,9 +772,13 @@@
  	__ATTR(tsr1, 0600, show_tsr1, store_tsr1),
  	__ATTR(tsr2, 0600, show_tsr2, store_tsr2),
  	__ATTR(tsr3, 0600, show_tsr3, store_tsr3),
++<<<<<<< HEAD
 +#endif /* CONFIG_DEBUG_KERNEL */
++=======
+ #endif /* HAS_PPC_PA6T */
++>>>>>>> fcdb524d440d (powerpc/kernel/sysfs: Refactor current sysfs.c)
  };
- #endif /* HAS_PPC_PMC_PA6T */
- #endif /* HAS_PPC_PMC_CLASSIC */
+ #endif
  
  #ifdef CONFIG_PPC_SVM
  static ssize_t show_svm(struct device *dev, struct device_attribute *attr, char *buf)
* Unmerged path arch/powerpc/kernel/sysfs.c
