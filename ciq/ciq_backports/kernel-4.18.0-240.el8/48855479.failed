flow_offload: introduce "delayed" HW stats type and allow it in mlx5

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-240.el8
commit-author Jiri Pirko <jiri@mellanox.com>
commit 48855479510be1f8769cb13174f29dd8a44b4256
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-240.el8/48855479.failed

Introduce new type for delayed HW stats and allow the value in
mlx5 offload.

	Signed-off-by: Jiri Pirko <jiri@mellanox.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 48855479510be1f8769cb13174f29dd8a44b4256)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/mellanox/mlx5/core/en_tc.c
diff --cc drivers/net/ethernet/mellanox/mlx5/core/en_tc.c
index 123069223147,cdc63dd59867..000000000000
--- a/drivers/net/ethernet/mellanox/mlx5/core/en_tc.c
+++ b/drivers/net/ethernet/mellanox/mlx5/core/en_tc.c
@@@ -2865,6 -2878,10 +2865,13 @@@ static int parse_tc_nic_actions(struct 
  	if (!flow_action_has_entries(flow_action))
  		return -EINVAL;
  
++<<<<<<< HEAD
++=======
+ 	if (!flow_action_hw_stats_types_check(flow_action, extack,
+ 					      FLOW_ACTION_HW_STATS_TYPE_DELAYED))
+ 		return -EOPNOTSUPP;
+ 
++>>>>>>> 48855479510b (flow_offload: introduce "delayed" HW stats type and allow it in mlx5)
  	attr->flow_tag = MLX5_FS_DEFAULT_FLOW_TAG;
  
  	flow_action_for_each(i, act, flow_action) {
@@@ -3270,6 -3334,10 +3277,13 @@@ static int parse_tc_fdb_actions(struct 
  	if (!flow_action_has_entries(flow_action))
  		return -EINVAL;
  
++<<<<<<< HEAD
++=======
+ 	if (!flow_action_hw_stats_types_check(flow_action, extack,
+ 					      FLOW_ACTION_HW_STATS_TYPE_DELAYED))
+ 		return -EOPNOTSUPP;
+ 
++>>>>>>> 48855479510b (flow_offload: introduce "delayed" HW stats type and allow it in mlx5)
  	flow_action_for_each(i, act, flow_action) {
  		switch (act->id) {
  		case FLOW_ACTION_DROP:
* Unmerged path drivers/net/ethernet/mellanox/mlx5/core/en_tc.c
diff --git a/include/net/flow_offload.h b/include/net/flow_offload.h
index 26b427dff50f..786e65ae7031 100644
--- a/include/net/flow_offload.h
+++ b/include/net/flow_offload.h
@@ -160,7 +160,9 @@ enum flow_action_mangle_base {
 };
 
 #define FLOW_ACTION_HW_STATS_TYPE_IMMEDIATE BIT(0)
-#define FLOW_ACTION_HW_STATS_TYPE_ANY FLOW_ACTION_HW_STATS_TYPE_IMMEDIATE
+#define FLOW_ACTION_HW_STATS_TYPE_DELAYED BIT(1)
+#define FLOW_ACTION_HW_STATS_TYPE_ANY (FLOW_ACTION_HW_STATS_TYPE_IMMEDIATE | \
+				       FLOW_ACTION_HW_STATS_TYPE_DELAYED)
 
 typedef void (*action_destr)(void *priv);
 
