netfilter: nf_tables: flow event notifier must use transaction mutex

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-240.el8
commit-author Florian Westphal <fw@strlen.de>
commit 9e619d87b277bbcc4e0b64cc5963520c1cd99f18
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-240.el8/9e619d87.failed

Fixes: f102d66b335a4 ("netfilter: nf_tables: use dedicated mutex to guard transactions")
	Signed-off-by: Florian Westphal <fw@strlen.de>
	Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
(cherry picked from commit 9e619d87b277bbcc4e0b64cc5963520c1cd99f18)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/netfilter/nf_tables_api.c
diff --cc net/netfilter/nf_tables_api.c
index 6c3c56b8f3d5,06d6af067619..000000000000
--- a/net/netfilter/nf_tables_api.c
+++ b/net/netfilter/nf_tables_api.c
@@@ -6165,15 -5936,18 +6165,28 @@@ static int nf_tables_flowtable_event(st
  	if (event != NETDEV_UNREGISTER)
  		return 0;
  
++<<<<<<< HEAD
 +	net = dev_net(dev);
 +	nfnl_lock(NFNL_SUBSYS_NFTABLES);
++=======
+ 	net = maybe_get_net(dev_net(dev));
+ 	if (!net)
+ 		return 0;
+ 
+ 	mutex_lock(&net->nft.commit_mutex);
++>>>>>>> 9e619d87b277 (netfilter: nf_tables: flow event notifier must use transaction mutex)
  	list_for_each_entry(table, &net->nft.tables, list) {
  		list_for_each_entry(flowtable, &table->flowtables, list) {
  			nft_flowtable_event(event, dev, flowtable);
  		}
  	}
++<<<<<<< HEAD
 +	nfnl_unlock(NFNL_SUBSYS_NFTABLES);
 +
++=======
+ 	mutex_unlock(&net->nft.commit_mutex);
+ 	put_net(net);
++>>>>>>> 9e619d87b277 (netfilter: nf_tables: flow event notifier must use transaction mutex)
  	return NOTIFY_DONE;
  }
  
* Unmerged path net/netfilter/nf_tables_api.c
