gpiolib: move validation of line handle flags into helper function

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-240.el8
commit-author Kent Gibson <warthog618@gmail.com>
commit b043ed7ef0b358d7f32dc57c218f925fd2802aba
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-240.el8/b043ed7e.failed

Move validation of line handle flags into helper function.
This reduces the size and complexity of linehandle_create and allows the
validation to be reused elsewhere.

	Signed-off-by: Kent Gibson <warthog618@gmail.com>
	Signed-off-by: Bartosz Golaszewski <bgolaszewski@baylibre.com>
(cherry picked from commit b043ed7ef0b358d7f32dc57c218f925fd2802aba)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/gpio/gpiolib.c
diff --cc drivers/gpio/gpiolib.c
index 07b822ae02a4,a9826627f347..000000000000
--- a/drivers/gpio/gpiolib.c
+++ b/drivers/gpio/gpiolib.c
@@@ -533,32 -577,9 +581,38 @@@ static int linehandle_create(struct gpi
  
  	lflags = handlereq.flags;
  
++<<<<<<< HEAD
 +	/* Return an error if an unknown flag is set */
 +	if (lflags & ~GPIOHANDLE_REQUEST_VALID_FLAGS)
 +		return -EINVAL;
 +
 +	/*
 +	 * Do not allow both INPUT & OUTPUT flags to be set as they are
 +	 * contradictory.
 +	 */
 +	if ((lflags & GPIOHANDLE_REQUEST_INPUT) &&
 +	    (lflags & GPIOHANDLE_REQUEST_OUTPUT))
 +		return -EINVAL;
 +
 +	/*
 +	 * Do not allow OPEN_SOURCE & OPEN_DRAIN flags in a single request. If
 +	 * the hardware actually supports enabling both at the same time the
 +	 * electrical result would be disastrous.
 +	 */
 +	if ((lflags & GPIOHANDLE_REQUEST_OPEN_DRAIN) &&
 +	    (lflags & GPIOHANDLE_REQUEST_OPEN_SOURCE))
 +		return -EINVAL;
 +
 +	/* OPEN_DRAIN and OPEN_SOURCE flags only make sense for output mode. */
 +	if (!(lflags & GPIOHANDLE_REQUEST_OUTPUT) &&
 +	    ((lflags & GPIOHANDLE_REQUEST_OPEN_DRAIN) ||
 +	     (lflags & GPIOHANDLE_REQUEST_OPEN_SOURCE)))
 +		return -EINVAL;
++=======
+ 	ret = linehandle_validate_flags(lflags);
+ 	if (ret)
+ 		return ret;
++>>>>>>> b043ed7ef0b3 (gpiolib: move validation of line handle flags into helper function)
  
  	lh = kzalloc(sizeof(*lh), GFP_KERNEL);
  	if (!lh)
* Unmerged path drivers/gpio/gpiolib.c
