usb: don't create dma pools for HCDs with a localmem_pool

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-240.el8
commit-author Christoph Hellwig <hch@lst.de>
commit dd3ecf17ba70a70d2c9ef9ba725281b84f8eef12
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-240.el8/dd3ecf17.failed

If the HCD provides a localmem pool we will never use the DMA pools, so
don't create them.

Fixes: b0310c2f09bb ("USB: use genalloc for USB HCs with local memory")
	Signed-off-by: Christoph Hellwig <hch@lst.de>
Link: https://lore.kernel.org/r/20190811080520.21712-2-hch@lst.de
	Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
(cherry picked from commit dd3ecf17ba70a70d2c9ef9ba725281b84f8eef12)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/usb/core/buffer.c
diff --cc drivers/usb/core/buffer.c
index d2064ad7ad14,1a5b3dcae930..000000000000
--- a/drivers/usb/core/buffer.c
+++ b/drivers/usb/core/buffer.c
@@@ -66,9 -66,9 +66,15 @@@ int hcd_buffer_create(struct usb_hcd *h
  	char		name[16];
  	int		i, size;
  
++<<<<<<< HEAD
 +	if (!IS_ENABLED(CONFIG_HAS_DMA) ||
 +	    (!is_device_dma_capable(hcd->self.sysdev) &&
 +	     !(hcd->driver->flags & HCD_LOCAL_MEM)))
++=======
+ 	if (hcd->localmem_pool ||
+ 	    !IS_ENABLED(CONFIG_HAS_DMA) ||
+ 	    !is_device_dma_capable(hcd->self.sysdev))
++>>>>>>> dd3ecf17ba70 (usb: don't create dma pools for HCDs with a localmem_pool)
  		return 0;
  
  	for (i = 0; i < HCD_BUFFER_POOLS; i++) {
* Unmerged path drivers/usb/core/buffer.c
