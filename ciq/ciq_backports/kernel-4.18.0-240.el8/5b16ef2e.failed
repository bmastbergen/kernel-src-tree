perf/x86/cstate: Add Jasper Lake CPU support

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-240.el8
commit-author Harry Pan <harry.pan@intel.com>
commit 5b16ef2e43ffa1be596652d992235b1cbb244935
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-240.el8/5b16ef2e.failed

The Jasper Lake processor is Tremont microarchitecture, reuse the
glm_cstates table of Goldmont and Goldmont Plus to enable the C-states
residency profiling.

	Signed-off-by: Harry Pan <harry.pan@intel.com>
	Signed-off-by: Borislav Petkov <bp@suse.de>
Link: https://lkml.kernel.org/r/20200402190658.1.Ic02e891daac41303aed1f2fc6c64f6110edd27bd@changeid
(cherry picked from commit 5b16ef2e43ffa1be596652d992235b1cbb244935)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/x86/events/intel/cstate.c
diff --cc arch/x86/events/intel/cstate.c
index 3bd898f59953,442e1ed4acd4..000000000000
--- a/arch/x86/events/intel/cstate.c
+++ b/arch/x86/events/intel/cstate.c
@@@ -577,60 -594,61 +577,69 @@@ static const struct cstate_model glm_cs
  };
  
  
 +#define X86_CSTATES_MODEL(model, states)				\
 +	{ X86_VENDOR_INTEL, 6, model, X86_FEATURE_ANY, (unsigned long) &(states) }
 +
  static const struct x86_cpu_id intel_cstates_match[] __initconst = {
 -	X86_MATCH_INTEL_FAM6_MODEL(NEHALEM,		&nhm_cstates),
 -	X86_MATCH_INTEL_FAM6_MODEL(NEHALEM_EP,		&nhm_cstates),
 -	X86_MATCH_INTEL_FAM6_MODEL(NEHALEM_EX,		&nhm_cstates),
 +	X86_CSTATES_MODEL(INTEL_FAM6_NEHALEM,    nhm_cstates),
 +	X86_CSTATES_MODEL(INTEL_FAM6_NEHALEM_EP, nhm_cstates),
 +	X86_CSTATES_MODEL(INTEL_FAM6_NEHALEM_EX, nhm_cstates),
  
 -	X86_MATCH_INTEL_FAM6_MODEL(WESTMERE,		&nhm_cstates),
 -	X86_MATCH_INTEL_FAM6_MODEL(WESTMERE_EP,		&nhm_cstates),
 -	X86_MATCH_INTEL_FAM6_MODEL(WESTMERE_EX,		&nhm_cstates),
 +	X86_CSTATES_MODEL(INTEL_FAM6_WESTMERE,    nhm_cstates),
 +	X86_CSTATES_MODEL(INTEL_FAM6_WESTMERE_EP, nhm_cstates),
 +	X86_CSTATES_MODEL(INTEL_FAM6_WESTMERE_EX, nhm_cstates),
  
 -	X86_MATCH_INTEL_FAM6_MODEL(SANDYBRIDGE,		&snb_cstates),
 -	X86_MATCH_INTEL_FAM6_MODEL(SANDYBRIDGE_X,	&snb_cstates),
 +	X86_CSTATES_MODEL(INTEL_FAM6_SANDYBRIDGE,   snb_cstates),
 +	X86_CSTATES_MODEL(INTEL_FAM6_SANDYBRIDGE_X, snb_cstates),
  
 -	X86_MATCH_INTEL_FAM6_MODEL(IVYBRIDGE,		&snb_cstates),
 -	X86_MATCH_INTEL_FAM6_MODEL(IVYBRIDGE_X,		&snb_cstates),
 +	X86_CSTATES_MODEL(INTEL_FAM6_IVYBRIDGE,   snb_cstates),
 +	X86_CSTATES_MODEL(INTEL_FAM6_IVYBRIDGE_X, snb_cstates),
  
 -	X86_MATCH_INTEL_FAM6_MODEL(HASWELL,		&snb_cstates),
 -	X86_MATCH_INTEL_FAM6_MODEL(HASWELL_X,		&snb_cstates),
 -	X86_MATCH_INTEL_FAM6_MODEL(HASWELL_G,		&snb_cstates),
 +	X86_CSTATES_MODEL(INTEL_FAM6_HASWELL, snb_cstates),
 +	X86_CSTATES_MODEL(INTEL_FAM6_HASWELL_X,	   snb_cstates),
 +	X86_CSTATES_MODEL(INTEL_FAM6_HASWELL_G, snb_cstates),
  
 -	X86_MATCH_INTEL_FAM6_MODEL(HASWELL_L,		&hswult_cstates),
 +	X86_CSTATES_MODEL(INTEL_FAM6_HASWELL_L, hswult_cstates),
  
 -	X86_MATCH_INTEL_FAM6_MODEL(ATOM_SILVERMONT,	&slm_cstates),
 -	X86_MATCH_INTEL_FAM6_MODEL(ATOM_SILVERMONT_D,	&slm_cstates),
 -	X86_MATCH_INTEL_FAM6_MODEL(ATOM_AIRMONT,	&slm_cstates),
 +	X86_CSTATES_MODEL(INTEL_FAM6_ATOM_SILVERMONT, slm_cstates),
 +	X86_CSTATES_MODEL(INTEL_FAM6_ATOM_SILVERMONT_D, slm_cstates),
 +	X86_CSTATES_MODEL(INTEL_FAM6_ATOM_AIRMONT,     slm_cstates),
  
 -	X86_MATCH_INTEL_FAM6_MODEL(BROADWELL,		&snb_cstates),
 -	X86_MATCH_INTEL_FAM6_MODEL(BROADWELL_D,		&snb_cstates),
 -	X86_MATCH_INTEL_FAM6_MODEL(BROADWELL_G,		&snb_cstates),
 -	X86_MATCH_INTEL_FAM6_MODEL(BROADWELL_X,		&snb_cstates),
 +	X86_CSTATES_MODEL(INTEL_FAM6_BROADWELL,   snb_cstates),
 +	X86_CSTATES_MODEL(INTEL_FAM6_BROADWELL_D, snb_cstates),
 +	X86_CSTATES_MODEL(INTEL_FAM6_BROADWELL_G,   snb_cstates),
 +	X86_CSTATES_MODEL(INTEL_FAM6_BROADWELL_X,      snb_cstates),
  
 -	X86_MATCH_INTEL_FAM6_MODEL(SKYLAKE_L,		&snb_cstates),
 -	X86_MATCH_INTEL_FAM6_MODEL(SKYLAKE,		&snb_cstates),
 -	X86_MATCH_INTEL_FAM6_MODEL(SKYLAKE_X,		&snb_cstates),
 +	X86_CSTATES_MODEL(INTEL_FAM6_SKYLAKE_L,  snb_cstates),
 +	X86_CSTATES_MODEL(INTEL_FAM6_SKYLAKE, snb_cstates),
 +	X86_CSTATES_MODEL(INTEL_FAM6_SKYLAKE_X, snb_cstates),
  
 -	X86_MATCH_INTEL_FAM6_MODEL(KABYLAKE_L,		&hswult_cstates),
 -	X86_MATCH_INTEL_FAM6_MODEL(KABYLAKE,		&hswult_cstates),
 -	X86_MATCH_INTEL_FAM6_MODEL(COMETLAKE_L,		&hswult_cstates),
 -	X86_MATCH_INTEL_FAM6_MODEL(COMETLAKE,		&hswult_cstates),
 +	X86_CSTATES_MODEL(INTEL_FAM6_KABYLAKE_L,  hswult_cstates),
 +	X86_CSTATES_MODEL(INTEL_FAM6_KABYLAKE, hswult_cstates),
 +	X86_CSTATES_MODEL(INTEL_FAM6_COMETLAKE_L, hswult_cstates),
 +	X86_CSTATES_MODEL(INTEL_FAM6_COMETLAKE, hswult_cstates),
  
 -	X86_MATCH_INTEL_FAM6_MODEL(CANNONLAKE_L,	&cnl_cstates),
 +	X86_CSTATES_MODEL(INTEL_FAM6_CANNONLAKE_L, cnl_cstates),
  
 -	X86_MATCH_INTEL_FAM6_MODEL(XEON_PHI_KNL,	&knl_cstates),
 -	X86_MATCH_INTEL_FAM6_MODEL(XEON_PHI_KNM,	&knl_cstates),
 +	X86_CSTATES_MODEL(INTEL_FAM6_XEON_PHI_KNL, knl_cstates),
 +	X86_CSTATES_MODEL(INTEL_FAM6_XEON_PHI_KNM, knl_cstates),
  
++<<<<<<< HEAD
 +	X86_CSTATES_MODEL(INTEL_FAM6_ATOM_GOLDMONT, glm_cstates),
 +	X86_CSTATES_MODEL(INTEL_FAM6_ATOM_GOLDMONT_D, glm_cstates),
++=======
+ 	X86_MATCH_INTEL_FAM6_MODEL(ATOM_GOLDMONT,	&glm_cstates),
+ 	X86_MATCH_INTEL_FAM6_MODEL(ATOM_GOLDMONT_D,	&glm_cstates),
+ 	X86_MATCH_INTEL_FAM6_MODEL(ATOM_GOLDMONT_PLUS,	&glm_cstates),
+ 	X86_MATCH_INTEL_FAM6_MODEL(ATOM_TREMONT_D,	&glm_cstates),
+ 	X86_MATCH_INTEL_FAM6_MODEL(ATOM_TREMONT,	&glm_cstates),
+ 	X86_MATCH_INTEL_FAM6_MODEL(ATOM_TREMONT_L,	&glm_cstates),
++>>>>>>> 5b16ef2e43ff (perf/x86/cstate: Add Jasper Lake CPU support)
 +
 +	X86_CSTATES_MODEL(INTEL_FAM6_ATOM_GOLDMONT_PLUS, glm_cstates),
  
 -	X86_MATCH_INTEL_FAM6_MODEL(ICELAKE_L,		&icl_cstates),
 -	X86_MATCH_INTEL_FAM6_MODEL(ICELAKE,		&icl_cstates),
 -	X86_MATCH_INTEL_FAM6_MODEL(TIGERLAKE_L,		&icl_cstates),
 -	X86_MATCH_INTEL_FAM6_MODEL(TIGERLAKE,		&icl_cstates),
 +	X86_CSTATES_MODEL(INTEL_FAM6_ICELAKE_L, snb_cstates),
 +	X86_CSTATES_MODEL(INTEL_FAM6_ICELAKE, snb_cstates),
  	{ },
  };
  MODULE_DEVICE_TABLE(x86cpu, intel_cstates_match);
* Unmerged path arch/x86/events/intel/cstate.c
