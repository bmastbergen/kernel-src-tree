bpf: Do not allow map_freeze in struct_ops map

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-240.el8
commit-author Martin KaFai Lau <kafai@fb.com>
commit 849b4d94582a966ecb533448415462846da1f0fa
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-240.el8/849b4d94.failed

struct_ops map cannot support map_freeze.  Otherwise, a struct_ops
cannot be unregistered from the subsystem.

Fixes: 85d33df357b6 ("bpf: Introduce BPF_MAP_TYPE_STRUCT_OPS")
	Signed-off-by: Martin KaFai Lau <kafai@fb.com>
	Signed-off-by: Alexei Starovoitov <ast@kernel.org>
Link: https://lore.kernel.org/bpf/20200305013454.535397-1-kafai@fb.com
(cherry picked from commit 849b4d94582a966ecb533448415462846da1f0fa)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	kernel/bpf/syscall.c
diff --cc kernel/bpf/syscall.c
index 4aa6a47aa4b8,0c7fb0d4836d..000000000000
--- a/kernel/bpf/syscall.c
+++ b/kernel/bpf/syscall.c
@@@ -1201,6 -1509,18 +1201,21 @@@ static int map_freeze(const union bpf_a
  	map = __bpf_map_get(f);
  	if (IS_ERR(map))
  		return PTR_ERR(map);
++<<<<<<< HEAD
++=======
+ 
+ 	if (map->map_type == BPF_MAP_TYPE_STRUCT_OPS) {
+ 		fdput(f);
+ 		return -ENOTSUPP;
+ 	}
+ 
+ 	mutex_lock(&map->freeze_mutex);
+ 
+ 	if (map->writecnt) {
+ 		err = -EBUSY;
+ 		goto err_put;
+ 	}
++>>>>>>> 849b4d94582a (bpf: Do not allow map_freeze in struct_ops map)
  	if (READ_ONCE(map->frozen)) {
  		err = -EBUSY;
  		goto err_put;
* Unmerged path kernel/bpf/syscall.c
