arm64: kexec_file: add crash dump support

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-240.el8
commit-author AKASHI Takahiro <takahiro.akashi@linaro.org>
commit 3751e728cef2908c15974a5ae44627fd41ef3362
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-240.el8/3751e728.failed

Enabling crash dump (kdump) includes
* prepare contents of ELF header of a core dump file, /proc/vmcore,
  using crash_prepare_elf64_headers(), and
* add two device tree properties, "linux,usable-memory-range" and
  "linux,elfcorehdr", which represent respectively a memory range
  to be used by crash dump kernel and the header's location

	Signed-off-by: AKASHI Takahiro <takahiro.akashi@linaro.org>
	Cc: Catalin Marinas <catalin.marinas@arm.com>
	Cc: Will Deacon <will.deacon@arm.com>
	Reviewed-by: James Morse <james.morse@arm.com>
Tested-and-reviewed-by: Bhupesh Sharma <bhsharma@redhat.com>
	Signed-off-by: Will Deacon <will@kernel.org>
(cherry picked from commit 3751e728cef2908c15974a5ae44627fd41ef3362)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/arm64/kernel/machine_kexec_file.c
diff --cc arch/arm64/kernel/machine_kexec_file.c
index 58871333737a,dd3ae8081b38..000000000000
--- a/arch/arm64/kernel/machine_kexec_file.c
+++ b/arch/arm64/kernel/machine_kexec_file.c
@@@ -110,7 -157,8 +142,12 @@@ out
  }
  
  /*
++<<<<<<< HEAD
 + * More space needed so that we can add initrd, bootargs and kaslr-seed.
++=======
+  * More space needed so that we can add initrd, bootargs, kaslr-seed,
+  * rng-seed, userable-memory-range and elfcorehdr.
++>>>>>>> 3751e728cef2 (arm64: kexec_file: add crash dump support)
   */
  #define DTB_EXTRA_SPACE 0x1000
  
diff --git a/arch/arm64/include/asm/kexec.h b/arch/arm64/include/asm/kexec.h
index 67e4cb75d1fd..660705515e33 100644
--- a/arch/arm64/include/asm/kexec.h
+++ b/arch/arm64/include/asm/kexec.h
@@ -99,6 +99,10 @@ static inline void crash_post_resume(void) {}
 struct kimage_arch {
 	void *dtb;
 	unsigned long dtb_mem;
+	/* Core ELF header buffer */
+	void *elf_headers;
+	unsigned long elf_headers_mem;
+	unsigned long elf_headers_sz;
 };
 
 extern const struct kexec_file_ops kexec_image_ops;
* Unmerged path arch/arm64/kernel/machine_kexec_file.c
