perf stat: Uniquify hybrid event name

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-348.el8
commit-author Jin Yao <yao.jin@linux.intel.com>
commit 12279429d8620fe0cb2cdc0ba68cae3cc2c826f9
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-348.el8/12279429.failed

It would be useful to let user know the pmu which the event belongs to.
perf-stat has supported '--no-merge' option and it can print the pmu
name after the event name, such as:

"cycles [cpu_core]"

Now this option is enabled by default for hybrid platform but change
the format to:

"cpu_core/cycles/"

If user configs the name, we still use the user specified name.

	Signed-off-by: Jin Yao <yao.jin@linux.intel.com>
	Reviewed-by: Jiri Olsa <jolsa@kernel.org>
	Cc: Alexander Shishkin <alexander.shishkin@linux.intel.com>
	Cc: Andi Kleen <ak@linux.intel.com>
	Cc: Ingo Molnar <mingo@redhat.com>
	Cc: Kan Liang <kan.liang@intel.com>
	Cc: Peter Zijlstra <peterz@infradead.org>
ink: https://lore.kernel.org/r/20210427070139.25256-8-yao.jin@linux.intel.com
	Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>
(cherry picked from commit 12279429d8620fe0cb2cdc0ba68cae3cc2c826f9)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	tools/perf/builtin-stat.c
#	tools/perf/util/stat-display.c
diff --cc tools/perf/builtin-stat.c
index 7e16241a3823,835e3696b9ce..000000000000
--- a/tools/perf/builtin-stat.c
+++ b/tools/perf/builtin-stat.c
@@@ -69,6 -68,8 +69,11 @@@
  #include "util/affinity.h"
  #include "util/pfm.h"
  #include "util/bpf_counter.h"
++<<<<<<< HEAD
++=======
+ #include "util/iostat.h"
+ #include "util/pmu-hybrid.h"
++>>>>>>> 12279429d862 (perf stat: Uniquify hybrid event name)
  #include "asm/bug.h"
  
  #include <linux/time64.h>
diff --cc tools/perf/util/stat-display.c
index 5020f4a26857,0679129ad05e..000000000000
--- a/tools/perf/util/stat-display.c
+++ b/tools/perf/util/stat-display.c
@@@ -15,9 -15,10 +15,14 @@@
  #include "string2.h"
  #include <linux/ctype.h>
  #include "cgroup.h"
 +#include <math.h>
  #include <api/fs/fs.h>
  #include "util.h"
++<<<<<<< HEAD
++=======
+ #include "iostat.h"
+ #include "pmu-hybrid.h"
++>>>>>>> 12279429d862 (perf stat: Uniquify hybrid event name)
  
  #define CNTR_NOT_SUPPORTED	"<not supported>"
  #define CNTR_NOT_COUNTED	"<not counted>"
* Unmerged path tools/perf/builtin-stat.c
diff --git a/tools/perf/util/evsel.h b/tools/perf/util/evsel.h
index 6026487353dd..7460ad4f2559 100644
--- a/tools/perf/util/evsel.h
+++ b/tools/perf/util/evsel.h
@@ -113,6 +113,7 @@ struct evsel {
 	bool			merged_stat;
 	bool			reset_group;
 	bool			errored;
+	bool			use_config_name;
 	struct hashmap		*per_pkg_mask;
 	struct evsel		*leader;
 	struct list_head	config_terms;
diff --git a/tools/perf/util/parse-events.c b/tools/perf/util/parse-events.c
index c0c0fab22cb8..c3d09f131d61 100644
--- a/tools/perf/util/parse-events.c
+++ b/tools/perf/util/parse-events.c
@@ -1567,6 +1567,9 @@ int parse_events_add_pmu(struct parse_events_state *parse_state,
 	if (!evsel)
 		return -ENOMEM;
 
+	if (evsel->name)
+		evsel->use_config_name = true;
+
 	evsel->pmu_name = name ? strdup(name) : NULL;
 	evsel->use_uncore_alias = use_uncore_alias;
 	evsel->percore = config_term_percore(&evsel->config_terms);
* Unmerged path tools/perf/util/stat-display.c
