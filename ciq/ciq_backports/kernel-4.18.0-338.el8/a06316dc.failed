ixgbe: avoid premature Rx buffer reuse

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-338.el8
commit-author Björn Töpel <bjorn.topel@intel.com>
commit a06316dc87bdc000f7f39a315476957af2ba0f05
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-338.el8/a06316dc.failed

The page recycle code, incorrectly, relied on that a page fragment
could not be freed inside xdp_do_redirect(). This assumption leads to
that page fragments that are used by the stack/XDP redirect can be
reused and overwritten.

To avoid this, store the page count prior invoking xdp_do_redirect().

Fixes: 6453073987ba ("ixgbe: add initial support for xdp redirect")
Reported-and-analyzed-by: Li RongQing <lirongqing@baidu.com>
	Signed-off-by: Björn Töpel <bjorn.topel@intel.com>
	Tested-by: Sandeep Penigalapati <sandeep.penigalapati@intel.com>
	Signed-off-by: Tony Nguyen <anthony.l.nguyen@intel.com>
(cherry picked from commit a06316dc87bdc000f7f39a315476957af2ba0f05)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/intel/ixgbe/ixgbe_main.c
diff --cc drivers/net/ethernet/intel/ixgbe/ixgbe_main.c
index 623aa089fddb,f3f449f53920..000000000000
--- a/drivers/net/ethernet/intel/ixgbe/ixgbe_main.c
+++ b/drivers/net/ethernet/intel/ixgbe/ixgbe_main.c
@@@ -1941,7 -1940,13 +1941,17 @@@ static void ixgbe_reuse_rx_page(struct 
  	new_buff->pagecnt_bias	= old_buff->pagecnt_bias;
  }
  
++<<<<<<< HEAD
 +static bool ixgbe_can_reuse_rx_page(struct ixgbe_rx_buffer *rx_buffer)
++=======
+ static inline bool ixgbe_page_is_reserved(struct page *page)
+ {
+ 	return (page_to_nid(page) != numa_mem_id()) || page_is_pfmemalloc(page);
+ }
+ 
+ static bool ixgbe_can_reuse_rx_page(struct ixgbe_rx_buffer *rx_buffer,
+ 				    int rx_buffer_pgcnt)
++>>>>>>> a06316dc87bd (ixgbe: avoid premature Rx buffer reuse)
  {
  	unsigned int pagecnt_bias = rx_buffer->pagecnt_bias;
  	struct page *page = rx_buffer->page;
* Unmerged path drivers/net/ethernet/intel/ixgbe/ixgbe_main.c
