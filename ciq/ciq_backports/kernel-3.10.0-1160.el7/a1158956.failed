x86/Hyper-V: Report crash register data or kmsg before running crash kernel

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1160.el7
Rebuild_CHGLOG: - [x86] hyper-v: Report crash register data or kmsg before running crash kernel (Mohammed Gamal) [1828450]
Rebuild_FUZZ: 97.26%
commit-author Tianyu Lan <Tianyu.Lan@microsoft.com>
commit a11589563e96bf262767294b89b25a9d44e7303b
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1160.el7/a1158956.failed

We want to notify Hyper-V when a Linux guest VM crash occurs, so
there is a record of the crash even when kdump is enabled.   But
crash_kexec_post_notifiers defaults to "false", so the kdump kernel
runs before the notifiers and Hyper-V never gets notified.  Fix this by
always setting crash_kexec_post_notifiers to be true for Hyper-V VMs.

Fixes: 81b18bce48af ("Drivers: HV: Send one page worth of kmsg dump over Hyper-V during panic")
	Reviewed-by: Michael Kelley <mikelley@microsoft.com>
	Signed-off-by: Tianyu Lan <Tianyu.Lan@microsoft.com>
Link: https://lore.kernel.org/r/20200406155331.2105-5-Tianyu.Lan@microsoft.com
	Signed-off-by: Wei Liu <wei.liu@kernel.org>
(cherry picked from commit a11589563e96bf262767294b89b25a9d44e7303b)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/x86/kernel/cpu/mshyperv.c
diff --cc arch/x86/kernel/cpu/mshyperv.c
index a5aef8cf1174,ebf34c7bc8bc..000000000000
--- a/arch/x86/kernel/cpu/mshyperv.c
+++ b/arch/x86/kernel/cpu/mshyperv.c
@@@ -246,6 -258,21 +246,24 @@@ static void __init ms_hyperv_init_platf
  		x86_platform.calibrate_cpu = hv_get_tsc_khz;
  	}
  
++<<<<<<< HEAD
++=======
+ 	if (ms_hyperv.hints & HV_X64_ENLIGHTENED_VMCS_RECOMMENDED) {
+ 		ms_hyperv.nested_features =
+ 			cpuid_eax(HYPERV_CPUID_NESTED_FEATURES);
+ 	}
+ 
+ 	/*
+ 	 * Hyper-V expects to get crash register data or kmsg when
+ 	 * crash enlightment is available and system crashes. Set
+ 	 * crash_kexec_post_notifiers to be true to make sure that
+ 	 * calling crash enlightment interface before running kdump
+ 	 * kernel.
+ 	 */
+ 	if (ms_hyperv.misc_features & HV_FEATURE_GUEST_CRASH_MSR_AVAILABLE)
+ 		crash_kexec_post_notifiers = true;
+ 
++>>>>>>> a11589563e96 (x86/Hyper-V: Report crash register data or kmsg before running crash kernel)
  #ifdef CONFIG_X86_LOCAL_APIC
  	if (ms_hyperv.features & HV_X64_ACCESS_FREQUENCY_MSRS &&
  	    ms_hyperv.misc_features & HV_FEATURE_FREQUENCY_MSRS_AVAILABLE) {
* Unmerged path arch/x86/kernel/cpu/mshyperv.c
