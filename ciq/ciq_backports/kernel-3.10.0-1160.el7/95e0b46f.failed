audit: fix a memleak caused by auditing load module

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1160.el7
commit-author Li RongQing <lirongqing@baidu.com>
commit 95e0b46fcebd7dbf6850dee96046e4c4ddc7f69c
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1160.el7/95e0b46f.failed

module.name will be allocated unconditionally when auditing load
module, and audit_log_start() can fail with other reasons, or
audit_log_exit maybe not called, caused module.name is not freed

so free module.name in audit_free_context and __audit_syscall_exit

unreferenced object 0xffff88af90837d20 (size 8):
  comm "modprobe", pid 1036, jiffies 4294704867 (age 3069.138s)
  hex dump (first 8 bytes):
    69 78 67 62 65 00 ff ff                          ixgbe...
  backtrace:
    [<0000000008da28fe>] __audit_log_kern_module+0x33/0x80
    [<00000000c1491e61>] load_module+0x64f/0x3850
    [<000000007fc9ae3f>] __do_sys_init_module+0x218/0x250
    [<0000000000d4a478>] do_syscall_64+0x117/0x400
    [<000000004924ded8>] entry_SYSCALL_64_after_hwframe+0x49/0xbe
    [<000000007dc331dd>] 0xffffffffffffffff

Fixes: ca86cad7380e3 ("audit: log module name on init_module")
	Signed-off-by: Zhang Yu <zhangyu31@baidu.com>
	Signed-off-by: Li RongQing <lirongqing@baidu.com>
[PM: manual merge fixup in __audit_syscall_exit()]
	Signed-off-by: Paul Moore <paul@paul-moore.com>
(cherry picked from commit 95e0b46fcebd7dbf6850dee96046e4c4ddc7f69c)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	kernel/auditsc.c
diff --cc kernel/auditsc.c
index 0e23fa78e534,fa7b8047aab8..000000000000
--- a/kernel/auditsc.c
+++ b/kernel/auditsc.c
@@@ -1581,9 -1704,7 +1588,13 @@@ void __audit_syscall_exit(int success, 
  	context->in_syscall = 0;
  	context->prio = context->state == AUDIT_RECORD_CONTEXT ? ~0ULL : 0;
  
++<<<<<<< HEAD
 +	if (!list_empty(&context->killed_trees))
 +		audit_kill_trees(&context->killed_trees);
 +
++=======
+ 	audit_free_module(context);
++>>>>>>> 95e0b46fcebd (audit: fix a memleak caused by auditing load module)
  	audit_free_names(context);
  	unroll_tree_refs(context, NULL, 0);
  	audit_free_aux(context);
* Unmerged path kernel/auditsc.c
