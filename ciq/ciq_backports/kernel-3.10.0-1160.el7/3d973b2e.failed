virtio-blk: improve virtqueue error to BLK_STS

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1160.el7
commit-author Halil Pasic <pasic@linux.ibm.com>
commit 3d973b2e9a625996ee997c7303cd793b9d197c65
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1160.el7/3d973b2e.failed

Let's change the mapping between virtqueue_add errors to BLK_STS
statuses, so that -ENOSPC, which indicates virtqueue full is still
mapped to BLK_STS_DEV_RESOURCE, but -ENOMEM which indicates non-device
specific resource outage is mapped to BLK_STS_RESOURCE.

	Signed-off-by: Halil Pasic <pasic@linux.ibm.com>
Link: https://lore.kernel.org/r/20200213123728.61216-3-pasic@linux.ibm.com
	Signed-off-by: Michael S. Tsirkin <mst@redhat.com>
	Reviewed-by: Stefan Hajnoczi <stefanha@redhat.com>
(cherry picked from commit 3d973b2e9a625996ee997c7303cd793b9d197c65)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/block/virtio_blk.c
diff --cc drivers/block/virtio_blk.c
index 535526566094,0736248999b0..000000000000
--- a/drivers/block/virtio_blk.c
+++ b/drivers/block/virtio_blk.c
@@@ -219,9 -251,14 +219,20 @@@ static int virtio_queue_rq(struct blk_m
  		if (err == -ENOSPC)
  			blk_mq_stop_hw_queue(hctx);
  		spin_unlock_irqrestore(&vblk->vqs[qid].lock, flags);
++<<<<<<< HEAD
 +		if (err == -ENOMEM || err == -ENOSPC)
 +			return BLK_MQ_RQ_QUEUE_DEV_BUSY;
 +		return BLK_MQ_RQ_QUEUE_ERROR;
++=======
+ 		switch (err) {
+ 		case -ENOSPC:
+ 			return BLK_STS_DEV_RESOURCE;
+ 		case -ENOMEM:
+ 			return BLK_STS_RESOURCE;
+ 		default:
+ 			return BLK_STS_IOERR;
+ 		}
++>>>>>>> 3d973b2e9a62 (virtio-blk: improve virtqueue error to BLK_STS)
  	}
  
  	if (bd->last && virtqueue_kick_prepare(vblk->vqs[qid].vq))
* Unmerged path drivers/block/virtio_blk.c
