NFS: Don't hold the inode lock across fsync()

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1160.el7
commit-author Trond Myklebust <trond.myklebust@primarydata.com>
commit 93761d9863c332d1099d80629f89cf48eb745e48
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1160.el7/93761d98.failed

Commits are no longer required to be serialised.

	Signed-off-by: Trond Myklebust <trond.myklebust@primarydata.com>
(cherry picked from commit 93761d9863c332d1099d80629f89cf48eb745e48)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	fs/nfs/file.c
diff --cc fs/nfs/file.c
index 5b55f801cd6b,249262b6bcbe..000000000000
--- a/fs/nfs/file.c
+++ b/fs/nfs/file.c
@@@ -280,9 -277,9 +280,15 @@@ nfs_file_fsync(struct file *file, loff_
  		ret = filemap_write_and_wait_range(inode->i_mapping, start, end);
  		if (ret != 0)
  			break;
++<<<<<<< HEAD
 +		mutex_lock(&inode->i_mutex);
 +		ret = nfs_file_fsync_commit(file, start, end, datasync);
 +		mutex_unlock(&inode->i_mutex);
++=======
+ 		ret = nfs_file_fsync_commit(file, start, end, datasync);
+ 		if (!ret)
+ 			ret = pnfs_sync_inode(inode, !!datasync);
++>>>>>>> 93761d9863c3 (NFS: Don't hold the inode lock across fsync())
  		/*
  		 * If nfs_file_fsync_commit detected a server reboot, then
  		 * resend all dirty pages that might have been covered by
* Unmerged path fs/nfs/file.c
