s390/vdso: remove NULL pointer check from clock_gettime

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1160.el7
commit-author Martin Schwidefsky <schwidefsky@de.ibm.com>
commit 5da76157a4b7d5f595c846cf5e95f6d085b350e2
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1160.el7/5da76157.failed

The explicit NULL pointer check on the timespec argument is only
required for clock_getres but not for clock_gettime.

	Signed-off-by: Martin Schwidefsky <schwidefsky@de.ibm.com>
(cherry picked from commit 5da76157a4b7d5f595c846cf5e95f6d085b350e2)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/s390/kernel/vdso64/clock_gettime.S
diff --cc arch/s390/kernel/vdso64/clock_gettime.S
index f3ed3efb7ef9,3f34e09db5f4..000000000000
--- a/arch/s390/kernel/vdso64/clock_gettime.S
+++ b/arch/s390/kernel/vdso64/clock_gettime.S
@@@ -21,8 -21,10 +21,15 @@@ __kernel_clock_gettime
  	.cfi_startproc
  	larl	%r5,_vdso_data
  	cghi	%r2,__CLOCK_REALTIME
++<<<<<<< HEAD
 +	je	4f
 +	cghi	%r2,-3		/* Per-thread CPUCLOCK with PID=0, VIRT=1 */
++=======
+ 	je	5f
+ 	cghi	%r2,__CLOCK_THREAD_CPUTIME_ID
+ 	je	9f
+ 	cghi	%r2,-2		/* Per-thread CPUCLOCK with PID=0, VIRT=1 */
++>>>>>>> 5da76157a4b7 (s390/vdso: remove NULL pointer check from clock_gettime)
  	je	9f
  	cghi	%r2,__CLOCK_MONOTONIC
  	jne	12f
@@@ -78,10 -76,10 +81,10 @@@
  	j	6b
  7:	stg	%r0,0(%r3)			/* store tp->tv_sec */
  	stg	%r1,8(%r3)			/* store tp->tv_nsec */
- 8:	lghi	%r2,0
+ 	lghi	%r2,0
  	br	%r14
  
 -	/* CLOCK_THREAD_CPUTIME_ID for this thread */
 +	/* CPUCLOCK_VIRT for this thread */
  9:	icm	%r0,15,__VDSO_ECTG_OK(%r5)
  	jz	12f
  	ear	%r2,%a4
diff --git a/arch/s390/kernel/vdso32/clock_gettime.S b/arch/s390/kernel/vdso32/clock_gettime.S
index 65fc3979c2f1..7cf18f8d4cb4 100644
--- a/arch/s390/kernel/vdso32/clock_gettime.S
+++ b/arch/s390/kernel/vdso32/clock_gettime.S
@@ -22,13 +22,11 @@ __kernel_clock_gettime:
 	basr	%r5,0
 0:	al	%r5,21f-0b(%r5)			/* get &_vdso_data */
 	chi	%r2,__CLOCK_REALTIME
-	je	10f
+	je	11f
 	chi	%r2,__CLOCK_MONOTONIC
 	jne	19f
 
 	/* CLOCK_MONOTONIC */
-	ltr	%r3,%r3
-	jz	9f				/* tp == NULL */
 1:	l	%r4,__VDSO_UPD_COUNT+4(%r5)	/* load update counter */
 	tml	%r4,0x0001			/* pending update ? loop */
 	jnz	1b
@@ -67,12 +65,10 @@ __kernel_clock_gettime:
 	j	6b
 8:	st	%r2,0(%r3)			/* store tp->tv_sec */
 	st	%r1,4(%r3)			/* store tp->tv_nsec */
-9:	lhi	%r2,0
+	lhi	%r2,0
 	br	%r14
 
 	/* CLOCK_REALTIME */
-10:	ltr	%r3,%r3				/* tp == NULL */
-	jz	18f
 11:	l	%r4,__VDSO_UPD_COUNT+4(%r5)	/* load update counter */
 	tml	%r4,0x0001			/* pending update ? loop */
 	jnz	11b
@@ -111,7 +107,7 @@ __kernel_clock_gettime:
 	j	15b
 17:	st	%r2,0(%r3)			/* store tp->tv_sec */
 	st	%r1,4(%r3)			/* store tp->tv_nsec */
-18:	lhi	%r2,0
+	lhi	%r2,0
 	br	%r14
 
 	/* Fallback to system call */
* Unmerged path arch/s390/kernel/vdso64/clock_gettime.S
