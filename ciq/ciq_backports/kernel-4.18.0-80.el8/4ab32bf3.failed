blk-mq: never redirect polled IO completions

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-80.el8
commit-author Jens Axboe <axboe@kernel.dk>
commit 4ab32bf3305eedb4d31f85cac68a67becab10494
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-80.el8/4ab32bf3.failed

It's pointless to do so, we are by definition on the CPU we want/need
to be, as that's the one waiting for a completion event.

	Reviewed-by: Christoph Hellwig <hch@lst.de>
	Signed-off-by: Jens Axboe <axboe@kernel.dk>
(cherry picked from commit 4ab32bf3305eedb4d31f85cac68a67becab10494)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	block/blk-mq.c
diff --cc block/blk-mq.c
index 52f967bfb7fc,37674c1766a7..000000000000
--- a/block/blk-mq.c
+++ b/block/blk-mq.c
@@@ -580,8 -585,13 +580,18 @@@ static void __blk_mq_complete_request(s
  		return;
  	}
  
++<<<<<<< HEAD
 +	if (!test_bit(QUEUE_FLAG_SAME_COMP, &rq->q->queue_flags)) {
 +		rq->q->softirq_done_fn(rq);
++=======
+ 	/*
+ 	 * For a polled request, always complete locallly, it's pointless
+ 	 * to redirect the completion.
+ 	 */
+ 	if ((rq->cmd_flags & REQ_HIPRI) ||
+ 	    !test_bit(QUEUE_FLAG_SAME_COMP, &q->queue_flags)) {
+ 		q->mq_ops->complete(rq);
++>>>>>>> 4ab32bf3305e (blk-mq: never redirect polled IO completions)
  		return;
  	}
  
* Unmerged path block/blk-mq.c
