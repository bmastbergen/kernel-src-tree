s390/setup: fix boot crash for machine without EDAT-1

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-80.el8
commit-author Martin Schwidefsky <schwidefsky@de.ibm.com>
commit 86a86804e4f18fc3880541b3d5a07f4df0fe29cb
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-80.el8/86a86804.failed

The fix to make WARN work in the early boot code created a problem
on older machines without EDAT-1. The setup_lowcore_dat_on function
uses the pointer from lowcore_ptr[0] to set the DAT bit in the new
PSWs. That does not work if the kernel page table is set up with
4K pages as the prefix address maps to absolute zero.

To make this work the PSWs need to be changed with via address 0 in
form of the S390_lowcore definition.

	Reported-by: Guenter Roeck <linux@roeck-us.net>
	Tested-by: Cornelia Huck <cohuck@redhat.com>
Fixes: 94f85ed3e2f8 ("s390/setup: fix early warning messages")
	Signed-off-by: Martin Schwidefsky <schwidefsky@de.ibm.com>
(cherry picked from commit 86a86804e4f18fc3880541b3d5a07f4df0fe29cb)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/s390/kernel/setup.c
diff --cc arch/s390/kernel/setup.c
index d82a9ec64ea9,4e91dc172024..000000000000
--- a/arch/s390/kernel/setup.c
+++ b/arch/s390/kernel/setup.c
@@@ -388,6 -449,16 +388,19 @@@ static void __init setup_lowcore(void
  	lowcore_ptr[0] = lc;
  }
  
++<<<<<<< HEAD
++=======
+ static void __init setup_lowcore_dat_on(void)
+ {
+ 	__ctl_clear_bit(0, 28);
+ 	S390_lowcore.external_new_psw.mask |= PSW_MASK_DAT;
+ 	S390_lowcore.svc_new_psw.mask |= PSW_MASK_DAT;
+ 	S390_lowcore.program_new_psw.mask |= PSW_MASK_DAT;
+ 	S390_lowcore.io_new_psw.mask |= PSW_MASK_DAT;
+ 	__ctl_set_bit(0, 28);
+ }
+ 
++>>>>>>> 86a86804e4f1 (s390/setup: fix boot crash for machine without EDAT-1)
  static struct resource code_resource = {
  	.name  = "Kernel code",
  	.flags = IORESOURCE_BUSY | IORESOURCE_SYSTEM_RAM,
* Unmerged path arch/s390/kernel/setup.c
