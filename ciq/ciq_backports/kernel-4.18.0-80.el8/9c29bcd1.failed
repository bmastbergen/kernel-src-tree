mlx5: remove ndo_poll_controller

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-80.el8
commit-author Eric Dumazet <edumazet@google.com>
commit 9c29bcd189f4ab1644b7125713602532d0aefdb7
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-80.el8/9c29bcd1.failed

As diagnosed by Song Liu, ndo_poll_controller() can
be very dangerous on loaded hosts, since the cpu
calling ndo_poll_controller() might steal all NAPI
contexts (for all RX/TX queues of the NIC). This capture
can last for unlimited amount of time, since one
cpu is generally not able to drain all the queues under load.

mlx5 uses NAPI for TX completions, so we better let core
networking stack call the napi->poll() to avoid the capture.

	Signed-off-by: Eric Dumazet <edumazet@google.com>
	Cc: Saeed Mahameed <saeedm@mellanox.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 9c29bcd189f4ab1644b7125713602532d0aefdb7)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/mellanox/mlx5/core/en_main.c
diff --cc drivers/net/ethernet/mellanox/mlx5/core/en_main.c
index c488db7d1bb9,54118b77dc1f..000000000000
--- a/drivers/net/ethernet/mellanox/mlx5/core/en_main.c
+++ b/drivers/net/ethernet/mellanox/mlx5/core/en_main.c
@@@ -4321,14 -4334,12 +4305,17 @@@ static const struct net_device_ops mlx5
  	.ndo_udp_tunnel_add      = mlx5e_add_vxlan_port,
  	.ndo_udp_tunnel_del      = mlx5e_del_vxlan_port,
  	.ndo_features_check      = mlx5e_features_check,
 +#ifdef CONFIG_RFS_ACCEL
 +	.ndo_rx_flow_steer	 = mlx5e_rx_flow_steer,
 +#endif
++<<<<<<< HEAD
  	.ndo_tx_timeout          = mlx5e_tx_timeout,
  	.ndo_bpf		 = mlx5e_xdp,
 -	.ndo_xdp_xmit            = mlx5e_xdp_xmit,
 -#ifdef CONFIG_MLX5_EN_ARFS
 -	.ndo_rx_flow_steer	 = mlx5e_rx_flow_steer,
 +#ifdef CONFIG_NET_POLL_CONTROLLER
 +	.ndo_poll_controller     = mlx5e_netpoll,
  #endif
++=======
++>>>>>>> 9c29bcd189f4 (mlx5: remove ndo_poll_controller)
  #ifdef CONFIG_MLX5_ESWITCH
  	/* SRIOV E-Switch NDOs */
  	.ndo_set_vf_mac          = mlx5e_set_vf_mac,
* Unmerged path drivers/net/ethernet/mellanox/mlx5/core/en_main.c
