Revert "netfilter: nft_numgen: add map lookups for numgen random operations"

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-80.el8
commit-author Pablo Neira Ayuso <pablo@netfilter.org>
commit 4269fea768a11a447d8de620ce420f2214d4685c
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-80.el8/4269fea7.failed

Laura found a better way to do this from userspace without requiring
kernel infrastructure, revert this.

Fixes: 978d8f9055c3 ("netfilter: nft_numgen: add map lookups for numgen random operations")
	Signed-off-by: Laura Garcia Liebana <nevola@gmail.com>
	Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
(cherry picked from commit 4269fea768a11a447d8de620ce420f2214d4685c)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/netfilter/nft_numgen.c
diff --cc net/netfilter/nft_numgen.c
index 1f4d0854cf70,3cc1b3dc3c3c..000000000000
--- a/net/netfilter/nft_numgen.c
+++ b/net/netfilter/nft_numgen.c
@@@ -226,23 -150,6 +150,26 @@@ static int nft_ng_random_init(const str
  					   NFT_DATA_VALUE, sizeof(u32));
  }
  
++<<<<<<< HEAD
 +static int nft_ng_random_map_init(const struct nft_ctx *ctx,
 +				  const struct nft_expr *expr,
 +				  const struct nlattr * const tb[])
 +{
 +	struct nft_ng_random *priv = nft_expr_priv(expr);
 +	u8 genmask = nft_genmask_next(ctx->net);
 +
 +	nft_ng_random_init(ctx, expr, tb);
 +	priv->map = nft_set_lookup_global(ctx->net, ctx->table,
 +					  tb[NFTA_NG_SET_NAME],
 +					  tb[NFTA_NG_SET_ID], genmask);
 +	if (IS_ERR(priv->map))
 +		return PTR_ERR(priv->map);
 +
 +	return 0;
 +}
 +
++=======
++>>>>>>> 4269fea768a1 (Revert "netfilter: nft_numgen: add map lookups for numgen random operations")
  static int nft_ng_random_dump(struct sk_buff *skb, const struct nft_expr *expr)
  {
  	const struct nft_ng_random *priv = nft_expr_priv(expr);
diff --git a/include/uapi/linux/netfilter/nf_tables.h b/include/uapi/linux/netfilter/nf_tables.h
index 89438e68dc03..5750814d21a0 100644
--- a/include/uapi/linux/netfilter/nf_tables.h
+++ b/include/uapi/linux/netfilter/nf_tables.h
@@ -1542,8 +1542,8 @@ enum nft_ng_attributes {
 	NFTA_NG_MODULUS,
 	NFTA_NG_TYPE,
 	NFTA_NG_OFFSET,
-	NFTA_NG_SET_NAME,
-	NFTA_NG_SET_ID,
+	NFTA_NG_SET_NAME,	/* deprecated */
+	NFTA_NG_SET_ID,		/* deprecated */
 	__NFTA_NG_MAX
 };
 #define NFTA_NG_MAX	(__NFTA_NG_MAX - 1)
* Unmerged path net/netfilter/nft_numgen.c
