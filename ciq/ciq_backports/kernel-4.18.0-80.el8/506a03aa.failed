net_sched: add missing tcf_lock for act_connmark

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-80.el8
commit-author Cong Wang <xiyou.wangcong@gmail.com>
commit 506a03aa04deed321b26153aff4e61161aefa8af
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-80.el8/506a03aa.failed

According to the new locking rule, we have to take tcf_lock
for both ->init() and ->dump(), as RTNL will be removed.
However, it is missing for act_connmark.

	Cc: Vlad Buslov <vladbu@mellanox.com>
	Signed-off-by: Cong Wang <xiyou.wangcong@gmail.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 506a03aa04deed321b26153aff4e61161aefa8af)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/sched/act_connmark.c
diff --cc net/sched/act_connmark.c
index d5b66de1e321,8475913f2070..000000000000
--- a/net/sched/act_connmark.c
+++ b/net/sched/act_connmark.c
@@@ -135,12 -138,16 +135,18 @@@ static int tcf_connmark_init(struct ne
  		ci = to_connmark(*a);
  		if (bind)
  			return 0;
 -		if (!ovr) {
 -			tcf_idr_release(*a, bind);
 +		tcf_idr_release(*a, bind);
 +		if (!ovr)
  			return -EEXIST;
 -		}
  		/* replacing action and zone */
+ 		spin_lock_bh(&ci->tcf_lock);
  		ci->tcf_action = parm->action;
  		ci->zone = parm->zone;
++<<<<<<< HEAD
++=======
+ 		spin_unlock_bh(&ci->tcf_lock);
+ 		ret = 0;
++>>>>>>> 506a03aa04de (net_sched: add missing tcf_lock for act_connmark)
  	}
  
  	return ret;
@@@ -151,13 -158,10 +157,17 @@@ static inline int tcf_connmark_dump(str
  {
  	unsigned char *b = skb_tail_pointer(skb);
  	struct tcf_connmark_info *ci = to_connmark(a);
- 
  	struct tc_connmark opt = {
  		.index   = ci->tcf_index,
++<<<<<<< HEAD
 +		.refcnt  = ci->tcf_refcnt - ref,
 +		.bindcnt = ci->tcf_bindcnt - bind,
 +		.action  = ci->tcf_action,
 +		.zone   = ci->zone,
++=======
+ 		.refcnt  = refcount_read(&ci->tcf_refcnt) - ref,
+ 		.bindcnt = atomic_read(&ci->tcf_bindcnt) - bind,
++>>>>>>> 506a03aa04de (net_sched: add missing tcf_lock for act_connmark)
  	};
  	struct tcf_t t;
  
* Unmerged path net/sched/act_connmark.c
