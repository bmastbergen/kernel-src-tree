net: hns3: Fix loss of coal configuration while doing reset

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-80.el8
commit-author Huazhong Tan <tanhuazhong@huawei.com>
commit e4fd75022c24eb28cc1034e97e60cecc24f325f3
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-80.el8/e4fd7502.failed

The user's coal configuration will be lost after reset, so the tx_coal
and rx_coal fields are added to the struct hns_nic_priv to save the coal
configuration and used to restore the user's configuration after the reset
is complete.

Fixes: bb6b94a896d4 ("net: hns3: Add reset interface implementation in client")
	Signed-off-by: Huazhong Tan <tanhuazhong@huawei.com>
	Signed-off-by: Yunsheng Lin <linyunsheng@huawei.com>
	Signed-off-by: Salil Mehta <salil.mehta@huawei.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit e4fd75022c24eb28cc1034e97e60cecc24f325f3)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/hisilicon/hns3/hns3_enet.c
diff --cc drivers/net/ethernet/hisilicon/hns3/hns3_enet.c
index da24d7f2d743,1050652274a0..000000000000
--- a/drivers/net/ethernet/hisilicon/hns3/hns3_enet.c
+++ b/drivers/net/ethernet/hisilicon/hns3/hns3_enet.c
@@@ -3451,9 -3556,7 +3471,13 @@@ static int hns3_reset_notify_init_enet(
  	/* Carrier off reporting is important to ethtool even BEFORE open */
  	netif_carrier_off(netdev);
  
++<<<<<<< HEAD
 +	ret = hns3_get_ring_config(priv);
 +	if (ret)
 +		return ret;
++=======
+ 	hns3_restore_coal(priv);
++>>>>>>> e4fd75022c24 (net: hns3: Fix loss of coal configuration while doing reset)
  
  	ret = hns3_nic_init_vector_data(priv);
  	if (ret)
* Unmerged path drivers/net/ethernet/hisilicon/hns3/hns3_enet.c
diff --git a/drivers/net/ethernet/hisilicon/hns3/hns3_enet.h b/drivers/net/ethernet/hisilicon/hns3/hns3_enet.h
index d24e05398518..8677452c0bee 100644
--- a/drivers/net/ethernet/hisilicon/hns3/hns3_enet.h
+++ b/drivers/net/ethernet/hisilicon/hns3/hns3_enet.h
@@ -548,6 +548,8 @@ struct hns3_nic_priv {
 	/* Vxlan/Geneve information */
 	struct hns3_udp_tunnel udp_tnl[HNS3_UDP_TNL_MAX];
 	unsigned long active_vlans[BITS_TO_LONGS(VLAN_N_VID)];
+	struct hns3_enet_coalesce tx_coal;
+	struct hns3_enet_coalesce rx_coal;
 };
 
 union l3_hdr_info {
