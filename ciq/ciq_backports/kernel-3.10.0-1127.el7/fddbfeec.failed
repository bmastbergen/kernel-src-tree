iwlwifi: fw: don't send GEO_TX_POWER_LIMIT command to FW version 36

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1127.el7
commit-author Luca Coelho <luciano.coelho@intel.com>
commit fddbfeece9c7882cc47754c7da460fe427e3e85b
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1127.el7/fddbfeec.failed

The intention was to have the GEO_TX_POWER_LIMIT command in FW version
36 as well, but not all 8000 family got this feature enabled.  The
8000 family is the only one using version 36, so skip this version
entirely.  If we try to send this command to the firmwares that do not
support it, we get a BAD_COMMAND response from the firmware.

This fixes https://bugzilla.kernel.org/show_bug.cgi?id=204151.

	Cc: stable@vger.kernel.org # 4.19+
	Signed-off-by: Luca Coelho <luciano.coelho@intel.com>
	Signed-off-by: Kalle Valo <kvalo@codeaurora.org>
(cherry picked from commit fddbfeece9c7882cc47754c7da460fe427e3e85b)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/wireless/intel/iwlwifi/mvm/fw.c
diff --cc drivers/net/wireless/intel/iwlwifi/mvm/fw.c
index b71a9d11a50f,32a5e4e5461f..000000000000
--- a/drivers/net/wireless/intel/iwlwifi/mvm/fw.c
+++ b/drivers/net/wireless/intel/iwlwifi/mvm/fw.c
@@@ -912,6 -882,24 +912,27 @@@ int iwl_mvm_sar_select_profile(struct i
  	return iwl_mvm_send_cmd_pdu(mvm, REDUCE_TX_POWER_CMD, 0, len, &cmd);
  }
  
++<<<<<<< HEAD
++=======
+ static bool iwl_mvm_sar_geo_support(struct iwl_mvm *mvm)
+ {
+ 	/*
+ 	 * The GEO_TX_POWER_LIMIT command is not supported on earlier
+ 	 * firmware versions.  Unfortunately, we don't have a TLV API
+ 	 * flag to rely on, so rely on the major version which is in
+ 	 * the first byte of ucode_ver.  This was implemented
+ 	 * initially on version 38 and then backported to29 and 17.
+ 	 * The intention was to have it in 36 as well, but not all
+ 	 * 8000 family got this feature enabled.  The 8000 family is
+ 	 * the only one using version 36, so skip this version
+ 	 * entirely.
+ 	 */
+ 	return IWL_UCODE_SERIAL(mvm->fw->ucode_ver) >= 38 ||
+ 	       IWL_UCODE_SERIAL(mvm->fw->ucode_ver) == 29 ||
+ 	       IWL_UCODE_SERIAL(mvm->fw->ucode_ver) == 17;
+ }
+ 
++>>>>>>> fddbfeece9c7 (iwlwifi: fw: don't send GEO_TX_POWER_LIMIT command to FW version 36)
  int iwl_mvm_get_sar_geo_profile(struct iwl_mvm *mvm)
  {
  	struct iwl_geo_tx_power_profiles_resp *resp;
* Unmerged path drivers/net/wireless/intel/iwlwifi/mvm/fw.c
