cxgb4: Add MPS TCAM refcounting for raw mac filters

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1127.el7
commit-author Raju Rangoju <rajur@chelsio.com>
commit 5fab51581f6223adab8dc7b526fe1217eb3b7348
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1127.el7/5fab5158.failed

This patch adds TCAM reference counting
support for raw mac filters.

	Signed-off-by: Raju Rangoju <rajur@chelsio.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 5fab51581f6223adab8dc7b526fe1217eb3b7348)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/chelsio/cxgb4/cxgb4.h
#	drivers/net/ethernet/chelsio/cxgb4/cxgb4_mps.c
diff --cc drivers/net/ethernet/chelsio/cxgb4/cxgb4.h
index 295572f2890b,c7ab57fd03be..000000000000
--- a/drivers/net/ethernet/chelsio/cxgb4/cxgb4.h
+++ b/drivers/net/ethernet/chelsio/cxgb4/cxgb4.h
@@@ -1880,5 -1907,33 +1880,36 @@@ int cxgb4_dcb_enabled(const struct net_
  
  int cxgb4_thermal_init(struct adapter *adap);
  int cxgb4_thermal_remove(struct adapter *adap);
++<<<<<<< HEAD
++=======
+ int cxgb4_set_msix_aff(struct adapter *adap, unsigned short vec,
+ 		       cpumask_var_t *aff_mask, int idx);
+ void cxgb4_clear_msix_aff(unsigned short vec, cpumask_var_t aff_mask);
+ 
+ int cxgb4_init_mps_ref_entries(struct adapter *adap);
+ void cxgb4_free_mps_ref_entries(struct adapter *adap);
+ int cxgb4_alloc_encap_mac_filt(struct adapter *adap, unsigned int viid,
+ 			       const u8 *addr, const u8 *mask,
+ 			       unsigned int vni, unsigned int vni_mask,
+ 			       u8 dip_hit, u8 lookup_type, bool sleep_ok);
+ int cxgb4_free_encap_mac_filt(struct adapter *adap, unsigned int viid,
+ 			      int idx, bool sleep_ok);
+ int cxgb4_free_raw_mac_filt(struct adapter *adap,
+ 			    unsigned int viid,
+ 			    const u8 *addr,
+ 			    const u8 *mask,
+ 			    unsigned int idx,
+ 			    u8 lookup_type,
+ 			    u8 port_id,
+ 			    bool sleep_ok);
+ int cxgb4_alloc_raw_mac_filt(struct adapter *adap,
+ 			     unsigned int viid,
+ 			     const u8 *addr,
+ 			     const u8 *mask,
+ 			     unsigned int idx,
+ 			     u8 lookup_type,
+ 			     u8 port_id,
+ 			     bool sleep_ok);
++>>>>>>> 5fab51581f62 (cxgb4: Add MPS TCAM refcounting for raw mac filters)
  
  #endif /* __CXGB4_H__ */
* Unmerged path drivers/net/ethernet/chelsio/cxgb4/cxgb4_mps.c
* Unmerged path drivers/net/ethernet/chelsio/cxgb4/cxgb4.h
* Unmerged path drivers/net/ethernet/chelsio/cxgb4/cxgb4_mps.c
