net/mlx5e: Initialize on stack link modes bitmap

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1127.el7
commit-author Aya Levin <ayal@mellanox.com>
commit 926b37f76fb0a22fe93c8873c819fd167180e85c
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1127.el7/926b37f7.failed

Initialize link modes bitmap on stack before using it, otherwise the
outcome of ethtool set link ksettings might have unexpected values.

Fixes: 4b95840a6ced ("net/mlx5e: Fix matching of speed to PRM link modes")
	Signed-off-by: Aya Levin <ayal@mellanox.com>
	Signed-off-by: Saeed Mahameed <saeedm@mellanox.com>
(cherry picked from commit 926b37f76fb0a22fe93c8873c819fd167180e85c)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/mellanox/mlx5/core/en_ethtool.c
diff --cc drivers/net/ethernet/mellanox/mlx5/core/en_ethtool.c
index d101a32cd755,327c93a7bd55..000000000000
--- a/drivers/net/ethernet/mellanox/mlx5/core/en_ethtool.c
+++ b/drivers/net/ethernet/mellanox/mlx5/core/en_ethtool.c
@@@ -998,12 -1017,36 +998,41 @@@ static u32 mlx5e_ethtool2ptys_ext_adver
  	return ptys_modes;
  }
  
++<<<<<<< HEAD
 +static int mlx5e_set_link_ksettings(struct net_device *netdev,
 +				    const struct ethtool_link_ksettings *link_ksettings)
++=======
+ static bool ext_link_mode_requested(const unsigned long *adver)
+ {
+ #define MLX5E_MIN_PTYS_EXT_LINK_MODE_BIT ETHTOOL_LINK_MODE_50000baseKR_Full_BIT
+ 	int size = __ETHTOOL_LINK_MODE_MASK_NBITS - MLX5E_MIN_PTYS_EXT_LINK_MODE_BIT;
+ 	__ETHTOOL_DECLARE_LINK_MODE_MASK(modes) = {0,};
+ 
+ 	bitmap_set(modes, MLX5E_MIN_PTYS_EXT_LINK_MODE_BIT, size);
+ 	return bitmap_intersects(modes, adver, __ETHTOOL_LINK_MODE_MASK_NBITS);
+ }
+ 
+ static bool ext_speed_requested(u32 speed)
+ {
+ #define MLX5E_MAX_PTYS_LEGACY_SPEED 100000
+ 	return !!(speed > MLX5E_MAX_PTYS_LEGACY_SPEED);
+ }
+ 
+ static bool ext_requested(u8 autoneg, const unsigned long *adver, u32 speed)
+ {
+ 	bool ext_link_mode = ext_link_mode_requested(adver);
+ 	bool ext_speed = ext_speed_requested(speed);
+ 
+ 	return  autoneg == AUTONEG_ENABLE ? ext_link_mode : ext_speed;
+ }
+ 
+ int mlx5e_ethtool_set_link_ksettings(struct mlx5e_priv *priv,
+ 				     const struct ethtool_link_ksettings *link_ksettings)
++>>>>>>> 926b37f76fb0 (net/mlx5e: Initialize on stack link modes bitmap)
  {
 +	struct mlx5e_priv *priv    = netdev_priv(netdev);
  	struct mlx5_core_dev *mdev = priv->mdev;
  	struct mlx5e_port_eth_proto eproto;
 -	const unsigned long *adver;
  	bool an_changes = false;
  	u8 an_disable_admin;
  	bool ext_supported;
* Unmerged path drivers/net/ethernet/mellanox/mlx5/core/en_ethtool.c
