ALSA: hda - Add a quirk model for fixing Huawei Matebook X right speaker

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1127.el7
commit-author Tomas Espeleta <tomas.espeleta@gmail.com>
commit a2ef03fe617a8365fb7794531b11ba587509a9b9
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1127.el7/a2ef03fe.failed

[ This is rather a revival of the patch Tomas sent in months ago, but
  applying only with the quirk model option -- tiwai ]

Hard coded coefficients to make Huawuei Matebook X right speaker
work. The Matebook X has a ALC298, please refer to bug 197801 on
how these numbers were reverse engineered from the Windows driver

The reversed engineered sequence represents a repeating pattern
of verbs, and the only values that are changing periodically are
written on indexes 0x23 and 0x25:

0x500, 0x23
0x400, VALUE1
0x500, 0x25
0x400, VALUE2

* skipped reading sequences (0x500 - 0xc00 sequences are ignored)
* static values from reverse engineering are used

NOTE: since a significant risk is still considered, this is provided
as an experimental fix that isn't applied as default for now.  For
enabling the fix, you'll have to choose huawei-mbx-stereo via model
option of snd-hda-intel module.

If we get feedback from users that this works stably, we may apply it
per default.

[ Some coding style fixes and replacement with AC_VERB_* by tiwai ]

BugLink: https://bugzilla.kernel.org/show_bug.cgi?id=197801
	Signed-off-by: Tomas Espeleta <tomas.espeleta@gmail.com>
	Signed-off-by: Takashi Iwai <tiwai@suse.de>
(cherry picked from commit a2ef03fe617a8365fb7794531b11ba587509a9b9)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	sound/pci/hda/patch_realtek.c
diff --cc sound/pci/hda/patch_realtek.c
index 8171fb27be3e,cb7baa65b298..000000000000
--- a/sound/pci/hda/patch_realtek.c
+++ b/sound/pci/hda/patch_realtek.c
@@@ -5798,7 -5852,8 +5864,12 @@@ enum 
  	ALC298_FIXUP_TPT470_DOCK,
  	ALC255_FIXUP_DUMMY_LINEOUT_VERB,
  	ALC255_FIXUP_DELL_HEADSET_MIC,
++<<<<<<< HEAD
 +	ALC256_FIXUP_HUAWEI_MBXP_PINS,
++=======
+ 	ALC256_FIXUP_HUAWEI_MACH_WX9_PINS,
+ 	ALC298_FIXUP_HUAWEI_MBX_STEREO,
++>>>>>>> a2ef03fe617a (ALSA: hda - Add a quirk model for fixing Huawei Matebook X right speaker)
  	ALC295_FIXUP_HP_X360,
  	ALC221_FIXUP_HP_HEADSET_MIC,
  	ALC285_FIXUP_LENOVO_HEADPHONE_NOISE,
@@@ -6105,7 -6159,15 +6176,13 @@@ static const struct hda_fixup alc269_fi
  			{0x21, 0x04211020},
  			{ }
  		},
 -		.chained = true,
 -		.chain_id = ALC255_FIXUP_MIC_MUTE_LED
  	},
+ 	[ALC298_FIXUP_HUAWEI_MBX_STEREO] = {
+ 		.type = HDA_FIXUP_FUNC,
+ 		.v.func = alc298_fixup_huawei_mbx_stereo,
+ 		.chained = true,
+ 		.chain_id = ALC255_FIXUP_MIC_MUTE_LED
+ 	},
  	[ALC269_FIXUP_ASUS_X101_FUNC] = {
  		.type = HDA_FIXUP_FUNC,
  		.v.func = alc269_fixup_x101_headset_mic,
diff --git a/Documentation/sound/hd-audio/models.rst b/Documentation/sound/hd-audio/models.rst
index 0843b8d644b2..361899519a2f 100644
--- a/Documentation/sound/hd-audio/models.rst
+++ b/Documentation/sound/hd-audio/models.rst
@@ -260,6 +260,9 @@ alc295-hp-x360
     HP Spectre X360 fixups
 alc-sense-combo
     Headset button support for Chrome platform
+huawei-mbx-stereo
+    Enable initialization verbs for Huawei MBX stereo speakers;
+    might be risky, try this at your own risk
 
 ALC66x/67x/892
 ==============
* Unmerged path sound/pci/hda/patch_realtek.c
