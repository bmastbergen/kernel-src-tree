net/mlx5e: Support tagged tunnel over bond

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1127.el7
commit-author Eli Britstein <elibr@mellanox.com>
commit 45e7d4c0c1727d362012a62eb57254ea71a2d591
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1127.el7/45e7d4c0.failed

Stacked devices like bond interface may have a VLAN device on top of
them. Detect lag state correctly under this condition, and return the
correct routed net device, according to it the encap header is built.

Fixes: e32ee6c78efa ("net/mlx5e: Support tunnel encap over tagged Ethernet")
	Signed-off-by: Eli Britstein <elibr@mellanox.com>
	Reviewed-by: Roi Dayan <roid@mellanox.com>
	Signed-off-by: Saeed Mahameed <saeedm@mellanox.com>
(cherry picked from commit 45e7d4c0c1727d362012a62eb57254ea71a2d591)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/mellanox/mlx5/core/en/tc_tun.c
diff --cc drivers/net/ethernet/mellanox/mlx5/core/en/tc_tun.c
index 0b62b9baba02,231e7cdfc6f7..000000000000
--- a/drivers/net/ethernet/mellanox/mlx5/core/en/tc_tun.c
+++ b/drivers/net/ethernet/mellanox/mlx5/core/en/tc_tun.c
@@@ -25,10 -26,10 +26,14 @@@ static int get_route_and_out_devs(struc
  	/* if the egress device isn't on the same HW e-switch or
  	 * it's a LAG device, use the uplink
  	 */
++<<<<<<< HEAD
 +	if (!switchdev_port_same_parent_id(priv->netdev, dev) ||
++=======
+ 	if (!netdev_port_same_parent_id(priv->netdev, real_dev) ||
++>>>>>>> 45e7d4c0c172 (net/mlx5e: Support tagged tunnel over bond)
  	    dst_is_lag_dev) {
- 		*route_dev = uplink_dev;
- 		*out_dev = *route_dev;
+ 		*route_dev = dev;
+ 		*out_dev = uplink_dev;
  	} else {
  		*route_dev = dev;
  		if (is_vlan_dev(*route_dev))
* Unmerged path drivers/net/ethernet/mellanox/mlx5/core/en/tc_tun.c
