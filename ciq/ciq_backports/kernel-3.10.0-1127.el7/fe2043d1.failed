scsi: qedf: Correctly handle refcounting of rdata

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1127.el7
commit-author Saurav Kashyap <skashyap@marvell.com>
commit fe2043d19e4a10fd697756ca6edf0edc1c0392ef
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1127.el7/fe2043d1.failed

 - Handle refcount of rdata during error conditions.

	Signed-off-by: Saurav Kashyap <skashyap@marvell.com>
	Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
(cherry picked from commit fe2043d19e4a10fd697756ca6edf0edc1c0392ef)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/scsi/qedf/qedf_io.c
diff --cc drivers/scsi/qedf/qedf_io.c
index 97708784b776,b359ae3b78b5..000000000000
--- a/drivers/scsi/qedf/qedf_io.c
+++ b/drivers/scsi/qedf/qedf_io.c
@@@ -2255,12 -2251,9 +2255,15 @@@ static int qedf_execute_tmf(struct qedf
  	if (!test_bit(QEDF_RPORT_SESSION_READY, &fcport->flags)) {
  		QEDF_ERR(&(qedf->dbg_ctx), "fcport not offloaded\n");
  		rc = FAILED;
- 		return FAILED;
+ 		goto no_flush;
  	}
  
++<<<<<<< HEAD
 +	QEDF_INFO(&(qedf->dbg_ctx), QEDF_LOG_SCSI_TM, "portid = 0x%x "
 +		   "tm_flags = %d\n", fcport->rdata->ids.port_id, tm_flags);
 +
++=======
++>>>>>>> fe2043d19e4a (scsi: qedf: Correctly handle refcounting of rdata)
  	io_req = qedf_alloc_cmd(fcport, QEDF_TASK_MGMT_CMD);
  	if (!io_req) {
  		QEDF_ERR(&(qedf->dbg_ctx), "Failed TMF");
@@@ -2354,7 -2347,6 +2357,10 @@@ no_flush
  		QEDF_ERR(&(qedf->dbg_ctx), "task mgmt command success...\n");
  		rc = SUCCESS;
  	}
++<<<<<<< HEAD
 +reset_tmf_err:
++=======
++>>>>>>> fe2043d19e4a (scsi: qedf: Correctly handle refcounting of rdata)
  	return rc;
  }
  
* Unmerged path drivers/scsi/qedf/qedf_io.c
