mac80211: Correctly set noencrypt for PAE frames

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1127.el7
commit-author Denis Kenzior <denkenz@gmail.com>
commit f8b43c5cf4b62a19f2210a0f5367b84e1eff1ab9
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1127.el7/f8b43c5c.failed

The noencrypt flag was intended to be set if the "frame was received
unencrypted" according to include/uapi/linux/nl80211.h.  However, the
current behavior is opposite of this.

	Cc: stable@vger.kernel.org
Fixes: 018f6fbf540d ("mac80211: Send control port frames over nl80211")
	Signed-off-by: Denis Kenzior <denkenz@gmail.com>
Link: https://lore.kernel.org/r/20190827224120.14545-3-denkenz@gmail.com
	Signed-off-by: Johannes Berg <johannes.berg@intel.com>
(cherry picked from commit f8b43c5cf4b62a19f2210a0f5367b84e1eff1ab9)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/mac80211/rx.c
diff --cc net/mac80211/rx.c
index 708be6c719d8,768d14c9a716..000000000000
--- a/net/mac80211/rx.c
+++ b/net/mac80211/rx.c
@@@ -2250,6 -2437,31 +2250,34 @@@ static bool ieee80211_frame_allowed(str
  	return true;
  }
  
++<<<<<<< HEAD
++=======
+ static void ieee80211_deliver_skb_to_local_stack(struct sk_buff *skb,
+ 						 struct ieee80211_rx_data *rx)
+ {
+ 	struct ieee80211_sub_if_data *sdata = rx->sdata;
+ 	struct net_device *dev = sdata->dev;
+ 
+ 	if (unlikely((skb->protocol == sdata->control_port_protocol ||
+ 		      skb->protocol == cpu_to_be16(ETH_P_PREAUTH)) &&
+ 		     sdata->control_port_over_nl80211)) {
+ 		struct ieee80211_rx_status *status = IEEE80211_SKB_RXCB(skb);
+ 		bool noencrypt = !(status->flag & RX_FLAG_DECRYPTED);
+ 
+ 		cfg80211_rx_control_port(dev, skb, noencrypt);
+ 		dev_kfree_skb(skb);
+ 	} else {
+ 		memset(skb->cb, 0, sizeof(skb->cb));
+ 
+ 		/* deliver to local stack */
+ 		if (rx->napi)
+ 			napi_gro_receive(rx->napi, skb);
+ 		else
+ 			netif_receive_skb(skb);
+ 	}
+ }
+ 
++>>>>>>> f8b43c5cf4b6 (mac80211: Correctly set noencrypt for PAE frames)
  /*
   * requires that rx->skb is a frame with ethernet header
   */
* Unmerged path net/mac80211/rx.c
