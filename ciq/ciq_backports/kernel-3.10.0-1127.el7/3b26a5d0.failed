net: bridge: mcast: fix stale ipv6 hdr pointer when handling v6 query

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1127.el7
Rebuild_CHGLOG: - [net] bridge: mcast: fix stale ipv6 hdr pointer when handling v6 query (Hangbin Liu) [1749658]
Rebuild_FUZZ: 96.24%
commit-author Nikolay Aleksandrov <nikolay@cumulusnetworks.com>
commit 3b26a5d03d35d8f732d75951218983c0f7f68dff
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1127.el7/3b26a5d0.failed

We get a pointer to the ipv6 hdr in br_ip6_multicast_query but we may
call pskb_may_pull afterwards and end up using a stale pointer.
So use the header directly, it's just 1 place where it's needed.

Fixes: 08b202b67264 ("bridge br_multicast: IPv6 MLD support.")
	Signed-off-by: Nikolay Aleksandrov <nikolay@cumulusnetworks.com>
	Tested-by: Martin Weinelt <martin@linuxlounge.net>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 3b26a5d03d35d8f732d75951218983c0f7f68dff)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/bridge/br_multicast.c
diff --cc net/bridge/br_multicast.c
index 798b0d181a10,3d8deac2353d..000000000000
--- a/net/bridge/br_multicast.c
+++ b/net/bridge/br_multicast.c
@@@ -1503,7 -1278,7 +1503,11 @@@ static int br_ip6_multicast_query(struc
  				  struct sk_buff *skb,
  				  u16 vid)
  {
++<<<<<<< HEAD
 +	const struct ipv6hdr *ip6h = ipv6_hdr(skb);
++=======
+ 	unsigned int transport_len = ipv6_transport_len(skb);
++>>>>>>> 3b26a5d03d35 (net: bridge: mcast: fix stale ipv6 hdr pointer when handling v6 query)
  	struct mld_msg *mld;
  	struct net_bridge_mdb_entry *mp;
  	struct mld2_query *mld2q;
* Unmerged path net/bridge/br_multicast.c
