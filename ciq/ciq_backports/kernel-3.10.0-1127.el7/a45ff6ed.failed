intel_th: msu: Serialize enabling/disabling

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1127.el7
commit-author Alexander Shishkin <alexander.shishkin@linux.intel.com>
commit a45ff6ed742cdfdb3cdebee83d19ab1c00d91fcc
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1127.el7/a45ff6ed.failed

In order to guarantee that readers don't race with trace enabling,
both should happen under the same mutex. Having two mutexes seems
like an overkill, considering that because of the above, they'll
have to be acquired together, around trace enabling and char device
opening.

This patch makes both buffer accesses and readers serialize on
msc::buf_mutex and makes sure that 'enabled' flag accesses are also
serialized on it.

	Signed-off-by: Alexander Shishkin <alexander.shishkin@linux.intel.com>
	Reviewed-by: Laurent Fert <laurent.fert@intel.com>
(cherry picked from commit a45ff6ed742cdfdb3cdebee83d19ab1c00d91fcc)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/hwtracing/intel_th/msu.c
* Unmerged path drivers/hwtracing/intel_th/msu.c
* Unmerged path drivers/hwtracing/intel_th/msu.c
