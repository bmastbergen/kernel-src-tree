ip6_tunnel: fix ip6 tunnel lookup in collect_md mode

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1127.el7
commit-author Haishuang Yan <yanhaishuang@cmss.chinamobile.com>
commit 6c1cb4393cc7e7107e4e94a9a0744451296ca8a6
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1127.el7/6c1cb439.failed

In collect_md mode, if the tun dev is down, it still can call
__ip6_tnl_rcv to receive on packets, and the rx statistics increase
improperly.

When the md tunnel is down, it's not neccessary to increase RX drops
for the tunnel device, packets would be recieved on fallback tunnel,
and the RX drops on fallback device will be increased as expected.

Fixes: 8d79266bc48c ("ip6_tunnel: add collect_md mode to IPv6 tunnels")
	Cc: Alexei Starovoitov <ast@fb.com>
	Signed-off-by: Haishuang Yan <yanhaishuang@cmss.chinamobile.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 6c1cb4393cc7e7107e4e94a9a0744451296ca8a6)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/ipv6/ip6_tunnel.c
diff --cc net/ipv6/ip6_tunnel.c
index 5663d90448eb,ae73164559d5..000000000000
--- a/net/ipv6/ip6_tunnel.c
+++ b/net/ipv6/ip6_tunnel.c
@@@ -168,6 -170,10 +168,13 @@@ ip6_tnl_lookup(struct net *net, const s
  			return t;
  	}
  
++<<<<<<< HEAD
++=======
+ 	t = rcu_dereference(ip6n->collect_md_tun);
+ 	if (t && t->dev->flags & IFF_UP)
+ 		return t;
+ 
++>>>>>>> 6c1cb4393cc7 (ip6_tunnel: fix ip6 tunnel lookup in collect_md mode)
  	t = rcu_dereference(ip6n->tnls_wc[0]);
  	if (t && (t->dev->flags & IFF_UP))
  		return t;
* Unmerged path net/ipv6/ip6_tunnel.c
