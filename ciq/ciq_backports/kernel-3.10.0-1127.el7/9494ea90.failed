Revert "iommu/amd: Suppress IO_PAGE_FAULTs in kdump kernel"

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1127.el7
commit-author Baoquan He <bhe@redhat.com>
commit 9494ea90a56d013f4257686c8daf49203cd900c0
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1127.el7/9494ea90.failed

This reverts commit 54bd63570484167cb13edf81e31fff107b879981.

We still need the IO_PAGE_FAULT message to warn error after the
issue of on-flight dma in kdump kernel is fixed.

	Signed-off-by: Baoquan He <bhe@redhat.com>
	Signed-off-by: Joerg Roedel <jroedel@suse.de>
(cherry picked from commit 9494ea90a56d013f4257686c8daf49203cd900c0)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/iommu/amd_iommu.c
#	drivers/iommu/amd_iommu_init.c
diff --cc drivers/iommu/amd_iommu.c
index 0e2fe8211528,6d2fc40a086d..000000000000
--- a/drivers/iommu/amd_iommu.c
+++ b/drivers/iommu/amd_iommu.c
@@@ -2112,8 -2086,7 +2112,12 @@@ static void set_dte_entry(u16 devid, st
  		flags    |= tmp;
  	}
  
++<<<<<<< HEAD
 +
 +	flags &= ~(DTE_FLAG_SA | DEV_DOMID_MASK);
++=======
+ 	flags &= ~(0xffffUL);
++>>>>>>> 9494ea90a56d (Revert "iommu/amd: Suppress IO_PAGE_FAULTs in kdump kernel")
  	flags |= domain->id;
  
  	amd_iommu_dev_table[devid].data[1]  = flags;
diff --cc drivers/iommu/amd_iommu_init.c
index 30e59d8a0cf9,7044510654fe..000000000000
--- a/drivers/iommu/amd_iommu_init.c
+++ b/drivers/iommu/amd_iommu_init.c
@@@ -29,8 -29,6 +29,11 @@@
  #include <linux/export.h>
  #include <linux/iommu.h>
  #include <linux/kmemleak.h>
++<<<<<<< HEAD
 +#include <linux/mem_encrypt.h>
 +#include <linux/crash_dump.h>
++=======
++>>>>>>> 9494ea90a56d (Revert "iommu/amd: Suppress IO_PAGE_FAULTs in kdump kernel")
  #include <asm/pci-direct.h>
  #include <asm/iommu.h>
  #include <asm/gart.h>
* Unmerged path drivers/iommu/amd_iommu.c
* Unmerged path drivers/iommu/amd_iommu_init.c
diff --git a/drivers/iommu/amd_iommu_types.h b/drivers/iommu/amd_iommu_types.h
index 395404d8b29d..f3b7eca78825 100644
--- a/drivers/iommu/amd_iommu_types.h
+++ b/drivers/iommu/amd_iommu_types.h
@@ -343,7 +343,6 @@
 
 #define DTE_FLAG_MASK	(0x3ffULL << 32)
 #define DTE_FLAG_IOTLB	(1ULL << 32)
-#define DTE_FLAG_SA	(1ULL << 34)
 #define DTE_FLAG_GV	(1ULL << 55)
 #define DTE_GLX_SHIFT	(56)
 #define DTE_GLX_MASK	(3)
