scsi: qedf: fixup locking in qedf_restart_rport()

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1127.el7
commit-author Hannes Reinecke <hare@suse.com>
commit 6d1368e8f987dd4bb1be6506d5416cb90b4ecf7a
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1127.el7/6d1368e8.failed

fc_rport_create() needs to be called with disc_mutex held.  And we should
re-assign the 'rdata' pointer in case it got changed.

	Signed-off-by: Hannes Reinecke <hare@suse.com>
	Signed-off-by: Saurav Kashyap <skashyap@marvell.com>
	Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
(cherry picked from commit 6d1368e8f987dd4bb1be6506d5416cb90b4ecf7a)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/scsi/qedf/qedf_els.c
diff --cc drivers/scsi/qedf/qedf_els.c
index 96a862e36844,aad1f7c464fd..000000000000
--- a/drivers/scsi/qedf/qedf_els.c
+++ b/drivers/scsi/qedf/qedf_els.c
@@@ -379,11 -379,17 +379,25 @@@ void qedf_restart_rport(struct qedf_rpo
  		port_id = rdata->ids.port_id;
  		QEDF_ERR(&(fcport->qedf->dbg_ctx),
  		    "LOGO port_id=%x.\n", port_id);
++<<<<<<< HEAD
 +		lport->tt.rport_logoff(rdata);
 +		/* Recreate the rport and log back in */
 +		rdata = lport->tt.rport_create(lport, port_id);
 +		if (rdata)
 +			lport->tt.rport_login(rdata);
++=======
+ 		fc_rport_logoff(rdata);
+ 		mutex_lock(&lport->disc.disc_mutex);
+ 		/* Recreate the rport and log back in */
+ 		rdata = fc_rport_create(lport, port_id);
+ 		if (rdata) {
+ 			mutex_unlock(&lport->disc.disc_mutex);
+ 			fc_rport_login(rdata);
+ 			fcport->rdata = rdata;
+ 		} else {
+ 			mutex_unlock(&lport->disc.disc_mutex);
+ 		}
++>>>>>>> 6d1368e8f987 (scsi: qedf: fixup locking in qedf_restart_rport())
  	}
  	clear_bit(QEDF_RPORT_IN_RESET, &fcport->flags);
  }
* Unmerged path drivers/scsi/qedf/qedf_els.c
