scsi: qedf: missing kref_put in qedf_xmit()

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1127.el7
commit-author Hannes Reinecke <hare@suse.com>
commit 4262d35c32c652344b6784cad51ec5a0e2e5258b
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1127.el7/4262d35c.failed

qedf_xmit() calls fc_rport_lookup(), but discards the returned rdata
structure almost immediately without decreasing the refcount.  This leads
to a refcount leak and the rdata never to be freed.

	Signed-off-by: Hannes Reinecke <hare@suse.com>
	Signed-off-by: Saurav Kashyap <skashyap@marvell.com>
	Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
(cherry picked from commit 4262d35c32c652344b6784cad51ec5a0e2e5258b)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/scsi/qedf/qedf_main.c
diff --cc drivers/scsi/qedf/qedf_main.c
index 4c04b59955fb,b216a0f757a1..000000000000
--- a/drivers/scsi/qedf/qedf_main.c
+++ b/drivers/scsi/qedf/qedf_main.c
@@@ -975,9 -970,11 +975,16 @@@ static int qedf_xmit(struct fc_lport *l
  		QEDF_INFO(&(qedf->dbg_ctx), QEDF_LOG_LL2,
  		    "Dropping FCoE frame to %06x.\n", ntoh24(fh->fh_d_id));
  		kfree_skb(skb);
++<<<<<<< HEAD
 +		rdata = lport->tt.rport_lookup(lport, ntoh24(fh->fh_d_id));
 +		if (rdata)
++=======
+ 		rdata = fc_rport_lookup(lport, ntoh24(fh->fh_d_id));
+ 		if (rdata) {
++>>>>>>> 4262d35c32c6 (scsi: qedf: missing kref_put in qedf_xmit())
  			rdata->retries = lport->max_rport_retry_count;
+ 			kref_put(&rdata->kref, fc_rport_destroy);
+ 		}
  		return -EINVAL;
  	}
  	/* End NPIV filtering */
* Unmerged path drivers/scsi/qedf/qedf_main.c
