ACPICA: Increase total number of possible Owner IDs

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1127.el7
commit-author Bob Moore <robert.moore@intel.com>
commit 67a72420a326b45514deb3f212085fb2cd1595b5
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1127.el7/67a72420.failed

ACPICA commit 1f1652dad88b9d767767bc1f7eb4f7d99e6b5324

From 255 to 4095 possible IDs.

Link: https://github.com/acpica/acpica/commit/1f1652da
	Reported-by: Hedi Berriche <hedi.berriche @hpe.com>
	Signed-off-by: Bob Moore <robert.moore@intel.com>
	Signed-off-by: Erik Schmauss <erik.schmauss@intel.com>
	Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>
(cherry picked from commit 67a72420a326b45514deb3f212085fb2cd1595b5)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/acpi/acpica/dbmethod.c
#	drivers/acpi/acpica/exdump.c
#	drivers/acpi/acpica/tbdata.c
#	drivers/acpi/acpica/utownerid.c
diff --cc drivers/acpi/acpica/exdump.c
index c13670bab5c7,a9bc938a3b55..000000000000
--- a/drivers/acpi/acpica/exdump.c
+++ b/drivers/acpi/acpica/exdump.c
@@@ -276,15 -264,17 +276,24 @@@ static struct acpi_exdump_info acpi_ex_
  	 "Field Bit Offset"},
  	{ACPI_EXD_UINT32, ACPI_EXD_OFFSET(common_field.base_byte_offset),
  	 "Base Byte Offset"},
 -	{ACPI_EXD_NODE, ACPI_EXD_OFFSET(common_field.node), "Parent Node"}
 +	{ACPI_EXD_POINTER, ACPI_EXD_OFFSET(common_field.node), "Parent Node"}
  };
  
 -static struct acpi_exdump_info acpi_ex_dump_node[7] = {
 +static struct acpi_exdump_info acpi_ex_dump_node[5] = {
  	{ACPI_EXD_INIT, ACPI_EXD_TABLE_SIZE(acpi_ex_dump_node), NULL},
++<<<<<<< HEAD
 +	{ACPI_EXD_UINT8, ACPI_EXD_NSOFFSET(flags), "Flags"},
 +	{ACPI_EXD_UINT8, ACPI_EXD_NSOFFSET(owner_id), "Owner Id"},
 +	{ACPI_EXD_POINTER, ACPI_EXD_NSOFFSET(child), "Child List"},
 +	{ACPI_EXD_POINTER, ACPI_EXD_NSOFFSET(peer), "Next Peer"}
++=======
+ 	{ACPI_EXD_UINT16, ACPI_EXD_NSOFFSET(flags), "Flags"},
+ 	{ACPI_EXD_UINT16, ACPI_EXD_NSOFFSET(owner_id), "Owner Id"},
+ 	{ACPI_EXD_LIST, ACPI_EXD_NSOFFSET(object), "Object List"},
+ 	{ACPI_EXD_NODE, ACPI_EXD_NSOFFSET(parent), "Parent"},
+ 	{ACPI_EXD_NODE, ACPI_EXD_NSOFFSET(child), "Child"},
+ 	{ACPI_EXD_NODE, ACPI_EXD_NSOFFSET(peer), "Peer"}
++>>>>>>> 67a72420a326 (ACPICA: Increase total number of possible Owner IDs)
  };
  
  /* Dispatch table, indexed by object type */
diff --cc drivers/acpi/acpica/tbdata.c
index a3e131bab53a,309440010ab2..000000000000
--- a/drivers/acpi/acpica/tbdata.c
+++ b/drivers/acpi/acpica/tbdata.c
@@@ -608,9 -751,8 +608,13 @@@ acpi_status acpi_tb_delete_namespace_by
  		return_ACPI_STATUS(status);
  	}
  
++<<<<<<< HEAD
++=======
+ 	acpi_ns_delete_namespace_by_owner(owner_id);
++>>>>>>> 67a72420a326 (ACPICA: Increase total number of possible Owner IDs)
  	acpi_ut_release_write_lock(&acpi_gbl_namespace_rw_lock);
 +
 +	status = acpi_ut_acquire_mutex(ACPI_MTX_INTERPRETER);
  	return_ACPI_STATUS(status);
  }
  
diff --cc drivers/acpi/acpica/utownerid.c
index 835340b26d37,d3525ef8ed28..000000000000
--- a/drivers/acpi/acpica/utownerid.c
+++ b/drivers/acpi/acpica/utownerid.c
@@@ -73,8 -37,8 +73,13 @@@ acpi_status acpi_ut_allocate_owner_id(a
  	/* Guard against multiple allocations of ID to the same location */
  
  	if (*owner_id) {
++<<<<<<< HEAD
 +		ACPI_ERROR((AE_INFO, "Owner ID [0x%2.2X] already exists",
 +			    *owner_id));
++=======
+ 		ACPI_ERROR((AE_INFO,
+ 			    "Owner ID [0x%3.3X] already exists", *owner_id));
++>>>>>>> 67a72420a326 (ACPICA: Increase total number of possible Owner IDs)
  		return_ACPI_STATUS(AE_ALREADY_EXISTS);
  	}
  
@@@ -122,10 -92,10 +127,10 @@@
  				 * permanently allocated (prevents +1 overflow)
  				 */
  				*owner_id =
 -				    (acpi_owner_id)((k + 1) + ACPI_MUL_32(j));
 +				    (acpi_owner_id) ((k + 1) + ACPI_MUL_32(j));
  
  				ACPI_DEBUG_PRINT((ACPI_DB_VALUES,
- 						  "Allocated OwnerId: %2.2X\n",
+ 						  "Allocated OwnerId: 0x%3.3X\n",
  						  (unsigned int)*owner_id));
  				goto exit;
  			}
@@@ -146,9 -116,9 +151,9 @@@
  	 */
  	status = AE_OWNER_ID_LIMIT;
  	ACPI_ERROR((AE_INFO,
- 		    "Could not allocate new OwnerId (255 max), AE_OWNER_ID_LIMIT"));
+ 		    "Could not allocate new OwnerId (4095 max), AE_OWNER_ID_LIMIT"));
  
 -exit:
 +      exit:
  	(void)acpi_ut_release_mutex(ACPI_MTX_CACHES);
  	return_ACPI_STATUS(status);
  }
* Unmerged path drivers/acpi/acpica/dbmethod.c
diff --git a/drivers/acpi/acpica/aclocal.h b/drivers/acpi/acpica/aclocal.h
index b9db27589f13..a22d71598fe6 100644
--- a/drivers/acpi/acpica/aclocal.h
+++ b/drivers/acpi/acpica/aclocal.h
@@ -162,12 +162,12 @@ struct acpi_namespace_node {
 	union acpi_operand_object *object;	/* Interpreter object */
 	u8 descriptor_type;	/* Differentiate object descriptor types */
 	u8 type;		/* ACPI Type associated with this name */
-	u8 flags;		/* Miscellaneous flags */
-	acpi_owner_id owner_id;	/* Node creator */
+	u16 flags;		/* Miscellaneous flags */
 	union acpi_name_union name;	/* ACPI Name, always 4 chars per ACPI spec */
 	struct acpi_namespace_node *parent;	/* Parent node */
 	struct acpi_namespace_node *child;	/* First child */
 	struct acpi_namespace_node *peer;	/* First peer */
+	acpi_owner_id owner_id;	/* Node creator */
 
 	/*
 	 * The following fields are used by the ASL compiler and disassembler only
diff --git a/drivers/acpi/acpica/acobject.h b/drivers/acpi/acpica/acobject.h
index cc7ab6dd724e..bc662fbb7b4e 100644
--- a/drivers/acpi/acpica/acobject.h
+++ b/drivers/acpi/acpica/acobject.h
@@ -183,8 +183,8 @@ struct acpi_object_method {
 	} dispatch;
 
 	u32 aml_length;
-	u8 thread_count;
 	acpi_owner_id owner_id;
+	u8 thread_count;
 };
 
 /* Flags for info_flags field above */
diff --git a/drivers/acpi/acpica/acstruct.h b/drivers/acpi/acpica/acstruct.h
index fc83c0a5ca70..b68ad0f9f9bc 100644
--- a/drivers/acpi/acpica/acstruct.h
+++ b/drivers/acpi/acpica/acstruct.h
@@ -199,9 +199,9 @@ struct acpi_evaluate_info {
 	u32 return_flags;	/* Used for return value analysis */
 	u32 return_btype;	/* Bitmapped type of the returned object */
 	u16 param_count;	/* Count of the input argument list */
+	u16 node_flags;		/* Same as Node->Flags */
 	u8 pass_number;		/* Parser pass number */
 	u8 return_object_type;	/* Object type of the returned object */
-	u8 node_flags;		/* Same as Node->Flags */
 	u8 flags;		/* General flags */
 };
 
diff --git a/drivers/acpi/acpica/acutils.h b/drivers/acpi/acpica/acutils.h
index f115ec30c1eb..47ad8144fd09 100644
--- a/drivers/acpi/acpica/acutils.h
+++ b/drivers/acpi/acpica/acutils.h
@@ -723,18 +723,19 @@ void ACPI_INTERNAL_VAR_XFACE
 acpi_ut_predefined_warning(const char *module_name,
 			   u32 line_number,
 			   char *pathname,
-			   u8 node_flags, const char *format, ...);
+			   u16 node_flags, const char *format, ...);
 
 void ACPI_INTERNAL_VAR_XFACE
 acpi_ut_predefined_info(const char *module_name,
 			u32 line_number,
-			char *pathname, u8 node_flags, const char *format, ...);
+			char *pathname,
+			u16 node_flags, const char *format, ...);
 
 void ACPI_INTERNAL_VAR_XFACE
 acpi_ut_predefined_bios_error(const char *module_name,
 			      u32 line_number,
 			      char *pathname,
-			      u8 node_flags, const char *format, ...);
+			      u16 node_flags, const char *format, ...);
 
 void
 acpi_ut_namespace_error(const char *module_name,
* Unmerged path drivers/acpi/acpica/dbmethod.c
* Unmerged path drivers/acpi/acpica/exdump.c
diff --git a/drivers/acpi/acpica/nsalloc.c b/drivers/acpi/acpica/nsalloc.c
index 243737363fb8..86243c8a77d7 100644
--- a/drivers/acpi/acpica/nsalloc.c
+++ b/drivers/acpi/acpica/nsalloc.c
@@ -263,7 +263,7 @@ void acpi_ns_install_node(struct acpi_walk_state *walk_state, struct acpi_namesp
 	node->type = (u8) type;
 
 	ACPI_DEBUG_PRINT((ACPI_DB_NAMES,
-			  "%4.4s (%s) [Node %p Owner %X] added to %4.4s (%s) [Node %p]\n",
+			  "%4.4s (%s) [Node %p Owner %3.3X] added to %4.4s (%s) [Node %p]\n",
 			  acpi_ut_get_node_name(node),
 			  acpi_ut_get_type_name(node->type), node, owner_id,
 			  acpi_ut_get_node_name(parent_node),
diff --git a/drivers/acpi/acpica/nsdump.c b/drivers/acpi/acpica/nsdump.c
index ed58dd2047b8..a8cbda7fefce 100644
--- a/drivers/acpi/acpica/nsdump.c
+++ b/drivers/acpi/acpica/nsdump.c
@@ -216,7 +216,7 @@ acpi_ns_dump_one_object(acpi_handle obj_handle,
 
 	/* Now we can print out the pertinent information */
 
-	acpi_os_printf(" %-12s %p %2.2X ",
+	acpi_os_printf(" %-12s %p %3.3X ",
 		       acpi_ut_get_type_name(type), this_node,
 		       this_node->owner_id);
 
* Unmerged path drivers/acpi/acpica/tbdata.c
diff --git a/drivers/acpi/acpica/uterror.c b/drivers/acpi/acpica/uterror.c
index 154fdcaa5830..0134721aa275 100644
--- a/drivers/acpi/acpica/uterror.c
+++ b/drivers/acpi/acpica/uterror.c
@@ -75,7 +75,7 @@ void ACPI_INTERNAL_VAR_XFACE
 acpi_ut_predefined_warning(const char *module_name,
 			   u32 line_number,
 			   char *pathname,
-			   u8 node_flags, const char *format, ...)
+			   u16 node_flags, const char *format, ...)
 {
 	va_list arg_list;
 
@@ -117,7 +117,7 @@ acpi_ut_predefined_warning(const char *module_name,
 void ACPI_INTERNAL_VAR_XFACE
 acpi_ut_predefined_info(const char *module_name,
 			u32 line_number,
-			char *pathname, u8 node_flags, const char *format, ...)
+			char *pathname, u16 node_flags, const char *format, ...)
 {
 	va_list arg_list;
 
@@ -160,7 +160,7 @@ void ACPI_INTERNAL_VAR_XFACE
 acpi_ut_predefined_bios_error(const char *module_name,
 			      u32 line_number,
 			      char *pathname,
-			      u8 node_flags, const char *format, ...)
+			      u16 node_flags, const char *format, ...)
 {
 	va_list arg_list;
 
* Unmerged path drivers/acpi/acpica/utownerid.c
diff --git a/include/acpi/acconfig.h b/include/acpi/acconfig.h
index 33191aae4a12..7e829fc0737e 100644
--- a/include/acpi/acconfig.h
+++ b/include/acpi/acconfig.h
@@ -124,9 +124,9 @@
 
 #define ACPI_DEFAULT_PAGE_SIZE          4096	/* Must be power of 2 */
 
-/* owner_id tracking. 8 entries allows for 255 owner_ids */
+/* owner_id tracking. 128 entries allows for 4095 owner_ids */
 
-#define ACPI_NUM_OWNERID_MASKS          8
+#define ACPI_NUM_OWNERID_MASKS          128
 
 /* Size of the root table array is increased by this increment */
 
diff --git a/include/acpi/actypes.h b/include/acpi/actypes.h
index df6f26bfcc64..f2610ea0fe9f 100644
--- a/include/acpi/actypes.h
+++ b/include/acpi/actypes.h
@@ -426,8 +426,8 @@ typedef void *acpi_handle;	/* Actually a ptr to a NS Node */
 
 /* Owner IDs are used to track namespace nodes for selective deletion */
 
-typedef u8 acpi_owner_id;
-#define ACPI_OWNER_ID_MAX               0xFF
+typedef u16 acpi_owner_id;
+#define ACPI_OWNER_ID_MAX               0xFFF	/* 4095 possible owner IDs */
 
 #define ACPI_INTEGER_BIT_SIZE           64
 #define ACPI_MAX_DECIMAL_DIGITS         20	/* 2^64 = 18,446,744,073,709,551,616 */
