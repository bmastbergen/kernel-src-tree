perf/x86: Modify error message in virtualized environment

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1127.el7
commit-author Juergen Gross <jgross@suse.com>
commit 005bd0077a79c4bcfe64e7331b275e12f742093f
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1127.el7/005bd007.failed

It is known that PMU isn't working in some virtualized environments.

Modify the message issued in that case to mention why hardware PMU
isn't usable instead of reporting it to be broken.

As a side effect this will correct a little bug in the error message:
The error message was meant to be either of level err or info
depending on the environment (native or virtualized). As the level is
taken from the format string and not the printed string, specifying
it via %s and a conditional argument didn't work the way intended.

	Signed-off-by: Juergen Gross <jgross@suse.com>
	Cc: Alexander Shishkin <alexander.shishkin@linux.intel.com>
	Cc: Arnaldo Carvalho de Melo <acme@redhat.com>
	Cc: Jiri Olsa <jolsa@redhat.com>
	Cc: Linus Torvalds <torvalds@linux-foundation.org>
	Cc: Peter Zijlstra <peterz@infradead.org>
	Cc: Thomas Gleixner <tglx@linutronix.de>
	Cc: acme@kernel.org
Link: http://lkml.kernel.org/r/1470051427-16795-1-git-send-email-jgross@suse.com
	Signed-off-by: Ingo Molnar <mingo@kernel.org>
(cherry picked from commit 005bd0077a79c4bcfe64e7331b275e12f742093f)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/x86/events/core.c
diff --cc arch/x86/events/core.c
index a5a5d2014337,ba1335d16529..000000000000
--- a/arch/x86/events/core.c
+++ b/arch/x86/events/core.c
@@@ -260,10 -262,13 +260,20 @@@ static bool check_hw_exists(void
  	return true;
  
  msr_fail:
++<<<<<<< HEAD
 +	printk(KERN_CONT "Broken PMU hardware detected, using software events only.\n");
 +	printk("%sFailed to access perfctr msr (MSR %x is %Lx)\n",
 +		boot_cpu_has(X86_FEATURE_HYPERVISOR) ? KERN_INFO : KERN_ERR,
 +		reg, val_new);
++=======
+ 	if (boot_cpu_has(X86_FEATURE_HYPERVISOR)) {
+ 		pr_cont("PMU not available due to virtualization, using software events only.\n");
+ 	} else {
+ 		pr_cont("Broken PMU hardware detected, using software events only.\n");
+ 		pr_err("Failed to access perfctr msr (MSR %x is %Lx)\n",
+ 		       reg, val_new);
+ 	}
++>>>>>>> 005bd0077a79 (perf/x86: Modify error message in virtualized environment)
  
  	return false;
  }
* Unmerged path arch/x86/events/core.c
