iwlwifi: pcie: fix the byte count table format for 22560 devices

jira LE-1907
Rebuild_History Non-Buildable kernel-3.10.0-1127.el7
commit-author Emmanuel Grumbach <emmanuel.grumbach@intel.com>
commit 884b75696873f5338c57a2613763ea8f37b4e26b
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-3.10.0-1127.el7/884b7569.failed

Starting from 22560, the byte count is expected to be in
bytes and we have now 14 bits. Ajust the code to this.

	Signed-off-by: Emmanuel Grumbach <emmanuel.grumbach@intel.com>
	Signed-off-by: Luca Coelho <luciano.coelho@intel.com>
	Signed-off-by: Kalle Valo <kvalo@codeaurora.org>
(cherry picked from commit 884b75696873f5338c57a2613763ea8f37b4e26b)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/wireless/intel/iwlwifi/pcie/tx-gen2.c
diff --cc drivers/net/wireless/intel/iwlwifi/pcie/tx-gen2.c
index 6f45c8148b27,9ef6b8fe03c1..000000000000
--- a/drivers/net/wireless/intel/iwlwifi/pcie/tx-gen2.c
+++ b/drivers/net/wireless/intel/iwlwifi/pcie/tx-gen2.c
@@@ -93,9 -99,7 +93,13 @@@ static void iwl_pcie_gen2_update_byte_t
  	u16 len = byte_cnt;
  	__le16 bc_ent;
  
++<<<<<<< HEAD
 +	len = DIV_ROUND_UP(len, 4);
 +
 +	if (WARN_ON(len > 0xFFF || idx >= txq->n_window))
++=======
+ 	if (WARN(idx >= txq->n_window, "%d >= %d\n", idx, txq->n_window))
++>>>>>>> 884b75696873 (iwlwifi: pcie: fix the byte count table format for 22560 devices)
  		return;
  
  	filled_tfd_size = offsetof(struct iwl_tfh_tfd, tbs) +
@@@ -110,8 -114,20 +114,25 @@@
  	 */
  	num_fetch_chunks = DIV_ROUND_UP(filled_tfd_size, 64) - 1;
  
++<<<<<<< HEAD
 +	bc_ent = cpu_to_le16(len | (num_fetch_chunks << 12));
 +	scd_bc_tbl->tfd_offset[idx] = bc_ent;
++=======
+ 	if (trans->cfg->device_family >= IWL_DEVICE_FAMILY_22560) {
+ 		/* Starting from 22560, the HW expects bytes */
+ 		WARN_ON(trans_pcie->bc_table_dword);
+ 		WARN_ON(len > 0x3FFF);
+ 		bc_ent = cpu_to_le16(len | (num_fetch_chunks << 14));
+ 		scd_bc_tbl_gen3->tfd_offset[idx] = bc_ent;
+ 	} else {
+ 		/* Until 22560, the HW expects DW */
+ 		WARN_ON(!trans_pcie->bc_table_dword);
+ 		len = DIV_ROUND_UP(len, 4);
+ 		WARN_ON(len > 0xFFF);
+ 		bc_ent = cpu_to_le16(len | (num_fetch_chunks << 12));
+ 		scd_bc_tbl->tfd_offset[idx] = bc_ent;
+ 	}
++>>>>>>> 884b75696873 (iwlwifi: pcie: fix the byte count table format for 22560 devices)
  }
  
  /*
* Unmerged path drivers/net/wireless/intel/iwlwifi/pcie/tx-gen2.c
